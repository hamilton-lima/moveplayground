import{b as jG,c as HG,f as yve,g as qG}from"./chunk-X5YLR3NI.js";import{a as ie,b as $e,c as ah,e as Sr,f as Nr,g as Wp,h as gve,i as M}from"./chunk-ODN5LVDJ.js";var n6=Sr(R$=>{"use strict";Object.defineProperty(R$,"__esModule",{value:!0});var A$=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};R$.default=A$});var M$=Sr(gC=>{"use strict";var o6=gC&&gC.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(gC,"__esModule",{value:!0});var NTe=o6((qG(),gve(yve))),DTe=o6(n6()),O$=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=NTe.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let n=this.fetch,o=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(s=>M(this,null,function*(){var i,a,c;let l=null,u=null,p=null,d=s.status,h=s.statusText;if(s.ok){if(this.method!=="HEAD"){let y=yield s.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=y:u=JSON.parse(y))}let m=(i=this.headers.Prefer)===null||i===void 0?void 0:i.match(/count=(exact|planned|estimated)/),g=(a=s.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");m&&g&&g.length>1&&(p=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(l={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,p=null,d=406,h="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let m=yield s.text();try{l=JSON.parse(m),Array.isArray(l)&&s.status===404&&(u=[],l=null,d=200,h="OK")}catch{s.status===404&&m===""?(d=204,h="No Content"):l={message:m}}if(l&&this.isMaybeSingle&&(!((c=l?.details)===null||c===void 0)&&c.includes("0 rows"))&&(l=null,d=200,h="OK"),l&&this.shouldThrowOnError)throw new DTe.default(l)}return{error:l,data:u,count:p,status:d,statusText:h}}));return this.shouldThrowOnError||(o=o.catch(s=>{var i,a,c;return{error:{message:`${(i=s?.name)!==null&&i!==void 0?i:"FetchError"}: ${s?.message}`,details:`${(a=s?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=s?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),o.then(e,t)}};gC.default=O$});var P$=Sr(yC=>{"use strict";var ATe=yC&&yC.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(yC,"__esModule",{value:!0});var RTe=ATe(M$()),F$=class extends RTe.default{select(e){let t=!1,n=(e??"*").split("").map(o=>/\s/.test(o)&&!t?"":(o==='"'&&(t=!t),o)).join("");return this.url.searchParams.set("select",n),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:o,referencedTable:s=o}={}){let i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){let o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:o=n}={}){let s=typeof o>"u"?"offset":`${o}.offset`,i=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:o=!1,wal:s=!1,format:i="text"}={}){var a;let c=[e?"analyze":null,t?"verbose":null,n?"settings":null,o?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${c};`,i==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};yC.default=F$});var a1=Sr(xC=>{"use strict";var OTe=xC&&xC.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(xC,"__esModule",{value:!0});var MTe=OTe(P$()),$$=class extends MTe.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let n=Array.from(new Set(t)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:o}={}){let s="";o==="plain"?s="pl":o==="phrase"?s="ph":o==="websearch"&&(s="w");let i=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){let o=n?`${n}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};xC.default=$$});var V$=Sr(bC=>{"use strict";var FTe=bC&&bC.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(bC,"__esModule",{value:!0});var vC=FTe(a1()),L$=class{constructor(e,{headers:t={},schema:n,fetch:o}){this.url=e,this.headers=t,this.schema=n,this.fetch=o}select(e,{head:t=!1,count:n}={}){let o=t?"HEAD":"GET",s=!1,i=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),n&&(this.headers.Prefer=`count=${n}`),new vC.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:n=!0}={}){let o="POST",s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),n||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){let i=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(i.length>0){let a=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new vC.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:o,defaultToNull:s=!0}={}){let i="POST",a=[`resolution=${n?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let c=e.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(c.length>0){let l=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new vC.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let n="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),this.headers.Prefer=o.join(","),new vC.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t="DELETE",n=[];return e&&n.push(`count=${e}`),this.headers.Prefer&&n.unshift(this.headers.Prefer),this.headers.Prefer=n.join(","),new vC.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};bC.default=L$});var s6=Sr(c1=>{"use strict";Object.defineProperty(c1,"__esModule",{value:!0});c1.version=void 0;c1.version="0.0.0-automated"});var i6=Sr(l1=>{"use strict";Object.defineProperty(l1,"__esModule",{value:!0});l1.DEFAULT_HEADERS=void 0;var PTe=s6();l1.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${PTe.version}`}});var c6=Sr(wC=>{"use strict";var a6=wC&&wC.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wC,"__esModule",{value:!0});var $Te=a6(V$()),LTe=a6(a1()),VTe=i6(),B$=class r{constructor(e,{headers:t={},schema:n,fetch:o}={}){this.url=e,this.headers=Object.assign(Object.assign({},VTe.DEFAULT_HEADERS),t),this.schemaName=n,this.fetch=o}from(e){let t=new URL(`${this.url}/${e}`);return new $Te.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new r(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:o=!1,count:s}={}){let i,a=new URL(`${this.url}/rpc/${e}`),c;n||o?(i=n?"HEAD":"GET",Object.entries(t).filter(([u,p])=>p!==void 0).map(([u,p])=>[u,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([u,p])=>{a.searchParams.append(u,p)})):(i="POST",c=t);let l=Object.assign({},this.headers);return s&&(l.Prefer=`count=${s}`),new LTe.default({method:i,url:a,headers:l,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};wC.default=B$});var f6=Sr(Ws=>{"use strict";var CC=Ws&&Ws.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ws,"__esModule",{value:!0});Ws.PostgrestBuilder=Ws.PostgrestTransformBuilder=Ws.PostgrestFilterBuilder=Ws.PostgrestQueryBuilder=Ws.PostgrestClient=void 0;var l6=CC(c6());Ws.PostgrestClient=l6.default;var u6=CC(V$());Ws.PostgrestQueryBuilder=u6.default;var p6=CC(a1());Ws.PostgrestFilterBuilder=p6.default;var d6=CC(P$());Ws.PostgrestTransformBuilder=d6.default;var h6=CC(M$());Ws.PostgrestBuilder=h6.default;Ws.default={PostgrestClient:l6.default,PostgrestQueryBuilder:u6.default,PostgrestFilterBuilder:p6.default,PostgrestTransformBuilder:d6.default,PostgrestBuilder:h6.default}});var aK=Sr(iK=>{"use strict";(function(){"use strict";var r;function e(v){var T=0;return function(){return T<v.length?{done:!1,value:v[T++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,T,A){return v==Array.prototype||v==Object.prototype||(v[T]=A.value),v};function n(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof global=="object"&&global];for(var T=0;T<v.length;++T){var A=v[T];if(A&&A.Math==Math)return A}throw Error("Cannot find global object")}var o=n(this);function s(v,T){if(T)e:{var A=o;v=v.split(".");for(var P=0;P<v.length-1;P++){var Y=v[P];if(!(Y in A))break e;A=A[Y]}v=v[v.length-1],P=A[v],T=T(P),T!=P&&T!=null&&t(A,v,{configurable:!0,writable:!0,value:T})}}s("Symbol",function(v){function T(J){if(this instanceof T)throw new TypeError("Symbol is not a constructor");return new A(P+(J||"")+"_"+Y++,J)}function A(J,Q){this.h=J,t(this,"description",{configurable:!0,writable:!0,value:Q})}if(v)return v;A.prototype.toString=function(){return this.h};var P="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Y=0;return T}),s("Symbol.iterator",function(v){if(v)return v;v=Symbol("Symbol.iterator");for(var T="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),A=0;A<T.length;A++){var P=o[T[A]];typeof P=="function"&&typeof P.prototype[v]!="function"&&t(P.prototype,v,{configurable:!0,writable:!0,value:function(){return i(e(this))}})}return v});function i(v){return v={next:v},v[Symbol.iterator]=function(){return this},v}function a(v){var T=typeof Symbol<"u"&&Symbol.iterator&&v[Symbol.iterator];return T?T.call(v):{next:e(v)}}function c(v){if(!(v instanceof Array)){v=a(v);for(var T,A=[];!(T=v.next()).done;)A.push(T.value);v=A}return v}var l=typeof Object.assign=="function"?Object.assign:function(v,T){for(var A=1;A<arguments.length;A++){var P=arguments[A];if(P)for(var Y in P)Object.prototype.hasOwnProperty.call(P,Y)&&(v[Y]=P[Y])}return v};s("Object.assign",function(v){return v||l});var u=typeof Object.create=="function"?Object.create:function(v){function T(){}return T.prototype=v,new T},p;if(typeof Object.setPrototypeOf=="function")p=Object.setPrototypeOf;else{var d;e:{var h={a:!0},f={};try{f.__proto__=h,d=f.a;break e}catch{}d=!1}p=d?function(v,T){if(v.__proto__=T,v.__proto__!==T)throw new TypeError(v+" is not extensible");return v}:null}var m=p;function g(v,T){if(v.prototype=u(T.prototype),v.prototype.constructor=v,m)m(v,T);else for(var A in T)if(A!="prototype")if(Object.defineProperties){var P=Object.getOwnPropertyDescriptor(T,A);P&&Object.defineProperty(v,A,P)}else v[A]=T[A];v.za=T.prototype}function y(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function x(v){if(v.m)throw new TypeError("Generator is already running");v.m=!0}y.prototype.u=function(v){this.i=v};function b(v,T){v.l={ma:T,na:!0},v.h=v.s||v.v}y.prototype.return=function(v){this.l={return:v},this.h=this.v};function w(v,T,A){return v.h=A,{value:T}}function _(v){this.h=new y,this.i=v}function I(v,T){x(v.h);var A=v.h.j;return A?S(v,"return"in A?A.return:function(P){return{value:P,done:!0}},T,v.h.return):(v.h.return(T),k(v))}function S(v,T,A,P){try{var Y=T.call(v.h.j,A);if(!(Y instanceof Object))throw new TypeError("Iterator result "+Y+" is not an object");if(!Y.done)return v.h.m=!1,Y;var J=Y.value}catch(Q){return v.h.j=null,b(v.h,Q),k(v)}return v.h.j=null,P.call(v.h,J),k(v)}function k(v){for(;v.h.h;)try{var T=v.i(v.h);if(T)return v.h.m=!1,{value:T.value,done:!1}}catch(A){v.h.i=void 0,b(v.h,A)}if(v.h.m=!1,v.h.l){if(T=v.h.l,v.h.l=null,T.na)throw T.ma;return{value:T.return,done:!0}}return{value:void 0,done:!0}}function R(v){this.next=function(T){return x(v.h),v.h.j?T=S(v,v.h.j.next,T,v.h.u):(v.h.u(T),T=k(v)),T},this.throw=function(T){return x(v.h),v.h.j?T=S(v,v.h.j.throw,T,v.h.u):(b(v.h,T),T=k(v)),T},this.return=function(T){return I(v,T)},this[Symbol.iterator]=function(){return this}}function L(v){function T(P){return v.next(P)}function A(P){return v.throw(P)}return new Promise(function(P,Y){function J(Q){Q.done?P(Q.value):Promise.resolve(Q.value).then(T,A).then(J,Y)}J(v.next())})}function B(v){return L(new R(new _(v)))}s("Promise",function(v){function T(Q){this.i=0,this.j=void 0,this.h=[],this.u=!1;var se=this.l();try{Q(se.resolve,se.reject)}catch(de){se.reject(de)}}function A(){this.h=null}function P(Q){return Q instanceof T?Q:new T(function(se){se(Q)})}if(v)return v;A.prototype.i=function(Q){if(this.h==null){this.h=[];var se=this;this.j(function(){se.m()})}this.h.push(Q)};var Y=o.setTimeout;A.prototype.j=function(Q){Y(Q,0)},A.prototype.m=function(){for(;this.h&&this.h.length;){var Q=this.h;this.h=[];for(var se=0;se<Q.length;++se){var de=Q[se];Q[se]=null;try{de()}catch(Fe){this.l(Fe)}}}this.h=null},A.prototype.l=function(Q){this.j(function(){throw Q})},T.prototype.l=function(){function Q(Fe){return function(Ue){de||(de=!0,Fe.call(se,Ue))}}var se=this,de=!1;return{resolve:Q(this.I),reject:Q(this.m)}},T.prototype.I=function(Q){if(Q===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(Q instanceof T)this.L(Q);else{e:switch(typeof Q){case"object":var se=Q!=null;break e;case"function":se=!0;break e;default:se=!1}se?this.F(Q):this.s(Q)}},T.prototype.F=function(Q){var se=void 0;try{se=Q.then}catch(de){this.m(de);return}typeof se=="function"?this.M(se,Q):this.s(Q)},T.prototype.m=function(Q){this.v(2,Q)},T.prototype.s=function(Q){this.v(1,Q)},T.prototype.v=function(Q,se){if(this.i!=0)throw Error("Cannot settle("+Q+", "+se+"): Promise already settled in state"+this.i);this.i=Q,this.j=se,this.i===2&&this.K(),this.H()},T.prototype.K=function(){var Q=this;Y(function(){if(Q.D()){var se=o.console;typeof se<"u"&&se.error(Q.j)}},1)},T.prototype.D=function(){if(this.u)return!1;var Q=o.CustomEvent,se=o.Event,de=o.dispatchEvent;return typeof de>"u"?!0:(typeof Q=="function"?Q=new Q("unhandledrejection",{cancelable:!0}):typeof se=="function"?Q=new se("unhandledrejection",{cancelable:!0}):(Q=o.document.createEvent("CustomEvent"),Q.initCustomEvent("unhandledrejection",!1,!0,Q)),Q.promise=this,Q.reason=this.j,de(Q))},T.prototype.H=function(){if(this.h!=null){for(var Q=0;Q<this.h.length;++Q)J.i(this.h[Q]);this.h=null}};var J=new A;return T.prototype.L=function(Q){var se=this.l();Q.T(se.resolve,se.reject)},T.prototype.M=function(Q,se){var de=this.l();try{Q.call(se,de.resolve,de.reject)}catch(Fe){de.reject(Fe)}},T.prototype.then=function(Q,se){function de(ht,Ye){return typeof ht=="function"?function(Nt){try{Fe(ht(Nt))}catch(tr){Ue(tr)}}:Ye}var Fe,Ue,Et=new T(function(ht,Ye){Fe=ht,Ue=Ye});return this.T(de(Q,Fe),de(se,Ue)),Et},T.prototype.catch=function(Q){return this.then(void 0,Q)},T.prototype.T=function(Q,se){function de(){switch(Fe.i){case 1:Q(Fe.j);break;case 2:se(Fe.j);break;default:throw Error("Unexpected state: "+Fe.i)}}var Fe=this;this.h==null?J.i(de):this.h.push(de),this.u=!0},T.resolve=P,T.reject=function(Q){return new T(function(se,de){de(Q)})},T.race=function(Q){return new T(function(se,de){for(var Fe=a(Q),Ue=Fe.next();!Ue.done;Ue=Fe.next())P(Ue.value).T(se,de)})},T.all=function(Q){var se=a(Q),de=se.next();return de.done?P([]):new T(function(Fe,Ue){function Et(Nt){return function(tr){ht[Nt]=tr,Ye--,Ye==0&&Fe(ht)}}var ht=[],Ye=0;do ht.push(void 0),Ye++,P(de.value).T(Et(ht.length-1),Ue),de=se.next();while(!de.done)})},T});function z(v,T){v instanceof String&&(v+="");var A=0,P=!1,Y={next:function(){if(!P&&A<v.length){var J=A++;return{value:T(J,v[J]),done:!1}}return P=!0,{done:!0,value:void 0}}};return Y[Symbol.iterator]=function(){return Y},Y}s("Array.prototype.keys",function(v){return v||function(){return z(this,function(T){return T})}}),s("Array.prototype.fill",function(v){return v||function(T,A,P){var Y=this.length||0;for(0>A&&(A=Math.max(0,Y+A)),(P==null||P>Y)&&(P=Y),P=Number(P),0>P&&(P=Math.max(0,Y+P)),A=Number(A||0);A<P;A++)this[A]=T;return this}});function q(v){return v||Array.prototype.fill}s("Int8Array.prototype.fill",q),s("Uint8Array.prototype.fill",q),s("Uint8ClampedArray.prototype.fill",q),s("Int16Array.prototype.fill",q),s("Uint16Array.prototype.fill",q),s("Int32Array.prototype.fill",q),s("Uint32Array.prototype.fill",q),s("Float32Array.prototype.fill",q),s("Float64Array.prototype.fill",q),s("Object.is",function(v){return v||function(T,A){return T===A?T!==0||1/T===1/A:T!==T&&A!==A}}),s("Array.prototype.includes",function(v){return v||function(T,A){var P=this;P instanceof String&&(P=String(P));var Y=P.length;for(A=A||0,0>A&&(A=Math.max(A+Y,0));A<Y;A++){var J=P[A];if(J===T||Object.is(J,T))return!0}return!1}}),s("String.prototype.includes",function(v){return v||function(T,A){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(T instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(T,A||0)!==-1}});var U=this||self;function G(v,T){v=v.split(".");var A=U;v[0]in A||typeof A.execScript>"u"||A.execScript("var "+v[0]);for(var P;v.length&&(P=v.shift());)v.length||T===void 0?A[P]&&A[P]!==Object.prototype[P]?A=A[P]:A=A[P]={}:A[P]=T}function j(v){var T;e:{if((T=U.navigator)&&(T=T.userAgent))break e;T=""}return T.indexOf(v)!=-1}var X=Array.prototype.map?function(v,T){return Array.prototype.map.call(v,T,void 0)}:function(v,T){for(var A=v.length,P=Array(A),Y=typeof v=="string"?v.split(""):v,J=0;J<A;J++)J in Y&&(P[J]=T.call(void 0,Y[J],J,v));return P},te={},ne=null;function oe(v){var T=v.length,A=3*T/4;A%3?A=Math.floor(A):"=.".indexOf(v[T-1])!=-1&&(A="=.".indexOf(v[T-2])!=-1?A-2:A-1);var P=new Uint8Array(A),Y=0;return le(v,function(J){P[Y++]=J}),Y!==A?P.subarray(0,Y):P}function le(v,T){function A(de){for(;P<v.length;){var Fe=v.charAt(P++),Ue=ne[Fe];if(Ue!=null)return Ue;if(!/^[\s\xa0]*$/.test(Fe))throw Error("Unknown base64 encoding at char: "+Fe)}return de}xe();for(var P=0;;){var Y=A(-1),J=A(0),Q=A(64),se=A(64);if(se===64&&Y===-1)break;T(Y<<2|J>>4),Q!=64&&(T(J<<4&240|Q>>2),se!=64&&T(Q<<6&192|se))}}function xe(){if(!ne){ne={};for(var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),T=["+/=","+/","-_=","-_.","-_"],A=0;5>A;A++){var P=v.concat(T[A].split(""));te[A]=P;for(var Y=0;Y<P.length;Y++){var J=P[Y];ne[J]===void 0&&(ne[J]=Y)}}}}var ge=typeof Uint8Array<"u",Re=!(j("Trident")||j("MSIE"))&&typeof U.btoa=="function";function Ee(v){if(!Re){var T;T===void 0&&(T=0),xe(),T=te[T];for(var A=Array(Math.floor(v.length/3)),P=T[64]||"",Y=0,J=0;Y<v.length-2;Y+=3){var Q=v[Y],se=v[Y+1],de=v[Y+2],Fe=T[Q>>2];Q=T[(Q&3)<<4|se>>4],se=T[(se&15)<<2|de>>6],de=T[de&63],A[J++]=Fe+Q+se+de}switch(Fe=0,de=P,v.length-Y){case 2:Fe=v[Y+1],de=T[(Fe&15)<<2]||P;case 1:v=v[Y],A[J]=T[v>>2]+T[(v&3)<<4|Fe>>4]+de+P}return A.join("")}for(T="";10240<v.length;)T+=String.fromCharCode.apply(null,v.subarray(0,10240)),v=v.subarray(10240);return T+=String.fromCharCode.apply(null,v),btoa(T)}var Ne=RegExp("[-_.]","g");function we(v){switch(v){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function qe(v){if(!Re)return oe(v);Ne.test(v)&&(v=v.replace(Ne,we)),v=atob(v);for(var T=new Uint8Array(v.length),A=0;A<v.length;A++)T[A]=v.charCodeAt(A);return T}var Qe;function De(){return Qe||(Qe=new Uint8Array(0))}var Me={},dt=typeof Uint8Array.prototype.slice=="function",Be=0,at=0;function _e(v){var T=0>v;v=Math.abs(v);var A=v>>>0;v=Math.floor((v-A)/4294967296),T&&(A=a(wt(A,v)),T=A.next().value,v=A.next().value,A=T),Be=A>>>0,at=v>>>0}var Ae=typeof BigInt=="function";function wt(v,T){return T=~T,v?v=~v+1:T+=1,[v,T]}function xt(v,T){this.i=v>>>0,this.h=T>>>0}function zt(v){if(!v)return Ut||(Ut=new xt(0,0));if(!/^-?\d+$/.test(v))return null;if(16>v.length)_e(Number(v));else if(Ae)v=BigInt(v),Be=Number(v&BigInt(4294967295))>>>0,at=Number(v>>BigInt(32)&BigInt(4294967295));else{var T=+(v[0]==="-");at=Be=0;for(var A=v.length,P=T,Y=(A-T)%6+T;Y<=A;P=Y,Y+=6)P=Number(v.slice(P,Y)),at*=1e6,Be=1e6*Be+P,4294967296<=Be&&(at+=Be/4294967296|0,Be%=4294967296);T&&(T=a(wt(Be,at)),v=T.next().value,T=T.next().value,Be=v,at=T)}return new xt(Be,at)}var Ut;function Ln(v,T){return Error("Invalid wire type: "+v+" (at position "+T+")")}function wn(){return Error("Failed to read varint, encoding is invalid.")}function xs(v,T){return Error("Tried to read past the end of the data "+T+" > "+v)}function zn(){throw Error("Invalid UTF8")}function hi(v,T){return T=String.fromCharCode.apply(null,T),v==null?T:v+T}var Bs=void 0,ma,Kl=typeof TextDecoder<"u",sh,s0=typeof TextEncoder<"u",Xy;function YS(v){if(v!==Me)throw Error("illegal external caller")}function Xl(v,T){if(YS(T),this.V=v,v!=null&&v.length===0)throw Error("ByteString should be constructed with non-empty values")}function i0(){return Xy||(Xy=new Xl(null,Me))}function ZS(v){YS(Me);var T=v.V;return T=T==null||ge&&T!=null&&T instanceof Uint8Array?T:typeof T=="string"?qe(T):null,T==null?T:v.V=T}function kxe(v){if(typeof v=="string")return{buffer:qe(v),C:!1};if(Array.isArray(v))return{buffer:new Uint8Array(v),C:!1};if(v.constructor===Uint8Array)return{buffer:v,C:!1};if(v.constructor===ArrayBuffer)return{buffer:new Uint8Array(v),C:!1};if(v.constructor===Xl)return{buffer:ZS(v)||De(),C:!0};if(v instanceof Uint8Array)return{buffer:new Uint8Array(v.buffer,v.byteOffset,v.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function lG(v,T){this.i=null,this.m=!1,this.h=this.j=this.l=0,GO(this,v,T)}function GO(v,T,A){A=A===void 0?{}:A,v.S=A.S===void 0?!1:A.S,T&&(T=kxe(T),v.i=T.buffer,v.m=T.C,v.l=0,v.j=v.i.length,v.h=v.l)}lG.prototype.reset=function(){this.h=this.l};function Pm(v,T){if(v.h=T,T>v.j)throw xs(v.j,T)}function a0(v){var T=v.i,A=v.h,P=T[A++],Y=P&127;if(P&128&&(P=T[A++],Y|=(P&127)<<7,P&128&&(P=T[A++],Y|=(P&127)<<14,P&128&&(P=T[A++],Y|=(P&127)<<21,P&128&&(P=T[A++],Y|=P<<28,P&128&&T[A++]&128&&T[A++]&128&&T[A++]&128&&T[A++]&128&&T[A++]&128)))))throw wn();return Pm(v,A),Y}function uG(v,T){if(0>T)throw Error("Tried to read a negative byte length: "+T);var A=v.h,P=A+T;if(P>v.j)throw xs(T,v.j-A);return v.h=P,A}var pG=[];function WO(){this.h=[]}WO.prototype.length=function(){return this.h.length},WO.prototype.end=function(){var v=this.h;return this.h=[],v};function dG(v,T,A){for(;0<A||127<T;)v.h.push(T&127|128),T=(T>>>7|A<<25)>>>0,A>>>=7;v.h.push(T)}function $m(v,T){for(;127<T;)v.h.push(T&127|128),T>>>=7;v.h.push(T)}function jO(v,T){if(pG.length){var A=pG.pop();GO(A,v,T),v=A}else v=new lG(v,T);this.h=v,this.j=this.h.h,this.i=this.l=-1,this.setOptions(T)}jO.prototype.setOptions=function(v){v=v===void 0?{}:v,this.ca=v.ca===void 0?!1:v.ca},jO.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function hG(v){var T=v.h;if(T.h==T.j)return!1;v.j=v.h.h;var A=a0(v.h)>>>0;if(T=A>>>3,A&=7,!(0<=A&&5>=A))throw Ln(A,v.j);if(1>T)throw Error("Invalid field number: "+T+" (at position "+v.j+")");return v.l=T,v.i=A,!0}function QS(v){switch(v.i){case 0:if(v.i!=0)QS(v);else e:{v=v.h;for(var T=v.h,A=T+10,P=v.i;T<A;)if(!(P[T++]&128)){Pm(v,T);break e}throw wn()}break;case 1:v=v.h,Pm(v,v.h+8);break;case 2:v.i!=2?QS(v):(T=a0(v.h)>>>0,v=v.h,Pm(v,v.h+T));break;case 5:v=v.h,Pm(v,v.h+4);break;case 3:T=v.l;do{if(!hG(v))throw Error("Unmatched start-group tag: stream EOF");if(v.i==4){if(v.l!=T)throw Error("Unmatched end-group tag");break}QS(v)}while(!0);break;default:throw Ln(v.i,v.j)}}var JS=[];function Exe(){this.j=[],this.i=0,this.h=new WO}function Yy(v,T){T.length!==0&&(v.j.push(T),v.i+=T.length)}function Nxe(v,T){if(T=T.R){Yy(v,v.h.end());for(var A=0;A<T.length;A++)Yy(v,ZS(T[A])||De())}}var Gp=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Lm(v,T){return Gp?v[Gp]|=T:v.A!==void 0?v.A|=T:(Object.defineProperties(v,{A:{value:T,configurable:!0,writable:!0,enumerable:!1}}),T)}function fG(v,T){Gp?v[Gp]&&(v[Gp]&=~T):v.A!==void 0&&(v.A&=~T)}function oo(v){var T;return Gp?T=v[Gp]:T=v.A,T??0}function Yl(v,T){Gp?v[Gp]=T:v.A!==void 0?v.A=T:Object.defineProperties(v,{A:{value:T,configurable:!0,writable:!0,enumerable:!1}})}function HO(v){return Lm(v,1),v}function Dxe(v,T){Yl(T,(v|0)&-51)}function eI(v,T){Yl(T,(v|18)&-41)}var qO={};function tI(v){return v!==null&&typeof v=="object"&&!Array.isArray(v)&&v.constructor===Object}var c0,mG=[];Yl(mG,23),c0=Object.freeze(mG);function KO(v){if(oo(v.o)&2)throw Error("Cannot mutate an immutable Message")}function XO(v){var T=v.length;(T=T?v[T-1]:void 0)&&tI(T)?T.g=1:(T={},v.push((T.g=1,T)))}function gG(v){var T=v.i+v.G;return v.B||(v.B=v.o[T]={})}function ac(v,T){return T===-1?null:T>=v.i?v.B?v.B[T]:void 0:v.o[T+v.G]}function Zl(v,T,A,P){KO(v),l0(v,T,A,P)}function l0(v,T,A,P){v.j&&(v.j=void 0),T>=v.i||P?gG(v)[T]=A:(v.o[T+v.G]=A,(v=v.B)&&T in v&&delete v[T])}function YO(v,T,A,P){var Y=ac(v,T);Array.isArray(Y)||(Y=c0);var J=oo(Y);if(J&1||HO(Y),P)J&2||Lm(Y,2),A&1||Object.freeze(Y);else{P=!(A&2);var Q=J&2;A&1||!Q?P&&J&16&&!Q&&fG(Y,16):(Y=HO(Array.prototype.slice.call(Y)),l0(v,T,Y))}return Y}function ZO(v,T){var A=ac(v,T),P=A==null?A:typeof A=="number"||A==="NaN"||A==="Infinity"||A==="-Infinity"?Number(A):void 0;return P!=null&&P!==A&&l0(v,T,P),P}function yG(v,T,A,P,Y){v.h||(v.h={});var J=v.h[A],Q=YO(v,A,3,Y);if(!J){var se=Q;J=[];var de=!!(oo(v.o)&16);Q=!!(oo(se)&2);var Fe=se;!Y&&Q&&(se=Array.prototype.slice.call(se));for(var Ue=Q,Et=0;Et<se.length;Et++){var ht=se[Et],Ye=T,Nt=!1;if(Nt=Nt===void 0?!1:Nt,ht=Array.isArray(ht)?new Ye(ht):Nt?new Ye:void 0,ht!==void 0){Ye=ht.o;var tr=Nt=oo(Ye);Q&&(tr|=2),de&&(tr|=16),tr!=Nt&&Yl(Ye,tr),Ye=tr,Ue=Ue||!!(2&Ye),J.push(ht)}}return v.h[A]=J,de=oo(se),T=de|33,T=Ue?T&-9:T|8,de!=T&&(Ue=se,Object.isFrozen(Ue)&&(Ue=Array.prototype.slice.call(Ue)),Yl(Ue,T),se=Ue),Fe!==se&&l0(v,A,se),(Y||P&&Q)&&Lm(J,2),P&&Object.freeze(J),J}return Y||(Y=Object.isFrozen(J),P&&!Y?Object.freeze(J):!P&&Y&&(J=Array.prototype.slice.call(J),v.h[A]=J)),J}function QO(v,T,A){var P=!!(oo(v.o)&2);if(T=yG(v,T,A,P,P),v=YO(v,A,3,P),!(P||oo(v)&8)){for(P=0;P<T.length;P++){if(A=T[P],oo(A.o)&2){var Y=_G(A,!1);Y.j=A}else Y=A;A!==Y&&(T[P]=Y,v[P]=Y.o)}Lm(v,8)}return T}function Ql(v,T,A){if(A!=null&&typeof A!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof A+": "+A);Zl(v,T,A)}function xG(v,T,A,P,Y){KO(v);var J=yG(v,A,T,!1,!1);return A=P??new A,v=YO(v,T,2,!1),Y!=null?(J.splice(Y,0,A),v.splice(Y,0,A.o)):(J.push(A),v.push(A.o)),A.C()&&fG(v,8),A}function rI(v,T){return v??T}function Jl(v,T,A){return A=A===void 0?0:A,rI(ZO(v,T),A)}var nI;function Axe(v){switch(typeof v){case"number":return isFinite(v)?v:String(v);case"object":if(v)if(Array.isArray(v)){if(oo(v)&128)return v=Array.prototype.slice.call(v),XO(v),v}else{if(ge&&v!=null&&v instanceof Uint8Array)return Ee(v);if(v instanceof Xl){var T=v.V;return T==null?"":typeof T=="string"?T:v.V=Ee(T)}}}return v}function vG(v,T,A,P){if(v!=null){if(Array.isArray(v))v=JO(v,T,A,P!==void 0);else if(tI(v)){var Y={},J;for(J in v)Y[J]=vG(v[J],T,A,P);v=Y}else v=T(v,P);return v}}function JO(v,T,A,P){var Y=oo(v);P=P?!!(Y&16):void 0,v=Array.prototype.slice.call(v);for(var J=0;J<v.length;J++)v[J]=vG(v[J],T,A,P);return A(Y,v),v}function Rxe(v){return v.ja===qO?v.toJSON():Axe(v)}function Oxe(v,T){v&128&&XO(T)}function bG(v,T,A){if(A=A===void 0?eI:A,v!=null){if(ge&&v instanceof Uint8Array)return v.length?new Xl(new Uint8Array(v),Me):i0();if(Array.isArray(v)){var P=oo(v);return P&2?v:T&&!(P&32)&&(P&16||P===0)?(Yl(v,P|2),v):(v=JO(v,bG,P&4?eI:A,!0),T=oo(v),T&4&&T&2&&Object.freeze(v),v)}return v.ja===qO?CG(v):v}}function wG(v,T,A,P,Y,J,Q){if(v=v.h&&v.h[A]){if(P=oo(v),P&2?P=v:(J=X(v,CG),eI(P,J),Object.freeze(J),P=J),KO(T),Q=P==null?c0:HO([]),P!=null){for(J=!!P.length,v=0;v<P.length;v++){var se=P[v];J=J&&!(oo(se.o)&2),Q[v]=se.o}J=(J?8:0)|1,v=oo(Q),(v&J)!==J&&(Object.isFrozen(Q)&&(Q=Array.prototype.slice.call(Q)),Yl(Q,v|J)),T.h||(T.h={}),T.h[A]=P}else T.h&&(T.h[A]=void 0);l0(T,A,Q,Y)}else Zl(T,A,bG(P,J,Q),Y)}function CG(v){return oo(v.o)&2||(v=_G(v,!0),Lm(v.o,2)),v}function _G(v,T){var A=v.o,P=[];Lm(P,16);var Y=v.constructor.h;if(Y&&P.push(Y),Y=v.B,Y){P.length=A.length,P.fill(void 0,P.length,A.length);var J={};P[P.length-1]=J}oo(A)&128&&XO(P),T=T||v.C()?eI:Dxe,J=v.constructor,nI=P,P=new J(P),nI=void 0,v.R&&(P.R=v.R.slice()),J=!!(oo(A)&16);for(var Q=Y?A.length-1:A.length,se=0;se<Q;se++)wG(v,P,se-v.G,A[se],!1,J,T);if(Y)for(var de in Y)wG(v,P,+de,Y[de],!0,J,T);return P}function fi(v,T,A){v==null&&(v=nI),nI=void 0;var P=this.constructor.i||0,Y=0<P,J=this.constructor.h,Q=!1;if(v==null){v=J?[J]:[];var se=48,de=!0;Y&&(P=0,se|=128),Yl(v,se)}else{if(!Array.isArray(v)||J&&J!==v[0])throw Error();var Fe=se=Lm(v,0);if((de=(16&Fe)!==0)&&((Q=(32&Fe)!==0)||(Fe|=32)),Y){if(128&Fe)P=0;else if(0<v.length){var Ue=v[v.length-1];if(tI(Ue)&&"g"in Ue){P=0,Fe|=128,delete Ue.g;var Et=!0,ht;for(ht in Ue){Et=!1;break}Et&&v.pop()}}}else if(128&Fe)throw Error();se!==Fe&&Yl(v,Fe)}this.G=(J?0:-1)-P,this.h=void 0,this.o=v;e:{if(J=this.o.length,P=J-1,J&&(J=this.o[P],tI(J))){this.B=J,this.i=P-this.G;break e}T!==void 0&&-1<T?(this.i=Math.max(T,P+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!Y&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(A){T=de&&!Q&&!0,Y=this.i;var Ye;for(de=0;de<A.length;de++)Q=A[de],Q<Y?(Q+=this.G,(P=v[Q])?SG(P,T):v[Q]=c0):(Ye||(Ye=gG(this)),(P=Ye[Q])?SG(P,T):Ye[Q]=c0)}}fi.prototype.toJSON=function(){return JO(this.o,Rxe,Oxe)},fi.prototype.C=function(){return!!(oo(this.o)&2)};function SG(v,T){if(Array.isArray(v)){var A=oo(v),P=1;!T||A&2||(P|=16),(A&P)!==P&&Yl(v,A|P)}}fi.prototype.ja=qO,fi.prototype.toString=function(){return this.o.toString()};function IG(v,T,A){if(A){var P={},Y;for(Y in A){var J=A[Y],Q=J.ra;Q||(P.J=J.xa||J.oa.W,J.ia?(P.aa=DG(J.ia),Q=function(se){return function(de,Fe,Ue){return se.J(de,Fe,Ue,se.aa)}}(P)):J.ka?(P.Z=AG(J.da.P,J.ka),Q=function(se){return function(de,Fe,Ue){return se.J(de,Fe,Ue,se.Z)}}(P)):Q=P.J,J.ra=Q),Q(T,v,J.da),P={J:P.J,aa:P.aa,Z:P.Z}}}Nxe(T,v)}var oI=Symbol();function TG(v,T,A){return v[oI]||(v[oI]=function(P,Y){return T(P,Y,A)})}function kG(v){var T=v[oI];if(!T){var A=tM(v);T=function(P,Y){return RG(P,Y,A)},v[oI]=T}return T}function Mxe(v){var T=v.ia;if(T)return kG(T);if(T=v.wa)return TG(v.da.P,T,v.ka)}function Fxe(v){var T=Mxe(v),A=v.da,P=v.oa.U;return T?function(Y,J){return P(Y,J,A,T)}:function(Y,J){return P(Y,J,A)}}function EG(v,T){var A=v[T];return typeof A=="function"&&A.length===0&&(A=A(),v[T]=A),Array.isArray(A)&&(p0 in A||u0 in A||0<A.length&&typeof A[0]=="function")?A:void 0}function NG(v,T,A,P,Y,J){T.P=v[0];var Q=1;if(v.length>Q&&typeof v[Q]!="number"){var se=v[Q++];A(T,se)}for(;Q<v.length;){A=v[Q++];for(var de=Q+1;de<v.length&&typeof v[de]!="number";)de++;switch(se=v[Q++],de-=Q,de){case 0:P(T,A,se);break;case 1:(de=EG(v,Q))?(Q++,Y(T,A,se,de)):P(T,A,se,v[Q++]);break;case 2:de=Q++,de=EG(v,de),Y(T,A,se,de,v[Q++]);break;case 3:J(T,A,se,v[Q++],v[Q++],v[Q++]);break;case 4:J(T,A,se,v[Q++],v[Q++],v[Q++],v[Q++]);break;default:throw Error("unexpected number of binary field arguments: "+de)}}return T}var sI=Symbol();function DG(v){var T=v[sI];if(!T){var A=eM(v);T=function(P,Y){return OG(P,Y,A)},v[sI]=T}return T}function AG(v,T){var A=v[sI];return A||(A=function(P,Y){return IG(P,Y,T)},v[sI]=A),A}var u0=Symbol();function Pxe(v,T){v.push(T)}function $xe(v,T,A){v.push(T,A.W)}function Lxe(v,T,A,P){var Y=DG(P),J=eM(P).P,Q=A.W;v.push(T,function(se,de,Fe){return Q(se,de,Fe,J,Y)})}function Vxe(v,T,A,P,Y,J){var Q=AG(P,J),se=A.W;v.push(T,function(de,Fe,Ue){return se(de,Fe,Ue,P,Q)})}function eM(v){var T=v[u0];return T||(T=NG(v,v[u0]=[],Pxe,$xe,Lxe,Vxe),p0 in v&&u0 in v&&(v.length=0),T)}var p0=Symbol();function Bxe(v,T){v[0]=T}function zxe(v,T,A,P){var Y=A.U;v[T]=P?function(J,Q,se){return Y(J,Q,se,P)}:Y}function Uxe(v,T,A,P,Y){var J=A.U,Q=kG(P),se=tM(P).P;v[T]=function(de,Fe,Ue){return J(de,Fe,Ue,se,Q,Y)}}function Gxe(v,T,A,P,Y,J,Q){var se=A.U,de=TG(P,Y,J);v[T]=function(Fe,Ue,Et){return se(Fe,Ue,Et,P,de,Q)}}function tM(v){var T=v[p0];return T||(T=NG(v,v[p0]={},Bxe,zxe,Uxe,Gxe),p0 in v&&u0 in v&&(v.length=0),T)}function RG(v,T,A){for(;hG(T)&&T.i!=4;){var P=T.l,Y=A[P];if(!Y){var J=A[0];J&&(J=J[P])&&(Y=A[P]=Fxe(J))}if(!Y||!Y(T,v,P)){Y=T,P=v,J=Y.j,QS(Y);var Q=Y;if(!Q.ca){if(Y=Q.h.h-J,Q.h.h=J,Q=Q.h,Y==0)Y=i0();else{if(J=uG(Q,Y),Q.S&&Q.m)Y=Q.i.subarray(J,J+Y);else{Q=Q.i;var se=J;Y=J+Y,Y=se===Y?De():dt?Q.slice(se,Y):new Uint8Array(Q.subarray(se,Y))}Y=Y.length==0?i0():new Xl(Y,Me)}(J=P.R)?J.push(Y):P.R=[Y]}}}return v}function OG(v,T,A){for(var P=A.length,Y=P%2==1,J=Y?1:0;J<P;J+=2)(0,A[J+1])(T,v,A[J]);IG(v,T,Y?A[0]:void 0)}function d0(v,T){return{U:v,W:T}}var cc=d0(function(v,T,A){if(v.i!==5)return!1;v=v.h;var P=v.i,Y=v.h,J=P[Y],Q=P[Y+1],se=P[Y+2];return P=P[Y+3],Pm(v,v.h+4),Q=(J<<0|Q<<8|se<<16|P<<24)>>>0,v=2*(Q>>31)+1,J=Q>>>23&255,Q&=8388607,Zl(T,A,J==255?Q?NaN:1/0*v:J==0?v*Math.pow(2,-149)*Q:v*Math.pow(2,J-150)*(Q+Math.pow(2,23))),!0},function(v,T,A){if(T=ZO(T,A),T!=null){$m(v.h,8*A+5),v=v.h;var P=+T;P===0?0<1/P?Be=at=0:(at=0,Be=2147483648):isNaN(P)?(at=0,Be=2147483647):(P=(A=0>P?-2147483648:0)?-P:P,34028234663852886e22<P?(at=0,Be=(A|2139095040)>>>0):11754943508222875e-54>P?(P=Math.round(P/Math.pow(2,-149)),at=0,Be=(A|P)>>>0):(T=Math.floor(Math.log(P)/Math.LN2),P*=Math.pow(2,-T),P=Math.round(8388608*P),16777216<=P&&++T,at=0,Be=(A|T+127<<23|P&8388607)>>>0)),A=Be,v.h.push(A>>>0&255),v.h.push(A>>>8&255),v.h.push(A>>>16&255),v.h.push(A>>>24&255)}}),Wxe=d0(function(v,T,A){if(v.i!==0)return!1;var P=v.h,Y=0,J=v=0,Q=P.i,se=P.h;do{var de=Q[se++];Y|=(de&127)<<J,J+=7}while(32>J&&de&128);for(32<J&&(v|=(de&127)>>4),J=3;32>J&&de&128;J+=7)de=Q[se++],v|=(de&127)<<J;if(Pm(P,se),128>de)P=Y>>>0,de=v>>>0,(v=de&2147483648)&&(P=~P+1>>>0,de=~de>>>0,P==0&&(de=de+1>>>0)),P=4294967296*de+(P>>>0);else throw wn();return Zl(T,A,v?-P:P),!0},function(v,T,A){T=ac(T,A),T!=null&&(typeof T=="string"&&zt(T),T!=null&&($m(v.h,8*A),typeof T=="number"?(v=v.h,_e(T),dG(v,Be,at)):(A=zt(T),dG(v.h,A.i,A.h))))}),jxe=d0(function(v,T,A){return v.i!==0?!1:(Zl(T,A,a0(v.h)),!0)},function(v,T,A){if(T=ac(T,A),T!=null&&T!=null)if($m(v.h,8*A),v=v.h,A=T,0<=A)$m(v,A);else{for(T=0;9>T;T++)v.h.push(A&127|128),A>>=7;v.h.push(1)}}),MG=d0(function(v,T,A){if(v.i!==2)return!1;var P=a0(v.h)>>>0;v=v.h;var Y=uG(v,P);if(v=v.i,Kl){var J=v,Q;(Q=ma)||(Q=ma=new TextDecoder("utf-8",{fatal:!0})),v=Y+P,J=Y===0&&v===J.length?J:J.subarray(Y,v);try{var se=Q.decode(J)}catch(Et){if(Bs===void 0){try{Q.decode(new Uint8Array([128]))}catch{}try{Q.decode(new Uint8Array([97])),Bs=!0}catch{Bs=!1}}throw!Bs&&(ma=void 0),Et}}else{se=Y,P=se+P,Y=[];for(var de=null,Fe,Ue;se<P;)Fe=v[se++],128>Fe?Y.push(Fe):224>Fe?se>=P?zn():(Ue=v[se++],194>Fe||(Ue&192)!==128?(se--,zn()):Y.push((Fe&31)<<6|Ue&63)):240>Fe?se>=P-1?zn():(Ue=v[se++],(Ue&192)!==128||Fe===224&&160>Ue||Fe===237&&160<=Ue||((J=v[se++])&192)!==128?(se--,zn()):Y.push((Fe&15)<<12|(Ue&63)<<6|J&63)):244>=Fe?se>=P-2?zn():(Ue=v[se++],(Ue&192)!==128||(Fe<<28)+(Ue-144)>>30||((J=v[se++])&192)!==128||((Q=v[se++])&192)!==128?(se--,zn()):(Fe=(Fe&7)<<18|(Ue&63)<<12|(J&63)<<6|Q&63,Fe-=65536,Y.push((Fe>>10&1023)+55296,(Fe&1023)+56320))):zn(),8192<=Y.length&&(de=hi(de,Y),Y.length=0);se=hi(de,Y)}return Zl(T,A,se),!0},function(v,T,A){if(T=ac(T,A),T!=null){var P=!1;if(P=P===void 0?!1:P,s0){if(P&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(T))throw Error("Found an unpaired surrogate");T=(sh||(sh=new TextEncoder)).encode(T)}else{for(var Y=0,J=new Uint8Array(3*T.length),Q=0;Q<T.length;Q++){var se=T.charCodeAt(Q);if(128>se)J[Y++]=se;else{if(2048>se)J[Y++]=se>>6|192;else{if(55296<=se&&57343>=se){if(56319>=se&&Q<T.length){var de=T.charCodeAt(++Q);if(56320<=de&&57343>=de){se=1024*(se-55296)+de-56320+65536,J[Y++]=se>>18|240,J[Y++]=se>>12&63|128,J[Y++]=se>>6&63|128,J[Y++]=se&63|128;continue}else Q--}if(P)throw Error("Found an unpaired surrogate");se=65533}J[Y++]=se>>12|224,J[Y++]=se>>6&63|128}J[Y++]=se&63|128}}T=Y===J.length?J:J.subarray(0,Y)}$m(v.h,8*A+2),$m(v.h,T.length),Yy(v,v.h.end()),Yy(v,T)}}),FG=d0(function(v,T,A,P,Y){if(v.i!==2)return!1;T=xG(T,A,P),A=v.h.j,P=a0(v.h)>>>0;var J=v.h.h+P,Q=J-A;if(0>=Q&&(v.h.j=J,Y(T,v,void 0,void 0,void 0),Q=J-v.h.h),Q)throw Error("Message parsing ended unexpectedly. Expected to read "+(P+" bytes, instead read "+(P-Q)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return v.h.h=J,v.h.j=A,!0},function(v,T,A,P,Y){if(T=QO(T,P,A),T!=null)for(P=0;P<T.length;P++){var J=v;$m(J.h,8*A+2);var Q=J.h.end();Yy(J,Q),Q.push(J.i),J=Q,Y(T[P],v),Q=v;var se=J.pop();for(se=Q.i+Q.h.length()-se;127<se;)J.push(se&127|128),se>>>=7,Q.i++;J.push(se),Q.i++}});function rM(v){return function(T,A){e:{if(JS.length){var P=JS.pop();P.setOptions(A),GO(P.h,T,A),T=P}else T=new jO(T,A);try{var Y=tM(v),J=RG(new Y.P,T,Y);break e}finally{Y=T.h,Y.i=null,Y.m=!1,Y.l=0,Y.j=0,Y.h=0,Y.S=!1,T.l=-1,T.i=-1,100>JS.length&&JS.push(T)}J=void 0}return J}}function nM(v){return function(){var T=new Exe;OG(this,T,eM(v)),Yy(T,T.h.end());for(var A=new Uint8Array(T.i),P=T.j,Y=P.length,J=0,Q=0;Q<Y;Q++){var se=P[Q];A.set(se,J),J+=se.length}return T.j=[A],A}}function Zy(v){fi.call(this,v)}g(Zy,fi);var PG=[Zy,1,jxe,2,cc,3,MG,4,MG];Zy.prototype.l=nM(PG);function oM(v){fi.call(this,v,-1,Hxe)}g(oM,fi),oM.prototype.addClassification=function(v,T){return xG(this,1,Zy,v,T),this};var Hxe=[1],qxe=rM([oM,1,FG,PG]);function h0(v){fi.call(this,v)}g(h0,fi);var $G=[h0,1,cc,2,cc,3,cc,4,cc,5,cc];h0.prototype.l=nM($G);function LG(v){fi.call(this,v,-1,Kxe)}g(LG,fi);var Kxe=[1],Xxe=rM([LG,1,FG,$G]);function iI(v){fi.call(this,v)}g(iI,fi);var VG=[iI,1,cc,2,cc,3,cc,4,cc,5,cc,6,Wxe],Yxe=rM(VG);iI.prototype.l=nM(VG);function BG(v,T,A){if(A=v.createShader(A===0?v.VERTEX_SHADER:v.FRAGMENT_SHADER),v.shaderSource(A,T),v.compileShader(A),!v.getShaderParameter(A,v.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+v.getShaderInfoLog(A));return A}function Zxe(v){return QO(v,Zy,1).map(function(T){var A=ac(T,1);return{index:A??0,qa:Jl(T,2),label:ac(T,3)!=null?rI(ac(T,3),""):void 0,displayName:ac(T,4)!=null?rI(ac(T,4),""):void 0}})}function Qxe(v){return{x:Jl(v,1),y:Jl(v,2),z:Jl(v,3),visibility:ZO(v,4)!=null?Jl(v,4):void 0}}function sM(v){return QO(Xxe(v),h0,1).map(Qxe)}function iM(v,T){this.i=v,this.h=T,this.m=0}function zG(v,T,A){return Jxe(v,T),typeof v.h.canvas.transferToImageBitmap=="function"?Promise.resolve(v.h.canvas.transferToImageBitmap()):A?Promise.resolve(v.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(v.h.canvas):(v.j===void 0&&(v.j=document.createElement("canvas")),new Promise(function(P){v.j.height=v.h.canvas.height,v.j.width=v.h.canvas.width,v.j.getContext("2d",{}).drawImage(v.h.canvas,0,0,v.h.canvas.width,v.h.canvas.height),P(v.j)}))}function Jxe(v,T){var A=v.h;if(v.s===void 0){var P=BG(A,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),Y=BG(A,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),J=A.createProgram();if(A.attachShader(J,P),A.attachShader(J,Y),A.linkProgram(J),!A.getProgramParameter(J,A.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+A.getProgramInfoLog(J));P=v.s=J,A.useProgram(P),Y=A.getUniformLocation(P,"sampler0"),v.l={O:A.getAttribLocation(P,"aVertex"),N:A.getAttribLocation(P,"aTex"),ya:Y},v.v=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,v.v),A.enableVertexAttribArray(v.l.O),A.vertexAttribPointer(v.l.O,2,A.FLOAT,!1,0,0),A.bufferData(A.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),A.STATIC_DRAW),A.bindBuffer(A.ARRAY_BUFFER,null),v.u=A.createBuffer(),A.bindBuffer(A.ARRAY_BUFFER,v.u),A.enableVertexAttribArray(v.l.N),A.vertexAttribPointer(v.l.N,2,A.FLOAT,!1,0,0),A.bufferData(A.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),A.STATIC_DRAW),A.bindBuffer(A.ARRAY_BUFFER,null),A.uniform1i(Y,0)}P=v.l,A.useProgram(v.s),A.canvas.width=T.width,A.canvas.height=T.height,A.viewport(0,0,T.width,T.height),A.activeTexture(A.TEXTURE0),v.i.bindTexture2d(T.glName),A.enableVertexAttribArray(P.O),A.bindBuffer(A.ARRAY_BUFFER,v.v),A.vertexAttribPointer(P.O,2,A.FLOAT,!1,0,0),A.enableVertexAttribArray(P.N),A.bindBuffer(A.ARRAY_BUFFER,v.u),A.vertexAttribPointer(P.N,2,A.FLOAT,!1,0,0),A.bindFramebuffer(A.DRAW_FRAMEBUFFER?A.DRAW_FRAMEBUFFER:A.FRAMEBUFFER,null),A.clearColor(0,0,0,0),A.clear(A.COLOR_BUFFER_BIT),A.colorMask(!0,!0,!0,!0),A.drawArrays(A.TRIANGLE_FAN,0,4),A.disableVertexAttribArray(P.O),A.disableVertexAttribArray(P.N),A.bindBuffer(A.ARRAY_BUFFER,null),v.i.bindTexture2d(0)}function eve(v){this.h=v}var tve=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function rve(v,T){return T+v}function UG(v,T){window[v]=T}function nve(v){var T=document.createElement("script");return T.setAttribute("src",v),T.setAttribute("crossorigin","anonymous"),new Promise(function(A){T.addEventListener("load",function(){A()},!1),T.addEventListener("error",function(){A()},!1),document.body.appendChild(T)})}function ove(){return B(function(v){switch(v.h){case 1:return v.s=2,w(v,WebAssembly.instantiate(tve),4);case 4:v.h=3,v.s=0;break;case 2:return v.s=0,v.l=null,v.return(!1);case 3:return v.return(!0)}})}function aM(v){if(this.h=v,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=v&&v.locateFile||rve,typeof window=="object")var T=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")T=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=T,v.options){T=a(Object.keys(v.options));for(var A=T.next();!A.done;A=T.next()){A=A.value;var P=v.options[A].default;P!==void 0&&(this.l[A]=typeof P=="function"?P():P)}}}r=aM.prototype,r.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function sve(v){var T,A,P,Y,J,Q,se,de,Fe,Ue,Et;return B(function(ht){switch(ht.h){case 1:return v.ga?(T=v.h.files===void 0?[]:typeof v.h.files=="function"?v.h.files(v.l):v.h.files,w(ht,ove(),2)):ht.return();case 2:if(A=ht.i,typeof window=="object")return UG("createMediapipeSolutionsWasm",{locateFile:v.locateFile}),UG("createMediapipeSolutionsPackedAssets",{locateFile:v.locateFile}),Q=T.filter(function(Ye){return Ye.data!==void 0}),se=T.filter(function(Ye){return Ye.data===void 0}),de=Promise.all(Q.map(function(Ye){var Nt=aI(v,Ye.url);if(Ye.path!==void 0){var tr=Ye.path;Nt=Nt.then(function(Nn){return v.overrideFile(tr,Nn),Promise.resolve(Nn)})}return Nt})),Fe=Promise.all(se.map(function(Ye){return Ye.simd===void 0||Ye.simd&&A||!Ye.simd&&!A?nve(v.locateFile(Ye.url,v.ha)):Promise.resolve()})).then(function(){var Ye,Nt,tr;return B(function(Nn){if(Nn.h==1)return Ye=window.createMediapipeSolutionsWasm,Nt=window.createMediapipeSolutionsPackedAssets,tr=v,w(Nn,Ye(Nt),2);tr.i=Nn.i,Nn.h=0})}),Ue=function(){return B(function(Ye){return v.h.graph&&v.h.graph.url?Ye=w(Ye,aI(v,v.h.graph.url),0):(Ye.h=0,Ye=void 0),Ye})}(),w(ht,Promise.all([Fe,de,Ue]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return P=T.filter(function(Ye){return Ye.simd===void 0||Ye.simd&&A||!Ye.simd&&!A}).map(function(Ye){return v.locateFile(Ye.url,v.ha)}),importScripts.apply(null,c(P)),Y=v,w(ht,createMediapipeSolutionsWasm(Module),6);case 6:Y.i=ht.i,v.m=new OffscreenCanvas(1,1),v.i.canvas=v.m,J=v.i.GL.createContext(v.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),v.i.GL.makeContextCurrent(J),ht.h=4;break;case 7:if(v.m=document.createElement("canvas"),Et=v.m.getContext("webgl2",{}),!Et&&(Et=v.m.getContext("webgl",{}),!Et))return alert("Failed to create WebGL canvas context when passing video frame."),ht.return();v.K=Et,v.i.canvas=v.m,v.i.createContext(v.m,!0,!0,{});case 4:v.j=new v.i.SolutionWasm,v.ga=!1,ht.h=0}})}function ive(v){var T,A,P,Y,J,Q,se,de;return B(function(Fe){if(Fe.h==1){if(v.h.graph&&v.h.graph.url&&v.fa===v.h.graph.url)return Fe.return();if(v.u=!0,!v.h.graph||!v.h.graph.url){Fe.h=2;return}return v.fa=v.h.graph.url,w(Fe,aI(v,v.h.graph.url),3)}for(Fe.h!=2&&(T=Fe.i,v.j.loadGraph(T)),A=a(Object.keys(v.D)),P=A.next();!P.done;P=A.next())Y=P.value,v.j.overrideFile(Y,v.D[Y]);if(v.D={},v.h.listeners)for(J=a(v.h.listeners),Q=J.next();!Q.done;Q=J.next())se=Q.value,uve(v,se);de=v.l,v.l={},v.setOptions(de),Fe.h=0})}r.reset=function(){var v=this;return B(function(T){v.j&&(v.j.reset(),v.s={},v.v={}),T.h=0})},r.setOptions=function(v,T){var A=this;if(T=T||this.h.options){for(var P=[],Y=[],J={},Q=a(Object.keys(v)),se=Q.next();!se.done;J={X:J.X,Y:J.Y},se=Q.next())if(se=se.value,!(se in this.l&&this.l[se]===v[se])){this.l[se]=v[se];var de=T[se];de!==void 0&&(de.onChange&&(J.X=de.onChange,J.Y=v[se],P.push(function(Fe){return function(){var Ue;return B(function(Et){if(Et.h==1)return w(Et,Fe.X(Fe.Y),2);Ue=Et.i,Ue===!0&&(A.u=!0),Et.h=0})}}(J))),de.graphOptionXref&&(se=Object.assign({},{calculatorName:"",calculatorIndex:0},de.graphOptionXref,{valueNumber:de.type===1?v[se]:0,valueBoolean:de.type===0?v[se]:!1,valueString:de.type===2?v[se]:""}),Y.push(se)))}(P.length!==0||Y.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(Y),this.F=(this.F===void 0?[]:this.F).concat(P))}};function ave(v){var T,A,P,Y,J,Q,se;return B(function(de){switch(de.h){case 1:if(!v.u)return de.return();if(!v.F){de.h=2;break}T=a(v.F),A=T.next();case 3:if(A.done){de.h=5;break}return P=A.value,w(de,P(),4);case 4:A=T.next(),de.h=3;break;case 5:v.F=void 0;case 2:if(v.H){for(Y=new v.i.GraphOptionChangeRequestList,J=a(v.H),Q=J.next();!Q.done;Q=J.next())se=Q.value,Y.push_back(se);v.j.changeOptions(Y),Y.delete(),v.H=void 0}v.u=!1,de.h=0}})}r.initialize=function(){var v=this;return B(function(T){return T.h==1?w(T,sve(v),2):T.h!=3?w(T,ive(v),3):w(T,ave(v),0)})};function aI(v,T){var A,P;return B(function(Y){return T in v.L?Y.return(v.L[T]):(A=v.locateFile(T,""),P=fetch(A).then(function(J){return J.arrayBuffer()}),v.L[T]=P,Y.return(P))})}r.overrideFile=function(v,T){this.j?this.j.overrideFile(v,T):this.D[v]=T},r.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},r.send=function(v,T){var A=this,P,Y,J,Q,se,de,Fe,Ue,Et;return B(function(ht){switch(ht.h){case 1:return A.h.inputs?(P=1e3*(T??performance.now()),w(ht,A.I,2)):ht.return();case 2:return w(ht,A.initialize(),3);case 3:for(Y=new A.i.PacketDataList,J=a(Object.keys(v)),Q=J.next();!Q.done;Q=J.next())if(se=Q.value,de=A.h.inputs[se]){e:{var Ye=v[se];switch(de.type){case"video":var Nt=A.s[de.stream];if(Nt||(Nt=new iM(A.i,A.K),A.s[de.stream]=Nt),Nt.m===0&&(Nt.m=Nt.i.createTexture()),typeof HTMLVideoElement<"u"&&Ye instanceof HTMLVideoElement)var tr=Ye.videoWidth,Nn=Ye.videoHeight;else typeof HTMLImageElement<"u"&&Ye instanceof HTMLImageElement?(tr=Ye.naturalWidth,Nn=Ye.naturalHeight):(tr=Ye.width,Nn=Ye.height);Nn={glName:Nt.m,width:tr,height:Nn},tr=Nt.h,tr.canvas.width=Nn.width,tr.canvas.height=Nn.height,tr.activeTexture(tr.TEXTURE0),Nt.i.bindTexture2d(Nt.m),tr.texImage2D(tr.TEXTURE_2D,0,tr.RGBA,tr.RGBA,tr.UNSIGNED_BYTE,Ye),Nt.i.bindTexture2d(0),Nt=Nn;break e;case"detections":for(Nt=A.s[de.stream],Nt||(Nt=new eve(A.i),A.s[de.stream]=Nt),Nt.data||(Nt.data=new Nt.h.DetectionListData),Nt.data.reset(Ye.length),Nn=0;Nn<Ye.length;++Nn){tr=Ye[Nn];var Cn=Nt.data,ns=Cn.setBoundingBox,ga=Nn,mi=tr.la,Fr=new iI;if(Ql(Fr,1,mi.sa),Ql(Fr,2,mi.ta),Ql(Fr,3,mi.height),Ql(Fr,4,mi.width),Ql(Fr,5,mi.rotation),Zl(Fr,6,mi.pa),mi=Fr.l(),ns.call(Cn,ga,mi),tr.ea)for(Cn=0;Cn<tr.ea.length;++Cn){Fr=tr.ea[Cn],ns=Nt.data,ga=ns.addNormalizedLandmark,mi=Nn,Fr=Object.assign({},Fr,{visibility:Fr.visibility?Fr.visibility:0});var os=new h0;Ql(os,1,Fr.x),Ql(os,2,Fr.y),Ql(os,3,Fr.z),Fr.visibility&&Ql(os,4,Fr.visibility),Fr=os.l(),ga.call(ns,mi,Fr)}if(tr.ba)for(Cn=0;Cn<tr.ba.length;++Cn)ns=Nt.data,ga=ns.addClassification,mi=Nn,Fr=tr.ba[Cn],os=new Zy,Ql(os,2,Fr.qa),Fr.index&&Zl(os,1,Fr.index),Fr.label&&Zl(os,3,Fr.label),Fr.displayName&&Zl(os,4,Fr.displayName),Fr=os.l(),ga.call(ns,mi,Fr)}Nt=Nt.data;break e;default:Nt={}}}switch(Fe=Nt,Ue=de.stream,de.type){case"video":Y.pushTexture2d(Object.assign({},Fe,{stream:Ue,timestamp:P}));break;case"detections":Et=Fe,Et.stream=Ue,Et.timestamp=P,Y.pushDetectionList(Et);break;default:throw Error("Unknown input config type: '"+de.type+"'")}}return A.j.send(Y),w(ht,A.I,4);case 4:Y.delete(),ht.h=0}})};function cve(v,T,A){var P,Y,J,Q,se,de,Fe,Ue,Et,ht,Ye,Nt,tr,Nn;return B(function(Cn){switch(Cn.h){case 1:if(!A)return Cn.return(T);for(P={},Y=0,J=a(Object.keys(A)),Q=J.next();!Q.done;Q=J.next())se=Q.value,de=A[se],typeof de!="string"&&de.type==="texture"&&T[de.stream]!==void 0&&++Y;1<Y&&(v.M=!1),Fe=a(Object.keys(A)),Q=Fe.next();case 2:if(Q.done){Cn.h=4;break}if(Ue=Q.value,Et=A[Ue],typeof Et=="string")return tr=P,Nn=Ue,w(Cn,lve(v,Ue,T[Et]),14);if(ht=T[Et.stream],Et.type==="detection_list"){if(ht){for(var ns=ht.getRectList(),ga=ht.getLandmarksList(),mi=ht.getClassificationsList(),Fr=[],os=0;os<ns.size();++os){var ih=Yxe(ns.get(os)),pve=Jl(ih,1),dve=Jl(ih,2),hve=Jl(ih,3),fve=Jl(ih,4),mve=Jl(ih,5,0),cI=void 0;cI=cI===void 0?0:cI,ih={la:{sa:pve,ta:dve,height:hve,width:fve,rotation:mve,pa:rI(ac(ih,6),cI)},ea:sM(ga.get(os)),ba:Zxe(qxe(mi.get(os)))},Fr.push(ih)}ns=Fr}else ns=[];P[Ue]=ns,Cn.h=7;break}if(Et.type==="proto_list"){if(ht){for(ns=Array(ht.size()),ga=0;ga<ht.size();ga++)ns[ga]=ht.get(ga);ht.delete()}else ns=[];P[Ue]=ns,Cn.h=7;break}if(ht===void 0){Cn.h=3;break}if(Et.type==="float_list"){P[Ue]=ht,Cn.h=7;break}if(Et.type==="proto"){P[Ue]=ht,Cn.h=7;break}if(Et.type!=="texture")throw Error("Unknown output config type: '"+Et.type+"'");return Ye=v.v[Ue],Ye||(Ye=new iM(v.i,v.K),v.v[Ue]=Ye),w(Cn,zG(Ye,ht,v.M),13);case 13:Nt=Cn.i,P[Ue]=Nt;case 7:Et.transform&&P[Ue]&&(P[Ue]=Et.transform(P[Ue])),Cn.h=3;break;case 14:tr[Nn]=Cn.i;case 3:Q=Fe.next(),Cn.h=2;break;case 4:return Cn.return(P)}})}function lve(v,T,A){var P;return B(function(Y){return typeof A=="number"||A instanceof Uint8Array||A instanceof v.i.Uint8BlobList?Y.return(A):A instanceof v.i.Texture2dDataOut?(P=v.v[T],P||(P=new iM(v.i,v.K),v.v[T]=P),Y.return(zG(P,A,v.M))):Y.return(void 0)})}function uve(v,T){for(var A=T.name||"$",P=[].concat(c(T.wants)),Y=new v.i.StringList,J=a(T.wants),Q=J.next();!Q.done;Q=J.next())Y.push_back(Q.value);J=v.i.PacketListener.implement({onResults:function(se){for(var de={},Fe=0;Fe<T.wants.length;++Fe)de[P[Fe]]=se.get(Fe);var Ue=v.listeners[A];Ue&&(v.I=cve(v,de,T.outs).then(function(Et){Et=Ue(Et);for(var ht=0;ht<T.wants.length;++ht){var Ye=de[P[ht]];typeof Ye=="object"&&Ye.hasOwnProperty&&Ye.hasOwnProperty("delete")&&Ye.delete()}Et&&(v.I=Et)}))}}),v.j.attachMultiListener(Y,J),Y.delete()}r.onResults=function(v,T){this.listeners[T||"$"]=v},G("Solution",aM),G("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function GG(v){switch(v===void 0&&(v=0),v){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function WG(v){var T=this;v=v||{},this.h=new aM({locateFile:v.locateFile,files:function(A){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:GG(A.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:sM},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:sM},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(A){var P,Y,J;return B(function(Q){return Q.h==1?(P=GG(A),Y="third_party/mediapipe/modules/pose_landmark/"+P,w(Q,aI(T.h,P),2)):(J=Q.i,T.h.overrideFile(Y,J),Q.return(!0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}r=WG.prototype,r.reset=function(){this.h.reset()},r.close=function(){return this.h.close(),Promise.resolve()},r.onResults=function(v){this.h.onResults(v)},r.initialize=function(){var v=this;return B(function(T){return w(T,v.h.initialize(),0)})},r.send=function(v,T){var A=this;return B(function(P){return w(P,A.h.send(v,T),0)})},r.setOptions=function(v){this.h.setOptions(v)},G("Pose",WG),G("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),G("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),G("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),G("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),G("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),G("VERSION","0.5.1675469404")}).call(iK)});var NK=Sr(($it,EK)=>{"use strict";EK.exports=Sn;var Ma=null;try{Ma=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Sn(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Sn.prototype.__isLong__;Object.defineProperty(Sn.prototype,"__isLong__",{value:!0});function Ni(r){return(r&&r.__isLong__)===!0}Sn.isLong=Ni;var vK={},bK={};function Vg(r,e){var t,n,o;return e?(r>>>=0,(o=0<=r&&r<256)&&(n=bK[r],n)?n:(t=In(r,(r|0)<0?-1:0,!0),o&&(bK[r]=t),t)):(r|=0,(o=-128<=r&&r<128)&&(n=vK[r],n)?n:(t=In(r,r<0?-1:0,!1),o&&(vK[r]=t),t))}Sn.fromInt=Vg;function Fa(r,e){if(isNaN(r))return e?Lg:Pa;if(e){if(r<0)return Lg;if(r>=SK)return kK}else{if(r<=-CK)return Ei;if(r+1>=CK)return TK}return r<0?Fa(-r,e).neg():In(r%Dv|0,r/Dv|0,e)}Sn.fromNumber=Fa;function In(r,e,t){return new Sn(r,e,t)}Sn.fromBits=In;var ck=Math.pow;function XL(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Pa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return XL(r.substring(1),e,t).neg();for(var o=Fa(ck(t,8)),s=Pa,i=0;i<r.length;i+=8){var a=Math.min(8,r.length-i),c=parseInt(r.substring(i,i+a),t);if(a<8){var l=Fa(ck(t,a));s=s.mul(l).add(Fa(c))}else s=s.mul(o),s=s.add(Fa(c))}return s.unsigned=e,s}Sn.fromString=XL;function yl(r,e){return typeof r=="number"?Fa(r,e):typeof r=="string"?XL(r,e):In(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Sn.fromValue=yl;var wK=65536,VEe=1<<24,Dv=wK*wK,SK=Dv*Dv,CK=SK/2,_K=Vg(VEe),Pa=Vg(0);Sn.ZERO=Pa;var Lg=Vg(0,!0);Sn.UZERO=Lg;var Nv=Vg(1);Sn.ONE=Nv;var IK=Vg(1,!0);Sn.UONE=IK;var KL=Vg(-1);Sn.NEG_ONE=KL;var TK=In(-1,2147483647,!1);Sn.MAX_VALUE=TK;var kK=In(-1,-1,!0);Sn.MAX_UNSIGNED_VALUE=kK;var Ei=In(0,-2147483648,!1);Sn.MIN_VALUE=Ei;var Ge=Sn.prototype;Ge.toInt=function(){return this.unsigned?this.low>>>0:this.low};Ge.toNumber=function(){return this.unsigned?(this.high>>>0)*Dv+(this.low>>>0):this.high*Dv+(this.low>>>0)};Ge.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ei)){var t=Fa(e),n=this.div(t),o=n.mul(t).sub(this);return n.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Fa(ck(e,6),this.unsigned),i=this,a="";;){var c=i.div(s),l=i.sub(c.mul(s)).toInt()>>>0,u=l.toString(e);if(i=c,i.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};Ge.getHighBits=function(){return this.high};Ge.getHighBitsUnsigned=function(){return this.high>>>0};Ge.getLowBits=function(){return this.low};Ge.getLowBitsUnsigned=function(){return this.low>>>0};Ge.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ei)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};Ge.isZero=function(){return this.high===0&&this.low===0};Ge.eqz=Ge.isZero;Ge.isNegative=function(){return!this.unsigned&&this.high<0};Ge.isPositive=function(){return this.unsigned||this.high>=0};Ge.isOdd=function(){return(this.low&1)===1};Ge.isEven=function(){return(this.low&1)===0};Ge.equals=function(e){return Ni(e)||(e=yl(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Ge.eq=Ge.equals;Ge.notEquals=function(e){return!this.eq(e)};Ge.neq=Ge.notEquals;Ge.ne=Ge.notEquals;Ge.lessThan=function(e){return this.comp(e)<0};Ge.lt=Ge.lessThan;Ge.lessThanOrEqual=function(e){return this.comp(e)<=0};Ge.lte=Ge.lessThanOrEqual;Ge.le=Ge.lessThanOrEqual;Ge.greaterThan=function(e){return this.comp(e)>0};Ge.gt=Ge.greaterThan;Ge.greaterThanOrEqual=function(e){return this.comp(e)>=0};Ge.gte=Ge.greaterThanOrEqual;Ge.ge=Ge.greaterThanOrEqual;Ge.compare=function(e){if(Ni(e)||(e=yl(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Ge.comp=Ge.compare;Ge.negate=function(){return!this.unsigned&&this.eq(Ei)?Ei:this.not().add(Nv)};Ge.neg=Ge.negate;Ge.add=function(e){Ni(e)||(e=yl(e));var t=this.high>>>16,n=this.high&65535,o=this.low>>>16,s=this.low&65535,i=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,p=0,d=0,h=0;return h+=s+l,d+=h>>>16,h&=65535,d+=o+c,p+=d>>>16,d&=65535,p+=n+a,u+=p>>>16,p&=65535,u+=t+i,u&=65535,In(d<<16|h,u<<16|p,this.unsigned)};Ge.subtract=function(e){return Ni(e)||(e=yl(e)),this.add(e.neg())};Ge.sub=Ge.subtract;Ge.multiply=function(e){if(this.isZero())return Pa;if(Ni(e)||(e=yl(e)),Ma){var t=Ma.mul(this.low,this.high,e.low,e.high);return In(t,Ma.get_high(),this.unsigned)}if(e.isZero())return Pa;if(this.eq(Ei))return e.isOdd()?Ei:Pa;if(e.eq(Ei))return this.isOdd()?Ei:Pa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(_K)&&e.lt(_K))return Fa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,s=this.low>>>16,i=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,p=0,d=0,h=0,f=0;return f+=i*u,h+=f>>>16,f&=65535,h+=s*u,d+=h>>>16,h&=65535,h+=i*l,d+=h>>>16,h&=65535,d+=o*u,p+=d>>>16,d&=65535,d+=s*l,p+=d>>>16,d&=65535,d+=i*c,p+=d>>>16,d&=65535,p+=n*u+o*l+s*c+i*a,p&=65535,In(h<<16|f,p<<16|d,this.unsigned)};Ge.mul=Ge.multiply;Ge.divide=function(e){if(Ni(e)||(e=yl(e)),e.isZero())throw Error("division by zero");if(Ma){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ma.div_u:Ma.div_s)(this.low,this.high,e.low,e.high);return In(t,Ma.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Lg:Pa;var n,o,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Lg;if(e.gt(this.shru(1)))return IK;s=Lg}else{if(this.eq(Ei)){if(e.eq(Nv)||e.eq(KL))return Ei;if(e.eq(Ei))return Nv;var i=this.shr(1);return n=i.div(e).shl(1),n.eq(Pa)?e.isNegative()?Nv:KL:(o=this.sub(e.mul(n)),s=n.add(o.div(e)),s)}else if(e.eq(Ei))return this.unsigned?Lg:Pa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Pa}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),c=a<=48?1:ck(2,a-48),l=Fa(n),u=l.mul(e);u.isNegative()||u.gt(o);)n-=c,l=Fa(n,this.unsigned),u=l.mul(e);l.isZero()&&(l=Nv),s=s.add(l),o=o.sub(u)}return s};Ge.div=Ge.divide;Ge.modulo=function(e){if(Ni(e)||(e=yl(e)),Ma){var t=(this.unsigned?Ma.rem_u:Ma.rem_s)(this.low,this.high,e.low,e.high);return In(t,Ma.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Ge.mod=Ge.modulo;Ge.rem=Ge.modulo;Ge.not=function(){return In(~this.low,~this.high,this.unsigned)};Ge.and=function(e){return Ni(e)||(e=yl(e)),In(this.low&e.low,this.high&e.high,this.unsigned)};Ge.or=function(e){return Ni(e)||(e=yl(e)),In(this.low|e.low,this.high|e.high,this.unsigned)};Ge.xor=function(e){return Ni(e)||(e=yl(e)),In(this.low^e.low,this.high^e.high,this.unsigned)};Ge.shiftLeft=function(e){return Ni(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?In(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):In(0,this.low<<e-32,this.unsigned)};Ge.shl=Ge.shiftLeft;Ge.shiftRight=function(e){return Ni(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?In(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):In(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Ge.shr=Ge.shiftRight;Ge.shiftRightUnsigned=function(e){if(Ni(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return In(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?In(t,0,this.unsigned):In(t>>>e-32,0,this.unsigned)};Ge.shru=Ge.shiftRightUnsigned;Ge.shr_u=Ge.shiftRightUnsigned;Ge.toSigned=function(){return this.unsigned?In(this.low,this.high,!1):this};Ge.toUnsigned=function(){return this.unsigned?this:In(this.low,this.high,!0)};Ge.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Ge.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Ge.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Sn.fromBytes=function(e,t,n){return n?Sn.fromBytesLE(e,t):Sn.fromBytesBE(e,t)};Sn.fromBytesLE=function(e,t){return new Sn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Sn.fromBytesBE=function(e,t){return new Sn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var v8=Sr((Vv,x8)=>{"use strict";var INe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},qg=INe();x8.exports=Vv=qg.fetch;qg.fetch&&(Vv.default=qg.fetch.bind(qg));Vv.Headers=qg.Headers;Vv.Request=qg.Request;Vv.Response=qg.Response});var b8=Sr(()=>{"use strict"});var X8=Sr((K8,C3)=>{"use strict";(function(r,e,t){function n(a){var c=this,l=i();c.next=function(){var u=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=u-(c.c=u|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(a),c.s0<0&&(c.s0+=1),c.s1-=l(a),c.s1<0&&(c.s1+=1),c.s2-=l(a),c.s2<0&&(c.s2+=1),l=null}function o(a,c){return c.c=a.c,c.s0=a.s0,c.s1=a.s1,c.s2=a.s2,c}function s(a,c){var l=new n(a),u=c&&c.state,p=l.next;return p.int32=function(){return l.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,u&&(typeof u=="object"&&o(u,l),p.state=function(){return o(l,{})}),p}function i(){var a=4022871197,c=function(l){l=String(l);for(var u=0;u<l.length;u++){a+=l.charCodeAt(u);var p=.02519603282416938*a;a=p>>>0,p-=a,p*=a,a=p>>>0,p-=a,a+=p*4294967296}return(a>>>0)*23283064365386963e-26};return c}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.alea=s})(K8,typeof C3=="object"&&C3,typeof define=="function"&&define)});var Z8=Sr((Y8,_3)=>{"use strict";(function(r,e,t){function n(i){var a=this,c="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},i===(i|0)?a.x=i:c+=i;for(var l=0;l<c.length+64;l++)a.x^=c.charCodeAt(l)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var c=new n(i),l=a&&a.state,u=function(){return(c.next()>>>0)/4294967296};return u.double=function(){do var p=c.next()>>>11,d=(c.next()>>>0)/4294967296,h=(p+d)/(1<<21);while(h===0);return h},u.int32=c.next,u.quick=u,l&&(typeof l=="object"&&o(l,c),u.state=function(){return o(c,{})}),u}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.xor128=s})(Y8,typeof _3=="object"&&_3,typeof define=="function"&&define)});var J8=Sr((Q8,S3)=>{"use strict";(function(r,e,t){function n(i){var a=this,c="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:c+=i;for(var l=0;l<c.length+64;l++)a.x^=c.charCodeAt(l)|0,l==c.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var c=new n(i),l=a&&a.state,u=function(){return(c.next()>>>0)/4294967296};return u.double=function(){do var p=c.next()>>>11,d=(c.next()>>>0)/4294967296,h=(p+d)/(1<<21);while(h===0);return h},u.int32=c.next,u.quick=u,l&&(typeof l=="object"&&o(l,c),u.state=function(){return o(c,{})}),u}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.xorwow=s})(Q8,typeof S3=="object"&&S3,typeof define=="function"&&define)});var tX=Sr((eX,I3)=>{"use strict";(function(r,e,t){function n(i){var a=this;a.next=function(){var l=a.x,u=a.i,p,d,h;return p=l[u],p^=p>>>7,d=p^p<<24,p=l[u+1&7],d^=p^p>>>10,p=l[u+3&7],d^=p^p>>>3,p=l[u+4&7],d^=p^p<<7,p=l[u+7&7],p=p^p<<13,d^=p^p<<9,l[u]=d,a.i=u+1&7,d};function c(l,u){var p,d,h=[];if(u===(u|0))d=h[0]=u;else for(u=""+u,p=0;p<u.length;++p)h[p&7]=h[p&7]<<15^u.charCodeAt(p)+h[p+1&7]<<13;for(;h.length<8;)h.push(0);for(p=0;p<8&&h[p]===0;++p);for(p==8?d=h[7]=-1:d=h[p],l.x=h,l.i=0,p=256;p>0;--p)l.next()}c(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var c=new n(i),l=a&&a.state,u=function(){return(c.next()>>>0)/4294967296};return u.double=function(){do var p=c.next()>>>11,d=(c.next()>>>0)/4294967296,h=(p+d)/(1<<21);while(h===0);return h},u.int32=c.next,u.quick=u,l&&(l.x&&o(l,c),u.state=function(){return o(c,{})}),u}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.xorshift7=s})(eX,typeof I3=="object"&&I3,typeof define=="function"&&define)});var nX=Sr((rX,T3)=>{"use strict";(function(r,e,t){function n(i){var a=this;a.next=function(){var l=a.w,u=a.X,p=a.i,d,h;return a.w=l=l+1640531527|0,h=u[p+34&127],d=u[p=p+1&127],h^=h<<13,d^=d<<17,h^=h>>>15,d^=d>>>12,h=u[p]=h^d,a.i=p,h+(l^l>>>16)|0};function c(l,u){var p,d,h,f,m,g=[],y=128;for(u===(u|0)?(d=u,u=null):(u=u+"\0",d=0,y=Math.max(y,u.length)),h=0,f=-32;f<y;++f)u&&(d^=u.charCodeAt((f+32)%u.length)),f===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,f>=0&&(m=m+1640531527|0,p=g[f&127]^=d+m,h=p==0?h+1:0);for(h>=128&&(g[(u&&u.length||0)&127]=-1),h=127,f=4*128;f>0;--f)d=g[h+34&127],p=g[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,g[h]=d^p;l.w=m,l.X=g,l.i=h}c(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var c=new n(i),l=a&&a.state,u=function(){return(c.next()>>>0)/4294967296};return u.double=function(){do var p=c.next()>>>11,d=(c.next()>>>0)/4294967296,h=(p+d)/(1<<21);while(h===0);return h},u.int32=c.next,u.quick=u,l&&(l.X&&o(l,c),u.state=function(){return o(c,{})}),u}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.xor4096=s})(rX,typeof T3=="object"&&T3,typeof define=="function"&&define)});var sX=Sr((oX,k3)=>{"use strict";(function(r,e,t){function n(i){var a=this,c="";a.next=function(){var u=a.b,p=a.c,d=a.d,h=a.a;return u=u<<25^u>>>7^p,p=p-d|0,d=d<<24^d>>>8^h,h=h-u|0,a.b=u=u<<20^u>>>12^p,a.c=p=p-d|0,a.d=d<<16^p>>>16^h,a.a=h-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):c+=i;for(var l=0;l<c.length+20;l++)a.b^=c.charCodeAt(l)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var c=new n(i),l=a&&a.state,u=function(){return(c.next()>>>0)/4294967296};return u.double=function(){do var p=c.next()>>>11,d=(c.next()>>>0)/4294967296,h=(p+d)/(1<<21);while(h===0);return h},u.int32=c.next,u.quick=u,l&&(typeof l=="object"&&o(l,c),u.state=function(){return o(c,{})}),u}e&&e.exports?e.exports=s:t&&t.amd?t(function(){return s}):this.tychei=s})(oX,typeof k3=="object"&&k3,typeof define=="function"&&define)});var iX=Sr(()=>{"use strict"});var cX=Sr((aX,aE)=>{"use strict";(function(r,e,t){var n=256,o=6,s=52,i="random",a=t.pow(n,o),c=t.pow(2,s),l=c*2,u=n-1,p;function d(b,w,_){var I=[];w=w==!0?{entropy:!0}:w||{};var S=g(m(w.entropy?[b,x(e)]:b??y(),3),I),k=new h(I),R=function(){for(var L=k.g(o),B=a,z=0;L<c;)L=(L+z)*n,B*=n,z=k.g(1);for(;L>=l;)L/=2,B/=2,z>>>=1;return(L+z)/B};return R.int32=function(){return k.g(4)|0},R.quick=function(){return k.g(4)/4294967296},R.double=R,g(x(k.S),e),(w.pass||_||function(L,B,z,q){return q&&(q.S&&f(q,k),L.state=function(){return f(k,{})}),z?(t[i]=L,B):L})(R,S,"global"in w?w.global:this==t,w.state)}function h(b){var w,_=b.length,I=this,S=0,k=I.i=I.j=0,R=I.S=[];for(_||(b=[_++]);S<n;)R[S]=S++;for(S=0;S<n;S++)R[S]=R[k=u&k+b[S%_]+(w=R[S])],R[k]=w;(I.g=function(L){for(var B,z=0,q=I.i,U=I.j,G=I.S;L--;)B=G[q=u&q+1],z=z*n+G[u&(G[q]=G[U=u&U+B])+(G[U]=B)];return I.i=q,I.j=U,z})(n)}function f(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function m(b,w){var _=[],I=typeof b,S;if(w&&I=="object")for(S in b)try{_.push(m(b[S],w-1))}catch{}return _.length?_:I=="string"?b:b+"\0"}function g(b,w){for(var _=b+"",I,S=0;S<_.length;)w[u&S]=u&(I^=w[u&S]*19)+_.charCodeAt(S++);return x(w)}function y(){try{var b;return p&&(b=p.randomBytes)?b=b(n):(b=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(b)),x(b)}catch{var w=r.navigator,_=w&&w.plugins;return[+new Date,r,_,r.screen,x(e)]}}function x(b){return String.fromCharCode.apply(0,b)}if(g(t.random(),e),typeof aE=="object"&&aE.exports){aE.exports=d;try{p=iX()}catch{}}else typeof define=="function"&&define.amd?define(function(){return d}):t["seed"+i]=d})(typeof self<"u"?self:aX,[],Math)});var c_=Sr((_Ct,lX)=>{"use strict";var uRe=X8(),pRe=Z8(),dRe=J8(),hRe=tX(),fRe=nX(),mRe=sX(),ey=cX();ey.alea=uRe;ey.xor128=pRe;ey.xorwow=dRe;ey.xorshift7=hRe;ey.xor4096=fRe;ey.tychei=mRe;lX.exports=ey});var _he=Sr((Tan,xS)=>{"use strict";function zKe(r){if(Array.isArray(r))return r}xS.exports=zKe,xS.exports.__esModule=!0,xS.exports.default=xS.exports});var She=Sr((kan,vS)=>{"use strict";function UKe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,o,s,i,a=[],c=!0,l=!1;try{if(s=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=s.call(t)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(u){l=!0,o=u}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}vS.exports=UKe,vS.exports.__esModule=!0,vS.exports.default=vS.exports});var Ihe=Sr((Ean,bS)=>{"use strict";function GKe(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}bS.exports=GKe,bS.exports.__esModule=!0,bS.exports.default=bS.exports});var khe=Sr((Nan,wS)=>{"use strict";var The=Ihe();function WKe(r,e){if(r){if(typeof r=="string")return The(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?The(r,e):void 0}}wS.exports=WKe,wS.exports.__esModule=!0,wS.exports.default=wS.exports});var Ehe=Sr((Dan,CS)=>{"use strict";function jKe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}CS.exports=jKe,CS.exports.__esModule=!0,CS.exports.default=CS.exports});var Nhe=Sr((Aan,_S)=>{"use strict";var HKe=_he(),qKe=She(),KKe=khe(),XKe=Ehe();function YKe(r,e){return HKe(r)||qKe(r,e)||KKe(r,e)||XKe()}_S.exports=YKe,_S.exports.__esModule=!0,_S.exports.default=_S.exports});var Dhe=Sr((Ran,SS)=>{"use strict";function ZKe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}SS.exports=ZKe,SS.exports.__esModule=!0,SS.exports.default=SS.exports});var cU=Sr((Oan,Qd)=>{"use strict";function aU(r){"@babel/helpers - typeof";return Qd.exports=aU=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qd.exports.__esModule=!0,Qd.exports.default=Qd.exports,aU(r)}Qd.exports=aU,Qd.exports.__esModule=!0,Qd.exports.default=Qd.exports});var Rhe=Sr((Man,IS)=>{"use strict";var Ahe=cU().default;function QKe(r,e){if(Ahe(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(Ahe(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}IS.exports=QKe,IS.exports.__esModule=!0,IS.exports.default=IS.exports});var Ohe=Sr((Fan,TS)=>{"use strict";var JKe=cU().default,e8e=Rhe();function t8e(r){var e=e8e(r,"string");return JKe(e)=="symbol"?e:e+""}TS.exports=t8e,TS.exports.__esModule=!0,TS.exports.default=TS.exports});var Fhe=Sr((Pan,kS)=>{"use strict";var r8e=Ohe();function Mhe(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,r8e(n.key),n)}}function n8e(r,e,t){return e&&Mhe(r.prototype,e),t&&Mhe(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}kS.exports=n8e,kS.exports.__esModule=!0,kS.exports.default=kS.exports});var lU=Sr((R2,Phe)=>{"use strict";(function(r,e){typeof R2=="object"&&typeof Phe<"u"?e(R2,Nhe(),Dhe(),Fhe()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.automationEvents={},r._slicedToArray,r._classCallCheck,r._createClass))})(R2,function(r,e,t,n){"use strict";var o=function(G,j,X){return{endTime:j,insertTime:X,type:"exponentialRampToValue",value:G}},s=function(G,j,X){return{endTime:j,insertTime:X,type:"linearRampToValue",value:G}},i=function(G,j){return{startTime:j,type:"setValue",value:G}},a=function(G,j,X){return{duration:X,startTime:j,type:"setValueCurve",values:G}},c=function(G,j,X){var te=X.startTime,ne=X.target,oe=X.timeConstant;return ne+(j-ne)*Math.exp((te-G)/oe)},l=function(G){return G.type==="exponentialRampToValue"},u=function(G){return G.type==="linearRampToValue"},p=function(G){return l(G)||u(G)},d=function(G){return G.type==="setValue"},h=function(G){return G.type==="setValueCurve"},f=function(G,j,X,te){var ne=G[j];return ne===void 0?te:p(ne)||d(ne)?ne.value:h(ne)?ne.values[ne.values.length-1]:c(X,f(G,j-1,ne.startTime,te),ne)},m=function(G,j,X,te,ne){return X===void 0?[te.insertTime,ne]:p(X)?[X.endTime,X.value]:d(X)?[X.startTime,X.value]:h(X)?[X.startTime+X.duration,X.values[X.values.length-1]]:[X.startTime,f(G,j-1,X.startTime,ne)]},g=function(G){return G.type==="cancelAndHold"},y=function(G){return G.type==="cancelScheduledValues"},x=function(G){return g(G)||y(G)?G.cancelTime:l(G)||u(G)?G.endTime:G.startTime},b=function(G,j,X,te){var ne=te.endTime,oe=te.value;return X===oe?oe:0<X&&0<oe||X<0&&oe<0?X*Math.pow(oe/X,(G-j)/(ne-j)):0},w=function(G,j,X,te){var ne=te.endTime,oe=te.value;return X+(G-j)/(ne-j)*(oe-X)},_=function(G,j){var X=Math.floor(j),te=Math.ceil(j);return X===te?G[X]:(1-(j-X))*G[X]+(1-(te-j))*G[te]},I=function(G,j){var X=j.duration,te=j.startTime,ne=j.values,oe=(G-te)/X*(ne.length-1);return _(ne,oe)},S=function(G){return G.type==="setTarget"},k=function(){function U(G){t(this,U),this._automationEvents=[],this._currenTime=0,this._defaultValue=G}return n(U,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(j){var X=x(j);if(g(j)||y(j)){var te=this._automationEvents.findIndex(function(_e){return y(j)&&h(_e)?_e.startTime+_e.duration>=X:x(_e)>=X}),ne=this._automationEvents[te];if(te!==-1&&(this._automationEvents=this._automationEvents.slice(0,te)),g(j)){var oe=this._automationEvents[this._automationEvents.length-1];if(ne!==void 0&&p(ne)){if(oe!==void 0&&S(oe))throw new Error("The internal list is malformed.");var le=oe===void 0?ne.insertTime:h(oe)?oe.startTime+oe.duration:x(oe),xe=oe===void 0?this._defaultValue:h(oe)?oe.values[oe.values.length-1]:oe.value,ge=l(ne)?b(X,le,xe,ne):w(X,le,xe,ne),Re=l(ne)?o(ge,X,this._currenTime):s(ge,X,this._currenTime);this._automationEvents.push(Re)}if(oe!==void 0&&S(oe)&&this._automationEvents.push(i(this.getValue(X),X)),oe!==void 0&&h(oe)&&oe.startTime+oe.duration>X){var Ee=X-oe.startTime,Ne=(oe.values.length-1)/oe.duration,we=Math.max(2,1+Math.ceil(Ee*Ne)),qe=Ee/(we-1)*Ne,Qe=oe.values.slice(0,we);if(qe<1)for(var De=1;De<we;De+=1){var Me=qe*De%1;Qe[De]=oe.values[De-1]*(1-Me)+oe.values[De]*Me}this._automationEvents[this._automationEvents.length-1]=a(Qe,oe.startTime,Ee)}}}else{var dt=this._automationEvents.findIndex(function(_e){return x(_e)>X}),Be=dt===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[dt-1];if(Be!==void 0&&h(Be)&&x(Be)+Be.duration>X)return!1;var at=l(j)?o(j.value,j.endTime,this._currenTime):u(j)?s(j.value,X,this._currenTime):j;if(dt===-1)this._automationEvents.push(at);else{if(h(j)&&X+j.duration>x(this._automationEvents[dt]))return!1;this._automationEvents.splice(dt,0,at)}}return!0}},{key:"flush",value:function(j){var X=this._automationEvents.findIndex(function(oe){return x(oe)>j});if(X>1){var te=this._automationEvents.slice(X-1),ne=te[0];S(ne)&&te.unshift(i(f(this._automationEvents,X-2,ne.startTime,this._defaultValue),ne.startTime)),this._automationEvents=te}}},{key:"getValue",value:function(j){if(this._automationEvents.length===0)return this._defaultValue;var X=this._automationEvents.findIndex(function(Qe){return x(Qe)>j}),te=this._automationEvents[X],ne=(X===-1?this._automationEvents.length:X)-1,oe=this._automationEvents[ne];if(oe!==void 0&&S(oe)&&(te===void 0||!p(te)||te.insertTime>j))return c(j,f(this._automationEvents,ne-1,oe.startTime,this._defaultValue),oe);if(oe!==void 0&&d(oe)&&(te===void 0||!p(te)))return oe.value;if(oe!==void 0&&h(oe)&&(te===void 0||!p(te)||oe.startTime+oe.duration>j))return j<oe.startTime+oe.duration?I(j,oe):oe.values[oe.values.length-1];if(oe!==void 0&&p(oe)&&(te===void 0||!p(te)))return oe.value;if(te!==void 0&&l(te)){var le=m(this._automationEvents,ne,oe,te,this._defaultValue),xe=e(le,2),ge=xe[0],Re=xe[1];return b(j,ge,Re,te)}if(te!==void 0&&u(te)){var Ee=m(this._automationEvents,ne,oe,te,this._defaultValue),Ne=e(Ee,2),we=Ne[0],qe=Ne[1];return w(j,we,qe,te)}return this._defaultValue}}])}(),R=function(G){return{cancelTime:G,type:"cancelAndHold"}},L=function(G){return{cancelTime:G,type:"cancelScheduledValues"}},B=function(G,j){return{endTime:j,type:"exponentialRampToValue",value:G}},z=function(G,j){return{endTime:j,type:"linearRampToValue",value:G}},q=function(G,j,X){return{startTime:j,target:G,timeConstant:X,type:"setTarget"}};r.AutomationEventList=k,r.createCancelAndHoldAutomationEvent=R,r.createCancelScheduledValuesAutomationEvent=L,r.createExponentialRampToValueAutomationEvent=B,r.createLinearRampToValueAutomationEvent=z,r.createSetTargetAutomationEvent=q,r.createSetValueAutomationEvent=i,r.createSetValueCurveAutomationEvent=a})});function KG(r,e){return Object.is(r,e)}var Po=null,lI=!1,uI=1,jp=Symbol("SIGNAL");function Dr(r){let e=Po;return Po=r,e}function XG(){return Po}var m0={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function uM(r){if(lI)throw new Error("");if(Po===null)return;Po.consumerOnSignalRead(r);let e=Po.nextProducerIndex++;if(fI(Po),e<Po.producerNode.length&&Po.producerNode[e]!==r&&f0(Po)){let t=Po.producerNode[e];hI(t,Po.producerIndexOfThis[e])}Po.producerNode[e]!==r&&(Po.producerNode[e]=r,Po.producerIndexOfThis[e]=f0(Po)?JG(r,Po,e):0),Po.producerLastReadVersion[e]=r.version}function xve(){uI++}function YG(r){if(!(f0(r)&&!r.dirty)&&!(!r.dirty&&r.lastCleanEpoch===uI)){if(!r.producerMustRecompute(r)&&!dM(r)){r.dirty=!1,r.lastCleanEpoch=uI;return}r.producerRecomputeValue(r),r.dirty=!1,r.lastCleanEpoch=uI}}function ZG(r){if(r.liveConsumerNode===void 0)return;let e=lI;lI=!0;try{for(let t of r.liveConsumerNode)t.dirty||vve(t)}finally{lI=e}}function QG(){return Po?.consumerAllowSignalWrites!==!1}function vve(r){r.dirty=!0,ZG(r),r.consumerMarkedDirty?.(r)}function dI(r){return r&&(r.nextProducerIndex=0),Dr(r)}function pM(r,e){if(Dr(e),!(!r||r.producerNode===void 0||r.producerIndexOfThis===void 0||r.producerLastReadVersion===void 0)){if(f0(r))for(let t=r.nextProducerIndex;t<r.producerNode.length;t++)hI(r.producerNode[t],r.producerIndexOfThis[t]);for(;r.producerNode.length>r.nextProducerIndex;)r.producerNode.pop(),r.producerLastReadVersion.pop(),r.producerIndexOfThis.pop()}}function dM(r){fI(r);for(let e=0;e<r.producerNode.length;e++){let t=r.producerNode[e],n=r.producerLastReadVersion[e];if(n!==t.version||(YG(t),n!==t.version))return!0}return!1}function hM(r){if(fI(r),f0(r))for(let e=0;e<r.producerNode.length;e++)hI(r.producerNode[e],r.producerIndexOfThis[e]);r.producerNode.length=r.producerLastReadVersion.length=r.producerIndexOfThis.length=0,r.liveConsumerNode&&(r.liveConsumerNode.length=r.liveConsumerIndexOfThis.length=0)}function JG(r,e,t){if(eW(r),r.liveConsumerNode.length===0&&tW(r))for(let n=0;n<r.producerNode.length;n++)r.producerIndexOfThis[n]=JG(r.producerNode[n],r,n);return r.liveConsumerIndexOfThis.push(t),r.liveConsumerNode.push(e)-1}function hI(r,e){if(eW(r),r.liveConsumerNode.length===1&&tW(r))for(let n=0;n<r.producerNode.length;n++)hI(r.producerNode[n],r.producerIndexOfThis[n]);let t=r.liveConsumerNode.length-1;if(r.liveConsumerNode[e]=r.liveConsumerNode[t],r.liveConsumerIndexOfThis[e]=r.liveConsumerIndexOfThis[t],r.liveConsumerNode.length--,r.liveConsumerIndexOfThis.length--,e<r.liveConsumerNode.length){let n=r.liveConsumerIndexOfThis[e],o=r.liveConsumerNode[e];fI(o),o.producerIndexOfThis[n]=e}}function f0(r){return r.consumerIsAlwaysLive||(r?.liveConsumerNode?.length??0)>0}function fI(r){r.producerNode??=[],r.producerIndexOfThis??=[],r.producerLastReadVersion??=[]}function eW(r){r.liveConsumerNode??=[],r.liveConsumerIndexOfThis??=[]}function tW(r){return r.producerNode!==void 0}function rW(r){let e=Object.create(bve);e.computation=r;let t=()=>{if(YG(e),uM(e),e.value===pI)throw e.error;return e.value};return t[jp]=e,t}var cM=Symbol("UNSET"),lM=Symbol("COMPUTING"),pI=Symbol("ERRORED"),bve=$e(ie({},m0),{value:cM,dirty:!0,error:null,equal:KG,producerMustRecompute(r){return r.value===cM||r.value===lM},producerRecomputeValue(r){if(r.value===lM)throw new Error("Detected cycle in computations.");let e=r.value;r.value=lM;let t=dI(r),n;try{n=r.computation()}catch(o){n=pI,r.error=o}finally{pM(r,t)}if(e!==cM&&e!==pI&&n!==pI&&r.equal(e,n)){r.value=e;return}r.value=n,r.version++}});function wve(){throw new Error}var nW=wve;function oW(){nW()}function sW(r){nW=r}var Cve=null;function iW(r){let e=Object.create(cW);e.value=r;let t=()=>(uM(e),e.value);return t[jp]=e,t}function fM(r,e){QG()||oW(),r.equal(r.value,e)||(r.value=e,_ve(r))}function aW(r,e){QG()||oW(),fM(r,e(r.value))}var cW=$e(ie({},m0),{equal:KG,value:void 0});function _ve(r){r.version++,xve(),ZG(r),Cve?.()}function jt(r){return typeof r=="function"}function Qy(r){let t=r(n=>{Error.call(n),n.stack=new Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var mI=Qy(r=>function(t){r(this),this.message=t?`${t.length} errors occurred during unsubscription:
${t.map((n,o)=>`${o+1}) ${n.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=t});function Vm(r,e){if(r){let t=r.indexOf(e);0<=t&&r.splice(t,1)}}var Hn=class r{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(let s of t)s.remove(this);else t.remove(this);let{initialTeardown:n}=this;if(jt(n))try{n()}catch(s){e=s instanceof mI?s.errors:[s]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let s of o)try{lW(s)}catch(i){e=e??[],i instanceof mI?e=[...e,...i.errors]:e.push(i)}}if(e)throw new mI(e)}}add(e){var t;if(e&&e!==this)if(this.closed)lW(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}}_hasParent(e){let{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){let{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){let{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&Vm(t,e)}remove(e){let{_finalizers:t}=this;t&&Vm(t,e),e instanceof r&&e._removeParent(this)}};Hn.EMPTY=(()=>{let r=new Hn;return r.closed=!0,r})();var mM=Hn.EMPTY;function gI(r){return r instanceof Hn||r&&"closed"in r&&jt(r.remove)&&jt(r.add)&&jt(r.unsubscribe)}function lW(r){jt(r)?r():r.unsubscribe()}var lc={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Jy={setTimeout(r,e,...t){let{delegate:n}=Jy;return n?.setTimeout?n.setTimeout(r,e,...t):setTimeout(r,e,...t)},clearTimeout(r){let{delegate:e}=Jy;return(e?.clearTimeout||clearTimeout)(r)},delegate:void 0};function yI(r){Jy.setTimeout(()=>{let{onUnhandledError:e}=lc;if(e)e(r);else throw r})}function g0(){}var uW=gM("C",void 0,void 0);function pW(r){return gM("E",void 0,r)}function dW(r){return gM("N",r,void 0)}function gM(r,e,t){return{kind:r,value:e,error:t}}var Bm=null;function ex(r){if(lc.useDeprecatedSynchronousErrorHandling){let e=!Bm;if(e&&(Bm={errorThrown:!1,error:null}),r(),e){let{errorThrown:t,error:n}=Bm;if(Bm=null,t)throw n}}else r()}function hW(r){lc.useDeprecatedSynchronousErrorHandling&&Bm&&(Bm.errorThrown=!0,Bm.error=r)}var zm=class extends Hn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,gI(e)&&e.add(this)):this.destination=Tve}static create(e,t,n){return new ch(e,t,n)}next(e){this.isStopped?xM(dW(e),this):this._next(e)}error(e){this.isStopped?xM(pW(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?xM(uW,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Sve=Function.prototype.bind;function yM(r,e){return Sve.call(r,e)}var vM=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(n){xI(n)}}error(e){let{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(n){xI(n)}else xI(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){xI(t)}}},ch=class extends zm{constructor(e,t,n){super();let o;if(jt(e)||!e)o={next:e??void 0,error:t??void 0,complete:n??void 0};else{let s;this&&lc.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&yM(e.next,s),error:e.error&&yM(e.error,s),complete:e.complete&&yM(e.complete,s)}):o=e}this.destination=new vM(o)}};function xI(r){lc.useDeprecatedSynchronousErrorHandling?hW(r):yI(r)}function Ive(r){throw r}function xM(r,e){let{onStoppedNotification:t}=lc;t&&Jy.setTimeout(()=>t(r,e))}var Tve={closed:!0,next:g0,error:Ive,complete:g0};var tx=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ki(r){return r}function bM(...r){return wM(r)}function wM(r){return r.length===0?Ki:r.length===1?r[0]:function(t){return r.reduce((n,o)=>o(n),t)}}var Pr=(()=>{class r{constructor(t){t&&(this._subscribe=t)}lift(t){let n=new r;return n.source=this,n.operator=t,n}subscribe(t,n,o){let s=Eve(t)?t:new ch(t,n,o);return ex(()=>{let{operator:i,source:a}=this;s.add(i?i.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(n){t.error(n)}}forEach(t,n){return n=fW(n),new n((o,s)=>{let i=new ch({next:a=>{try{t(a)}catch(c){s(c),i.unsubscribe()}},error:s,complete:o});this.subscribe(i)})}_subscribe(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)}[tx](){return this}pipe(...t){return wM(t)(this)}toPromise(t){return t=fW(t),new t((n,o)=>{let s;this.subscribe(i=>s=i,i=>o(i),()=>n(s))})}}return r.create=e=>new r(e),r})();function fW(r){var e;return(e=r??lc.Promise)!==null&&e!==void 0?e:Promise}function kve(r){return r&&jt(r.next)&&jt(r.error)&&jt(r.complete)}function Eve(r){return r&&r instanceof zm||kve(r)&&gI(r)}function CM(r){return jt(r?.lift)}function Ir(r){return e=>{if(CM(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function dr(r,e,t,n,o){return new _M(r,e,t,n,o)}var _M=class extends zm{constructor(e,t,n,o,s,i){super(e),this.onFinalize=s,this.shouldUnsubscribe=i,this._next=t?function(a){try{t(a)}catch(c){e.error(c)}}:super._next,this._error=o?function(a){try{o(a)}catch(c){e.error(c)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:t}=this;super.unsubscribe(),!t&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};function rx(){return Ir((r,e)=>{let t=null;r._refCount++;let n=dr(e,void 0,void 0,void 0,()=>{if(!r||r._refCount<=0||0<--r._refCount){t=null;return}let o=r._connection,s=t;t=null,o&&(!s||o===s)&&o.unsubscribe(),e.unsubscribe()});r.subscribe(n),n.closed||(t=r.connect())})}var nx=class extends Pr{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,CM(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){let e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Hn;let t=this.getSubject();e.add(this.source.subscribe(dr(t,void 0,()=>{this._teardown(),t.complete()},n=>{this._teardown(),t.error(n)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Hn.EMPTY)}return e}refCount(){return rx()(this)}};var mW=Qy(r=>function(){r(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Yr=(()=>{class r extends Pr{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){let n=new vI(this,this);return n.operator=t,n}_throwIfClosed(){if(this.closed)throw new mW}next(t){ex(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let n of this.currentObservers)n.next(t)}})}error(t){ex(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;let{observers:n}=this;for(;n.length;)n.shift().error(t)}})}complete(){ex(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){let{hasError:n,isStopped:o,observers:s}=this;return n||o?mM:(this.currentObservers=null,s.push(t),new Hn(()=>{this.currentObservers=null,Vm(s,t)}))}_checkFinalizedStatuses(t){let{hasError:n,thrownError:o,isStopped:s}=this;n?t.error(o):s&&t.complete()}asObservable(){let t=new Pr;return t.source=this,t}}return r.create=(e,t)=>new vI(e,t),r})(),vI=class extends Yr{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.next)===null||n===void 0||n.call(t,e)}error(e){var t,n;(n=(t=this.destination)===null||t===void 0?void 0:t.error)===null||n===void 0||n.call(t,e)}complete(){var e,t;(t=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||t===void 0||t.call(e)}_subscribe(e){var t,n;return(n=(t=this.source)===null||t===void 0?void 0:t.subscribe(e))!==null&&n!==void 0?n:mM}};var ss=class extends Yr{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){let{hasError:e,thrownError:t,_value:n}=this;if(e)throw t;return this._throwIfClosed(),n}next(e){super.next(this._value=e)}};var SM={now(){return(SM.delegate||Date).now()},delegate:void 0};var bI=class extends Hn{constructor(e,t){super()}schedule(e,t=0){return this}};var y0={setInterval(r,e,...t){let{delegate:n}=y0;return n?.setInterval?n.setInterval(r,e,...t):setInterval(r,e,...t)},clearInterval(r){let{delegate:e}=y0;return(e?.clearInterval||clearInterval)(r)},delegate:void 0};var wI=class extends bI{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var n;if(this.closed)return this;this.state=e;let o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,t)),this.pending=!0,this.delay=t,this.id=(n=this.id)!==null&&n!==void 0?n:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,n=0){return y0.setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(n!=null&&this.delay===n&&this.pending===!1)return t;t!=null&&y0.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let n=this._execute(e,t);if(n)return n;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n=!1,o;try{this.work(e)}catch(s){n=!0,o=s||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:e,scheduler:t}=this,{actions:n}=t;this.work=this.state=this.scheduler=null,this.pending=!1,Vm(n,this),e!=null&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}};var ox=class r{constructor(e,t=r.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,n){return new this.schedulerActionCtor(this,e).schedule(n,t)}};ox.now=SM.now;var CI=class extends ox{constructor(e,t=ox.now){super(e,t),this.actions=[],this._active=!1}flush(e){let{actions:t}=this;if(this._active){t.push(e);return}let n;this._active=!0;do if(n=e.execute(e.state,e.delay))break;while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}};var Nve=new CI(wI),gW=Nve;var Xi=new Pr(r=>r.complete());function _I(r){return r&&jt(r.schedule)}function yW(r){return r[r.length-1]}function SI(r){return jt(yW(r))?r.pop():void 0}function lh(r){return _I(yW(r))?r.pop():void 0}function vs(r,e,t,n){var o=arguments.length,s=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(i=r[a])&&(s=(o<3?i(s):o>3?i(e,t,s):i(e,t))||s);return o>3&&s&&Object.defineProperty(e,t,s),s}function hr(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function xW(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Um(r){return this instanceof Um?(this.v=r,this):new Um(r)}function vW(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),o,s=[];return o={},a("next"),a("throw"),a("return",i),o[Symbol.asyncIterator]=function(){return this},o;function i(h){return function(f){return Promise.resolve(f).then(h,p)}}function a(h,f){n[h]&&(o[h]=function(m){return new Promise(function(g,y){s.push([h,m,g,y])>1||c(h,m)})},f&&(o[h]=f(o[h])))}function c(h,f){try{l(n[h](f))}catch(m){d(s[0][3],m)}}function l(h){h.value instanceof Um?Promise.resolve(h.value.v).then(u,p):d(s[0][2],h)}function u(h){c("next",h)}function p(h){c("throw",h)}function d(h,f){h(f),s.shift(),s.length&&c(s[0][0],s[0][1])}}function bW(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof xW=="function"?xW(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=r[s]&&function(i){return new Promise(function(a,c){i=r[s](i),o(a,c,i.done,i.value)})}}function o(s,i,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},i)}}var II=r=>r&&typeof r.length=="number"&&typeof r!="function";function TI(r){return jt(r?.then)}function kI(r){return jt(r[tx])}function EI(r){return Symbol.asyncIterator&&jt(r?.[Symbol.asyncIterator])}function NI(r){return new TypeError(`You provided ${r!==null&&typeof r=="object"?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Dve(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var DI=Dve();function AI(r){return jt(r?.[DI])}function RI(r){return vW(this,arguments,function*(){let t=r.getReader();try{for(;;){let{value:n,done:o}=yield Um(t.read());if(o)return yield Um(void 0);yield yield Um(n)}}finally{t.releaseLock()}})}function OI(r){return jt(r?.getReader)}function yo(r){if(r instanceof Pr)return r;if(r!=null){if(kI(r))return Ave(r);if(II(r))return Rve(r);if(TI(r))return Ove(r);if(EI(r))return wW(r);if(AI(r))return Mve(r);if(OI(r))return Fve(r)}throw NI(r)}function Ave(r){return new Pr(e=>{let t=r[tx]();if(jt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Rve(r){return new Pr(e=>{for(let t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()})}function Ove(r){return new Pr(e=>{r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,yI)})}function Mve(r){return new Pr(e=>{for(let t of r)if(e.next(t),e.closed)return;e.complete()})}function wW(r){return new Pr(e=>{Pve(r,e).catch(t=>e.error(t))})}function Fve(r){return wW(RI(r))}function Pve(r,e){var t,n,o,s;return hr(this,void 0,void 0,function*(){try{for(t=bW(r);n=yield t.next(),!n.done;){let i=n.value;if(e.next(i),e.closed)return}}catch(i){o={error:i}}finally{try{n&&!n.done&&(s=t.return)&&(yield s.call(t))}finally{if(o)throw o.error}}e.complete()})}function gi(r,e,t,n=0,o=!1){let s=e.schedule(function(){t(),o?r.add(this.schedule(null,n)):this.unsubscribe()},n);if(r.add(s),!o)return s}function MI(r,e=0){return Ir((t,n)=>{t.subscribe(dr(n,o=>gi(n,r,()=>n.next(o),e),()=>gi(n,r,()=>n.complete(),e),o=>gi(n,r,()=>n.error(o),e)))})}function FI(r,e=0){return Ir((t,n)=>{n.add(r.schedule(()=>t.subscribe(n),e))})}function CW(r,e){return yo(r).pipe(FI(e),MI(e))}function _W(r,e){return yo(r).pipe(FI(e),MI(e))}function SW(r,e){return new Pr(t=>{let n=0;return e.schedule(function(){n===r.length?t.complete():(t.next(r[n++]),t.closed||this.schedule())})})}function IW(r,e){return new Pr(t=>{let n;return gi(t,e,()=>{n=r[DI](),gi(t,e,()=>{let o,s;try{({value:o,done:s}=n.next())}catch(i){t.error(i);return}s?t.complete():t.next(o)},0,!0)}),()=>jt(n?.return)&&n.return()})}function PI(r,e){if(!r)throw new Error("Iterable cannot be null");return new Pr(t=>{gi(t,e,()=>{let n=r[Symbol.asyncIterator]();gi(t,e,()=>{n.next().then(o=>{o.done?t.complete():t.next(o.value)})},0,!0)})})}function TW(r,e){return PI(RI(r),e)}function kW(r,e){if(r!=null){if(kI(r))return CW(r,e);if(II(r))return SW(r,e);if(TI(r))return _W(r,e);if(EI(r))return PI(r,e);if(AI(r))return IW(r,e);if(OI(r))return TW(r,e)}throw NI(r)}function so(r,e){return e?kW(r,e):yo(r)}function Kt(...r){let e=lh(r);return so(r,e)}function sx(r,e){let t=jt(r)?r:()=>r,n=o=>o.error(t());return new Pr(e?o=>e.schedule(n,0,o):n)}function IM(r){return!!r&&(r instanceof Pr||jt(r.lift)&&jt(r.subscribe))}var uc=Qy(r=>function(){r(this),this.name="EmptyError",this.message="no elements in sequence"});function x0(r,e){let t=typeof e=="object";return new Promise((n,o)=>{let s=new ch({next:i=>{n(i),s.unsubscribe()},error:o,complete:()=>{t?n(e.defaultValue):o(new uc)}});r.subscribe(s)})}function EW(r){return r instanceof Date&&!isNaN(r)}function cr(r,e){return Ir((t,n)=>{let o=0;t.subscribe(dr(n,s=>{n.next(r.call(e,s,o++))}))})}var{isArray:$ve}=Array;function Lve(r,e){return $ve(e)?r(...e):r(e)}function $I(r){return cr(e=>Lve(r,e))}var{isArray:Vve}=Array,{getPrototypeOf:Bve,prototype:zve,keys:Uve}=Object;function LI(r){if(r.length===1){let e=r[0];if(Vve(e))return{args:e,keys:null};if(Gve(e)){let t=Uve(e);return{args:t.map(n=>e[n]),keys:t}}}return{args:r,keys:null}}function Gve(r){return r&&typeof r=="object"&&Bve(r)===zve}function VI(r,e){return r.reduce((t,n,o)=>(t[n]=e[o],t),{})}function BI(...r){let e=lh(r),t=SI(r),{args:n,keys:o}=LI(r);if(n.length===0)return so([],e);let s=new Pr(Wve(n,e,o?i=>VI(o,i):Ki));return t?s.pipe($I(t)):s}function Wve(r,e,t=Ki){return n=>{NW(e,()=>{let{length:o}=r,s=new Array(o),i=o,a=o;for(let c=0;c<o;c++)NW(e,()=>{let l=so(r[c],e),u=!1;l.subscribe(dr(n,p=>{s[c]=p,u||(u=!0,a--),a||n.next(t(s.slice()))},()=>{--i||n.complete()}))},n)},n)}}function NW(r,e,t){r?gi(t,r,e):e()}function DW(r,e,t,n,o,s,i,a){let c=[],l=0,u=0,p=!1,d=()=>{p&&!c.length&&!l&&e.complete()},h=m=>l<n?f(m):c.push(m),f=m=>{s&&e.next(m),l++;let g=!1;yo(t(m,u++)).subscribe(dr(e,y=>{o?.(y),s?h(y):e.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(l--;c.length&&l<n;){let y=c.shift();i?gi(e,i,()=>f(y)):f(y)}d()}catch(y){e.error(y)}}))};return r.subscribe(dr(e,h,()=>{p=!0,d()})),()=>{a?.()}}function $o(r,e,t=1/0){return jt(e)?$o((n,o)=>cr((s,i)=>e(n,s,o,i))(yo(r(n,o))),t):(typeof e=="number"&&(t=e),Ir((n,o)=>DW(n,o,r,t)))}function TM(r=1/0){return $o(Ki,r)}function AW(){return TM(1)}function ix(...r){return AW()(so(r,lh(r)))}function zI(r){return new Pr(e=>{yo(r()).subscribe(e)})}function v0(...r){let e=SI(r),{args:t,keys:n}=LI(r),o=new Pr(s=>{let{length:i}=t;if(!i){s.complete();return}let a=new Array(i),c=i,l=i;for(let u=0;u<i;u++){let p=!1;yo(t[u]).subscribe(dr(s,d=>{p||(p=!0,l--),a[u]=d},()=>c--,void 0,()=>{(!c||!p)&&(l||s.next(n?VI(n,a):a),s.complete())}))}});return e?o.pipe($I(e)):o}function ax(r=0,e,t=gW){let n=-1;return e!=null&&(_I(e)?t=e:n=e),new Pr(o=>{let s=EW(r)?+r-t.now():r;s<0&&(s=0);let i=0;return t.schedule(function(){o.closed||(o.next(i++),0<=n?this.schedule(void 0,n):o.complete())},s)})}function yi(r,e){return Ir((t,n)=>{let o=0;t.subscribe(dr(n,s=>r.call(e,s,o++)&&n.next(s)))})}function uh(r){return Ir((e,t)=>{let n=null,o=!1,s;n=e.subscribe(dr(t,void 0,void 0,i=>{s=yo(r(i,uh(r)(e))),n?(n.unsubscribe(),n=null,s.subscribe(t)):o=!0})),o&&(n.unsubscribe(),n=null,s.subscribe(t))})}function RW(r,e,t,n,o){return(s,i)=>{let a=t,c=e,l=0;s.subscribe(dr(i,u=>{let p=l++;c=a?r(c,u,p):(a=!0,u),n&&i.next(c)},o&&(()=>{a&&i.next(c),i.complete()})))}}function cx(r,e){return jt(e)?$o(r,e,1):$o(r,1)}function ph(r){return Ir((e,t)=>{let n=!1;e.subscribe(dr(t,o=>{n=!0,t.next(o)},()=>{n||t.next(r),t.complete()}))})}function ya(r){return r<=0?()=>Xi:Ir((e,t)=>{let n=0;e.subscribe(dr(t,o=>{++n<=r&&(t.next(o),r<=n&&t.complete())}))})}function kM(r){return cr(()=>r)}function UI(r=jve){return Ir((e,t)=>{let n=!1;e.subscribe(dr(t,o=>{n=!0,t.next(o)},()=>n?t.complete():t.error(r())))})}function jve(){return new uc}function b0(r){return Ir((e,t)=>{try{e.subscribe(t)}finally{t.add(r)}})}function eu(r,e){let t=arguments.length>=2;return n=>n.pipe(r?yi((o,s)=>r(o,s,n)):Ki,ya(1),t?ph(e):UI(()=>new uc))}function lx(r){return r<=0?()=>Xi:Ir((e,t)=>{let n=[];e.subscribe(dr(t,o=>{n.push(o),r<n.length&&n.shift()},()=>{for(let o of n)t.next(o);t.complete()},void 0,()=>{n=null}))})}function EM(r,e){let t=arguments.length>=2;return n=>n.pipe(r?yi((o,s)=>r(o,s,n)):Ki,lx(1),t?ph(e):UI(()=>new uc))}function NM(r,e){return Ir(RW(r,e,arguments.length>=2,!0))}function DM(...r){let e=lh(r);return Ir((t,n)=>{(e?ix(r,t,e):ix(r,t)).subscribe(n)})}function pc(r,e){return Ir((t,n)=>{let o=null,s=0,i=!1,a=()=>i&&!o&&n.complete();t.subscribe(dr(n,c=>{o?.unsubscribe();let l=0,u=s++;yo(r(c,u)).subscribe(o=dr(n,p=>n.next(e?e(c,p,u,l++):p),()=>{o=null,a()}))},()=>{i=!0,a()}))})}function AM(r){return Ir((e,t)=>{yo(r).subscribe(dr(t,()=>t.complete(),g0)),!t.closed&&e.subscribe(t)})}function is(r,e,t){let n=jt(r)||e||t?{next:r,error:e,complete:t}:r;return n?Ir((o,s)=>{var i;(i=n.subscribe)===null||i===void 0||i.call(n);let a=!0;o.subscribe(dr(s,c=>{var l;(l=n.next)===null||l===void 0||l.call(n,c),s.next(c)},()=>{var c;a=!1,(c=n.complete)===null||c===void 0||c.call(n),s.complete()},c=>{var l;a=!1,(l=n.error)===null||l===void 0||l.call(n,c),s.error(c)},()=>{var c,l;a&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(l=n.finalize)===null||l===void 0||l.call(n)}))}):Ki}var Hve="https://g.co/ng/security#xss",gt=class extends Error{constructor(e,t){super(GF(e,t)),this.code=e}};function GF(r,e){return`${`NG0${Math.abs(r)}`}${e?": "+e:""}`}function M0(r){return{toString:r}.toString()}var GI="__parameters__";function qve(r){return function(...t){if(r){let n=r(...t);for(let o in n)this[o]=n[o]}}}function f4(r,e,t){return M0(()=>{let n=qve(e);function o(...s){if(this instanceof o)return n.apply(this,s),this;let i=new o(...s);return a.annotation=i,a;function a(c,l,u){let p=c.hasOwnProperty(GI)?c[GI]:Object.defineProperty(c,GI,{value:[]})[GI];for(;p.length<=u;)p.push(null);return(p[u]=p[u]||[]).push(i),c}}return t&&(o.prototype=Object.create(t.prototype)),o.prototype.ngMetadataName=r,o.annotationCls=o,o})}function un(r){for(let e in r)if(r[e]===un)return e;throw Error("Could not find renamed property on target object.")}function Kve(r,e){for(let t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function Gs(r){if(typeof r=="string")return r;if(Array.isArray(r))return"["+r.map(Gs).join(", ")+"]";if(r==null)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;let e=r.toString();if(e==null)return""+e;let t=e.indexOf(`
`);return t===-1?e:e.substring(0,t)}function jM(r,e){return r==null||r===""?e===null?"":e:e==null||e===""?r:r+" "+e}var Xve=un({__forward_ref__:un});function ng(r){return r.__forward_ref__=ng,r.toString=function(){return Gs(this())},r}function Us(r){return m4(r)?r():r}function m4(r){return typeof r=="function"&&r.hasOwnProperty(Xve)&&r.__forward_ref__===ng}function st(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function og(r){return{providers:r.providers||[],imports:r.imports||[]}}function CT(r){return OW(r,y4)||OW(r,x4)}function g4(r){return CT(r)!==null}function OW(r,e){return r.hasOwnProperty(e)?r[e]:null}function Yve(r){let e=r&&(r[y4]||r[x4]);return e||null}function MW(r){return r&&(r.hasOwnProperty(FW)||r.hasOwnProperty(Zve))?r[FW]:null}var y4=un({\u0275prov:un}),FW=un({\u0275inj:un}),x4=un({ngInjectableDef:un}),Zve=un({ngInjectorDef:un}),$t=class{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof t=="number"?this.__NG_ELEMENT_ID__=t:t!==void 0&&(this.\u0275prov=st({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function v4(r){return r&&!!r.\u0275providers}var Qve=un({\u0275cmp:un}),Jve=un({\u0275dir:un}),ebe=un({\u0275pipe:un}),tbe=un({\u0275mod:un}),JI=un({\u0275fac:un}),C0=un({__NG_ELEMENT_ID__:un}),PW=un({__NG_ENV_ID__:un});function _0(r){return typeof r=="string"?r:r==null?"":String(r)}function rbe(r){return typeof r=="function"?r.name||r.toString():typeof r=="object"&&r!=null&&typeof r.type=="function"?r.type.name||r.type.toString():_0(r)}function nbe(r,e){let t=e?`. Dependency path: ${e.join(" > ")} > ${r}`:"";throw new gt(-200,r)}function WF(r,e){throw new gt(-201,!1)}var rr=function(r){return r[r.Default=0]="Default",r[r.Host=1]="Host",r[r.Self=2]="Self",r[r.SkipSelf=4]="SkipSelf",r[r.Optional=8]="Optional",r}(rr||{}),HM;function b4(){return HM}function xi(r){let e=HM;return HM=r,e}function w4(r,e,t){let n=CT(r);if(n&&n.providedIn=="root")return n.value===void 0?n.value=n.factory():n.value;if(t&rr.Optional)return null;if(e!==void 0)return e;WF(r,"Injector")}var obe={},S0=obe,qM="__NG_DI_FLAG__",eT="ngTempTokenPath",sbe="ngTokenPath",ibe=/\n/gm,abe="\u0275",$W="__source",hx;function cbe(){return hx}function dh(r){let e=hx;return hx=r,e}function lbe(r,e=rr.Default){if(hx===void 0)throw new gt(-203,!1);return hx===null?w4(r,void 0,e):hx.get(r,e&rr.Optional?null:void 0,e)}function Lt(r,e=rr.Default){return(b4()||lbe)(Us(r),e)}function rt(r,e=rr.Default){return Lt(r,_T(e))}function _T(r){return typeof r>"u"||typeof r=="number"?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function KM(r){let e=[];for(let t=0;t<r.length;t++){let n=Us(r[t]);if(Array.isArray(n)){if(n.length===0)throw new gt(900,!1);let o,s=rr.Default;for(let i=0;i<n.length;i++){let a=n[i],c=ube(a);typeof c=="number"?c===-1?o=a.token:s|=c:o=a}e.push(Lt(o,s))}else e.push(Lt(n))}return e}function C4(r,e){return r[qM]=e,r.prototype[qM]=e,r}function ube(r){return r[qM]}function pbe(r,e,t,n){let o=r[eT];throw e[$W]&&o.unshift(e[$W]),r.message=dbe(`
`+r.message,o,t,n),r[sbe]=o,r[eT]=null,r}function dbe(r,e,t,n=null){r=r&&r.charAt(0)===`
`&&r.charAt(1)==abe?r.slice(2):r;let o=Gs(e);if(Array.isArray(e))o=e.map(Gs).join(" -> ");else if(typeof e=="object"){let s=[];for(let i in e)if(e.hasOwnProperty(i)){let a=e[i];s.push(i+":"+(typeof a=="string"?JSON.stringify(a):Gs(a)))}o=`{${s.join(", ")}}`}return`${t}${n?"("+n+")":""}[${o}]: ${r.replace(ibe,`
  `)}`}var jF=C4(f4("Optional"),8);var _4=C4(f4("SkipSelf"),4);function jm(r,e){let t=r.hasOwnProperty(JI);return t?r[JI]:null}function hbe(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++){let o=r[n],s=e[n];if(t&&(o=t(o),s=t(s)),s!==o)return!1}return!0}function fbe(r){return r.flat(Number.POSITIVE_INFINITY)}function HF(r,e){r.forEach(t=>Array.isArray(t)?HF(t,e):e(t))}function S4(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function tT(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function mbe(r,e){let t=[];for(let n=0;n<r;n++)t.push(e);return t}function gbe(r,e,t,n){let o=r.length;if(o==e)r.push(t,n);else if(o===1)r.push(n,r[0]),r[0]=t;else{for(o--,r.push(r[o-1],r[o]);o>e;){let s=o-2;r[o]=r[s],o--}r[e]=t,r[e+1]=n}}function I4(r,e,t){let n=F0(r,e);return n>=0?r[n|1]=t:(n=~n,gbe(r,n,e,t)),n}function RM(r,e){let t=F0(r,e);if(t>=0)return r[t|1]}function F0(r,e){return ybe(r,e,1)}function ybe(r,e,t){let n=0,o=r.length>>t;for(;o!==n;){let s=n+(o-n>>1),i=r[s<<t];if(e===i)return s<<t;i>e?o=s:n=s+1}return~(o<<t)}var mx={},vi=[],gx=new $t(""),T4=new $t("",-1),k4=new $t(""),rT=class{get(e,t=S0){if(t===S0){let n=new Error(`NullInjectorError: No provider for ${Gs(e)}!`);throw n.name="NullInjectorError",n}return t}},E4=function(r){return r[r.OnPush=0]="OnPush",r[r.Default=1]="Default",r}(E4||{}),nu=function(r){return r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",r}(nu||{}),mh=function(r){return r[r.None=0]="None",r[r.SignalBased=1]="SignalBased",r[r.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",r}(mh||{});function xbe(r,e,t){let n=r.length;for(;;){let o=r.indexOf(e,t);if(o===-1)return o;if(o===0||r.charCodeAt(o-1)<=32){let s=e.length;if(o+s===n||r.charCodeAt(o+s)<=32)return o}t=o+1}}function XM(r,e,t){let n=0;for(;n<t.length;){let o=t[n];if(typeof o=="number"){if(o!==0)break;n++;let s=t[n++],i=t[n++],a=t[n++];r.setAttribute(e,i,a,s)}else{let s=o,i=t[++n];bbe(s)?r.setProperty(e,s,i):r.setAttribute(e,s,i),n++}}return n}function vbe(r){return r===3||r===4||r===6}function bbe(r){return r.charCodeAt(0)===64}function I0(r,e){if(!(e===null||e.length===0))if(r===null||r.length===0)r=e.slice();else{let t=-1;for(let n=0;n<e.length;n++){let o=e[n];typeof o=="number"?t=o:t===0||(t===-1||t===2?LW(r,t,o,null,e[++n]):LW(r,t,o,null,null))}}return r}function LW(r,e,t,n,o){let s=0,i=r.length;if(e===-1)i=-1;else for(;s<r.length;){let a=r[s++];if(typeof a=="number"){if(a===e){i=-1;break}else if(a>e){i=s-1;break}}}for(;s<r.length;){let a=r[s];if(typeof a=="number")break;if(a===t){if(n===null){o!==null&&(r[s+1]=o);return}else if(n===r[s+1]){r[s+2]=o;return}}s++,n!==null&&s++,o!==null&&s++}i!==-1&&(r.splice(i,0,e),s=i+1),r.splice(s++,0,t),n!==null&&r.splice(s++,0,n),o!==null&&r.splice(s++,0,o)}var N4="ng-template";function wbe(r,e,t,n){let o=0;if(n){for(;o<e.length&&typeof e[o]=="string";o+=2)if(e[o]==="class"&&xbe(e[o+1].toLowerCase(),t,0)!==-1)return!0}else if(qF(r))return!1;if(o=e.indexOf(1,o),o>-1){let s;for(;++o<e.length&&typeof(s=e[o])=="string";)if(s.toLowerCase()===t)return!0}return!1}function qF(r){return r.type===4&&r.value!==N4}function Cbe(r,e,t){let n=r.type===4&&!t?N4:r.value;return e===n}function _be(r,e,t){let n=4,o=r.attrs,s=o!==null?Tbe(o):0,i=!1;for(let a=0;a<e.length;a++){let c=e[a];if(typeof c=="number"){if(!i&&!dc(n)&&!dc(c))return!1;if(i&&dc(c))continue;i=!1,n=c|n&1;continue}if(!i)if(n&4){if(n=2|n&1,c!==""&&!Cbe(r,c,t)||c===""&&e.length===1){if(dc(n))return!1;i=!0}}else if(n&8){if(o===null||!wbe(r,o,c,t)){if(dc(n))return!1;i=!0}}else{let l=e[++a],u=Sbe(c,o,qF(r),t);if(u===-1){if(dc(n))return!1;i=!0;continue}if(l!==""){let p;if(u>s?p="":p=o[u+1].toLowerCase(),n&2&&l!==p){if(dc(n))return!1;i=!0}}}}return dc(n)||i}function dc(r){return(r&1)===0}function Sbe(r,e,t,n){if(e===null)return-1;let o=0;if(n||!t){let s=!1;for(;o<e.length;){let i=e[o];if(i===r)return o;if(i===3||i===6)s=!0;else if(i===1||i===2){let a=e[++o];for(;typeof a=="string";)a=e[++o];continue}else{if(i===4)break;if(i===0){o+=4;continue}}o+=s?1:2}return-1}else return kbe(e,r)}function D4(r,e,t=!1){for(let n=0;n<e.length;n++)if(_be(r,e[n],t))return!0;return!1}function Ibe(r){let e=r.attrs;if(e!=null){let t=e.indexOf(5);if(!(t&1))return e[t+1]}return null}function Tbe(r){for(let e=0;e<r.length;e++){let t=r[e];if(vbe(t))return e}return r.length}function kbe(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){let n=r[t];if(typeof n=="number")return-1;if(n===e)return t;t++}return-1}function Ebe(r,e){e:for(let t=0;t<e.length;t++){let n=e[t];if(r.length===n.length){for(let o=0;o<r.length;o++)if(r[o]!==n[o])continue e;return!0}}return!1}function VW(r,e){return r?":not("+e.trim()+")":e}function Nbe(r){let e=r[0],t=1,n=2,o="",s=!1;for(;t<r.length;){let i=r[t];if(typeof i=="string")if(n&2){let a=r[++t];o+="["+i+(a.length>0?'="'+a+'"':"")+"]"}else n&8?o+="."+i:n&4&&(o+=" "+i);else o!==""&&!dc(i)&&(e+=VW(s,o),o=""),n=i,s=s||!dc(n);t++}return o!==""&&(e+=VW(s,o)),e}function Dbe(r){return r.map(Nbe).join(",")}function Abe(r){let e=[],t=[],n=1,o=2;for(;n<r.length;){let s=r[n];if(typeof s=="string")o===2?s!==""&&e.push(s,r[++n]):o===8&&t.push(s);else{if(!dc(o))break;o=s}n++}return{attrs:e,classes:t}}function Dt(r){return M0(()=>{let e=P4(r),t=$e(ie({},e),{decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===E4.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&r.dependencies||null,getStandaloneInjector:null,signals:r.signals??!1,data:r.data||{},encapsulation:r.encapsulation||nu.Emulated,styles:r.styles||vi,_:null,schemas:r.schemas||null,tView:null,id:""});$4(t);let n=r.dependencies;return t.directiveDefs=zW(n,!1),t.pipeDefs=zW(n,!0),t.id=Mbe(t),t})}function Rbe(r){return Hm(r)||R4(r)}function Obe(r){return r!==null}function sg(r){return M0(()=>({type:r.type,bootstrap:r.bootstrap||vi,declarations:r.declarations||vi,imports:r.imports||vi,exports:r.exports||vi,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function BW(r,e){if(r==null)return mx;let t={};for(let n in r)if(r.hasOwnProperty(n)){let o=r[n],s,i,a=mh.None;Array.isArray(o)?(a=o[0],s=o[1],i=o[2]??s):(s=o,i=o),e?(t[s]=a!==mh.None?[n,a]:n,e[s]=i):t[s]=n}return t}function ws(r){return M0(()=>{let e=P4(r);return $4(e),e})}function A4(r){return{type:r.type,name:r.name,factory:null,pure:r.pure!==!1,standalone:r.standalone===!0,onDestroy:r.type.prototype.ngOnDestroy||null}}function Hm(r){return r[Qve]||null}function R4(r){return r[Jve]||null}function O4(r){return r[ebe]||null}function M4(r){let e=Hm(r)||R4(r)||O4(r);return e!==null?e.standalone:!1}function F4(r,e){let t=r[tbe]||null;if(!t&&e===!0)throw new Error(`Type ${Gs(r)} does not have '\u0275mod' property.`);return t}function P4(r){let e={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:r.inputs||mx,exportAs:r.exportAs||null,standalone:r.standalone===!0,signals:r.signals===!0,selectors:r.selectors||vi,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:BW(r.inputs,e),outputs:BW(r.outputs),debugInfo:null}}function $4(r){r.features?.forEach(e=>e(r))}function zW(r,e){if(!r)return null;let t=e?O4:Rbe;return()=>(typeof r=="function"?r():r).map(n=>t(n)).filter(Obe)}function Mbe(r){let e=0,t=[r.selectors,r.ngContentSelectors,r.hostVars,r.hostAttrs,r.consts,r.vars,r.decls,r.encapsulation,r.standalone,r.signals,r.exportAs,JSON.stringify(r.inputs),JSON.stringify(r.outputs),Object.getOwnPropertyNames(r.type.prototype),!!r.contentQueries,!!r.viewQuery].join("|");for(let o of t)e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function ST(r){return{\u0275providers:r}}function Fbe(...r){return{\u0275providers:L4(!0,r),\u0275fromNgModule:!0}}function L4(r,...e){let t=[],n=new Set,o,s=i=>{t.push(i)};return HF(e,i=>{let a=i;YM(a,s,[],n)&&(o||=[],o.push(a))}),o!==void 0&&V4(o,s),t}function V4(r,e){for(let t=0;t<r.length;t++){let{ngModule:n,providers:o}=r[t];KF(o,s=>{e(s,n)})}}function YM(r,e,t,n){if(r=Us(r),!r)return!1;let o=null,s=MW(r),i=!s&&Hm(r);if(!s&&!i){let c=r.ngModule;if(s=MW(c),s)o=c;else return!1}else{if(i&&!i.standalone)return!1;o=r}let a=n.has(o);if(i){if(a)return!1;if(n.add(o),i.dependencies){let c=typeof i.dependencies=="function"?i.dependencies():i.dependencies;for(let l of c)YM(l,e,t,n)}}else if(s){if(s.imports!=null&&!a){n.add(o);let l;try{HF(s.imports,u=>{YM(u,e,t,n)&&(l||=[],l.push(u))})}finally{}l!==void 0&&V4(l,e)}if(!a){let l=jm(o)||(()=>new o);e({provide:o,useFactory:l,deps:vi},o),e({provide:k4,useValue:o,multi:!0},o),e({provide:gx,useValue:()=>Lt(o),multi:!0},o)}let c=s.providers;if(c!=null&&!a){let l=r;KF(c,u=>{e(u,l)})}}else return!1;return o!==r&&r.providers!==void 0}function KF(r,e){for(let t of r)v4(t)&&(t=t.\u0275providers),Array.isArray(t)?KF(t,e):e(t)}var Pbe=un({provide:String,useValue:un});function B4(r){return r!==null&&typeof r=="object"&&Pbe in r}function $be(r){return!!(r&&r.useExisting)}function Lbe(r){return!!(r&&r.useFactory)}function yx(r){return typeof r=="function"}function Vbe(r){return!!r.useClass}var IT=new $t(""),qI={},Bbe={},OM;function XF(){return OM===void 0&&(OM=new rT),OM}var va=class{},T0=class extends va{get destroyed(){return this._destroyed}constructor(e,t,n,o){super(),this.parent=t,this.source=n,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,QM(e,i=>this.processProvider(i)),this.records.set(T4,ux(void 0,this)),o.has("environment")&&this.records.set(va,ux(void 0,this));let s=this.records.get(IT);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(k4,vi,rr.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=Dr(null);try{for(let n of this._ngOnDestroyHooks)n.ngOnDestroy();let t=this._onDestroyHooks;this._onDestroyHooks=[];for(let n of t)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Dr(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let t=dh(this),n=xi(void 0),o;try{return e()}finally{dh(t),xi(n)}}get(e,t=S0,n=rr.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(PW))return e[PW](this);n=_T(n);let o,s=dh(this),i=xi(void 0);try{if(!(n&rr.SkipSelf)){let c=this.records.get(e);if(c===void 0){let l=jbe(e)&&CT(e);l&&this.injectableDefInScope(l)?c=ux(ZM(e),qI):c=null,this.records.set(e,c)}if(c!=null)return this.hydrate(e,c)}let a=n&rr.Self?XF():this.parent;return t=n&rr.Optional&&t===S0?null:t,a.get(e,t)}catch(a){if(a.name==="NullInjectorError"){if((a[eT]=a[eT]||[]).unshift(Gs(e)),s)throw a;return pbe(a,e,"R3InjectorError",this.source)}else throw a}finally{xi(i),dh(s)}}resolveInjectorInitializers(){let e=Dr(null),t=dh(this),n=xi(void 0),o;try{let s=this.get(gx,vi,rr.Self);for(let i of s)i()}finally{dh(t),xi(n),Dr(e)}}toString(){let e=[],t=this.records;for(let n of t.keys())e.push(Gs(n));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new gt(205,!1)}processProvider(e){e=Us(e);let t=yx(e)?e:Us(e&&e.provide),n=Ube(e);if(!yx(e)&&e.multi===!0){let o=this.records.get(t);o||(o=ux(void 0,qI,!0),o.factory=()=>KM(o.multi),this.records.set(t,o)),t=e,o.multi.push(e)}this.records.set(t,n)}hydrate(e,t){let n=Dr(null);try{return t.value===qI&&(t.value=Bbe,t.value=t.factory()),typeof t.value=="object"&&t.value&&Wbe(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}finally{Dr(n)}}injectableDefInScope(e){if(!e.providedIn)return!1;let t=Us(e.providedIn);return typeof t=="string"?t==="any"||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(e){let t=this._onDestroyHooks.indexOf(e);t!==-1&&this._onDestroyHooks.splice(t,1)}};function ZM(r){let e=CT(r),t=e!==null?e.factory:jm(r);if(t!==null)return t;if(r instanceof $t)throw new gt(204,!1);if(r instanceof Function)return zbe(r);throw new gt(204,!1)}function zbe(r){if(r.length>0)throw new gt(204,!1);let t=Yve(r);return t!==null?()=>t.factory(r):()=>new r}function Ube(r){if(B4(r))return ux(void 0,r.useValue);{let e=z4(r);return ux(e,qI)}}function z4(r,e,t){let n;if(yx(r)){let o=Us(r);return jm(o)||ZM(o)}else if(B4(r))n=()=>Us(r.useValue);else if(Lbe(r))n=()=>r.useFactory(...KM(r.deps||[]));else if($be(r))n=()=>Lt(Us(r.useExisting));else{let o=Us(r&&(r.useClass||r.provide));if(Gbe(r))n=()=>new o(...KM(r.deps));else return jm(o)||ZM(o)}return n}function ux(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function Gbe(r){return!!r.deps}function Wbe(r){return r!==null&&typeof r=="object"&&typeof r.ngOnDestroy=="function"}function jbe(r){return typeof r=="function"||typeof r=="object"&&r instanceof $t}function QM(r,e){for(let t of r)Array.isArray(t)?QM(t,e):t&&v4(t)?QM(t.\u0275providers,e):e(t)}function Yp(r,e){r instanceof T0&&r.assertNotDestroyed();let t,n=dh(r),o=xi(void 0);try{return e()}finally{dh(n),xi(o)}}function Hbe(){return b4()!==void 0||cbe()!=null}function qbe(r){return typeof r=="function"}var Zp=0,Yt=1,Pt=2,bs=3,hc=4,bi=5,k0=6,nT=7,fc=8,xx=9,Hp=10,io=11,E0=12,UW=13,_x=14,ba=15,qm=16,px=17,qp=18,TT=19,U4=20,hh=21,MM=22,xa=23,wa=25,G4=1;var Km=7,oT=8,vx=9,Yi=10,sT=function(r){return r[r.None=0]="None",r[r.HasTransplantedViews=2]="HasTransplantedViews",r}(sT||{});function fh(r){return Array.isArray(r)&&typeof r[G4]=="object"}function Qp(r){return Array.isArray(r)&&r[G4]===!0}function W4(r){return(r.flags&4)!==0}function kT(r){return r.componentOffset>-1}function YF(r){return(r.flags&1)===1}function gh(r){return!!r.template}function JM(r){return(r[Pt]&512)!==0}var eF=class{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}};function j4(r,e,t,n){e!==null?e.applyValueToInputSignal(e,n):r[t]=n}function mc(){return H4}function H4(r){return r.type.prototype.ngOnChanges&&(r.setInput=Xbe),Kbe}mc.ngInherit=!0;function Kbe(){let r=K4(this),e=r?.current;if(e){let t=r.previous;if(t===mx)r.previous=e;else for(let n in e)t[n]=e[n];r.current=null,this.ngOnChanges(e)}}function Xbe(r,e,t,n,o){let s=this.declaredInputs[n],i=K4(r)||Ybe(r,{previous:mx,current:null}),a=i.current||(i.current={}),c=i.previous,l=c[s];a[s]=new eF(l&&l.currentValue,t,c===mx),j4(r,e,o,t)}var q4="__ngSimpleChanges__";function K4(r){return r[q4]||null}function Ybe(r,e){return r[q4]=e}var GW=null;var tu=function(r,e,t){GW?.(r,e,t)},X4="svg",Zbe="math";function ou(r){for(;Array.isArray(r);)r=r[Zp];return r}function Y4(r,e){return ou(e[r])}function Ca(r,e){return ou(e[r.index])}function Z4(r,e){return r.data[e]}function Qbe(r,e){return r[e]}function bh(r,e){let t=e[r];return fh(t)?t:t[Zp]}function Jbe(r){return(r[Pt]&4)===4}function ZF(r){return(r[Pt]&128)===128}function ewe(r){return Qp(r[bs])}function iT(r,e){return e==null?null:r[e]}function Q4(r){r[px]=0}function J4(r){r[Pt]&1024||(r[Pt]|=1024,ZF(r)&&ET(r))}function twe(r,e){for(;r>0;)e=e[_x],r--;return e}function N0(r){return!!(r[Pt]&9216||r[xa]?.dirty)}function tF(r){r[Hp].changeDetectionScheduler?.notify(7),r[Pt]&64&&(r[Pt]|=1024),N0(r)&&ET(r)}function ET(r){r[Hp].changeDetectionScheduler?.notify(0);let e=Xm(r);for(;e!==null&&!(e[Pt]&8192||(e[Pt]|=8192,!ZF(e)));)e=Xm(e)}function ej(r,e){if((r[Pt]&256)===256)throw new gt(911,!1);r[hh]===null&&(r[hh]=[]),r[hh].push(e)}function rwe(r,e){if(r[hh]===null)return;let t=r[hh].indexOf(e);t!==-1&&r[hh].splice(t,1)}function Xm(r){let e=r[bs];return Qp(e)?e[bs]:e}var Zt={lFrame:pj(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var tj=!1;function nwe(){return Zt.lFrame.elementDepthCount}function owe(){Zt.lFrame.elementDepthCount++}function swe(){Zt.lFrame.elementDepthCount--}function rj(){return Zt.bindingsEnabled}function nj(){return Zt.skipHydrationRootTNode!==null}function iwe(r){return Zt.skipHydrationRootTNode===r}function awe(){Zt.skipHydrationRootTNode=null}function Tr(){return Zt.lFrame.lView}function qo(){return Zt.lFrame.tView}function _a(r){return Zt.lFrame.contextLView=r,r[fc]}function Sa(r){return Zt.lFrame.contextLView=null,r}function wi(){let r=oj();for(;r!==null&&r.type===64;)r=r.parent;return r}function oj(){return Zt.lFrame.currentTNode}function cwe(){let r=Zt.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}function P0(r,e){let t=Zt.lFrame;t.currentTNode=r,t.isParent=e}function sj(){return Zt.lFrame.isParent}function ij(){Zt.lFrame.isParent=!1}function aj(){return tj}function WW(r){tj=r}function lwe(){let r=Zt.lFrame,e=r.bindingRootIndex;return e===-1&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}function uwe(){return Zt.lFrame.bindingIndex}function pwe(r){return Zt.lFrame.bindingIndex=r}function NT(){return Zt.lFrame.bindingIndex++}function QF(r){let e=Zt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}function dwe(){return Zt.lFrame.inI18n}function hwe(r,e){let t=Zt.lFrame;t.bindingIndex=t.bindingRootIndex=r,rF(e)}function fwe(){return Zt.lFrame.currentDirectiveIndex}function rF(r){Zt.lFrame.currentDirectiveIndex=r}function mwe(r){let e=Zt.lFrame.currentDirectiveIndex;return e===-1?null:r[e]}function cj(){return Zt.lFrame.currentQueryIndex}function JF(r){Zt.lFrame.currentQueryIndex=r}function gwe(r){let e=r[Yt];return e.type===2?e.declTNode:e.type===1?r[bi]:null}function lj(r,e,t){if(t&rr.SkipSelf){let o=e,s=r;for(;o=o.parent,o===null&&!(t&rr.Host);)if(o=gwe(s),o===null||(s=s[_x],o.type&10))break;if(o===null)return!1;e=o,r=s}let n=Zt.lFrame=uj();return n.currentTNode=e,n.lView=r,!0}function eP(r){let e=uj(),t=r[Yt];Zt.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function uj(){let r=Zt.lFrame,e=r===null?null:r.child;return e===null?pj(r):e}function pj(r){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return r!==null&&(r.child=e),e}function dj(){let r=Zt.lFrame;return Zt.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}var hj=dj;function tP(){let r=dj();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function ywe(r){return(Zt.lFrame.contextLView=twe(r,Zt.lFrame.contextLView))[fc]}function wh(){return Zt.lFrame.selectedIndex}function Ym(r){Zt.lFrame.selectedIndex=r}function rP(){let r=Zt.lFrame;return Z4(r.tView,r.selectedIndex)}function su(){Zt.lFrame.currentNamespace=X4}function Ch(){xwe()}function xwe(){Zt.lFrame.currentNamespace=null}function vwe(){return Zt.lFrame.currentNamespace}var fj=!0;function nP(){return fj}function oP(r){fj=r}function bwe(r,e,t){let{ngOnChanges:n,ngOnInit:o,ngDoCheck:s}=e.type.prototype;if(n){let i=H4(e);(t.preOrderHooks??=[]).push(r,i),(t.preOrderCheckHooks??=[]).push(r,i)}o&&(t.preOrderHooks??=[]).push(0-r,o),s&&((t.preOrderHooks??=[]).push(r,s),(t.preOrderCheckHooks??=[]).push(r,s))}function sP(r,e){for(let t=e.directiveStart,n=e.directiveEnd;t<n;t++){let s=r.data[t].type.prototype,{ngAfterContentInit:i,ngAfterContentChecked:a,ngAfterViewInit:c,ngAfterViewChecked:l,ngOnDestroy:u}=s;i&&(r.contentHooks??=[]).push(-t,i),a&&((r.contentHooks??=[]).push(t,a),(r.contentCheckHooks??=[]).push(t,a)),c&&(r.viewHooks??=[]).push(-t,c),l&&((r.viewHooks??=[]).push(t,l),(r.viewCheckHooks??=[]).push(t,l)),u!=null&&(r.destroyHooks??=[]).push(t,u)}}function KI(r,e,t){mj(r,e,3,t)}function XI(r,e,t,n){(r[Pt]&3)===t&&mj(r,e,t,n)}function FM(r,e){let t=r[Pt];(t&3)===e&&(t&=16383,t+=1,r[Pt]=t)}function mj(r,e,t,n){let o=n!==void 0?r[px]&65535:0,s=n??-1,i=e.length-1,a=0;for(let c=o;c<i;c++)if(typeof e[c+1]=="number"){if(a=e[c],n!=null&&a>=n)break}else e[c]<0&&(r[px]+=65536),(a<s||s==-1)&&(wwe(r,t,e,c),r[px]=(r[px]&4294901760)+c+2),c++}function jW(r,e){tu(4,r,e);let t=Dr(null);try{e.call(r)}finally{Dr(t),tu(5,r,e)}}function wwe(r,e,t,n){let o=t[n]<0,s=t[n+1],i=o?-t[n]:t[n],a=r[i];o?r[Pt]>>14<r[px]>>16&&(r[Pt]&3)===e&&(r[Pt]+=16384,jW(a,s)):jW(a,s)}var fx=-1,Zm=class{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}};function Cwe(r){return r instanceof Zm}function _we(r){return(r.flags&8)!==0}function Swe(r){return(r.flags&16)!==0}var PM={},nF=class{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,n){n=_T(n);let o=this.injector.get(e,PM,n);return o!==PM||t===PM?o:this.parentInjector.get(e,t,n)}};function gj(r){return r!==fx}function aT(r){return r&32767}function Iwe(r){return r>>16}function cT(r,e){let t=Iwe(r),n=e;for(;t>0;)n=n[_x],t--;return n}var oF=!0;function lT(r){let e=oF;return oF=r,e}var Twe=256,yj=Twe-1,xj=5,kwe=0,ru={};function Ewe(r,e,t){let n;typeof t=="string"?n=t.charCodeAt(0)||0:t.hasOwnProperty(C0)&&(n=t[C0]),n==null&&(n=t[C0]=kwe++);let o=n&yj,s=1<<o;e.data[r+(o>>xj)]|=s}function uT(r,e){let t=vj(r,e);if(t!==-1)return t;let n=e[Yt];n.firstCreatePass&&(r.injectorIndex=e.length,$M(n.data,r),$M(e,null),$M(n.blueprint,null));let o=iP(r,e),s=r.injectorIndex;if(gj(o)){let i=aT(o),a=cT(o,e),c=a[Yt].data;for(let l=0;l<8;l++)e[s+l]=a[i+l]|c[i+l]}return e[s+8]=o,s}function $M(r,e){r.push(0,0,0,0,0,0,0,0,e)}function vj(r,e){return r.injectorIndex===-1||r.parent&&r.parent.injectorIndex===r.injectorIndex||e[r.injectorIndex+8]===null?-1:r.injectorIndex}function iP(r,e){if(r.parent&&r.parent.injectorIndex!==-1)return r.parent.injectorIndex;let t=0,n=null,o=e;for(;o!==null;){if(n=Sj(o),n===null)return fx;if(t++,o=o[_x],n.injectorIndex!==-1)return n.injectorIndex|t<<16}return fx}function sF(r,e,t){Ewe(r,e,t)}function bj(r,e,t){if(t&rr.Optional||r!==void 0)return r;WF(e,"NodeInjector")}function wj(r,e,t,n){if(t&rr.Optional&&n===void 0&&(n=null),!(t&(rr.Self|rr.Host))){let o=r[xx],s=xi(void 0);try{return o?o.get(e,n,t&rr.Optional):w4(e,n,t&rr.Optional)}finally{xi(s)}}return bj(n,e,t)}function Cj(r,e,t,n=rr.Default,o){if(r!==null){if(e[Pt]&2048&&!(n&rr.Self)){let i=Rwe(r,e,t,n,ru);if(i!==ru)return i}let s=_j(r,e,t,n,ru);if(s!==ru)return s}return wj(e,t,n,o)}function _j(r,e,t,n,o){let s=Dwe(t);if(typeof s=="function"){if(!lj(e,r,n))return n&rr.Host?bj(o,t,n):wj(e,t,n,o);try{let i;if(i=s(n),i==null&&!(n&rr.Optional))WF(t);else return i}finally{hj()}}else if(typeof s=="number"){let i=null,a=vj(r,e),c=fx,l=n&rr.Host?e[ba][bi]:null;for((a===-1||n&rr.SkipSelf)&&(c=a===-1?iP(r,e):e[a+8],c===fx||!qW(n,!1)?a=-1:(i=e[Yt],a=aT(c),e=cT(c,e)));a!==-1;){let u=e[Yt];if(HW(s,a,u.data)){let p=Nwe(a,e,t,i,n,l);if(p!==ru)return p}c=e[a+8],c!==fx&&qW(n,e[Yt].data[a+8]===l)&&HW(s,a,e)?(i=u,a=aT(c),e=cT(c,e)):a=-1}}return o}function Nwe(r,e,t,n,o,s){let i=e[Yt],a=i.data[r+8],c=n==null?kT(a)&&oF:n!=i&&(a.type&3)!==0,l=o&rr.Host&&s===a,u=YI(a,i,t,c,l);return u!==null?Qm(e,i,u,a):ru}function YI(r,e,t,n,o){let s=r.providerIndexes,i=e.data,a=s&1048575,c=r.directiveStart,l=r.directiveEnd,u=s>>20,p=n?a:a+u,d=o?a+u:l;for(let h=p;h<d;h++){let f=i[h];if(h<c&&t===f||h>=c&&f.type===t)return h}if(o){let h=i[c];if(h&&gh(h)&&h.type===t)return c}return null}function Qm(r,e,t,n){let o=r[t],s=e.data;if(Cwe(o)){let i=o;i.resolving&&nbe(rbe(s[t]));let a=lT(i.canSeeViewProviders);i.resolving=!0;let c,l=i.injectImpl?xi(i.injectImpl):null,u=lj(r,n,rr.Default);try{o=r[t]=i.factory(void 0,s,r,n),e.firstCreatePass&&t>=n.directiveStart&&bwe(t,s[t],e)}finally{l!==null&&xi(l),lT(a),i.resolving=!1,hj()}}return o}function Dwe(r){if(typeof r=="string")return r.charCodeAt(0)||0;let e=r.hasOwnProperty(C0)?r[C0]:void 0;return typeof e=="number"?e>=0?e&yj:Awe:e}function HW(r,e,t){let n=1<<r;return!!(t[e+(r>>xj)]&n)}function qW(r,e){return!(r&rr.Self)&&!(r&rr.Host&&e)}var Wm=class{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,n){return Cj(this._tNode,this._lView,e,_T(n),t)}};function Awe(){return new Wm(wi(),Tr())}function Sx(r){return M0(()=>{let e=r.prototype.constructor,t=e[JI]||iF(e),n=Object.prototype,o=Object.getPrototypeOf(r.prototype).constructor;for(;o&&o!==n;){let s=o[JI]||iF(o);if(s&&s!==t)return s;o=Object.getPrototypeOf(o)}return s=>new s})}function iF(r){return m4(r)?()=>{let e=iF(Us(r));return e&&e()}:jm(r)}function Rwe(r,e,t,n,o){let s=r,i=e;for(;s!==null&&i!==null&&i[Pt]&2048&&!(i[Pt]&512);){let a=_j(s,i,t,n|rr.Self,ru);if(a!==ru)return a;let c=s.parent;if(!c){let l=i[U4];if(l){let u=l.get(t,ru,n);if(u!==ru)return u}c=Sj(i),i=i[_x]}s=c}return o}function Sj(r){let e=r[Yt],t=e.type;return t===2?e.declTNode:t===1?r[bi]:null}function KW(r,e=null,t=null,n){let o=Ij(r,e,t,n);return o.resolveInjectorInitializers(),o}function Ij(r,e=null,t=null,n,o=new Set){let s=[t||vi,Fbe(r)];return n=n||(typeof r=="object"?void 0:Gs(r)),new T0(s,e||XF(),n||null,o)}var Gm=class Gm{static create(e,t){if(Array.isArray(e))return KW({name:""},t,e,"");{let n=e.name??"";return KW({name:n},e.parent,e.providers,n)}}};Gm.THROW_IF_NOT_FOUND=S0,Gm.NULL=new rT,Gm.\u0275prov=st({token:Gm,providedIn:"any",factory:()=>Lt(T4)}),Gm.__NG_ELEMENT_ID__=-1;var yh=Gm;var Owe=new $t("");Owe.__NG_ELEMENT_ID__=r=>{let e=wi();if(e===null)throw new gt(204,!1);if(e.type&2)return e.value;if(r&rr.Optional)return null;throw new gt(204,!1)};var Mwe="ngOriginalError";function LM(r){return r[Mwe]}var Tj=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=Fwe,e.__NG_ENV_ID__=n=>n;let r=e;return r})(),aF=class extends Tj{constructor(e){super(),this._lView=e}onDestroy(e){return ej(this._lView,e),()=>rwe(this._lView,e)}};function Fwe(){return new aF(Tr())}var Ix=(()=>{let e=class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new ss(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};e.\u0275prov=st({token:e,providedIn:"root",factory:()=>new e});let r=e;return r})();var cF=class extends Yr{constructor(e=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=e,Hbe()&&(this.destroyRef=rt(Tj,{optional:!0})??void 0,this.pendingTasks=rt(Ix,{optional:!0})??void 0)}emit(e){let t=Dr(null);try{super.next(e)}finally{Dr(t)}}subscribe(e,t,n){let o=e,s=t||(()=>null),i=n;if(e&&typeof e=="object"){let c=e;o=c.next?.bind(c),s=c.error?.bind(c),i=c.complete?.bind(c)}this.__isAsync&&(s=this.wrapInTimeout(s),o&&(o=this.wrapInTimeout(o)),i&&(i=this.wrapInTimeout(i)));let a=super.subscribe({next:o,error:s,complete:i});return e instanceof Hn&&e.add(a),a}wrapInTimeout(e){return t=>{let n=this.pendingTasks?.add();setTimeout(()=>{e(t),n!==void 0&&this.pendingTasks?.remove(n)})}}},tn=cF;function pT(...r){}function kj(r){let e,t;function n(){r=pT;try{t!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(t),e!==void 0&&clearTimeout(e)}catch{}}return e=setTimeout(()=>{r(),n()}),typeof requestAnimationFrame=="function"&&(t=requestAnimationFrame(()=>{r(),n()})),()=>n()}function XW(r){return queueMicrotask(()=>r()),()=>{r=pT}}var aP="isAngularZone",dT=aP+"_ID",Pwe=0,Lo=class r{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tn(!1),this.onMicrotaskEmpty=new tn(!1),this.onStable=new tn(!1),this.onError=new tn(!1),typeof Zone>"u")throw new gt(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!n&&t,o.shouldCoalesceRunChangeDetection=n,o.callbackScheduled=!1,Vwe(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(aP)===!0}static assertInAngularZone(){if(!r.isInAngularZone())throw new gt(909,!1)}static assertNotInAngularZone(){if(r.isInAngularZone())throw new gt(909,!1)}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,o){let s=this._inner,i=s.scheduleEventTask("NgZoneEvent: "+o,e,$we,pT,pT);try{return s.runTask(i,t,n)}finally{s.cancelTask(i)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}},$we={};function cP(r){if(r._nesting==0&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Lwe(r){r.isCheckStableRunning||r.callbackScheduled||(r.callbackScheduled=!0,Zone.root.run(()=>{kj(()=>{r.callbackScheduled=!1,lF(r),r.isCheckStableRunning=!0,cP(r),r.isCheckStableRunning=!1})}),lF(r))}function Vwe(r){let e=()=>{Lwe(r)},t=Pwe++;r._inner=r._inner.fork({name:"angular",properties:{[aP]:!0,[dT]:t,[dT+t]:!0},onInvokeTask:(n,o,s,i,a,c)=>{if(Bwe(c))return n.invokeTask(s,i,a,c);try{return YW(r),n.invokeTask(s,i,a,c)}finally{(r.shouldCoalesceEventChangeDetection&&i.type==="eventTask"||r.shouldCoalesceRunChangeDetection)&&e(),ZW(r)}},onInvoke:(n,o,s,i,a,c,l)=>{try{return YW(r),n.invoke(s,i,a,c,l)}finally{r.shouldCoalesceRunChangeDetection&&!r.callbackScheduled&&!zwe(c)&&e(),ZW(r)}},onHasTask:(n,o,s,i)=>{n.hasTask(s,i),o===s&&(i.change=="microTask"?(r._hasPendingMicrotasks=i.microTask,lF(r),cP(r)):i.change=="macroTask"&&(r.hasPendingMacrotasks=i.macroTask))},onHandleError:(n,o,s,i)=>(n.handleError(s,i),r.runOutsideAngular(()=>r.onError.emit(i)),!1)})}function lF(r){r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&r.callbackScheduled===!0?r.hasPendingMicrotasks=!0:r.hasPendingMicrotasks=!1}function YW(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function ZW(r){r._nesting--,cP(r)}var uF=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tn,this.onMicrotaskEmpty=new tn,this.onStable=new tn,this.onError=new tn}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,o){return e.apply(t,n)}};function Bwe(r){return Ej(r,"__ignore_ng_zone__")}function zwe(r){return Ej(r,"__scheduler_tick__")}function Ej(r,e){return!Array.isArray(r)||r.length!==1?!1:r[0]?.data?.[e]===!0}var xh=class{constructor(){this._console=console}handleError(e){let t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&LM(e);for(;t&&LM(t);)t=LM(t);return t||null}},Uwe=new $t("",{providedIn:"root",factory:()=>{let r=rt(Lo),e=rt(xh);return t=>r.runOutsideAngular(()=>e.handleError(t))}});function Gwe(){return Tx(wi(),Tr())}function Tx(r,e){return new iu(Ca(r,e))}var iu=(()=>{let e=class e{constructor(n){this.nativeElement=n}};e.__NG_ELEMENT_ID__=Gwe;let r=e;return r})();function Wwe(r){return r instanceof iu?r.nativeElement:r}function jwe(){return this._results[Symbol.iterator]()}var pF=class r{get changes(){return this._changes??=new tn}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let t=r.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=jwe)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){this.dirty=!1;let n=fbe(e);(this._changesDetected=!hbe(this._results,n,t))&&(this._results=n,this.length=n.length,this.last=n[this.length-1],this.first=n[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function Nj(r){return(r.flags&128)===128}var Dj=new Map,Hwe=0;function qwe(){return Hwe++}function Kwe(r){Dj.set(r[TT],r)}function Xwe(r){Dj.delete(r[TT])}var QW="__ngContext__";function Jm(r,e){fh(e)?(r[QW]=e[TT],Kwe(e)):r[QW]=e}function Aj(r){return Oj(r[E0])}function Rj(r){return Oj(r[hc])}function Oj(r){for(;r!==null&&!Qp(r);)r=r[hc];return r}var dF;function Mj(r){dF=r}function Ywe(){if(dF!==void 0)return dF;if(typeof document<"u")return document;throw new gt(210,!1)}var lP=new $t("",{providedIn:"root",factory:()=>Zwe}),Zwe="ng",uP=new $t(""),kx=new $t("",{providedIn:"platform",factory:()=>"unknown"});var pP=new $t("",{providedIn:"root",factory:()=>Ywe().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Qwe="h",Jwe="b";var e0e=()=>null;function dP(r,e,t=!1){return e0e(r,e,t)}var Fj=!1,t0e=new $t("",{providedIn:"root",factory:()=>Fj});var hF=class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Hve})`}};function $0(r){return r instanceof hF?r.changingThisBreaksApplicationSecurity:r}function Pj(r){return r.ownerDocument}function $j(r){return r instanceof Function?r():r}var Kp=function(r){return r[r.Important=1]="Important",r[r.DashCase=2]="DashCase",r}(Kp||{}),r0e;function hP(r,e){return r0e(r,e)}function dx(r,e,t,n,o){if(n!=null){let s,i=!1;Qp(n)?s=n:fh(n)&&(i=!0,n=n[Zp]);let a=ou(n);r===0&&t!==null?o==null?Gj(e,t,a):hT(e,t,a,o||null,!0):r===1&&t!==null?hT(e,t,a,o||null,!0):r===2?m0e(e,a,i):r===3&&e.destroyNode(a),s!=null&&y0e(e,r,s,t,o)}}function n0e(r,e){return r.createText(e)}function o0e(r,e,t){r.setValue(e,t)}function Lj(r,e,t){return r.createElement(e,t)}function s0e(r,e){Vj(r,e),e[Zp]=null,e[bi]=null}function i0e(r,e,t,n,o,s){n[Zp]=o,n[bi]=e,DT(r,n,t,1,o,s)}function Vj(r,e){e[Hp].changeDetectionScheduler?.notify(8),DT(r,e,e[io],2,null,null)}function a0e(r){let e=r[E0];if(!e)return VM(r[Yt],r);for(;e;){let t=null;if(fh(e))t=e[E0];else{let n=e[Yi];n&&(t=n)}if(!t){for(;e&&!e[hc]&&e!==r;)fh(e)&&VM(e[Yt],e),e=e[bs];e===null&&(e=r),fh(e)&&VM(e[Yt],e),t=e&&e[hc]}e=t}}function c0e(r,e,t,n){let o=Yi+n,s=t.length;n>0&&(t[o-1][hc]=e),n<s-Yi?(e[hc]=t[o],S4(t,Yi+n,e)):(t.push(e),e[hc]=null),e[bs]=t;let i=e[qm];i!==null&&t!==i&&Bj(i,e);let a=e[qp];a!==null&&a.insertView(r),tF(e),e[Pt]|=128}function Bj(r,e){let t=r[vx],n=e[bs];if(fh(n))r[Pt]|=sT.HasTransplantedViews;else{let o=n[bs][ba];e[ba]!==o&&(r[Pt]|=sT.HasTransplantedViews)}t===null?r[vx]=[e]:t.push(e)}function fP(r,e){let t=r[vx],n=t.indexOf(e);t.splice(n,1)}function fF(r,e){if(r.length<=Yi)return;let t=Yi+e,n=r[t];if(n){let o=n[qm];o!==null&&o!==r&&fP(o,n),e>0&&(r[t-1][hc]=n[hc]);let s=tT(r,Yi+e);s0e(n[Yt],n);let i=s[qp];i!==null&&i.detachView(s[Yt]),n[bs]=null,n[hc]=null,n[Pt]&=-129}return n}function zj(r,e){if(!(e[Pt]&256)){let t=e[io];t.destroyNode&&DT(r,e,t,3,null,null),a0e(e)}}function VM(r,e){if(e[Pt]&256)return;let t=Dr(null);try{e[Pt]&=-129,e[Pt]|=256,e[xa]&&hM(e[xa]),u0e(r,e),l0e(r,e),e[Yt].type===1&&e[io].destroy();let n=e[qm];if(n!==null&&Qp(e[bs])){n!==e[bs]&&fP(n,e);let o=e[qp];o!==null&&o.detachView(r)}Xwe(e)}finally{Dr(t)}}function l0e(r,e){let t=r.cleanup,n=e[nT];if(t!==null)for(let s=0;s<t.length-1;s+=2)if(typeof t[s]=="string"){let i=t[s+3];i>=0?n[i]():n[-i].unsubscribe(),s+=2}else{let i=n[t[s+1]];t[s].call(i)}n!==null&&(e[nT]=null);let o=e[hh];if(o!==null){e[hh]=null;for(let s=0;s<o.length;s++){let i=o[s];i()}}}function u0e(r,e){let t;if(r!=null&&(t=r.destroyHooks)!=null)for(let n=0;n<t.length;n+=2){let o=e[t[n]];if(!(o instanceof Zm)){let s=t[n+1];if(Array.isArray(s))for(let i=0;i<s.length;i+=2){let a=o[s[i]],c=s[i+1];tu(4,a,c);try{c.call(a)}finally{tu(5,a,c)}}else{tu(4,o,s);try{s.call(o)}finally{tu(5,o,s)}}}}}function Uj(r,e,t){return p0e(r,e.parent,t)}function p0e(r,e,t){let n=e;for(;n!==null&&n.type&168;)e=n,n=e.parent;if(n===null)return t[Zp];{let{componentOffset:o}=n;if(o>-1){let{encapsulation:s}=r.data[n.directiveStart+o];if(s===nu.None||s===nu.Emulated)return null}return Ca(n,t)}}function hT(r,e,t,n,o){r.insertBefore(e,t,n,o)}function Gj(r,e,t){r.appendChild(e,t)}function JW(r,e,t,n,o){n!==null?hT(r,e,t,n,o):Gj(r,e,t)}function Wj(r,e){return r.parentNode(e)}function d0e(r,e){return r.nextSibling(e)}function jj(r,e,t){return f0e(r,e,t)}function h0e(r,e,t){return r.type&40?Ca(r,t):null}var f0e=h0e,e4;function mP(r,e,t,n){let o=Uj(r,n,e),s=e[io],i=n.parent||e[bi],a=jj(i,n,e);if(o!=null)if(Array.isArray(t))for(let c=0;c<t.length;c++)JW(s,o,t[c],a,!1);else JW(s,o,t,a,!1);e4!==void 0&&e4(s,n,e,t,o)}function w0(r,e){if(e!==null){let t=e.type;if(t&3)return Ca(e,r);if(t&4)return mF(-1,r[e.index]);if(t&8){let n=e.child;if(n!==null)return w0(r,n);{let o=r[e.index];return Qp(o)?mF(-1,o):ou(o)}}else{if(t&128)return w0(r,e.next);if(t&32)return hP(e,r)()||ou(r[e.index]);{let n=Hj(r,e);if(n!==null){if(Array.isArray(n))return n[0];let o=Xm(r[ba]);return w0(o,n)}else return w0(r,e.next)}}}return null}function Hj(r,e){if(e!==null){let n=r[ba][bi],o=e.projection;return n.projection[o]}return null}function mF(r,e){let t=Yi+r+1;if(t<e.length){let n=e[t],o=n[Yt].firstChild;if(o!==null)return w0(n,o)}return e[Km]}function m0e(r,e,t){r.removeChild(null,e,t)}function gP(r,e,t,n,o,s,i){for(;t!=null;){if(t.type===128){t=t.next;continue}let a=n[t.index],c=t.type;if(i&&e===0&&(a&&Jm(ou(a),n),t.flags|=2),(t.flags&32)!==32)if(c&8)gP(r,e,t.child,n,o,s,!1),dx(e,r,o,a,s);else if(c&32){let l=hP(t,n),u;for(;u=l();)dx(e,r,o,u,s);dx(e,r,o,a,s)}else c&16?qj(r,e,n,t,o,s):dx(e,r,o,a,s);t=i?t.projectionNext:t.next}}function DT(r,e,t,n,o,s){gP(t,n,r.firstChild,e,o,s,!1)}function g0e(r,e,t){let n=e[io],o=Uj(r,t,e),s=t.parent||e[bi],i=jj(s,t,e);qj(n,0,e,t,o,i)}function qj(r,e,t,n,o,s){let i=t[ba],c=i[bi].projection[n.projection];if(Array.isArray(c))for(let l=0;l<c.length;l++){let u=c[l];dx(e,r,o,u,s)}else{let l=c,u=i[bs];Nj(n)&&(l.flags|=128),gP(r,e,l,u,o,s,!0)}}function y0e(r,e,t,n,o){let s=t[Km],i=ou(t);s!==i&&dx(e,r,n,s,o);for(let a=Yi;a<t.length;a++){let c=t[a];DT(c[Yt],c,r,e,n,s)}}function x0e(r,e,t,n,o){if(e)o?r.addClass(t,n):r.removeClass(t,n);else{let s=n.indexOf("-")===-1?void 0:Kp.DashCase;o==null?r.removeStyle(t,n,s):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),s|=Kp.Important),r.setStyle(t,n,o,s))}}function v0e(r,e,t){r.setAttribute(e,"style",t)}function Kj(r,e,t){t===""?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t)}function Xj(r,e,t){let{mergedAttrs:n,classes:o,styles:s}=t;n!==null&&XM(r,e,n),o!==null&&Kj(r,e,o),s!==null&&v0e(r,e,s)}var gc={};function It(r=1){Yj(qo(),Tr(),wh()+r,!1)}function Yj(r,e,t,n){if(!n)if((e[Pt]&3)===3){let s=r.preOrderCheckHooks;s!==null&&KI(e,s,t)}else{let s=r.preOrderHooks;s!==null&&XI(e,s,0,t)}Ym(t)}function We(r,e=rr.Default){let t=Tr();if(t===null)return Lt(r,e);let n=wi();return Cj(n,t,Us(r),e)}function Zj(r,e,t,n,o,s){let i=Dr(null);try{let a=null;o&mh.SignalBased&&(a=e[n][jp]),a!==null&&a.transformFn!==void 0&&(s=a.transformFn(s)),o&mh.HasDecoratorInputTransform&&(s=r.inputTransforms[n].call(e,s)),r.setInput!==null?r.setInput(e,a,s,t,n):j4(e,a,n,s)}finally{Dr(i)}}function b0e(r,e){let t=r.hostBindingOpCodes;if(t!==null)try{for(let n=0;n<t.length;n++){let o=t[n];if(o<0)Ym(~o);else{let s=o,i=t[++n],a=t[++n];hwe(i,s);let c=e[s];a(2,c)}}}finally{Ym(-1)}}function AT(r,e,t,n,o,s,i,a,c,l,u){let p=e.blueprint.slice();return p[Zp]=o,p[Pt]=n|4|128|8|64,(l!==null||r&&r[Pt]&2048)&&(p[Pt]|=2048),Q4(p),p[bs]=p[_x]=r,p[fc]=t,p[Hp]=i||r&&r[Hp],p[io]=a||r&&r[io],p[xx]=c||r&&r[xx]||null,p[bi]=s,p[TT]=qwe(),p[k0]=u,p[U4]=l,p[ba]=e.type==2?r[ba]:p,p}function L0(r,e,t,n,o){let s=r.data[e];if(s===null)s=w0e(r,e,t,n,o),dwe()&&(s.flags|=32);else if(s.type&64){s.type=t,s.value=n,s.attrs=o;let i=cwe();s.injectorIndex=i===null?-1:i.injectorIndex}return P0(s,!0),s}function w0e(r,e,t,n,o){let s=oj(),i=sj(),a=i?s:s&&s.parent,c=r.data[e]=k0e(r,a,t,e,n,o);return r.firstChild===null&&(r.firstChild=c),s!==null&&(i?s.child==null&&c.parent!==null&&(s.child=c):s.next===null&&(s.next=c,c.prev=s)),c}function Qj(r,e,t,n){if(t===0)return-1;let o=e.length;for(let s=0;s<t;s++)e.push(n),r.blueprint.push(n),r.data.push(null);return o}function Jj(r,e,t,n,o){let s=wh(),i=n&2;try{Ym(-1),i&&e.length>wa&&Yj(r,e,wa,!1),tu(i?2:0,o),t(n,o)}finally{Ym(s),tu(i?3:1,o)}}function eH(r,e,t){if(W4(e)){let n=Dr(null);try{let o=e.directiveStart,s=e.directiveEnd;for(let i=o;i<s;i++){let a=r.data[i];if(a.contentQueries){let c=t[i];a.contentQueries(1,c,i)}}}finally{Dr(n)}}}function tH(r,e,t){rj()&&(O0e(r,e,t,Ca(t,e)),(t.flags&64)===64&&aH(r,e,t))}function rH(r,e,t=Ca){let n=e.localNames;if(n!==null){let o=e.index+1;for(let s=0;s<n.length;s+=2){let i=n[s+1],a=i===-1?t(e,r):r[i];r[o++]=a}}}function nH(r){let e=r.tView;return e===null||e.incompleteFirstPass?r.tView=yP(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts,r.id):e}function yP(r,e,t,n,o,s,i,a,c,l,u){let p=wa+n,d=p+o,h=C0e(p,d),f=typeof l=="function"?l():l;return h[Yt]={type:r,blueprint:h,template:t,queries:null,viewQuery:a,declTNode:e,data:h.slice().fill(null,p),bindingStartIndex:p,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof i=="function"?i():i,firstChild:null,schemas:c,consts:f,incompleteFirstPass:!1,ssrId:u}}function C0e(r,e){let t=[];for(let n=0;n<e;n++)t.push(n<r?null:gc);return t}function _0e(r,e,t,n){let s=n.get(t0e,Fj)||t===nu.ShadowDom,i=r.selectRootElement(e,s);return S0e(i),i}function S0e(r){I0e(r)}var I0e=()=>null;function T0e(r,e,t,n){let o=uH(e);o.push(t),r.firstCreatePass&&pH(r).push(n,o.length-1)}function k0e(r,e,t,n,o,s){let i=e?e.injectorIndex:-1,a=0;return nj()&&(a|=128),{type:t,index:n,insertBeforeIndex:null,injectorIndex:i,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function t4(r,e,t,n,o){for(let s in e){if(!e.hasOwnProperty(s))continue;let i=e[s];if(i===void 0)continue;n??={};let a,c=mh.None;Array.isArray(i)?(a=i[0],c=i[1]):a=i;let l=s;if(o!==null){if(!o.hasOwnProperty(s))continue;l=o[s]}r===0?r4(n,t,l,a,c):r4(n,t,l,a)}return n}function r4(r,e,t,n,o){let s;r.hasOwnProperty(t)?(s=r[t]).push(e,n):s=r[t]=[e,n],o!==void 0&&s.push(o)}function E0e(r,e,t){let n=e.directiveStart,o=e.directiveEnd,s=r.data,i=e.attrs,a=[],c=null,l=null;for(let u=n;u<o;u++){let p=s[u],d=t?t.get(p):null,h=d?d.inputs:null,f=d?d.outputs:null;c=t4(0,p.inputs,u,c,h),l=t4(1,p.outputs,u,l,f);let m=c!==null&&i!==null&&!qF(e)?W0e(c,u,i):null;a.push(m)}c!==null&&(c.hasOwnProperty("class")&&(e.flags|=8),c.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=c,e.outputs=l}function N0e(r){return r==="class"?"className":r==="for"?"htmlFor":r==="formaction"?"formAction":r==="innerHtml"?"innerHTML":r==="readonly"?"readOnly":r==="tabindex"?"tabIndex":r}function oH(r,e,t,n,o,s,i,a){let c=Ca(e,t),l=e.inputs,u;!a&&l!=null&&(u=l[n])?(xP(r,t,u,n,o),kT(e)&&D0e(t,e.index)):e.type&3?(n=N0e(n),o=i!=null?i(o,e.value||"",n):o,s.setProperty(c,n,o)):e.type&12}function D0e(r,e){let t=bh(e,r);t[Pt]&16||(t[Pt]|=64)}function sH(r,e,t,n){if(rj()){let o=n===null?null:{"":-1},s=F0e(r,t),i,a;s===null?i=a=null:[i,a]=s,i!==null&&iH(r,e,t,i,o,a),o&&P0e(t,n,o)}t.mergedAttrs=I0(t.mergedAttrs,t.attrs)}function iH(r,e,t,n,o,s){for(let l=0;l<n.length;l++)sF(uT(t,e),r,n[l].type);L0e(t,r.data.length,n.length);for(let l=0;l<n.length;l++){let u=n[l];u.providersResolver&&u.providersResolver(u)}let i=!1,a=!1,c=Qj(r,e,n.length,null);for(let l=0;l<n.length;l++){let u=n[l];t.mergedAttrs=I0(t.mergedAttrs,u.hostAttrs),V0e(r,t,e,c,u),$0e(c,u,o),u.contentQueries!==null&&(t.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(t.flags|=64);let p=u.type.prototype;!i&&(p.ngOnChanges||p.ngOnInit||p.ngDoCheck)&&((r.preOrderHooks??=[]).push(t.index),i=!0),!a&&(p.ngOnChanges||p.ngDoCheck)&&((r.preOrderCheckHooks??=[]).push(t.index),a=!0),c++}E0e(r,t,s)}function A0e(r,e,t,n,o){let s=o.hostBindings;if(s){let i=r.hostBindingOpCodes;i===null&&(i=r.hostBindingOpCodes=[]);let a=~e.index;R0e(i)!=a&&i.push(a),i.push(t,n,s)}}function R0e(r){let e=r.length;for(;e>0;){let t=r[--e];if(typeof t=="number"&&t<0)return t}return 0}function O0e(r,e,t,n){let o=t.directiveStart,s=t.directiveEnd;kT(t)&&B0e(e,t,r.data[o+t.componentOffset]),r.firstCreatePass||uT(t,e),Jm(n,e);let i=t.initialInputs;for(let a=o;a<s;a++){let c=r.data[a],l=Qm(e,r,a,t);if(Jm(l,e),i!==null&&G0e(e,a-o,l,c,t,i),gh(c)){let u=bh(t.index,e);u[fc]=Qm(e,r,a,t)}}}function aH(r,e,t){let n=t.directiveStart,o=t.directiveEnd,s=t.index,i=fwe();try{Ym(s);for(let a=n;a<o;a++){let c=r.data[a],l=e[a];rF(a),(c.hostBindings!==null||c.hostVars!==0||c.hostAttrs!==null)&&M0e(c,l)}}finally{Ym(-1),rF(i)}}function M0e(r,e){r.hostBindings!==null&&r.hostBindings(1,e)}function F0e(r,e){let t=r.directiveRegistry,n=null,o=null;if(t)for(let s=0;s<t.length;s++){let i=t[s];if(D4(e,i.selectors,!1))if(n||(n=[]),gh(i))if(i.findHostDirectiveDefs!==null){let a=[];o=o||new Map,i.findHostDirectiveDefs(i,a,o),n.unshift(...a,i);let c=a.length;gF(r,e,c)}else n.unshift(i),gF(r,e,0);else o=o||new Map,i.findHostDirectiveDefs?.(i,n,o),n.push(i)}return n===null?null:[n,o]}function gF(r,e,t){e.componentOffset=t,(r.components??=[]).push(e.index)}function P0e(r,e,t){if(e){let n=r.localNames=[];for(let o=0;o<e.length;o+=2){let s=t[e[o+1]];if(s==null)throw new gt(-301,!1);n.push(e[o],s)}}}function $0e(r,e,t){if(t){if(e.exportAs)for(let n=0;n<e.exportAs.length;n++)t[e.exportAs[n]]=r;gh(e)&&(t[""]=r)}}function L0e(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function V0e(r,e,t,n,o){r.data[n]=o;let s=o.factory||(o.factory=jm(o.type,!0)),i=new Zm(s,gh(o),We);r.blueprint[n]=i,t[n]=i,A0e(r,e,n,Qj(r,t,o.hostVars,gc),o)}function B0e(r,e,t){let n=Ca(e,r),o=nH(t),s=r[Hp].rendererFactory,i=16;t.signals?i=4096:t.onPush&&(i=64);let a=RT(r,AT(r,o,null,i,n,e,null,s.createRenderer(n,t),null,null,null));r[e.index]=a}function z0e(r,e,t,n,o,s){let i=Ca(r,e);U0e(e[io],i,s,r.value,t,n,o)}function U0e(r,e,t,n,o,s,i){if(s==null)r.removeAttribute(e,o,t);else{let a=i==null?_0(s):i(s,n||"",o);r.setAttribute(e,o,a,t)}}function G0e(r,e,t,n,o,s){let i=s[e];if(i!==null)for(let a=0;a<i.length;){let c=i[a++],l=i[a++],u=i[a++],p=i[a++];Zj(n,t,c,l,u,p)}}function W0e(r,e,t){let n=null,o=0;for(;o<t.length;){let s=t[o];if(s===0){o+=4;continue}else if(s===5){o+=2;continue}if(typeof s=="number")break;if(r.hasOwnProperty(s)){n===null&&(n=[]);let i=r[s];for(let a=0;a<i.length;a+=3)if(i[a]===e){n.push(s,i[a+1],i[a+2],t[o+1]);break}}o+=2}return n}function cH(r,e,t,n){return[r,!0,0,e,null,n,null,t,null,null]}function lH(r,e){let t=r.contentQueries;if(t!==null){let n=Dr(null);try{for(let o=0;o<t.length;o+=2){let s=t[o],i=t[o+1];if(i!==-1){let a=r.data[i];JF(s),a.contentQueries(2,e[i],i)}}}finally{Dr(n)}}}function RT(r,e){return r[E0]?r[UW][hc]=e:r[E0]=e,r[UW]=e,e}function yF(r,e,t){JF(0);let n=Dr(null);try{e(r,t)}finally{Dr(n)}}function uH(r){return r[nT]??=[]}function pH(r){return r.cleanup??=[]}function dH(r,e){let t=r[xx],n=t?t.get(xh,null):null;n&&n.handleError(e)}function xP(r,e,t,n,o){for(let s=0;s<t.length;){let i=t[s++],a=t[s++],c=t[s++],l=e[i],u=r.data[i];Zj(u,l,n,a,c,o)}}function hH(r,e,t){let n=Y4(e,r);o0e(r[io],n,t)}function j0e(r,e){let t=bh(e,r),n=t[Yt];H0e(n,t);let o=t[Zp];o!==null&&t[k0]===null&&(t[k0]=dP(o,t[xx])),vP(n,t,t[fc])}function H0e(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])}function vP(r,e,t){eP(e);try{let n=r.viewQuery;n!==null&&yF(1,n,t);let o=r.template;o!==null&&Jj(r,e,o,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),e[qp]?.finishViewCreation(r),r.staticContentQueries&&lH(r,e),r.staticViewQueries&&yF(2,r.viewQuery,t);let s=r.components;s!==null&&q0e(e,s)}catch(n){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),n}finally{e[Pt]&=-5,tP()}}function q0e(r,e){for(let t=0;t<e.length;t++)j0e(r,e[t])}function fH(r,e,t,n){let o=Dr(null);try{let s=e.tView,a=r[Pt]&4096?4096:16,c=AT(r,s,t,a,null,e,null,null,n?.injector??null,n?.embeddedViewInjector??null,n?.dehydratedView??null),l=r[e.index];c[qm]=l;let u=r[qp];return u!==null&&(c[qp]=u.createEmbeddedView(s)),vP(s,c,t),c}finally{Dr(o)}}function xF(r,e){return!e||e.firstChild===null||Nj(r)}function mH(r,e,t,n=!0){let o=e[Yt];if(c0e(o,e,r,t),n){let i=mF(t,r),a=e[io],c=Wj(a,r[Km]);c!==null&&i0e(o,r[bi],a,e,c,i)}let s=e[k0];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function fT(r,e,t,n,o=!1){for(;t!==null;){if(t.type===128){t=o?t.projectionNext:t.next;continue}let s=e[t.index];s!==null&&n.push(ou(s)),Qp(s)&&K0e(s,n);let i=t.type;if(i&8)fT(r,e,t.child,n);else if(i&32){let a=hP(t,e),c;for(;c=a();)n.push(c)}else if(i&16){let a=Hj(e,t);if(Array.isArray(a))n.push(...a);else{let c=Xm(e[ba]);fT(c[Yt],c,a,n,!0)}}t=o?t.projectionNext:t.next}return n}function K0e(r,e){for(let t=Yi;t<r.length;t++){let n=r[t],o=n[Yt].firstChild;o!==null&&fT(n[Yt],n,o,e)}r[Km]!==r[Zp]&&e.push(r[Km])}var gH=[];function X0e(r){return r[xa]??Y0e(r)}function Y0e(r){let e=gH.pop()??Object.create(Q0e);return e.lView=r,e}function Z0e(r){r.lView[xa]!==r&&(r.lView=null,gH.push(r))}var Q0e=$e(ie({},m0),{consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{ET(r.lView)},consumerOnSignalRead(){this.lView[xa]=this}});function J0e(r){let e=r[xa]??Object.create(eCe);return e.lView=r,e}var eCe=$e(ie({},m0),{consumerIsAlwaysLive:!0,consumerMarkedDirty:r=>{let e=Xm(r.lView);for(;e&&!yH(e[Yt]);)e=Xm(e);e&&J4(e)},consumerOnSignalRead(){this.lView[xa]=this}});function yH(r){return r.type!==2}var tCe=100;function xH(r,e=!0,t=0){let n=r[Hp],o=n.rendererFactory,s=!1;s||o.begin?.();try{rCe(r,t)}catch(i){throw e&&dH(r,i),i}finally{s||(o.end?.(),n.inlineEffectRunner?.flush())}}function rCe(r,e){let t=aj();try{WW(!0),vF(r,e);let n=0;for(;N0(r);){if(n===tCe)throw new gt(103,!1);n++,vF(r,1)}}finally{WW(t)}}function nCe(r,e,t,n){let o=e[Pt];if((o&256)===256)return;let s=!1,i=!1;!s&&e[Hp].inlineEffectRunner?.flush(),eP(e);let a=!0,c=null,l=null;s||(yH(r)?(l=X0e(e),c=dI(l)):XG()===null?(a=!1,l=J0e(e),c=dI(l)):e[xa]&&(hM(e[xa]),e[xa]=null));try{Q4(e),pwe(r.bindingStartIndex),t!==null&&Jj(r,e,t,2,n);let u=(o&3)===3;if(!s)if(u){let h=r.preOrderCheckHooks;h!==null&&KI(e,h,null)}else{let h=r.preOrderHooks;h!==null&&XI(e,h,0,null),FM(e,0)}if(i||oCe(e),vH(e,0),r.contentQueries!==null&&lH(r,e),!s)if(u){let h=r.contentCheckHooks;h!==null&&KI(e,h)}else{let h=r.contentHooks;h!==null&&XI(e,h,1),FM(e,1)}b0e(r,e);let p=r.components;p!==null&&wH(e,p,0);let d=r.viewQuery;if(d!==null&&yF(2,d,n),!s)if(u){let h=r.viewCheckHooks;h!==null&&KI(e,h)}else{let h=r.viewHooks;h!==null&&XI(e,h,2),FM(e,2)}if(r.firstUpdatePass===!0&&(r.firstUpdatePass=!1),e[MM]){for(let h of e[MM])h();e[MM]=null}s||(e[Pt]&=-73)}catch(u){throw s||ET(e),u}finally{l!==null&&(pM(l,c),a&&Z0e(l)),tP()}}function vH(r,e){for(let t=Aj(r);t!==null;t=Rj(t))for(let n=Yi;n<t.length;n++){let o=t[n];bH(o,e)}}function oCe(r){for(let e=Aj(r);e!==null;e=Rj(e)){if(!(e[Pt]&sT.HasTransplantedViews))continue;let t=e[vx];for(let n=0;n<t.length;n++){let o=t[n];J4(o)}}}function sCe(r,e,t){let n=bh(e,r);bH(n,t)}function bH(r,e){ZF(r)&&vF(r,e)}function vF(r,e){let n=r[Yt],o=r[Pt],s=r[xa],i=!!(e===0&&o&16);if(i||=!!(o&64&&e===0),i||=!!(o&1024),i||=!!(s?.dirty&&dM(s)),i||=!1,s&&(s.dirty=!1),r[Pt]&=-9217,i)nCe(n,r,n.template,r[fc]);else if(o&8192){vH(r,1);let a=n.components;a!==null&&wH(r,a,1)}}function wH(r,e,t){for(let n=0;n<e.length;n++)sCe(r,e[n],t)}function bP(r,e){let t=aj()?64:1088;for(r[Hp].changeDetectionScheduler?.notify(e);r;){r[Pt]|=t;let n=Xm(r);if(JM(r)&&!n)return r;r=n}return null}var eg=class{get rootNodes(){let e=this._lView,t=e[Yt];return fT(t,e,t.firstChild,[])}constructor(e,t,n=!0){this._lView=e,this._cdRefInjectingView=t,this.notifyErrorHandler=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[fc]}set context(e){this._lView[fc]=e}get destroyed(){return(this._lView[Pt]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[bs];if(Qp(e)){let t=e[oT],n=t?t.indexOf(this):-1;n>-1&&(fF(e,n),tT(t,n))}this._attachedToViewContainer=!1}zj(this._lView[Yt],this._lView)}onDestroy(e){ej(this._lView,e)}markForCheck(){bP(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Pt]&=-129}reattach(){tF(this._lView),this._lView[Pt]|=128}detectChanges(){this._lView[Pt]|=1024,xH(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new gt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let e=JM(this._lView),t=this._lView[qm];t!==null&&!e&&fP(t,this._lView),Vj(this._lView[Yt],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new gt(902,!1);this._appRef=e;let t=JM(this._lView),n=this._lView[qm];n!==null&&!t&&Bj(n,this._lView),tF(this._lView)}},tg=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=cCe;let r=e;return r})(),iCe=tg,aCe=class extends iCe{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,t){return this.createEmbeddedViewImpl(e,t)}createEmbeddedViewImpl(e,t,n){let o=fH(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:t,dehydratedView:n});return new eg(o)}};function cCe(){return wP(wi(),Tr())}function wP(r,e){return r.type&4?new aCe(e,r,Tx(r,e)):null}var Ctt=new RegExp(`^(\\d+)*(${Jwe}|${Qwe})*(.*)`);var lCe=()=>null;function bF(r,e){return lCe(r,e)}var D0=class{},CP=new $t("",{providedIn:"root",factory:()=>!1});var CH=new $t(""),wF=class{},mT=class{};function uCe(r){let e=Error(`No component factory found for ${Gs(r)}.`);return e[pCe]=r,e}var pCe="ngComponent";var CF=class{resolveComponentFactory(e){throw uCe(e)}},OP=class OP{};OP.NULL=new CF;var bx=OP,wx=class{},Ex=(()=>{let e=class e{constructor(){this.destroyNode=null}};e.__NG_ELEMENT_ID__=()=>dCe();let r=e;return r})();function dCe(){let r=Tr(),e=wi(),t=bh(e.index,r);return(fh(t)?t:r)[io]}var hCe=(()=>{let e=class e{};e.\u0275prov=st({token:e,providedIn:"root",factory:()=>null});let r=e;return r})();var n4=new Set;function V0(r){n4.has(r)||(n4.add(r),performance?.mark?.("mark_feature_usage",{detail:{feature:r}}))}var _H=(()=>{let e=class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let n=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let o of n)o()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};e.\u0275prov=st({token:e,providedIn:"root",factory:()=>new e});let r=e;return r})();function _F(r,e,t){let n=t?r.styles:null,o=t?r.classes:null,s=0;if(e!==null)for(let i=0;i<e.length;i++){let a=e[i];if(typeof a=="number")s=a;else if(s==1)o=jM(o,a);else if(s==2){let c=a,l=e[++i];n=jM(n,c+": "+l+";")}}t?r.styles=n:r.stylesWithoutHost=n,t?r.classes=o:r.classesWithoutHost=o}var gT=class extends bx{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let t=Hm(e);return new A0(t,this.ngModule)}};function o4(r,e){let t=[];for(let n in r){if(!r.hasOwnProperty(n))continue;let o=r[n];if(o===void 0)continue;let s=Array.isArray(o),i=s?o[0]:o,a=s?o[1]:mh.None;e?t.push({propName:i,templateName:n,isSignal:(a&mh.SignalBased)!==0}):t.push({propName:i,templateName:n})}return t}function fCe(r){let e=r.toLowerCase();return e==="svg"?X4:e==="math"?Zbe:null}var A0=class extends mT{get inputs(){let e=this.componentDef,t=e.inputTransforms,n=o4(e.inputs,!0);if(t!==null)for(let o of n)t.hasOwnProperty(o.propName)&&(o.transform=t[o.propName]);return n}get outputs(){return o4(this.componentDef.outputs,!1)}constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=Dbe(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}create(e,t,n,o){let s=Dr(null);try{o=o||this.ngModule;let i=o instanceof va?o:o?.injector;i&&this.componentDef.getStandaloneInjector!==null&&(i=this.componentDef.getStandaloneInjector(i)||i);let a=i?new nF(e,i):e,c=a.get(wx,null);if(c===null)throw new gt(407,!1);let l=a.get(hCe,null),u=a.get(_H,null),p=a.get(D0,null),d={rendererFactory:c,sanitizer:l,inlineEffectRunner:null,afterRenderEventManager:u,changeDetectionScheduler:p},h=c.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=n?_0e(h,n,this.componentDef.encapsulation,a):Lj(h,f,fCe(f)),g=512;this.componentDef.signals?g|=4096:this.componentDef.onPush||(g|=16);let y=null;m!==null&&(y=dP(m,a,!0));let x=yP(0,null,null,1,0,null,null,null,null,null,null),b=AT(null,x,null,g,null,null,d,h,a,null,y);eP(b);let w,_;try{let I=this.componentDef,S,k=null;I.findHostDirectiveDefs?(S=[],k=new Map,I.findHostDirectiveDefs(I,S,k),S.push(I)):S=[I];let R=mCe(b,m),L=gCe(R,m,I,S,b,d,h);_=Z4(x,wa),m&&vCe(h,I,m,n),t!==void 0&&bCe(_,this.ngContentSelectors,t),w=xCe(L,I,S,k,b,[wCe]),vP(x,b,null)}finally{tP()}return new SF(this.componentType,w,Tx(_,b),b,_)}finally{Dr(s)}}},SF=class extends wF{constructor(e,t,n,o,s){super(),this.location=n,this._rootLView=o,this._tNode=s,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new eg(o,void 0,!1),this.componentType=e}setInput(e,t){let n=this._tNode.inputs,o;if(n!==null&&(o=n[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),t))return;let s=this._rootLView;xP(s[Yt],s,o,e,t),this.previousInputValues.set(e,t);let i=bh(this._tNode.index,s);bP(i,1)}}get injector(){return new Wm(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function mCe(r,e){let t=r[Yt],n=wa;return r[n]=e,L0(t,n,2,"#host",null)}function gCe(r,e,t,n,o,s,i){let a=o[Yt];yCe(n,r,e,i);let c=null;e!==null&&(c=dP(e,o[xx]));let l=s.rendererFactory.createRenderer(e,t),u=16;t.signals?u=4096:t.onPush&&(u=64);let p=AT(o,nH(t),null,u,o[r.index],r,s,l,null,null,c);return a.firstCreatePass&&gF(a,r,n.length-1),RT(o,p),o[r.index]=p}function yCe(r,e,t,n){for(let o of r)e.mergedAttrs=I0(e.mergedAttrs,o.hostAttrs);e.mergedAttrs!==null&&(_F(e,e.mergedAttrs,!0),t!==null&&Xj(n,t,e))}function xCe(r,e,t,n,o,s){let i=wi(),a=o[Yt],c=Ca(i,o);iH(a,o,i,t,null,n);for(let u=0;u<t.length;u++){let p=i.directiveStart+u,d=Qm(o,a,p,i);Jm(d,o)}aH(a,o,i),c&&Jm(c,o);let l=Qm(o,a,i.directiveStart+i.componentOffset,i);if(r[fc]=o[fc]=l,s!==null)for(let u of s)u(l,e);return eH(a,i,o),l}function vCe(r,e,t,n){if(n)XM(r,t,["ng-version","18.2.0"]);else{let{attrs:o,classes:s}=Abe(e.selectors[0]);o&&XM(r,t,o),s&&s.length>0&&Kj(r,t,s.join(" "))}}function bCe(r,e,t){let n=r.projection=[];for(let o=0;o<e.length;o++){let s=t[o];n.push(s!=null?Array.from(s):null)}}function wCe(){let r=wi();sP(Tr()[Yt],r)}var _h=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=CCe;let r=e;return r})();function CCe(){let r=wi();return IH(r,Tr())}var _Ce=_h,SH=class extends _Ce{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return Tx(this._hostTNode,this._hostLView)}get injector(){return new Wm(this._hostTNode,this._hostLView)}get parentInjector(){let e=iP(this._hostTNode,this._hostLView);if(gj(e)){let t=cT(e,this._hostLView),n=aT(e),o=t[Yt].data[n+8];return new Wm(o,t)}else return new Wm(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let t=s4(this._lContainer);return t!==null&&t[e]||null}get length(){return this._lContainer.length-Yi}createEmbeddedView(e,t,n){let o,s;typeof n=="number"?o=n:n!=null&&(o=n.index,s=n.injector);let i=bF(this._lContainer,e.ssrId),a=e.createEmbeddedViewImpl(t||{},s,i);return this.insertImpl(a,o,xF(this._hostTNode,i)),a}createComponent(e,t,n,o,s){let i=e&&!qbe(e),a;if(i)a=t;else{let f=t||{};a=f.index,n=f.injector,o=f.projectableNodes,s=f.environmentInjector||f.ngModuleRef}let c=i?e:new A0(Hm(e)),l=n||this.parentInjector;if(!s&&c.ngModule==null){let m=(i?l:this.parentInjector).get(va,null);m&&(s=m)}let u=Hm(c.componentType??{}),p=bF(this._lContainer,u?.id??null),d=p?.firstChild??null,h=c.create(l,o,d,s);return this.insertImpl(h.hostView,a,xF(this._hostTNode,p)),h}insert(e,t){return this.insertImpl(e,t,!0)}insertImpl(e,t,n){let o=e._lView;if(ewe(o)){let a=this.indexOf(e);if(a!==-1)this.detach(a);else{let c=o[bs],l=new SH(c,c[bi],c[bs]);l.detach(l.indexOf(e))}}let s=this._adjustIndex(t),i=this._lContainer;return mH(i,o,s,n),e.attachToViewContainerRef(),S4(BM(i),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){let t=s4(this._lContainer);return t!==null?t.indexOf(e):-1}remove(e){let t=this._adjustIndex(e,-1),n=fF(this._lContainer,t);n&&(tT(BM(this._lContainer),t),zj(n[Yt],n))}detach(e){let t=this._adjustIndex(e,-1),n=fF(this._lContainer,t);return n&&tT(BM(this._lContainer),t)!=null?new eg(n):null}_adjustIndex(e,t=0){return e??this.length+t}};function s4(r){return r[oT]}function BM(r){return r[oT]||(r[oT]=[])}function IH(r,e){let t,n=e[r.index];return Qp(n)?t=n:(t=cH(n,e,null,r),e[r.index]=t,RT(e,t)),ICe(t,e,r,n),new SH(t,r,e)}function SCe(r,e){let t=r[io],n=t.createComment(""),o=Ca(e,r),s=Wj(t,o);return hT(t,s,n,d0e(t,o),!1),n}var ICe=ECe,TCe=()=>!1;function kCe(r,e,t){return TCe(r,e,t)}function ECe(r,e,t,n){if(r[Km])return;let o;t.type&8?o=ou(n):o=SCe(e,t),r[Km]=o}var IF=class r{constructor(e){this.queryList=e,this.matches=null}clone(){return new r(this.queryList)}setDirty(){this.queryList.setDirty()}},TF=class r{constructor(e=[]){this.queries=e}createEmbeddedView(e){let t=e.queries;if(t!==null){let n=e.contentQueries!==null?e.contentQueries[0]:t.length,o=[];for(let s=0;s<n;s++){let i=t.getByIndex(s),a=this.queries[i.indexInDeclarationView];o.push(a.clone())}return new r(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)_P(e,t).matches!==null&&this.queries[t].setDirty()}},kF=class{constructor(e,t,n=null){this.flags=t,this.read=n,typeof e=="string"?this.predicate=PCe(e):this.predicate=e}},EF=class r{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){let o=t!==null?t.length:0,s=this.getByIndex(n).embeddedTView(e,o);s&&(s.indexInDeclarationView=n,t!==null?t.push(s):t=[s])}return t!==null?new r(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},NF=class r{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new r(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let t=this._declarationNodeIndex,n=e.parent;for(;n!==null&&n.type&8&&n.index!==t;)n=n.parent;return t===(n!==null?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){let n=this.metadata.predicate;if(Array.isArray(n))for(let o=0;o<n.length;o++){let s=n[o];this.matchTNodeWithReadOption(e,t,NCe(t,s)),this.matchTNodeWithReadOption(e,t,YI(t,e,s,!1,!1))}else n===tg?t.type&4&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,YI(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(n!==null){let o=this.metadata.read;if(o!==null)if(o===iu||o===_h||o===tg&&t.type&4)this.addMatch(t.index,-2);else{let s=YI(t,e,o,!1,!1);s!==null&&this.addMatch(t.index,s)}else this.addMatch(t.index,n)}}addMatch(e,t){this.matches===null?this.matches=[e,t]:this.matches.push(e,t)}};function NCe(r,e){let t=r.localNames;if(t!==null){for(let n=0;n<t.length;n+=2)if(t[n]===e)return t[n+1]}return null}function DCe(r,e){return r.type&11?Tx(r,e):r.type&4?wP(r,e):null}function ACe(r,e,t,n){return t===-1?DCe(e,r):t===-2?RCe(r,e,n):Qm(r,r[Yt],t,e)}function RCe(r,e,t){if(t===iu)return Tx(e,r);if(t===tg)return wP(e,r);if(t===_h)return IH(e,r)}function TH(r,e,t,n){let o=e[qp].queries[n];if(o.matches===null){let s=r.data,i=t.matches,a=[];for(let c=0;i!==null&&c<i.length;c+=2){let l=i[c];if(l<0)a.push(null);else{let u=s[l];a.push(ACe(e,u,i[c+1],t.metadata.read))}}o.matches=a}return o.matches}function DF(r,e,t,n){let o=r.queries.getByIndex(t),s=o.matches;if(s!==null){let i=TH(r,e,o,t);for(let a=0;a<s.length;a+=2){let c=s[a];if(c>0)n.push(i[a/2]);else{let l=s[a+1],u=e[-c];for(let p=Yi;p<u.length;p++){let d=u[p];d[qm]===d[bs]&&DF(d[Yt],d,l,n)}if(u[vx]!==null){let p=u[vx];for(let d=0;d<p.length;d++){let h=p[d];DF(h[Yt],h,l,n)}}}}}return n}function OCe(r,e){return r[qp].queries[e].queryList}function MCe(r,e,t){let n=new pF((t&4)===4);return T0e(r,e,n,n.destroy),(e[qp]??=new TF).queries.push(new IF(n))-1}function FCe(r,e,t){let n=qo();return n.firstCreatePass&&($Ce(n,new kF(r,e,t),-1),(e&2)===2&&(n.staticViewQueries=!0)),MCe(n,Tr(),e)}function PCe(r){return r.split(",").map(e=>e.trim())}function $Ce(r,e,t){r.queries===null&&(r.queries=new EF),r.queries.track(new NF(e,t))}function _P(r,e){return r.queries.getByIndex(e)}function LCe(r,e){let t=r[Yt],n=_P(t,e);return n.crossesNgTemplate?DF(t,r,e,[]):TH(t,r,n,e)}function VCe(r){return typeof r=="function"&&r[jp]!==void 0}function B0(r,e){V0("NgSignals");let t=iW(r),n=t[jp];return e?.equal&&(n.equal=e.equal),t.set=o=>fM(n,o),t.update=o=>aW(n,o),t.asReadonly=BCe.bind(t),t}function BCe(){let r=this[jp];if(r.readonlyFn===void 0){let e=()=>this();e[jp]=r,r.readonlyFn=e}return r.readonlyFn}function kH(r){return VCe(r)&&typeof r.set=="function"}function zCe(r){return Object.getPrototypeOf(r.prototype).constructor}function Jp(r){let e=zCe(r.type),t=!0,n=[r];for(;e;){let o;if(gh(r))o=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new gt(903,!1);o=e.\u0275dir}if(o){if(t){n.push(o);let i=r;i.inputs=WI(r.inputs),i.inputTransforms=WI(r.inputTransforms),i.declaredInputs=WI(r.declaredInputs),i.outputs=WI(r.outputs);let a=o.hostBindings;a&&HCe(r,a);let c=o.viewQuery,l=o.contentQueries;if(c&&WCe(r,c),l&&jCe(r,l),UCe(r,o),Kve(r.outputs,o.outputs),gh(o)&&o.data.animation){let u=r.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let s=o.features;if(s)for(let i=0;i<s.length;i++){let a=s[i];a&&a.ngInherit&&a(r),a===Jp&&(t=!1)}}e=Object.getPrototypeOf(e)}GCe(n)}function UCe(r,e){for(let t in e.inputs){if(!e.inputs.hasOwnProperty(t)||r.inputs.hasOwnProperty(t))continue;let n=e.inputs[t];if(n!==void 0&&(r.inputs[t]=n,r.declaredInputs[t]=e.declaredInputs[t],e.inputTransforms!==null)){let o=Array.isArray(n)?n[0]:n;if(!e.inputTransforms.hasOwnProperty(o))continue;r.inputTransforms??={},r.inputTransforms[o]=e.inputTransforms[o]}}}function GCe(r){let e=0,t=null;for(let n=r.length-1;n>=0;n--){let o=r[n];o.hostVars=e+=o.hostVars,o.hostAttrs=I0(o.hostAttrs,t=I0(t,o.hostAttrs))}}function WI(r){return r===mx?{}:r===vi?[]:r}function WCe(r,e){let t=r.viewQuery;t?r.viewQuery=(n,o)=>{e(n,o),t(n,o)}:r.viewQuery=e}function jCe(r,e){let t=r.contentQueries;t?r.contentQueries=(n,o,s)=>{e(n,o,s),t(n,o,s)}:r.contentQueries=e}function HCe(r,e){let t=r.hostBindings;t?r.hostBindings=(n,o)=>{e(n,o),t(n,o)}:r.hostBindings=e}var vh=class{},R0=class{};var AF=class extends vh{constructor(e,t,n,o=!0){super(),this.ngModuleType=e,this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new gT(this);let s=F4(e);this._bootstrapComponents=$j(s.bootstrap),this._r3Injector=Ij(e,t,[{provide:vh,useValue:this},{provide:bx,useValue:this.componentFactoryResolver},...n],Gs(e),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}},RF=class extends R0{constructor(e){super(),this.moduleType=e}create(e){return new AF(this.moduleType,e,[])}};var yT=class extends vh{constructor(e){super(),this.componentFactoryResolver=new gT(this),this.instance=null;let t=new T0([...e.providers,{provide:vh,useValue:this},{provide:bx,useValue:this.componentFactoryResolver}],e.parent||XF(),e.debugName,new Set(["environment"]));this.injector=t,e.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function SP(r,e,t=null){return new yT({providers:r,parent:e,debugName:t,runEnvironmentInitializers:!0}).injector}function EH(r){return KCe(r)?Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r:!1}function qCe(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{let t=r[Symbol.iterator](),n;for(;!(n=t.next()).done;)e(n.value)}}function KCe(r){return r!==null&&(typeof r=="function"||typeof r=="object")}function XCe(r,e,t){return r[e]=t}function Xp(r,e,t){let n=r[e];return Object.is(n,t)?!1:(r[e]=t,!0)}function YCe(r,e,t,n){let o=Xp(r,e,t);return Xp(r,e+1,n)||o}function ZCe(r){return(r.flags&32)===32}function QCe(r,e,t,n,o,s,i,a,c){let l=e.consts,u=L0(e,r,4,i||null,a||null);sH(e,t,u,iT(l,c)),sP(e,u);let p=u.tView=yP(2,u,n,o,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l,null);return e.queries!==null&&(e.queries.template(e,u),p.queries=e.queries.embeddedTView(u)),u}function NH(r,e,t,n,o,s,i,a,c,l){let u=t+wa,p=e.firstCreatePass?QCe(u,e,r,n,o,s,i,a,c):e.data[u];P0(p,!1);let d=JCe(e,r,p,t);nP()&&mP(e,r,d,p),Jm(d,r);let h=cH(d,r,d,p);return r[u]=h,RT(r,h),kCe(h,p,r),YF(p)&&tH(e,r,p),c!=null&&rH(r,p,l),p}function qn(r,e,t,n,o,s,i,a){let c=Tr(),l=qo(),u=iT(l.consts,s);return NH(c,l,r,e,t,n,o,u,i,a),qn}var JCe=e_e;function e_e(r,e,t,n){return oP(!0),e[io].createComment("")}function OT(r,e,t,n){let o=Tr(),s=NT();if(Xp(o,s,e)){let i=qo(),a=rP();z0e(a,o,r,e,t,n)}return OT}function DH(r,e,t,n){return Xp(r,NT(),t)?e+_0(t)+n:gc}function t_e(r,e,t,n,o,s){let i=uwe(),a=YCe(r,i,t,o);return QF(2),a?e+_0(t)+n+_0(o)+s:gc}function jI(r,e){return r<<17|e<<2}function rg(r){return r>>17&32767}function r_e(r){return(r&2)==2}function n_e(r,e){return r&131071|e<<17}function OF(r){return r|2}function Cx(r){return(r&131068)>>2}function zM(r,e){return r&-131069|e<<2}function o_e(r){return(r&1)===1}function MF(r){return r|1}function s_e(r,e,t,n,o,s){let i=s?e.classBindings:e.styleBindings,a=rg(i),c=Cx(i);r[n]=t;let l=!1,u;if(Array.isArray(t)){let p=t;u=p[1],(u===null||F0(p,u)>0)&&(l=!0)}else u=t;if(o)if(c!==0){let d=rg(r[a+1]);r[n+1]=jI(d,a),d!==0&&(r[d+1]=zM(r[d+1],n)),r[a+1]=n_e(r[a+1],n)}else r[n+1]=jI(a,0),a!==0&&(r[a+1]=zM(r[a+1],n)),a=n;else r[n+1]=jI(c,0),a===0?a=n:r[c+1]=zM(r[c+1],n),c=n;l&&(r[n+1]=OF(r[n+1])),i4(r,u,n,!0),i4(r,u,n,!1),i_e(e,u,r,n,s),i=jI(a,c),s?e.classBindings=i:e.styleBindings=i}function i_e(r,e,t,n,o){let s=o?r.residualClasses:r.residualStyles;s!=null&&typeof e=="string"&&F0(s,e)>=0&&(t[n+1]=MF(t[n+1]))}function i4(r,e,t,n){let o=r[t+1],s=e===null,i=n?rg(o):Cx(o),a=!1;for(;i!==0&&(a===!1||s);){let c=r[i],l=r[i+1];a_e(c,e)&&(a=!0,r[i+1]=n?MF(l):OF(l)),i=n?rg(l):Cx(l)}a&&(r[t+1]=n?OF(o):MF(o))}function a_e(r,e){return r===null||e==null||(Array.isArray(r)?r[1]:r)===e?!0:Array.isArray(r)&&typeof e=="string"?F0(r,e)>=0:!1}var zs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function c_e(r){return r.substring(zs.key,zs.keyEnd)}function l_e(r){return r.substring(zs.value,zs.valueEnd)}function u_e(r){return p_e(r),AH(r,xT(r,0,zs.textEnd))}function AH(r,e){let t=zs.textEnd,n=zs.key=xT(r,e,t);return t===n?-1:(n=zs.keyEnd=d_e(r,n,t),n=a4(r,n,t,58),n=zs.value=xT(r,n,t),n=zs.valueEnd=h_e(r,n,t),a4(r,n,t,59))}function p_e(r){zs.key=0,zs.keyEnd=0,zs.value=0,zs.valueEnd=0,zs.textEnd=r.length}function xT(r,e,t){for(;e<t&&r.charCodeAt(e)<=32;)e++;return e}function d_e(r,e,t){let n;for(;e<t&&((n=r.charCodeAt(e))===45||n===95||(n&-33)>=65&&(n&-33)<=90||n>=48&&n<=57);)e++;return e}function a4(r,e,t,n){return e=xT(r,e,t),e<t&&e++,e}function h_e(r,e,t){let n=-1,o=-1,s=-1,i=e,a=i;for(;i<t;){let c=r.charCodeAt(i++);if(c===59)return a;c===34||c===39?a=i=c4(r,c,i,t):e===i-4&&s===85&&o===82&&n===76&&c===40?a=i=c4(r,41,i,t):c>32&&(a=i),s=o,o=n,n=c&-33}return a}function c4(r,e,t,n){let o=-1,s=t;for(;s<n;){let i=r.charCodeAt(s++);if(i==e&&o!==92)return s;i==92&&o===92?o=0:o=i}throw new Error}function fr(r,e,t){let n=Tr(),o=NT();if(Xp(n,o,e)){let s=qo(),i=rP();oH(s,i,n,r,e,n[io],t,!1)}return fr}function FF(r,e,t,n,o){let s=e.inputs,i=o?"class":"style";xP(r,t,s[i],i,n)}function MT(r,e){return g_e(r,e,null,!0),MT}function f_e(r){y_e(MH,m_e,r,!1)}function m_e(r,e){for(let t=u_e(e);t>=0;t=AH(e,t))MH(r,c_e(e),l_e(e))}function g_e(r,e,t,n){let o=Tr(),s=qo(),i=QF(2);if(s.firstUpdatePass&&OH(s,r,i,n),e!==gc&&Xp(o,i,e)){let a=s.data[wh()];FH(s,a,o,o[io],r,o[i+1]=S_e(e,t),n,i)}}function y_e(r,e,t,n){let o=qo(),s=QF(2);o.firstUpdatePass&&OH(o,null,s,n);let i=Tr();if(t!==gc&&Xp(i,s,t)){let a=o.data[wh()];if(PH(a,n)&&!RH(o,s)){let c=n?a.classesWithoutHost:a.stylesWithoutHost;c!==null&&(t=jM(c,t||"")),FF(o,a,i,t,n)}else __e(o,a,i,i[io],i[s+1],i[s+1]=C_e(r,e,t),n,s)}}function RH(r,e){return e>=r.expandoStartIndex}function OH(r,e,t,n){let o=r.data;if(o[t+1]===null){let s=o[wh()],i=RH(r,t);PH(s,n)&&e===null&&!i&&(e=!1),e=x_e(o,s,e,n),s_e(o,s,e,t,i,n)}}function x_e(r,e,t,n){let o=mwe(r),s=n?e.residualClasses:e.residualStyles;if(o===null)(n?e.classBindings:e.styleBindings)===0&&(t=UM(null,r,e,t,n),t=O0(t,e.attrs,n),s=null);else{let i=e.directiveStylingLast;if(i===-1||r[i]!==o)if(t=UM(o,r,e,t,n),s===null){let c=v_e(r,e,n);c!==void 0&&Array.isArray(c)&&(c=UM(null,r,e,c[1],n),c=O0(c,e.attrs,n),b_e(r,e,n,c))}else s=w_e(r,e,n)}return s!==void 0&&(n?e.residualClasses=s:e.residualStyles=s),t}function v_e(r,e,t){let n=t?e.classBindings:e.styleBindings;if(Cx(n)!==0)return r[rg(n)]}function b_e(r,e,t,n){let o=t?e.classBindings:e.styleBindings;r[rg(o)]=n}function w_e(r,e,t){let n,o=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<o;s++){let i=r[s].hostAttrs;n=O0(n,i,t)}return O0(n,e.attrs,t)}function UM(r,e,t,n,o){let s=null,i=t.directiveEnd,a=t.directiveStylingLast;for(a===-1?a=t.directiveStart:a++;a<i&&(s=e[a],n=O0(n,s.hostAttrs,o),s!==r);)a++;return r!==null&&(t.directiveStylingLast=a),n}function O0(r,e,t){let n=t?1:2,o=-1;if(e!==null)for(let s=0;s<e.length;s++){let i=e[s];typeof i=="number"?o=i:o===n&&(Array.isArray(r)||(r=r===void 0?[]:["",r]),I4(r,i,t?!0:e[++s]))}return r===void 0?null:r}function C_e(r,e,t){if(t==null||t==="")return vi;let n=[],o=$0(t);if(Array.isArray(o))for(let s=0;s<o.length;s++)r(n,o[s],!0);else if(typeof o=="object")for(let s in o)o.hasOwnProperty(s)&&r(n,s,o[s]);else typeof o=="string"&&e(n,o);return n}function MH(r,e,t){I4(r,e,$0(t))}function __e(r,e,t,n,o,s,i,a){o===gc&&(o=vi);let c=0,l=0,u=0<o.length?o[0]:null,p=0<s.length?s[0]:null;for(;u!==null||p!==null;){let d=c<o.length?o[c+1]:void 0,h=l<s.length?s[l+1]:void 0,f=null,m;u===p?(c+=2,l+=2,d!==h&&(f=p,m=h)):p===null||u!==null&&u<p?(c+=2,f=u):(l+=2,f=p,m=h),f!==null&&FH(r,e,t,n,f,m,i,a),u=c<o.length?o[c]:null,p=l<s.length?s[l]:null}}function FH(r,e,t,n,o,s,i,a){if(!(e.type&3))return;let c=r.data,l=c[a+1],u=o_e(l)?l4(c,e,t,o,Cx(l),i):void 0;if(!vT(u)){vT(s)||r_e(l)&&(s=l4(c,null,t,o,a,i));let p=Y4(wh(),t);x0e(n,i,p,o,s)}}function l4(r,e,t,n,o,s){let i=e===null,a;for(;o>0;){let c=r[o],l=Array.isArray(c),u=l?c[1]:c,p=u===null,d=t[o+1];d===gc&&(d=p?vi:void 0);let h=p?RM(d,n):u===n?d:void 0;if(l&&!vT(h)&&(h=RM(c,n)),vT(h)&&(a=h,i))return a;let f=r[o+1];o=i?rg(f):Cx(f)}if(e!==null){let c=s?e.residualClasses:e.residualStyles;c!=null&&(a=RM(c,n))}return a}function vT(r){return r!==void 0}function S_e(r,e){return r==null||r===""||(typeof e=="string"?r=r+e:typeof r=="object"&&(r=Gs($0(r)))),r}function PH(r,e){return(r.flags&(e?8:16))!==0}function I_e(r,e,t,n,o,s){let i=e.consts,a=iT(i,o),c=L0(e,r,2,n,a);return sH(e,t,c,iT(i,s)),c.attrs!==null&&_F(c,c.attrs,!1),c.mergedAttrs!==null&&_F(c,c.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,c),c}function Se(r,e,t,n){let o=Tr(),s=qo(),i=wa+r,a=o[io],c=s.firstCreatePass?I_e(i,s,o,e,t,n):s.data[i],l=T_e(s,o,c,a,e,r);o[i]=l;let u=YF(c);return P0(c,!0),Xj(a,l,c),!ZCe(c)&&nP()&&mP(s,o,l,c),nwe()===0&&Jm(l,o),owe(),u&&(tH(s,o,c),eH(s,c,o)),n!==null&&rH(o,c),Se}function Ie(){let r=wi();sj()?ij():(r=r.parent,P0(r,!1));let e=r;iwe(e)&&awe(),swe();let t=qo();return t.firstCreatePass&&(sP(t,r),W4(r)&&t.queries.elementEnd(r)),e.classesWithoutHost!=null&&_we(e)&&FF(t,e,Tr(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&Swe(e)&&FF(t,e,Tr(),e.stylesWithoutHost,!1),Ie}function mt(r,e,t,n){return Se(r,e,t,n),Ie(),mt}var T_e=(r,e,t,n,o,s)=>(oP(!0),Lj(n,o,vwe()));function ed(){return Tr()}var bT="en-US";var k_e=bT;function E_e(r){typeof r=="string"&&(k_e=r.toLowerCase().replace(/_/g,"-"))}var N_e=(r,e,t)=>{};function mr(r,e,t,n){let o=Tr(),s=qo(),i=wi();return $H(s,o,o[io],i,r,e,n),mr}function D_e(r,e,t,n){let o=r.cleanup;if(o!=null)for(let s=0;s<o.length-1;s+=2){let i=o[s];if(i===t&&o[s+1]===n){let a=e[nT],c=o[s+2];return a.length>c?a[c]:null}typeof i=="string"&&(s+=2)}return null}function $H(r,e,t,n,o,s,i){let a=YF(n),l=r.firstCreatePass&&pH(r),u=e[fc],p=uH(e),d=!0;if(n.type&3||i){let m=Ca(n,e),g=i?i(m):m,y=p.length,x=i?w=>i(ou(w[n.index])):n.index,b=null;if(!i&&a&&(b=D_e(r,e,o,n.index)),b!==null){let w=b.__ngLastListenerFn__||b;w.__ngNextListenerFn__=s,b.__ngLastListenerFn__=s,d=!1}else{s=p4(n,e,u,s),N_e(m,o,s);let w=t.listen(g,o,s);p.push(s,w),l&&l.push(o,x,y,y+1)}}else s=p4(n,e,u,s);let h=n.outputs,f;if(d&&h!==null&&(f=h[o])){let m=f.length;if(m)for(let g=0;g<m;g+=2){let y=f[g],x=f[g+1],_=e[y][x].subscribe(s),I=p.length;p.push(s,_),l&&l.push(o,n.index,I,-(I+1))}}}function u4(r,e,t,n){let o=Dr(null);try{return tu(6,e,t),t(n)!==!1}catch(s){return dH(r,s),!1}finally{tu(7,e,t),Dr(o)}}function p4(r,e,t,n){return function o(s){if(s===Function)return n;let i=r.componentOffset>-1?bh(r.index,e):e;bP(i,5);let a=u4(e,t,n,s),c=o.__ngNextListenerFn__;for(;c;)a=u4(e,t,c,s)&&a,c=c.__ngNextListenerFn__;return a}}function Dn(r=1){return ywe(r)}function A_e(r,e){let t=null,n=Ibe(r);for(let o=0;o<e.length;o++){let s=e[o];if(s==="*"){t=o;continue}if(n===null?D4(r,s,!0):Ebe(n,s))return o}return t}function Sh(r){let e=Tr()[ba][bi];if(!e.projection){let t=r?r.length:1,n=e.projection=mbe(t,null),o=n.slice(),s=e.child;for(;s!==null;){if(s.type!==128){let i=r?A_e(s,r):0;i!==null&&(o[i]?o[i].projectionNext=s:n[i]=s,o[i]=s)}s=s.next}}}function Ih(r,e=0,t,n,o,s){let i=Tr(),a=qo(),c=n?r+1:null;c!==null&&NH(i,a,c,n,o,s,null,t);let l=L0(a,wa+r,16,null,t||null);l.projection===null&&(l.projection=e),ij();let p=!i[k0]||nj();i[ba][bi].projection[l.projection]===null&&c!==null?R_e(i,a,c):p&&(l.flags&32)!==32&&g0e(a,i,l)}function R_e(r,e,t){let n=wa+t,o=e.data[n],s=r[n],i=bF(s,o.tView.ssrId),a=fH(r,o,void 0,{dehydratedView:i});mH(s,a,0,xF(o,i))}function Nx(r,e,t){FCe(r,e,t)}function ig(r){let e=Tr(),t=qo(),n=cj();JF(n+1);let o=_P(t,n);if(r.dirty&&Jbe(e)===((o.metadata.flags&2)===2)){if(o.matches===null)r.reset([]);else{let s=LCe(e,n);r.reset(s,Wwe),r.notifyOnChanges()}return!0}return!1}function ag(){return OCe(Tr(),cj())}function O_e(r,e,t,n){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),e[t]=n}function IP(r,e,t){let n=Tr(),o=DH(n,r,e,t);f_e(o)}function Ke(r,e=""){let t=Tr(),n=qo(),o=r+wa,s=n.firstCreatePass?L0(n,o,1,e,null):n.data[o],i=M_e(n,t,s,e,r);t[o]=i,nP()&&mP(n,t,i,s),P0(s,!1)}var M_e=(r,e,t,n,o)=>(oP(!0),n0e(e[io],n));function Ia(r){return Th("",r,""),Ia}function Th(r,e,t){let n=Tr(),o=DH(n,r,e,t);return o!==gc&&hH(n,wh(),o),Th}function TP(r,e,t,n,o){let s=Tr(),i=t_e(s,r,e,t,n,o);return i!==gc&&hH(s,wh(),i),TP}function kP(r,e,t){kH(e)&&(e=e());let n=Tr(),o=NT();if(Xp(n,o,e)){let s=qo(),i=rP();oH(s,i,n,r,e,n[io],t,!1)}return kP}function LH(r,e){let t=kH(r);return t&&r.set(e),t}function EP(r,e){let t=Tr(),n=qo(),o=wi();return $H(n,t,t[io],o,r,e),EP}function F_e(r,e,t){let n=qo();if(n.firstCreatePass){let o=gh(r);PF(t,n.data,n.blueprint,o,!0),PF(e,n.data,n.blueprint,o,!1)}}function PF(r,e,t,n,o){if(r=Us(r),Array.isArray(r))for(let s=0;s<r.length;s++)PF(r[s],e,t,n,o);else{let s=qo(),i=Tr(),a=wi(),c=yx(r)?r:Us(r.provide),l=z4(r),u=a.providerIndexes&1048575,p=a.directiveStart,d=a.providerIndexes>>20;if(yx(r)||!r.multi){let h=new Zm(l,o,We),f=WM(c,e,o?u:u+d,p);f===-1?(sF(uT(a,i),s,c),GM(s,r,e.length),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(h),i.push(h)):(t[f]=h,i[f]=h)}else{let h=WM(c,e,u+d,p),f=WM(c,e,u,u+d),m=h>=0&&t[h],g=f>=0&&t[f];if(o&&!g||!o&&!m){sF(uT(a,i),s,c);let y=L_e(o?$_e:P_e,t.length,o,n,l);!o&&g&&(t[f].providerFactory=y),GM(s,r,e.length,0),e.push(c),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),t.push(y),i.push(y)}else{let y=VH(t[o?f:h],l,!o&&n);GM(s,r,h>-1?h:f,y)}!o&&n&&g&&t[f].componentProviders++}}}function GM(r,e,t,n){let o=yx(e),s=Vbe(e);if(o||s){let c=(s?Us(e.useClass):e).prototype.ngOnDestroy;if(c){let l=r.destroyHooks||(r.destroyHooks=[]);if(!o&&e.multi){let u=l.indexOf(t);u===-1?l.push(t,[n,c]):l[u+1].push(n,c)}else l.push(t,c)}}}function VH(r,e,t){return t&&r.componentProviders++,r.multi.push(e)-1}function WM(r,e,t,n){for(let o=t;o<n;o++)if(e[o]===r)return o;return-1}function P_e(r,e,t,n){return $F(this.multi,[])}function $_e(r,e,t,n){let o=this.multi,s;if(this.providerFactory){let i=this.providerFactory.componentProviders,a=Qm(t,t[Yt],this.providerFactory.index,n);s=a.slice(0,i),$F(o,s);for(let c=i;c<a.length;c++)s.push(a[c])}else s=[],$F(o,s);return s}function $F(r,e){for(let t=0;t<r.length;t++){let n=r[t];e.push(n())}return e}function L_e(r,e,t,n,o){let s=new Zm(r,t,We);return s.multi=[],s.index=e,s.componentProviders=0,VH(s,o,n&&!t),s}function z0(r,e=[]){return t=>{t.providersResolver=(n,o)=>F_e(n,o?o(r):r,e)}}var V_e=(()=>{let e=class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){let o=L4(!1,n.type),s=o.length>0?SP([o],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,s)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(let n of this.cachedInjectors.values())n!==null&&n.destroy()}finally{this.cachedInjectors.clear()}}};e.\u0275prov=st({token:e,providedIn:"environment",factory:()=>new e(Lt(va))});let r=e;return r})();function At(r){V0("NgStandalone"),r.getStandaloneInjector=e=>e.get(V_e).getOrCreateStandaloneInjector(r)}function B_e(r,e){let t=r[e];return t===gc?void 0:t}function z_e(r,e,t,n,o,s){let i=e+t;return Xp(r,i,o)?XCe(r,i+1,s?n.call(s,o):n(o)):B_e(r,i+1)}function BH(r,e){let t=qo(),n,o=r+wa;t.firstCreatePass?(n=U_e(e,t.pipeRegistry),t.data[o]=n,n.onDestroy&&(t.destroyHooks??=[]).push(o,n.onDestroy)):n=t.data[o];let s=n.factory||(n.factory=jm(n.type,!0)),i,a=xi(We);try{let c=lT(!1),l=s();return lT(c),O_e(t,Tr(),o,l),l}finally{xi(a)}}function U_e(r,e){if(e)for(let t=e.length-1;t>=0;t--){let n=e[t];if(r===n.name)return n}}function zH(r,e,t){let n=r+wa,o=Tr(),s=Qbe(o,n);return G_e(o,n)?z_e(o,lwe(),e,s.transform,t,s):s.transform(t)}function G_e(r,e){return r[Yt].data[e].pure}var FT=(()=>{let e=class e{log(n){console.log(n)}warn(n){console.warn(n)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"platform"});let r=e;return r})();var UH=new $t("");function cg(r){return!!r&&typeof r.then=="function"}function GH(r){return!!r&&typeof r.subscribe=="function"}var WH=new $t(""),jH=(()=>{let e=class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,o)=>{this.resolve=n,this.reject=o}),this.appInits=rt(WH,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let n=[];for(let s of this.appInits){let i=s();if(cg(i))n.push(i);else if(GH(i)){let a=new Promise((c,l)=>{i.subscribe({complete:c,error:l})});n.push(a)}}let o=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{o()}).catch(s=>{this.reject(s)}),n.length===0&&o(),this.initialized=!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),NP=new $t("");function W_e(){sW(()=>{throw new gt(600,!1)})}function j_e(r){return r.isBoundToModule}var H_e=10;function q_e(r,e,t){try{let n=t();return cg(n)?n.catch(o=>{throw e.runOutsideAngular(()=>r.handleError(o)),o}):n}catch(n){throw e.runOutsideAngular(()=>r.handleError(n)),n}}var lg=(()=>{let e=class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=rt(Uwe),this.afterRenderEffectManager=rt(_H),this.zonelessEnabled=rt(CP),this.externalTestViews=new Set,this.beforeRender=new Yr,this.afterTick=new Yr,this.componentTypes=[],this.components=[],this.isStable=rt(Ix).hasPendingTasks.pipe(cr(n=>!n)),this._injector=rt(va)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}whenStable(){let n;return new Promise(o=>{n=this.isStable.subscribe({next:s=>{s&&o()}})}).finally(()=>{n.unsubscribe()})}get injector(){return this._injector}bootstrap(n,o){let s=n instanceof mT;if(!this._injector.get(jH).done){let h=!s&&M4(n),f=!1;throw new gt(405,f)}let a;s?a=n:a=this._injector.get(bx).resolveComponentFactory(n),this.componentTypes.push(a.componentType);let c=j_e(a)?void 0:this._injector.get(vh),l=o||a.selector,u=a.create(yh.NULL,[],l,c),p=u.location.nativeElement,d=u.injector.get(UH,null);return d?.registerApplication(p),u.onDestroy(()=>{this.detachView(u.hostView),ZI(this.components,u),d?.unregisterApplication(p)}),this._loadComponent(u),u}tick(){this._tick(!0)}_tick(n){if(this._runningTick)throw new gt(101,!1);let o=Dr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(n)}catch(s){this.internalErrorHandler(s)}finally{this._runningTick=!1,Dr(o),this.afterTick.next()}}detectChangesInAttachedViews(n){let o=null;this._injector.destroyed||(o=this._injector.get(wx,null,{optional:!0}));let s=0,i=this.afterRenderEffectManager;for(;s<H_e;){let a=s===0;if(n||!a){this.beforeRender.next(a);for(let{_lView:c,notifyErrorHandler:l}of this._views)K_e(c,l,a,this.zonelessEnabled)}else o?.begin?.(),o?.end?.();if(s++,i.executeInternalCallbacks(),!this.allViews.some(({_lView:c})=>N0(c))&&(i.execute(),!this.allViews.some(({_lView:c})=>N0(c))))break}}attachView(n){let o=n;this._views.push(o),o.attachToAppRef(this)}detachView(n){let o=n;ZI(this._views,o),o.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);let o=this._injector.get(NP,[]);[...this._bootstrapListeners,...o].forEach(s=>s(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>ZI(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new gt(406,!1);let n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function ZI(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function K_e(r,e,t,n){if(!t&&!N0(r))return;xH(r,e,t&&!n?0:1)}var LF=class{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}},DP=(()=>{let e=class e{compileModuleSync(n){return new RF(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){let o=this.compileModuleSync(n),s=F4(n),i=$j(s.declarations).reduce((a,c)=>{let l=Hm(c);return l&&a.push(new A0(l)),a},[]);return new LF(o,i)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var X_e=(()=>{let e=class e{constructor(){this.zone=rt(Lo),this.changeDetectionScheduler=rt(D0),this.applicationRef=rt(lg)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Y_e=new $t("",{factory:()=>!1});function HH({ngZoneFactory:r,ignoreChangesOutsideZone:e}){return r??=()=>new Lo(KH()),[{provide:Lo,useFactory:r},{provide:gx,multi:!0,useFactory:()=>{let t=rt(X_e,{optional:!0});return()=>t.initialize()}},{provide:gx,multi:!0,useFactory:()=>{let t=rt(Z_e);return()=>{t.initialize()}}},e===!0?{provide:CH,useValue:!0}:[]]}function qH(r){let e=r?.ignoreChangesOutsideZone,t=HH({ngZoneFactory:()=>{let n=KH(r);return n.shouldCoalesceEventChangeDetection&&V0("NgZone_CoalesceEvent"),new Lo(n)},ignoreChangesOutsideZone:e});return ST([{provide:Y_e,useValue:!0},{provide:CP,useValue:!1},t])}function KH(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:r?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:r?.runCoalescing??!1}}var Z_e=(()=>{let e=class e{constructor(){this.subscription=new Hn,this.initialized=!1,this.zone=rt(Lo),this.pendingTasks=rt(Ix)}initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Lo.assertNotInAngularZone(),queueMicrotask(()=>{n!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Lo.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Q_e=(()=>{let e=class e{constructor(){this.appRef=rt(lg),this.taskService=rt(Ix),this.ngZone=rt(Lo),this.zonelessEnabled=rt(CP),this.disableScheduling=rt(CH,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Hn,this.angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(dT):null,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof uF||!this.zoneIsDefined)}notify(n){if(!this.zonelessEnabled&&n===5)return;switch(n){case 3:case 2:case 0:case 4:case 5:case 1:{this.shouldRefreshViews=!0;break}case 8:case 7:case 6:case 9:default:}if(!this.shouldScheduleTick())return;let o=this.useMicrotaskScheduler?XW:kj;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=o(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=o(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(dT+this.angularZoneId))}tick(n){if(this.runningTick||this.appRef.destroyed)return;let o=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(n)},void 0,this.schedulerTickApplyArgs)}catch(s){throw this.taskService.remove(o),s}finally{this.cleanup()}this.useMicrotaskScheduler=!0,XW(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(o)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function J_e(){return typeof $localize<"u"&&$localize.locale||bT}var AP=new $t("",{providedIn:"root",factory:()=>rt(AP,rr.Optional|rr.SkipSelf)||J_e()});var XH=new $t("");function HI(r){return!!r.platformInjector}function eSe(r){let e=HI(r)?r.r3Injector:r.moduleRef.injector,t=e.get(Lo);return t.run(()=>{HI(r)?r.r3Injector.resolveInjectorInitializers():r.moduleRef.resolveInjectorInitializers();let n=e.get(xh,null),o;if(t.runOutsideAngular(()=>{o=t.onError.subscribe({next:s=>{n.handleError(s)}})}),HI(r)){let s=()=>e.destroy(),i=r.platformInjector.get(XH);i.add(s),e.onDestroy(()=>{o.unsubscribe(),i.delete(s)})}else r.moduleRef.onDestroy(()=>{ZI(r.allPlatformModules,r.moduleRef),o.unsubscribe()});return q_e(n,t,()=>{let s=e.get(jH);return s.runInitializers(),s.donePromise.then(()=>{let i=e.get(AP,bT);if(E_e(i||bT),HI(r)){let a=e.get(lg);return r.rootComponent!==void 0&&a.bootstrap(r.rootComponent),a}else return tSe(r.moduleRef,r.allPlatformModules),r.moduleRef})})})}function tSe(r,e){let t=r.injector.get(lg);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(n=>t.bootstrap(n));else if(r.instance.ngDoBootstrap)r.instance.ngDoBootstrap(t);else throw new gt(-403,!1);e.push(r)}var QI=null;function rSe(r=[],e){return yh.create({name:e,providers:[{provide:IT,useValue:"platform"},{provide:XH,useValue:new Set([()=>QI=null])},...r]})}function nSe(r=[]){if(QI)return QI;let e=rSe(r);return QI=e,W_e(),oSe(e),e}function oSe(r){r.get(uP,null)?.forEach(t=>t())}var yc=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=sSe;let r=e;return r})();function sSe(r){return iSe(wi(),Tr(),(r&16)===16)}function iSe(r,e,t){if(kT(r)&&!t){let n=bh(r.index,e);return new eg(n,n)}else if(r.type&175){let n=e[ba];return new eg(n,e)}return null}var VF=class{constructor(){}supports(e){return EH(e)}create(e){return new BF(e)}},aSe=(r,e)=>e,BF=class{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||aSe}forEachItem(e){let t;for(t=this._itHead;t!==null;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,o=0,s=null;for(;t||n;){let i=!n||t&&t.currentIndex<d4(n,o,s)?t:n,a=d4(i,o,s),c=i.currentIndex;if(i===n)o--,n=n._nextRemoved;else if(t=t._next,i.previousIndex==null)o++;else{s||(s=[]);let l=a-o,u=c-o;if(l!=u){for(let d=0;d<l;d++){let h=d<s.length?s[d]:s[d]=0,f=h+d;u<=f&&f<l&&(s[d]=h+1)}let p=i.previousIndex;s[p]=u-l}}a!==c&&e(i,a,c)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;t!==null;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;t!==null;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;t!==null;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;t!==null;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;t!==null;t=t._nextIdentityChange)e(t)}diff(e){if(e==null&&(e=[]),!EH(e))throw new gt(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._itHead,n=!1,o,s,i;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],i=this._trackByFn(a,s),t===null||!Object.is(t.trackById,i)?(t=this._mismatch(t,s,i,a),n=!0):(n&&(t=this._verifyReinsertion(t,s,i,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)),t=t._next}else o=0,qCe(e,a=>{i=this._trackByFn(o,a),t===null||!Object.is(t.trackById,i)?(t=this._mismatch(t,a,i,o),n=!0):(n&&(t=this._verifyReinsertion(t,a,i,o)),Object.is(t.item,a)||this._addIdentityChange(t,a)),t=t._next,o++}),this.length=o;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;e!==null;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;e!==null;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,o){let s;return e===null?s=this._itTail:(s=e._prev,this._remove(e)),e=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,o)):(e=this._linkedRecords===null?null:this._linkedRecords.get(n,o),e!==null?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,o)):e=this._addAfter(new zF(t,n),s,o)),e}_verifyReinsertion(e,t,n,o){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(n,null);return s!==null?e=this._reinsertAfter(s,e._prev,o):e.currentIndex!=o&&(e.currentIndex=o,this._addToMoves(e,o)),e}_truncate(e){for(;e!==null;){let t=e._next;this._addToRemovals(this._unlink(e)),e=t}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(e);let o=e._prevRemoved,s=e._nextRemoved;return o===null?this._removalsHead=s:o._nextRemoved=s,s===null?this._removalsTail=o:s._prevRemoved=o,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail===null?this._additionsTail=this._additionsHead=e:this._additionsTail=this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){let o=t===null?this._itHead:t._next;return e._next=o,e._prev=t,o===null?this._itTail=e:o._prev=e,t===null?this._itHead=e:t._next=e,this._linkedRecords===null&&(this._linkedRecords=new wT),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){this._linkedRecords!==null&&this._linkedRecords.remove(e);let t=e._prev,n=e._next;return t===null?this._itHead=n:t._next=n,n===null?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail===null?this._movesTail=this._movesHead=e:this._movesTail=this._movesTail._nextMoved=e),e}_addToRemovals(e){return this._unlinkedRecords===null&&(this._unlinkedRecords=new wT),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=e:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=e,e}},zF=class{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},UF=class{constructor(){this._head=null,this._tail=null}add(e){this._head===null?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;n!==null;n=n._nextDup)if((t===null||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){let t=e._prevDup,n=e._nextDup;return t===null?this._head=n:t._nextDup=n,n===null?this._tail=t:n._prevDup=t,this._head===null}},wT=class{constructor(){this.map=new Map}put(e){let t=e.trackById,n=this.map.get(t);n||(n=new UF,this.map.set(t,n)),n.add(e)}get(e,t){let n=e,o=this.map.get(n);return o?o.get(e,t):null}remove(e){let t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function d4(r,e,t){let n=r.previousIndex;if(n===null)return n;let o=0;return t&&n<t.length&&(o=t[n]),n+e+o}function h4(){return new RP([new VF])}var RP=(()=>{let e=class e{constructor(n){this.factories=n}static create(n,o){if(o!=null){let s=o.factories.slice();n=n.concat(s)}return new e(n)}static extend(n){return{provide:e,useFactory:o=>e.create(n,o||h4()),deps:[[e,new _4,new jF]]}}find(n){let o=this.factories.find(s=>s.supports(n));if(o!=null)return o;throw new gt(901,!1)}};e.\u0275prov=st({token:e,providedIn:"root",factory:h4});let r=e;return r})();function YH(r){try{let{rootComponent:e,appProviders:t,platformProviders:n}=r,o=nSe(n),s=[HH({}),{provide:D0,useExisting:Q_e},...t||[]],i=new yT({providers:s,parent:o,debugName:"",runEnvironmentInitializers:!1});return eSe({r3Injector:i.injector,platformInjector:o,rootComponent:e})}catch(e){return Promise.reject(e)}}var ZH=new $t("");function U0(r){return typeof r=="boolean"?r:r!=null&&r!=="false"}function G0(r,e){V0("NgSignals");let t=rW(r);return e?.equal&&(t[jp].equal=e.equal),t}function td(r){let e=Dr(null);try{return r()}finally{Dr(e)}}var rq=null;function rd(){return rq}function nq(r){rq??=r}var PT=class{};var Zi=new $t(""),oq=(()=>{let e=class e{historyGo(n){throw new Error("")}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(uSe),providedIn:"platform"});let r=e;return r})();var uSe=(()=>{let e=class e extends oq{constructor(){super(),this._doc=rt(Zi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return rd().getBaseHref(this._doc)}onPopState(n){let o=rd().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",n,!1),()=>o.removeEventListener("popstate",n)}onHashChange(n){let o=rd().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",n,!1),()=>o.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,o,s){this._history.pushState(n,o,s)}replaceState(n,o,s){this._history.replaceState(n,o,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>new e,providedIn:"platform"});let r=e;return r})();function sq(r,e){if(r.length==0)return e;if(e.length==0)return r;let t=0;return r.endsWith("/")&&t++,e.startsWith("/")&&t++,t==2?r+e.substring(1):t==1?r+e:r+"/"+e}function QH(r){let e=r.match(/#|\?|$/),t=e&&e.index||r.length,n=t-(r[t-1]==="/"?1:0);return r.slice(0,n)+r.slice(t)}function ug(r){return r&&r[0]!=="?"?"?"+r:r}var LT=(()=>{let e=class e{historyGo(n){throw new Error("")}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(iq),providedIn:"root"});let r=e;return r})(),pSe=new $t(""),iq=(()=>{let e=class e extends LT{constructor(n,o){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??rt(Zi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return sq(this._baseHref,n)}path(n=!1){let o=this._platformLocation.pathname+ug(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${o}${s}`:o}pushState(n,o,s,i){let a=this.prepareExternalUrl(s+ug(i));this._platformLocation.pushState(n,o,a)}replaceState(n,o,s,i){let a=this.prepareExternalUrl(s+ug(i));this._platformLocation.replaceState(n,o,a)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}};e.\u0275fac=function(o){return new(o||e)(Lt(oq),Lt(pSe,8))},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var W0=(()=>{let e=class e{constructor(n){this._subject=new tn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;let o=this._locationStrategy.getBaseHref();this._basePath=fSe(QH(JH(o))),this._locationStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,o=""){return this.path()==this.normalize(n+ug(o))}normalize(n){return e.stripTrailingSlash(hSe(this._basePath,JH(n)))}prepareExternalUrl(n){return n&&n[0]!=="/"&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,o="",s=null){this._locationStrategy.pushState(s,"",n,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ug(o)),s)}replaceState(n,o="",s=null){this._locationStrategy.replaceState(s,"",n,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ug(o)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)}),()=>{let o=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(o,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",o){this._urlChangeListeners.forEach(s=>s(n,o))}subscribe(n,o,s){return this._subject.subscribe({next:n,error:o,complete:s})}};e.normalizeQueryParams=ug,e.joinWithSlash=sq,e.stripTrailingSlash=QH,e.\u0275fac=function(o){return new(o||e)(Lt(LT))},e.\u0275prov=st({token:e,factory:()=>dSe(),providedIn:"root"});let r=e;return r})();function dSe(){return new W0(Lt(LT))}function hSe(r,e){if(!r||!e.startsWith(r))return e;let t=e.substring(r.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function JH(r){return r.replace(/\/index.html$/,"")}function fSe(r){if(new RegExp("^(https?:)?//").test(r)){let[,t]=r.split(/\/\/[^\/]+/);return t}return r}function aq(r,e){e=encodeURIComponent(e);for(let t of r.split(";")){let n=t.indexOf("="),[o,s]=n==-1?[t,""]:[t.slice(0,n),t.slice(n+1)];if(o.trim()===e)return decodeURIComponent(s)}return null}var MP=class{constructor(e,t,n,o){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},cq=(()=>{let e=class e{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,o,s){this._viewContainer=n,this._template=o,this._differs=s,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let n=this._ngForOf;if(!this._differ&&n)if(0)try{}catch{}else this._differ=this._differs.find(n).create(this.ngForTrackBy)}if(this._differ){let n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){let o=this._viewContainer;n.forEachOperation((s,i,a)=>{if(s.previousIndex==null)o.createEmbeddedView(this._template,new MP(s.item,this._ngForOf,-1,-1),a===null?void 0:a);else if(a==null)o.remove(i===null?void 0:i);else if(i!==null){let c=o.get(i);o.move(c,a),eq(c,s)}});for(let s=0,i=o.length;s<i;s++){let c=o.get(s).context;c.index=s,c.count=i,c.ngForOf=this._ngForOf}n.forEachIdentityChange(s=>{let i=o.get(s.currentIndex);eq(i,s)})}static ngTemplateContextGuard(n,o){return!0}};e.\u0275fac=function(o){return new(o||e)(We(_h),We(tg),We(RP))},e.\u0275dir=ws({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let r=e;return r})();function eq(r,e){r.context.$implicit=e.item}var Ci=(()=>{let e=class e{constructor(n,o){this._viewContainer=n,this._context=new FP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){tq("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){tq("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,o){return!0}};e.\u0275fac=function(o){return new(o||e)(We(_h),We(tg))},e.\u0275dir=ws({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let r=e;return r})(),FP=class{constructor(){this.$implicit=null,this.ngIf=null}};function tq(r,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${r} must be a TemplateRef, but received '${Gs(e)}'.`)}var lq=(()=>{let e=class e{transform(n){return JSON.stringify(n,null,2)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275pipe=A4({name:"json",type:e,pure:!1,standalone:!0});let r=e;return r})();var ao=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=sg({type:e}),e.\u0275inj=og({});let r=e;return r})(),uq="browser",mSe="server";function $P(r){return r===mSe}var $T=class{};var BP=class extends PT{constructor(){super(...arguments),this.supportsDOMEvents=!0}},zP=class r extends BP{static makeCurrent(){nq(new r)}onAndCancel(e,t,n){return e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=gSe();return t==null?null:ySe(t)}resetBaseElement(){j0=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return aq(document.cookie,e)}},j0=null;function gSe(){return j0=j0||document.querySelector("base"),j0?j0.getAttribute("href"):null}function ySe(r){return new URL(r,document.baseURI).pathname}var xSe=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),VT=new $t(""),fq=(()=>{let e=class e{constructor(n,o){this._zone=o,this._eventNameToPlugin=new Map,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,o,s){return this._findPluginFor(o).addEventListener(n,o,s)}getZone(){return this._zone}_findPluginFor(n){let o=this._eventNameToPlugin.get(n);if(o)return o;if(o=this._plugins.find(i=>i.supports(n)),!o)throw new gt(5101,!1);return this._eventNameToPlugin.set(n,o),o}};e.\u0275fac=function(o){return new(o||e)(Lt(VT),Lt(Lo))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),H0=class{constructor(e){this._doc=e}},LP="ng-app-id",mq=(()=>{let e=class e{constructor(n,o,s,i={}){this.doc=n,this.appId=o,this.nonce=s,this.platformId=i,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=$P(i),this.resetHostNodes()}addStyles(n){for(let o of n)this.changeUsageCount(o,1)===1&&this.onStyleAdded(o)}removeStyles(n){for(let o of n)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){let n=this.styleNodesInDOM;n&&(n.forEach(o=>o.remove()),n.clear());for(let o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(let o of this.getAllStyles())this.addStyleToHost(n,o)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(let o of this.hostNodes)this.addStyleToHost(o,n)}onStyleRemoved(n){let o=this.styleRef;o.get(n)?.elements?.forEach(s=>s.remove()),o.delete(n)}collectServerRenderedStyles(){let n=this.doc.head?.querySelectorAll(`style[${LP}="${this.appId}"]`);if(n?.length){let o=new Map;return n.forEach(s=>{s.textContent!=null&&o.set(s.textContent,s)}),o}return null}changeUsageCount(n,o){let s=this.styleRef;if(s.has(n)){let i=s.get(n);return i.usage+=o,i.usage}return s.set(n,{usage:o,elements:[]}),o}getStyleElement(n,o){let s=this.styleNodesInDOM,i=s?.get(o);if(i?.parentNode===n)return s.delete(o),i.removeAttribute(LP),i;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=o,this.platformIsServer&&a.setAttribute(LP,this.appId),n.appendChild(a),a}}addStyleToHost(n,o){let s=this.getStyleElement(n,o),i=this.styleRef,a=i.get(o)?.elements;a?a.push(s):i.set(o,{elements:[s],usage:1})}resetHostNodes(){let n=this.hostNodes;n.clear(),n.add(this.doc.head)}};e.\u0275fac=function(o){return new(o||e)(Lt(Zi),Lt(lP),Lt(pP,8),Lt(kx))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),VP={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},GP=/%COMP%/g,gq="%COMP%",vSe=`_nghost-${gq}`,bSe=`_ngcontent-${gq}`,wSe=!0,CSe=new $t("",{providedIn:"root",factory:()=>wSe});function _Se(r){return bSe.replace(GP,r)}function SSe(r){return vSe.replace(GP,r)}function yq(r,e){return e.map(t=>t.replace(GP,r))}var pq=(()=>{let e=class e{constructor(n,o,s,i,a,c,l,u=null){this.eventManager=n,this.sharedStylesHost=o,this.appId=s,this.removeStylesOnCompDestroy=i,this.doc=a,this.platformId=c,this.ngZone=l,this.nonce=u,this.rendererByCompId=new Map,this.platformIsServer=$P(c),this.defaultRenderer=new q0(n,a,l,this.platformIsServer)}createRenderer(n,o){if(!n||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===nu.ShadowDom&&(o=$e(ie({},o),{encapsulation:nu.Emulated}));let s=this.getOrCreateRenderer(n,o);return s instanceof BT?s.applyToHost(n):s instanceof K0&&s.applyStyles(),s}getOrCreateRenderer(n,o){let s=this.rendererByCompId,i=s.get(o.id);if(!i){let a=this.doc,c=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,p=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(o.encapsulation){case nu.Emulated:i=new BT(l,u,o,this.appId,p,a,c,d);break;case nu.ShadowDom:return new UP(l,u,n,o,a,c,this.nonce,d);default:i=new K0(l,u,o,p,a,c,d);break}s.set(o.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(o){return new(o||e)(Lt(fq),Lt(mq),Lt(lP),Lt(CSe),Lt(Zi),Lt(kx),Lt(Lo),Lt(pP))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),q0=class{constructor(e,t,n,o){this.eventManager=e,this.doc=t,this.ngZone=n,this.platformIsServer=o,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(VP[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(dq(e)?e.content:e).appendChild(t)}insertBefore(e,t,n){e&&(dq(e)?e.content:e).insertBefore(t,n)}removeChild(e,t){t.remove()}selectRootElement(e,t){let n=typeof e=="string"?this.doc.querySelector(e):e;if(!n)throw new gt(-5104,!1);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,o){if(o){t=o+":"+t;let s=VP[o];s?e.setAttributeNS(s,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){let o=VP[n];o?e.removeAttributeNS(o,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,o){o&(Kp.DashCase|Kp.Important)?e.style.setProperty(t,n,o&Kp.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&Kp.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e!=null&&(e[t]=n)}setValue(e,t){e.nodeValue=t}listen(e,t,n){if(typeof e=="string"&&(e=rd().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(n))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function dq(r){return r.tagName==="TEMPLATE"&&r.content!==void 0}var UP=class extends q0{constructor(e,t,n,o,s,i,a,c){super(e,s,i,c),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let l=yq(o.id,o.styles);for(let u of l){let p=document.createElement("style");a&&p.setAttribute("nonce",a),p.textContent=u,this.shadowRoot.appendChild(p)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},K0=class extends q0{constructor(e,t,n,o,s,i,a,c){super(e,s,i,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=o,this.styles=c?yq(c,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},BT=class extends K0{constructor(e,t,n,o,s,i,a,c){let l=o+"-"+n.id;super(e,t,n,s,i,a,c,l),this.contentAttr=_Se(l),this.hostAttr=SSe(l)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}},ISe=(()=>{let e=class e extends H0{constructor(n){super(n)}supports(n){return!0}addEventListener(n,o,s){return n.addEventListener(o,s,!1),()=>this.removeEventListener(n,o,s)}removeEventListener(n,o,s){return n.removeEventListener(o,s)}};e.\u0275fac=function(o){return new(o||e)(Lt(Zi))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),TSe=(()=>{let e=class e extends H0{constructor(n){super(n),this.delegate=rt(ZH,{optional:!0})}supports(n){return this.delegate?this.delegate.supports(n):!1}addEventListener(n,o,s){return this.delegate.addEventListener(n,o,s)}removeEventListener(n,o,s){return this.delegate.removeEventListener(n,o,s)}};e.\u0275fac=function(o){return new(o||e)(Lt(Zi))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})(),hq=["alt","control","meta","shift"],kSe={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ESe={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey},NSe=(()=>{let e=class e extends H0{constructor(n){super(n)}supports(n){return e.parseEventName(n)!=null}addEventListener(n,o,s){let i=e.parseEventName(o),a=e.eventCallback(i.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>rd().onAndCancel(n,i.domEventName,a))}static parseEventName(n){let o=n.toLowerCase().split("."),s=o.shift();if(o.length===0||!(s==="keydown"||s==="keyup"))return null;let i=e._normalizeKey(o.pop()),a="",c=o.indexOf("code");if(c>-1&&(o.splice(c,1),a="code."),hq.forEach(u=>{let p=o.indexOf(u);p>-1&&(o.splice(p,1),a+=u+".")}),a+=i,o.length!=0||i.length===0)return null;let l={};return l.domEventName=s,l.fullKey=a,l}static matchEventFullKeyCode(n,o){let s=kSe[n.key]||n.key,i="";return o.indexOf("code.")>-1&&(s=n.code,i="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),hq.forEach(a=>{if(a!==s){let c=ESe[a];c(n)&&(i+=a+".")}}),i+=s,i===o)}static eventCallback(n,o,s){return i=>{e.matchEventFullKeyCode(i,n)&&s.runGuarded(()=>o(i))}}static _normalizeKey(n){return n==="esc"?"escape":n}};e.\u0275fac=function(o){return new(o||e)(Lt(Zi))},e.\u0275prov=st({token:e,factory:e.\u0275fac});let r=e;return r})();function xq(r,e){return YH(ie({rootComponent:r},DSe(e)))}function DSe(r){return{appProviders:[...FSe,...r?.providers??[]],platformProviders:MSe}}function ASe(){zP.makeCurrent()}function RSe(){return new xh}function OSe(){return Mj(document),document}var MSe=[{provide:kx,useValue:uq},{provide:uP,useValue:ASe,multi:!0},{provide:Zi,useFactory:OSe,deps:[]}];var FSe=[{provide:IT,useValue:"root"},{provide:xh,useFactory:RSe,deps:[]},{provide:VT,useClass:ISe,multi:!0,deps:[Zi,Lo,kx]},{provide:VT,useClass:NSe,multi:!0,deps:[Zi]},{provide:VT,useClass:TSe,multi:!0},pq,mq,fq,{provide:wx,useExisting:pq},{provide:$T,useClass:xSe,deps:[]},[]];var vq=(()=>{let e=class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}};e.\u0275fac=function(o){return new(o||e)(Lt(Zi))},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();var Qt="primary",pC=Symbol("RouteTitle"),KP=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function Fx(r){return new KP(r)}function $Se(r,e,t){let n=t.path.split("/");if(n.length>r.length||t.pathMatch==="full"&&(e.hasChildren()||n.length<r.length))return null;let o={};for(let s=0;s<n.length;s++){let i=n[s],a=r[s];if(i[0]===":")o[i.substring(1)]=a;else if(i!==a.path)return null}return{consumed:r.slice(0,n.length),posParams:o}}function LSe(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!au(r[t],e[t]))return!1;return!0}function au(r,e){let t=r?XP(r):void 0,n=e?XP(e):void 0;if(!t||!n||t.length!=n.length)return!1;let o;for(let s=0;s<t.length;s++)if(o=t[s],!kq(r[o],e[o]))return!1;return!0}function XP(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function kq(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;let t=[...r].sort(),n=[...e].sort();return t.every((o,s)=>n[s]===o)}else return r===e}function Eq(r){return r.length>0?r[r.length-1]:null}function kh(r){return IM(r)?r:cg(r)?so(Promise.resolve(r)):Kt(r)}var VSe={exact:Dq,subset:Aq},Nq={exact:BSe,subset:zSe,ignored:()=>!0};function bq(r,e,t){return VSe[t.paths](r.root,e.root,t.matrixParams)&&Nq[t.queryParams](r.queryParams,e.queryParams)&&!(t.fragment==="exact"&&r.fragment!==e.fragment)}function BSe(r,e){return au(r,e)}function Dq(r,e,t){if(!hg(r.segments,e.segments)||!GT(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(let n in e.children)if(!r.children[n]||!Dq(r.children[n],e.children[n],t))return!1;return!0}function zSe(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>kq(r[t],e[t]))}function Aq(r,e,t){return Rq(r,e,e.segments,t)}function Rq(r,e,t,n){if(r.segments.length>t.length){let o=r.segments.slice(0,t.length);return!(!hg(o,t)||e.hasChildren()||!GT(o,t,n))}else if(r.segments.length===t.length){if(!hg(r.segments,t)||!GT(r.segments,t,n))return!1;for(let o in e.children)if(!r.children[o]||!Aq(r.children[o],e.children[o],n))return!1;return!0}else{let o=t.slice(0,r.segments.length),s=t.slice(r.segments.length);return!hg(r.segments,o)||!GT(r.segments,o,n)||!r.children[Qt]?!1:Rq(r.children[Qt],e,s,n)}}function GT(r,e,t){return e.every((n,o)=>Nq[t](r[o].parameters,n.parameters))}var od=class{constructor(e=new Zr([],{}),t={},n=null){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap??=Fx(this.queryParams),this._queryParamMap}toString(){return WSe.serialize(this)}},Zr=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return WT(this)}},dg=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=Fx(this.parameters),this._parameterMap}toString(){return Mq(this)}};function USe(r,e){return hg(r,e)&&r.every((t,n)=>au(t.parameters,e[n].parameters))}function hg(r,e){return r.length!==e.length?!1:r.every((t,n)=>t.path===e[n].path)}function GSe(r,e){let t=[];return Object.entries(r.children).forEach(([n,o])=>{n===Qt&&(t=t.concat(e(o,n)))}),Object.entries(r.children).forEach(([n,o])=>{n!==Qt&&(t=t.concat(e(o,n)))}),t}var w$=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>new tC,providedIn:"root"});let r=e;return r})(),tC=class{parse(e){let t=new ZP(e);return new od(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${X0(e.root,!0)}`,n=qSe(e.queryParams),o=typeof e.fragment=="string"?`#${jSe(e.fragment)}`:"";return`${t}${n}${o}`}},WSe=new tC;function WT(r){return r.segments.map(e=>Mq(e)).join("/")}function X0(r,e){if(!r.hasChildren())return WT(r);if(e){let t=r.children[Qt]?X0(r.children[Qt],!1):"",n=[];return Object.entries(r.children).forEach(([o,s])=>{o!==Qt&&n.push(`${o}:${X0(s,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}else{let t=GSe(r,(n,o)=>o===Qt?[X0(r.children[Qt],!1)]:[`${o}:${X0(n,!1)}`]);return Object.keys(r.children).length===1&&r.children[Qt]!=null?`${WT(r)}/${t[0]}`:`${WT(r)}/(${t.join("//")})`}}function Oq(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zT(r){return Oq(r).replace(/%3B/gi,";")}function jSe(r){return encodeURI(r)}function YP(r){return Oq(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function jT(r){return decodeURIComponent(r)}function wq(r){return jT(r.replace(/\+/g,"%20"))}function Mq(r){return`${YP(r.path)}${HSe(r.parameters)}`}function HSe(r){return Object.entries(r).map(([e,t])=>`;${YP(e)}=${YP(t)}`).join("")}function qSe(r){let e=Object.entries(r).map(([t,n])=>Array.isArray(n)?n.map(o=>`${zT(t)}=${zT(o)}`).join("&"):`${zT(t)}=${zT(n)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var KSe=/^[^\/()?;#]+/;function WP(r){let e=r.match(KSe);return e?e[0]:""}var XSe=/^[^\/()?;=#]+/;function YSe(r){let e=r.match(XSe);return e?e[0]:""}var ZSe=/^[^=?&#]+/;function QSe(r){let e=r.match(ZSe);return e?e[0]:""}var JSe=/^[^&#]+/;function eIe(r){let e=r.match(JSe);return e?e[0]:""}var ZP=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Zr([],{}):new Zr([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n[Qt]=new Zr(e,t)),n}parseSegment(){let e=WP(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new gt(4009,!1);return this.capture(e),new dg(jT(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=YSe(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let o=WP(this.remaining);o&&(n=o,this.capture(n))}e[jT(t)]=jT(n)}parseQueryParam(e){let t=QSe(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){let i=eIe(this.remaining);i&&(n=i,this.capture(n))}let o=wq(t),s=wq(n);if(e.hasOwnProperty(o)){let i=e[o];Array.isArray(i)||(i=[i],e[o]=i),i.push(s)}else e[o]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let n=WP(this.remaining),o=this.remaining[n.length];if(o!=="/"&&o!==")"&&o!==";")throw new gt(4010,!1);let s;n.indexOf(":")>-1?(s=n.slice(0,n.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=Qt);let i=this.parseChildren();t[s]=Object.keys(i).length===1?i[Qt]:new Zr([],i),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new gt(4011,!1)}};function Fq(r){return r.segments.length>0?new Zr([],{[Qt]:r}):r}function Pq(r){let e={};for(let[n,o]of Object.entries(r.children)){let s=Pq(o);if(n===Qt&&s.segments.length===0&&s.hasChildren())for(let[i,a]of Object.entries(s.children))e[i]=a;else(s.segments.length>0||s.hasChildren())&&(e[n]=s)}let t=new Zr(r.segments,e);return tIe(t)}function tIe(r){if(r.numberOfChildren===1&&r.children[Qt]){let e=r.children[Qt];return new Zr(r.segments.concat(e.segments),e.children)}return r}function rC(r){return r instanceof od}function rIe(r,e,t=null,n=null){let o=$q(r);return Lq(o,e,t,n)}function $q(r){let e;function t(s){let i={};for(let c of s.children){let l=t(c);i[c.outlet]=l}let a=new Zr(s.url,i);return s===r&&(e=a),a}let n=t(r.root),o=Fq(n);return e??o}function Lq(r,e,t,n){let o=r;for(;o.parent;)o=o.parent;if(e.length===0)return jP(o,o,o,t,n);let s=nIe(e);if(s.toRoot())return jP(o,o,new Zr([],{}),t,n);let i=oIe(s,o,r),a=i.processChildren?Q0(i.segmentGroup,i.index,s.commands):Bq(i.segmentGroup,i.index,s.commands);return jP(o,i.segmentGroup,a,t,n)}function HT(r){return typeof r=="object"&&r!=null&&!r.outlets&&!r.segmentPath}function nC(r){return typeof r=="object"&&r!=null&&r.outlets}function jP(r,e,t,n,o){let s={};n&&Object.entries(n).forEach(([c,l])=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`});let i;r===e?i=t:i=Vq(r,e,t);let a=Fq(Pq(i));return new od(a,s,o)}function Vq(r,e,t){let n={};return Object.entries(r.children).forEach(([o,s])=>{s===e?n[o]=t:n[o]=Vq(s,e,t)}),new Zr(r.segments,n)}var qT=class{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&HT(n[0]))throw new gt(4003,!1);let o=n.find(nC);if(o&&o!==Eq(n))throw new gt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function nIe(r){if(typeof r[0]=="string"&&r.length===1&&r[0]==="/")return new qT(!0,0,r);let e=0,t=!1,n=r.reduce((o,s,i)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...o,{outlets:a}]}if(s.segmentPath)return[...o,s.segmentPath]}return typeof s!="string"?[...o,s]:i===0?(s.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&o.push(a))}),o):[...o,s]},[]);return new qT(t,e,n)}var Rx=class{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}};function oIe(r,e,t){if(r.isAbsolute)return new Rx(e,!0,0);if(!t)return new Rx(e,!1,NaN);if(t.parent===null)return new Rx(t,!0,0);let n=HT(r.commands[0])?0:1,o=t.segments.length-1+n;return sIe(t,o,r.numberOfDoubleDots)}function sIe(r,e,t){let n=r,o=e,s=t;for(;s>o;){if(s-=o,n=n.parent,!n)throw new gt(4005,!1);o=n.segments.length}return new Rx(n,!1,o-s)}function iIe(r){return nC(r[0])?r[0].outlets:{[Qt]:r}}function Bq(r,e,t){if(r??=new Zr([],{}),r.segments.length===0&&r.hasChildren())return Q0(r,e,t);let n=aIe(r,e,t),o=t.slice(n.commandIndex);if(n.match&&n.pathIndex<r.segments.length){let s=new Zr(r.segments.slice(0,n.pathIndex),{});return s.children[Qt]=new Zr(r.segments.slice(n.pathIndex),r.children),Q0(s,0,o)}else return n.match&&o.length===0?new Zr(r.segments,{}):n.match&&!r.hasChildren()?QP(r,e,t):n.match?Q0(r,0,o):QP(r,e,t)}function Q0(r,e,t){if(t.length===0)return new Zr(r.segments,{});{let n=iIe(t),o={};if(Object.keys(n).some(s=>s!==Qt)&&r.children[Qt]&&r.numberOfChildren===1&&r.children[Qt].segments.length===0){let s=Q0(r.children[Qt],e,t);return new Zr(r.segments,s.children)}return Object.entries(n).forEach(([s,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(o[s]=Bq(r.children[s],e,i))}),Object.entries(r.children).forEach(([s,i])=>{n[s]===void 0&&(o[s]=i)}),new Zr(r.segments,o)}}function aIe(r,e,t){let n=0,o=e,s={match:!1,pathIndex:0,commandIndex:0};for(;o<r.segments.length;){if(n>=t.length)return s;let i=r.segments[o],a=t[n];if(nC(a))break;let c=`${a}`,l=n<t.length-1?t[n+1]:null;if(o>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!_q(c,l,i))return s;n+=2}else{if(!_q(c,{},i))return s;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}function QP(r,e,t){let n=r.segments.slice(0,e),o=0;for(;o<t.length;){let s=t[o];if(nC(s)){let c=cIe(s.outlets);return new Zr(n,c)}if(o===0&&HT(t[0])){let c=r.segments[e];n.push(new dg(c.path,Cq(t[0]))),o++;continue}let i=nC(s)?s.outlets[Qt]:`${s}`,a=o<t.length-1?t[o+1]:null;i&&a&&HT(a)?(n.push(new dg(i,Cq(a))),o+=2):(n.push(new dg(i,{})),o++)}return new Zr(n,{})}function cIe(r){let e={};return Object.entries(r).forEach(([t,n])=>{typeof n=="string"&&(n=[n]),n!==null&&(e[t]=QP(new Zr([],{}),0,n))}),e}function Cq(r){let e={};return Object.entries(r).forEach(([t,n])=>e[t]=`${n}`),e}function _q(r,e,t){return r==t.path&&au(e,t.parameters)}var J0="imperative",as=function(r){return r[r.NavigationStart=0]="NavigationStart",r[r.NavigationEnd=1]="NavigationEnd",r[r.NavigationCancel=2]="NavigationCancel",r[r.NavigationError=3]="NavigationError",r[r.RoutesRecognized=4]="RoutesRecognized",r[r.ResolveStart=5]="ResolveStart",r[r.ResolveEnd=6]="ResolveEnd",r[r.GuardsCheckStart=7]="GuardsCheckStart",r[r.GuardsCheckEnd=8]="GuardsCheckEnd",r[r.RouteConfigLoadStart=9]="RouteConfigLoadStart",r[r.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",r[r.ChildActivationStart=11]="ChildActivationStart",r[r.ChildActivationEnd=12]="ChildActivationEnd",r[r.ActivationStart=13]="ActivationStart",r[r.ActivationEnd=14]="ActivationEnd",r[r.Scroll=15]="Scroll",r[r.NavigationSkipped=16]="NavigationSkipped",r}(as||{}),Ta=class{constructor(e,t){this.id=e,this.url=t}},oC=class extends Ta{constructor(e,t,n="imperative",o=null){super(e,t),this.type=as.NavigationStart,this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},sd=class extends Ta{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n,this.type=as.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ji=function(r){return r[r.Redirect=0]="Redirect",r[r.SupersededByNewNavigation=1]="SupersededByNewNavigation",r[r.NoDataFromResolver=2]="NoDataFromResolver",r[r.GuardRejected=3]="GuardRejected",r}(Ji||{}),JP=function(r){return r[r.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",r[r.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",r}(JP||{}),nd=class extends Ta{constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o,this.type=as.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},fg=class extends Ta{constructor(e,t,n,o){super(e,t),this.reason=n,this.code=o,this.type=as.NavigationSkipped}},sC=class extends Ta{constructor(e,t,n,o){super(e,t),this.error=n,this.target=o,this.type=as.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},KT=class extends Ta{constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o,this.type=as.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},e$=class extends Ta{constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o,this.type=as.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},t$=class extends Ta{constructor(e,t,n,o,s){super(e,t),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=s,this.type=as.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},r$=class extends Ta{constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o,this.type=as.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},n$=class extends Ta{constructor(e,t,n,o){super(e,t),this.urlAfterRedirects=n,this.state=o,this.type=as.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},o$=class{constructor(e){this.route=e,this.type=as.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},s$=class{constructor(e){this.route=e,this.type=as.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},i$=class{constructor(e){this.snapshot=e,this.type=as.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},a$=class{constructor(e){this.snapshot=e,this.type=as.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},c$=class{constructor(e){this.snapshot=e,this.type=as.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},l$=class{constructor(e){this.snapshot=e,this.type=as.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var iC=class{},Px=class{constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function lIe(r,e){return r.providers&&!r._injector&&(r._injector=SP(r.providers,e,`Route: ${r.path}`)),r._injector??e}function xc(r){return r.outlet||Qt}function uIe(r,e){let t=r.filter(n=>xc(n)===e);return t.push(...r.filter(n=>xc(n)!==e)),t}function dC(r){if(!r)return null;if(r.routeConfig?._injector)return r.routeConfig._injector;for(let e=r.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var u$=class{get injector(){return dC(this.route?.snapshot)??this.rootInjector}set injector(e){}constructor(e){this.rootInjector=e,this.outlet=null,this.route=null,this.children=new t1(this.rootInjector),this.attachRef=null}},t1=(()=>{let e=class e{constructor(n){this.rootInjector=n,this.contexts=new Map}onChildOutletCreated(n,o){let s=this.getOrCreateContext(n);s.outlet=o,this.contexts.set(n,s)}onChildOutletDestroyed(n){let o=this.getContext(n);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){let n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let o=this.getContext(n);return o||(o=new u$(this.rootInjector),this.contexts.set(n,o)),o}getContext(n){return this.contexts.get(n)||null}};e.\u0275fac=function(o){return new(o||e)(Lt(va))},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),XT=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=p$(e,this._root);return t?t.children.map(n=>n.value):[]}firstChild(e){let t=p$(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=d$(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return d$(e,this._root).map(t=>t.value)}};function p$(r,e){if(r===e.value)return e;for(let t of e.children){let n=p$(r,t);if(n)return n}return null}function d$(r,e){if(r===e.value)return[e];for(let t of e.children){let n=d$(r,t);if(n.length)return n.unshift(e),n}return[]}var Qi=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Ax(r){let e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}var YT=class extends XT{constructor(e,t){super(e),this.snapshot=t,C$(this,e)}toString(){return this.snapshot.toString()}};function zq(r){let e=pIe(r),t=new ss([new dg("",{})]),n=new ss({}),o=new ss({}),s=new ss({}),i=new ss(""),a=new Cs(t,n,s,i,o,Qt,r,e.root);return a.snapshot=e.root,new YT(new Qi(a,[]),e)}function pIe(r){let e={},t={},n={},o="",s=new Ox([],e,n,o,t,Qt,r,null,{});return new QT("",new Qi(s,[]))}var Cs=class{constructor(e,t,n,o,s,i,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=s,this.outlet=i,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe(cr(l=>l[pC]))??Kt(void 0),this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(cr(e=>Fx(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(cr(e=>Fx(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function ZT(r,e,t="emptyOnly"){let n,{routeConfig:o}=r;return e!==null&&(t==="always"||o?.path===""||!e.component&&!e.routeConfig?.loadComponent)?n={params:ie(ie({},e.params),r.params),data:ie(ie({},e.data),r.data),resolve:ie(ie(ie(ie({},r.data),e.data),o?.data),r._resolvedData)}:n={params:ie({},r.params),data:ie({},r.data),resolve:ie(ie({},r.data),r._resolvedData??{})},o&&Gq(o)&&(n.resolve[pC]=o.title),n}var Ox=class{get title(){return this.data?.[pC]}constructor(e,t,n,o,s,i,a,c,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=o,this.data=s,this.outlet=i,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Fx(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Fx(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(n=>n.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},QT=class extends XT{constructor(e,t){super(t),this.url=e,C$(this,t)}toString(){return Uq(this._root)}};function C$(r,e){e.value._routerState=r,e.children.forEach(t=>C$(r,t))}function Uq(r){let e=r.children.length>0?` { ${r.children.map(Uq).join(", ")} } `:"";return`${r.value}${e}`}function HP(r){if(r.snapshot){let e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,au(e.queryParams,t.queryParams)||r.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&r.fragmentSubject.next(t.fragment),au(e.params,t.params)||r.paramsSubject.next(t.params),LSe(e.url,t.url)||r.urlSubject.next(t.url),au(e.data,t.data)||r.dataSubject.next(t.data)}else r.snapshot=r._futureSnapshot,r.dataSubject.next(r._futureSnapshot.data)}function h$(r,e){let t=au(r.params,e.params)&&USe(r.url,e.url),n=!r.parent!=!e.parent;return t&&!n&&(!r.parent||h$(r.parent,e.parent))}function Gq(r){return typeof r.title=="string"||r.title===null}var _$=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Qt,this.activateEvents=new tn,this.deactivateEvents=new tn,this.attachEvents=new tn,this.detachEvents=new tn,this.parentContexts=rt(t1),this.location=rt(_h),this.changeDetector=rt(yc),this.inputBinder=rt(S$,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){let{firstChange:o,previousValue:s}=n.name;if(o)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new gt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new gt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new gt(4012,!1);this.location.detach();let n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,o){this.activated=n,this._activatedRoute=o,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){let n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,o){if(this.isActivated)throw new gt(4013,!1);this._activatedRoute=n;let s=this.location,a=n.snapshot.component,c=this.parentContexts.getOrCreateContext(this.name).children,l=new f$(n,c,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:l,environmentInjector:o}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=ws({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[mc]});let r=e;return r})(),f$=class r{__ngOutletInjector(e){return new r(this.route,this.childContexts,e)}constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===Cs?this.route:e===t1?this.childContexts:this.parent.get(e,t)}},S$=new $t("");function dIe(r,e,t){let n=aC(r,e._root,t?t._root:void 0);return new YT(n,e)}function aC(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){let n=t.value;n._futureSnapshot=e.value;let o=hIe(r,e,t);return new Qi(n,o)}else{if(r.shouldAttach(e.value)){let s=r.retrieve(e.value);if(s!==null){let i=s.route;return i.value._futureSnapshot=e.value,i.children=e.children.map(a=>aC(r,a)),i}}let n=fIe(e.value),o=e.children.map(s=>aC(r,s));return new Qi(n,o)}}function hIe(r,e,t){return e.children.map(n=>{for(let o of t.children)if(r.shouldReuseRoute(n.value,o.value.snapshot))return aC(r,n,o);return aC(r,n)})}function fIe(r){return new Cs(new ss(r.url),new ss(r.params),new ss(r.queryParams),new ss(r.fragment),new ss(r.data),r.outlet,r.component,r)}var cC=class{constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},Wq="ngNavigationCancelingError";function JT(r,e){let{redirectTo:t,navigationBehaviorOptions:n}=rC(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=jq(!1,Ji.Redirect);return o.url=t,o.navigationBehaviorOptions=n,o}function jq(r,e){let t=new Error(`NavigationCancelingError: ${r||""}`);return t[Wq]=!0,t.cancellationCode=e,t}function mIe(r){return Hq(r)&&rC(r.url)}function Hq(r){return!!r&&r[Wq]}var gIe=(r,e,t,n)=>cr(o=>(new m$(e,o.targetRouterState,o.currentRouterState,t,n).activate(r),o)),m$=class{constructor(e,t,n,o,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),HP(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){let o=Ax(t);e.children.forEach(s=>{let i=s.value.outlet;this.deactivateRoutes(s,o[i],n),delete o[i]}),Object.values(o).forEach(s=>{this.deactivateRouteAndItsChildren(s,n)})}deactivateRoutes(e,t,n){let o=e.value,s=t?t.value:null;if(o===s)if(o.component){let i=n.getContext(o.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else s&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,s=Ax(e);for(let i of Object.values(s))this.deactivateRouteAndItsChildren(i,o);if(n&&n.outlet){let i=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:i,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let n=t.getContext(e.value.outlet),o=n&&e.value.component?n.children:t,s=Ax(e);for(let i of Object.values(s))this.deactivateRouteAndItsChildren(i,o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(e,t,n){let o=Ax(t);e.children.forEach(s=>{this.activateRoutes(s,o[s.value.outlet],n),this.forwardEvent(new l$(s.value.snapshot))}),e.children.length&&this.forwardEvent(new a$(e.value.snapshot))}activateRoutes(e,t,n){let o=e.value,s=t?t.value:null;if(HP(o),o===s)if(o.component){let i=n.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(o.component){let i=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),i.children.onOutletReAttached(a.contexts),i.attachRef=a.componentRef,i.route=a.route.value,i.outlet&&i.outlet.attach(a.componentRef,a.route.value),HP(a.route.value),this.activateChildRoutes(e,null,i.children)}else i.attachRef=null,i.route=o,i.outlet&&i.outlet.activateWith(o,i.injector),this.activateChildRoutes(e,null,i.children)}else this.activateChildRoutes(e,null,n)}},e1=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Mx=class{constructor(e,t){this.component=e,this.route=t}};function yIe(r,e,t){let n=r._root,o=e?e._root:null;return Y0(n,o,t,[n.value])}function xIe(r){let e=r.routeConfig?r.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:r,guards:e}}function Lx(r,e){let t=Symbol(),n=e.get(r,t);return n===t?typeof r=="function"&&!g4(r)?r:e.get(r):n}function Y0(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let s=Ax(e);return r.children.forEach(i=>{vIe(i,s[i.value.outlet],t,n.concat([i.value]),o),delete s[i.value.outlet]}),Object.entries(s).forEach(([i,a])=>eC(a,t.getContext(i),o)),o}function vIe(r,e,t,n,o={canDeactivateChecks:[],canActivateChecks:[]}){let s=r.value,i=e?e.value:null,a=t?t.getContext(r.value.outlet):null;if(i&&s.routeConfig===i.routeConfig){let c=bIe(i,s,s.routeConfig.runGuardsAndResolvers);c?o.canActivateChecks.push(new e1(n)):(s.data=i.data,s._resolvedData=i._resolvedData),s.component?Y0(r,e,a?a.children:null,n,o):Y0(r,e,t,n,o),c&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Mx(a.outlet.component,i))}else i&&eC(e,a,o),o.canActivateChecks.push(new e1(n)),s.component?Y0(r,null,a?a.children:null,n,o):Y0(r,null,t,n,o);return o}function bIe(r,e,t){if(typeof t=="function")return t(r,e);switch(t){case"pathParamsChange":return!hg(r.url,e.url);case"pathParamsOrQueryParamsChange":return!hg(r.url,e.url)||!au(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!h$(r,e)||!au(r.queryParams,e.queryParams);case"paramsChange":default:return!h$(r,e)}}function eC(r,e,t){let n=Ax(r),o=r.value;Object.entries(n).forEach(([s,i])=>{o.component?e?eC(i,e.children.getContext(s),t):eC(i,null,t):eC(i,e,t)}),o.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Mx(e.outlet.component,o)):t.canDeactivateChecks.push(new Mx(null,o)):t.canDeactivateChecks.push(new Mx(null,o))}function hC(r){return typeof r=="function"}function wIe(r){return typeof r=="boolean"}function CIe(r){return r&&hC(r.canLoad)}function _Ie(r){return r&&hC(r.canActivate)}function SIe(r){return r&&hC(r.canActivateChild)}function IIe(r){return r&&hC(r.canDeactivate)}function TIe(r){return r&&hC(r.canMatch)}function qq(r){return r instanceof uc||r?.name==="EmptyError"}var UT=Symbol("INITIAL_VALUE");function $x(){return pc(r=>BI(r.map(e=>e.pipe(ya(1),DM(UT)))).pipe(cr(e=>{for(let t of e)if(t!==!0){if(t===UT)return UT;if(t===!1||kIe(t))return t}return!0}),yi(e=>e!==UT),ya(1)))}function kIe(r){return rC(r)||r instanceof cC}function EIe(r,e){return $o(t=>{let{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:s,canDeactivateChecks:i}}=t;return i.length===0&&s.length===0?Kt($e(ie({},t),{guardsResult:!0})):NIe(i,n,o,r).pipe($o(a=>a&&wIe(a)?DIe(n,s,r,e):Kt(a)),cr(a=>$e(ie({},t),{guardsResult:a})))})}function NIe(r,e,t,n){return so(r).pipe($o(o=>FIe(o.component,o.route,t,e,n)),eu(o=>o!==!0,!0))}function DIe(r,e,t,n){return so(e).pipe(cx(o=>ix(RIe(o.route.parent,n),AIe(o.route,n),MIe(r,o.path,t),OIe(r,o.route,t))),eu(o=>o!==!0,!0))}function AIe(r,e){return r!==null&&e&&e(new c$(r)),Kt(!0)}function RIe(r,e){return r!==null&&e&&e(new i$(r)),Kt(!0)}function OIe(r,e,t){let n=e.routeConfig?e.routeConfig.canActivate:null;if(!n||n.length===0)return Kt(!0);let o=n.map(s=>zI(()=>{let i=dC(e)??t,a=Lx(s,i),c=_Ie(a)?a.canActivate(e,r):Yp(i,()=>a(e,r));return kh(c).pipe(eu())}));return Kt(o).pipe($x())}function MIe(r,e,t){let n=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(i=>xIe(i)).filter(i=>i!==null).map(i=>zI(()=>{let a=i.guards.map(c=>{let l=dC(i.node)??t,u=Lx(c,l),p=SIe(u)?u.canActivateChild(n,r):Yp(l,()=>u(n,r));return kh(p).pipe(eu())});return Kt(a).pipe($x())}));return Kt(s).pipe($x())}function FIe(r,e,t,n,o){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return Kt(!0);let i=s.map(a=>{let c=dC(e)??o,l=Lx(a,c),u=IIe(l)?l.canDeactivate(r,e,t,n):Yp(c,()=>l(r,e,t,n));return kh(u).pipe(eu())});return Kt(i).pipe($x())}function PIe(r,e,t,n){let o=e.canLoad;if(o===void 0||o.length===0)return Kt(!0);let s=o.map(i=>{let a=Lx(i,r),c=CIe(a)?a.canLoad(e,t):Yp(r,()=>a(e,t));return kh(c)});return Kt(s).pipe($x(),Kq(n))}function Kq(r){return bM(is(e=>{if(typeof e!="boolean")throw JT(r,e)}),cr(e=>e===!0))}function $Ie(r,e,t,n){let o=e.canMatch;if(!o||o.length===0)return Kt(!0);let s=o.map(i=>{let a=Lx(i,r),c=TIe(a)?a.canMatch(e,t):Yp(r,()=>a(e,t));return kh(c)});return Kt(s).pipe($x(),Kq(n))}var lC=class{constructor(e){this.segmentGroup=e||null}},uC=class extends Error{constructor(e){super(),this.urlTree=e}};function Dx(r){return sx(new lC(r))}function LIe(r){return sx(new gt(4e3,!1))}function VIe(r){return sx(jq(!1,Ji.GuardRejected))}var g$=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let n=[],o=t.root;for(;;){if(n=n.concat(o.segments),o.numberOfChildren===0)return Kt(n);if(o.numberOfChildren>1||!o.children[Qt])return LIe(`${e.redirectTo}`);o=o.children[Qt]}}applyRedirectCommands(e,t,n,o,s){if(typeof t!="string"){let a=t,{queryParams:c,fragment:l,routeConfig:u,url:p,outlet:d,params:h,data:f,title:m}=o,g=Yp(s,()=>a({params:h,data:f,queryParams:c,fragment:l,routeConfig:u,url:p,outlet:d,title:m}));if(g instanceof od)throw new uC(g);t=g}let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,n);if(t[0]==="/")throw new uC(i);return i}applyRedirectCreateUrlTree(e,t,n,o){let s=this.createSegmentGroup(e,t.root,n,o);return new od(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let n={};return Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&s[0]===":"){let a=s.substring(1);n[o]=t[a]}else n[o]=s}),n}createSegmentGroup(e,t,n,o){let s=this.createSegments(e,t.segments,n,o),i={};return Object.entries(t.children).forEach(([a,c])=>{i[a]=this.createSegmentGroup(e,c,n,o)}),new Zr(s,i)}createSegments(e,t,n,o){return t.map(s=>s.path[0]===":"?this.findPosParam(e,s,o):this.findOrReturn(s,n))}findPosParam(e,t,n){let o=n[t.path.substring(1)];if(!o)throw new gt(4001,!1);return o}findOrReturn(e,t){let n=0;for(let o of t){if(o.path===e.path)return t.splice(n),o;n++}return e}},y$={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function BIe(r,e,t,n,o){let s=I$(r,e,t);return s.matched?(n=lIe(e,n),$Ie(n,e,t,o).pipe(cr(i=>i===!0?s:ie({},y$)))):Kt(s)}function I$(r,e,t){if(e.path==="**")return zIe(t);if(e.path==="")return e.pathMatch==="full"&&(r.hasChildren()||t.length>0)?ie({},y$):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let o=(e.matcher||$Se)(t,r,e);if(!o)return ie({},y$);let s={};Object.entries(o.posParams??{}).forEach(([a,c])=>{s[a]=c.path});let i=o.consumed.length>0?ie(ie({},s),o.consumed[o.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:i,positionalParamSegments:o.posParams??{}}}function zIe(r){return{matched:!0,parameters:r.length>0?Eq(r).parameters:{},consumedSegments:r,remainingSegments:[],positionalParamSegments:{}}}function Sq(r,e,t,n){return t.length>0&&WIe(r,t,n)?{segmentGroup:new Zr(e,GIe(n,new Zr(t,r.children))),slicedSegments:[]}:t.length===0&&jIe(r,t,n)?{segmentGroup:new Zr(r.segments,UIe(r,t,n,r.children)),slicedSegments:t}:{segmentGroup:new Zr(r.segments,r.children),slicedSegments:t}}function UIe(r,e,t,n){let o={};for(let s of t)if(r1(r,e,s)&&!n[xc(s)]){let i=new Zr([],{});o[xc(s)]=i}return ie(ie({},n),o)}function GIe(r,e){let t={};t[Qt]=e;for(let n of r)if(n.path===""&&xc(n)!==Qt){let o=new Zr([],{});t[xc(n)]=o}return t}function WIe(r,e,t){return t.some(n=>r1(r,e,n)&&xc(n)!==Qt)}function jIe(r,e,t){return t.some(n=>r1(r,e,n))}function r1(r,e,t){return(r.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function HIe(r,e,t,n){return xc(r)!==n&&(n===Qt||!r1(e,t,r))?!1:I$(e,r,t).matched}function qIe(r,e,t){return e.length===0&&!r.children[t]}var x$=class{};function KIe(r,e,t,n,o,s,i="emptyOnly"){return new v$(r,e,t,n,o,i,s).recognize()}var XIe=31,v$=class{constructor(e,t,n,o,s,i,a){this.injector=e,this.configLoader=t,this.rootComponentType=n,this.config=o,this.urlTree=s,this.paramsInheritanceStrategy=i,this.urlSerializer=a,this.applyRedirects=new g$(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new gt(4002,`'${e.segmentGroup}'`)}recognize(){let e=Sq(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(cr(({children:t,rootSnapshot:n})=>{let o=new Qi(n,t),s=new QT("",o),i=rIe(n,[],this.urlTree.queryParams,this.urlTree.fragment);return i.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(i),{state:s,tree:i}}))}match(e){let t=new Ox([],Object.freeze({}),Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Qt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,Qt,t).pipe(cr(n=>({children:n,rootSnapshot:t})),uh(n=>{if(n instanceof uC)return this.urlTree=n.urlTree,this.match(n.urlTree.root);throw n instanceof lC?this.noMatchError(n):n}))}processSegmentGroup(e,t,n,o,s){return n.segments.length===0&&n.hasChildren()?this.processChildren(e,t,n,s):this.processSegment(e,t,n,n.segments,o,!0,s).pipe(cr(i=>i instanceof Qi?[i]:[]))}processChildren(e,t,n,o){let s=[];for(let i of Object.keys(n.children))i==="primary"?s.unshift(i):s.push(i);return so(s).pipe(cx(i=>{let a=n.children[i],c=uIe(t,i);return this.processSegmentGroup(e,c,a,i,o)}),NM((i,a)=>(i.push(...a),i)),ph(null),EM(),$o(i=>{if(i===null)return Dx(n);let a=Xq(i);return YIe(a),Kt(a)}))}processSegment(e,t,n,o,s,i,a){return so(t).pipe(cx(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,n,o,s,i,a).pipe(uh(l=>{if(l instanceof lC)return Kt(null);throw l}))),eu(c=>!!c),uh(c=>{if(qq(c))return qIe(n,o,s)?Kt(new x$):Dx(n);throw c}))}processSegmentAgainstRoute(e,t,n,o,s,i,a,c){return HIe(n,o,s,i)?n.redirectTo===void 0?this.matchSegmentAgainstRoute(e,o,n,s,i,c):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,o,t,n,s,i,c):Dx(o):Dx(o)}expandSegmentAgainstRouteUsingRedirect(e,t,n,o,s,i,a){let{matched:c,parameters:l,consumedSegments:u,positionalParamSegments:p,remainingSegments:d}=I$(t,o,s);if(!c)return Dx(t);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>XIe&&(this.allowRedirects=!1));let h=new Ox(s,l,Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,Iq(o),xc(o),o.component??o._loadedComponent??null,o,Tq(o)),f=ZT(h,a,this.paramsInheritanceStrategy);h.params=Object.freeze(f.params),h.data=Object.freeze(f.data);let m=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,p,h,e);return this.applyRedirects.lineralizeSegments(o,m).pipe($o(g=>this.processSegment(e,n,t,g.concat(d),i,!1,a)))}matchSegmentAgainstRoute(e,t,n,o,s,i){let a=BIe(t,n,o,e,this.urlSerializer);return n.path==="**"&&(t.children={}),a.pipe(pc(c=>c.matched?(e=n._injector??e,this.getChildConfig(e,n,o).pipe(pc(({routes:l})=>{let u=n._loadedInjector??e,{parameters:p,consumedSegments:d,remainingSegments:h}=c,f=new Ox(d,p,Object.freeze(ie({},this.urlTree.queryParams)),this.urlTree.fragment,Iq(n),xc(n),n.component??n._loadedComponent??null,n,Tq(n)),m=ZT(f,i,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let{segmentGroup:g,slicedSegments:y}=Sq(t,d,h,l);if(y.length===0&&g.hasChildren())return this.processChildren(u,l,g,f).pipe(cr(b=>new Qi(f,b)));if(l.length===0&&y.length===0)return Kt(new Qi(f,[]));let x=xc(n)===s;return this.processSegment(u,l,g,y,x?Qt:s,!0,f).pipe(cr(b=>new Qi(f,b instanceof Qi?[b]:[])))}))):Dx(t)))}getChildConfig(e,t,n){return t.children?Kt({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?Kt({routes:t._loadedRoutes,injector:t._loadedInjector}):PIe(e,t,n,this.urlSerializer).pipe($o(o=>o?this.configLoader.loadChildren(e,t).pipe(is(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):VIe(t))):Kt({routes:[],injector:e})}};function YIe(r){r.sort((e,t)=>e.value.outlet===Qt?-1:t.value.outlet===Qt?1:e.value.outlet.localeCompare(t.value.outlet))}function ZIe(r){let e=r.value.routeConfig;return e&&e.path===""}function Xq(r){let e=[],t=new Set;for(let n of r){if(!ZIe(n)){e.push(n);continue}let o=e.find(s=>n.value.routeConfig===s.value.routeConfig);o!==void 0?(o.children.push(...n.children),t.add(o)):e.push(n)}for(let n of t){let o=Xq(n.children);e.push(new Qi(n.value,o))}return e.filter(n=>!t.has(n))}function Iq(r){return r.data||{}}function Tq(r){return r.resolve||{}}function QIe(r,e,t,n,o,s){return $o(i=>KIe(r,e,t,n,i.extractedUrl,o,s).pipe(cr(({state:a,tree:c})=>$e(ie({},i),{targetSnapshot:a,urlAfterRedirects:c}))))}function JIe(r,e){return $o(t=>{let{targetSnapshot:n,guards:{canActivateChecks:o}}=t;if(!o.length)return Kt(t);let s=new Set(o.map(c=>c.route)),i=new Set;for(let c of s)if(!i.has(c))for(let l of Yq(c))i.add(l);let a=0;return so(i).pipe(cx(c=>s.has(c)?eTe(c,n,r,e):(c.data=ZT(c,c.parent,r).resolve,Kt(void 0))),is(()=>a++),lx(1),$o(c=>a===i.size?Kt(t):Xi))})}function Yq(r){let e=r.children.map(t=>Yq(t)).flat();return[r,...e]}function eTe(r,e,t,n){let o=r.routeConfig,s=r._resolve;return o?.title!==void 0&&!Gq(o)&&(s[pC]=o.title),tTe(s,r,e,n).pipe(cr(i=>(r._resolvedData=i,r.data=ZT(r,r.parent,t).resolve,null)))}function tTe(r,e,t,n){let o=XP(r);if(o.length===0)return Kt({});let s={};return so(o).pipe($o(i=>rTe(r[i],e,t,n).pipe(eu(),is(a=>{if(a instanceof cC)throw JT(new tC,a);s[i]=a}))),lx(1),kM(s),uh(i=>qq(i)?Xi:sx(i)))}function rTe(r,e,t,n){let o=dC(e)??n,s=Lx(r,o),i=s.resolve?s.resolve(e,t):Yp(o,()=>s(e,t));return kh(i)}function qP(r){return pc(e=>{let t=r(e);return t?so(t).pipe(cr(()=>e)):Kt(e)})}var Zq=(()=>{let e=class e{buildTitle(n){let o,s=n.root;for(;s!==void 0;)o=this.getResolvedTitleForRoute(s)??o,s=s.children.find(i=>i.outlet===Qt);return o}getResolvedTitleForRoute(n){return n.data[pC]}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(nTe),providedIn:"root"});let r=e;return r})(),nTe=(()=>{let e=class e extends Zq{constructor(n){super(),this.title=n}updateTitle(n){let o=this.buildTitle(n);o!==void 0&&this.title.setTitle(o)}};e.\u0275fac=function(o){return new(o||e)(Lt(vq))},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),T$=new $t("",{providedIn:"root",factory:()=>({})}),oTe=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=Dt({type:e,selectors:[["ng-component"]],standalone:!0,features:[At],decls:1,vars:0,template:function(o,s){o&1&&mt(0,"router-outlet")},dependencies:[_$],encapsulation:2});let r=e;return r})();function k$(r){let e=r.children&&r.children.map(k$),t=e?$e(ie({},r),{children:e}):ie({},r);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Qt&&(t.component=oTe),t}var E$=new $t(""),sTe=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=rt(DP)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Kt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);let o=kh(n.loadComponent()).pipe(cr(Qq),is(i=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=i}),b0(()=>{this.componentLoaders.delete(n)})),s=new nx(o,()=>new Yr).pipe(rx());return this.componentLoaders.set(n,s),s}loadChildren(n,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return Kt({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);let i=iTe(o,this.compiler,n,this.onLoadEndListener).pipe(b0(()=>{this.childrenLoaders.delete(o)})),a=new nx(i,()=>new Yr).pipe(rx());return this.childrenLoaders.set(o,a),a}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function iTe(r,e,t,n){return kh(r.loadChildren()).pipe(cr(Qq),$o(o=>o instanceof R0||Array.isArray(o)?Kt(o):so(e.compileModuleAsync(o))),cr(o=>{n&&n(r);let s,i,a=!1;return Array.isArray(o)?(i=o,a=!0):(s=o.create(t).injector,i=s.get(E$,[],{optional:!0,self:!0}).flat()),{routes:i.map(k$),injector:s}}))}function aTe(r){return r&&typeof r=="object"&&"default"in r}function Qq(r){return aTe(r)?r.default:r}var N$=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(cTe),providedIn:"root"});let r=e;return r})(),cTe=(()=>{let e=class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,o){return n}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),lTe=new $t("");var uTe=new $t(""),pTe=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Yr,this.transitionAbortSubject=new Yr,this.configLoader=rt(sTe),this.environmentInjector=rt(va),this.urlSerializer=rt(w$),this.rootContexts=rt(t1),this.location=rt(W0),this.inputBindingEnabled=rt(S$,{optional:!0})!==null,this.titleStrategy=rt(Zq),this.options=rt(T$,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=rt(N$),this.createViewTransition=rt(lTe,{optional:!0}),this.navigationErrorHandler=rt(uTe,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Kt(void 0),this.rootComponentType=null;let n=s=>this.events.next(new o$(s)),o=s=>this.events.next(new s$(s));this.configLoader.onLoadEndListener=o,this.configLoader.onLoadStartListener=n}complete(){this.transitions?.complete()}handleNavigationRequest(n){let o=++this.navigationId;this.transitions?.next($e(ie(ie({},this.transitions.value),n),{id:o}))}setupNavigations(n,o,s){return this.transitions=new ss({id:0,currentUrlTree:o,currentRawUrl:o,extractedUrl:this.urlHandlingStrategy.extract(o),urlAfterRedirects:this.urlHandlingStrategy.extract(o),rawUrl:o,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:J0,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(yi(i=>i.id!==0),cr(i=>$e(ie({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),pc(i=>{let a=!1,c=!1;return Kt(i).pipe(pc(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Ji.SupersededByNewNavigation),Xi;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?$e(ie({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let u=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),p=l.extras.onSameUrlNavigation??n.onSameUrlNavigation;if(!u&&p!=="reload"){let d="";return this.events.next(new fg(l.id,this.urlSerializer.serialize(l.rawUrl),d,JP.IgnoredSameUrlNavigation)),l.resolve(!1),Xi}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Kt(l).pipe(pc(d=>{let h=this.transitions?.getValue();return this.events.next(new oC(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),h!==this.transitions?.getValue()?Xi:Promise.resolve(d)}),QIe(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),is(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=$e(ie({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let h=new KT(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(h)}));if(u&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:h,source:f,restoredState:m,extras:g}=l,y=new oC(d,this.urlSerializer.serialize(h),f,m);this.events.next(y);let x=zq(this.rootComponentType).snapshot;return this.currentTransition=i=$e(ie({},l),{targetSnapshot:x,urlAfterRedirects:h,extras:$e(ie({},g),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=h,Kt(i)}else{let d="";return this.events.next(new fg(l.id,this.urlSerializer.serialize(l.extractedUrl),d,JP.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Xi}}),is(l=>{let u=new e$(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(u)}),cr(l=>(this.currentTransition=i=$e(ie({},l),{guards:yIe(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),EIe(this.environmentInjector,l=>this.events.next(l)),is(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw JT(this.urlSerializer,l.guardsResult);let u=new t$(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(u)}),yi(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Ji.GuardRejected),!1)),qP(l=>{if(l.guards.canActivateChecks.length)return Kt(l).pipe(is(u=>{let p=new r$(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(p)}),pc(u=>{let p=!1;return Kt(u).pipe(JIe(this.paramsInheritanceStrategy,this.environmentInjector),is({next:()=>p=!0,complete:()=>{p||this.cancelNavigationTransition(u,"",Ji.NoDataFromResolver)}}))}),is(u=>{let p=new n$(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(p)}))}),qP(l=>{let u=p=>{let d=[];p.routeConfig?.loadComponent&&!p.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(p.routeConfig).pipe(is(h=>{p.component=h}),cr(()=>{})));for(let h of p.children)d.push(...u(h));return d};return BI(u(l.targetSnapshot.root)).pipe(ph(null),ya(1))}),qP(()=>this.afterPreactivation()),pc(()=>{let{currentSnapshot:l,targetSnapshot:u}=i,p=this.createViewTransition?.(this.environmentInjector,l.root,u.root);return p?so(p).pipe(cr(()=>i)):Kt(i)}),cr(l=>{let u=dIe(n.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=$e(ie({},l),{targetRouterState:u}),this.currentNavigation.targetRouterState=u,i}),is(()=>{this.events.next(new iC)}),gIe(this.rootContexts,n.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),ya(1),is({next:l=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new sd(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{a=!0}}),AM(this.transitionAbortSubject.pipe(is(l=>{throw l}))),b0(()=>{!a&&!c&&this.cancelNavigationTransition(i,"",Ji.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),uh(l=>{if(c=!0,Hq(l))this.events.next(new nd(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),mIe(l)?this.events.next(new Px(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let u=new sC(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let p=Yp(this.environmentInjector,()=>this.navigationErrorHandler?.(u));if(p instanceof cC){let{message:d,cancellationCode:h}=JT(this.urlSerializer,p);this.events.next(new nd(i.id,this.urlSerializer.serialize(i.extractedUrl),d,h)),this.events.next(new Px(p.redirectTo,p.navigationBehaviorOptions))}else{this.events.next(u);let d=n.errorHandler(l);i.resolve(!!d)}}catch(p){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(p)}}return Xi}))}))}cancelNavigationTransition(n,o,s){let i=new nd(n.id,this.urlSerializer.serialize(n.extractedUrl),o,s);this.events.next(i),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),o=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return n.toString()!==o?.toString()&&!this.currentNavigation?.extras.skipLocationChange}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function dTe(r){return r!==J0}var hTe=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(fTe),providedIn:"root"});let r=e;return r})(),b$=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},fTe=(()=>{let e=class e extends b${};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=Sx(e)))(s||e)}})(),e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Jq=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:()=>rt(mTe),providedIn:"root"});let r=e;return r})(),mTe=(()=>{let e=class e extends Jq{constructor(){super(...arguments),this.location=rt(W0),this.urlSerializer=rt(w$),this.options=rt(T$,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=rt(N$),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new od,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=zq(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(o=>{o.type==="popstate"&&n(o.url,o.state)})}handleRouterEvent(n,o){if(n instanceof oC)this.stateMemento=this.createStateMemento();else if(n instanceof fg)this.rawUrlTree=o.initialUrl;else if(n instanceof KT){if(this.urlUpdateStrategy==="eager"&&!o.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl);this.setBrowserUrl(o.targetBrowserUrl??s,o)}}else n instanceof iC?(this.currentUrlTree=o.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(o.finalUrl,o.initialUrl),this.routerState=o.targetRouterState,this.urlUpdateStrategy==="deferred"&&!o.extras.skipLocationChange&&this.setBrowserUrl(o.targetBrowserUrl??this.rawUrlTree,o)):n instanceof nd&&(n.code===Ji.GuardRejected||n.code===Ji.NoDataFromResolver)?this.restoreHistory(o):n instanceof sC?this.restoreHistory(o,!0):n instanceof sd&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,o){let s=n instanceof od?this.urlSerializer.serialize(n):n;if(this.location.isCurrentPathEqualTo(s)||o.extras.replaceUrl){let i=this.browserPageId,a=ie(ie({},o.extras.state),this.generateNgRouterState(o.id,i));this.location.replaceState(s,"",a)}else{let i=ie(ie({},o.extras.state),this.generateNgRouterState(o.id,this.browserPageId+1));this.location.go(s,"",i)}}restoreHistory(n,o=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,i=this.currentPageId-s;i!==0?this.location.historyGo(i):this.currentUrlTree===n.finalUrl&&i===0&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(o&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,o){return this.canceledNavigationResolution==="computed"?{navigationId:n,\u0275routerPageId:o}:{navigationId:n}}};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=Sx(e)))(s||e)}})(),e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})(),Z0=function(r){return r[r.COMPLETE=0]="COMPLETE",r[r.FAILED=1]="FAILED",r[r.REDIRECTING=2]="REDIRECTING",r}(Z0||{});function gTe(r,e){r.events.pipe(yi(t=>t instanceof sd||t instanceof nd||t instanceof sC||t instanceof fg),cr(t=>t instanceof sd||t instanceof fg?Z0.COMPLETE:(t instanceof nd?t.code===Ji.Redirect||t.code===Ji.SupersededByNewNavigation:!1)?Z0.REDIRECTING:Z0.FAILED),yi(t=>t!==Z0.REDIRECTING),ya(1)).subscribe(()=>{e()})}function yTe(r){throw r}var xTe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},vTe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},xo=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.console=rt(FT),this.stateManager=rt(Jq),this.options=rt(T$,{optional:!0})||{},this.pendingTasks=rt(Ix),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=rt(pTe),this.urlSerializer=rt(w$),this.location=rt(W0),this.urlHandlingStrategy=rt(N$),this._events=new Yr,this.errorHandler=this.options.errorHandler||yTe,this.navigated=!1,this.routeReuseStrategy=rt(hTe),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=rt(E$,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!rt(S$,{optional:!0}),this.eventsSubscription=new Hn,this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let n=this.navigationTransitions.events.subscribe(o=>{try{let s=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(s!==null&&i!==null){if(this.stateManager.handleRouterEvent(o,i),o instanceof nd&&o.code!==Ji.Redirect&&o.code!==Ji.SupersededByNewNavigation)this.navigated=!0;else if(o instanceof sd)this.navigated=!0;else if(o instanceof Px){let a=o.navigationBehaviorOptions,c=this.urlHandlingStrategy.merge(o.url,s.currentRawUrl),l=ie({browserUrl:s.extras.browserUrl,info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||this.urlUpdateStrategy==="eager"||dTe(s.source)},a);this.scheduleNavigation(c,J0,null,l,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}wTe(o)&&this._events.next(o)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),J0,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,o)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",o)},0)})}navigateToSyncWithBrowser(n,o,s){let i={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let l=ie({},s);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let c=this.parseUrl(n);this.scheduleNavigation(c,o,a,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(k$),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,o={}){let{relativeTo:s,queryParams:i,fragment:a,queryParamsHandling:c,preserveFragment:l}=o,u=l?this.currentUrlTree.fragment:a,p=null;switch(c??this.options.defaultQueryParamsHandling){case"merge":p=ie(ie({},this.currentUrlTree.queryParams),i);break;case"preserve":p=this.currentUrlTree.queryParams;break;default:p=i||null}p!==null&&(p=this.removeEmptyProps(p));let d;try{let h=s?s.snapshot:this.routerState.snapshot.root;d=$q(h)}catch{(typeof n[0]!="string"||n[0][0]!=="/")&&(n=[]),d=this.currentUrlTree.root}return Lq(d,n,p,u??null)}navigateByUrl(n,o={skipLocationChange:!1}){let s=rC(n)?n:this.parseUrl(n),i=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(i,J0,null,o)}navigate(n,o={skipLocationChange:!1}){return bTe(n),this.navigateByUrl(this.createUrlTree(n,o),o)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,o){let s;if(o===!0?s=ie({},xTe):o===!1?s=ie({},vTe):s=o,rC(n))return bq(this.currentUrlTree,n,s);let i=this.parseUrl(n);return bq(this.currentUrlTree,i,s)}removeEmptyProps(n){return Object.entries(n).reduce((o,[s,i])=>(i!=null&&(o[s]=i),o),{})}scheduleNavigation(n,o,s,i,a){if(this.disposed)return Promise.resolve(!1);let c,l,u;a?(c=a.resolve,l=a.reject,u=a.promise):u=new Promise((d,h)=>{c=d,l=h});let p=this.pendingTasks.add();return gTe(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(p))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:i,resolve:c,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(d=>Promise.reject(d))}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=st({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function bTe(r){for(let e=0;e<r.length;e++)if(r[e]==null)throw new gt(4008,!1)}function wTe(r){return!(r instanceof iC)&&!(r instanceof Px)}var CTe=new $t("");function e6(r,...e){return ST([{provide:E$,multi:!0,useValue:r},[],{provide:Cs,useFactory:_Te,deps:[xo]},{provide:NP,multi:!0,useFactory:STe},e.map(t=>t.\u0275providers)])}function _Te(r){return r.routerState.root}function STe(){let r=rt(yh);return e=>{let t=r.get(lg);if(e!==t.components[0])return;let n=r.get(xo),o=r.get(ITe);r.get(TTe)===1&&n.initialNavigation(),r.get(kTe,null,rr.Optional)?.setUpPreloading(),r.get(CTe,null,rr.Optional)?.init(),n.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var ITe=new $t("",{factory:()=>new Yr}),TTe=new $t("",{providedIn:"root",factory:()=>1});var kTe=new $t("");function t6(r){let e="An error occurred.";return r instanceof Error?e=`Error: ${r.message}

Stack Trace:
${r.stack}`:typeof r=="string"?e=`Error: ${r}`:typeof r=="object"&&r.message&&(e=`Error: ${r.message}

Stack Trace:
${r.stack}`),e}var n1="0.0.15";var _i=class r{version=n1;year=new Date().getFullYear();static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-footer"]],standalone:!0,features:[At],decls:4,vars:2,consts:[[1,"footer","footer-center","bg-base-300","text-base-content","p-4"]],template:function(t,n){t&1&&(Se(0,"footer",0)(1,"aside")(2,"p"),Ke(3),Ie()()()),t&2&&(It(3),TP(" Copyright \xA9 ",n.year," - All right reserved by MOVEPLAYGROUND - version ",n.version," "))},styles:[".footer[_ngcontent-%COMP%]{position:fixed;bottom:0;width:100%;padding:1rem}"]})};var r6=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>import("./chunk-NPJLHOA5.js").then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};var fC=class extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}},o1=class extends fC{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},s1=class extends fC{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},i1=class extends fC{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}},D$=function(r){return r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2",r}(D$||{});var ETe=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},mC=class{constructor(e,{headers:t={},customFetch:n,region:o=D$.Any}={}){this.url=e,this.headers=t,this.region=o,this.fetch=r6(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return ETe(this,void 0,void 0,function*(){try{let{headers:o,method:s,body:i}=t,a={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(a["x-region"]=c);let l;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=i):typeof i=="string"?(a["Content-Type"]="text/plain",l=i):typeof FormData<"u"&&i instanceof FormData?l=i:(a["Content-Type"]="application/json",l=JSON.stringify(i)));let u=yield this.fetch(`${this.url}/${e}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:l}).catch(f=>{throw new o1(f)}),p=u.headers.get("x-relay-error");if(p&&p==="true")throw new s1(u);if(!u.ok)throw new i1(u);let d=((n=u.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),h;return d==="application/json"?h=yield u.json():d==="application/octet-stream"?h=yield u.blob():d==="text/event-stream"?h=u:d==="multipart/form-data"?h=yield u.formData():h=yield u.text(),{data:h,error:null}}catch(o){return{data:null,error:o}}})}};var m6=Wp(f6(),1),{PostgrestClient:g6,PostgrestQueryBuilder:gnt,PostgrestFilterBuilder:ynt,PostgrestTransformBuilder:xnt,PostgrestBuilder:vnt}=m6.default;var y6="2.10.2";var x6={"X-Client-Info":`realtime-js/${y6}`},v6="1.0.0",u1=1e4,b6=1e3,Vx=function(r){return r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed",r}(Vx||{}),ea=function(r){return r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving",r}(ea||{}),ka=function(r){return r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token",r}(ka||{}),z$=function(r){return r.websocket="websocket",r}(z$||{}),mg=function(r){return r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed",r}(mg||{});var p1=class{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){let o=t.getUint8(1),s=t.getUint8(2),i=this.HEADER_LENGTH+2,a=n.decode(e.slice(i,i+o));i=i+o;let c=n.decode(e.slice(i,i+s));i=i+s;let l=JSON.parse(n.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:c,payload:l}}};var Bx=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var An=function(r){return r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange",r}(An||{}),G$=(r,e,t={})=>{var n;let o=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((s,i)=>(s[i]=BTe(i,r,e,o),s),{})},BTe=(r,e,t,n)=>{let o=e.find(a=>a.name===r),s=o?.type,i=t[r];return s&&!n.includes(s)?w6(s,i):U$(i)},w6=(r,e)=>{if(r.charAt(0)==="_"){let t=r.slice(1,r.length);return WTe(e,t)}switch(r){case An.bool:return zTe(e);case An.float4:case An.float8:case An.int2:case An.int4:case An.int8:case An.numeric:case An.oid:return UTe(e);case An.json:case An.jsonb:return GTe(e);case An.timestamp:return jTe(e);case An.abstime:case An.date:case An.daterange:case An.int4range:case An.int8range:case An.money:case An.reltime:case An.text:case An.time:case An.timestamptz:case An.timetz:case An.tsrange:case An.tstzrange:return U$(e);default:return U$(e)}},U$=r=>r,zTe=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},UTe=r=>{if(typeof r=="string"){let e=parseFloat(r);if(!Number.isNaN(e))return e}return r},GTe=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},WTe=(r,e)=>{if(typeof r!="string")return r;let t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let s,i=r.slice(1,t);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>w6(e,a))}return r},jTe=r=>typeof r=="string"?r.replace(" ","T"):r,d1=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};var zx=class{constructor(e,t,n={},o=u1){this.channel=e,this.event=t,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var _C=class r{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{let{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=r.syncState(this.state,o,s,i),this.pendingDiffs.forEach(c=>{this.state=r.syncDiff(this.state,c,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},o=>{let{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=r.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,o){let s=this.cloneDeep(e),i=this.transformState(t),a={},c={};return this.map(s,(l,u)=>{i[l]||(c[l]=u)}),this.map(i,(l,u)=>{let p=s[l];if(p){let d=u.map(g=>g.presence_ref),h=p.map(g=>g.presence_ref),f=u.filter(g=>h.indexOf(g.presence_ref)<0),m=p.filter(g=>d.indexOf(g.presence_ref)<0);f.length>0&&(a[l]=f),m.length>0&&(c[l]=m)}else a[l]=u}),this.syncDiff(s,{joins:a,leaves:c},n,o)}static syncDiff(e,t,n,o){let{joins:s,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(s,(a,c)=>{var l;let u=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(c),u.length>0){let p=e[a].map(h=>h.presence_ref),d=u.filter(h=>p.indexOf(h.presence_ref)<0);e[a].unshift(...d)}n(a,u,c)}),this.map(i,(a,c)=>{let l=e[a];if(!l)return;let u=c.map(p=>p.presence_ref);l=l.filter(p=>u.indexOf(p.presence_ref)<0),e[a]=l,o(a,l,c),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{let o=e[n];return"metas"in o?t[n]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[n]=o,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var SC=class r{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=ea.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new zx(this,ka.join,this.params,this.timeout),this.rejoinTimer=new Bx(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ea.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ea.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=ea.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ea.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ka.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new _C(this),this.broadcastEndpointURL=d1(this.socket.endPoint)+"/api/broadcast"}subscribe(e,t=this.timeout){var n,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:s,presence:i,private:a}}=this.params;this._onError(u=>e&&e("CHANNEL_ERROR",u)),this._onClose(()=>e&&e("CLOSED"));let c={},l={broadcast:s,presence:i,postgres_changes:(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessToken&&(c.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:u})=>{var p;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){e&&e("SUBSCRIBED");return}else{let d=this.bindings.postgres_changes,h=(p=d?.length)!==null&&p!==void 0?p:0,f=[];for(let m=0;m<h;m++){let g=d[m],{filter:{event:y,schema:x,table:b,filter:w}}=g,_=u&&u[m];if(_&&_.event===y&&_.schema===x&&_.table===b&&_.filter===w)f.push(Object.assign(Object.assign({},g),{id:_.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,e&&e("SUBSCRIBED");return}}).receive("error",u=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(n){return M(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return M(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,n){return this._on(e,t,n)}send(n){return M(this,arguments,function*(e,t={}){var o,s;if(!this._canPush()&&e.type==="broadcast"){let{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a}]})};try{let l=yield this._fetchWithTimeout(this.broadcastEndpointURL,c,(o=t.timeout)!==null&&o!==void 0?o:this.timeout);return yield(s=l.body)===null||s===void 0?void 0:s.cancel(),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,c,l;let u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(c=(a=this.params)===null||a===void 0?void 0:a.config)===null||c===void 0?void 0:c.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ea.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ka.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(n=>{let o=new zx(this,ka.leave,{},e);o.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}_fetchWithTimeout(e,t,n){return M(this,null,function*(){let o=new AbortController,s=setTimeout(()=>o.abort(),n),i=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:o.signal}));return clearTimeout(s),i})}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new zx(this,e,t,n);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var o,s;let i=e.toLocaleLowerCase(),{close:a,error:c,leave:l,join:u}=ka;if(n&&[a,c,l,u].indexOf(i)>=0&&n!==this._joinRef())return;let d=this._onMessage(i,t,n);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(h=>{var f,m,g;return((f=h.filter)===null||f===void 0?void 0:f.event)==="*"||((g=(m=h.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===i}).map(h=>h.callback(d,n)):(s=this.bindings[i])===null||s===void 0||s.filter(h=>{var f,m,g,y,x,b;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in h){let w=h.id,_=(f=h.filter)===null||f===void 0?void 0:f.event;return w&&((m=t.ids)===null||m===void 0?void 0:m.includes(w))&&(_==="*"||_?.toLocaleLowerCase()===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let w=(x=(y=h?.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return w==="*"||w===((b=t?.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===i}).map(h=>{if(typeof d=="object"&&"ids"in d){let f=d.data,{schema:m,table:g,commit_timestamp:y,type:x,errors:b}=f;d=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:x,new:{},old:{},errors:b}),this._getPayloadRecords(f))}h.callback(d,n)})}_isClosed(){return this.state===ea.closed}_isJoined(){return this.state===ea.joined}_isJoining(){return this.state===ea.joining}_isLeaving(){return this.state===ea.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){let o=e.toLocaleLowerCase(),s={type:o,filter:t,callback:n};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,t){let n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&r.isEqual(o.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ka.close,{},e)}_onError(e){this._on(ka.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ea.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=G$(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=G$(e.columns,e.old_record)),t}};var qTe=()=>{},KTe=typeof WebSocket<"u",IC=class{constructor(e,t){var n;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=x6,this.params={},this.timeout=u1,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=qTe,this.conn=null,this.sendBuffer=[],this.serializer=new p1,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>import("./chunk-NPJLHOA5.js").then(({default:c})=>c(...a)):i=fetch,(...a)=>i(...a)},this.endPoint=`${e}/${z$.websocket}`,this.httpEndpoint=d1(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);let o=(n=t?.params)===null||n===void 0?void 0:n.apikey;o&&(this.accessToken=o,this.apiKey=o),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:s=>[1e3,2e3,5e3,1e4][s-1]||1e4,this.encode=t?.encode?t.encode:(s,i)=>i(JSON.stringify(s)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Bx(()=>M(this,null,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(KTe){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new W$(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-UHLMCCUZ.js").then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return M(this,null,function*(){let t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return M(this,null,function*(){let e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Vx.connecting:return mg.Connecting;case Vx.open:return mg.Open;case Vx.closing:return mg.Closing;default:return mg.Closed}}isConnected(){return this.connectionState()===mg.Open}channel(e,t={config:{}}){let n=new SC(`realtime:${e}`,t,this);return this.channels.push(n),n}push(e){let{topic:t,event:n,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};this.log("push",`${t} ${n} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(ka.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:v6}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:n,event:o,payload:s,ref:i}=t;(i&&i===this.pendingHeartbeatRef||o===s?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${n} ${o} ${i&&"("+i+")"||""}`,s),this.channels.filter(a=>a._isMember(n)).forEach(a=>a._trigger(o,s,i)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ka.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;let n=e.match(/\?/)?"&":"?",o=new URLSearchParams(t);return`${e}${n}${o}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(b6,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}};var W$=class{constructor(e,t,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Vx.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}};var Ux=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function vo(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var h1=class extends Ux{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}},gg=class extends Ux{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};var XTe=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},m1=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>import("./chunk-NPJLHOA5.js").then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},C6=()=>XTe(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-NPJLHOA5.js")).Response:Response}),f1=r=>{if(Array.isArray(r))return r.map(t=>f1(t));if(typeof r=="function"||r!==Object(r))return r;let e={};return Object.entries(r).forEach(([t,n])=>{let o=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=f1(n)}),e};var yg=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},j$=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),YTe=(r,e,t)=>yg(void 0,void 0,void 0,function*(){let n=yield C6();r instanceof n&&!t?.noResolveJson?r.json().then(o=>{e(new h1(j$(o),r.status||500))}).catch(o=>{e(new gg(j$(o),o))}):e(new gg(j$(r),r))}),ZTe=(r,e,t,n)=>{let o={method:r,headers:e?.headers||{}};return r==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(o.body=JSON.stringify(n)),Object.assign(Object.assign({},o),t))};function TC(r,e,t,n,o,s){return yg(this,void 0,void 0,function*(){return new Promise((i,a)=>{r(t,ZTe(e,n,o,s)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>YTe(c,a,n))})})}function Gx(r,e,t,n){return yg(this,void 0,void 0,function*(){return TC(r,"GET",e,t,n)})}function lu(r,e,t,n,o){return yg(this,void 0,void 0,function*(){return TC(r,"POST",e,n,o,t)})}function _6(r,e,t,n,o){return yg(this,void 0,void 0,function*(){return TC(r,"PUT",e,n,o,t)})}function S6(r,e,t,n){return yg(this,void 0,void 0,function*(){return TC(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function g1(r,e,t,n,o){return yg(this,void 0,void 0,function*(){return TC(r,"DELETE",e,n,o,t)})}var Si=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},QTe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},I6={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},y1=class{constructor(e,t={},n,o){this.url=e,this.headers=t,this.bucketId=n,this.fetch=m1(o)}uploadOrUpdate(e,t,n,o){return Si(this,void 0,void 0,function*(){try{let s,i=Object.assign(Object.assign({},I6),o),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)}),c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),s.append("",n),c&&s.append("metadata",this.encodeMetadata(c))):typeof FormData<"u"&&n instanceof FormData?(s=n,s.append("cacheControl",i.cacheControl),c&&s.append("metadata",this.encodeMetadata(c))):(s=n,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,c&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let l=this._removeEmptyFolders(t),u=this._getFinalPath(l),p=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:s,headers:a},i?.duplex?{duplex:i.duplex}:{})),d=yield p.json();return p.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(s){if(vo(s))return{data:null,error:s};throw s}})}upload(e,t,n){return Si(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,o){return Si(this,void 0,void 0,function*(){let s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let c,l=Object.assign({upsert:I6.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",l.cacheControl)):(c=n,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);let p=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:u}),d=yield p.json();return p.ok?{data:{path:s,fullPath:d.Key},error:null}:{data:null,error:d}}catch(c){if(vo(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return Si(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=Object.assign({},this.headers);t?.upsert&&(o["x-upsert"]="true");let s=yield lu(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Ux("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(n){if(vo(n))return{data:null,error:n};throw n}})}update(e,t,n){return Si(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return Si(this,void 0,void 0,function*(){try{return{data:yield lu(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(vo(o))return{data:null,error:o};throw o}})}copy(e,t,n){return Si(this,void 0,void 0,function*(){try{return{data:{path:(yield lu(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(vo(o))return{data:null,error:o};throw o}})}createSignedUrl(e,t,n){return Si(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield lu(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(vo(o))return{data:null,error:o};throw o}})}createSignedUrls(e,t,n){return Si(this,void 0,void 0,function*(){try{let o=yield lu(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),s=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(vo(o))return{data:null,error:o};throw o}})}download(e,t){return Si(this,void 0,void 0,function*(){let o=typeof t?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(t?.transform||{}),i=s?`?${s}`:"";try{let a=this._getFinalPath(e);return{data:yield(yield Gx(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(vo(a))return{data:null,error:a};throw a}})}info(e){return Si(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let n=yield Gx(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:f1(n),error:null}}catch(n){if(vo(n))return{data:null,error:n};throw n}})}exists(e){return Si(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield S6(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(vo(n)&&n instanceof gg){let o=n.originalError;if([400,404].includes(o?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){let n=this._getFinalPath(e),o=[],s=t?.download?`download=${t.download===!0?"":t.download}`:"";s!==""&&o.push(s);let a=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&o.push(c);let l=o.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${l}`)}}}remove(e){return Si(this,void 0,void 0,function*(){try{return{data:yield g1(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(vo(t))return{data:null,error:t};throw t}})}list(e,t,n){return Si(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},QTe),t),{prefix:e||""});return{data:yield lu(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(vo(o))return{data:null,error:o};throw o}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};var T6="2.7.0";var k6={"X-Client-Info":`storage-js/${T6}`};var Wx=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},x1=class{constructor(e,t={},n){this.url=e,this.headers=Object.assign(Object.assign({},k6),t),this.fetch=m1(n)}listBuckets(){return Wx(this,void 0,void 0,function*(){try{return{data:yield Gx(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(vo(e))return{data:null,error:e};throw e}})}getBucket(e){return Wx(this,void 0,void 0,function*(){try{return{data:yield Gx(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(vo(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Wx(this,void 0,void 0,function*(){try{return{data:yield lu(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(vo(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return Wx(this,void 0,void 0,function*(){try{return{data:yield _6(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(vo(n))return{data:null,error:n};throw n}})}emptyBucket(e){return Wx(this,void 0,void 0,function*(){try{return{data:yield lu(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(vo(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Wx(this,void 0,void 0,function*(){try{return{data:yield g1(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(vo(t))return{data:null,error:t};throw t}})}};var kC=class extends x1{constructor(e,t={},n){super(e,t,n)}from(e){return new y1(this.url,this.headers,e,this.fetch)}};var E6="2.45.3";var EC="";typeof Deno<"u"?EC="deno":typeof document<"u"?EC="web":typeof navigator<"u"&&navigator.product==="ReactNative"?EC="react-native":EC="node";var JTe={"X-Client-Info":`supabase-js-${EC}/${E6}`},N6={headers:JTe},D6={schema:"public"},A6={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},R6={};qG();var e1e=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},t1e=r=>{let e;return r?e=r:typeof fetch>"u"?e=jG:e=fetch,(...t)=>e(...t)},r1e=()=>typeof Headers>"u"?HG:Headers,O6=(r,e,t)=>{let n=t1e(t),o=r1e();return(s,i)=>e1e(void 0,void 0,void 0,function*(){var a;let c=(a=yield e())!==null&&a!==void 0?a:r,l=new o(i?.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),n(s,Object.assign(Object.assign({},i),{headers:l}))})};var n1e=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})};function M6(r){return r.replace(/\/$/,"")}function F6(r,e){let{db:t,auth:n,realtime:o,global:s}=r,{db:i,auth:a,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},i),t),auth:Object.assign(Object.assign({},a),n),realtime:Object.assign(Object.assign({},c),o),global:Object.assign(Object.assign({},l),s),accessToken:()=>n1e(this,void 0,void 0,function*(){return""})};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}function P6(r){return Math.round(Date.now()/1e3)+r}function $6(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}var vc=()=>typeof document<"u",xg={tested:!1,writable:!1},Eh=()=>{if(!vc())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(xg.tested)return xg.writable;let r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),xg.tested=!0,xg.writable=!0}catch{xg.tested=!0,xg.writable=!1}return xg.writable};function v1(r){let e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return t.searchParams.forEach((n,o)=>{e[o]=n}),e}var b1=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>import("./chunk-NPJLHOA5.js").then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},L6=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Nh=(r,e,t)=>M(void 0,null,function*(){yield r.setItem(e,JSON.stringify(t))}),DC=(r,e)=>M(void 0,null,function*(){let t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),w1=(r,e)=>M(void 0,null,function*(){yield r.removeItem(e)});function o1e(r){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",n,o,s,i,a,c,l,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)i=e.indexOf(r.charAt(u++)),a=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),n=i<<2|a>>4,o=(a&15)<<4|c>>2,s=(c&3)<<6|l,t=t+String.fromCharCode(n),c!=64&&o!=0&&(t=t+String.fromCharCode(o)),l!=64&&s!=0&&(t=t+String.fromCharCode(s));return t}var NC=class r{constructor(){this.promise=new r.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}};NC.promiseConstructor=Promise;function H$(r){let e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");let n=t[1];return JSON.parse(o1e(n))}function V6(r){return M(this,null,function*(){return yield new Promise(e=>{setTimeout(()=>e(null),r)})})}function B6(r,e){return new Promise((n,o)=>{M(this,null,function*(){for(let s=0;s<1/0;s++)try{let i=yield r(s);if(!e(s,null,i)){n(i);return}}catch(i){if(!e(s,i)){o(i);return}}})})}function s1e(r){return("0"+r.toString(16)).substr(-2)}function vg(){let e=new Uint32Array(56);if(typeof crypto>"u"){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length,o="";for(let s=0;s<56;s++)o+=t.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(e),Array.from(e,s1e).join("")}function i1e(r){return M(this,null,function*(){let t=new TextEncoder().encode(r),n=yield crypto.subtle.digest("SHA-256",t),o=new Uint8Array(n);return Array.from(o).map(s=>String.fromCharCode(s)).join("")})}function a1e(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function bg(r){return M(this,null,function*(){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;let t=yield i1e(r);return a1e(t)})}var AC=class extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}};function nr(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}var C1=class extends AC{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}};function z6(r){return nr(r)&&r.name==="AuthApiError"}var jx=class extends AC{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}},id=class extends AC{constructor(e,t,n){super(e),this.name=t,this.status=n}toJSON(){return{name:this.name,message:this.message,status:this.status}}},ad=class extends id{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}},Hx=class extends id{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}},wg=class extends id{constructor(e){super(e,"AuthInvalidCredentialsError",400)}},Cg=class extends id{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},RC=class extends id{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},qx=class extends id{constructor(e,t){super(e,"AuthRetryableFetchError",t)}};function S1(r){return nr(r)&&r.name==="AuthRetryableFetchError"}var _1=class extends id{constructor(e,t,n){super(e,"AuthWeakPasswordError",t),this.reasons=n}};var c1e=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},Kx=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),l1e=[502,503,504];function U6(r){return M(this,null,function*(){if(!L6(r))throw new qx(Kx(r),0);if(l1e.includes(r.status))throw new qx(Kx(r),r.status);let e;try{e=yield r.json()}catch(t){throw new jx(Kx(t),t)}throw typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)?new _1(Kx(e),r.status,e.weak_password.reasons):new C1(Kx(e),r.status||500)})}var u1e=(r,e,t,n)=>{let o={method:r,headers:e?.headers||{}};return r==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),t))};function gr(r,e,t,n){return M(this,null,function*(){var o;let s=Object.assign({},n?.headers);n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);let i=(o=n?.query)!==null&&o!==void 0?o:{};n?.redirectTo&&(i.redirect_to=n.redirectTo);let a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=yield p1e(r,e,t+a,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}})}function p1e(r,e,t,n,o,s){return M(this,null,function*(){let i=u1e(e,n,o,s),a;try{a=yield r(t,i)}catch(c){throw console.error(c),new qx(Kx(c),0)}if(a.ok||(yield U6(a)),n?.noResolveJson)return a;try{return yield a.json()}catch(c){yield U6(c)}})}function Dh(r){var e;let t=null;d1e(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=P6(r.expires_in)));let n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function q$(r){let e=Dh(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function uu(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function G6(r){return{data:r,error:null}}function W6(r){let{action_link:e,email_otp:t,hashed_token:n,redirect_to:o,verification_type:s}=r,i=c1e(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:o,verification_type:s},c=Object.assign({},i);return{data:{properties:a,user:c},error:null}}function j6(r){return r}function d1e(r){return r.access_token&&r.refresh_token&&r.expires_in}var h1e=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t},Xx=class{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=b1(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return M(this,null,function*(){try{return yield gr(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(nr(n))return{data:null,error:n};throw n}})}inviteUserByEmail(n){return M(this,arguments,function*(e,t={}){try{return yield gr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:uu})}catch(o){if(nr(o))return{data:{user:null},error:o};throw o}})}generateLink(e){return M(this,null,function*(){try{let{options:t}=e,n=h1e(e,["options"]),o=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(o.new_email=n?.newEmail,delete o.newEmail),yield gr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:W6,redirectTo:t?.redirectTo})}catch(t){if(nr(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return M(this,null,function*(){try{return yield gr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:uu})}catch(t){if(nr(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return M(this,null,function*(){var t,n,o,s,i,a,c;try{let l={nextPage:null,lastPage:0,total:0},u=yield gr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:j6});if(u.error)throw u.error;let p=yield u.json(),d=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,h=(c=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return h.length>0&&(h.forEach(f=>{let m=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(f.split(";")[1].split("=")[1]);l[`${g}Page`]=m}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},p),l),error:null}}catch(l){if(nr(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return M(this,null,function*(){try{return yield gr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:uu})}catch(t){if(nr(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return M(this,null,function*(){try{return yield gr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:uu})}catch(n){if(nr(n))return{data:{user:null},error:n};throw n}})}deleteUser(e,t=!1){return M(this,null,function*(){try{return yield gr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:uu})}catch(n){if(nr(n))return{data:{user:null},error:n};throw n}})}_listFactors(e){return M(this,null,function*(){try{let{data:t,error:n}=yield gr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:t,error:n}}catch(t){if(nr(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return M(this,null,function*(){try{return{data:yield gr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(nr(t))return{data:null,error:t};throw t}})}};var I1="2.61.0";var H6="http://localhost:9999",q6="supabase.auth.token";var K6={"X-Client-Info":`gotrue-js/${I1}`},K$=10;var X6={getItem:r=>Eh()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{Eh()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{Eh()&&globalThis.localStorage.removeItem(r)}};function X$(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Y6(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var f1e={debug:!!(globalThis&&Eh()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},T1=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}};Y6();var m1e={url:H6,storageKey:q6,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:K6,flowType:"implicit",debug:!1},OC=30*1e3,Z6=3;function g1e(r,e,t){return M(this,null,function*(){return yield t()})}var Y$=(()=>{class r{constructor(t){var n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=r.nextInstanceID,r.nextInstanceID+=1,this.instanceID>0&&vc()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let o=Object.assign(Object.assign({},m1e),t);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Xx({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=b1(o.fetch),this.lock=o.lock||g1e,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:Eh()?this.storage=X6:(this.memoryStorage={},this.storage=X$(this.memoryStorage)):(this.memoryStorage={},this.storage=X$(this.memoryStorage)),vc()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",s=>M(this,null,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${I1}) ${new Date().toISOString()}`,...t),this}initialize(){return M(this,null,function*(){return this.initializePromise?yield this.initializePromise:(this.initializePromise=M(this,null,function*(){return yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._initialize()}))}),yield this.initializePromise)})}_initialize(){return M(this,null,function*(){try{let t=vc()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",t),t||this.detectSessionInUrl&&this._isImplicitGrantFlow()){let{data:n,error:o}=yield this._getSessionFromURL(t);if(o)return this._debug("#_initialize()","error detecting session from URL",o),o?.message==="Identity is already linked"||o?.message==="Identity is already linked to another user"?{error:o}:(yield this._removeSession(),{error:o});let{session:s,redirectType:i}=n;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),yield this._saveSession(s),setTimeout(()=>M(this,null,function*(){i==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return nr(t)?{error:t}:{error:new jx("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(t){return M(this,null,function*(){var n,o,s;try{yield this._removeSession();let i;if("email"in t){let{email:p,password:d,options:h}=t,f=null,m=null;if(this.flowType==="pkce"){let g=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,g),f=yield bg(g),m=g===f?"plain":"s256"}i=yield gr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:p,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:m},xform:Dh})}else if("phone"in t){let{phone:p,password:d,options:h}=t;i=yield gr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:d,data:(o=h?.data)!==null&&o!==void 0?o:{},channel:(s=h?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:Dh})}else throw new wg("You must provide either an email or phone number and a password");let{data:a,error:c}=i;if(c||!a)return{data:{user:null,session:null},error:c};let l=a.session,u=a.user;return a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(nr(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(t){return M(this,null,function*(){try{yield this._removeSession();let n;if("email"in t){let{email:i,password:a,options:c}=t;n=yield gr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:q$})}else if("phone"in t){let{phone:i,password:a,options:c}=t;n=yield gr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:q$})}else throw new wg("You must provide either an email or phone number and a password");let{data:o,error:s}=n;return s?{data:{user:null,session:null},error:s}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new Hx}:(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:s})}catch(n){if(nr(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithOAuth(t){return M(this,null,function*(){var n,o,s,i;return yield this._removeSession(),yield this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(t){return M(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>M(this,null,function*(){return this._exchangeCodeForSession(t)}))})}_exchangeCodeForSession(t){return M(this,null,function*(){let n=yield DC(this.storage,`${this.storageKey}-code-verifier`),[o,s]=(n??"").split("/"),{data:i,error:a}=yield gr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:o},xform:Dh});return yield w1(this.storage,`${this.storageKey}-code-verifier`),a?{data:{user:null,session:null,redirectType:null},error:a}:!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Hx}:(i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})})}signInWithIdToken(t){return M(this,null,function*(){yield this._removeSession();try{let{options:n,provider:o,token:s,access_token:i,nonce:a}=t,c=yield gr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:Dh}),{data:l,error:u}=c;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Hx}:(l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(n){if(nr(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithOtp(t){return M(this,null,function*(){var n,o,s,i,a;try{if(yield this._removeSession(),"email"in t){let{email:c,options:l}=t,u=null,p=null;if(this.flowType==="pkce"){let h=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,h),u=yield bg(h),p=h===u?"plain":"s256"}let{error:d}=yield gr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(o=l?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:u,code_challenge_method:p},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in t){let{phone:c,options:l}=t,{data:u,error:p}=yield gr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:p}}throw new wg("You must provide either an email or phone number.")}catch(c){if(nr(c))return{data:{user:null,session:null},error:c};throw c}})}verifyOtp(t){return M(this,null,function*(){var n,o;try{t.type!=="email_change"&&t.type!=="phone_change"&&(yield this._removeSession());let s,i;"options"in t&&(s=(n=t.options)===null||n===void 0?void 0:n.redirectTo,i=(o=t.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:c}=yield gr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Dh});if(c)throw c;if(!a)throw new Error("An error occurred on token verification.");let l=a.session,u=a.user;return l?.access_token&&(yield this._saveSession(l),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(s){if(nr(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(t){return M(this,null,function*(){var n,o,s;try{yield this._removeSession();let i=null,a=null;if(this.flowType==="pkce"){let c=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,c),i=yield bg(c),a=c===i?"plain":"s256"}return yield gr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(o=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&o!==void 0?o:void 0}),!((s=t?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:G6})}catch(i){if(nr(i))return{data:null,error:i};throw i}})}reauthenticate(){return M(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return M(this,null,function*(){try{return yield this._useSession(t=>M(this,null,function*(){let{data:{session:n},error:o}=t;if(o)throw o;if(!n)throw new ad;let{error:s}=yield gr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:s}}))}catch(t){if(nr(t))return{data:{user:null,session:null},error:t};throw t}})}resend(t){return M(this,null,function*(){try{t.type!="email_change"&&t.type!="phone_change"&&(yield this._removeSession());let n=`${this.url}/resend`;if("email"in t){let{email:o,type:s,options:i}=t,{error:a}=yield gr(this.fetch,"POST",n,{headers:this.headers,body:{email:o,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in t){let{phone:o,type:s,options:i}=t,{data:a,error:c}=yield gr(this.fetch,"POST",n,{headers:this.headers,body:{phone:o,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:c}}throw new wg("You must provide either an email or phone number and a type")}catch(n){if(nr(n))return{data:{user:null,session:null},error:n};throw n}})}getSession(){return M(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>M(this,null,function*(){return this._useSession(t=>M(this,null,function*(){return t}))}))})}_acquireLock(t,n){return M(this,null,function*(){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=M(this,null,function*(){return yield o,yield n()});return this.pendingInLock.push(M(this,null,function*(){try{yield s}catch{}})),s}return yield this.lock(`lock:${this.storageKey}`,t,()=>M(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=n();for(this.pendingInLock.push(M(this,null,function*(){try{yield o}catch{}})),yield o;this.pendingInLock.length;){let s=[...this.pendingInLock];yield Promise.all(s),this.pendingInLock.splice(0,s.length)}return yield o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(t){return M(this,null,function*(){this._debug("#_useSession","begin");try{let n=yield this.__loadSession();return yield t(n)}finally{this._debug("#_useSession","end")}})}__loadSession(){return M(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null,n=yield DC(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!t)return{data:{session:null},error:null};let o=t.expires_at?t.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",t.expires_at),!o)return{data:{session:t},error:null};let{session:s,error:i}=yield this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(t){return M(this,null,function*(){return t?yield this._getUser(t):(yield this.initializePromise,this._acquireLock(-1,()=>M(this,null,function*(){return yield this._getUser()})))})}_getUser(t){return M(this,null,function*(){try{return t?yield gr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:uu}):yield this._useSession(n=>M(this,null,function*(){var o,s;let{data:i,error:a}=n;if(a)throw a;return yield gr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:uu})}))}catch(n){if(nr(n))return{data:{user:null},error:n};throw n}})}updateUser(o){return M(this,arguments,function*(t,n={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._updateUser(t,n)}))})}_updateUser(o){return M(this,arguments,function*(t,n={}){try{return yield this._useSession(s=>M(this,null,function*(){let{data:i,error:a}=s;if(a)throw a;if(!i.session)throw new ad;let c=i.session,l=null,u=null;if(this.flowType==="pkce"&&t.email!=null){let h=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,h),l=yield bg(h),u=h===l?"plain":"s256"}let{data:p,error:d}=yield gr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:u}),jwt:c.access_token,xform:uu});if(d)throw d;return c.user=p.user,yield this._saveSession(c),yield this._notifyAllSubscribers("USER_UPDATED",c),{data:{user:c.user},error:null}}))}catch(s){if(nr(s))return{data:{user:null},error:s};throw s}})}_decodeJWT(t){return H$(t)}setSession(t){return M(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._setSession(t)}))})}_setSession(t){return M(this,null,function*(){try{if(!t.access_token||!t.refresh_token)throw new ad;let n=Date.now()/1e3,o=n,s=!0,i=null,a=H$(t.access_token);if(a.exp&&(o=a.exp,s=o<=n),s){let{session:c,error:l}=yield this._callRefreshToken(t.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!c)return{data:{user:null,session:null},error:null};i=c}else{let{data:c,error:l}=yield this._getUser(t.access_token);if(l)throw l;i={access_token:t.access_token,refresh_token:t.refresh_token,user:c.user,token_type:"bearer",expires_in:o-n,expires_at:o},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(n){if(nr(n))return{data:{session:null,user:null},error:n};throw n}})}refreshSession(t){return M(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._refreshSession(t)}))})}_refreshSession(t){return M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o;if(!t){let{data:a,error:c}=n;if(c)throw c;t=(o=a.session)!==null&&o!==void 0?o:void 0}if(!t?.refresh_token)throw new ad;let{session:s,error:i}=yield this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(n){if(nr(n))return{data:{user:null,session:null},error:n};throw n}})}_getSessionFromURL(t){return M(this,null,function*(){try{if(!vc())throw new Cg("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Cg("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!t)throw new RC("Not a valid PKCE flow url.");let n=v1(window.location.href);if(t){if(!n.code)throw new RC("No code detected.");let{data:b,error:w}=yield this._exchangeCodeForSession(n.code);if(w)throw w;let _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:b.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new Cg(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});let{provider_token:o,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:c,expires_at:l,token_type:u}=n;if(!i||!c||!a||!u)throw new Cg("No session defined in URL");let p=Math.round(Date.now()/1e3),d=parseInt(c),h=p+d;l&&(h=parseInt(l));let f=h-p;f*1e3<=OC&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);let m=h-d;p-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,p):p-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",m,h,p);let{data:g,error:y}=yield this._getUser(i);if(y)throw y;let x={provider_token:o,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:h,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:n.type},error:null}}catch(n){if(nr(n))return{data:{session:null,redirectType:null},error:n};throw n}})}_isImplicitGrantFlow(){let t=v1(window.location.href);return!!(vc()&&(t.access_token||t.error_description))}_isPKCEFlow(){return M(this,null,function*(){let t=v1(window.location.href),n=yield DC(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&n)})}signOut(){return M(this,arguments,function*(t={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){return yield this._signOut(t)}))})}_signOut(){return M(this,arguments,function*({scope:t}={scope:"global"}){return yield this._useSession(n=>M(this,null,function*(){var o;let{data:s,error:i}=n;if(i)return{error:i};let a=(o=s.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:c}=yield this.admin.signOut(a,t);if(c&&!(z6(c)&&(c.status===404||c.status===401)))return{error:c}}return t!=="others"&&(yield this._removeSession(),yield w1(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}}))})}onAuthStateChange(t){let n=$6(),o={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,o),M(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){this._emitInitialSession(n)}))}),{data:{subscription:o}}}_emitInitialSession(t){return M(this,null,function*(){return yield this._useSession(n=>M(this,null,function*(){var o,s;try{let{data:{session:i},error:a}=n;if(a)throw a;yield(o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",i),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){yield(s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}}))})}resetPasswordForEmail(o){return M(this,arguments,function*(t,n={}){let s=null,i=null;if(this.flowType==="pkce"){let a=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,`${a}/PASSWORD_RECOVERY`),s=yield bg(a),i=a===s?"plain":"s256"}try{return yield gr(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(a){if(nr(a))return{data:null,error:a};throw a}})}getUserIdentities(){return M(this,null,function*(){var t;try{let{data:n,error:o}=yield this.getUser();if(o)throw o;return{data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(n){if(nr(n))return{data:null,error:n};throw n}})}linkIdentity(t){return M(this,null,function*(){var n;try{let{data:o,error:s}=yield this._useSession(i=>M(this,null,function*(){var a,c,l,u,p;let{data:d,error:h}=i;if(h)throw h;let f=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(c=t.options)===null||c===void 0?void 0:c.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return yield gr(this.fetch,"GET",f,{headers:this.headers,jwt:(p=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&p!==void 0?p:void 0})}));if(s)throw s;return vc()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:t.provider,url:o?.url},error:null}}catch(o){if(nr(o))return{data:{provider:t.provider,url:null},error:o};throw o}})}unlinkIdentity(t){return M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o,s;let{data:i,error:a}=n;if(a)throw a;return yield gr(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0})}))}catch(n){if(nr(n))return{data:null,error:n};throw n}})}_refreshAccessToken(t){return M(this,null,function*(){let n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{let o=Date.now();return yield B6(s=>M(this,null,function*(){return yield V6(s*200),this._debug(n,"refreshing attempt",s),yield gr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Dh})}),(s,i,a)=>a&&a.error&&S1(a.error)&&Date.now()+(s+1)*200-o<OC)}catch(o){if(this._debug(n,"error",o),nr(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(n,"end")}})}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}_handleProviderSignIn(t,n){return M(this,null,function*(){let o=yield this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",o),vc()&&!n.skipBrowserRedirect&&window.location.assign(o),{data:{provider:t,url:o},error:null}})}_recoverAndRefresh(){return M(this,null,function*(){var t;let n="#_recoverAndRefresh()";this._debug(n,"begin");try{let o=yield DC(this.storage,this.storageKey);if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&(yield this._removeSession());return}let s=Math.round(Date.now()/1e3),i=((t=o.expires_at)!==null&&t!==void 0?t:1/0)<s+K$;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${K$}s`),i){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=yield this._callRefreshToken(o.refresh_token);a&&(console.error(a),S1(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}})}_callRefreshToken(t){return M(this,null,function*(){var n,o;if(!t)throw new ad;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new NC;let{data:i,error:a}=yield this._refreshAccessToken(t);if(a)throw a;if(!i.session)throw new ad;yield this._saveSession(i.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);let c={session:i.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(i){if(this._debug(s,"error",i),nr(i)){let a={session:null,error:i};return S1(i)||(yield this._removeSession(),yield this._notifyAllSubscribers("SIGNED_OUT",null)),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}})}_notifyAllSubscribers(t,n,o=!0){return M(this,null,function*(){let s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",n,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:t,session:n});let i=[],a=Array.from(this.stateChangeEmitters.values()).map(c=>M(this,null,function*(){try{yield c.callback(t,n)}catch(l){i.push(l)}}));if(yield Promise.all(a),i.length>0){for(let c=0;c<i.length;c+=1)console.error(i[c]);throw i[0]}}finally{this._debug(s,"end")}})}_saveSession(t){return M(this,null,function*(){this._debug("#_saveSession()",t),yield Nh(this.storage,this.storageKey,t)})}_removeSession(){return M(this,null,function*(){this._debug("#_removeSession()"),yield w1(this.storage,this.storageKey)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&vc()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(n){console.error("removing visibilitychange callback failed",n)}}_startAutoRefresh(){return M(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let t=setInterval(()=>this._autoRefreshTokenTick(),OC);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(()=>M(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return M(this,null,function*(){this._debug("#_stopAutoRefresh()");let t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)})}startAutoRefresh(){return M(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return M(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return M(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>M(this,null,function*(){try{let t=Date.now();try{return yield this._useSession(n=>M(this,null,function*(){let{data:{session:o}}=n;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let s=Math.floor((o.expires_at*1e3-t)/OC);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${OC}ms, refresh threshold is ${Z6} ticks`),s<=Z6&&(yield this._callRefreshToken(o.refresh_token))}))}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(t.isAcquireTimeout||t instanceof T1)this._debug("auto refresh token tick lock not available");else throw t}})}_handleVisibilityChange(){return M(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!vc()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>M(this,null,function*(){return yield this._onVisibilityChanged(!1)}),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})}_onVisibilityChanged(t){return M(this,null,function*(){let n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(yield this.initializePromise,yield this._acquireLock(-1,()=>M(this,null,function*(){if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}yield this._recoverAndRefresh()})))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(t,n,o){return M(this,null,function*(){let s=[`provider=${encodeURIComponent(n)}`];if(o?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&s.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let i=vg();yield Nh(this.storage,`${this.storageKey}-code-verifier`,i);let a=yield bg(i),c=i===a?"plain":"s256";this._debug("PKCE","code verifier",`${i.substring(0,5)}...`,"code challenge",a,"method",c);let l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(c)}`});s.push(l.toString())}if(o?.queryParams){let i=new URLSearchParams(o.queryParams);s.push(i.toString())}return o?.skipBrowserRedirect&&s.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${t}?${s.join("&")}`})}_unenroll(t){return M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o;let{data:s,error:i}=n;return i?{data:null,error:i}:yield gr(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token})}))}catch(n){if(nr(n))return{data:null,error:n};throw n}})}_enroll(t){return M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o,s;let{data:i,error:a}=n;if(a)return{data:null,error:a};let{data:c,error:l}=yield gr(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:t.friendlyName,factor_type:t.factorType,issuer:t.issuer},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(!((s=c?.totp)===null||s===void 0)&&s.qr_code&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})}))}catch(n){if(nr(n))return{data:null,error:n};throw n}})}_verify(t){return M(this,null,function*(){return this._acquireLock(-1,()=>M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o;let{data:s,error:i}=n;if(i)return{data:null,error:i};let{data:a,error:c}=yield gr(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return c?{data:null,error:c}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:c})}))}catch(n){if(nr(n))return{data:null,error:n};throw n}}))})}_challenge(t){return M(this,null,function*(){return this._acquireLock(-1,()=>M(this,null,function*(){try{return yield this._useSession(n=>M(this,null,function*(){var o;let{data:s,error:i}=n;return i?{data:null,error:i}:yield gr(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token})}))}catch(n){if(nr(n))return{data:null,error:n};throw n}}))})}_challengeAndVerify(t){return M(this,null,function*(){let{data:n,error:o}=yield this._challenge({factorId:t.factorId});return o?{data:null,error:o}:yield this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})})}_listFactors(){return M(this,null,function*(){let{data:{user:t},error:n}=yield this.getUser();if(n)return{data:null,error:n};let o=t?.factors||[],s=o.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:o,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){return M(this,null,function*(){return this._acquireLock(-1,()=>M(this,null,function*(){return yield this._useSession(t=>M(this,null,function*(){var n,o;let{data:{session:s},error:i}=t;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(s.access_token),c=null;a.aal&&(c=a.aal);let l=c;((o=(n=s.user.factors)===null||n===void 0?void 0:n.filter(d=>d.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(l="aal2");let p=a.amr||[];return{data:{currentLevel:c,nextLevel:l,currentAuthenticationMethods:p},error:null}}))}))})}}return r.nextInstanceID=0,r})();var y1e=Y$,Z$=y1e;var k1=class extends Z${constructor(e){super(e)}};var x1e=function(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},E1=class{constructor(e,t,n){var o,s,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");let a=M6(e);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:D6,realtime:R6,auth:Object.assign(Object.assign({},A6),{storageKey:c}),global:N6},u=F6(n??{},l);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=u.global.headers)!==null&&s!==void 0?s:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(p,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=u.auth)!==null&&i!==void 0?i:{},this.headers,u.global.fetch),this.fetch=O6(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},u.realtime)),this.rest=new g6(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new mC(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new kC(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return x1e(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:o,storageKey:s,flowType:i,lock:a,debug:c},l,u){var p;let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new k1({url:this.authUrl,headers:Object.assign(Object.assign({},d),l),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:o,flowType:i,lock:a,debug:c,fetch:u,hasCustomAuthorizationHeader:(p="Authorization"in this.headers)!==null&&p!==void 0?p:!1})}_initRealtimeClient(e){return new IC(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.realtime.setAuth(n??null),this.changedAccessToken=n):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var Q6=(r,e,t)=>new E1(r,e,t);var _g={production:!0,mixpanelApiKey:"af85a6f92f0558a68810eb47ac470c7c",supabaseApiKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4cXZ5b3R5bGVzY3F4YWF5cWJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjUyMDU3NjMsImV4cCI6MjA0MDc4MTc2M30.ypdZbKEQX7iZR8t6EoWFIJJj5sktkQGsNAt7kIjWkJk",supabaseProjectURL:"https://hxqvyotylescqxaayqbl.supabase.co",applicationLinkURLPreffix:"https://moveplayground.com"};var pu=class r{static supabase;constructor(){}client(){return r.supabase||(r.supabase=Q6(_g.supabaseProjectURL,_g.supabaseApiKey)),r.supabase}signInWithEmail(e){return this.client().auth.signInWithOtp({email:e})}signOut(){return this.client().auth.signOut()}getUser(){return this.client().auth.getUser()}findAll(e){return M(this,null,function*(){let{data:t,error:n}=yield this.client().from(e).select("*");return n?(console.error("Error fetching data:",n),[]):t})}addOne(e,t){return M(this,null,function*(){let{data:n,error:o}=yield this.client().from(e).insert([t]).select();return o?console.error("Error inserting data:",o.message):console.log("Record added successfully:",n),n&&n[0]})}findOne(e,t,n="id"){return M(this,null,function*(){let{data:o,error:s}=yield this.client().from(e).select("*").eq(n,t).single();return s?(console.error(`Error fetching ${e} with ${n} ${t}:`,s.message),null):o})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var Yx=class r{constructor(e){this.supabaseService=e}user=void 0;get(){return M(this,null,function*(){let e=yield this.supabaseService.getUser();if(e.error)throw new Error(e.error.message);return this.user=e.data.user,e.data.user})}logout(){this.supabaseService.signOut()}static \u0275fac=function(t){return new(t||r)(Lt(pu))};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var Vo=function(r){return r[r.Document=0]="Document",r[r.DocumentType=1]="DocumentType",r[r.Element=2]="Element",r[r.Text=3]="Text",r[r.CDATA=4]="CDATA",r[r.Comment=5]="Comment",r}(Vo||{});function v1e(r){return r.nodeType===r.ELEMENT_NODE}function FC(r){let e=r?.host;return e?.shadowRoot===r}function PC(r){return Object.prototype.toString.call(r)==="[object ShadowRoot]"}function b1e(r){return r.includes(" background-clip: text;")&&!r.includes(" -webkit-background-clip: text;")&&(r=r.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),r}function w1e(r){let{cssText:e}=r;if(e.split('"').length<3)return e;let t=["@import",`url(${JSON.stringify(r.href)})`];return r.layerName===""?t.push("layer"):r.layerName&&t.push(`layer(${r.layerName})`),r.supportsText&&t.push(`supports(${r.supportsText})`),r.media.length&&t.push(r.media.mediaText),t.join(" ")+";"}function F1(r){try{let e=r.rules||r.cssRules;return e?b1e(Array.from(e,w5).join("")):null}catch{return null}}function w5(r){let e;if(_1e(r))try{e=F1(r.styleSheet)||w1e(r)}catch{}else if(S1e(r)&&r.selectorText.includes(":"))return C1e(r.cssText);return e||r.cssText}function C1e(r){let e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return r.replace(e,"$1\\$2")}function _1e(r){return"styleSheet"in r}function S1e(r){return"selectorText"in r}var P1=class{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(e){var t;if(!e)return-1;let n=(t=this.getMeta(e))===null||t===void 0?void 0:t.id;return n??-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){let t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach(n=>this.removeNodeFromMap(n))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){let n=t.id;this.idNodeMap.set(n,e),this.nodeMetaMap.set(e,t)}replace(e,t){let n=this.getNode(e);if(n){let o=this.nodeMetaMap.get(n);o&&this.nodeMetaMap.set(t,o)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}};function I1e(){return new P1}function xL({element:r,maskInputOptions:e,tagName:t,type:n,value:o,maskInputFn:s}){let i=o||"",a=n&&Tg(n);return(e[t.toLowerCase()]||a&&e[a])&&(s?i=s(i,r):i="*".repeat(i.length)),i}function Tg(r){return r.toLowerCase()}var e5="__rrweb_original__";function T1e(r){let e=r.getContext("2d");if(!e)return!0;let t=50;for(let n=0;n<r.width;n+=t)for(let o=0;o<r.height;o+=t){let s=e.getImageData,i=e5 in s?s[e5]:s;if(new Uint32Array(i.call(e,n,o,Math.min(t,r.width-n),Math.min(t,r.height-o)).data.buffer).some(c=>c!==0))return!1}return!0}function vL(r){let e=r.type;return r.hasAttribute("data-rr-is-password")?"password":e?Tg(e):null}function C5(r,e){var t;let n;try{n=new URL(r,e??window.location.href)}catch{return null}let o=/\.([0-9a-z]+)(?:$)/i,s=n.pathname.match(o);return(t=s?.[1])!==null&&t!==void 0?t:null}var k1e=1,E1e=new RegExp("[^a-z0-9-_:]"),BC=-2;function _5(){return k1e++}function N1e(r){if(r instanceof HTMLFormElement)return"form";let e=Tg(r.tagName);return E1e.test(e)?"div":e}function D1e(r){let e="";return r.indexOf("//")>-1?e=r.split("/").slice(0,3).join("/"):e=r.split("/")[0],e=e.split("?")[0],e}var Zx,t5,A1e=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,R1e=/^(?:[a-z+]+:)?\/\//i,O1e=/^www\..*/i,M1e=/^(data:)([^,]*),(.*)/i;function $1(r,e){return(r||"").replace(A1e,(t,n,o,s,i,a)=>{let c=o||i||a,l=n||s||"";if(!c)return t;if(R1e.test(c)||O1e.test(c))return`url(${l}${c}${l})`;if(M1e.test(c))return`url(${l}${c}${l})`;if(c[0]==="/")return`url(${l}${D1e(e)+c}${l})`;let u=e.split("/"),p=c.split("/");u.pop();for(let d of p)d!=="."&&(d===".."?u.pop():u.push(d));return`url(${l}${u.join("/")}${l})`})}var F1e=/^[^ \t\n\r\u000c]+/,P1e=/^[, \t\n\r\u000c]+/;function $1e(r,e){if(e.trim()==="")return e;let t=0;function n(s){let i,a=s.exec(e.substring(t));return a?(i=a[0],t+=i.length,i):""}let o=[];for(;n(P1e),!(t>=e.length);){let s=n(F1e);if(s.slice(-1)===",")s=Jx(r,s.substring(0,s.length-1)),o.push(s);else{let i="";s=Jx(r,s);let a=!1;for(;;){let c=e.charAt(t);if(c===""){o.push((s+i).trim());break}else if(a)c===")"&&(a=!1);else if(c===","){t+=1,o.push((s+i).trim());break}else c==="("&&(a=!0);i+=c,t+=1}}}return o.join(", ")}function Jx(r,e){if(!e||e.trim()==="")return e;let t=r.createElement("a");return t.href=e,t.href}function L1e(r){return!!(r.tagName==="svg"||r.ownerSVGElement)}function bL(){let r=document.createElement("a");return r.href="",r.href}function S5(r,e,t,n){return n&&(t==="src"||t==="href"&&!(e==="use"&&n[0]==="#")||t==="xlink:href"&&n[0]!=="#"||t==="background"&&(e==="table"||e==="td"||e==="th")?Jx(r,n):t==="srcset"?$1e(r,n):t==="style"?$1(n,bL()):e==="object"&&t==="data"?Jx(r,n):n)}function I5(r,e,t){return(r==="video"||r==="audio")&&e==="autoplay"}function V1e(r,e,t){try{if(typeof e=="string"){if(r.classList.contains(e))return!0}else for(let n=r.classList.length;n--;){let o=r.classList[n];if(e.test(o))return!0}if(t)return r.matches(t)}catch{}return!1}function L1(r,e,t){if(!r)return!1;if(r.nodeType!==r.ELEMENT_NODE)return t?L1(r.parentNode,e,t):!1;for(let n=r.classList.length;n--;){let o=r.classList[n];if(e.test(o))return!0}return t?L1(r.parentNode,e,t):!1}function T5(r,e,t,n){try{let o=r.nodeType===r.ELEMENT_NODE?r:r.parentElement;if(o===null)return!1;if(typeof e=="string"){if(n){if(o.closest(`.${e}`))return!0}else if(o.classList.contains(e))return!0}else if(L1(o,e,n))return!0;if(t){if(n){if(o.closest(t))return!0}else if(o.matches(t))return!0}}catch{}return!1}function B1e(r,e,t){let n=r.contentWindow;if(!n)return;let o=!1,s;try{s=n.document.readyState}catch{return}if(s!=="complete"){let a=setTimeout(()=>{o||(e(),o=!0)},t);r.addEventListener("load",()=>{clearTimeout(a),o=!0,e()});return}let i="about:blank";if(n.location.href!==i||r.src===i||r.src==="")return setTimeout(e,0),r.addEventListener("load",e);r.addEventListener("load",e)}function z1e(r,e,t){let n=!1,o;try{o=r.sheet}catch{return}if(o)return;let s=setTimeout(()=>{n||(e(),n=!0)},t);r.addEventListener("load",()=>{clearTimeout(s),n=!0,e()})}function U1e(r,e){let{doc:t,mirror:n,blockClass:o,blockSelector:s,needsMask:i,inlineStylesheet:a,maskInputOptions:c={},maskTextFn:l,maskInputFn:u,dataURLOptions:p={},inlineImages:d,recordCanvas:h,keepIframeSrcFn:f,newlyAddedElement:m=!1}=e,g=G1e(t,n);switch(r.nodeType){case r.DOCUMENT_NODE:return r.compatMode!=="CSS1Compat"?{type:Vo.Document,childNodes:[],compatMode:r.compatMode}:{type:Vo.Document,childNodes:[]};case r.DOCUMENT_TYPE_NODE:return{type:Vo.DocumentType,name:r.name,publicId:r.publicId,systemId:r.systemId,rootId:g};case r.ELEMENT_NODE:return j1e(r,{doc:t,blockClass:o,blockSelector:s,inlineStylesheet:a,maskInputOptions:c,maskInputFn:u,dataURLOptions:p,inlineImages:d,recordCanvas:h,keepIframeSrcFn:f,newlyAddedElement:m,rootId:g});case r.TEXT_NODE:return W1e(r,{needsMask:i,maskTextFn:l,rootId:g});case r.CDATA_SECTION_NODE:return{type:Vo.CDATA,textContent:"",rootId:g};case r.COMMENT_NODE:return{type:Vo.Comment,textContent:r.textContent||"",rootId:g};default:return!1}}function G1e(r,e){if(!e.hasNode(r))return;let t=e.getId(r);return t===1?void 0:t}function W1e(r,e){var t;let{needsMask:n,maskTextFn:o,rootId:s}=e,i=r.parentNode&&r.parentNode.tagName,a=r.textContent,c=i==="STYLE"?!0:void 0,l=i==="SCRIPT"?!0:void 0;if(c&&a){try{r.nextSibling||r.previousSibling||!((t=r.parentNode.sheet)===null||t===void 0)&&t.cssRules&&(a=F1(r.parentNode.sheet))}catch(u){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${u}`,r)}a=$1(a,bL())}return l&&(a="SCRIPT_PLACEHOLDER"),!c&&!l&&a&&n&&(a=o?o(a,r.parentElement):a.replace(/[\S]/g,"*")),{type:Vo.Text,textContent:a||"",isStyle:c,rootId:s}}function j1e(r,e){let{doc:t,blockClass:n,blockSelector:o,inlineStylesheet:s,maskInputOptions:i={},maskInputFn:a,dataURLOptions:c={},inlineImages:l,recordCanvas:u,keepIframeSrcFn:p,newlyAddedElement:d=!1,rootId:h}=e,f=V1e(r,n,o),m=N1e(r),g={},y=r.attributes.length;for(let b=0;b<y;b++){let w=r.attributes[b];I5(m,w.name,w.value)||(g[w.name]=S5(t,m,Tg(w.name),w.value))}if(m==="link"&&s){let b=Array.from(t.styleSheets).find(_=>_.href===r.href),w=null;b&&(w=F1(b)),w&&(delete g.rel,delete g.href,g._cssText=$1(w,b.href))}if(m==="style"&&r.sheet&&!(r.innerText||r.textContent||"").trim().length){let b=F1(r.sheet);b&&(g._cssText=$1(b,bL()))}if(m==="input"||m==="textarea"||m==="select"){let b=r.value,w=r.checked;g.type!=="radio"&&g.type!=="checkbox"&&g.type!=="submit"&&g.type!=="button"&&b?g.value=xL({element:r,type:vL(r),tagName:m,value:b,maskInputOptions:i,maskInputFn:a}):w&&(g.checked=w)}if(m==="option"&&(r.selected&&!i.select?g.selected=!0:delete g.selected),m==="canvas"&&u){if(r.__context==="2d")T1e(r)||(g.rr_dataURL=r.toDataURL(c.type,c.quality));else if(!("__context"in r)){let b=r.toDataURL(c.type,c.quality),w=document.createElement("canvas");w.width=r.width,w.height=r.height;let _=w.toDataURL(c.type,c.quality);b!==_&&(g.rr_dataURL=b)}}if(m==="img"&&l){Zx||(Zx=t.createElement("canvas"),t5=Zx.getContext("2d"));let b=r,w=b.crossOrigin;b.crossOrigin="anonymous";let _=()=>{b.removeEventListener("load",_);try{Zx.width=b.naturalWidth,Zx.height=b.naturalHeight,t5.drawImage(b,0,0),g.rr_dataURL=Zx.toDataURL(c.type,c.quality)}catch(I){console.warn(`Cannot inline img src=${b.currentSrc}! Error: ${I}`)}w?g.crossOrigin=w:b.removeAttribute("crossorigin")};b.complete&&b.naturalWidth!==0?_():b.addEventListener("load",_)}if(m==="audio"||m==="video"){let b=g;b.rr_mediaState=r.paused?"paused":"played",b.rr_mediaCurrentTime=r.currentTime,b.rr_mediaPlaybackRate=r.playbackRate,b.rr_mediaMuted=r.muted,b.rr_mediaLoop=r.loop,b.rr_mediaVolume=r.volume}if(d||(r.scrollLeft&&(g.rr_scrollLeft=r.scrollLeft),r.scrollTop&&(g.rr_scrollTop=r.scrollTop)),f){let{width:b,height:w}=r.getBoundingClientRect();g={class:g.class,rr_width:`${b}px`,rr_height:`${w}px`}}m==="iframe"&&!p(g.src)&&(r.contentDocument||(g.rr_src=g.src),delete g.src);let x;try{customElements.get(m)&&(x=!0)}catch{}return{type:Vo.Element,tagName:m,attributes:g,childNodes:[],isSVG:L1e(r)||void 0,needBlock:f,rootId:h,isCustom:x}}function _n(r){return r==null?"":r.toLowerCase()}function H1e(r,e){if(e.comment&&r.type===Vo.Comment)return!0;if(r.type===Vo.Element){if(e.script&&(r.tagName==="script"||r.tagName==="link"&&(r.attributes.rel==="preload"||r.attributes.rel==="modulepreload")&&r.attributes.as==="script"||r.tagName==="link"&&r.attributes.rel==="prefetch"&&typeof r.attributes.href=="string"&&C5(r.attributes.href)==="js"))return!0;if(e.headFavicon&&(r.tagName==="link"&&r.attributes.rel==="shortcut icon"||r.tagName==="meta"&&(_n(r.attributes.name).match(/^msapplication-tile(image|color)$/)||_n(r.attributes.name)==="application-name"||_n(r.attributes.rel)==="icon"||_n(r.attributes.rel)==="apple-touch-icon"||_n(r.attributes.rel)==="shortcut icon")))return!0;if(r.tagName==="meta"){if(e.headMetaDescKeywords&&_n(r.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(_n(r.attributes.property).match(/^(og|twitter|fb):/)||_n(r.attributes.name).match(/^(og|twitter):/)||_n(r.attributes.name)==="pinterest"))return!0;if(e.headMetaRobots&&(_n(r.attributes.name)==="robots"||_n(r.attributes.name)==="googlebot"||_n(r.attributes.name)==="bingbot"))return!0;if(e.headMetaHttpEquiv&&r.attributes["http-equiv"]!==void 0)return!0;if(e.headMetaAuthorship&&(_n(r.attributes.name)==="author"||_n(r.attributes.name)==="generator"||_n(r.attributes.name)==="framework"||_n(r.attributes.name)==="publisher"||_n(r.attributes.name)==="progid"||_n(r.attributes.property).match(/^article:/)||_n(r.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&(_n(r.attributes.name)==="google-site-verification"||_n(r.attributes.name)==="yandex-verification"||_n(r.attributes.name)==="csrf-token"||_n(r.attributes.name)==="p:domain_verify"||_n(r.attributes.name)==="verify-v1"||_n(r.attributes.name)==="verification"||_n(r.attributes.name)==="shopify-checkout-api-token"))return!0}}return!1}function ev(r,e){let{doc:t,mirror:n,blockClass:o,blockSelector:s,maskTextClass:i,maskTextSelector:a,skipChild:c=!1,inlineStylesheet:l=!0,maskInputOptions:u={},maskTextFn:p,maskInputFn:d,slimDOMOptions:h,dataURLOptions:f={},inlineImages:m=!1,recordCanvas:g=!1,onSerialize:y,onIframeLoad:x,iframeLoadTimeout:b=5e3,onStylesheetLoad:w,stylesheetLoadTimeout:_=5e3,keepIframeSrcFn:I=()=>!1,newlyAddedElement:S=!1}=e,{needsMask:k}=e,{preserveWhiteSpace:R=!0}=e;!k&&r.childNodes&&(k=T5(r,i,a,k===void 0));let L=U1e(r,{doc:t,mirror:n,blockClass:o,blockSelector:s,needsMask:k,inlineStylesheet:l,maskInputOptions:u,maskTextFn:p,maskInputFn:d,dataURLOptions:f,inlineImages:m,recordCanvas:g,keepIframeSrcFn:I,newlyAddedElement:S});if(!L)return console.warn(r,"not serialized"),null;let B;n.hasNode(r)?B=n.getId(r):H1e(L,h)||!R&&L.type===Vo.Text&&!L.isStyle&&!L.textContent.replace(/^\s+|\s+$/gm,"").length?B=BC:B=_5();let z=Object.assign(L,{id:B});if(n.add(r,z),B===BC)return null;y&&y(r);let q=!c;if(z.type===Vo.Element){q=q&&!z.needBlock,delete z.needBlock;let U=r.shadowRoot;U&&PC(U)&&(z.isShadowHost=!0)}if((z.type===Vo.Document||z.type===Vo.Element)&&q){h.headWhitespace&&z.type===Vo.Element&&z.tagName==="head"&&(R=!1);let U={doc:t,mirror:n,blockClass:o,blockSelector:s,needsMask:k,maskTextClass:i,maskTextSelector:a,skipChild:c,inlineStylesheet:l,maskInputOptions:u,maskTextFn:p,maskInputFn:d,slimDOMOptions:h,dataURLOptions:f,inlineImages:m,recordCanvas:g,preserveWhiteSpace:R,onSerialize:y,onIframeLoad:x,iframeLoadTimeout:b,onStylesheetLoad:w,stylesheetLoadTimeout:_,keepIframeSrcFn:I};if(!(z.type===Vo.Element&&z.tagName==="textarea"&&z.attributes.value!==void 0))for(let G of Array.from(r.childNodes)){let j=ev(G,U);j&&z.childNodes.push(j)}if(v1e(r)&&r.shadowRoot)for(let G of Array.from(r.shadowRoot.childNodes)){let j=ev(G,U);j&&(PC(r.shadowRoot)&&(j.isShadow=!0),z.childNodes.push(j))}}return r.parentNode&&FC(r.parentNode)&&PC(r.parentNode)&&(z.isShadow=!0),z.type===Vo.Element&&z.tagName==="iframe"&&B1e(r,()=>{let U=r.contentDocument;if(U&&x){let G=ev(U,{doc:U,mirror:n,blockClass:o,blockSelector:s,needsMask:k,maskTextClass:i,maskTextSelector:a,skipChild:!1,inlineStylesheet:l,maskInputOptions:u,maskTextFn:p,maskInputFn:d,slimDOMOptions:h,dataURLOptions:f,inlineImages:m,recordCanvas:g,preserveWhiteSpace:R,onSerialize:y,onIframeLoad:x,iframeLoadTimeout:b,onStylesheetLoad:w,stylesheetLoadTimeout:_,keepIframeSrcFn:I});G&&x(r,G)}},b),z.type===Vo.Element&&z.tagName==="link"&&typeof z.attributes.rel=="string"&&(z.attributes.rel==="stylesheet"||z.attributes.rel==="preload"&&typeof z.attributes.href=="string"&&C5(z.attributes.href)==="css")&&z1e(r,()=>{if(w){let U=ev(r,{doc:t,mirror:n,blockClass:o,blockSelector:s,needsMask:k,maskTextClass:i,maskTextSelector:a,skipChild:!1,inlineStylesheet:l,maskInputOptions:u,maskTextFn:p,maskInputFn:d,slimDOMOptions:h,dataURLOptions:f,inlineImages:m,recordCanvas:g,preserveWhiteSpace:R,onSerialize:y,onIframeLoad:x,iframeLoadTimeout:b,onStylesheetLoad:w,stylesheetLoadTimeout:_,keepIframeSrcFn:I});U&&w(r,U)}},_),z}function q1e(r,e){let{mirror:t=new P1,blockClass:n="rr-block",blockSelector:o=null,maskTextClass:s="rr-mask",maskTextSelector:i=null,inlineStylesheet:a=!0,inlineImages:c=!1,recordCanvas:l=!1,maskAllInputs:u=!1,maskTextFn:p,maskInputFn:d,slimDOM:h=!1,dataURLOptions:f,preserveWhiteSpace:m,onSerialize:g,onIframeLoad:y,iframeLoadTimeout:x,onStylesheetLoad:b,stylesheetLoadTimeout:w,keepIframeSrcFn:_=()=>!1}=e||{};return ev(r,{doc:r,mirror:t,blockClass:n,blockSelector:o,maskTextClass:s,maskTextSelector:i,skipChild:!1,inlineStylesheet:a,maskInputOptions:u===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:u===!1?{password:!0}:u,maskTextFn:p,maskInputFn:d,slimDOMOptions:h===!0||h==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:h==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:h===!1?{}:h,dataURLOptions:f,inlineImages:c,recordCanvas:l,preserveWhiteSpace:m,onSerialize:g,onIframeLoad:y,iframeLoadTimeout:x,onStylesheetLoad:b,stylesheetLoadTimeout:w,keepIframeSrcFn:_,newlyAddedElement:!1})}function js(r,e,t=document){let n={capture:!0,passive:!0};return t.addEventListener(r,e,n),()=>t.removeEventListener(r,e,n)}var Qx=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`,r5={map:{},getId(){return console.error(Qx),-1},getNode(){return console.error(Qx),null},removeNodeFromMap(){console.error(Qx)},has(){return console.error(Qx),!1},reset(){console.error(Qx)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(r5=new Proxy(r5,{get(r,e,t){return e==="map"&&console.error(Qx),Reflect.get(r,e,t)}}));function zC(r,e,t={}){let n=null,o=0;return function(...s){let i=Date.now();!o&&t.leading===!1&&(o=i);let a=e-(i-o),c=this;a<=0||a>e?(n&&(clearTimeout(n),n=null),o=i,r.apply(c,s)):!n&&t.trailing!==!1&&(n=setTimeout(()=>{o=t.leading===!1?0:Date.now(),n=null,r.apply(c,s)},a))}}function X1(r,e,t,n,o=window){let s=o.Object.getOwnPropertyDescriptor(r,e);return o.Object.defineProperty(r,e,n?t:{set(i){setTimeout(()=>{t.set.call(this,i)},0),s&&s.set&&s.set.call(this,i)}}),()=>X1(r,e,s||{},!0)}function av(r,e,t){try{if(!(e in r))return()=>{};let n=r[e],o=t(n);return typeof o=="function"&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:n}})),r[e]=o,()=>{r[e]=n}}catch{return()=>{}}}var V1=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(V1=()=>new Date().getTime());function k5(r){var e,t,n,o,s,i;let a=r.document;return{left:a.scrollingElement?a.scrollingElement.scrollLeft:r.pageXOffset!==void 0?r.pageXOffset:a?.documentElement.scrollLeft||((t=(e=a?.body)===null||e===void 0?void 0:e.parentElement)===null||t===void 0?void 0:t.scrollLeft)||((n=a?.body)===null||n===void 0?void 0:n.scrollLeft)||0,top:a.scrollingElement?a.scrollingElement.scrollTop:r.pageYOffset!==void 0?r.pageYOffset:a?.documentElement.scrollTop||((s=(o=a?.body)===null||o===void 0?void 0:o.parentElement)===null||s===void 0?void 0:s.scrollTop)||((i=a?.body)===null||i===void 0?void 0:i.scrollTop)||0}}function E5(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function N5(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function D5(r){return r?r.nodeType===r.ELEMENT_NODE?r:r.parentElement:null}function Hs(r,e,t,n){if(!r)return!1;let o=D5(r);if(!o)return!1;try{if(typeof e=="string"){if(o.classList.contains(e)||n&&o.closest("."+e)!==null)return!0}else if(L1(o,e,n))return!0}catch{}return!!(t&&(o.matches(t)||n&&o.closest(t)!==null))}function K1e(r,e){return e.getId(r)!==-1}function Q$(r,e){return e.getId(r)===BC}function A5(r,e){if(FC(r))return!1;let t=e.getId(r);return e.has(t)?r.parentNode&&r.parentNode.nodeType===r.DOCUMENT_NODE?!1:r.parentNode?A5(r.parentNode,e):!0:!0}function sL(r){return!!r.changedTouches}function X1e(r=window){"NodeList"in r&&!r.NodeList.prototype.forEach&&(r.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in r&&!r.DOMTokenList.prototype.forEach&&(r.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do if(this===t)return!0;while(t=t&&t.parentNode);return!1})}function R5(r,e){return!!(r.nodeName==="IFRAME"&&e.getMeta(r))}function O5(r,e){return!!(r.nodeName==="LINK"&&r.nodeType===r.ELEMENT_NODE&&r.getAttribute&&r.getAttribute("rel")==="stylesheet"&&e.getMeta(r))}function iL(r){return!!r?.shadowRoot}var aL=class{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){var t;return(t=this.styleIDMap.get(e))!==null&&t!==void 0?t:-1}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let n;return t===void 0?n=this.id++:n=t,this.styleIDMap.set(e,n),this.idStyleMap.set(n,e),n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}};function M5(r){var e,t;let n=null;return((t=(e=r.getRootNode)===null||e===void 0?void 0:e.call(r))===null||t===void 0?void 0:t.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&r.getRootNode().host&&(n=r.getRootNode().host),n}function Y1e(r){let e=r,t;for(;t=M5(e);)e=t;return e}function Z1e(r){let e=r.ownerDocument;if(!e)return!1;let t=Y1e(r);return e.contains(t)}function F5(r){let e=r.ownerDocument;return e?e.contains(r)||Z1e(r):!1}var Ar=(r=>(r[r.DomContentLoaded=0]="DomContentLoaded",r[r.Load=1]="Load",r[r.FullSnapshot=2]="FullSnapshot",r[r.IncrementalSnapshot=3]="IncrementalSnapshot",r[r.Meta=4]="Meta",r[r.Custom=5]="Custom",r[r.Plugin=6]="Plugin",r))(Ar||{}),wr=(r=>(r[r.Mutation=0]="Mutation",r[r.MouseMove=1]="MouseMove",r[r.MouseInteraction=2]="MouseInteraction",r[r.Scroll=3]="Scroll",r[r.ViewportResize=4]="ViewportResize",r[r.Input=5]="Input",r[r.TouchMove=6]="TouchMove",r[r.MediaInteraction=7]="MediaInteraction",r[r.StyleSheetRule=8]="StyleSheetRule",r[r.CanvasMutation=9]="CanvasMutation",r[r.Font=10]="Font",r[r.Log=11]="Log",r[r.Drag=12]="Drag",r[r.StyleDeclaration=13]="StyleDeclaration",r[r.Selection=14]="Selection",r[r.AdoptedStyleSheet=15]="AdoptedStyleSheet",r[r.CustomElement=16]="CustomElement",r))(wr||{}),Ii=(r=>(r[r.MouseUp=0]="MouseUp",r[r.MouseDown=1]="MouseDown",r[r.Click=2]="Click",r[r.ContextMenu=3]="ContextMenu",r[r.DblClick=4]="DblClick",r[r.Focus=5]="Focus",r[r.Blur=6]="Blur",r[r.TouchStart=7]="TouchStart",r[r.TouchMove_Departed=8]="TouchMove_Departed",r[r.TouchEnd=9]="TouchEnd",r[r.TouchCancel=10]="TouchCancel",r))(Ii||{}),cd=(r=>(r[r.Mouse=0]="Mouse",r[r.Pen=1]="Pen",r[r.Touch=2]="Touch",r))(cd||{}),ov=(r=>(r[r["2D"]=0]="2D",r[r.WebGL=1]="WebGL",r[r.WebGL2=2]="WebGL2",r))(ov||{});function n5(r){return"__ln"in r}var cL=class{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let n=0;n<e;n++)t=t?.next||null;return t}addNode(e){let t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&n5(e.previousSibling)){let n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&n5(e.nextSibling)&&e.nextSibling.__ln.previous){let n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;t.next===null&&(this.tail=t),this.length++}removeNode(e){let t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous):(this.head=t.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}},o5=(r,e)=>`${r}@${e}`,lL=class{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;let e=[],t=new Set,n=new cL,o=c=>{let l=c,u=BC;for(;u===BC;)l=l&&l.nextSibling,u=l&&this.mirror.getId(l);return u},s=c=>{if(!c.parentNode||!F5(c)||c.parentNode.tagName==="TEXTAREA")return;let l=FC(c.parentNode)?this.mirror.getId(M5(c)):this.mirror.getId(c.parentNode),u=o(c);if(l===-1||u===-1)return n.addNode(c);let p=ev(c,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:d=>{R5(d,this.mirror)&&this.iframeManager.addIframe(d),O5(d,this.mirror)&&this.stylesheetManager.trackLinkElement(d),iL(c)&&this.shadowDomManager.addShadowRoot(c.shadowRoot,this.doc)},onIframeLoad:(d,h)=>{this.iframeManager.attachIframe(d,h),this.shadowDomManager.observeAttachShadow(d)},onStylesheetLoad:(d,h)=>{this.stylesheetManager.attachLinkElement(d,h)}});p&&(e.push({parentId:l,nextId:u,node:p}),t.add(p.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(let c of this.movedSet)s5(this.removes,c,this.mirror)&&!this.movedSet.has(c.parentNode)||s(c);for(let c of this.addedSet)!i5(this.droppedSet,c)&&!s5(this.removes,c,this.mirror)||i5(this.movedSet,c)?s(c):this.droppedSet.add(c);let i=null;for(;n.length;){let c=null;if(i){let l=this.mirror.getId(i.value.parentNode),u=o(i.value);l!==-1&&u!==-1&&(c=i)}if(!c){let l=n.tail;for(;l;){let u=l;if(l=l.previous,u){let p=this.mirror.getId(u.value.parentNode);if(o(u.value)===-1)continue;if(p!==-1){c=u;break}else{let h=u.value;if(h.parentNode&&h.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){let f=h.parentNode.host;if(this.mirror.getId(f)!==-1){c=u;break}}}}}}if(!c){for(;n.head;)n.removeNode(n.head.value);break}i=c.previous,n.removeNode(c.value),s(c.value)}let a={texts:this.texts.map(c=>{let l=c.node;return l.parentNode&&l.parentNode.tagName==="TEXTAREA"&&this.genTextAreaValueMutation(l.parentNode),{id:this.mirror.getId(l),value:c.value}}).filter(c=>!t.has(c.id)).filter(c=>this.mirror.has(c.id)),attributes:this.attributes.map(c=>{let{attributes:l}=c;if(typeof l.style=="string"){let u=JSON.stringify(c.styleDiff),p=JSON.stringify(c._unchangedStyles);u.length<l.style.length&&(u+p).split("var(").length===l.style.split("var(").length&&(l.style=c.styleDiff)}return{id:this.mirror.getId(c.node),attributes:l}}).filter(c=>!t.has(c.id)).filter(c=>this.mirror.has(c.id)),removes:this.removes,adds:e};!a.texts.length&&!a.attributes.length&&!a.removes.length&&!a.adds.length||(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(a))},this.genTextAreaValueMutation=e=>{let t=this.attributeMap.get(e);t||(t={node:e,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(t),this.attributeMap.set(e,t)),t.attributes.value=Array.from(e.childNodes,n=>n.textContent||"").join("")},this.processMutation=e=>{if(!Q$(e.target,this.mirror))switch(e.type){case"characterData":{let t=e.target.textContent;!Hs(e.target,this.blockClass,this.blockSelector,!1)&&t!==e.oldValue&&this.texts.push({value:T5(e.target,this.maskTextClass,this.maskTextSelector,!0)&&t?this.maskTextFn?this.maskTextFn(t,D5(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{let t=e.target,n=e.attributeName,o=e.target.getAttribute(n);if(n==="value"){let i=vL(t);o=xL({element:t,maskInputOptions:this.maskInputOptions,tagName:t.tagName,type:i,value:o,maskInputFn:this.maskInputFn})}if(Hs(e.target,this.blockClass,this.blockSelector,!1)||o===e.oldValue)return;let s=this.attributeMap.get(e.target);if(t.tagName==="IFRAME"&&n==="src"&&!this.keepIframeSrcFn(o))if(!t.contentDocument)n="rr_src";else return;if(s||(s={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(s),this.attributeMap.set(e.target,s)),n==="type"&&t.tagName==="INPUT"&&(e.oldValue||"").toLowerCase()==="password"&&t.setAttribute("data-rr-is-password","true"),!I5(t.tagName,n)&&(s.attributes[n]=S5(this.doc,Tg(t.tagName),Tg(n),o),n==="style")){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch{this.unattachedDoc=this.doc}let i=this.unattachedDoc.createElement("span");e.oldValue&&i.setAttribute("style",e.oldValue);for(let a of Array.from(t.style)){let c=t.style.getPropertyValue(a),l=t.style.getPropertyPriority(a);c!==i.style.getPropertyValue(a)||l!==i.style.getPropertyPriority(a)?l===""?s.styleDiff[a]=c:s.styleDiff[a]=[c,l]:s._unchangedStyles[a]=[c,l]}for(let a of Array.from(i.style))t.style.getPropertyValue(a)===""&&(s.styleDiff[a]=!1)}break}case"childList":{if(Hs(e.target,this.blockClass,this.blockSelector,!0))return;if(e.target.tagName==="TEXTAREA"){this.genTextAreaValueMutation(e.target);return}e.addedNodes.forEach(t=>this.genAdds(t,e.target)),e.removedNodes.forEach(t=>{let n=this.mirror.getId(t),o=FC(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);Hs(e.target,this.blockClass,this.blockSelector,!1)||Q$(t,this.mirror)||!K1e(t,this.mirror)||(this.addedSet.has(t)?(uL(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&n===-1||A5(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[o5(n,o)]?uL(this.movedSet,t):this.removes.push({parentId:o,id:n,isShadow:FC(e.target)&&PC(e.target)?!0:void 0})),this.mapRemoves.push(t))});break}}},this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!(this.addedSet.has(e)||this.movedSet.has(e))){if(this.mirror.hasNode(e)){if(Q$(e,this.mirror))return;this.movedSet.add(e);let n=null;t&&this.mirror.hasNode(t)&&(n=this.mirror.getId(t)),n&&n!==-1&&(this.movedMap[o5(this.mirror.getId(e),n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);Hs(e,this.blockClass,this.blockSelector,!1)||(e.childNodes.forEach(n=>this.genAdds(n)),iL(e)&&e.shadowRoot.childNodes.forEach(n=>{this.processedNodeManager.add(n,this),this.genAdds(n,e)}))}}}init(e){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(t=>{this[t]=e[t]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}};function uL(r,e){r.delete(e),e.childNodes.forEach(t=>uL(r,t))}function s5(r,e,t){return r.length===0?!1:P5(r,e,t)}function P5(r,e,t){let{parentNode:n}=e;if(!n)return!1;let o=t.getId(n);return r.some(s=>s.id===o)?!0:P5(r,n,t)}function i5(r,e){return r.size===0?!1:$5(r,e)}function $5(r,e){let{parentNode:t}=e;return t?r.has(t)?!0:$5(r,t):!1}var $C;function Q1e(r){$C=r}function J1e(){$C=void 0}var kr=r=>$C?(...t)=>{try{return r(...t)}catch(n){if($C&&$C(n)===!0)return;throw n}}:r,Sg=[];function WC(r){try{if("composedPath"in r){let e=r.composedPath();if(e.length)return e[0]}else if("path"in r&&r.path.length)return r.path[0]}catch{}return r&&r.target}function L5(r,e){var t,n;let o=new lL;Sg.push(o),o.init(r);let s=window.MutationObserver||window.__rrMutationObserver,i=(n=(t=window?.Zone)===null||t===void 0?void 0:t.__symbol__)===null||n===void 0?void 0:n.call(t,"MutationObserver");i&&window[i]&&(s=window[i]);let a=new s(kr(o.processMutations.bind(o)));return a.observe(e,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),a}function eke({mousemoveCb:r,sampling:e,doc:t,mirror:n}){if(e.mousemove===!1)return()=>{};let o=typeof e.mousemove=="number"?e.mousemove:50,s=typeof e.mousemoveCallback=="number"?e.mousemoveCallback:500,i=[],a,c=zC(kr(p=>{let d=Date.now()-a;r(i.map(h=>(h.timeOffset-=d,h)),p),i=[],a=null}),s),l=kr(zC(kr(p=>{let d=WC(p),{clientX:h,clientY:f}=sL(p)?p.changedTouches[0]:p;a||(a=V1()),i.push({x:h,y:f,id:n.getId(d),timeOffset:V1()-a}),c(typeof DragEvent<"u"&&p instanceof DragEvent?wr.Drag:p instanceof MouseEvent?wr.MouseMove:wr.TouchMove)}),o,{trailing:!1})),u=[js("mousemove",l,t),js("touchmove",l,t),js("drag",l,t)];return kr(()=>{u.forEach(p=>p())})}function tke({mouseInteractionCb:r,doc:e,mirror:t,blockClass:n,blockSelector:o,sampling:s}){if(s.mouseInteraction===!1)return()=>{};let i=s.mouseInteraction===!0||s.mouseInteraction===void 0?{}:s.mouseInteraction,a=[],c=null,l=u=>p=>{let d=WC(p);if(Hs(d,n,o,!0))return;let h=null,f=u;if("pointerType"in p){switch(p.pointerType){case"mouse":h=cd.Mouse;break;case"touch":h=cd.Touch;break;case"pen":h=cd.Pen;break}h===cd.Touch?Ii[u]===Ii.MouseDown?f="TouchStart":Ii[u]===Ii.MouseUp&&(f="TouchEnd"):cd.Pen}else sL(p)&&(h=cd.Touch);h!==null?(c=h,(f.startsWith("Touch")&&h===cd.Touch||f.startsWith("Mouse")&&h===cd.Mouse)&&(h=null)):Ii[u]===Ii.Click&&(h=c,c=null);let m=sL(p)?p.changedTouches[0]:p;if(!m)return;let g=t.getId(d),{clientX:y,clientY:x}=m;kr(r)(Object.assign({type:Ii[f],id:g,x:y,y:x},h!==null&&{pointerType:h}))};return Object.keys(Ii).filter(u=>Number.isNaN(Number(u))&&!u.endsWith("_Departed")&&i[u]!==!1).forEach(u=>{let p=Tg(u),d=l(u);if(window.PointerEvent)switch(Ii[u]){case Ii.MouseDown:case Ii.MouseUp:p=p.replace("mouse","pointer");break;case Ii.TouchStart:case Ii.TouchEnd:return}a.push(js(p,d,e))}),kr(()=>{a.forEach(u=>u())})}function V5({scrollCb:r,doc:e,mirror:t,blockClass:n,blockSelector:o,sampling:s}){let i=kr(zC(kr(a=>{let c=WC(a);if(!c||Hs(c,n,o,!0))return;let l=t.getId(c);if(c===e&&e.defaultView){let u=k5(e.defaultView);r({id:l,x:u.left,y:u.top})}else r({id:l,x:c.scrollLeft,y:c.scrollTop})}),s.scroll||100));return js("scroll",i,e)}function rke({viewportResizeCb:r},{win:e}){let t=-1,n=-1,o=kr(zC(kr(()=>{let s=E5(),i=N5();(t!==s||n!==i)&&(r({width:Number(i),height:Number(s)}),t=s,n=i)}),200));return js("resize",o,e)}var nke=["INPUT","TEXTAREA","SELECT"],a5=new WeakMap;function oke({inputCb:r,doc:e,mirror:t,blockClass:n,blockSelector:o,ignoreClass:s,ignoreSelector:i,maskInputOptions:a,maskInputFn:c,sampling:l,userTriggeredOnInput:u}){function p(x){let b=WC(x),w=x.isTrusted,_=b&&b.tagName;if(b&&_==="OPTION"&&(b=b.parentElement),!b||!_||nke.indexOf(_)<0||Hs(b,n,o,!0)||b.classList.contains(s)||i&&b.matches(i))return;let I=b.value,S=!1,k=vL(b)||"";k==="radio"||k==="checkbox"?S=b.checked:(a[_.toLowerCase()]||a[k])&&(I=xL({element:b,maskInputOptions:a,tagName:_,type:k,value:I,maskInputFn:c})),d(b,u?{text:I,isChecked:S,userTriggered:w}:{text:I,isChecked:S});let R=b.name;k==="radio"&&R&&S&&e.querySelectorAll(`input[type="radio"][name="${R}"]`).forEach(L=>{if(L!==b){let B=L.value;d(L,u?{text:B,isChecked:!S,userTriggered:!1}:{text:B,isChecked:!S})}})}function d(x,b){let w=a5.get(x);if(!w||w.text!==b.text||w.isChecked!==b.isChecked){a5.set(x,b);let _=t.getId(x);kr(r)(Object.assign(Object.assign({},b),{id:_}))}}let f=(l.input==="last"?["change"]:["input","change"]).map(x=>js(x,kr(p),e)),m=e.defaultView;if(!m)return()=>{f.forEach(x=>x())};let g=m.Object.getOwnPropertyDescriptor(m.HTMLInputElement.prototype,"value"),y=[[m.HTMLInputElement.prototype,"value"],[m.HTMLInputElement.prototype,"checked"],[m.HTMLSelectElement.prototype,"value"],[m.HTMLTextAreaElement.prototype,"value"],[m.HTMLSelectElement.prototype,"selectedIndex"],[m.HTMLOptionElement.prototype,"selected"]];return g&&g.set&&f.push(...y.map(x=>X1(x[0],x[1],{set(){kr(p)({target:this,isTrusted:!1})}},!1,m))),kr(()=>{f.forEach(x=>x())})}function B1(r){let e=[];function t(n,o){if(D1("CSSGroupingRule")&&n.parentRule instanceof CSSGroupingRule||D1("CSSMediaRule")&&n.parentRule instanceof CSSMediaRule||D1("CSSSupportsRule")&&n.parentRule instanceof CSSSupportsRule||D1("CSSConditionRule")&&n.parentRule instanceof CSSConditionRule){let i=Array.from(n.parentRule.cssRules).indexOf(n);o.unshift(i)}else if(n.parentStyleSheet){let i=Array.from(n.parentStyleSheet.cssRules).indexOf(n);o.unshift(i)}return o}return t(r,e)}function Ah(r,e,t){let n,o;return r?(r.ownerNode?n=e.getId(r.ownerNode):o=t.getId(r),{styleId:o,id:n}):{}}function ske({styleSheetRuleCb:r,mirror:e,stylesheetManager:t},{win:n}){if(!n.CSSStyleSheet||!n.CSSStyleSheet.prototype)return()=>{};let o=n.CSSStyleSheet.prototype.insertRule;n.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:kr((u,p,d)=>{let[h,f]=d,{id:m,styleId:g}=Ah(p,e,t.styleMirror);return(m&&m!==-1||g&&g!==-1)&&r({id:m,styleId:g,adds:[{rule:h,index:f}]}),u.apply(p,d)})});let s=n.CSSStyleSheet.prototype.deleteRule;n.CSSStyleSheet.prototype.deleteRule=new Proxy(s,{apply:kr((u,p,d)=>{let[h]=d,{id:f,styleId:m}=Ah(p,e,t.styleMirror);return(f&&f!==-1||m&&m!==-1)&&r({id:f,styleId:m,removes:[{index:h}]}),u.apply(p,d)})});let i;n.CSSStyleSheet.prototype.replace&&(i=n.CSSStyleSheet.prototype.replace,n.CSSStyleSheet.prototype.replace=new Proxy(i,{apply:kr((u,p,d)=>{let[h]=d,{id:f,styleId:m}=Ah(p,e,t.styleMirror);return(f&&f!==-1||m&&m!==-1)&&r({id:f,styleId:m,replace:h}),u.apply(p,d)})}));let a;n.CSSStyleSheet.prototype.replaceSync&&(a=n.CSSStyleSheet.prototype.replaceSync,n.CSSStyleSheet.prototype.replaceSync=new Proxy(a,{apply:kr((u,p,d)=>{let[h]=d,{id:f,styleId:m}=Ah(p,e,t.styleMirror);return(f&&f!==-1||m&&m!==-1)&&r({id:f,styleId:m,replaceSync:h}),u.apply(p,d)})}));let c={};A1("CSSGroupingRule")?c.CSSGroupingRule=n.CSSGroupingRule:(A1("CSSMediaRule")&&(c.CSSMediaRule=n.CSSMediaRule),A1("CSSConditionRule")&&(c.CSSConditionRule=n.CSSConditionRule),A1("CSSSupportsRule")&&(c.CSSSupportsRule=n.CSSSupportsRule));let l={};return Object.entries(c).forEach(([u,p])=>{l[u]={insertRule:p.prototype.insertRule,deleteRule:p.prototype.deleteRule},p.prototype.insertRule=new Proxy(l[u].insertRule,{apply:kr((d,h,f)=>{let[m,g]=f,{id:y,styleId:x}=Ah(h.parentStyleSheet,e,t.styleMirror);return(y&&y!==-1||x&&x!==-1)&&r({id:y,styleId:x,adds:[{rule:m,index:[...B1(h),g||0]}]}),d.apply(h,f)})}),p.prototype.deleteRule=new Proxy(l[u].deleteRule,{apply:kr((d,h,f)=>{let[m]=f,{id:g,styleId:y}=Ah(h.parentStyleSheet,e,t.styleMirror);return(g&&g!==-1||y&&y!==-1)&&r({id:g,styleId:y,removes:[{index:[...B1(h),m]}]}),d.apply(h,f)})})}),kr(()=>{n.CSSStyleSheet.prototype.insertRule=o,n.CSSStyleSheet.prototype.deleteRule=s,i&&(n.CSSStyleSheet.prototype.replace=i),a&&(n.CSSStyleSheet.prototype.replaceSync=a),Object.entries(c).forEach(([u,p])=>{p.prototype.insertRule=l[u].insertRule,p.prototype.deleteRule=l[u].deleteRule})})}function B5({mirror:r,stylesheetManager:e},t){var n,o,s;let i=null;t.nodeName==="#document"?i=r.getId(t):i=r.getId(t.host);let a=t.nodeName==="#document"?(n=t.defaultView)===null||n===void 0?void 0:n.Document:(s=(o=t.ownerDocument)===null||o===void 0?void 0:o.defaultView)===null||s===void 0?void 0:s.ShadowRoot,c=a?.prototype?Object.getOwnPropertyDescriptor(a?.prototype,"adoptedStyleSheets"):void 0;return i===null||i===-1||!a||!c?()=>{}:(Object.defineProperty(t,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get(){var l;return(l=c.get)===null||l===void 0?void 0:l.call(this)},set(l){var u;let p=(u=c.set)===null||u===void 0?void 0:u.call(this,l);if(i!==null&&i!==-1)try{e.adoptStyleSheets(l,i)}catch{}return p}}),kr(()=>{Object.defineProperty(t,"adoptedStyleSheets",{configurable:c.configurable,enumerable:c.enumerable,get:c.get,set:c.set})}))}function ike({styleDeclarationCb:r,mirror:e,ignoreCSSAttributes:t,stylesheetManager:n},{win:o}){let s=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(s,{apply:kr((a,c,l)=>{var u;let[p,d,h]=l;if(t.has(p))return s.apply(c,[p,d,h]);let{id:f,styleId:m}=Ah((u=c.parentRule)===null||u===void 0?void 0:u.parentStyleSheet,e,n.styleMirror);return(f&&f!==-1||m&&m!==-1)&&r({id:f,styleId:m,set:{property:p,value:d,priority:h},index:B1(c.parentRule)}),a.apply(c,l)})});let i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(i,{apply:kr((a,c,l)=>{var u;let[p]=l;if(t.has(p))return i.apply(c,[p]);let{id:d,styleId:h}=Ah((u=c.parentRule)===null||u===void 0?void 0:u.parentStyleSheet,e,n.styleMirror);return(d&&d!==-1||h&&h!==-1)&&r({id:d,styleId:h,remove:{property:p},index:B1(c.parentRule)}),a.apply(c,l)})}),kr(()=>{o.CSSStyleDeclaration.prototype.setProperty=s,o.CSSStyleDeclaration.prototype.removeProperty=i})}function ake({mediaInteractionCb:r,blockClass:e,blockSelector:t,mirror:n,sampling:o,doc:s}){let i=kr(c=>zC(kr(l=>{let u=WC(l);if(!u||Hs(u,e,t,!0))return;let{currentTime:p,volume:d,muted:h,playbackRate:f,loop:m}=u;r({type:c,id:n.getId(u),currentTime:p,volume:d,muted:h,playbackRate:f,loop:m})}),o.media||500)),a=[js("play",i(0),s),js("pause",i(1),s),js("seeked",i(2),s),js("volumechange",i(3),s),js("ratechange",i(4),s)];return kr(()=>{a.forEach(c=>c())})}function cke({fontCb:r,doc:e}){let t=e.defaultView;if(!t)return()=>{};let n=[],o=new WeakMap,s=t.FontFace;t.FontFace=function(c,l,u){let p=new s(c,l,u);return o.set(p,{family:c,buffer:typeof l!="string",descriptors:u,fontSource:typeof l=="string"?l:JSON.stringify(Array.from(new Uint8Array(l)))}),p};let i=av(e.fonts,"add",function(a){return function(c){return setTimeout(kr(()=>{let l=o.get(c);l&&(r(l),o.delete(c))}),0),a.apply(this,[c])}});return n.push(()=>{t.FontFace=s}),n.push(i),kr(()=>{n.forEach(a=>a())})}function lke(r){let{doc:e,mirror:t,blockClass:n,blockSelector:o,selectionCb:s}=r,i=!0,a=kr(()=>{let c=e.getSelection();if(!c||i&&c?.isCollapsed)return;i=c.isCollapsed||!1;let l=[],u=c.rangeCount||0;for(let p=0;p<u;p++){let d=c.getRangeAt(p),{startContainer:h,startOffset:f,endContainer:m,endOffset:g}=d;Hs(h,n,o,!0)||Hs(m,n,o,!0)||l.push({start:t.getId(h),startOffset:f,end:t.getId(m),endOffset:g})}s({ranges:l})});return a(),js("selectionchange",a)}function uke({doc:r,customElementCb:e}){let t=r.defaultView;return!t||!t.customElements?()=>{}:av(t.customElements,"define",function(o){return function(s,i,a){try{e({define:{name:s}})}catch{console.warn(`Custom element callback failed for ${s}`)}return o.apply(this,[s,i,a])}})}function pke(r,e){let{mutationCb:t,mousemoveCb:n,mouseInteractionCb:o,scrollCb:s,viewportResizeCb:i,inputCb:a,mediaInteractionCb:c,styleSheetRuleCb:l,styleDeclarationCb:u,canvasMutationCb:p,fontCb:d,selectionCb:h,customElementCb:f}=r;r.mutationCb=(...m)=>{e.mutation&&e.mutation(...m),t(...m)},r.mousemoveCb=(...m)=>{e.mousemove&&e.mousemove(...m),n(...m)},r.mouseInteractionCb=(...m)=>{e.mouseInteraction&&e.mouseInteraction(...m),o(...m)},r.scrollCb=(...m)=>{e.scroll&&e.scroll(...m),s(...m)},r.viewportResizeCb=(...m)=>{e.viewportResize&&e.viewportResize(...m),i(...m)},r.inputCb=(...m)=>{e.input&&e.input(...m),a(...m)},r.mediaInteractionCb=(...m)=>{e.mediaInteaction&&e.mediaInteaction(...m),c(...m)},r.styleSheetRuleCb=(...m)=>{e.styleSheetRule&&e.styleSheetRule(...m),l(...m)},r.styleDeclarationCb=(...m)=>{e.styleDeclaration&&e.styleDeclaration(...m),u(...m)},r.canvasMutationCb=(...m)=>{e.canvasMutation&&e.canvasMutation(...m),p(...m)},r.fontCb=(...m)=>{e.font&&e.font(...m),d(...m)},r.selectionCb=(...m)=>{e.selection&&e.selection(...m),h(...m)},r.customElementCb=(...m)=>{e.customElement&&e.customElement(...m),f(...m)}}function dke(r,e={}){let t=r.doc.defaultView;if(!t)return()=>{};pke(r,e);let n;r.recordDOM&&(n=L5(r,r.doc));let o=eke(r),s=tke(r),i=V5(r),a=rke(r,{win:t}),c=oke(r),l=ake(r),u=()=>{},p=()=>{},d=()=>{},h=()=>{};r.recordDOM&&(u=ske(r,{win:t}),p=B5(r,r.doc),d=ike(r,{win:t}),r.collectFonts&&(h=cke(r)));let f=lke(r),m=uke(r),g=[];for(let y of r.plugins)g.push(y.observer(y.callback,t,y.options));return kr(()=>{Sg.forEach(y=>y.reset()),n?.disconnect(),o(),s(),i(),a(),c(),l(),u(),p(),d(),h(),f(),m(),g.forEach(y=>y())})}function D1(r){return typeof window[r]<"u"}function A1(r){return!!(typeof window[r]<"u"&&window[r].prototype&&"insertRule"in window[r].prototype&&"deleteRule"in window[r].prototype)}var z1=class{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,n,o){let s=n||this.getIdToRemoteIdMap(e),i=o||this.getRemoteIdToIdMap(e),a=s.get(t);return a||(a=this.generateIdFn(),s.set(t,a),i.set(a,t)),a}getIds(e,t){let n=this.getIdToRemoteIdMap(e),o=this.getRemoteIdToIdMap(e);return t.map(s=>this.getId(e,s,n,o))}getRemoteId(e,t,n){let o=n||this.getRemoteIdToIdMap(e);if(typeof t!="number")return t;let s=o.get(t);return s||-1}getRemoteIds(e,t){let n=this.getRemoteIdToIdMap(e);return t.map(o=>this.getRemoteId(e,o,n))}reset(e){if(!e){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}},pL=class{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new z1(_5),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new z1(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){var n;this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),(n=this.loadListener)===null||n===void 0||n.call(this,e),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){let t=e;if(t.data.type!=="rrweb"||t.origin!==t.data.origin||!e.source)return;let o=this.crossOriginIframeMap.get(e.source);if(!o)return;let s=this.transformCrossOriginEvent(o,t.data.event);s&&this.wrappedEmit(s,t.data.isCheckout)}transformCrossOriginEvent(e,t){var n;switch(t.type){case Ar.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e);let o=t.data.node.id;return this.crossOriginIframeRootIdMap.set(e,o),this.patchRootIdOnNode(t.data.node,o),{timestamp:t.timestamp,type:Ar.IncrementalSnapshot,data:{source:wr.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case Ar.Meta:case Ar.Load:case Ar.DomContentLoaded:return!1;case Ar.Plugin:return t;case Ar.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case Ar.IncrementalSnapshot:switch(t.data.source){case wr.Mutation:return t.data.adds.forEach(o=>{this.replaceIds(o,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(o.node,e);let s=this.crossOriginIframeRootIdMap.get(e);s&&this.patchRootIdOnNode(o.node,s)}),t.data.removes.forEach(o=>{this.replaceIds(o,e,["parentId","id"])}),t.data.attributes.forEach(o=>{this.replaceIds(o,e,["id"])}),t.data.texts.forEach(o=>{this.replaceIds(o,e,["id"])}),t;case wr.Drag:case wr.TouchMove:case wr.MouseMove:return t.data.positions.forEach(o=>{this.replaceIds(o,e,["id"])}),t;case wr.ViewportResize:return!1;case wr.MediaInteraction:case wr.MouseInteraction:case wr.Scroll:case wr.CanvasMutation:case wr.Input:return this.replaceIds(t.data,e,["id"]),t;case wr.StyleSheetRule:case wr.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case wr.Font:return t;case wr.Selection:return t.data.ranges.forEach(o=>{this.replaceIds(o,e,["start","end"])}),t;case wr.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),(n=t.data.styles)===null||n===void 0||n.forEach(o=>{this.replaceStyleIds(o,e,["styleId"])}),t}}return!1}replace(e,t,n,o){for(let s of o)!Array.isArray(t[s])&&typeof t[s]!="number"||(Array.isArray(t[s])?t[s]=e.getIds(n,t[s]):t[s]=e.getId(n,t[s]));return t}replaceIds(e,t,n){return this.replace(this.crossOriginIframeMirror,e,t,n)}replaceStyleIds(e,t,n){return this.replace(this.crossOriginIframeStyleMirror,e,t,n)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach(n=>{this.replaceIdOnNode(n,t)})}patchRootIdOnNode(e,t){e.type!==Vo.Document&&!e.rootId&&(e.rootId=t),"childNodes"in e&&e.childNodes.forEach(n=>{this.patchRootIdOnNode(n,t)})}},dL=class{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!PC(e)||this.shadowDoms.has(e))return;this.shadowDoms.add(e);let n=L5(Object.assign(Object.assign({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e);this.restoreHandlers.push(()=>n.disconnect()),this.restoreHandlers.push(V5(Object.assign(Object.assign({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror}))),setTimeout(()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(B5({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))},0)}observeAttachShadow(e){!e.contentWindow||!e.contentDocument||this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,t){let n=this;this.restoreHandlers.push(av(e.prototype,"attachShadow",function(o){return function(s){let i=o.call(this,s);return this.shadowRoot&&F5(this)&&n.addShadowRoot(this.shadowRoot,t),i}}))}reset(){this.restoreHandlers.forEach(e=>{try{e()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}};function hke(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t}function fke(r,e,t,n){function o(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{l(n.next(u))}catch(p){i(p)}}function c(u){try{l(n.throw(u))}catch(p){i(p)}}function l(u){u.done?s(u.value):o(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}var tv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mke=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(MC=0;MC<tv.length;MC++)mke[tv.charCodeAt(MC)]=MC;var MC,gke=function(r){var e=new Uint8Array(r),t,n=e.length,o="";for(t=0;t<n;t+=3)o+=tv[e[t]>>2],o+=tv[(e[t]&3)<<4|e[t+1]>>4],o+=tv[(e[t+1]&15)<<2|e[t+2]>>6],o+=tv[e[t+2]&63];return n%3===2?o=o.substring(0,o.length-1)+"=":n%3===1&&(o=o.substring(0,o.length-2)+"=="),o},c5=new Map;function yke(r,e){let t=c5.get(r);return t||(t=new Map,c5.set(r,t)),t.has(e)||t.set(e,[]),t.get(e)}var z5=(r,e,t)=>{if(!r||!(G5(r,e)||typeof r=="object"))return;let n=r.constructor.name,o=yke(t,n),s=o.indexOf(r);return s===-1&&(s=o.length,o.push(r)),s};function O1(r,e,t){if(r instanceof Array)return r.map(n=>O1(n,e,t));if(r===null)return r;if(r instanceof Float32Array||r instanceof Float64Array||r instanceof Int32Array||r instanceof Uint32Array||r instanceof Uint8Array||r instanceof Uint16Array||r instanceof Int16Array||r instanceof Int8Array||r instanceof Uint8ClampedArray)return{rr_type:r.constructor.name,args:[Object.values(r)]};if(r instanceof ArrayBuffer){let n=r.constructor.name,o=gke(r);return{rr_type:n,base64:o}}else{if(r instanceof DataView)return{rr_type:r.constructor.name,args:[O1(r.buffer,e,t),r.byteOffset,r.byteLength]};if(r instanceof HTMLImageElement){let n=r.constructor.name,{src:o}=r;return{rr_type:n,src:o}}else if(r instanceof HTMLCanvasElement){let n="HTMLImageElement",o=r.toDataURL();return{rr_type:n,src:o}}else{if(r instanceof ImageData)return{rr_type:r.constructor.name,args:[O1(r.data,e,t),r.width,r.height]};if(G5(r,e)||typeof r=="object"){let n=r.constructor.name,o=z5(r,e,t);return{rr_type:n,index:o}}}}return r}var U5=(r,e,t)=>r.map(n=>O1(n,e,t)),G5=(r,e)=>!!["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(o=>typeof e[o]=="function").find(o=>r instanceof e[o]);function xke(r,e,t,n){let o=[],s=Object.getOwnPropertyNames(e.CanvasRenderingContext2D.prototype);for(let i of s)try{if(typeof e.CanvasRenderingContext2D.prototype[i]!="function")continue;let a=av(e.CanvasRenderingContext2D.prototype,i,function(c){return function(...l){return Hs(this.canvas,t,n,!0)||setTimeout(()=>{let u=U5(l,e,this);r(this.canvas,{type:ov["2D"],property:i,args:u})},0),c.apply(this,l)}});o.push(a)}catch{let c=X1(e.CanvasRenderingContext2D.prototype,i,{set(l){r(this.canvas,{type:ov["2D"],property:i,args:[l],setter:!0})}});o.push(c)}return()=>{o.forEach(i=>i())}}function vke(r){return r==="experimental-webgl"?"webgl":r}function l5(r,e,t,n){let o=[];try{let s=av(r.HTMLCanvasElement.prototype,"getContext",function(i){return function(a,...c){if(!Hs(this,e,t,!0)){let l=vke(a);if("__context"in this||(this.__context=l),n&&["webgl","webgl2"].includes(l))if(c[0]&&typeof c[0]=="object"){let u=c[0];u.preserveDrawingBuffer||(u.preserveDrawingBuffer=!0)}else c.splice(0,1,{preserveDrawingBuffer:!0})}return i.apply(this,[a,...c])}});o.push(s)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{o.forEach(s=>s())}}function u5(r,e,t,n,o,s,i){let a=[],c=Object.getOwnPropertyNames(r);for(let l of c)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(l))try{if(typeof r[l]!="function")continue;let u=av(r,l,function(p){return function(...d){let h=p.apply(this,d);if(z5(h,i,this),"tagName"in this.canvas&&!Hs(this.canvas,n,o,!0)){let f=U5(d,i,this),m={type:e,property:l,args:f};t(this.canvas,m)}return h}});a.push(u)}catch{let p=X1(r,l,{set(d){t(this.canvas,{type:e,property:l,args:[d],setter:!0})}});a.push(p)}return a}function bke(r,e,t,n,o){let s=[];return s.push(...u5(e.WebGLRenderingContext.prototype,ov.WebGL,r,t,n,o,e)),typeof e.WebGL2RenderingContext<"u"&&s.push(...u5(e.WebGL2RenderingContext.prototype,ov.WebGL2,r,t,n,o,e)),()=>{s.forEach(i=>i())}}function wke(r,e){var t=e===void 0?null:e,n=r.toString(),o=n.split(`
`);o.pop(),o.shift();for(var s=o[0].search(/\S/),i=/(['"])__worker_loader_strict__(['"])/g,a=0,c=o.length;a<c;++a)o[a]=o[a].substring(s).replace(i,"$1use strict$2")+`
`;return t&&o.push("//# sourceMappingURL="+t+`
`),o}function Cke(r,e){var t=wke(r,e),n=new Blob(t,{type:"application/javascript"});return URL.createObjectURL(n)}function _ke(r,e){var t;return function(o){return t=t||Cke(r,e),new Worker(t,o)}}var Ske=_ke(function(){(function(){"__worker_loader_strict__";function r(l,u,p,d){function h(f){return f instanceof p?f:new p(function(m){m(f)})}return new(p||(p=Promise))(function(f,m){function g(b){try{x(d.next(b))}catch(w){m(w)}}function y(b){try{x(d.throw(b))}catch(w){m(w)}}function x(b){b.done?f(b.value):h(b.value).then(g,y)}x((d=d.apply(l,u||[])).next())})}for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=typeof Uint8Array>"u"?[]:new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;var o=function(l){var u=new Uint8Array(l),p,d=u.length,h="";for(p=0;p<d;p+=3)h+=e[u[p]>>2],h+=e[(u[p]&3)<<4|u[p+1]>>4],h+=e[(u[p+1]&15)<<2|u[p+2]>>6],h+=e[u[p+2]&63];return d%3===2?h=h.substring(0,h.length-1)+"=":d%3===1&&(h=h.substring(0,h.length-2)+"=="),h};let s=new Map,i=new Map;function a(l,u,p){return r(this,void 0,void 0,function*(){let d=`${l}-${u}`;if("OffscreenCanvas"in globalThis){if(i.has(d))return i.get(d);let h=new OffscreenCanvas(l,u);h.getContext("2d");let m=yield(yield h.convertToBlob(p)).arrayBuffer(),g=o(m);return i.set(d,g),g}else return""})}let c=self;c.onmessage=function(l){return r(this,void 0,void 0,function*(){if("OffscreenCanvas"in globalThis){let{id:u,bitmap:p,width:d,height:h,dataURLOptions:f}=l.data,m=a(d,h,f),g=new OffscreenCanvas(d,h);g.getContext("2d").drawImage(p,0,0),p.close();let x=yield g.convertToBlob(f),b=x.type,w=yield x.arrayBuffer(),_=o(w);if(!s.has(u)&&(yield m)===_)return s.set(u,_),c.postMessage({id:u});if(s.get(u)===_)return c.postMessage({id:u});c.postMessage({id:u,type:b,base64:_,width:d,height:h}),s.set(u,_)}else return c.postMessage({id:l.data.id})})}})()},null),hL=class{reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}constructor(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(c,l)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(c)||this.pendingCanvasMutations.set(c,[]),this.pendingCanvasMutations.get(c).push(l)};let{sampling:t="all",win:n,blockClass:o,blockSelector:s,recordCanvas:i,dataURLOptions:a}=e;this.mutationCb=e.mutationCb,this.mirror=e.mirror,i&&t==="all"&&this.initCanvasMutationObserver(n,o,s),i&&typeof t=="number"&&this.initCanvasFPSObserver(t,n,o,s,{dataURLOptions:a})}initCanvasFPSObserver(e,t,n,o,s){let i=l5(t,n,o,!0),a=new Map,c=new Ske;c.onmessage=f=>{let{id:m}=f.data;if(a.set(m,!1),!("base64"in f.data))return;let{base64:g,type:y,width:x,height:b}=f.data;this.mutationCb({id:m,type:ov["2D"],commands:[{property:"clearRect",args:[0,0,x,b]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:g}],type:y}]},0,0]}]})};let l=1e3/e,u=0,p,d=()=>{let f=[];return t.document.querySelectorAll("canvas").forEach(m=>{Hs(m,n,o,!0)||f.push(m)}),f},h=f=>{if(u&&f-u<l){p=requestAnimationFrame(h);return}u=f,d().forEach(m=>fke(this,void 0,void 0,function*(){var g;let y=this.mirror.getId(m);if(a.get(y)||m.width===0||m.height===0)return;if(a.set(y,!0),["webgl","webgl2"].includes(m.__context)){let b=m.getContext(m.__context);((g=b?.getContextAttributes())===null||g===void 0?void 0:g.preserveDrawingBuffer)===!1&&b.clear(b.COLOR_BUFFER_BIT)}let x=yield createImageBitmap(m);c.postMessage({id:y,bitmap:x,width:m.width,height:m.height,dataURLOptions:s.dataURLOptions},[x])})),p=requestAnimationFrame(h)};p=requestAnimationFrame(h),this.resetObservers=()=>{i(),cancelAnimationFrame(p)}}initCanvasMutationObserver(e,t,n){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();let o=l5(e,t,n,!1),s=xke(this.processMutation.bind(this),e,t,n),i=bke(this.processMutation.bind(this),e,t,n,this.mirror);this.resetObservers=()=>{o(),s(),i()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){let e=t=>{this.rafStamps.latestId=t,requestAnimationFrame(e)};requestAnimationFrame(e)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((e,t)=>{let n=this.mirror.getId(t);this.flushPendingCanvasMutationFor(t,n)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(e,t){if(this.frozen||this.locked)return;let n=this.pendingCanvasMutations.get(e);if(!n||t===-1)return;let o=n.map(i=>hke(i,["type"])),{type:s}=n[0];this.mutationCb({id:t,type:s,commands:o}),this.pendingCanvasMutations.delete(e)}},fL=class{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new aL,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(e.length===0)return;let n={id:t,styleIds:[]},o=[];for(let s of e){let i;this.styleMirror.has(s)?i=this.styleMirror.getId(s):(i=this.styleMirror.add(s),o.push({styleId:i,rules:Array.from(s.rules||CSSRule,(a,c)=>({rule:w5(a),index:c}))})),n.styleIds.push(i)}o.length>0&&(n.styles=o),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}},mL=class{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){requestAnimationFrame(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(e,t){let n=this.nodeMap.get(e);return n&&Array.from(n).some(o=>o!==t)}add(e,t){this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}};function wo(r){return Object.assign(Object.assign({},r),{timestamp:V1()})}var Xn,M1,J$,U1=!1,bc=I1e();function jC(r={}){let{emit:e,checkoutEveryNms:t,checkoutEveryNth:n,blockClass:o="rr-block",blockSelector:s=null,ignoreClass:i="rr-ignore",ignoreSelector:a=null,maskTextClass:c="rr-mask",maskTextSelector:l=null,inlineStylesheet:u=!0,maskAllInputs:p,maskInputOptions:d,slimDOMOptions:h,maskInputFn:f,maskTextFn:m,hooks:g,packFn:y,sampling:x={},dataURLOptions:b={},mousemoveWait:w,recordDOM:_=!0,recordCanvas:I=!1,recordCrossOriginIframes:S=!1,recordAfter:k=r.recordAfter==="DOMContentLoaded"?r.recordAfter:"load",userTriggeredOnInput:R=!1,collectFonts:L=!1,inlineImages:B=!1,plugins:z,keepIframeSrcFn:q=()=>!1,ignoreCSSAttributes:U=new Set([]),errorHandler:G}=r;Q1e(G);let j=S?window.parent===window:!0,X=!1;if(!j)try{window.parent.document&&(X=!1)}catch{X=!0}if(j&&!e)throw new Error("emit function is required");w!==void 0&&x.mousemove===void 0&&(x.mousemove=w),bc.reset();let te=p===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:d!==void 0?d:{password:!0},ne=h===!0||h==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:h==="all",headMetaDescKeywords:h==="all"}:h||{};X1e();let oe,le=0,xe=Me=>{for(let dt of z||[])dt.eventProcessor&&(Me=dt.eventProcessor(Me));return y&&!X&&(Me=y(Me)),Me};Xn=(Me,dt)=>{var Be;if(!((Be=Sg[0])===null||Be===void 0)&&Be.isFrozen()&&Me.type!==Ar.FullSnapshot&&!(Me.type===Ar.IncrementalSnapshot&&Me.data.source===wr.Mutation)&&Sg.forEach(at=>at.unfreeze()),j)e?.(xe(Me),dt);else if(X){let at={type:"rrweb",event:xe(Me),origin:window.location.origin,isCheckout:dt};window.parent.postMessage(at,"*")}if(Me.type===Ar.FullSnapshot)oe=Me,le=0;else if(Me.type===Ar.IncrementalSnapshot){if(Me.data.source===wr.Mutation&&Me.data.isAttachIframe)return;le++;let at=n&&le>=n,_e=t&&Me.timestamp-oe.timestamp>t;(at||_e)&&M1(!0)}};let ge=Me=>{Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.Mutation},Me)}))},Re=Me=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.Scroll},Me)})),Ee=Me=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.CanvasMutation},Me)})),Ne=Me=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.AdoptedStyleSheet},Me)})),we=new fL({mutationCb:ge,adoptedStyleSheetCb:Ne}),qe=new pL({mirror:bc,mutationCb:ge,stylesheetManager:we,recordCrossOriginIframes:S,wrappedEmit:Xn});for(let Me of z||[])Me.getMirror&&Me.getMirror({nodeMirror:bc,crossOriginIframeMirror:qe.crossOriginIframeMirror,crossOriginIframeStyleMirror:qe.crossOriginIframeStyleMirror});let Qe=new mL;J$=new hL({recordCanvas:I,mutationCb:Ee,win:window,blockClass:o,blockSelector:s,mirror:bc,sampling:x.canvas,dataURLOptions:b});let De=new dL({mutationCb:ge,scrollCb:Re,bypassOptions:{blockClass:o,blockSelector:s,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskInputOptions:te,dataURLOptions:b,maskTextFn:m,maskInputFn:f,recordCanvas:I,inlineImages:B,sampling:x,slimDOMOptions:ne,iframeManager:qe,stylesheetManager:we,canvasManager:J$,keepIframeSrcFn:q,processedNodeManager:Qe},mirror:bc});M1=(Me=!1)=>{if(!_)return;Xn(wo({type:Ar.Meta,data:{href:window.location.href,width:N5(),height:E5()}}),Me),we.reset(),De.init(),Sg.forEach(Be=>Be.lock());let dt=q1e(document,{mirror:bc,blockClass:o,blockSelector:s,maskTextClass:c,maskTextSelector:l,inlineStylesheet:u,maskAllInputs:te,maskTextFn:m,slimDOM:ne,dataURLOptions:b,recordCanvas:I,inlineImages:B,onSerialize:Be=>{R5(Be,bc)&&qe.addIframe(Be),O5(Be,bc)&&we.trackLinkElement(Be),iL(Be)&&De.addShadowRoot(Be.shadowRoot,document)},onIframeLoad:(Be,at)=>{qe.attachIframe(Be,at),De.observeAttachShadow(Be)},onStylesheetLoad:(Be,at)=>{we.attachLinkElement(Be,at)},keepIframeSrcFn:q});if(!dt)return console.warn("Failed to snapshot the document");Xn(wo({type:Ar.FullSnapshot,data:{node:dt,initialOffset:k5(window)}}),Me),Sg.forEach(Be=>Be.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&we.adoptStyleSheets(document.adoptedStyleSheets,bc.getId(document))};try{let Me=[],dt=at=>{var _e;return kr(dke)({mutationCb:ge,mousemoveCb:(Ae,wt)=>Xn(wo({type:Ar.IncrementalSnapshot,data:{source:wt,positions:Ae}})),mouseInteractionCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.MouseInteraction},Ae)})),scrollCb:Re,viewportResizeCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.ViewportResize},Ae)})),inputCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.Input},Ae)})),mediaInteractionCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.MediaInteraction},Ae)})),styleSheetRuleCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.StyleSheetRule},Ae)})),styleDeclarationCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.StyleDeclaration},Ae)})),canvasMutationCb:Ee,fontCb:Ae=>Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.Font},Ae)})),selectionCb:Ae=>{Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.Selection},Ae)}))},customElementCb:Ae=>{Xn(wo({type:Ar.IncrementalSnapshot,data:Object.assign({source:wr.CustomElement},Ae)}))},blockClass:o,ignoreClass:i,ignoreSelector:a,maskTextClass:c,maskTextSelector:l,maskInputOptions:te,inlineStylesheet:u,sampling:x,recordDOM:_,recordCanvas:I,inlineImages:B,userTriggeredOnInput:R,collectFonts:L,doc:at,maskInputFn:f,maskTextFn:m,keepIframeSrcFn:q,blockSelector:s,slimDOMOptions:ne,dataURLOptions:b,mirror:bc,iframeManager:qe,stylesheetManager:we,shadowDomManager:De,processedNodeManager:Qe,canvasManager:J$,ignoreCSSAttributes:U,plugins:((_e=z?.filter(Ae=>Ae.observer))===null||_e===void 0?void 0:_e.map(Ae=>({observer:Ae.observer,options:Ae.options,callback:wt=>Xn(wo({type:Ar.Plugin,data:{plugin:Ae.name,payload:wt}}))})))||[]},g)};qe.addLoadListener(at=>{try{Me.push(dt(at.contentDocument))}catch(_e){console.warn(_e)}});let Be=()=>{M1(),Me.push(dt(document)),U1=!0};return document.readyState==="interactive"||document.readyState==="complete"?Be():(Me.push(js("DOMContentLoaded",()=>{Xn(wo({type:Ar.DomContentLoaded,data:{}})),k==="DOMContentLoaded"&&Be()})),Me.push(js("load",()=>{Xn(wo({type:Ar.Load,data:{}})),k==="load"&&Be()},window))),()=>{Me.forEach(at=>at()),Qe.destroy(),U1=!1,J1e()}}catch(Me){console.warn(Me)}}jC.addCustomEvent=(r,e)=>{if(!U1)throw new Error("please add custom event after start recording");Xn(wo({type:Ar.Custom,data:{tag:r,payload:e}}))};jC.freezePage=()=>{Sg.forEach(r=>r.freeze())};jC.takeFullSnapshot=r=>{if(!U1)throw new Error("please take full snapshot after start recording");M1(r)};jC.mirror=bc;var W5=(r=>(r[r.DomContentLoaded=0]="DomContentLoaded",r[r.Load=1]="Load",r[r.FullSnapshot=2]="FullSnapshot",r[r.IncrementalSnapshot=3]="IncrementalSnapshot",r[r.Meta=4]="Meta",r[r.Custom=5]="Custom",r[r.Plugin=6]="Plugin",r))(W5||{}),du=(r=>(r[r.Mutation=0]="Mutation",r[r.MouseMove=1]="MouseMove",r[r.MouseInteraction=2]="MouseInteraction",r[r.Scroll=3]="Scroll",r[r.ViewportResize=4]="ViewportResize",r[r.Input=5]="Input",r[r.TouchMove=6]="TouchMove",r[r.MediaInteraction=7]="MediaInteraction",r[r.StyleSheetRule=8]="StyleSheetRule",r[r.CanvasMutation=9]="CanvasMutation",r[r.Font=10]="Font",r[r.Log=11]="Log",r[r.Drag=12]="Drag",r[r.StyleDeclaration=13]="StyleDeclaration",r[r.Selection=14]="Selection",r[r.AdoptedStyleSheet=15]="AdoptedStyleSheet",r[r.CustomElement=16]="CustomElement",r))(du||{}),ld={DEBUG:!1,LIB_VERSION:"2.55.1"},Ht;typeof window>"u"?(eL={hostname:""},Ht={navigator:{userAgent:"",onLine:!0},document:{location:eL,referrer:""},screen:{width:0,height:0},location:eL}):Ht=window;var eL,LC=24*60*60*1e3,tL=8*1e3,Y1=Array.prototype,Ike=Function.prototype,j5=Object.prototype,Rh=Y1.slice,HC=j5.toString,Z1=j5.hasOwnProperty,bo=Ht.console,Oh=Ht.navigator,pn=Ht.document,R1=Ht.opera,G1=Ht.screen,hu=Oh.userAgent,rL=Ike.bind,p5=Y1.forEach,d5=Y1.indexOf,h5=Y1.map,Tke=Array.isArray,gL={},V={trim:function(r){return r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},Gr={log:function(){if(ld.DEBUG&&!V.isUndefined(bo)&&bo)try{bo.log.apply(bo,arguments)}catch{V.each(arguments,function(e){bo.log(e)})}},warn:function(){if(ld.DEBUG&&!V.isUndefined(bo)&&bo){var r=["Mixpanel warning:"].concat(V.toArray(arguments));try{bo.warn.apply(bo,r)}catch{V.each(r,function(t){bo.warn(t)})}}},error:function(){if(ld.DEBUG&&!V.isUndefined(bo)&&bo){var r=["Mixpanel error:"].concat(V.toArray(arguments));try{bo.error.apply(bo,r)}catch{V.each(r,function(t){bo.error(t)})}}},critical:function(){if(!V.isUndefined(bo)&&bo){var r=["Mixpanel error:"].concat(V.toArray(arguments));try{bo.error.apply(bo,r)}catch{V.each(r,function(t){bo.error(t)})}}}},nL=function(r,e){return function(){return arguments[0]="["+e+"] "+arguments[0],r.apply(Gr,arguments)}},Q1=function(r){return{log:nL(Gr.log,r),error:nL(Gr.error,r),critical:nL(Gr.critical,r)}};V.bind=function(r,e){var t,n;if(rL&&r.bind===rL)return rL.apply(r,Rh.call(arguments,1));if(!V.isFunction(r))throw new TypeError;return t=Rh.call(arguments,2),n=function(){if(!(this instanceof n))return r.apply(e,t.concat(Rh.call(arguments)));var o={};o.prototype=r.prototype;var s=new o;o.prototype=null;var i=r.apply(s,t.concat(Rh.call(arguments)));return Object(i)===i?i:s},n};V.each=function(r,e,t){if(r!=null){if(p5&&r.forEach===p5)r.forEach(e,t);else if(r.length===+r.length){for(var n=0,o=r.length;n<o;n++)if(n in r&&e.call(t,r[n],n,r)===gL)return}else for(var s in r)if(Z1.call(r,s)&&e.call(t,r[s],s,r)===gL)return}};V.extend=function(r){return V.each(Rh.call(arguments,1),function(e){for(var t in e)e[t]!==void 0&&(r[t]=e[t])}),r};V.isArray=Tke||function(r){return HC.call(r)==="[object Array]"};V.isFunction=function(r){try{return/^\s*\bfunction\b/.test(r)}catch{return!1}};V.isArguments=function(r){return!!(r&&Z1.call(r,"callee"))};V.toArray=function(r){return r?r.toArray?r.toArray():V.isArray(r)||V.isArguments(r)?Rh.call(r):V.values(r):[]};V.map=function(r,e,t){if(h5&&r.map===h5)return r.map(e,t);var n=[];return V.each(r,function(o){n.push(e.call(t,o))}),n};V.keys=function(r){var e=[];return r===null||V.each(r,function(t,n){e[e.length]=n}),e};V.values=function(r){var e=[];return r===null||V.each(r,function(t){e[e.length]=t}),e};V.include=function(r,e){var t=!1;return r===null?t:d5&&r.indexOf===d5?r.indexOf(e)!=-1:(V.each(r,function(n){if(t||(t=n===e))return gL}),t)};V.includes=function(r,e){return r.indexOf(e)!==-1};V.inherit=function(r,e){return r.prototype=new e,r.prototype.constructor=r,r.superclass=e.prototype,r};V.isObject=function(r){return r===Object(r)&&!V.isArray(r)};V.isEmptyObject=function(r){if(V.isObject(r)){for(var e in r)if(Z1.call(r,e))return!1;return!0}return!1};V.isUndefined=function(r){return r===void 0};V.isString=function(r){return HC.call(r)=="[object String]"};V.isDate=function(r){return HC.call(r)=="[object Date]"};V.isNumber=function(r){return HC.call(r)=="[object Number]"};V.isElement=function(r){return!!(r&&r.nodeType===1)};V.encodeDates=function(r){return V.each(r,function(e,t){V.isDate(e)?r[t]=V.formatDate(e):V.isObject(e)&&(r[t]=V.encodeDates(e))}),r};V.timestamp=function(){return Date.now=Date.now||function(){return+new Date},Date.now()};V.formatDate=function(r){function e(t){return t<10?"0"+t:t}return r.getUTCFullYear()+"-"+e(r.getUTCMonth()+1)+"-"+e(r.getUTCDate())+"T"+e(r.getUTCHours())+":"+e(r.getUTCMinutes())+":"+e(r.getUTCSeconds())};V.strip_empty_properties=function(r){var e={};return V.each(r,function(t,n){V.isString(t)&&t.length>0&&(e[n]=t)}),e};V.truncate=function(r,e){var t;return typeof r=="string"?t=r.slice(0,e):V.isArray(r)?(t=[],V.each(r,function(n){t.push(V.truncate(n,e))})):V.isObject(r)?(t={},V.each(r,function(n,o){t[o]=V.truncate(n,e)})):t=r,t};V.JSONEncode=function(){return function(r){var e=r,t=function(o){var s=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return s.lastIndex=0,s.test(o)?'"'+o.replace(s,function(a){var c=i[a];return typeof c=="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+o+'"'},n=function(o,s){var i="",a="    ",c=0,l="",u="",p=0,d=i,h=[],f=s[o];switch(f&&typeof f=="object"&&typeof f.toJSON=="function"&&(f=f.toJSON(o)),typeof f){case"string":return t(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":return String(f);case"object":if(!f)return"null";if(i+=a,h=[],HC.apply(f)==="[object Array]"){for(p=f.length,c=0;c<p;c+=1)h[c]=n(c,f)||"null";return u=h.length===0?"[]":i?`[
`+i+h.join(`,
`+i)+`
`+d+"]":"["+h.join(",")+"]",i=d,u}for(l in f)Z1.call(f,l)&&(u=n(l,f),u&&h.push(t(l)+(i?": ":":")+u));return u=h.length===0?"{}":i?"{"+h.join(",")+d+"}":"{"+h.join(",")+"}",i=d,u}};return n("",{"":e})}}();V.JSONDecode=function(){var r,e,t={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},n,o=function(h){var f=new SyntaxError(h);throw f.at=r,f.text=n,f},s=function(h){return h&&h!==e&&o("Expected '"+h+"' instead of '"+e+"'"),e=n.charAt(r),r+=1,e},i=function(){var h,f="";for(e==="-"&&(f="-",s("-"));e>="0"&&e<="9";)f+=e,s();if(e===".")for(f+=".";s()&&e>="0"&&e<="9";)f+=e;if(e==="e"||e==="E")for(f+=e,s(),(e==="-"||e==="+")&&(f+=e,s());e>="0"&&e<="9";)f+=e,s();if(h=+f,!isFinite(h))o("Bad number");else return h},a=function(){var h,f,m="",g;if(e==='"')for(;s();){if(e==='"')return s(),m;if(e==="\\")if(s(),e==="u"){for(g=0,f=0;f<4&&(h=parseInt(s(),16),!!isFinite(h));f+=1)g=g*16+h;m+=String.fromCharCode(g)}else if(typeof t[e]=="string")m+=t[e];else break;else m+=e}o("Bad string")},c=function(){for(;e&&e<=" ";)s()},l=function(){switch(e){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}o('Unexpected "'+e+'"')},u,p=function(){var h=[];if(e==="["){if(s("["),c(),e==="]")return s("]"),h;for(;e;){if(h.push(u()),c(),e==="]")return s("]"),h;s(","),c()}}o("Bad array")},d=function(){var h,f={};if(e==="{"){if(s("{"),c(),e==="}")return s("}"),f;for(;e;){if(h=a(),c(),s(":"),Object.hasOwnProperty.call(f,h)&&o('Duplicate key "'+h+'"'),f[h]=u(),c(),e==="}")return s("}"),f;s(","),c()}}o("Bad object")};return u=function(){switch(c(),e){case"{":return d();case"[":return p();case'"':return a();case"-":return i();default:return e>="0"&&e<="9"?i():l()}},function(h){var f;return n=h,r=0,e=" ",f=u(),c(),e&&o("Syntax error"),f}}();V.base64Encode=function(r){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t,n,o,s,i,a,c,l,u=0,p=0,d="",h=[];if(!r)return r;r=V.utf8Encode(r);do t=r.charCodeAt(u++),n=r.charCodeAt(u++),o=r.charCodeAt(u++),l=t<<16|n<<8|o,s=l>>18&63,i=l>>12&63,a=l>>6&63,c=l&63,h[p++]=e.charAt(s)+e.charAt(i)+e.charAt(a)+e.charAt(c);while(u<r.length);switch(d=h.join(""),r.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"=";break}return d};V.utf8Encode=function(r){r=(r+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`);var e="",t,n,o=0,s;for(t=n=0,o=r.length,s=0;s<o;s++){var i=r.charCodeAt(s),a=null;i<128?n++:i>127&&i<2048?a=String.fromCharCode(i>>6|192,i&63|128):a=String.fromCharCode(i>>12|224,i>>6&63|128,i&63|128),a!==null&&(n>t&&(e+=r.substring(t,n)),e+=a,t=n=s+1)}return n>t&&(e+=r.substring(t,r.length)),e};V.UUID=function(){var r=function(){var n=1*new Date,o;if(Ht.performance&&Ht.performance.now)o=Ht.performance.now();else for(o=0;n==1*new Date;)o++;return n.toString(16)+Math.floor(o).toString(16)},e=function(){return Math.random().toString(16).replace(".","")},t=function(){var n=hu,o,s,i=[],a=0;function c(l,u){var p,d=0;for(p=0;p<u.length;p++)d|=i[p]<<p*8;return l^d}for(o=0;o<n.length;o++)s=n.charCodeAt(o),i.unshift(s&255),i.length>=4&&(a=c(a,i),i=[]);return i.length>0&&(a=c(a,i)),a.toString(16)};return function(){var n=(G1.height*G1.width).toString(16);return r()+"-"+e()+"-"+t()+"-"+n+"-"+r()}}();var f5=["ahrefsbot","ahrefssiteaudit","baiduspider","bingbot","bingpreview","chrome-lighthouse","facebookexternal","petalbot","pinterest","screaming frog","yahoo! slurp","yandexbot","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google"];V.isBlockedUA=function(r){var e;for(r=r.toLowerCase(),e=0;e<f5.length;e++)if(r.indexOf(f5[e])!==-1)return!0;return!1};V.HTTPBuildQuery=function(r,e){var t,n,o=[];return V.isUndefined(e)&&(e="&"),V.each(r,function(s,i){t=encodeURIComponent(s.toString()),n=encodeURIComponent(i),o[o.length]=n+"="+t}),o.join(e)};V.getQueryParam=function(r,e){e=e.replace(/[[]/g,"\\[").replace(/[\]]/g,"\\]");var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),o=n.exec(r);if(o===null||o&&typeof o[1]!="string"&&o[1].length)return"";var s=o[1];try{s=decodeURIComponent(s)}catch{Gr.error("Skipping decoding for malformed query param: "+s)}return s.replace(/\+/g," ")};V.cookie={get:function(r){for(var e=r+"=",t=pn.cookie.split(";"),n=0;n<t.length;n++){for(var o=t[n];o.charAt(0)==" ";)o=o.substring(1,o.length);if(o.indexOf(e)===0)return decodeURIComponent(o.substring(e.length,o.length))}return null},parse:function(r){var e;try{e=V.JSONDecode(V.cookie.get(r))||{}}catch{}return e},set_seconds:function(r,e,t,n,o,s,i){var a="",c="",l="";if(i)a="; domain="+i;else if(n){var u=m5(pn.location.hostname);a=u?"; domain=."+u:""}if(t){var p=new Date;p.setTime(p.getTime()+t*1e3),c="; expires="+p.toGMTString()}s&&(o=!0,l="; SameSite=None"),o&&(l+="; secure"),pn.cookie=r+"="+encodeURIComponent(e)+c+"; path=/"+a+l},set:function(r,e,t,n,o,s,i){var a="",c="",l="";if(i)a="; domain="+i;else if(n){var u=m5(pn.location.hostname);a=u?"; domain=."+u:""}if(t){var p=new Date;p.setTime(p.getTime()+t*24*60*60*1e3),c="; expires="+p.toGMTString()}s&&(o=!0,l="; SameSite=None"),o&&(l+="; secure");var d=r+"="+encodeURIComponent(e)+c+"; path=/"+a+l;return pn.cookie=d,d},remove:function(r,e,t){V.cookie.set(r,"",-1,e,!1,!1,t)}};var oL=null,W1=function(r,e){if(oL!==null&&!e)return oL;var t=!0;try{r=r||window.localStorage;var n="__mplss_"+wL(8),o="xyz";r.setItem(n,o),r.getItem(n)!==o&&(t=!1),r.removeItem(n)}catch{t=!1}return oL=t,t};V.localStorage={is_supported:function(r){var e=W1(null,r);return e||Gr.error("localStorage unsupported; falling back to cookie store"),e},error:function(r){Gr.error("localStorage error: "+r)},get:function(r){try{return window.localStorage.getItem(r)}catch(e){V.localStorage.error(e)}return null},parse:function(r){try{return V.JSONDecode(V.localStorage.get(r))||{}}catch{}return null},set:function(r,e){try{window.localStorage.setItem(r,e)}catch(t){V.localStorage.error(t)}},remove:function(r){try{window.localStorage.removeItem(r)}catch(e){V.localStorage.error(e)}}};V.register_event=function(){var r=function(n,o,s,i,a){if(!n){Gr.error("No valid element provided to register_event");return}if(n.addEventListener&&!i)n.addEventListener(o,s,!!a);else{var c="on"+o,l=n[c];n[c]=e(n,s,l)}};function e(n,o,s){var i=function(a){if(a=a||t(window.event),!!a){var c=!0,l,u;return V.isFunction(s)&&(l=s(a)),u=o.call(n,a),(l===!1||u===!1)&&(c=!1),c}};return i}function t(n){return n&&(n.preventDefault=t.preventDefault,n.stopPropagation=t.stopPropagation),n}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},r}();var kke=new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$');V.dom_query=function(){function r(o){return o.all?o.all:o.getElementsByTagName("*")}var e=/[\t\r\n]/g;function t(o,s){var i=" "+s+" ";return(" "+o.className+" ").replace(e," ").indexOf(i)>=0}function n(o){if(!pn.getElementsByTagName)return[];var s=o.split(" "),i,a,c,l,u,p,d,h,f,m,g=[pn];for(p=0;p<s.length;p++){if(i=s[p].replace(/^\s+/,"").replace(/\s+$/,""),i.indexOf("#")>-1){a=i.split("#"),c=a[0];var y=a[1],x=pn.getElementById(y);if(!x||c&&x.nodeName.toLowerCase()!=c)return[];g=[x];continue}if(i.indexOf(".")>-1){a=i.split("."),c=a[0];var b=a[1];for(c||(c="*"),l=[],u=0,d=0;d<g.length;d++)for(c=="*"?f=r(g[d]):f=g[d].getElementsByTagName(c),h=0;h<f.length;h++)l[u++]=f[h];for(g=[],m=0,d=0;d<l.length;d++)l[d].className&&V.isString(l[d].className)&&t(l[d],b)&&(g[m++]=l[d]);continue}var w=i.match(kke);if(w){c=w[1];var _=w[2],I=w[3],S=w[4];for(c||(c="*"),l=[],u=0,d=0;d<g.length;d++)for(c=="*"?f=r(g[d]):f=g[d].getElementsByTagName(c),h=0;h<f.length;h++)l[u++]=f[h];g=[],m=0;var k;switch(I){case"=":k=function(R){return R.getAttribute(_)==S};break;case"~":k=function(R){return R.getAttribute(_).match(new RegExp("\\b"+S+"\\b"))};break;case"|":k=function(R){return R.getAttribute(_).match(new RegExp("^"+S+"-?"))};break;case"^":k=function(R){return R.getAttribute(_).indexOf(S)===0};break;case"$":k=function(R){return R.getAttribute(_).lastIndexOf(S)==R.getAttribute(_).length-S.length};break;case"*":k=function(R){return R.getAttribute(_).indexOf(S)>-1};break;default:k=function(R){return R.getAttribute(_)}}for(g=[],m=0,d=0;d<l.length;d++)k(l[d])&&(g[m++]=l[d]);continue}for(c=i,l=[],u=0,d=0;d<g.length;d++)for(f=g[d].getElementsByTagName(c),h=0;h<f.length;h++)l[u++]=f[h];g=l}return g}return function(o){return V.isElement(o)?[o]:V.isObject(o)&&!V.isUndefined(o.length)?o:n.call(this,o)}}();var Eke=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","utm_id","utm_source_platform","utm_campaign_id","utm_creative_format","utm_marketing_tactic"],Nke=["dclid","fbclid","gclid","ko_click_id","li_fat_id","msclkid","sccid","ttclid","twclid","wbraid"];V.info={campaignParams:function(r){var e="",t={};return V.each(Eke,function(n){e=V.getQueryParam(pn.URL,n),e.length?t[n]=e:r!==void 0&&(t[n]=r)}),t},clickParams:function(){var r="",e={};return V.each(Nke,function(t){r=V.getQueryParam(pn.URL,t),r.length&&(e[t]=r)}),e},marketingParams:function(){return V.extend(V.info.campaignParams(),V.info.clickParams())},searchEngine:function(r){return r.search("https?://(.*)google.([^/?]*)")===0?"google":r.search("https?://(.*)bing.com")===0?"bing":r.search("https?://(.*)yahoo.com")===0?"yahoo":r.search("https?://(.*)duckduckgo.com")===0?"duckduckgo":null},searchInfo:function(r){var e=V.info.searchEngine(r),t=e!="yahoo"?"q":"p",n={};if(e!==null){n.$search_engine=e;var o=V.getQueryParam(r,t);o.length&&(n.mp_keyword=o)}return n},browser:function(r,e,t){return e=e||"",t||V.includes(r," OPR/")?V.includes(r,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(r)?"BlackBerry":V.includes(r,"IEMobile")||V.includes(r,"WPDesktop")?"Internet Explorer Mobile":V.includes(r,"SamsungBrowser/")?"Samsung Internet":V.includes(r,"Edge")||V.includes(r,"Edg/")?"Microsoft Edge":V.includes(r,"FBIOS")?"Facebook Mobile":V.includes(r,"Chrome")?"Chrome":V.includes(r,"CriOS")?"Chrome iOS":V.includes(r,"UCWEB")||V.includes(r,"UCBrowser")?"UC Browser":V.includes(r,"FxiOS")?"Firefox iOS":V.includes(e,"Apple")?V.includes(r,"Mobile")?"Mobile Safari":"Safari":V.includes(r,"Android")?"Android Mobile":V.includes(r,"Konqueror")?"Konqueror":V.includes(r,"Firefox")?"Firefox":V.includes(r,"MSIE")||V.includes(r,"Trident/")?"Internet Explorer":V.includes(r,"Gecko")?"Mozilla":""},browserVersion:function(r,e,t){var n=V.info.browser(r,e,t),o={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/},s=o[n];if(s===void 0)return null;var i=r.match(s);return i?parseFloat(i[i.length-2]):null},os:function(){var r=hu;return/Windows/i.test(r)?/Phone/.test(r)||/WPDesktop/.test(r)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(r)?"iOS":/Android/.test(r)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(r)?"BlackBerry":/Mac/i.test(r)?"Mac OS X":/Linux/.test(r)?"Linux":/CrOS/.test(r)?"Chrome OS":""},device:function(r){return/Windows Phone/i.test(r)||/WPDesktop/.test(r)?"Windows Phone":/iPad/.test(r)?"iPad":/iPod/.test(r)?"iPod Touch":/iPhone/.test(r)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(r)?"BlackBerry":/Android/.test(r)?"Android":""},referringDomain:function(r){var e=r.split("/");return e.length>=3?e[2]:""},currentUrl:function(){return Ht.location.href},properties:function(r){return typeof r!="object"&&(r={}),V.extend(V.strip_empty_properties({$os:V.info.os(),$browser:V.info.browser(hu,Oh.vendor,R1),$referrer:pn.referrer,$referring_domain:V.info.referringDomain(pn.referrer),$device:V.info.device(hu)}),{$current_url:V.info.currentUrl(),$browser_version:V.info.browserVersion(hu,Oh.vendor,R1),$screen_height:G1.height,$screen_width:G1.width,mp_lib:"web",$lib_version:ld.LIB_VERSION,$insert_id:wL(),time:V.timestamp()/1e3},V.strip_empty_properties(r))},people_properties:function(){return V.extend(V.strip_empty_properties({$os:V.info.os(),$browser:V.info.browser(hu,Oh.vendor,R1)}),{$browser_version:V.info.browserVersion(hu,Oh.vendor,R1)})},mpPageViewProperties:function(){return V.strip_empty_properties({current_page_title:pn.title,current_domain:Ht.location.hostname,current_url_path:Ht.location.pathname,current_url_protocol:Ht.location.protocol,current_url_search:Ht.location.search})}};var wL=function(r){var e=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return r?e.substring(0,r):e},Dke=/[a-z0-9][a-z0-9-]*\.[a-z]+$/i,Ake=/[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i,m5=function(r){var e=Ake,t=r.split("."),n=t[t.length-1];(n.length>4||n==="com"||n==="org")&&(e=Dke);var o=r.match(e);return o?o[0]:""},Rke=function(){var r=Ht.navigator.onLine;return V.isUndefined(r)||r},j1=null,H1=null;typeof JSON<"u"&&(j1=JSON.stringify,H1=JSON.parse);j1=j1||V.JSONEncode;H1=H1||V.JSONDecode;V.toArray=V.toArray;V.isObject=V.isObject;V.JSONEncode=V.JSONEncode;V.JSONDecode=V.JSONDecode;V.isBlockedUA=V.isBlockedUA;V.isEmptyObject=V.isEmptyObject;V.info=V.info;V.info.device=V.info.device;V.info.browser=V.info.browser;V.info.browserVersion=V.info.browserVersion;V.info.properties=V.info.properties;var Oke="__mp_opt_in_out_";function Mke(r,e){K5(!0,r,e)}function Fke(r,e){K5(!1,r,e)}function Pke(r,e){return q5(r,e)==="1"}function H5(r,e){if(Lke(e))return Gr.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"'),!0;var t=q5(r,e)==="0";return t&&Gr.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data."),t}function Fh(r){return SL(r,function(e){return this.get_config(e)})}function Ph(r){return SL(r,function(e){return this._get_config(e)})}function cv(r){return SL(r,function(e){return this._get_config(e)})}function $ke(r,e){e=e||{},CL(e).remove(_L(r,e),!!e.crossSubdomainCookie,e.cookieDomain)}function CL(r){return r=r||{},r.persistenceType==="localStorage"?V.localStorage:V.cookie}function _L(r,e){return e=e||{},(e.persistencePrefix||Oke)+r}function q5(r,e){return CL(e).get(_L(r,e))}function Lke(r){if(r&&r.ignoreDnt)return!1;var e=r&&r.window||Ht,t=e.navigator||{},n=!1;return V.each([t.doNotTrack,t.msDoNotTrack,e.doNotTrack],function(o){V.includes([!0,1,"1","yes"],o)&&(n=!0)}),n}function K5(r,e,t){if(!V.isString(e)||!e.length){Gr.error("gdpr."+(r?"optIn":"optOut")+" called with an invalid token");return}t=t||{},CL(t).set(_L(e,t),r?1:0,V.isNumber(t.cookieExpiration)?t.cookieExpiration:null,!!t.crossSubdomainCookie,!!t.secureCookie,!!t.crossSiteCookie,t.cookieDomain),t.track&&r&&t.track(t.trackEventName||"$opt_in",t.trackProperties,{send_immediately:!0})}function SL(r,e){return function(){var t=!1;try{var n=e.call(this,"token"),o=e.call(this,"ignore_dnt"),s=e.call(this,"opt_out_tracking_persistence_type"),i=e.call(this,"opt_out_tracking_cookie_prefix"),a=e.call(this,"window");n&&(t=H5(n,{ignoreDnt:o,persistenceType:s,persistencePrefix:i,window:a}))}catch(l){Gr.error("Unexpected error when checking tracking opt-out status: "+l)}if(!t)return r.apply(this,arguments);var c=arguments[arguments.length-1];typeof c=="function"&&c(0)}}var Vke=Q1("lock"),X5=function(r,e){e=e||{},this.storageKey=r,this.storage=e.storage||window.localStorage,this.pollIntervalMS=e.pollIntervalMS||100,this.timeoutMS=e.timeoutMS||2e3};X5.prototype.withLock=function(r,e,t){!t&&typeof e!="function"&&(t=e,e=null);var n=t||new Date().getTime()+"|"+Math.random(),o=new Date().getTime(),s=this.storageKey,i=this.pollIntervalMS,a=this.timeoutMS,c=this.storage,l=s+":X",u=s+":Y",p=s+":Z",d=function(x){e&&e(x)},h=function(x){if(new Date().getTime()-o>a){Vke.error("Timeout waiting for mutex on "+s+"; clearing lock. ["+n+"]"),c.removeItem(p),c.removeItem(u),g();return}setTimeout(function(){try{x()}catch(b){d(b)}},i*(Math.random()+.1))},f=function(x,b){x()?b():h(function(){f(x,b)})},m=function(){var x=c.getItem(u);if(x&&x!==n)return!1;if(c.setItem(u,n),c.getItem(u)===n)return!0;if(!W1(c,!0))throw new Error("localStorage support dropped while acquiring lock");return!1},g=function(){c.setItem(l,n),f(m,function(){if(c.getItem(l)===n){y();return}h(function(){if(c.getItem(u)!==n){g();return}f(function(){return!c.getItem(p)},y)})})},y=function(){c.setItem(p,"1");try{r()}finally{c.removeItem(p),c.getItem(u)===n&&c.removeItem(u),c.getItem(l)===n&&c.removeItem(l)}};try{if(W1(c,!0))g();else throw new Error("localStorage support check failed")}catch(x){d(x)}};var g5=Q1("batch"),$h=function(r,e){e=e||{},this.storageKey=r,this.storage=e.storage||window.localStorage,this.reportError=e.errorReporter||V.bind(g5.error,g5),this.lock=new X5(r,{storage:this.storage}),this.usePersistence=e.usePersistence,this.pid=e.pid||null,this.memQueue=[]};$h.prototype.enqueue=function(r,e,t){var n={id:wL(),flushAfter:new Date().getTime()+e*2,payload:r};this.usePersistence?this.lock.withLock(V.bind(function(){var s;try{var i=this.readFromStorage();i.push(n),s=this.saveToStorage(i),s&&this.memQueue.push(n)}catch{this.reportError("Error enqueueing item",r),s=!1}t&&t(s)},this),V.bind(function(s){this.reportError("Error acquiring storage lock",s),t&&t(!1)},this),this.pid):(this.memQueue.push(n),t&&t(!0))};$h.prototype.fillBatch=function(r){var e=this.memQueue.slice(0,r);if(this.usePersistence&&e.length<r){var t=this.readFromStorage();if(t.length){var n={};V.each(e,function(i){n[i.id]=!0});for(var o=0;o<t.length;o++){var s=t[o];if(new Date().getTime()>s.flushAfter&&!n[s.id]&&(s.orphaned=!0,e.push(s),e.length>=r))break}}}return e};var y5=function(r,e){var t=[];return V.each(r,function(n){n.id&&!e[n.id]&&t.push(n)}),t};$h.prototype.removeItemsByID=function(r,e){var t={};if(V.each(r,function(o){t[o]=!0}),this.memQueue=y5(this.memQueue,t),!this.usePersistence)e&&e(!0);else{var n=V.bind(function(){var o;try{var s=this.readFromStorage();if(s=y5(s,t),o=this.saveToStorage(s),o){s=this.readFromStorage();for(var i=0;i<s.length;i++){var a=s[i];if(a.id&&t[a.id])return this.reportError("Item not removed from storage"),!1}}}catch{this.reportError("Error removing items",r),o=!1}return o},this);this.lock.withLock(function(){var s=n();e&&e(s)},V.bind(function(s){var i=!1;if(this.reportError("Error acquiring storage lock",s),!W1(this.storage,!0)&&(i=n(),!i))try{this.storage.removeItem(this.storageKey)}catch(a){this.reportError("Error clearing queue",a)}e&&e(i)},this),this.pid)}};var x5=function(r,e){var t=[];return V.each(r,function(n){var o=n.id;if(o in e){var s=e[o];s!==null&&(n.payload=s,t.push(n))}else t.push(n)}),t};$h.prototype.updatePayloads=function(r,e){this.memQueue=x5(this.memQueue,r),this.usePersistence?this.lock.withLock(V.bind(function(){var n;try{var o=this.readFromStorage();o=x5(o,r),n=this.saveToStorage(o)}catch{this.reportError("Error updating items",r),n=!1}e&&e(n)},this),V.bind(function(n){this.reportError("Error acquiring storage lock",n),e&&e(!1)},this),this.pid):e&&e(!0)};$h.prototype.readFromStorage=function(){var r;try{r=this.storage.getItem(this.storageKey),r&&(r=H1(r),V.isArray(r)||(this.reportError("Invalid storage entry:",r),r=null))}catch(e){this.reportError("Error retrieving queue",e),r=null}return r||[]};$h.prototype.saveToStorage=function(r){try{return this.storage.setItem(this.storageKey,j1(r)),!0}catch(e){return this.reportError("Error saving queue",e),!1}};$h.prototype.clear=function(){this.memQueue=[],this.usePersistence&&this.storage.removeItem(this.storageKey)};var Bke=10*60*1e3,VC=Q1("batch"),Cc=function(r,e){this.errorReporter=e.errorReporter,this.queue=new $h(r,{errorReporter:V.bind(this.reportError,this),storage:e.storage,usePersistence:e.usePersistence}),this.libConfig=e.libConfig,this.sendRequest=e.sendRequestFunc,this.beforeSendHook=e.beforeSendHook,this.stopAllBatching=e.stopAllBatchingFunc,this.batchSize=this.libConfig.batch_size,this.flushInterval=this.libConfig.batch_flush_interval_ms,this.stopped=!this.libConfig.batch_autostart,this.consecutiveRemovalFailures=0,this.itemIdsSentSuccessfully={},this.flushOnlyOnInterval=e.flushOnlyOnInterval||!1};Cc.prototype.enqueue=function(r,e){this.queue.enqueue(r,this.flushInterval,e)};Cc.prototype.start=function(){this.stopped=!1,this.consecutiveRemovalFailures=0,this.flush()};Cc.prototype.stop=function(){this.stopped=!0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null)};Cc.prototype.clear=function(){this.queue.clear()};Cc.prototype.resetBatchSize=function(){this.batchSize=this.libConfig.batch_size};Cc.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig.batch_flush_interval_ms)};Cc.prototype.scheduleFlush=function(r){this.flushInterval=r,this.stopped||(this.timeoutID=setTimeout(V.bind(function(){this.stopped||this.flush()},this),this.flushInterval))};Cc.prototype.flush=function(r){try{if(this.requestInProgress){VC.log("Flush: Request already in progress");return}r=r||{};var e=this.libConfig.batch_request_timeout_ms,t=new Date().getTime(),n=this.batchSize,o=this.queue.fillBatch(n),s=o.length===n,i=[],a={};if(V.each(o,function(u){var p=u.payload;if(this.beforeSendHook&&!u.orphaned&&(p=this.beforeSendHook(p)),p){p.event&&p.properties&&(p.properties=V.extend({},p.properties,{mp_sent_by_lib_version:ld.LIB_VERSION}));var d=!0,h=u.id;h?(this.itemIdsSentSuccessfully[h]||0)>5&&(this.reportError("[dupe] item ID sent too many times, not sending",{item:u,batchSize:o.length,timesSent:this.itemIdsSentSuccessfully[h]}),d=!1):this.reportError("[dupe] found item with no ID",{item:u}),d&&i.push(p)}a[u.id]=p},this),i.length<1){this.resetFlush();return}this.requestInProgress=!0;var c=V.bind(function(u){this.requestInProgress=!1;try{var p=!1;if(r.unloading)this.queue.updatePayloads(a);else if(V.isObject(u)&&u.error==="timeout"&&new Date().getTime()-t>=e)this.reportError("Network timeout; retrying"),this.flush();else if(V.isObject(u)&&(u.httpStatusCode>=500||u.httpStatusCode===429||u.httpStatusCode<=0&&!Rke()||u.error==="timeout")){var d=this.flushInterval*2;u.retryAfter&&(d=parseInt(u.retryAfter,10)*1e3||d),d=Math.min(Bke,d),this.reportError("Error; retry in "+d+" ms"),this.scheduleFlush(d)}else if(V.isObject(u)&&u.httpStatusCode===413)if(o.length>1){var h=Math.max(1,Math.floor(n/2));this.batchSize=Math.min(this.batchSize,h,o.length-1),this.reportError("413 response; reducing batch size to "+this.batchSize),this.resetFlush()}else this.reportError("Single-event request too large; dropping",o),this.resetBatchSize(),p=!0;else p=!0;p&&(this.queue.removeItemsByID(V.map(o,function(f){return f.id}),V.bind(function(f){f?(this.consecutiveRemovalFailures=0,this.flushOnlyOnInterval&&!s?this.resetFlush():this.flush()):(this.reportError("Failed to remove items from queue"),++this.consecutiveRemovalFailures>5?(this.reportError("Too many queue failures; disabling batching system."),this.stopAllBatching()):this.resetFlush())},this)),V.each(o,V.bind(function(f){var m=f.id;m?(this.itemIdsSentSuccessfully[m]=this.itemIdsSentSuccessfully[m]||0,this.itemIdsSentSuccessfully[m]++,this.itemIdsSentSuccessfully[m]>5&&this.reportError("[dupe] item ID sent too many times",{item:f,batchSize:o.length,timesSent:this.itemIdsSentSuccessfully[m]})):this.reportError("[dupe] found item with no ID while removing",{item:f})},this)))}catch(f){this.reportError("Error handling API response",f),this.resetFlush()}},this),l={method:"POST",verbose:!0,ignore_json_errors:!0,timeout_ms:e};r.unloading&&(l.transport="sendBeacon"),VC.log("MIXPANEL REQUEST:",i),this.sendRequest(i,l,c)}catch(u){this.reportError("Error flushing request queue",u),this.resetFlush()}};Cc.prototype.reportError=function(r,e){if(VC.error.apply(VC.error,arguments),this.errorReporter)try{e instanceof Error||(e=new Error(r)),this.errorReporter(r,e)}catch(t){VC.error(t)}};var Ig=Q1("recorder"),v5=Ht.CompressionStream,zke={batch_size:1e3,batch_flush_interval_ms:10*1e3,batch_request_timeout_ms:90*1e3,batch_autostart:!0},Uke=new Set([du.MouseMove,du.MouseInteraction,du.Scroll,du.ViewportResize,du.Input,du.TouchMove,du.MediaInteraction,du.Drag,du.Selection]);function Gke(r){return r.type===W5.IncrementalSnapshot&&Uke.has(r.data.source)}var _c=function(r){this._mixpanel=r,this._stopRecording=null,this.recEvents=[],this.seqNo=0,this.replayId=null,this.replayStartTime=null,this.sendBatchId=null,this.idleTimeoutId=null,this.maxTimeoutId=null,this.recordMaxMs=LC,this.recordMinMs=0,this._initBatcher()};_c.prototype._initBatcher=function(){this.batcher=new Cc("__mprec",{libConfig:zke,sendRequestFunc:V.bind(this.flushEventsWithOptOut,this),errorReporter:V.bind(this.reportError,this),flushOnlyOnInterval:!0,usePersistence:!1})};_c.prototype.get_config=function(r){return this._mixpanel.get_config(r)};_c.prototype.startRecording=function(r){if(this._stopRecording!==null){Ig.log("Recording already in progress, skipping startRecording.");return}this.recordMaxMs=this.get_config("record_max_ms"),this.recordMaxMs>LC&&(this.recordMaxMs=LC,Ig.critical("record_max_ms cannot be greater than "+LC+"ms. Capping value.")),this.recordMinMs=this.get_config("record_min_ms"),this.recordMinMs>tL&&(this.recordMinMs=tL,Ig.critical("record_min_ms cannot be greater than "+tL+"ms. Capping value.")),this.recEvents=[],this.seqNo=0,this.replayStartTime=new Date().getTime(),this.replayId=V.UUID(),r||this.recordMinMs>0?this.batcher.stop():this.batcher.start();var e=V.bind(function(){clearTimeout(this.idleTimeoutId),this.idleTimeoutId=setTimeout(V.bind(function(){Ig.log("Idle timeout reached, restarting recording."),this.resetRecording()},this),this.get_config("record_idle_timeout_ms"))},this),t=this.get_config("record_block_selector");(t===""||t===null)&&(t=void 0),this._stopRecording=jC({emit:V.bind(function(n){this.batcher.enqueue(n),Gke(n)&&(this.batcher.stopped&&new Date().getTime()-this.replayStartTime>=this.recordMinMs&&this.batcher.start(),e())},this),blockClass:this.get_config("record_block_class"),blockSelector:t,collectFonts:this.get_config("record_collect_fonts"),inlineImages:this.get_config("record_inline_images"),maskAllInputs:!0,maskTextClass:this.get_config("record_mask_text_class"),maskTextSelector:this.get_config("record_mask_text_selector")}),e(),this.maxTimeoutId=setTimeout(V.bind(this.resetRecording,this),this.recordMaxMs)};_c.prototype.resetRecording=function(){this.stopRecording(),this.startRecording(!0)};_c.prototype.stopRecording=function(){this._stopRecording!==null&&(this._stopRecording(),this._stopRecording=null),this.batcher.stopped?this.batcher.clear():(this.batcher.flush(),this.batcher.stop()),this.replayId=null,clearTimeout(this.idleTimeoutId),clearTimeout(this.maxTimeoutId)};_c.prototype.flushEventsWithOptOut=function(r,e,t){this._flushEvents(r,e,t,V.bind(this._onOptOut,this))};_c.prototype._onOptOut=function(r){r===0&&(this.recEvents=[],this.stopRecording())};_c.prototype._sendRequest=function(r,e,t,n){var o=V.bind(function(s,i){s.status===200&&this.replayId===r&&this.seqNo++,n({status:0,httpStatusCode:s.status,responseBody:i,retryAfter:s.headers.get("Retry-After")})},this);Ht.fetch(this.get_config("api_host")+"/"+this.get_config("api_routes").record+"?"+new URLSearchParams(e),{method:"POST",headers:{Authorization:"Basic "+btoa(this.get_config("token")+":"),"Content-Type":"application/octet-stream"},body:t}).then(function(s){s.json().then(function(i){o(s,i)}).catch(function(i){n({error:i})})}).catch(function(s){n({error:s,httpStatusCode:0})})};_c.prototype._flushEvents=Fh(function(r,e,t){let n=r.length;if(n>0){var o=this.replayId,s=r[0].timestamp;(this.seqNo===0||!this.replayStartTime)&&(this.seqNo!==0&&this.reportError("Replay start time not set but seqNo is not 0. Using current batch start time as a fallback."),this.replayStartTime=s);var i=r[n-1].timestamp-this.replayStartTime,a={distinct_id:String(this._mixpanel.get_distinct_id()),seq:this.seqNo,batch_start_time:s/1e3,replay_id:o,replay_length_ms:i,replay_start_time:this.replayStartTime/1e3},c=V.JSONEncode(r),l=this._mixpanel.get_property("$device_id");l&&(a.$device_id=l);var u=this._mixpanel.get_property("$user_id");if(u&&(a.$user_id=u),v5){var p=new Blob([c],{type:"application/json"}).stream(),d=p.pipeThrough(new v5("gzip"));new Response(d).blob().then(V.bind(function(h){a.format="gzip",this._sendRequest(o,a,h,t)},this))}else a.format="body",this._sendRequest(o,a,c,t)}});_c.prototype.reportError=function(r,e){Ig.error.apply(Ig.error,arguments);try{!e&&!(r instanceof Error)&&(r=new Error(r)),this.get_config("error_reporter")(r,e)}catch(t){Ig.error(t)}};Ht.__mp_recorder=_c;var pd=function(){};pd.prototype.create_properties=function(){};pd.prototype.event_handler=function(){};pd.prototype.after_track_handler=function(){};pd.prototype.init=function(r){return this.mp=r,this};pd.prototype.track=function(r,e,t,n){var o=this,s=V.dom_query(r);if(s.length===0){Gr.error("The DOM query ("+r+") returned 0 elements");return}return V.each(s,function(i){V.register_event(i,this.override_event,function(a){var c={},l=o.create_properties(t,this),u=o.mp.get_config("track_links_timeout");o.event_handler(a,this,c),window.setTimeout(o.track_callback(n,l,c,!0),u),o.mp.track(e,l,o.track_callback(n,l,c))})},this),!0};pd.prototype.track_callback=function(r,e,t,n){n=n||!1;var o=this;return function(){t.callback_fired||(t.callback_fired=!0,!(r&&r(n,e)===!1)&&o.after_track_handler(e,t,n))}};pd.prototype.create_properties=function(r,e){var t;return typeof r=="function"?t=r(e):t=V.extend({},r),t};var sv=function(){this.override_event="click"};V.inherit(sv,pd);sv.prototype.create_properties=function(r,e){var t=sv.superclass.create_properties.apply(this,arguments);return e.href&&(t.url=e.href),t};sv.prototype.event_handler=function(r,e,t){t.new_tab=r.which===2||r.metaKey||r.ctrlKey||e.target==="_blank",t.href=e.href,t.new_tab||r.preventDefault()};sv.prototype.after_track_handler=function(r,e){e.new_tab||setTimeout(function(){window.location=e.href},0)};var J1=function(){this.override_event="submit"};V.inherit(J1,pd);J1.prototype.event_handler=function(r,e,t){t.element=e,r.preventDefault()};J1.prototype.after_track_handler=function(r,e){setTimeout(function(){e.element.submit()},0)};var Mh="$set",iv="$set_once",wc="$unset",kg="$add",fu="$append",Eg="$union",ud="$remove",Wke="$delete",Y5={set_action:function(r,e){var t={},n={};return V.isObject(r)?V.each(r,function(o,s){this._is_reserved_property(s)||(n[s]=o)},this):n[r]=e,t[Mh]=n,t},unset_action:function(r){var e={},t=[];return V.isArray(r)||(r=[r]),V.each(r,function(n){this._is_reserved_property(n)||t.push(n)},this),e[wc]=t,e},set_once_action:function(r,e){var t={},n={};return V.isObject(r)?V.each(r,function(o,s){this._is_reserved_property(s)||(n[s]=o)},this):n[r]=e,t[iv]=n,t},union_action:function(r,e){var t={},n={};return V.isObject(r)?V.each(r,function(o,s){this._is_reserved_property(s)||(n[s]=V.isArray(o)?o:[o])},this):n[r]=V.isArray(e)?e:[e],t[Eg]=n,t},append_action:function(r,e){var t={},n={};return V.isObject(r)?V.each(r,function(o,s){this._is_reserved_property(s)||(n[s]=o)},this):n[r]=e,t[fu]=n,t},remove_action:function(r,e){var t={},n={};return V.isObject(r)?V.each(r,function(o,s){this._is_reserved_property(s)||(n[s]=o)},this):n[r]=e,t[ud]=n,t},delete_action:function(){var r={};return r[Wke]="",r}},Rn=function(){};V.extend(Rn.prototype,Y5);Rn.prototype._init=function(r,e,t){this._mixpanel=r,this._group_key=e,this._group_id=t};Rn.prototype.set=cv(function(r,e,t){var n=this.set_action(r,e);return V.isObject(r)&&(t=e),this._send_request(n,t)});Rn.prototype.set_once=cv(function(r,e,t){var n=this.set_once_action(r,e);return V.isObject(r)&&(t=e),this._send_request(n,t)});Rn.prototype.unset=cv(function(r,e){var t=this.unset_action(r);return this._send_request(t,e)});Rn.prototype.union=cv(function(r,e,t){V.isObject(r)&&(t=e);var n=this.union_action(r,e);return this._send_request(n,t)});Rn.prototype.delete=cv(function(r){var e=this.delete_action();return this._send_request(e,r)});Rn.prototype.remove=cv(function(r,e,t){var n=this.remove_action(r,e);return this._send_request(n,t)});Rn.prototype._send_request=function(r,e){r.$group_key=this._group_key,r.$group_id=this._group_id,r.$token=this._get_config("token");var t=V.encodeDates(r);return this._mixpanel._track_or_batch({type:"groups",data:t,endpoint:this._get_config("api_host")+"/"+this._get_config("api_routes").groups,batcher:this._mixpanel.request_batchers.groups},e)};Rn.prototype._is_reserved_property=function(r){return r==="$group_key"||r==="$group_id"};Rn.prototype._get_config=function(r){return this._mixpanel.get_config(r)};Rn.prototype.toString=function(){return this._mixpanel.toString()+".group."+this._group_key+"."+this._group_id};Rn.prototype.remove=Rn.prototype.remove;Rn.prototype.set=Rn.prototype.set;Rn.prototype.set_once=Rn.prototype.set_once;Rn.prototype.union=Rn.prototype.union;Rn.prototype.unset=Rn.prototype.unset;Rn.prototype.toString=Rn.prototype.toString;var qt=function(){};V.extend(qt.prototype,Y5);qt.prototype._init=function(r){this._mixpanel=r};qt.prototype.set=Ph(function(r,e,t){var n=this.set_action(r,e);return V.isObject(r)&&(t=e),this._get_config("save_referrer")&&this._mixpanel.persistence.update_referrer_info(document.referrer),n[Mh]=V.extend({},V.info.people_properties(),n[Mh]),this._send_request(n,t)});qt.prototype.set_once=Ph(function(r,e,t){var n=this.set_once_action(r,e);return V.isObject(r)&&(t=e),this._send_request(n,t)});qt.prototype.unset=Ph(function(r,e){var t=this.unset_action(r);return this._send_request(t,e)});qt.prototype.increment=Ph(function(r,e,t){var n={},o={};return V.isObject(r)?(V.each(r,function(s,i){if(!this._is_reserved_property(i))if(isNaN(parseFloat(s))){Gr.error("Invalid increment value passed to mixpanel.people.increment - must be a number");return}else o[i]=s},this),t=e):(V.isUndefined(e)&&(e=1),o[r]=e),n[kg]=o,this._send_request(n,t)});qt.prototype.append=Ph(function(r,e,t){V.isObject(r)&&(t=e);var n=this.append_action(r,e);return this._send_request(n,t)});qt.prototype.remove=Ph(function(r,e,t){V.isObject(r)&&(t=e);var n=this.remove_action(r,e);return this._send_request(n,t)});qt.prototype.union=Ph(function(r,e,t){V.isObject(r)&&(t=e);var n=this.union_action(r,e);return this._send_request(n,t)});qt.prototype.track_charge=Ph(function(r,e,t){if(!V.isNumber(r)&&(r=parseFloat(r),isNaN(r))){Gr.error("Invalid value passed to mixpanel.people.track_charge - must be a number");return}return this.append("$transactions",V.extend({$amount:r},e),t)});qt.prototype.clear_charges=function(r){return this.set("$transactions",[],r)};qt.prototype.delete_user=function(){if(!this._identify_called()){Gr.error("mixpanel.people.delete_user() requires you to call identify() first");return}var r={$delete:this._mixpanel.get_distinct_id()};return this._send_request(r)};qt.prototype.toString=function(){return this._mixpanel.toString()+".people"};qt.prototype._send_request=function(r,e){r.$token=this._get_config("token"),r.$distinct_id=this._mixpanel.get_distinct_id();var t=this._mixpanel.get_property("$device_id"),n=this._mixpanel.get_property("$user_id"),o=this._mixpanel.get_property("$had_persisted_distinct_id");t&&(r.$device_id=t),n&&(r.$user_id=n),o&&(r.$had_persisted_distinct_id=o);var s=V.encodeDates(r);return this._identify_called()?this._mixpanel._track_or_batch({type:"people",data:s,endpoint:this._get_config("api_host")+"/"+this._get_config("api_routes").engage,batcher:this._mixpanel.request_batchers.people},e):(this._enqueue(r),V.isUndefined(e)||(this._get_config("verbose")?e({status:-1,error:null}):e(-1)),V.truncate(s,255))};qt.prototype._get_config=function(r){return this._mixpanel.get_config(r)};qt.prototype._identify_called=function(){return this._mixpanel._flags.identify_called===!0};qt.prototype._enqueue=function(r){Mh in r?this._mixpanel.persistence._add_to_people_queue(Mh,r):iv in r?this._mixpanel.persistence._add_to_people_queue(iv,r):wc in r?this._mixpanel.persistence._add_to_people_queue(wc,r):kg in r?this._mixpanel.persistence._add_to_people_queue(kg,r):fu in r?this._mixpanel.persistence._add_to_people_queue(fu,r):ud in r?this._mixpanel.persistence._add_to_people_queue(ud,r):Eg in r?this._mixpanel.persistence._add_to_people_queue(Eg,r):Gr.error("Invalid call to _enqueue():",r)};qt.prototype._flush_one_queue=function(r,e,t,n){var o=this,s=V.extend({},this._mixpanel.persistence.load_queue(r)),i=s;!V.isUndefined(s)&&V.isObject(s)&&!V.isEmptyObject(s)&&(o._mixpanel.persistence._pop_from_people_queue(r,s),o._mixpanel.persistence.save(),n&&(i=n(s)),e.call(o,i,function(a,c){a===0&&o._mixpanel.persistence._add_to_people_queue(r,s),V.isUndefined(t)||t(a,c)}))};qt.prototype._flush=function(r,e,t,n,o,s,i){var a=this;this._flush_one_queue(Mh,this.set,r),this._flush_one_queue(iv,this.set_once,n),this._flush_one_queue(wc,this.unset,s,function(g){return V.keys(g)}),this._flush_one_queue(kg,this.increment,e),this._flush_one_queue(Eg,this.union,o);var c=this._mixpanel.persistence.load_queue(fu);if(!V.isUndefined(c)&&V.isArray(c)&&c.length)for(var l,u=function(g,y){g===0&&a._mixpanel.persistence._add_to_people_queue(fu,l),V.isUndefined(t)||t(g,y)},p=c.length-1;p>=0;p--)c=this._mixpanel.persistence.load_queue(fu),l=c.pop(),a._mixpanel.persistence.save(),V.isEmptyObject(l)||a.append(l,u);var d=this._mixpanel.persistence.load_queue(ud);if(!V.isUndefined(d)&&V.isArray(d)&&d.length)for(var h,f=function(g,y){g===0&&a._mixpanel.persistence._add_to_people_queue(ud,h),V.isUndefined(i)||i(g,y)},m=d.length-1;m>=0;m--)d=this._mixpanel.persistence.load_queue(ud),h=d.pop(),a._mixpanel.persistence.save(),V.isEmptyObject(h)||a.remove(h,f)};qt.prototype._is_reserved_property=function(r){return r==="$distinct_id"||r==="$token"||r==="$device_id"||r==="$user_id"||r==="$had_persisted_distinct_id"};qt.prototype.set=qt.prototype.set;qt.prototype.set_once=qt.prototype.set_once;qt.prototype.unset=qt.prototype.unset;qt.prototype.increment=qt.prototype.increment;qt.prototype.append=qt.prototype.append;qt.prototype.remove=qt.prototype.remove;qt.prototype.union=qt.prototype.union;qt.prototype.track_charge=qt.prototype.track_charge;qt.prototype.clear_charges=qt.prototype.clear_charges;qt.prototype.delete_user=qt.prototype.delete_user;qt.prototype.toString=qt.prototype.toString;var IL="__mps",TL="__mpso",kL="__mpus",EL="__mpa",NL="__mpap",DL="__mpr",AL="__mpu",Z5="$people_distinct_id",q1="__alias",UC="__timers",jke=[IL,TL,kL,EL,NL,DL,AL,Z5,q1,UC],or=function(r){this.props={},this.campaign_params_saved=!1,r.persistence_name?this.name="mp_"+r.persistence_name:this.name="mp_"+r.token+"_mixpanel";var e=r.persistence;e!=="cookie"&&e!=="localStorage"&&(Gr.critical("Unknown persistence type "+e+"; falling back to cookie"),e=r.persistence="cookie"),e==="localStorage"&&V.localStorage.is_supported()?this.storage=V.localStorage:this.storage=V.cookie,this.load(),this.update_config(r),this.upgrade(),this.save()};or.prototype.properties=function(){var r={};return this.load(),V.each(this.props,function(e,t){V.include(jke,t)||(r[t]=e)}),r};or.prototype.load=function(){if(!this.disabled){var r=this.storage.parse(this.name);r&&(this.props=V.extend({},r))}};or.prototype.upgrade=function(){var r,e;this.storage===V.localStorage?(r=V.cookie.parse(this.name),V.cookie.remove(this.name),V.cookie.remove(this.name,!0),r&&this.register_once(r)):this.storage===V.cookie&&(e=V.localStorage.parse(this.name),V.localStorage.remove(this.name),e&&this.register_once(e))};or.prototype.save=function(){this.disabled||this.storage.set(this.name,V.JSONEncode(this.props),this.expire_days,this.cross_subdomain,this.secure,this.cross_site,this.cookie_domain)};or.prototype.load_prop=function(r){return this.load(),this.props[r]};or.prototype.remove=function(){this.storage.remove(this.name,!1,this.cookie_domain),this.storage.remove(this.name,!0,this.cookie_domain)};or.prototype.clear=function(){this.remove(),this.props={}};or.prototype.register_once=function(r,e,t){return V.isObject(r)?(typeof e>"u"&&(e="None"),this.expire_days=typeof t>"u"?this.default_expiry:t,this.load(),V.each(r,function(n,o){(!this.props.hasOwnProperty(o)||this.props[o]===e)&&(this.props[o]=n)},this),this.save(),!0):!1};or.prototype.register=function(r,e){return V.isObject(r)?(this.expire_days=typeof e>"u"?this.default_expiry:e,this.load(),V.extend(this.props,r),this.save(),!0):!1};or.prototype.unregister=function(r){this.load(),r in this.props&&(delete this.props[r],this.save())};or.prototype.update_search_keyword=function(r){this.register(V.info.searchInfo(r))};or.prototype.update_referrer_info=function(r){this.register_once({$initial_referrer:r||"$direct",$initial_referring_domain:V.info.referringDomain(r)||"$direct"},"")};or.prototype.get_referrer_info=function(){return V.strip_empty_properties({$initial_referrer:this.props.$initial_referrer,$initial_referring_domain:this.props.$initial_referring_domain})};or.prototype.update_config=function(r){this.default_expiry=this.expire_days=r.cookie_expiration,this.set_disabled(r.disable_persistence),this.set_cookie_domain(r.cookie_domain),this.set_cross_site(r.cross_site_cookie),this.set_cross_subdomain(r.cross_subdomain_cookie),this.set_secure(r.secure_cookie)};or.prototype.set_disabled=function(r){this.disabled=r,this.disabled?this.remove():this.save()};or.prototype.set_cookie_domain=function(r){r!==this.cookie_domain&&(this.remove(),this.cookie_domain=r,this.save())};or.prototype.set_cross_site=function(r){r!==this.cross_site&&(this.cross_site=r,this.remove(),this.save())};or.prototype.set_cross_subdomain=function(r){r!==this.cross_subdomain&&(this.cross_subdomain=r,this.remove(),this.save())};or.prototype.get_cross_subdomain=function(){return this.cross_subdomain};or.prototype.set_secure=function(r){r!==this.secure&&(this.secure=!!r,this.remove(),this.save())};or.prototype._add_to_people_queue=function(r,e){var t=this._get_queue_key(r),n=e[r],o=this._get_or_create_queue(Mh),s=this._get_or_create_queue(iv),i=this._get_or_create_queue(wc),a=this._get_or_create_queue(kg),c=this._get_or_create_queue(Eg),l=this._get_or_create_queue(ud,[]),u=this._get_or_create_queue(fu,[]);t===IL?(V.extend(o,n),this._pop_from_people_queue(kg,n),this._pop_from_people_queue(Eg,n),this._pop_from_people_queue(wc,n)):t===TL?(V.each(n,function(p,d){d in s||(s[d]=p)}),this._pop_from_people_queue(wc,n)):t===kL?V.each(n,function(p){V.each([o,s,a,c],function(d){p in d&&delete d[p]}),V.each(u,function(d){p in d&&delete d[p]}),i[p]=!0}):t===EL?(V.each(n,function(p,d){d in o?o[d]+=p:(d in a||(a[d]=0),a[d]+=p)},this),this._pop_from_people_queue(wc,n)):t===AL?(V.each(n,function(p,d){V.isArray(p)&&(d in c||(c[d]=[]),c[d]=c[d].concat(p))}),this._pop_from_people_queue(wc,n)):t===DL?(l.push(n),this._pop_from_people_queue(fu,n)):t===NL&&(u.push(n),this._pop_from_people_queue(wc,n)),Gr.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):"),Gr.log(e),this.save()};or.prototype._pop_from_people_queue=function(r,e){var t=this.props[this._get_queue_key(r)];V.isUndefined(t)||V.each(e,function(n,o){r===fu||r===ud?V.each(t,function(s){s[o]===n&&delete s[o]}):delete t[o]},this)};or.prototype.load_queue=function(r){return this.load_prop(this._get_queue_key(r))};or.prototype._get_queue_key=function(r){if(r===Mh)return IL;if(r===iv)return TL;if(r===wc)return kL;if(r===kg)return EL;if(r===fu)return NL;if(r===ud)return DL;if(r===Eg)return AL;Gr.error("Invalid queue:",r)};or.prototype._get_or_create_queue=function(r,e){var t=this._get_queue_key(r);return e=V.isUndefined(e)?{}:e,this.props[t]||(this.props[t]=e)};or.prototype.set_event_timer=function(r,e){var t=this.load_prop(UC)||{};t[r]=e,this.props[UC]=t,this.save()};or.prototype.remove_event_timer=function(r){var e=this.load_prop(UC)||{},t=e[r];return V.isUndefined(t)||(delete this.props[UC][r],this.save()),t};var RL,Q5=function(r,e){throw new Error(r+" not available in this build.")},_s,J5=0,Hke=1,qke=function(r){return r},GC=function(){},Ea="mixpanel",eK="base64",Kke="json",OL="$device:",nv=Ht.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,tK=!nv&&hu.indexOf("MSIE")===-1&&hu.indexOf("Mozilla")===-1,K1=null;Oh.sendBeacon&&(K1=function(){return Oh.sendBeacon.apply(Oh,arguments)});var rK={track:"track/",engage:"engage/",groups:"groups/",record:"record/"},b5={api_host:"https://api-js.mixpanel.com",api_routes:rK,api_method:"POST",api_transport:"XHR",api_payload_format:eK,app_host:"https://mixpanel.com",cdn:"https://cdn.mxpnl.com",cross_site_cookie:!1,cross_subdomain_cookie:!0,error_reporter:GC,persistence:"cookie",persistence_name:"",cookie_domain:"",cookie_name:"",loaded:GC,mp_loader:null,track_marketing:!0,track_pageview:!1,skip_first_touch_marketing:!1,store_google:!0,stop_utm_persistence:!1,save_referrer:!0,test:!1,verbose:!1,img:!1,debug:!1,track_links_timeout:300,cookie_expiration:365,upgrade:!1,disable_persistence:!1,disable_cookie:!1,secure_cookie:!1,ip:!0,opt_out_tracking_by_default:!1,opt_out_persistence_by_default:!1,opt_out_tracking_persistence_type:"localStorage",opt_out_tracking_cookie_prefix:null,property_blacklist:[],xhr_headers:{},ignore_dnt:!1,batch_requests:!0,batch_size:50,batch_flush_interval_ms:5e3,batch_request_timeout_ms:9e4,batch_autostart:!0,hooks:{},record_block_class:new RegExp("^(mp-block|fs-exclude|amp-block|rr-block|ph-no-capture)$"),record_block_selector:"img, video",record_collect_fonts:!1,record_idle_timeout_ms:30*60*1e3,record_inline_images:!1,record_mask_text_class:new RegExp("^(mp-mask|fs-mask|amp-mask|rr-mask|ph-mask)$"),record_mask_text_selector:"*",record_max_ms:LC,record_min_ms:0,record_sessions_percent:0,recorder_src:"https://cdn.mxpnl.com/libs/mixpanel-recorder.min.js"},nK=!1,ve=function(){},yL=function(r,e,t){var n,o=t===Ea?_s:_s[t];if(o&&RL===J5)n=o;else{if(o&&!V.isArray(o)){Gr.error("You have already initialized "+t);return}n=new ve}if(n._cached_groups={},n._init(r,e,t),n.people=new qt,n.people._init(n),!n.get_config("skip_first_touch_marketing")){var s=V.info.campaignParams(null),i={},a=!1;V.each(s,function(c,l){i["initial_"+l]=c,c&&(a=!0)}),a&&n.people.set_once(i)}return ld.DEBUG=ld.DEBUG||n.get_config("debug"),!V.isUndefined(o)&&V.isArray(o)&&(n._execute_array.call(n.people,o.people),n._execute_array(o)),n};ve.prototype.init=function(r,e,t){if(V.isUndefined(t)){this.report_error("You must name your new library: init(token, config, name)");return}if(t===Ea){this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");return}var n=yL(r,e,t);return _s[t]=n,n._loaded(),n};ve.prototype._init=function(r,e,t){e=e||{},this.__loaded=!0,this.config={};var n={};if(!("api_payload_format"in e)){var o=e.api_host||b5.api_host;o.match(/\.mixpanel\.com/)&&(n.api_payload_format=Kke)}if(this.set_config(V.extend({},b5,n,e,{name:t,token:r,callback_fn:(t===Ea?t:Ea+"."+t)+"._jsc"})),this._jsc=GC,this.__dom_loaded_queue=[],this.__request_queue=[],this.__disabled_events=[],this._flags={disable_all_events:!1,identify_called:!1},this.request_batchers={},this._batch_requests=this.get_config("batch_requests"),this._batch_requests){if(!V.localStorage.is_supported(!0)||!nv)this._batch_requests=!1,Gr.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support"),V.each(this.get_batcher_configs(),function(c){Gr.log("Clearing batch queue "+c.queue_key),V.localStorage.remove(c.queue_key)});else if(this.init_batchers(),K1&&Ht.addEventListener){var s=V.bind(function(){this.request_batchers.events.stopped||this.request_batchers.events.flush({unloading:!0})},this);Ht.addEventListener("pagehide",function(c){c.persisted&&s()}),Ht.addEventListener("visibilitychange",function(){pn.visibilityState==="hidden"&&s()})}}this.persistence=this.cookie=new or(this.config),this.unpersisted_superprops={},this._gdpr_init();var i=V.UUID();this.get_distinct_id()||this.register_once({distinct_id:OL+i,$device_id:i},"");var a=this.get_config("track_pageview");a&&this._init_url_change_tracking(a),this.get_config("record_sessions_percent")>0&&Math.random()*100<=this.get_config("record_sessions_percent")&&this.start_session_recording()};ve.prototype.start_session_recording=Fh(function(){if(!Ht.MutationObserver){Gr.critical("Browser does not support MutationObserver; skipping session recording");return}var r=V.bind(function(){this._recorder=this._recorder||new Ht.__mp_recorder(this),this._recorder.startRecording()},this);V.isUndefined(Ht.__mp_recorder)?Q5(this.get_config("recorder_src"),r):r()});ve.prototype.stop_session_recording=function(){this._recorder?this._recorder.stopRecording():Gr.critical("Session recorder module not loaded")};ve.prototype.get_session_recording_properties=function(){var r={};if(this._recorder){var e=this._recorder.replayId;e&&(r.$mp_replay_id=e)}return r};ve.prototype._loaded=function(){if(this.get_config("loaded")(this),this._set_default_superprops(),this.people.set_once(this.persistence.get_referrer_info()),this.get_config("store_google")&&this.get_config("stop_utm_persistence")){var r=V.info.campaignParams(null);V.each(r,(function(e,t){this.unregister(t)}).bind(this))}};ve.prototype._set_default_superprops=function(){this.persistence.update_search_keyword(pn.referrer),this.get_config("store_google")&&!this.get_config("stop_utm_persistence")&&this.register(V.info.campaignParams()),this.get_config("save_referrer")&&this.persistence.update_referrer_info(pn.referrer)};ve.prototype._dom_loaded=function(){V.each(this.__dom_loaded_queue,function(r){this._track_dom.apply(this,r)},this),this.has_opted_out_tracking()||V.each(this.__request_queue,function(r){this._send_request.apply(this,r)},this),delete this.__dom_loaded_queue,delete this.__request_queue};ve.prototype._track_dom=function(r,e){if(this.get_config("img"))return this.report_error("You can't use DOM tracking functions with img = true."),!1;if(!nK)return this.__dom_loaded_queue.push([r,e]),!1;var t=new r().init(this);return t.track.apply(t,e)};ve.prototype._init_url_change_tracking=function(r){var e="",t=this.track_pageview();if(t&&(e=V.info.currentUrl()),V.include(["full-url","url-with-path-and-query-string","url-with-path"],r)){Ht.addEventListener("popstate",function(){Ht.dispatchEvent(new Event("mp_locationchange"))}),Ht.addEventListener("hashchange",function(){Ht.dispatchEvent(new Event("mp_locationchange"))});var n=Ht.history.pushState;typeof n=="function"&&(Ht.history.pushState=function(s,i,a){n.call(Ht.history,s,i,a),Ht.dispatchEvent(new Event("mp_locationchange"))});var o=Ht.history.replaceState;typeof o=="function"&&(Ht.history.replaceState=function(s,i,a){o.call(Ht.history,s,i,a),Ht.dispatchEvent(new Event("mp_locationchange"))}),Ht.addEventListener("mp_locationchange",(function(){var s=V.info.currentUrl(),i=!1;if(r==="full-url"?i=s!==e:r==="url-with-path-and-query-string"?i=s.split("#")[0]!==e.split("#")[0]:r==="url-with-path"&&(i=s.split("#")[0].split("?")[0]!==e.split("#")[0].split("?")[0]),i){var a=this.track_pageview();a&&(e=s)}}).bind(this))}};ve.prototype._prepare_callback=function(r,e){if(V.isUndefined(r))return null;if(nv){var t=function(i){r(i,e)};return t}else{var n=this._jsc,o=""+Math.floor(Math.random()*1e8),s=this.get_config("callback_fn")+"["+o+"]";return n[o]=function(i){delete n[o],r(i,e)},s}};ve.prototype._send_request=function(r,e,t,n){var o=!0;if(tK)return this.__request_queue.push(arguments),o;var s={method:this.get_config("api_method"),transport:this.get_config("api_transport"),verbose:this.get_config("verbose")},i=null;!n&&(V.isFunction(t)||typeof t=="string")&&(n=t,t=null),t=V.extend(s,t||{}),nv||(t.method="GET");var a=t.method==="POST",c=K1&&a&&t.transport.toLowerCase()==="sendbeacon",l=t.verbose;e.verbose&&(l=!0),this.get_config("test")&&(e.test=1),l&&(e.verbose=1),this.get_config("img")&&(e.img=1),nv||(n?e.callback=n:(l||this.get_config("test"))&&(e.callback="(function(){})")),e.ip=this.get_config("ip")?1:0,e._=new Date().getTime().toString(),a&&(i="data="+encodeURIComponent(e.data),delete e.data),r+="?"+V.HTTPBuildQuery(e);var u=this;if("img"in e){var p=pn.createElement("img");p.src=r,pn.body.appendChild(p)}else if(c){try{o=K1(r,i)}catch(y){u.report_error(y),o=!1}try{n&&n(o?1:0)}catch(y){u.report_error(y)}}else if(nv)try{var d=new XMLHttpRequest;d.open(t.method,r,!0);var h=this.get_config("xhr_headers");if(a&&(h["Content-Type"]="application/x-www-form-urlencoded"),V.each(h,function(y,x){d.setRequestHeader(x,y)}),t.timeout_ms&&typeof d.timeout<"u"){d.timeout=t.timeout_ms;var f=new Date().getTime()}d.withCredentials=!0,d.onreadystatechange=function(){if(d.readyState===4)if(d.status===200){if(n)if(l){var y;try{y=V.JSONDecode(d.responseText)}catch(w){if(u.report_error(w),t.ignore_json_errors)y=d.responseText;else return}n(y)}else n(Number(d.responseText))}else{var x;if(d.timeout&&!d.status&&new Date().getTime()-f>=d.timeout?x="timeout":x="Bad HTTP status: "+d.status+" "+d.statusText,u.report_error(x),n)if(l){var b=d.responseHeaders||{};n({status:0,httpStatusCode:d.status,error:x,retryAfter:b["Retry-After"]})}else n(0)}},d.send(i)}catch(y){u.report_error(y),o=!1}else{var m=pn.createElement("script");m.type="text/javascript",m.async=!0,m.defer=!0,m.src=r;var g=pn.getElementsByTagName("script")[0];g.parentNode.insertBefore(m,g)}return o};ve.prototype._execute_array=function(r){var e,t=[],n=[],o=[];V.each(r,function(i){i&&(e=i[0],V.isArray(e)?o.push(i):typeof i=="function"?i.call(this):V.isArray(i)&&e==="alias"?t.push(i):V.isArray(i)&&e.indexOf("track")!==-1&&typeof this[e]=="function"?o.push(i):n.push(i))},this);var s=function(i,a){V.each(i,function(c){if(V.isArray(c[0])){var l=a;V.each(c,function(u){l=l[u[0]].apply(l,u.slice(1))})}else this[c[0]].apply(this,c.slice(1))},a)};s(t,this),s(n,this),s(o,this)};ve.prototype.are_batchers_initialized=function(){return!!this.request_batchers.events};ve.prototype.get_batcher_configs=function(){var r="__mpq_"+this.get_config("token"),e=this.get_config("api_routes");return this._batcher_configs=this._batcher_configs||{events:{type:"events",endpoint:"/"+e.track,queue_key:r+"_ev"},people:{type:"people",endpoint:"/"+e.engage,queue_key:r+"_pp"},groups:{type:"groups",endpoint:"/"+e.groups,queue_key:r+"_gr"}},this._batcher_configs};ve.prototype.init_batchers=function(){if(!this.are_batchers_initialized()){var r=V.bind(function(t){return new Cc(t.queue_key,{libConfig:this.config,errorReporter:this.get_config("error_reporter"),sendRequestFunc:V.bind(function(n,o,s){this._send_request(this.get_config("api_host")+t.endpoint,this._encode_data_for_request(n),o,this._prepare_callback(s,n))},this),beforeSendHook:V.bind(function(n){return this._run_hook("before_send_"+t.type,n)},this),stopAllBatchingFunc:V.bind(this.stop_batch_senders,this),usePersistence:!0})},this),e=this.get_batcher_configs();this.request_batchers={events:r(e.events),people:r(e.people),groups:r(e.groups)}}this.get_config("batch_autostart")&&this.start_batch_senders()};ve.prototype.start_batch_senders=function(){this._batchers_were_started=!0,this.are_batchers_initialized()&&(this._batch_requests=!0,V.each(this.request_batchers,function(r){r.start()}))};ve.prototype.stop_batch_senders=function(){this._batch_requests=!1,V.each(this.request_batchers,function(r){r.stop(),r.clear()})};ve.prototype.push=function(r){this._execute_array([r])};ve.prototype.disable=function(r){typeof r>"u"?this._flags.disable_all_events=!0:this.__disabled_events=this.__disabled_events.concat(r)};ve.prototype._encode_data_for_request=function(r){var e=V.JSONEncode(r);return this.get_config("api_payload_format")===eK&&(e=V.base64Encode(e)),{data:e}};ve.prototype._track_or_batch=function(r,e){var t=V.truncate(r.data,255),n=r.endpoint,o=r.batcher,s=r.should_send_immediately,i=r.send_request_options||{};e=e||GC;var a=!0,c=V.bind(function(){return i.skip_hooks||(t=this._run_hook("before_send_"+r.type,t)),t?(Gr.log("MIXPANEL REQUEST:"),Gr.log(t),this._send_request(n,this._encode_data_for_request(t),i,this._prepare_callback(e,t))):null},this);return this._batch_requests&&!s?o.enqueue(t,function(l){l?e(1,t):c()}):a=c(),a&&t};ve.prototype.track=Fh(function(r,e,t,n){!n&&typeof t=="function"&&(n=t,t=null),t=t||{};var o=t.transport;o&&(t.transport=o);var s=t.send_immediately;if(typeof n!="function"&&(n=GC),V.isUndefined(r)){this.report_error("No event name provided to mixpanel.track");return}if(this._event_is_disabled(r)){n(0);return}e=V.extend({},e),e.token=this.get_config("token");var i=this.persistence.remove_event_timer(r);if(!V.isUndefined(i)){var a=new Date().getTime()-i;e.$duration=parseFloat((a/1e3).toFixed(3))}this._set_default_superprops();var c=this.get_config("track_marketing")?V.info.marketingParams():{};e=V.extend({},V.info.properties({mp_loader:this.get_config("mp_loader")}),c,this.persistence.properties(),this.unpersisted_superprops,this.get_session_recording_properties(),e);var l=this.get_config("property_blacklist");V.isArray(l)?V.each(l,function(d){delete e[d]}):this.report_error("Invalid value for property_blacklist config: "+l);var u={event:r,properties:e},p=this._track_or_batch({type:"events",data:u,endpoint:this.get_config("api_host")+"/"+this.get_config("api_routes").track,batcher:this.request_batchers.events,should_send_immediately:s,send_request_options:t},n);return p});ve.prototype.set_group=Fh(function(r,e,t){V.isArray(e)||(e=[e]);var n={};return n[r]=e,this.register(n),this.people.set(r,e,t)});ve.prototype.add_group=Fh(function(r,e,t){var n=this.get_property(r),o={};return n===void 0?(o[r]=[e],this.register(o)):n.indexOf(e)===-1&&(n.push(e),o[r]=n,this.register(o)),this.people.union(r,e,t)});ve.prototype.remove_group=Fh(function(r,e,t){var n=this.get_property(r);if(n!==void 0){var o=n.indexOf(e);o>-1&&(n.splice(o,1),this.register({group_key:n})),n.length===0&&this.unregister(r)}return this.people.remove(r,e,t)});ve.prototype.track_with_groups=Fh(function(r,e,t,n){var o=V.extend({},e||{});return V.each(t,function(s,i){s!=null&&(o[i]=s)}),this.track(r,o,n)});ve.prototype._create_map_key=function(r,e){return r+"_"+JSON.stringify(e)};ve.prototype._remove_group_from_cache=function(r,e){delete this._cached_groups[this._create_map_key(r,e)]};ve.prototype.get_group=function(r,e){var t=this._create_map_key(r,e),n=this._cached_groups[t];return(n===void 0||n._group_key!==r||n._group_id!==e)&&(n=new Rn,n._init(this,r,e),this._cached_groups[t]=n),n};ve.prototype.track_pageview=Fh(function(r,e){typeof r!="object"&&(r={}),e=e||{};var t=e.event_name||"$mp_web_page_view",n=V.extend(V.info.mpPageViewProperties(),V.info.campaignParams(),V.info.clickParams()),o=V.extend({},n,r);return this.track(t,o)});ve.prototype.track_links=function(){return this._track_dom.call(this,sv,arguments)};ve.prototype.track_forms=function(){return this._track_dom.call(this,J1,arguments)};ve.prototype.time_event=function(r){if(V.isUndefined(r)){this.report_error("No event name provided to mixpanel.time_event");return}this._event_is_disabled(r)||this.persistence.set_event_timer(r,new Date().getTime())};var Xke={persistent:!0},ML=function(r){var e;return V.isObject(r)?e=r:V.isUndefined(r)?e={}:e={days:r},V.extend({},Xke,e)};ve.prototype.register=function(r,e){var t=ML(e);t.persistent?this.persistence.register(r,t.days):V.extend(this.unpersisted_superprops,r)};ve.prototype.register_once=function(r,e,t){var n=ML(t);n.persistent?this.persistence.register_once(r,e,n.days):(typeof e>"u"&&(e="None"),V.each(r,function(o,s){(!this.unpersisted_superprops.hasOwnProperty(s)||this.unpersisted_superprops[s]===e)&&(this.unpersisted_superprops[s]=o)},this))};ve.prototype.unregister=function(r,e){e=ML(e),e.persistent?this.persistence.unregister(r):delete this.unpersisted_superprops[r]};ve.prototype._register_single=function(r,e){var t={};t[r]=e,this.register(t)};ve.prototype.identify=function(r,e,t,n,o,s,i,a){var c=this.get_distinct_id();if(r&&c!==r){if(typeof r=="string"&&r.indexOf(OL)===0)return this.report_error("distinct_id cannot have $device: prefix"),-1;this.register({$user_id:r})}if(!this.get_property("$device_id")){var l=c;this.register_once({$had_persisted_distinct_id:!0,$device_id:l},"")}r!==c&&r!==this.get_property(q1)&&(this.unregister(q1),this.register({distinct_id:r})),this._flags.identify_called=!0,this.people._flush(e,t,n,o,s,i,a),r!==c&&this.track("$identify",{distinct_id:r,$anon_distinct_id:c},{skip_hooks:!0})};ve.prototype.reset=function(){this.persistence.clear(),this._flags.identify_called=!1;var r=V.UUID();this.register_once({distinct_id:OL+r,$device_id:r},"")};ve.prototype.get_distinct_id=function(){return this.get_property("distinct_id")};ve.prototype.alias=function(r,e){if(r===this.get_property(Z5))return this.report_error("Attempting to create alias for existing People user - aborting."),-2;var t=this;return V.isUndefined(e)&&(e=this.get_distinct_id()),r!==e?(this._register_single(q1,r),this.track("$create_alias",{alias:r,distinct_id:e},{skip_hooks:!0},function(){t.identify(r)})):(this.report_error("alias matches current distinct_id - skipping api call."),this.identify(r),-1)};ve.prototype.name_tag=function(r){this._register_single("mp_name_tag",r)};ve.prototype.set_config=function(r){if(V.isObject(r)){V.extend(this.config,r);var e=r.batch_size;e&&V.each(this.request_batchers,function(t){t.resetBatchSize()}),this.get_config("persistence_name")||(this.config.persistence_name=this.config.cookie_name),this.get_config("disable_persistence")||(this.config.disable_persistence=this.config.disable_cookie),this.persistence&&this.persistence.update_config(this.config),ld.DEBUG=ld.DEBUG||this.get_config("debug")}};ve.prototype.get_config=function(r){return this.config[r]};ve.prototype._run_hook=function(r){var e=(this.config.hooks[r]||qke).apply(this,Rh.call(arguments,1));return typeof e>"u"&&(this.report_error(r+" hook did not return a value"),e=null),e};ve.prototype.get_property=function(r){return this.persistence.load_prop([r])};ve.prototype.toString=function(){var r=this.get_config("name");return r!==Ea&&(r=Ea+"."+r),r};ve.prototype._event_is_disabled=function(r){return V.isBlockedUA(hu)||this._flags.disable_all_events||V.include(this.__disabled_events,r)};ve.prototype._gdpr_init=function(){var r=this.get_config("opt_out_tracking_persistence_type")==="localStorage";r&&V.localStorage.is_supported()&&(!this.has_opted_in_tracking()&&this.has_opted_in_tracking({persistence_type:"cookie"})&&this.opt_in_tracking({enable_persistence:!1}),!this.has_opted_out_tracking()&&this.has_opted_out_tracking({persistence_type:"cookie"})&&this.opt_out_tracking({clear_persistence:!1}),this.clear_opt_in_out_tracking({persistence_type:"cookie",enable_persistence:!1})),this.has_opted_out_tracking()?this._gdpr_update_persistence({clear_persistence:!0}):!this.has_opted_in_tracking()&&(this.get_config("opt_out_tracking_by_default")||V.cookie.get("mp_optout"))&&(V.cookie.remove("mp_optout"),this.opt_out_tracking({clear_persistence:this.get_config("opt_out_persistence_by_default")}))};ve.prototype._gdpr_update_persistence=function(r){var e;if(r&&r.clear_persistence)e=!0;else if(r&&r.enable_persistence)e=!1;else return;!this.get_config("disable_persistence")&&this.persistence.disabled!==e&&this.persistence.set_disabled(e),e?this.stop_batch_senders():this._batchers_were_started&&this.start_batch_senders()};ve.prototype._gdpr_call_func=function(r,e){return e=V.extend({track:V.bind(this.track,this),persistence_type:this.get_config("opt_out_tracking_persistence_type"),cookie_prefix:this.get_config("opt_out_tracking_cookie_prefix"),cookie_expiration:this.get_config("cookie_expiration"),cross_site_cookie:this.get_config("cross_site_cookie"),cross_subdomain_cookie:this.get_config("cross_subdomain_cookie"),cookie_domain:this.get_config("cookie_domain"),secure_cookie:this.get_config("secure_cookie"),ignore_dnt:this.get_config("ignore_dnt")},e),V.localStorage.is_supported()||(e.persistence_type="cookie"),r(this.get_config("token"),{track:e.track,trackEventName:e.track_event_name,trackProperties:e.track_properties,persistenceType:e.persistence_type,persistencePrefix:e.cookie_prefix,cookieDomain:e.cookie_domain,cookieExpiration:e.cookie_expiration,crossSiteCookie:e.cross_site_cookie,crossSubdomainCookie:e.cross_subdomain_cookie,secureCookie:e.secure_cookie,ignoreDnt:e.ignore_dnt})};ve.prototype.opt_in_tracking=function(r){r=V.extend({enable_persistence:!0},r),this._gdpr_call_func(Mke,r),this._gdpr_update_persistence(r)};ve.prototype.opt_out_tracking=function(r){r=V.extend({clear_persistence:!0,delete_user:!0},r),r.delete_user&&this.people&&this.people._identify_called()&&(this.people.delete_user(),this.people.clear_charges()),this._gdpr_call_func(Fke,r),this._gdpr_update_persistence(r)};ve.prototype.has_opted_in_tracking=function(r){return this._gdpr_call_func(Pke,r)};ve.prototype.has_opted_out_tracking=function(r){return this._gdpr_call_func(H5,r)};ve.prototype.clear_opt_in_out_tracking=function(r){r=V.extend({enable_persistence:!0},r),this._gdpr_call_func($ke,r),this._gdpr_update_persistence(r)};ve.prototype.report_error=function(r,e){Gr.error.apply(Gr.error,arguments);try{!e&&!(r instanceof Error)&&(r=new Error(r)),this.get_config("error_reporter")(r,e)}catch(t){Gr.error(t)}};ve.prototype.init=ve.prototype.init;ve.prototype.reset=ve.prototype.reset;ve.prototype.disable=ve.prototype.disable;ve.prototype.time_event=ve.prototype.time_event;ve.prototype.track=ve.prototype.track;ve.prototype.track_links=ve.prototype.track_links;ve.prototype.track_forms=ve.prototype.track_forms;ve.prototype.track_pageview=ve.prototype.track_pageview;ve.prototype.register=ve.prototype.register;ve.prototype.register_once=ve.prototype.register_once;ve.prototype.unregister=ve.prototype.unregister;ve.prototype.identify=ve.prototype.identify;ve.prototype.alias=ve.prototype.alias;ve.prototype.name_tag=ve.prototype.name_tag;ve.prototype.set_config=ve.prototype.set_config;ve.prototype.get_config=ve.prototype.get_config;ve.prototype.get_property=ve.prototype.get_property;ve.prototype.get_distinct_id=ve.prototype.get_distinct_id;ve.prototype.toString=ve.prototype.toString;ve.prototype.opt_out_tracking=ve.prototype.opt_out_tracking;ve.prototype.opt_in_tracking=ve.prototype.opt_in_tracking;ve.prototype.has_opted_out_tracking=ve.prototype.has_opted_out_tracking;ve.prototype.has_opted_in_tracking=ve.prototype.has_opted_in_tracking;ve.prototype.clear_opt_in_out_tracking=ve.prototype.clear_opt_in_out_tracking;ve.prototype.get_group=ve.prototype.get_group;ve.prototype.set_group=ve.prototype.set_group;ve.prototype.add_group=ve.prototype.add_group;ve.prototype.remove_group=ve.prototype.remove_group;ve.prototype.track_with_groups=ve.prototype.track_with_groups;ve.prototype.start_batch_senders=ve.prototype.start_batch_senders;ve.prototype.stop_batch_senders=ve.prototype.stop_batch_senders;ve.prototype.start_session_recording=ve.prototype.start_session_recording;ve.prototype.stop_session_recording=ve.prototype.stop_session_recording;ve.prototype.get_session_recording_properties=ve.prototype.get_session_recording_properties;ve.prototype.DEFAULT_API_ROUTES=rK;or.prototype.properties=or.prototype.properties;or.prototype.update_search_keyword=or.prototype.update_search_keyword;or.prototype.update_referrer_info=or.prototype.update_referrer_info;or.prototype.get_cross_subdomain=or.prototype.get_cross_subdomain;or.prototype.clear=or.prototype.clear;var rv={},Yke=function(){V.each(rv,function(r,e){e!==Ea&&(_s[e]=r)}),_s._=V},Zke=function(){_s.init=function(r,e,t){if(t)return _s[t]||(_s[t]=rv[t]=yL(r,e,t),_s[t]._loaded()),_s[t];var n=_s;rv[Ea]?n=rv[Ea]:r&&(n=yL(r,e,Ea),n._loaded(),rv[Ea]=n),_s=n,RL===Hke&&(Ht[Ea]=_s),Yke()}},Qke=function(){function r(){r.done||(r.done=!0,nK=!0,tK=!1,V.each(rv,function(n){n._dom_loaded()}))}function e(){try{pn.documentElement.doScroll("left")}catch{setTimeout(e,1);return}r()}if(pn.addEventListener)pn.readyState==="complete"?r():pn.addEventListener("DOMContentLoaded",r,!1);else if(pn.attachEvent){pn.attachEvent("onreadystatechange",r);var t=!1;try{t=Ht.frameElement===null}catch{}pn.documentElement.doScroll&&t&&e()}V.register_event(Ht,"load",r,!0)};function Jke(r){return Q5=r,RL=J5,_s=new ve,Zke(),_s.init(),Qke(),_s}function eEe(r,e){e()}var lv=Jke(eEe);var Na=class r{currentUserId="";mixpanelService;constructor(){lv.init(_g.mixpanelApiKey)}track(e,t){t=$e(ie({},t),{version:n1}),console.log("[events.track]",e,t),lv.track(e,t)}identify(e){console.log("[events.identify]",e),lv.identify(e),lv.people.set({$name:e})}people(e){lv.people.set(e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var tEe=["*"];function rEe(r,e){if(r&1){let t=ed();Se(0,"div",15),Ke(1),Se(2,"button",16),mr("click",function(){_a(t);let o=Dn();return Sa(o.logout())}),Ke(3,"Logout"),Ie()()}if(r&2){let t=Dn();It(),Th(" Welcome ",t.user.email," ")}}var mu=class r{constructor(e,t){this.currentUser=e;this.events=t}user=void 0;ngOnInit(){return M(this,null,function*(){this.user=yield this.currentUser.get(),this.user&&this.events.people({email:this.user.email}),console.log("user",this.user)})}logout(){this.events.track("logout"),this.currentUser.logout(),window.location.reload()}static \u0275fac=function(t){return new(t||r)(We(Yx),We(Na))};static \u0275cmp=Dt({type:r,selectors:[["app-common-page"]],standalone:!0,features:[At],ngContentSelectors:tEe,decls:18,vars:1,consts:[[1,"bg-white"],[1,"absolute","inset-x-0","top-0","z-50"],["aria-label","Global",1,"flex","items-center","justify-between","p-6","lg:px-8"],[1,"flex","lg:flex-1"],[1,"-m-1.5","p-1.5"],[1,"sr-only"],["src","logo-sep-2024.png","alt","",1,"h-8","w-auto"],[1,"hidden","lg:flex","lg:flex-1","lg:justify-end"],["class","text-sm font-semibold leading-6 text-gray-900",4,"ngIf"],[1,"relative","isolate","px-6","pt-14","lg:px-8"],["aria-hidden","true",1,"absolute","inset-x-0","-top-40","-z-10","transform-gpu","overflow-hidden","blur-3xl","sm:-top-80"],[1,"relative","left-[calc(50%-11rem)]","aspect-[1155/678]","w-[36.125rem]","-translate-x-1/2","rotate-[30deg]","bg-gradient-to-tr","from-[#ff80b5]","to-[#9089fc]","opacity-30","sm:left-[calc(50%-30rem)]","sm:w-[72.1875rem]",2,"clip-path",`polygon(
              74.1% 44.1%,
              100% 61.6%,
              97.5% 26.9%,
              85.5% 0.1%,
              80.7% 2%,
              72.5% 32.5%,
              60.2% 62.4%,
              52.4% 68.1%,
              47.5% 58.3%,
              45.2% 34.5%,
              27.5% 76.7%,
              0.1% 64.9%,
              17.9% 100%,
              27.6% 76.8%,
              76.1% 97.7%,
              74.1% 44.1%
            )`],[1,"mx-auto","max-w-2xl"],["aria-hidden","true",1,"absolute","inset-x-0","top-[calc(100%-13rem)]","-z-10","transform-gpu","overflow-hidden","blur-3xl","sm:top-[calc(100%-30rem)]"],[1,"relative","left-[calc(50%+3rem)]","aspect-[1155/678]","w-[36.125rem]","-translate-x-1/2","bg-gradient-to-tr","from-[#d8755a]","to-[rgb(252,237,137)]","opacity-30","sm:left-[calc(50%+36rem)]","sm:w-[72.1875rem]",2,"clip-path",`polygon(
              74.1% 44.1%,
              100% 61.6%,
              97.5% 26.9%,
              85.5% 0.1%,
              80.7% 2%,
              72.5% 32.5%,
              60.2% 62.4%,
              52.4% 68.1%,
              47.5% 58.3%,
              45.2% 34.5%,
              27.5% 76.7%,
              0.1% 64.9%,
              17.9% 100%,
              27.6% 76.8%,
              76.1% 97.7%,
              74.1% 44.1%
            )`],[1,"text-sm","font-semibold","leading-6","text-gray-900"],[1,"btn","btn-sm",3,"click"]],template:function(t,n){t&1&&(Sh(),Se(0,"div",0)(1,"header",1)(2,"nav",2)(3,"div",3)(4,"a",4)(5,"span",5),Ke(6,"Move playground"),Ie(),mt(7,"img",6),Ie()(),Se(8,"div",7),qn(9,rEe,4,1,"div",8),Ie()()(),Se(10,"div",9)(11,"div",10),mt(12,"div",11),Ie(),Se(13,"div",12),Ih(14),Ie(),Se(15,"div",13),mt(16,"div",14),Ie()()(),mt(17,"app-footer")),t&2&&(It(9),fr("ngIf",n.user))},dependencies:[_i,ao,Ci]})};var nEe=["*"],ek=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-alert-warning"]],standalone:!0,features:[At],ngContentSelectors:nEe,decls:5,vars:0,consts:[["role","alert",1,"alert","alert-warning"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"h-6","w-6","shrink-0","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"]],template:function(t,n){t&1&&(Sh(),Se(0,"div",0),su(),Se(1,"svg",1),mt(2,"path",2),Ie(),Ch(),Se(3,"span"),Ih(4),Ie()())}})};var oEe=["*"],uv=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-alert-error"]],standalone:!0,features:[At],ngContentSelectors:oEe,decls:5,vars:0,consts:[["role","alert",1,"alert","alert-error"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"h-6","w-6","shrink-0","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"]],template:function(t,n){t&1&&(Sh(),Se(0,"div",0),su(),Se(1,"svg",1),mt(2,"path",2),Ie(),Ch(),Se(3,"span"),Ih(4),Ie()())}})};var sEe=["*"],pv=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-alert-info"]],standalone:!0,features:[At],ngContentSelectors:sEe,decls:5,vars:0,consts:[["role","alert",1,"alert"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-info","h-6","w-6","shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"]],template:function(t,n){t&1&&(Sh(),Se(0,"div",0),su(),Se(1,"svg",1),mt(2,"path",2),Ie(),Ch(),Se(3,"span"),Ih(4),Ie()())}})};function iEe(r,e){r&1&&mt(0,"span",9)}function aEe(r,e){if(r&1){let t=ed();Se(0,"button",5),mr("click",function(){_a(t);let o=Dn();return Sa(o.askCameraAccess())}),qn(1,iEe,1,0,"span",6),su(),Se(2,"svg",7),mt(3,"path",8),Ie(),Ke(4," START "),Ie()}if(r&2){let t=Dn();It(),fr("ngIf",t.started)}}function cEe(r,e){r&1&&(Se(0,"app-alert-warning"),Ke(1," Please make sure to open this page in Internet browser that has access to a camera. "),Ie())}function lEe(r,e){if(r&1&&(Se(0,"app-alert-error")(1,"p"),Ke(2,"An error happened when trying to access the camera"),Ie(),Se(3,"p"),Ke(4),Ie()()),r&2){let t=Dn(2);It(4),Ia(t.error)}}function uEe(r,e){if(r&1){let t=ed();Se(0,"div")(1,"app-alert-info"),Ke(2," We found a camera in your browser, we are ready, what game you want to play? "),Ie(),Se(3,"button",10),mr("click",function(){_a(t);let o=Dn(2);return Sa(o.balloonsGame(2))}),Ke(4," PLAY CATCH BALLS \u26BD\u{1F3C0} (2 MINUTES) "),Ie(),Se(5,"button",10),mr("click",function(){_a(t);let o=Dn(2);return Sa(o.balloonsGame(0))}),Ke(6," PLAY CATCH BALLS \u26BD\u{1F3C0} (FREE TIME) "),Ie()()}}function pEe(r,e){if(r&1&&(Se(0,"div"),qn(1,cEe,2,0,"app-alert-warning",4)(2,lEe,5,1,"app-alert-error",4)(3,uEe,7,0,"div",4),Ie()),r&2){let t=Dn();It(),fr("ngIf",!t.mediaAPIAvailable),It(),fr("ngIf",t.error),It(),fr("ngIf",t.ready)}}var tk=class r{constructor(e){this.router=e}started=!1;mediaAPIAvailable=!1;ready=!1;error;balloonsGame(e){this.router.navigate(["/user/balloons",e])}ticTacToeGame(){this.router.navigate(["/user/lobby/tic-tac-toe"])}askCameraAccess(){return M(this,null,function*(){this.checkIfMediaIsAvailable(),this.started=!0,console.log("ask camera access");try{yield x0(v0({videoAccess:this.getVideoAccess(),delay:ax(3e3)})),this.ready=!0,this.error=void 0}catch(e){console.error("Camera is not available",e),this.ready=!1,this.error=t6(e)}})}checkIfMediaIsAvailable(){navigator.mediaDevices?this.mediaAPIAvailable=!0:this.mediaAPIAvailable=!1}getVideoAccess(){return M(this,null,function*(){console.log("start to get media device");let e=yield navigator.mediaDevices.getUserMedia({video:!0});console.log("media device found",e)})}static \u0275fac=function(t){return new(t||r)(We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-welcome-page"]],standalone:!0,features:[At],decls:12,vars:2,consts:[[1,"text-center","py-8"],[1,"mt-6","text-lg","leading-8","text-gray-600"],[1,"mt-10","flex","flex-col","items-center","justify-center","gap-y-6"],["class","btn btn-large  btn-accent",3,"click",4,"ngIf"],[4,"ngIf"],[1,"btn","btn-large","btn-accent",3,"click"],["class","loading loading-spinner",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"],[1,"loading","loading-spinner"],[1,"btn","btn-lg","btn-primary","m-4",3,"click"]],template:function(t,n){t&1&&(Se(0,"app-common-page")(1,"div",0)(2,"p",1),Ke(3," To start, you'll need to allow camera access. "),mt(4,"br"),Ke(5,"Click on START and follow the prompt, "),mt(6,"br"),Ke(7,`click "Allow," and you're good to go! `),Ie(),Se(8,"div",2)(9,"div"),qn(10,aEe,5,1,"button",3),Ie(),qn(11,pEe,4,3,"div",4),Ie()()()),t&2&&(It(10),fr("ngIf",!n.ready),It(),fr("ngIf",n.started))},dependencies:[ao,Ci,mu,ek,uv,pv],styles:[".big-buttons[_ngcontent-%COMP%]{margin:10px}"]})};var Lh=class r{fps=10;lastFrameTime=0;running=!1;render;static getInstance(){return new r}constructor(){this.render=new Yr}setup(e){this.fps=e,this.lastFrameTime=0}start(){this.running=!0,this.lastFrameTime=performance.now(),this.animate()}stop(){this.running=!1,this.lastFrameTime=performance.now()}animate(){requestAnimationFrame(e=>{let t=e-this.lastFrameTime,n=1e3/this.fps;t>=n&&(this.lastFrameTime=e-t%n,this.render.next(t)),this.running&&this.animate()})}};var Vh=class r{poses=new Yr;handDetected=new Yr;constructor(){}moveHand(e){this.handDetected.next(e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var rk=class r{constructor(e){this.poseState=e;this.refresh=Lh.getInstance()}canvas;ctx;balloons=[];MAX_LINES=4;BALLOON_RADIUS=30;MIN_BALLOONS=5;lines=[];currentLine=this.MAX_LINES-1;green=new tn;red=new tn;time=new tn;drawPositionsEnabled=!1;totalGameTime=12e4;currentTime=0;refresh;possiblePositions=[];handDetectedSubscription;ngOnInit(){this.setup(),this.calculateLines(),this.possiblePositions=this.calculatePossiblePositions(5),this.start(),this.handDetectedSubscription=this.poseState.handDetected.subscribe(e=>{this.didHandPopBalloon(e)})}didHandPopBalloon(e){this.balloons.forEach(t=>{Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)<t.radius&&this.popBalloon(t,`hand-${e.name}`)})}calculateLines(){let n=this.canvas.height-50-50,o=Math.floor(n/this.MAX_LINES),s=o/2;for(let i=1;i<=this.MAX_LINES;i++){let a=50+(o*i-s);this.lines.push(a)}console.log("lines",this.lines,this.currentLine)}setup(){this.canvas=document.getElementById("gameCanvas");let e=this.canvas.getContext("2d");if(!e)throw new Error("Not able to get canvas context");this.ctx=e}start(){this.refresh.setup(10),this.refresh.render.subscribe(e=>{this.updateTimer(e),this.udpate()}),this.refresh.start()}udpate(){this.clearScreen(),this.removeOldRedBalloons(),this.keepMinimumAmountOfBalloons(),this.drawPossiblePositions(this.possiblePositions),this.drawAllBalloons(),this.drawImplosions(),this.time.emit(this.currentTime),this.checkGameTime()}checkGameTime(){this.totalGameTime>0&&this.currentTime>this.totalGameTime&&(this.clearScreen(),this.refresh.stop(),this.handDetectedSubscription&&this.handDetectedSubscription.unsubscribe())}drawImplosions(){this.balloons.forEach(e=>{e.imploding&&this.implodeBalloon(e)})}removeOldRedBalloons(){let e=performance.now();this.balloons=this.balloons.filter(t=>!(t.color==="red"&&e-t.creationTime>5e3))}keepMinimumAmountOfBalloons(){let e=this.MIN_BALLOONS-this.balloons.length;this.addBalloons(e)}updateTimer(e){this.currentTime+=e}clearScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawAllBalloons(){this.balloons.forEach(e=>{this.drawBalloon(e)})}drawBalloon(e){this.ctx.font=`${e.radius*2}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle";let t=e.color==="green"?"\u26BD":"\u{1F3C0}";this.ctx.fillText(t,e.x,e.y)}addBalloons(e){let t=[...this.possiblePositions];this.balloons.forEach(n=>{t=t.filter(o=>Math.sqrt((o.x-n.x)**2+(o.y-n.y)**2)>=this.BALLOON_RADIUS*2)});for(let n=0;n<e&&t.length>0;n++){let o=Math.floor(Math.random()*t.length),{x:s,y:i}=t.splice(o,1)[0],a={id:crypto.randomUUID(),x:s,y:i,color:Math.random()>.5?"green":"red",radius:this.BALLOON_RADIUS,popped:!1,creationTime:performance.now(),implosionStartTime:0,imploding:!1};this.balloons.push(a)}}calculatePossiblePositions(e){let t=[],n=this.BALLOON_RADIUS*2,o=this.BALLOON_RADIUS*2+n,s=this.canvas.width;return this.lines.forEach(i=>{let a=n;for(;a+this.BALLOON_RADIUS*2<=s;)t.push({x:a+this.BALLOON_RADIUS,y:i}),a+=o}),console.log("positions",t),t}drawPossiblePositions(e){this.drawPositionsEnabled&&(this.ctx.strokeStyle="#cccccc",this.ctx.lineWidth=2,e.forEach(({x:t,y:n})=>{this.ctx.beginPath(),this.ctx.arc(t,n,this.BALLOON_RADIUS,0,2*Math.PI),this.ctx.stroke()}))}popBalloon(e,t){console.log("balloon popped by",t),e.popped||(e.popped=!0,e.color==="green"?this.green.emit():this.red.emit(),this.implodeBalloon(e))}handleClick(e){if(!this.canvas){console.warn("No canvas defined yet...");return}let t=this.canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top;console.log("click",n,o),this.balloons.forEach(s=>{Math.sqrt((n-s.x)**2+(o-s.y)**2)<s.radius&&this.popBalloon(s,"mouse-click")})}implodeBalloon(e,t=500){e.imploding||(e.imploding=!0,e.implosionStartTime=performance.now(),console.log("start imploding"));let s=(performance.now()-(e.implosionStartTime??0))/t;e.radius=Math.max(e.radius*(1-s),0),s>=1&&(e.imploding=!1,this.balloons=this.balloons.filter(i=>i.id!==e.id))}static \u0275fac=function(t){return new(t||r)(We(Vh))};static \u0275cmp=Dt({type:r,selectors:[["app-green-balloon-game"]],hostBindings:function(t,n){t&1&&mr("click",function(s){return n.handleClick(s)},!1,Pj)},inputs:{drawPositionsEnabled:"drawPositionsEnabled",totalGameTime:"totalGameTime"},outputs:{green:"green",red:"red",time:"time"},standalone:!0,features:[At],decls:2,vars:0,consts:[[1,"canvas-container"],["id","gameCanvas","width","640","height","480"]],template:function(t,n){t&1&&(Se(0,"div",0),mt(1,"canvas",1),Ie())},styles:[".canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}"]})};function dEe(r,e,t,n){return Math.sqrt((t-r)**2+(n-e)**2)}function hEe(r,e){let t=Math.sqrt(r**2+e**2);return{x:r/t,y:e/t}}function fEe(r,e,t){let n=dEe(r.x,r.y,e.x,e.y),o={x:e.x-r.x,y:e.y-r.y},s=hEe(o.x,o.y),i=n*t;return{x:e.x+i*s.x,y:e.y+i*s.y}}function oK(r,e){return fEe(r,e,.25)}var mEe=["poseCanvas"],sK=["nose","left_eye","right_eye","left_ear","right_ear"],gEe=[["mouth_left","mouth_right"],["left_shoulder","right_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_shoulder","left_hip"],["right_shoulder","right_hip"],["left_hip","right_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_hip","right_knee"],["right_knee","right_ankle"],["left_ankle","left_foot_index"],["left_ankle","left_heel"],["right_ankle","right_foot_index"],["right_ankle","right_heel"]],nk=class r{constructor(e){this.poseState=e}canvasRef;poses=[];canvas;ctx;ngAfterViewInit(){this.canvas=this.canvasRef.nativeElement,this.ctx=this.canvas.getContext("2d"),this.drawPose()}ngOnChanges(){this.ctx&&(this.clearCanvas(),this.drawPose())}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawPose(){!this.poses||this.poses.length===0||this.poses.forEach(e=>{e.keypoints.forEach(n=>{["left_wrist","right_wrist"].includes(n.name)||sK.includes(n.name)||this.drawPoint(n.x,n.y,n.score)}),this.drawSkeletonWithStrings(e.keypoints),this.drawHeadCircleAroundCenter(e.keypoints),this.drawHandCirclesAroundCenter(e.keypoints)})}drawPoint(e,t,n){if(n>.5){let o=this.getColorForConfidence(n);this.ctx.beginPath(),this.ctx.arc(e,t,5,0,2*Math.PI),this.ctx.fillStyle=o,this.ctx.fill()}}getColorForConfidence(e){let t=(e-.5)*2;return`hsl(${Math.floor(t*120)}, 100%, 50%)`}drawSkeletonWithStrings(e){let t=e.reduce((n,o)=>(o.name&&(n[o.name]=o),n),{});gEe.forEach(([n,o])=>{let s=t[n],i=t[o];s&&i&&s.score>.5&&i.score>.5&&(this.ctx.beginPath(),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(i.x,i.y),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.stroke())})}drawHeadCircleAroundCenter(e){let t=this.createKeypointMap(e);this.drawCircleForHead(sK,t)}drawCircleForHead(e,t){let n=e.map(o=>t[o]).filter(o=>o&&o.score>.5);if(n.length>0){let o=this.calculateCenter(n);this.ctx.beginPath(),this.ctx.arc(o.x,o.y,60,0,2*Math.PI),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.stroke()}}drawHandCirclesAroundCenter(e){let t=this.createKeypointMap(e),n=this.drawCircleForHand("left","left_elbow","left_wrist",t),o=this.drawCircleForHand("right","right_elbow","right_wrist",t);n&&this.poseState.moveHand(n),o&&this.poseState.moveHand(o)}drawCircleForHand(e,t,n,o){let s=o[t],i=o[n];if(s&&i&&s.score>.5&&i.score>.5){let a=oK(s,i);return this.ctx.beginPath(),this.ctx.arc(a.x,a.y,20,0,2*Math.PI),this.ctx.strokeStyle="blue",this.ctx.lineWidth=3,this.ctx.stroke(),{name:e,x:a.x,y:a.y,radius:20}}}calculateCenter(e){let t=e.length,n=e.reduce((o,s)=>(o.x+=s.x,o.y+=s.y,o),{x:0,y:0});return{x:n.x/t,y:n.y/t}}createKeypointMap(e){return e.reduce((t,n)=>(n.name&&(t[n.name]=n),t),{})}static \u0275fac=function(t){return new(t||r)(We(Vh))};static \u0275cmp=Dt({type:r,selectors:[["app-pose-drawer"]],viewQuery:function(t,n){if(t&1&&Nx(mEe,5),t&2){let o;ig(o=ag())&&(n.canvasRef=o.first)}},inputs:{poses:"poses"},standalone:!0,features:[mc,At],decls:3,vars:0,consts:[["poseCanvas",""],["width","640","height","480"]],template:function(t,n){t&1&&(Se(0,"div"),mt(1,"canvas",1,0),Ie())},styles:["canvas[_ngcontent-%COMP%]{border:1px solid black}"]})};var Nee=Wp(aK());var dd=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},Sc=class{refCount(e){return Ti("refCount")}incRef(e){return Ti("incRef")}timerAvailable(){return!0}time(e){return Ti("time")}read(e){return Ti("read")}readSync(e){return Ti("readSync")}readToGPU(e,t){return Ti("readToGPU")}numDataIds(){return Ti("numDataIds")}disposeData(e,t){return Ti("disposeData")}write(e,t,n){return Ti("write")}move(e,t,n,o,s){return Ti("move")}createTensorFromGPUData(e,t,n){return Ti("createTensorFromGPUData")}memory(){return Ti("memory")}floatPrecision(){return Ti("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Ti("dispose")}};function Ti(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function cK(r){let e=r.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,ok(r,e,t)}function yEe(r,e){if(r.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${r.length}Second array length was ${e.length}`);let t=r.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,ok(r,t,n),ok(e,t,n)}function dv(r,e,t){return Math.max(r,Math.min(e,t))}function xEe(r){return r%2===0?r:r+1}function ok(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}function vEe(r){let e=0;for(let t=0;t<r.length;t++)e+=r[t];return e}function bEe(r,e){let t=Math.random();return e*t+(1-t)*r}function wEe(r,e){let t=0;for(let n=0;n<r.length;n++){let o=Number(r[n])-Number(e[n]);t+=o*o}return t}function $(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function On(r,e,t=""){$(ki(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function ta(r){$(r!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Vt(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function CEe(r){return r.length===0}function PL(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function ki(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function hd(r){return r%1===0}function _Ee(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;{let e=Math.exp(2*r);return(e-1)/(e+1)}}function SEe(r){let e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function IEe(r){let e=new Uint32Array(r);for(let t=0;t<r;++t)e[t]=t;return cK(e),e}function Dg(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function TEe(r,e=o=>0,t,n){return new Promise((o,s)=>{let i=0,a=()=>{if(r()){o();return}i++;let c=e(i);if(t!=null&&i>=t){s();return}n!=null?n(a,c):setTimeout(a,c)};a()})}function kEe(r,e){let t=1,n=-1;for(let s=0;s<r.length;++s)if(r[s]>=0)t*=r[s];else if(r[s]===-1){if(n!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${n} and dim ${s}`);n=s}else if(r[s]<0)throw Error(`Shapes can not be < 0. Found ${r[s]} at dim ${s}`);if(n===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${r}`);return r}if(t===0)throw Error(`Cannot infer the missing size in [${r}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);let o=r.slice();return o[n]=e/t,o}function Yn(r,e){let t=e.length;return r=r==null?e.map((n,o)=>o):[].concat(r),$(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),$(r.every(n=>hd(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function $L(r,e){let t=[],n=[],o=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||o?null:Yn(e,r).sort(),i=0;for(let a=0;a<r.length;++a){if(s!=null){if(s[i]===a&&r[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${r[a]}' is not 1`);(s[i]==null||s[i]>a)&&r[a]===1&&(t.push(r[a]),n.push(a)),s[i]<=a&&i++}r[a]!==1&&(t.push(r[a]),n.push(a))}return{newShape:t,keptDims:n}}function LL(r,e){return sk(r,e)}function sk(r,e){let t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error(`Unknown data type ${r}`);return t}function VL(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function BL(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function EEe(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function hv(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function zL(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function fv(r){return typeof r=="string"||r instanceof String}function lK(r){return typeof r=="boolean"}function uK(r){return typeof r=="number"}function Bh(r){return Array.isArray(r)?Bh(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":uK(r)?"float32":fv(r)?"string":lK(r)?"bool":"float32"}function mv(r){return!!(r&&r.constructor&&r.call&&r.apply)}function gv(r,e){for(let t=e;t<r;++t)if(r%t===0)return t;return r}function gu(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function pK(r,e,t,n=!1){let o=new Array;if(e.length===1){let s=e[0]*(n?2:1);for(let i=0;i<s;i++)o[i]=t[r+i]}else{let s=e[0],i=e.slice(1),a=i.reduce((c,l)=>c*l)*(n?2:1);for(let c=0;c<s;c++)o[c]=pK(r+c*a,i,t,n)}return o}function Ng(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((o,s)=>o*s)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return pK(0,r,e,t)}function NEe(r,e){if(Array.isArray(r))return r;if(e==="float32")return r instanceof Float32Array?r:new Float32Array(r);if(e==="int32")return r instanceof Int32Array?r:new Int32Array(r);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(r));throw new Error(`Unknown dtype ${e}`)}function KC(r,e){let t=yv(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function yv(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function DEe(r,e){let t=r.reduce((n,o)=>n*o,1);if(e==null||e==="float32")return Ng(r,new Float32Array(t));if(e==="int32")return Ng(r,new Int32Array(t));if(e==="bool")return Ng(r,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function dn(r){r.forEach(e=>{$(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function AEe(r,e,t){if(e===0)return 0;if(e===1)return r[0];let n=r[r.length-1];for(let o=0;o<r.length-1;++o)n+=t[o]*r[o];return n}function REe(r,e,t){if(e===0)return[];if(e===1)return[r];let n=new Array(e);for(let o=0;o<n.length-1;++o)n[o]=Math.floor(r/t[o]),r-=n[o]*t[o];return n[n.length-1]=r,n}function Ag(r){return r&&r.then&&typeof r.then=="function"}var dK="tfjsflags",XC=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=MEe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let o=this.urlFlags[e];Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}getAsync(e){return M(this,null,function*(){return e in this.flags?this.flags[e]:(this.flags[e]=yield this.evaluateFlag(e),this.flags[e])})}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Ag(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);dK in e&&e[dK].split(",").forEach(n=>{let[o,s]=n.split(":");this.urlFlags[o]=PEe(o,s)})}};function MEe(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(FEe(e,n[0],n[1]),n.join("="))),e}function FEe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function PEe(r,e){let t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function Z(){return UL}var UL=null;function hK(r){UL=r}var GL;function WL(){if(GL==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");GL=r}return GL}function $Ee(){let r=WL();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function YC(r,e){let t=$Ee();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}var yu="Abs",Ic="Acos",Tc="Acosh",ra="Add",xu="AddN",zh="All",Uh="Any",vu="ArgMax",bu="ArgMin",kc="Asin",Ec="Asinh",Nc="Atan",Dc="Atanh",Ac="Atan2",wu="AvgPool",Gh="AvgPoolGrad",Cu="AvgPool3D",Wh="AvgPool3DGrad",_u="BatchMatMul",Su="BatchToSpaceND",jh="Bincount",Rg="BitwiseAnd",fK="BroadcastTo",Hh="BroadcastArgs",Da="Cast",Rc="Ceil",Oc="ClipByValue",qh="Complex",Iu="ComplexAbs",Tu="Concat",ku="Conv2D",Kh="Conv2DBackpropFilter",Eu="Conv2DBackpropInput",Nu="Conv3D",Xh="Conv3DBackpropFilterV2",Yh="Conv3DBackpropInputV2",Mc="Cos",Fc="Cosh",Zh="Cumprod",Du="Cumsum",Qh="CropAndResize",Jh="DenseBincount",ef="DepthToSpace",Au="DepthwiseConv2dNative",tf="DepthwiseConv2dNativeBackpropFilter",rf="DepthwiseConv2dNativeBackpropInput",nf="Diag",Ru="Dilation2D",Og="Dilation2DBackpropInput",Mg="Dilation2DBackpropFilter",Fg="Draw",Pc="RealDiv",of="Einsum",$c="Elu",sf="EluGrad",Lc="Erf",fd="Equal",Vc="Exp",Ou="ExpandDims",Bc="Expm1",af="FFT",cf="Fill",lf="FlipLeftRight",zc="Floor",Uc="FloorDiv",Mu="FusedBatchNorm",Fu="GatherV2",uf="GatherNd",md="Greater",Gc="GreaterEqual",Aa="Identity",pf="IFFT",df="Imag",Wc="IsFinite",jc="IsInf",Hc="IsNan",Pu="LeakyRelu",gd="Less",yd="LessEqual",hf="LinSpace",qc="Log",Kc="Log1p",xd="LogicalAnd",vd="LogicalNot",bd="LogicalOr";var mK="LogSoftmax";var $u="LRN",ff="LRNGrad";var Lu="Max",Xc="Maximum",Vu="MaxPool",mf="MaxPoolGrad",Bu="MaxPool3D",gf="MaxPool3DGrad",yf="MaxPoolWithArgmax",zu="Mean",Uu="Min",Yc="Minimum",Gu="MirrorPad",Zc="Mod",xf="Multinomial",Qc="Multiply",Wu="Neg",wd="NotEqual",vf="NonMaxSuppressionV3",xv="NonMaxSuppressionV4",bf="NonMaxSuppressionV5",ju="OnesLike",Hu="OneHot",qu="Pack",Ku="PadV2";var Jc="Pow",Xu="Prelu",Yu="Prod",vv="RaggedGather",bv="RaggedRange",wv="RaggedTensorToTensor",wf="Range",Cf="Real",el="Reciprocal",tl="Relu",Zu="Reshape",Qu="ResizeNearestNeighbor",_f="ResizeNearestNeighborGrad",Ju="ResizeBilinear",Sf="ResizeBilinearGrad",rl="Relu6",ep="Reverse",nl="Round",ol="Rsqrt",If="ScatterNd",Tf="TensorScatterUpdate",kf="SearchSorted",tp="Select",sl="Selu",rp="Slice",il="Sin",al="Sinh",cl="Sign",ll="Sigmoid",ul="Softplus",pl="Sqrt",np="Sum",op="SpaceToBatchND",sp="SplitV",ip="Softmax",Cv="SparseFillEmptyRows",_v="SparseReshape",Ef="SparseSegmentMean",Nf="SparseSegmentSum",Df="SparseToDense",dl="SquaredDifference",Af="Square",Pg="StaticRegexReplace",Rf="StridedSlice",Of="StringNGrams",Sv="StringSplit",Iv="StringToHashBucketFast",hl="Sub",fl="Tan",ml="Tanh",Ra="Tile",Mf="TopK",Ff="Transform",Oa="Transpose",Tv="Unique",ap="Unpack",cp="UnsortedSegmentSum";var lp="ZerosLike",gl="Step",$g="FromPixels",Pf="RotateWithOffset",Cd="_FusedMatMul",_d="FusedConv2D",Sd="FusedDepthwiseConv2D";function up(...r){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.warn(...r)}function LEe(...r){Z().getBool("IS_TEST")||Z().getBool("PROD")||console.log(...r)}var ik=YC("kernelRegistry",()=>new Map),jL=YC("gradRegistry",()=>new Map);function kv(r,e){let t=xK(r,e);return ik.get(t)}function HL(r){return jL.get(r)}function qL(r){let e=ik.entries(),t=[];for(;;){let{done:n,value:o}=e.next();if(n)break;let[s,i]=o,[a]=s.split("_");a===r&&t.push(i)}return t}function Ev(r){let{kernelName:e,backendName:t}=r,n=xK(e,t);ik.has(n)&&up(`The kernel '${e}' for backend '${t}' is already registered`),ik.set(n,r)}function yK(r){let{kernelName:e}=r;jL.has(e)&&Z().getBool("DEBUG")&&up(`Overriding the gradient for '${e}'`),jL.set(e,r)}function xK(r,e){return`${e}_${r}`}var C={};Nr(C,{arraysEqual:()=>ki,arraysEqualWithNull:()=>PL,assert:()=>$,assertNonNegativeIntegerDimensions:()=>dn,assertNonNull:()=>ta,assertShapesMatch:()=>On,bytesFromStringArray:()=>zL,bytesPerElement:()=>hv,checkConversionForErrors:()=>VL,clamp:()=>dv,computeStrides:()=>gu,convertBackendValuesAndArrayBuffer:()=>NEe,createScalarValue:()=>jEe,createShuffledIndices:()=>IEe,decodeString:()=>Ov,distSquared:()=>wEe,encodeString:()=>Rv,fetch:()=>qEe,fingerPrint64:()=>WEe,flatten:()=>Lf,getArrayFromDType:()=>sk,getTypedArrayFromDType:()=>LL,hasEncodingLoss:()=>EEe,hexToLong:()=>ZC,indexToLoc:()=>REe,inferDtype:()=>Bh,inferFromImplicitShape:()=>kEe,isBoolean:()=>lK,isFunction:()=>mv,isInt:()=>hd,isNumber:()=>uK,isPromise:()=>Ag,isScalarShape:()=>CEe,isString:()=>fv,isTypedArray:()=>cs,isValidDtype:()=>BL,locToIndex:()=>AEe,makeOnesTypedArray:()=>KC,makeZerosNestedTypedArray:()=>DEe,makeZerosTypedArray:()=>yv,nearestDivisor:()=>gv,nearestLargerEven:()=>xEe,now:()=>Ug,parseAxisParam:()=>Yn,randUniform:()=>bEe,repeatedTry:()=>TEe,rightPad:()=>Dg,shuffle:()=>cK,shuffleCombo:()=>yEe,sizeFromShape:()=>Vt,sizeToSquarishShape:()=>SEe,squeezeShape:()=>$L,sum:()=>vEe,swap:()=>ok,tanh:()=>_Ee,toNestedArray:()=>Ng,toTypedArray:()=>Av});function ak(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var ZL=Wp(NK());var zg=ZL.default||ZL;function ZC(r){return zg.fromString(r,!0,16)}var AK=ZC("c3a5c85c97cb3127"),Bg=ZC("b492b66fbe98f273"),Ss=ZC("9ae16a3b2f90404f");function YL(r){return r.xor(r.shru(47))}function RK(r,e,t){let n=r.slice(e,e+t);return zg.fromBytes(Array.from(n),!0,!0)}function hn(r,e){return RK(r,e,8)}function DK(r,e){return RK(r,e,4)}function Bo(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function $f(r,e,t=ZC("9ddfea08eb382d69")){let n=r.xor(e).mul(t);n=n.xor(n.shru(47));let o=e.xor(n).mul(t);return o=o.xor(o.shru(47)),o=o.mul(t),o}function BEe(r,e,t,n,o,s){o=o.add(r),s=Bo(s.add(o).add(n),21);let i=o;return o=o.add(e),o=o.add(t),s=s.add(Bo(o,44)),[o.add(n),s.add(i)]}function lk(r,e,t,n){return BEe(hn(r,e),hn(r,e+8),hn(r,e+16),hn(r,e+24),t,n)}function zEe(r,e=r.length){if(e>=8){let t=Ss.add(e*2),n=hn(r,0).add(Ss),o=hn(r,e-8),s=Bo(o,37).mul(t).add(n),i=Bo(n,25).add(o).mul(t);return $f(s,i,t)}if(e>=4){let t=Ss.add(e*2),n=DK(r,0);return $f(n.shl(3).add(e),DK(r,e-4),t)}if(e>0){let t=r[0],n=r[e>>1],o=r[e-1],s=t+(n<<8),i=e+(o<<2);return YL(Ss.mul(s).xor(AK.mul(i))).mul(Ss)}return Ss}function UEe(r,e=r.length){let t=Ss.add(e*2),n=hn(r,0).mul(Bg),o=hn(r,8),s=hn(r,e-8).mul(t),i=hn(r,e-16).mul(Ss);return $f(Bo(n.add(o),43).add(Bo(s,30)).add(i),n.add(Bo(o.add(Ss),18)).add(s),t)}function GEe(r,e=r.length){let t=Ss.add(e*2),n=hn(r,0).mul(Ss),o=hn(r,8),s=hn(r,e-8).mul(t),i=hn(r,e-16).mul(Ss),a=Bo(n.add(o),43).add(Bo(s,30)).add(i),c=$f(a,n.add(Bo(o.add(Ss),18)).add(s),t),l=hn(r,16).mul(t),u=hn(r,24),p=a.add(hn(r,e-32)).mul(t),d=c.add(hn(r,e-24)).mul(t);return $f(Bo(l.add(u),43).add(Bo(p,30)).add(d),l.add(Bo(u.add(n),18)).add(p),t)}function WEe(r,e=r.length){let t=zg.fromNumber(81,!0);if(e<=32)return e<=16?zEe(r,e):UEe(r,e);if(e<=64)return GEe(r,e);let n=t,o=t.mul(Bg).add(113),s=YL(o.mul(Ss).add(113)).mul(Ss),i=[zg.UZERO,zg.UZERO],a=[zg.UZERO,zg.UZERO];n=n.mul(Ss).add(hn(r,0));let c=0,l=(e-1>>6)*64,u=l+(e-1&63)-63;do n=Bo(n.add(o).add(i[0]).add(hn(r,c+8)),37).mul(Bg),o=Bo(o.add(i[1]).add(hn(r,c+48)),42).mul(Bg),n=n.xor(a[1]),o=o.add(i[0]).add(hn(r,c+40)),s=Bo(s.add(a[0]),33).mul(Bg),i=lk(r,c,i[1].mul(Bg),n.add(a[0])),a=lk(r,c+32,s.add(a[1]),o.add(hn(r,c+16))),[s,n]=[n,s],c+=64;while(c!==l);let p=Bg.add(s.and(255).shl(1));return c=u,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),n=Bo(n.add(o).add(i[0]).add(hn(r,c+8)),37).mul(p),o=Bo(o.add(i[1]).add(hn(r,c+48)),42).mul(p),n=n.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(hn(r,c+40))),s=Bo(s.add(a[0]),33).mul(p),i=lk(r,c,i[1].mul(p),n.add(a[0])),a=lk(r,c+32,s.add(a[1]),o.add(hn(r,c+16))),[s,n]=[n,s],$f($f(i[0],a[0],p).add(YL(o).mul(AK)).add(s),$f(i[1],a[1],p).add(n),p)}function jEe(r,e){return e==="string"?Rv(r):Av([r],e)}function HEe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function Av(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Lf(r)),Z().getBool("DEBUG")&&VL(r,e),HEe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Ug(){return Z().platform.now()}function qEe(r,e){return Z().platform.fetch(r,e)}function Rv(r,e="utf-8"){return e=e||"utf-8",Z().platform.encode(r,e)}function Ov(r,e="utf-8"){return e=e||"utf-8",Z().platform.decode(r,e)}function cs(r){return Z().platform.isTypedArray!=null?Z().platform.isTypedArray(r):ak(r)}function Lf(r,e=[],t=!1){if(e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||Ag(r)||r==null||cs(r)&&t)e.push(r);else if(Array.isArray(r)||cs(r))for(let n=0;n<r.length;++n)Lf(r[n],e,t);else{let n=-1;for(let o of Object.keys(r))/^([1-9]+[0-9]*|0)$/.test(o)&&(n=Math.max(n,Number(o)));for(let o=0;o<=n;o++)Lf(r[o],e,t)}return e}var uk=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new QL)}profileKernel(e,t,n){let o,s=()=>{o=n()},i,a=Ug();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{s();for(let l of o)l.dataSync();i=Promise.resolve({kernelMs:Ug()-a})}if(Z().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<o.length;l++){let u=o[l];u.data().then(p=>{KEe(p,u.dtype,e)})}return{kernelName:e,outputs:o,inputs:t,timeMs:i.then(l=>l.kernelMs),extraInfo:i.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:o,inputs:s,extraInfo:i}=e;n.forEach(a=>{Promise.all([a.data(),o,i]).then(c=>{this.logger.logKernelProfile(t,a,c[0],c[1],s,c[2])})})}};function KEe(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let o=r[n];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${t}'`),!0}return!1}var QL=class{logKernelProfile(e,t,n,o,s,i){let a=typeof o=="number"?Dg(`${o}ms`,9):o.error,c=Dg(e,25),l=t.rank,u=t.size,p=Dg(t.shape.toString(),14),d="";for(let h in s){let f=s[h];if(f!=null){let m=f.shape||t.shape,g=m.length;d+=`${h}: ${g}D ${g>0?m:""} `}}console.log(`%c${c}	%c${a}	%c${l}D ${p}	%c${u}	%c${d}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function OK(r,e,t){let n={},o={};for(let c=0;c<e.length;c++)n[e[c].id]=!0;for(let c=0;c<r.length;c++){let l=r[c],u=l.inputs;for(let p in u){let d=u[p],h=!1;for(let f=0;f<e.length;f++)if(n[d.id]){l.outputs.forEach(m=>n[m.id]=!0),h=!0,o[l.id]=!0;break}if(h)break}}let s={};s[t.id]=!0;let i={};for(let c=r.length-1;c>=0;c--){let l=r[c],u=l.inputs;for(let p=0;p<l.outputs.length;p++)if(s[l.outputs[p].id]){for(let d in u)s[u[d].id]=!0,i[l.id]=!0;break}}let a=[];for(let c=0;c<r.length;c++){let l=r[c];if(o[l.id]&&i[l.id]){let u={};for(let d in l.inputs){let h=l.inputs[d];n[h.id]&&(u[d]=h)}let p=Object.assign({},l);p.inputs=u,p.outputs=l.outputs,a.push(p)}}return a}function MK(r,e,t,n){for(let o=e.length-1;o>=0;o--){let s=e[o],i=[];if(s.outputs.forEach(c=>{let l=r[c.id];l!=null?i.push(l):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let a=s.gradient(i);for(let c in s.inputs){if(!(c in a))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(a)}.`);let l=t(()=>a[c]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${l.dtype}'`);let u=s.inputs[c];if(!ki(l.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${c}' has shape '${l.shape}', which does not match the shape of the input '${u.shape}'`);if(r[u.id]==null)r[u.id]=l;else{let p=r[u.id];r[u.id]=n(p,l),p.dispose()}}}}var FK=20,QC=3,JL=7;function PK(r,e,t,n){let o=gu(e),s=XEe(r,e,t,o),i=e.length,a=pk(r,e,t,o,s),c=["Tensor"];return n&&(c.push(`  dtype: ${t}`),c.push(`  rank: ${i}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(a.map(l=>"    "+l).join(`
`)),c.join(`
`)}function XEe(r,e,t,n){let o=Vt(e),s=n[n.length-1],i=new Array(s).fill(0),a=e.length,c=t==="complex64"?e_(r):r;if(a>1)for(let l=0;l<o/s;l++){let u=l*s;for(let p=0;p<s;p++)i[p]=Math.max(i[p],JC(c[u+p],0,t).length)}return i}function JC(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(JL))} + ${parseFloat(r[1].toFixed(JL))}j`:fv(r)?n=`'${r}'`:t==="bool"?n=$K(r):n=parseFloat(r.toFixed(JL)).toString(),Dg(n,e)}function $K(r){return r===0?"false":"true"}function pk(r,e,t,n,o,s=!0){let i=t==="complex64"?2:1,a=e[0],c=e.length;if(c===0){if(t==="complex64"){let m=e_(r);return[JC(m[0],0,t)]}return t==="bool"?[$K(r[0])]:[r[0].toString()]}if(c===1){if(a>FK){let g=QC*i,y=Array.from(r.slice(0,g)),x=Array.from(r.slice((a-QC)*i,a*i));return t==="complex64"&&(y=e_(y),x=e_(x)),["["+y.map((b,w)=>JC(b,o[w],t)).join(", ")+", ..., "+x.map((b,w)=>JC(b,o[a-QC+w],t)).join(", ")+"]"]}return["["+(t==="complex64"?e_(r):Array.from(r)).map((g,y)=>JC(g,o[y],t)).join(", ")+"]"]}let l=e.slice(1),u=n.slice(1),p=n[0]*i,d=[];if(a>FK){for(let m=0;m<QC;m++){let g=m*p,y=g+p;d.push(...pk(r.slice(g,y),l,t,u,o,!1))}d.push("...");for(let m=a-QC;m<a;m++){let g=m*p,y=g+p;d.push(...pk(r.slice(g,y),l,t,u,o,m===a-1))}}else for(let m=0;m<a;m++){let g=m*p,y=g+p;d.push(...pk(r.slice(g,y),l,t,u,o,m===a-1))}let h=c===2?",":"";d[0]="["+(a>0?d[0]+h:"");for(let m=1;m<d.length-1;m++)d[m]=" "+d[m]+h;let f=`,
`;for(let m=2;m<c;m++)f+=`
`;return d[d.length-1]=" "+d[d.length-1]+"]"+(s?"":f),d}function e_(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var ur=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=Vt(e),n!=null){let o=n.length;$(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||sk(t,this.size),this.strides=gu(e)}set(e,...t){t.length===0&&(t=[0]),$(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let o of e){if(o<0||o>=this.shape[t]){let s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}t++}let n=e[e.length-1];for(let o=0;o<e.length-1;++o)n+=this.strides[o]*e[o];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return xl().makeTensor(this.values,this.shape,this.dtype)}},xl=null,Mv=null,YEe=null;function LK(r){xl=r}function VK(r){Mv=r}function BK(r){YEe=r}var Ct=class{constructor(e,t,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Vt(e),this.strides=gu(e),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return M(this,null,function*(){let e=yield this.data();return Mv.buffer(this.shape,this.dtype,e)})}bufferSync(){return Mv.buffer(this.shape,this.dtype,this.dataSync())}array(){return M(this,null,function*(){let e=yield this.data();return Ng(this.shape,e,this.dtype==="complex64")})}arraySync(){return Ng(this.shape,this.dataSync(),this.dtype==="complex64")}data(){return M(this,null,function*(){this.throwIfDisposed();let e=xl().read(this.dataId);if(this.dtype==="string"){let t=yield e;try{return t.map(n=>Ov(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e})}dataToGPU(e){return this.throwIfDisposed(),xl().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=xl().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Ov(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}bytes(){return M(this,null,function*(){this.throwIfDisposed();let e=yield xl().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)})}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),xl().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Mv.print(this,e)}clone(){return this.throwIfDisposed(),Mv.clone(this)}toString(e=!1){let t=this.dataSync();return PK(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Mv.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),xl().makeVariable(this,e,t,n)}};Object.defineProperty(Ct,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function K(){return YC("Tensor",()=>Ct)}K();var Id=class extends Ct{constructor(e,t,n,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ki(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);xl().disposeTensor(this),this.dataId=e.dataId,xl().incRef(this,null)}dispose(){xl().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Id,Symbol.hasInstance,{value:r=>r instanceof Ct&&r.assign!=null&&r.assign instanceof Function});var zK=function(r){return r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64",r}(zK||{}),UK=function(r){return r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64",r}(UK||{}),GK=function(r){return r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64",r}(GK||{}),WK=function(r){return r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64",r}(WK||{}),ZEe={float32:GK,int32:zK,bool:UK,complex64:WK};function $r(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return ZEe[r][e]}function Td(r){return $r(r,"int32")}function dk(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function hk(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Bt(r,e){if(r.dtype===e.dtype)return[r,e];let t=$r(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function jK(r,e){$(r.dtype===e.dtype,()=>`The dtypes of the first(${r.dtype}) and second(${e.dtype}) input must match`)}function fk(r){let e=[];return HK(r,e,new Set),e}function HK(r,e,t){if(r==null)return;if(r instanceof Ct){e.push(r);return}if(!QEe(r))return;let n=r;for(let o in n){let s=n[o];t.has(s)||(t.add(s),HK(s,e,t))}}function QEe(r){return Array.isArray(r)||typeof r=="object"}function e3(r){return r.kernelName!=null}var mk=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},eNe=(()=>{class r{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new mk}ready(){return M(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let o=t[n];if(yield this.initializeBackend(o).success){yield this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){let{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,o=1){return t in this.registryFactory?(up(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:o},!0)}setBackend(t){return M(this,null,function*(){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;let{success:n,asyncInit:o}=this.initializeBackend(t);if(!(o?yield n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new uk(this.backendInstance),!0})}setupRegisteredKernels(){qL(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){qL(t).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[t])})}initializeBackend(t){let n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{let o=n.factory();if(o&&!(o instanceof Sc)&&typeof o.then=="function"){let s=++this.pendingBackendInitId,i=o.then(a=>s<this.pendingBackendInitId?!1:(this.registry[t]=a,this.pendingBackendInit=null,!0)).catch(a=>(s<this.pendingBackendInitId||(this.pendingBackendInit=null,up(`Initialization of backend ${t} failed`),up(a.stack||a.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[t]=o,{success:!0,asyncInit:!1}}catch(o){return up(`Initialization of backend ${t} failed`),up(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let o=t[n],{success:s,asyncInit:i}=this.initializeBackend(o);if(i||s)return{name:o,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){let o=this.state.tensorInfo.get(n),s=o.backend,i=this.readSync(n),a=s.refCount(n);s.disposeData(n,!0),o.backend=t,t.move(n,i,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let o=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}let s;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(s),()=>(s=n(),s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),s))}scopedRun(t,n,o){t();try{let s=o();return n(),s}catch(s){throw n(),s}}nextTensorId(){return r.nextTensorId++}nextVariableId(){return r.nextVariableId++}clone(t){let n=F.runKernel(Aa,{x:t}),o={x:t},s=a=>({x:()=>{let c="float32",l={x:a},u={dtype:c};return F.runKernel(Da,l,u)}}),i=[];return this.addTapeNode(this.state.activeScope.name,o,[n],s,i,{}),n}runKernel(t,n,o){if(this.backendName==null&&this.backend,!(kv(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,o){let s=this.backend.numDataIds(),i=0;o.forEach(l=>{i+=l.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],c=s-n-i-a;if(c>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${c} data ids) after running '${t}'`)}runKernelFunc(t){let n,o=[],s=this.isTapeOn(),i=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let c;this.backendName==null&&this.backend;let l,u=e3(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(e3(t)){let{kernelName:m,inputs:g,attrs:y}=t;this.backendName==null&&this.backend;let x=kv(m,this.backendName);$(x!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),c=()=>{let b=this.backend.numDataIds();l=x.kernelFunc({inputs:g,attrs:y,backend:this.backend});let w=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,w);let _=w.map(I=>I.rank!=null?I:this.makeTensorFromTensorInfo(I));if(s){let I=this.getTensorsForGradient(m,g,_);o=this.saveTensorsForBackwardMode(I)}return _}}else{let{forwardFunc:m}=t,g=y=>{s&&(o=y.map(x=>this.keep(this.clone(x))))};c=()=>{let y=this.backend.numDataIds();l=this.tidy(()=>m(this.backend,g));let x=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,y,x),x}}let{inputs:p,attrs:d}=t,h=e3(t)?null:t.backwardsFunc,f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=c():(f=this.profiler.profileKernel(u,p,()=>c()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),s&&this.addTapeNode(u,p,n,h,o,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(p).map(m=>p[m]!=null?p[m].shape:null),outputShapes:n.map(m=>m.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(t,n,o){let s=HL(t);if(s!=null){let i=s.inputsToSave||[],a=s.outputsToSave||[],c;s.saveAllInputs?($(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),c=Object.keys(n).map(u=>n[u])):c=i.map(u=>n[u]);let l=o.filter((u,p)=>a[p]);return c.concat(l)}return[]}makeTensor(t,n,o,s){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",s=s||this.backend;let i=t;o==="string"&&fv(t[0])&&(i=t.map(l=>Rv(l)));let a=s.write(i,n,o),c=new Ct(n,o,a,this.nextTensorId());if(this.trackTensor(c,s),o==="string"){let l=this.state.tensorInfo.get(a),u=zL(i);this.state.numBytes+=u-l.bytes,l.bytes=u}return c}makeTensorFromDataId(t,n,o,s){o=o||"float32";let i={dataId:t,shape:n,dtype:o};return this.makeTensorFromTensorInfo(i,s)}makeTensorFromTensorInfo(t,n){let{dataId:o,shape:s,dtype:i}=t,a=new Ct(s,i,o,this.nextTensorId());return this.trackTensor(a,n),a}makeVariable(t,n=!0,o,s){o=o||this.nextVariableId().toString(),s!=null&&s!==t.dtype&&(t=t.cast(s));let i=new Id(t,n,o,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let o=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(o=t.size*hv(t.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:o})),t instanceof Id||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;let n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){let o=t.size*hv(t.dtype);this.state.numBytes-=o}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(let t in this.state.registeredVariables){let n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){let t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}profile(t){return M(this,null,function*(){this.state.profiling=!0;let n=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(s=>s.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let s of this.state.activeProfile.kernels)s.kernelTimeMs=yield s.kernelTimeMs,s.extraInfo=yield s.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,o,s,i,a){let c={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:o,saved:i},l=HL(t);l!=null&&(s=l.gradFunc),s!=null&&(c.gradient=u=>(u=u.map((p,d)=>{if(p==null){let h=o[d],f=yv(h.size,h.dtype);return this.makeTensor(f,h.shape,h.dtype)}return p}),s(u.length>1?u:u[0],i,a))),this.state.activeTape.push(c)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){let n=fk(t),o=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let a=this.state.activeScope.track[i];!a.kept&&!o.has(a.id)&&a.dispose()}let s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===s.id&&this.track(i)})}gradients(t,n,o,s=!1){if($(n.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));$(i instanceof Ct,()=>"The result y returned by f() must be a tensor.");let a=OK(this.state.activeTape,n,i);if(!s&&a.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let c={};c[i.id]=o??tNe(i.shape),MK(c,a,u=>this.tidy(u),rNe);let l=n.map(u=>c[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let p of u.saved)p.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(t){return $(mv(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{$(n.every(c=>c instanceof Ct),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,s={};n.forEach((c,l)=>{s[l]=c});let i=(c,l)=>(o=t(...n,l),$(o.value instanceof Ct,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),$(mv(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(c,l)=>{let u=o.gradFunc(c,l),p=Array.isArray(u)?u:[u];$(p.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),$(p.every(h=>h instanceof Ct),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let d={};return p.forEach((h,f)=>{d[f]=()=>h}),d};return this.runKernelFunc({forwardFunc:i,backwardsFunc:a,inputs:s})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}time(t){return M(this,null,function*(){let n=Ug(),o=yield this.backend.time(t);return o.wallMs=Ug()-n,o})}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new mk;for(let t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return r.nextTensorId=0,r.nextVariableId=0,r})();function tNe(r){let e=KC(Vt(r),"float32");return F.makeTensor(e,r,"float32")}function t3(){let r=WL();if(r._tfengine==null){let e=new XC(r);r._tfengine=new eNe(e)}return hK(r._tfengine.ENV),LK(()=>r._tfengine),r._tfengine}var F=t3();function rNe(r,e){let t={a:r,b:e};return F.runKernel(ra,t)}var Vf={};Nr(Vf,{isBrowser:()=>n3,isMobile:()=>sNe,mockIsMobile:()=>oNe});function nNe(){return typeof navigator<"u"&&navigator!=null}var r3;function oNe(r){r3=r}function sNe(r){if(r3!==void 0)return r3;if(r||nNe()){if(r||(r=navigator),r.product==="ReactNative")return!0;let e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){let t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function n3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var qs=Z();qs.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qs.registerFlag("IS_BROWSER",()=>n3());qs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));qs.registerFlag("PROD",()=>!1);qs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qs.getBool("DEBUG"));qs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qs.registerFlag("IS_TEST",()=>!1);qs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>qs.getBool("DEBUG"));qs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function Ks(r,e){let t=r;if(cs(r))return e==="string"?[]:[r.length];if(dk(r)){let o=r.channels||"RGBA";return[r.height,r.width*o.length]}else if(hk(r))return[r.buffer.size/(e==null?4:hv(e))];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||cs(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Z().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&KK(r,n,[]),n}function KK(r,e,t){if(t=t||[],!Array.isArray(r)&&!cs(r)){$(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}$(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),$(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let o=0;o<r.length;++o)KK(r[o],n,t.concat(o))}function qK(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function D(r,e,t,n="numeric"){if(r instanceof K())return qK(n,r.dtype,e,t),r;let o=Bh(r);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),qK(n,o,e,t),r==null||!cs(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let c=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${c}'`)}let s=Ks(r,o);!cs(r)&&!Array.isArray(r)&&(r=[r]);let a=o!=="string"?Av(r,o):Lf(r,[],!0);return F.makeTensor(a,s,o)}function Gg(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((s,i)=>D(s,`${e}[${i}]`,t,n))}var o3="__op";function O(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+o3;let o=(...s)=>{F.startScope(t);try{let i=n(...s);return Ag(i)&&console.error("Cannot return a Promise inside of tidy."),F.endScope(i),i}catch(i){throw F.endScope(null),i}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}function iNe(r,e){let t=D(r,"real","complex"),n=D(e,"imag","complex");On(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let o={real:t,imag:n};return F.runKernel(qh,o)}var Xs=O({complex_:iNe});function Is(r,e,t,n){if(n==null)n=Bh(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(hk(r)||dk(r)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return F.backend.createTensorFromGPUData(r,e||t,n)}if(!cs(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){dn(e);let o=Vt(e),s=Vt(t);$(o===s,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<t.length;++i){let a=t[i],c=i===t.length-1?a!==Vt(e.slice(i)):!0;$(t[i]===e[i]||!c,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!cs(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?Av(r,n):Lf(r,[],!0),F.makeTensor(r,e,n)}function Co(r,e,t){let n=Ks(r,t);return Is(r,e,n,t)}var kd={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var Ko=class r{static join(e){return new r(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>cs(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let o=e[n];n!==e.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let s=t+o.byteLength;this.shards.push({buffer:o,start:t,end:s}),t=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);let o=t-e,s=new ArrayBuffer(o),i=new Uint8Array(s),a=0;for(let c=n;c<this.shards.length;c++){let l=this.shards[c],p=e+a-l.start,d=a,f=Math.min(t,l.end)-l.start,m=new Uint8Array(l.buffer,p,f-p);if(i.set(m,d),a+=m.length,t<l.end)break}return s}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(o){return e<o.start?-1:e>=o.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=aNe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function aNe(r,e){let t=0,n=r.length;for(;t<=n;){let o=Math.floor((n-t)/2)+t,s=e(r[o]);if(s===0)return o;s<0?n=o:t=o+1}return-1}function cNe(r){Z().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}BK(cNe);function _o(){return F}function t_(){return F.memory()}function ee(r,e){return F.tidy(r,e)}function Xe(r){fk(r).forEach(t=>t.dispose())}function rn(r){return F.keep(r)}function XK(){return F.ready()}function pp(){return F.backendName}function Fv(r,e,t=1){return F.registerBackend(r,e,t)}function dp(){return F.backend}var Bf=4;function QK(r,e){return M(this,null,function*(){let t=[],n=[],o=Array.isArray(r)?r.map(i=>i.name):Object.keys(r);for(let i=0;i<o.length;++i){let a=o[i],c=Array.isArray(r)?r[i].tensor:r[a];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${c.dtype}`);let l={name:a,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){let u=new Promise(p=>M(this,null,function*(){let d=yield c.bytes(),h=d.reduce((g,y)=>g+y.length,0)+Bf*d.length,f=new Uint8Array(h),m=0;for(let g=0;g<d.length;g++){let y=d[g],x=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(x,m),m+=Bf,f.set(y,m),m+=y.length}p(f)}));n.push(u)}else n.push(c.data());e!=null&&(l.group=e),t.push(l)}let s=yield Promise.all(n);return{data:pNe(s),specs:t}})}function gk(r,e){let t=new Ko(r),n={},o=0;for(let s of e){let i=lNe(s,(a,c)=>t.slice(o+a,o+c));n[s.name]=JK(s,t.slice(o,o+i)),o+=i}return n}function lNe(r,e){let t=Vt(r.shape),n;if("quantization"in r){let o=r.quantization;n=kd[o.dtype]}else if(r.dtype==="string"){let o=0;for(let s=0;s<t;s++)o+=Bf+new Uint32Array(e(o,o+Bf))[0];return o}else n=kd[r.dtype];return t*n}function uNe(r,e){return M(this,null,function*(){let t=Vt(r.shape),n;if("quantization"in r){let o=r.quantization;n=kd[o.dtype]}else if(r.dtype==="string"){let o=0;for(let s=0;s<t;s++)o+=Bf+new Uint32Array(yield e(o,o+Bf))[0];return o}else n=kd[r.dtype];return t*n})}function JK(r,e){let t=r.name,n=r.dtype,o=r.shape,s=Vt(o),i,a=0;if("quantization"in r){let c=r.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${r.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(n!=="float32")throw new Error(`Weight ${r.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${n}.`)}else throw new Error(`Weight ${r.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let l=kd[c.dtype],u=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){i=new Float32Array(u.length);for(let p=0;p<u.length;p++){let d=u[p];i[p]=d*c.scale+c.min}}else if(c.dtype==="float16")i=mNe()(u);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(n==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);i=new Int32Array(u.length);for(let p=0;p<u.length;p++){let d=u[p];i[p]=Math.round(d*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${n}`);a+=s*l}else if(n==="string"){let c=Vt(r.shape);i=[];for(let l=0;l<c;l++){let u=new Uint32Array(e.slice(a,a+Bf))[0];a+=Bf;let p=new Uint8Array(e.slice(a,a+u));i.push(p),a+=u}}else{let c=kd[n];if(n==="float32")i=new Float32Array(e);else if(n==="int32")i=new Int32Array(e);else if(n==="bool")i=new Uint8Array(e);else if(n==="complex64"){i=new Float32Array(e);let l=new Float32Array(i.length/2),u=new Float32Array(i.length/2);for(let f=0;f<l.length;f++)l[f]=i[f*2],u[f]=i[f*2+1];let p=Co(l,o,"float32"),d=Co(u,o,"float32"),h=Xs(p,d);return p.dispose(),d.dispose(),h}else throw new Error(`Unsupported dtype in weight '${t}': ${n}`);a+=s*c}return Co(i,o,n)}function YK(r,e,t){return M(this,null,function*(){let n=new Uint8Array(e);for(;n.byteLength<t;){let{done:o,value:s}=yield r.read();if(o&&s==null){let a=t-n.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}let i=new Uint8Array(n.length+s.byteLength);i.set(n,0),i.set(new Uint8Array(s),n.length),n=i}return n.buffer})}function yk(r,e){return M(this,null,function*(){let t={},n=r.getReader(),o=new ArrayBuffer(0);for(let s of e){let i=yield uNe(s,(l,u)=>M(this,null,function*(){return o=yield YK(n,o,u),o.slice(l,u)}));o=yield YK(n,o,i);let a=o.slice(0,i);o=o.slice(i);let c=JK(s,a);if(t[s.name]=c,pp()==="webgpu"){let l=dp();"uploadToGPU"in l&&Vt(c.shape)>=Z().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&l.uploadToGPU(c.dataId)}}return t})}function pNe(r){if(r===null)throw new Error(`Invalid input value: ${JSON.stringify(r)}`);let e=0,t=[];r.forEach(s=>{if(e+=s.byteLength,t.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let n=new Uint8Array(e),o=0;return t.forEach(s=>{n.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),n.buffer}var s3=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ZK(r){return s3?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function e8(r){if(s3)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,o=e.length;n<o;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function t8(r){if(s3){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function r8(r){return Ko.join(r)}function i3(r){let e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);let t=r.split(e);return t[t.length-1]}function xk(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function a3(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function Pv(r,e){return M(this,null,function*(){let t,n;return r.weightsManifest!=null&&([t,n]=yield e(r.weightsManifest)),a3(r,t,n)})}function hp(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:ZK(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:ZK(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new Ko(r.weightData).byteLength}}function r_(r){let e=[];for(let t of r)e.push(...t.weights);return e}function dNe(){let r=t=>{let n=t<<13,o=0;for(;!(n&8388608);)o-=8388608,n<<=1;return n&=-8388609,o+=947912704,n|o},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=r(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function hNe(){let r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(let e=1;e<31;e++)r[e]=e<<23;for(let e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function fNe(){let r=new Uint32Array(64);for(let e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function mNe(){let r=dNe(),e=hNe(),t=fNe();return n=>{let o=new ArrayBuffer(4*n.length),s=new Uint32Array(o);for(let i=0;i<n.length;i++){let a=n[i],c=r[t[a>>10]+(a&1023)]+e[a>>10];s[i]=c}return new Float32Array(o)}}var So=class r{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return r.instance==null&&(r.instance=new r),r.instance}static registerSaveRouter(e){r.getInstance().saveRouters.push(e)}static registerLoadRouter(e){r.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return r.getHandlers(e,"save")}static getLoadHandlers(e,t){return r.getHandlers(e,"load",t)}static getHandlers(e,t,n){let o=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(i=>{let a=i(e,n);a!==null&&o.push(a)}),o}},n8=r=>So.registerSaveRouter(r),o8=r=>So.registerLoadRouter(r),s8=r=>So.getSaveHandlers(r),i8=(r,e)=>So.getLoadHandlers(r,e);var c3="tensorflowjs",l3=1,Wg="models_store",zf="model_info_store";function a8(){if(!Z().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function u3(r){let e=r.result;e.createObjectStore(Wg,{keyPath:"modelPath"}),e.createObjectStore(zf,{keyPath:"modelPath"})}var jg=(()=>{class r{constructor(t){if(this.indexedDB=a8(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}save(t){return M(this,null,function*(){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)})}load(){return M(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(t,n){return new Promise((o,s)=>{let i=this.indexedDB.open(c3,l3);i.onupgradeneeded=()=>u3(i),i.onsuccess=()=>{let a=i.result;if(n==null){let c=a.transaction(Wg,"readonly"),u=c.objectStore(Wg).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),s(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=p=>(a.close(),s(u.error)),c.oncomplete=()=>a.close()}else{n.weightData=Ko.join(n.weightData);let c=hp(n),l=a.transaction(zf,"readwrite"),u=l.objectStore(zf),p;try{p=u.put({modelPath:this.modelPath,modelArtifactsInfo:c})}catch(h){return s(h)}let d;p.onsuccess=()=>{d=a.transaction(Wg,"readwrite");let h=d.objectStore(Wg),f;try{f=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:c})}catch(m){return s(m)}f.onsuccess=()=>o({modelArtifactsInfo:c}),f.onerror=m=>{u=l.objectStore(zf);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),s(f.error)),g.onerror=y=>(a.close(),s(f.error))}},p.onerror=h=>(a.close(),s(p.error)),l.oncomplete=()=>{d==null?a.close():d.oncomplete=()=>a.close()}}},i.onerror=a=>s(i.error)})}}return r.URL_SCHEME="indexeddb://",r})();var c8=r=>Z().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(jg.URL_SCHEME)?gNe(r.slice(jg.URL_SCHEME.length)):null;So.registerSaveRouter(c8);So.registerLoadRouter(c8);function gNe(r){return new jg(r)}function yNe(r){return r.startsWith(jg.URL_SCHEME)?r.slice(jg.URL_SCHEME.length):r}var vk=class{constructor(){this.indexedDB=a8()}listModels(){return M(this,null,function*(){return new Promise((e,t)=>{let n=this.indexedDB.open(c3,l3);n.onupgradeneeded=()=>u3(n),n.onsuccess=()=>{let o=n.result,s=o.transaction(zf,"readonly"),a=s.objectStore(zf).getAll();a.onsuccess=()=>{let c={};for(let l of a.result)c[l.modelPath]=l.modelArtifactsInfo;e(c)},a.onerror=c=>(o.close(),t(a.error)),s.oncomplete=()=>o.close()},n.onerror=o=>t(n.error)})})}removeModel(e){return M(this,null,function*(){return e=yNe(e),new Promise((t,n)=>{let o=this.indexedDB.open(c3,l3);o.onupgradeneeded=()=>u3(o),o.onsuccess=()=>{let s=o.result,i=s.transaction(zf,"readwrite"),a=i.objectStore(zf),c=a.get(e),l;c.onsuccess=()=>{if(c.result==null)return s.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let u=a.delete(e),p=()=>{l=s.transaction(Wg,"readwrite");let h=l.objectStore(Wg).delete(e);h.onsuccess=()=>t(c.result.modelArtifactsInfo),h.onerror=f=>n(c.error)};u.onsuccess=p,u.onerror=d=>(p(),s.close(),n(c.error))}},c.onerror=u=>(s.close(),n(c.error)),i.oncomplete=()=>{l==null?s.close():l.oncomplete=()=>s.close()}},o.onerror=s=>n(o.error)})})}};var Ed="/",$v="tensorflowjs_models",l8="info",xNe="model_topology",vNe="weight_specs",bNe="weight_data",wNe="model_metadata";function u8(r){return{info:[$v,r,l8].join(Ed),topology:[$v,r,xNe].join(Ed),weightSpecs:[$v,r,vNe].join(Ed),weightData:[$v,r,bNe].join(Ed),modelMetadata:[$v,r,wNe].join(Ed)}}function p8(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}function CNe(r){let e=r.split(Ed);if(e.length<3)throw new Error(`Invalid key format: ${r}`);return e.slice(1,e.length-1).join(Ed)}function _Ne(r){return r.startsWith(Hg.URL_SCHEME)?r.slice(Hg.URL_SCHEME.length):r}var Hg=(()=>{class r{constructor(t){if(!Z().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=u8(this.modelPath)}save(t){return M(this,null,function*(){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let n=JSON.stringify(t.modelTopology),o=JSON.stringify(t.weightSpecs),s=hp(t),i=Ko.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(s)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,e8(i));let a={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:s}}catch{throw p8(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${s.modelTopologyBytes}, weightSpecsBytes=${s.weightSpecsBytes}, weightDataBytes=${s.weightDataBytes}.`)}}})}load(){return M(this,null,function*(){let t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let n={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=o;let s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(s==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=s;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let c=JSON.parse(i);n.format=c.format,n.generatedBy=c.generatedBy,n.convertedBy=c.convertedBy,c.signature!=null&&(n.signature=c.signature),c.userDefinedMetadata!=null&&(n.userDefinedMetadata=c.userDefinedMetadata),c.modelInitializer!=null&&(n.modelInitializer=c.modelInitializer),c.initializerSignature!=null&&(n.initializerSignature=c.initializerSignature),c.trainingConfig!=null&&(n.trainingConfig=c.trainingConfig)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=t8(a),n})}}return r.URL_SCHEME="localstorage://",r})();var d8=r=>Z().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Hg.URL_SCHEME)?SNe(r.slice(Hg.URL_SCHEME.length)):null;So.registerSaveRouter(d8);So.registerLoadRouter(d8);function SNe(r){return new Hg(r)}var bk=class{constructor(){$(Z().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),$(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return M(this,null,function*(){let e={},t=$v+Ed,n=Ed+l8;for(let o=0;o<this.LS.length;++o){let s=this.LS.key(o);if(s.startsWith(t)&&s.endsWith(n)){let i=CNe(s);e[i]=JSON.parse(this.LS.getItem(s))}}return e})}removeModel(e){return M(this,null,function*(){e=_Ne(e);let t=u8(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return p8(t),n})}};var Lv="://",vl=class r{constructor(){this.managers={}}static getInstance(){return r.instance==null&&(r.instance=new r),r.instance}static registerManager(e,t){$(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Lv)&&(e=e.slice(0,e.indexOf(Lv))),$(e.length>0,()=>"scheme must not be an empty string.");let n=r.getInstance();$(n.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=t}static getManager(e){let t=r.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(r.getInstance().managers)}};function wk(r){if(r.indexOf(Lv)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${vl.getSchemes().join(",")}`);return{scheme:r.split(Lv)[0],path:r.split(Lv)[1]}}function h8(r,e,t=!1){return M(this,null,function*(){$(r!==e,()=>`Old path and new path are the same: '${r}'`);let n=So.getLoadHandlers(r);$(n.length>0,()=>`Copying failed because no load handler is found for source URL ${r}.`),$(n.length<2,()=>`Copying failed because more than one (${n.length}) load handlers for source URL ${r}.`);let o=n[0],s=So.getSaveHandlers(e);$(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),$(s.length<2,()=>`Copying failed because more than one (${n.length}) save handlers for destination URL ${e}.`);let i=s[0],a=wk(r).scheme,c=wk(r).path,l=a===wk(r).scheme,u=yield o.load();t&&l&&(yield vl.getManager(a).removeModel(c));let p=yield i.save(u);return t&&!l&&(yield vl.getManager(a).removeModel(c)),p.modelArtifactsInfo})}function f8(){return M(this,null,function*(){let r=vl.getSchemes(),e={};for(let t of r){let n=yield vl.getManager(t).listModels();for(let o in n){let s=t+Lv+o;e[s]=n[o]}}return e})}function m8(r){return M(this,null,function*(){let e=wk(r);return vl.getManager(e.scheme).removeModel(e.path)})}function g8(r,e){return M(this,null,function*(){return h8(r,e,!1)})}function y8(r,e){return M(this,null,function*(){return h8(r,e,!0)})}var p3=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!Z().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let o=this.functionRefs[n.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return ak(e)}};if(Z().get("IS_BROWSER")){Z().setPlatform("browser",new p3);try{vl.registerManager(Hg.URL_SCHEME,new bk)}catch{}try{vl.registerManager(jg.URL_SCHEME,new vk)}catch{}}var TNe={importFetch:()=>v8()},d3;var h3=class{constructor(){this.util=b8(),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return Z().global.fetch!=null?Z().global.fetch(e,t):(d3==null&&(d3=TNe.importFetch()),d3(e,t))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}};Z().get("IS_NODE")&&!Z().get("IS_BROWSER")&&Z().setPlatform("node",new h3);function ze(r,e="float32",t){return e=e||"float32",dn(r),new ur(r,e,t)}function kNe(r,e){let t=D(r,"x","cast");if(!BL(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},o={dtype:e};return F.runKernel(Da,n,o)}var he=O({cast_:kNe});function ENe(r){let t={x:D(r,"x","clone","string_or_numeric")};return F.runKernel(Aa,t)}var Ts=O({clone_:ENe});function Ck(r,e=!1){console.log(r.toString(e))}t3();var NNe={buffer:ze,cast:he,clone:Ts,print:Ck};VK(NNe);function DNe(r,e){let t=D(r,"a","add"),n=D(e,"b","add");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(ra,o)}var ae=O({add_:DNe});function ANe(r,e){let t=D(r,"a","floorDiv"),n=D(e,"b","floorDiv");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(Uc,o)}var Bv=O({floorDiv_:ANe});function RNe(r,e){let t=D(r,"a","div"),n=D(e,"b","div");if([t,n]=Bt(t,n),t.dtype==="int32"&&n.dtype==="int32")return Bv(t,n);let o={a:t,b:n},s={};return F.runKernel(Pc,o,s)}var Ce=O({div_:RNe});function ONe(r,e){let t=D(r,"a","mul"),n=D(e,"b","mul");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(Qc,o)}var W=O({mul_:ONe});function MNe(r){let e=D(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return F.runKernel(Iu,t)}else{let t={x:e};return F.runKernel(yu,t)}}var Qr=O({abs_:MNe});function FNe(r){let t={x:D(r,"x","acos")};return F.runKernel(Ic,t)}var _k=O({acos_:FNe});function PNe(r){let t={x:D(r,"x","acosh")};return F.runKernel(Tc,t)}var Sk=O({acosh_:PNe});function $Ne(r){$(Array.isArray(r),()=>"The argument passed to tf.addN() must be a list of tensors"),$(r.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${r.length}`);let e=r.map((o,s)=>D(o,`tensors${s}`,"addN")),t=e[0];e.forEach(o=>{if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(o=>{if(!ki(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let n=e;return F.runKernel(xu,n)}var w8=O({addN_:$Ne});function LNe(r,e=null,t=!1){let o={x:D(r,"x","all","bool")},s={axis:e,keepDims:t};return F.runKernel(zh,o,s)}var zv=O({all_:LNe});function VNe(r,e=null,t=!1){let o={x:D(r,"x","any","bool")},s={axis:e,keepDims:t};return F.runKernel(Uh,o,s)}var Kg=O({any_:VNe});function BNe(r,e=0){let n={x:D(r,"x","argMax")},o={axis:e};return F.runKernel(vu,n,o)}var $a=O({argMax_:BNe});function zNe(r,e=0){let n={x:D(r,"x","argMin")},o={axis:e};return F.runKernel(bu,n,o)}var Ik=O({argMin_:zNe});function UNe(r){let t={x:D(r,"x","asin")};return F.runKernel(kc,t)}var Tk=O({asin_:UNe});function GNe(r){let t={x:D(r,"x","asinh")};return F.runKernel(Ec,t)}var kk=O({asinh_:GNe});function WNe(r){let t={x:D(r,"x","atan")};return F.runKernel(Nc,t)}var Ek=O({atan_:WNe});function jNe(r,e){let t=D(r,"a","atan2"),n=D(e,"b","atan2");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(Ac,o)}var Nk=O({atan2_:jNe});function HNe(r){let t={x:D(r,"x","atanh")};return F.runKernel(Dc,t)}var Dk=O({atanh_:HNe});function qNe(r,e,t,n,o="NHWC",s){let i=r[3],a=[...e,i],c=_8(o);return Xg(r,a,t,s,n,null,null,c)}function m3(r,e,t,n,o,s,i="channelsLast"){let[a,c]=n_(e),l;if(i==="channelsLast")l=[a,c,r[3],r[3]];else if(i==="channelsFirst")l=[a,c,r[1],r[1]];else throw new Error(`Unknown dataFormat ${i}`);return Xg(r,l,t,n,o,s,!1,i)}function KNe(r,e,t,n,o,s,i="NDHWC"){let[a,c,l]=f3(e),u,p;if(i==="NDHWC")p="channelsLast",u=[a,c,l,r[4],r[4]];else if(i==="NCDHW")p="channelsFirst",u=[a,c,l,r[1],r[1]];else throw new Error(`Unknown dataFormat ${i}`);return C8(r,u,t,n,o,!1,p,s)}function Xg(r,e,t,n,o,s,i=!1,a="channelsLast"){let[c,l,u,p]=[-1,-1,-1,-1];if(a==="channelsLast")[c,l,u,p]=r;else if(a==="channelsFirst")[c,p,l,u]=r;else throw new Error(`Unknown dataFormat ${a}`);let[d,h,,f]=e,[m,g]=n_(t),[y,x]=n_(n),b=Uv(d,y),w=Uv(h,x),{padInfo:_,outHeight:I,outWidth:S}=ZNe(o,l,u,m,g,b,w,s,a),k=i?f*p:f,R;return a==="channelsFirst"?R=[c,k,I,S]:a==="channelsLast"&&(R=[c,I,S,k]),{batchSize:c,dataFormat:a,inHeight:l,inWidth:u,inChannels:p,outHeight:I,outWidth:S,outChannels:k,padInfo:_,strideHeight:m,strideWidth:g,filterHeight:d,filterWidth:h,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:x,inShape:r,outShape:R,filterShape:e}}function C8(r,e,t,n,o,s=!1,i="channelsLast",a){let[c,l,u,p,d]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[c,l,u,p,d]=r;else if(i==="channelsFirst")[c,d,l,u,p]=r;else throw new Error(`Unknown dataFormat ${i}`);let[h,f,m,,g]=e,[y,x,b]=f3(t),[w,_,I]=f3(n),S=Uv(h,w),k=Uv(f,_),R=Uv(m,I),{padInfo:L,outDepth:B,outHeight:z,outWidth:q}=QNe(o,l,u,p,y,x,b,S,k,R,a),U=s?g*d:g,G;return i==="channelsFirst"?G=[c,U,B,z,q]:i==="channelsLast"&&(G=[c,B,z,q,U]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:u,inWidth:p,inChannels:d,outDepth:B,outHeight:z,outWidth:q,outChannels:U,padInfo:L,strideDepth:y,strideHeight:x,strideWidth:b,filterDepth:h,filterHeight:f,filterWidth:m,effectiveFilterDepth:S,effectiveFilterHeight:k,effectiveFilterWidth:R,dilationDepth:w,dilationHeight:_,dilationWidth:I,inShape:r,outShape:G,filterShape:e}}function XNe(r,e,t,n,o){n==null&&(n=g3(r,e,t));let s=r[0],i=r[1],a=o_((s-e+2*n)/t+1,o),c=o_((i-e+2*n)/t+1,o);return[a,c]}function YNe(r,e,t,n,o,s){o==null&&(o=g3(r,e[0],n[0]));let i=[0,0,0,t];for(let a=0;a<3;a++)r[a]+2*o>=e[a]&&(i[a]=o_((r[a]-e[a]+2*o)/n[a]+1,s));return i}function g3(r,e,t,n=1){let o=Uv(e,n);return Math.floor((r[0]*(t-1)-t+o)/2)}function n_(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function f3(r){return typeof r=="number"?[r,r,r]:r}function Uv(r,e){return e<=1?r:r+(r-1)*(e-1)}function ZNe(r,e,t,n,o,s,i,a,c){let l,u,p;if(typeof r=="number"){l={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let h=XNe([e,t],s,n,r,a);u=h[0],p=h[1]}else if(r==="same"){u=Math.ceil(e/n),p=Math.ceil(t/o);let d=Math.max(0,(u-1)*n+s-e),h=Math.max(0,(p-1)*o+i-t),f=Math.floor(d/2),m=d-f,g=Math.floor(h/2),y=h-g;l={top:f,bottom:m,left:g,right:y,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-s+1)/n),p=Math.ceil((t-i+1)/o);else if(typeof r=="object"){let d=c==="channelsLast"?r[1][0]:r[2][0],h=c==="channelsLast"?r[1][1]:r[2][1],f=c==="channelsLast"?r[2][0]:r[3][0],m=c==="channelsLast"?r[2][1]:r[3][1];l={top:d,bottom:h,left:f,right:m,type:d===0&&h===0&&f===0&&m===0?"VALID":"EXPLICIT"},u=o_((e-s+d+h)/n+1,a),p=o_((t-i+f+m)/o+1,a)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:l,outHeight:u,outWidth:p}}function QNe(r,e,t,n,o,s,i,a,c,l,u){let p,d,h,f;if(r==="valid"&&(r=0),typeof r=="number"){p={top:r,bottom:r,left:r,right:r,front:r,back:r,type:r===0?"VALID":"NUMBER"};let g=YNe([e,t,n,1],[a,c,l],1,[o,s,i],r,u);d=g[0],h=g[1],f=g[2]}else if(r==="same"){d=Math.ceil(e/o),h=Math.ceil(t/s),f=Math.ceil(n/i);let m=(d-1)*o+a-e,g=(h-1)*s+c-t,y=(f-1)*i+l-n,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),_=g-w,I=Math.floor(y/2),S=y-I;p={top:w,bottom:_,left:I,right:S,front:x,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:p,outDepth:d,outHeight:h,outWidth:f}}function o_(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function na(r){let[e,t,n]=n_(r);return e===1&&t===1&&n===1}function zo(r,e){return na(r)||na(e)}function fp(r){return n_(r).every(e=>e>0)}function _8(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${r}`)}function Wr(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")$(hd(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(o=>{$(hd(o),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${o}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function JNe(r,e){let n={x:D(r,"x","reshape","string_or_numeric")},o={shape:e};return F.runKernel(Zu,n,o)}var H=O({reshape_:JNe});function eDe(r,e,t,n,o){let s=D(r,"x","avgPool","float32"),i=1;$(zo(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=s,c=!1;s.rank===3&&(c=!0,a=H(s,[1,s.shape[0],s.shape[1],s.shape[2]])),$(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Wr("avgPool",n,o);let l={x:a},u={filterSize:e,strides:t,pad:n,dimRoundingMode:o},p=F.runKernel(wu,l,u);return p=he(p,s.dtype),c?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Uf=O({avgPool_:eDe});function tDe(r,e,t,n,o,s="NDHWC"){let i=D(r,"x","avgPool3d","float32"),a=i,c=!1;i.rank===4&&(c=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),$(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),$(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),$(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),Wr("avgPool3d",n,o);let l={x:a},u={filterSize:e,strides:t,pad:n,dimRoundingMode:o,dataFormat:s},p=F.runKernel(Cu,l,u);return p=he(p,a.dtype),c?H(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Ak=O({avgPool3d_:tDe});function rDe(r,e=0){$(r.length>=1,()=>"Pass at least one tensor to concat");let t=Gg(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),t.length===1)return Ts(t[0]);let n=t,o={axis:e};return F.runKernel(Tu,n,o)}var Xt=O({concat_:rDe});function nDe(r,e,t=!1,n=!1){let o=D(r,"a","matMul"),s=D(e,"b","matMul");[o,s]=Bt(o,s);let i={a:o,b:s},a={transposeA:t,transposeB:n};return F.runKernel(_u,i,a)}var Tt=O({matMul_:nDe});function oDe(r){let t={x:D(r,"x","sigmoid","float32")};return F.runKernel(ll,t)}var co=O({sigmoid_:oDe});function sDe(r,e,t){let n=D(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let o={x:n},s={begin:e,size:t};return F.runKernel(rp,o,s)}var tt=O({slice_:sDe});function iDe(r){let t={x:D(r,"x","tanh","float32")};return F.runKernel(ml,t)}var bl=O({tanh_:iDe});function aDe(r,e,t,n,o,s){let i=D(r,"forgetBias","basicLSTMCell"),a=D(e,"lstmKernel","basicLSTMCell"),c=D(t,"lstmBias","basicLSTMCell"),l=D(n,"data","basicLSTMCell"),u=D(o,"c","basicLSTMCell"),p=D(s,"h","basicLSTMCell"),d=Xt([l,p],1),h=Tt(d,a),f=ae(h,c),m=f.shape[0],g=f.shape[1]/4,y=[m,g],x=tt(f,[0,0],y),b=tt(f,[0,g],y),w=tt(f,[0,g*2],y),_=tt(f,[0,g*3],y),I=ae(W(co(x),bl(b)),W(u,co(ae(i,w)))),S=W(bl(I),co(_));return[I,S]}var S8=O({basicLSTMCell_:aDe});function cDe(r,e,t){let n=D(r,"x","batchToSpaceND"),o=e.reduce((a,c)=>a*c);$(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),$(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),$(n.shape[0]%o===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);let s={x:n},i={blockShape:e,crops:t};return F.runKernel(Su,s,i)}var Gf=O({batchToSpaceND_:cDe});function I8(r){let e;return r.rank===0||r.rank===1?e=H(r,[1,1,1,r.size]):r.rank===2?e=H(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function lDe(r,e,t,n,o,s){s==null&&(s=.001);let i=D(r,"x","batchNorm"),a=D(e,"mean","batchNorm"),c=D(t,"variance","batchNorm"),l;o!=null&&(l=D(o,"scale","batchNorm"));let u;n!=null&&(u=D(n,"offset","batchNorm")),$(a.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),$(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),$(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let d={x:I8(i),scale:l,offset:u,mean:a,variance:c},h={varianceEpsilon:s},f=F.runKernel(Mu,d,h);return H(f,i.shape)}var mp=O({batchNorm_:lDe});function uDe(r,e,t,n,o,s){let i=D(r,"x","batchNorm"),a=D(e,"mean","batchNorm"),c=D(t,"variance","batchNorm"),l;o!=null&&(l=D(o,"scale","batchNorm"));let u;return n!=null&&(u=D(n,"offset","batchNorm")),$(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),$(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),$(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),l!=null&&$(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&$(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),mp(i,a,c,u,l,s)}var Rk=O({batchNorm2d_:uDe});function pDe(r,e,t,n,o,s){let i=D(r,"x","batchNorm"),a=D(e,"mean","batchNorm"),c=D(t,"variance","batchNorm"),l;o!=null&&(l=D(o,"scale","batchNorm"));let u;return n!=null&&(u=D(n,"offset","batchNorm")),$(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),$(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),$(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),l!=null&&$(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&$(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),mp(i,a,c,u,l,s)}var Ok=O({batchNorm3d_:pDe});function dDe(r,e,t,n,o,s){let i=D(r,"x","batchNorm"),a=D(e,"mean","batchNorm"),c=D(t,"variance","batchNorm"),l;o!=null&&(l=D(o,"scale","batchNorm"));let u;return n!=null&&(u=D(n,"offset","batchNorm")),$(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),$(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),$(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),l!=null&&$(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&$(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),mp(i,a,c,u,l,s)}var Mk=O({batchNorm4d_:dDe});function hDe(r,e,t){let n=D(r,"x","bincount"),o=D(e,"weights","bincount");$(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),$(t>=0,()=>`size must be non-negative, but got ${t}.`),$(o.size===n.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${o.shape}.`);let s={x:n,weights:o},i={size:t};return F.runKernel(jh,s,i)}var Fk=O({bincount_:hDe});function fDe(r,e){let t=D(r,"x","bitwiseAnd"),n=D(e,"y","bitwiseAnd");if(!ki(t.shape,n.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${t.shape}, y: ${n.shape}`);if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${t.dtype} and type of y: ${n.dtype}`);let o={a:t,b:n};return F.runKernel(Rg,o)}var T8=O({bitwiseAnd_:fDe});function mDe(r,e){let t=D(r,"s0","broadcastArgs","int32"),n=D(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(n.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${n.rank}`);let o={s0:t,s1:n};return F.runKernel(Hh,o)}var k8=O({broadcastArgs_:mDe});function gDe(r,e){let t=D(r,"broadcastTo","x"),n=t.shape;if(dn(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=H(t,l)}let o=t.shape,s=Array.from(e);for(let l=e.length-1;l>=0;l--)if(o[l]===e[l])s[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(s.map((l,u)=>l>1?u:-1).filter(l=>l>=0).length===0)return Ts(t);let a={x:t},c={reps:s};return F.runKernel(Ra,a,c)}var gp=O({broadcastTo_:gDe});function yDe(r){let t={x:D(r,"x","ceil","float32")};return F.runKernel(Rc,t)}var Pk=O({ceil_:yDe});function La(r,e,t){dn(r),t=t||Bh(e);let n={shape:r,value:e,dtype:t};return F.runKernel(cf,{},n)}function xDe(r,e,t){let n=D(r,"x","clipByValue");if($(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return La(n.shape,e,n.dtype);let o={x:n},s={clipValueMin:e,clipValueMax:t};return F.runKernel(Oc,o,s)}var Zn=O({clipByValue_:xDe});function vDe(r){return Xt(r,0)}var $k=O({concat1d_:vDe});function bDe(r,e){return Xt(r,e)}var Lk=O({concat2d_:bDe});function wDe(r,e){return Xt(r,e)}var Vk=O({concat3d_:wDe});function CDe(r,e){return Xt(r,e)}var Bk=O({concat4d_:CDe});function _De(r,e,t,n,o="NHWC",s=[1,1],i){let a=D(r,"x","conv2d","float32"),c=D(e,"filter","conv2d","float32"),l=a,u=!1;a.rank===3&&(u=!0,l=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),$(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),$(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),Wr("conv2d",n,i);let p=o==="NHWC"?l.shape[3]:l.shape[1];$(p===c.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${c.shape[2]}.`),$(zo(t,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),$(fp(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),$(fp(t),()=>"Error in conv2D: Strides should be larger than 0.");let d={x:l,filter:c},h={strides:t,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},f=F.runKernel(ku,d,h);return u?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Ys=O({conv2d_:_De});function SDe(r,e,t,n,o="NWC",s=1,i){let a=D(r,"x","conv1d"),c=D(e,"filter","conv1d"),l=a,u=!1;a.rank===2&&(u=!0,l=H(a,[1,a.shape[0],a.shape[1]])),$(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),$(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),Wr("conv1d",n,i),$(l.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${c.shape[1]}.`),$(zo(t,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${s}'`),$(fp(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),$(fp(t),()=>"Error in conv1D: Stride should be larger than 0."),$(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let p=H(c,[1,c.shape[0],c.shape[1],c.shape[2]]),d=H(l,[l.shape[0],1,l.shape[1],l.shape[2]]),g=Ys(d,p,[1,t],n,"NHWC",[1,s],i);return u?H(g,[g.shape[2],g.shape[3]]):H(g,[g.shape[0],g.shape[2],g.shape[3]])}var Gv=O({conv1d_:SDe});function IDe(r,e,t,n,o,s="NHWC",i){$(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let a=r,c=e,l=!1;e.rank===3&&(l=!0,c=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,r[0],r[1],r[2]]),$(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),$(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),$(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let u=s==="NHWC"?a[3]:a[1],p=s==="NHWC"?c.shape[3]:c.shape[1];$(u===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[2]}.`),$(p===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${t.shape[3]}.`),Wr("conv2dDerInput",o,i);let d={dy:c,filter:t},h={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},f=F.runKernel(Eu,d,h);return l?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Wv=O({conv2DBackpropInput_:IDe});function TDe(r,e,t,n,o,s){let i=D(r,"x","conv2dTranspose"),a=D(e,"filter","conv2dTranspose");return Wv(t,i,a,n,o,"NHWC",s)}var jv=O({conv2dTranspose_:TDe});function kDe(r,e,t,n,o="NDHWC",s=[1,1,1]){let i=D(r,"x","conv3d"),a=D(e,"filter","conv3d"),c=i,l=!1;i.rank===4&&(l=!0,c=H(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),$(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),$(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),$(c.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${a.shape[3]}.`),$(zo(t,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),$(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),$(fp(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),$(fp(t),()=>"Error in conv3D: Strides should be larger than 0.");let u={x:c,filter:a},p={strides:t,pad:n,dataFormat:o,dilations:s},d=F.runKernel(Nu,u,p);return l?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var zk=O({conv3d_:kDe});function EDe(r,e,t,n,o){$(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,i=e,a=!1;e.rank===4&&(a=!0,i=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,r[0],r[1],r[2],r[3]]);let c=s[4],l=i.shape[4];$(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),$(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),$(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),$(c===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[3]}.`),$(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);let u={dy:i,filter:t},p={pad:o,strides:n,inputShape:s},d=F.runKernel(Yh,u,p);return a?H(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var Uk=O({conv3DBackpropInput_:EDe});function NDe(r,e,t,n,o){let s=D(r,"x","conv3dTranspose"),i=D(e,"filter","conv3dTranspose");return Uk(t,s,i,n,o)}var Gk=O({conv3dTranspose_:NDe});function DDe(r){let t={x:D(r,"x","cos","float32")};return F.runKernel(Mc,t)}var Wf=O({cos_:DDe});function ADe(r){let t={x:D(r,"x","cosh","float32")};return F.runKernel(Fc,t)}var Hv=O({cosh_:ADe});function RDe(r,e=0,t=!1,n=!1){let s={x:D(r,"x","cumprod")},i={axis:e,exclusive:t,reverse:n};return F.runKernel(Zh,s,i)}var Yg=O({cumprod_:RDe});function ODe(r,e=0,t=!1,n=!1){let s={x:D(r,"x","cumsum")},i={axis:e,exclusive:t,reverse:n};return F.runKernel(Du,s,i)}var qv=O({cumsum_:ODe});function MDe(r,e,t,n=!1){let o=D(r,"x","denseBincount"),s=D(e,"weights","denseBincount");$(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),$(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),$(t>=0,()=>`size must be non-negative, but got ${t}.`),$(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);let i={x:o,weights:s},a={size:t,binaryOutput:n};return F.runKernel(Jh,i,a)}var s_=O({denseBincount_:MDe});function FDe(r,e,t="NHWC"){let n=D(r,"x","depthToSpace","float32"),o=t==="NHWC"?n.shape[1]:n.shape[2],s=t==="NHWC"?n.shape[2]:n.shape[3],i=t==="NHWC"?n.shape[3]:n.shape[1];$(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),$(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${n.shape}`),$(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e} for depthToSpace with input shape
        ${n.shape}`),$(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${n.shape}`);let a={x:n},c={blockSize:e,dataFormat:t};return F.runKernel(ef,a,c)}var Wk=O({depthToSpace_:FDe});function PDe(r,e,t,n,o="NHWC",s=[1,1],i){let a=D(r,"x","depthwiseConv2d","float32"),c=D(e,"filter","depthwiseConv2d","float32"),l=a,u=!1;a.rank===3&&(u=!0,l=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),$(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),$(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);let p=o==="NHWC"?l.shape[3]:l.shape[1];$(p===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${c.shape[2]}.`),Wr("depthwiseConv2d",n,i);let d={x:l,filter:c},h={strides:t,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},f=F.runKernel(Au,d,h);return u?H(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var yp=O({depthwiseConv2d_:PDe});function $De(r){let t={x:D(r,"x","diag")};return F.runKernel(nf,t)}var E8=O({diag_:$De});function LDe(r,e,t,n,o=[1,1],s="NHWC"){let i=D(r,"x","dilation2d"),a=D(e,"filter","dilation2d");$(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),$(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),$(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let c=i,l=!1;i.rank===3&&(c=H(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=!0),$(c.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${a.shape[2]}`);let u={x:c,filter:a},p={strides:t,pad:n,dilations:o},d=F.runKernel(Ru,u,p);return l?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var jk=O({dilation2d_:LDe});var ks={};Nr(ks,{assertAndGetBroadcastShape:()=>yt,getBroadcastDims:()=>N8,getReductionAxes:()=>Lr});function N8(r,e){let t=r.length,n=[];for(let o=0;o<t;o++){let s=t-1-o,i=r[s]||1;(e[e.length-1-o]||1)>1&&i===1&&n.unshift(s)}return n}function Lr(r,e){let t=[];for(let n=0;n<e.length;n++){let o=r[r.length-n-1],s=e.length-n-1,i=e[s];(o==null||o===1&&i>1)&&t.unshift(s)}return t}function yt(r,e){let t=Math.max(r.length,e.length),n=new Array(t);for(let o=0;o<t;o++){let s=r[r.length-o-1];s==null&&(s=1);let i=e[e.length-o-1];if(i==null&&(i=1),s===1)n[t-o-1]=i;else if(i===1)n[t-o-1]=s;else if(s!==i){let a=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(a)}else n[t-o-1]=s}return n}function VDe(r,e){let t=D(r,"a","equal","string_or_numeric"),n=D(e,"b","equal","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(fd,o)}var ls=O({equal_:VDe});function BDe(r,e,t){let n=D(e,"a","where"),o=D(t,"b","where"),s=D(r,"condition","where","bool"),i=yt(yt(s.shape,n.shape),o.shape),a=gp(s,i),c=gp(n,i),l=gp(o,i),u={condition:a,t:c,e:l};return F.runKernel(tp,u)}var jr=O({where_:BDe});function zDe(r){let t={x:D(r,"x","zerosLike")};return F.runKernel(lp,t)}var nt=O({zerosLike_:zDe});function UDe(r,e){let t=D(r,"a","div"),n=D(e,"b","div");[t,n]=Bt(t,n);let o=Ce(t,n),s=nt(o),i=ls(n,s);return jr(i,s,o)}var Hk=O({divNoNan_:UDe});function GDe(r,e){let t=D(r,"t1","dot"),n=D(e,"t2","dot");$((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let o=t.rank===1?t.size:t.shape[1],s=n.rank===1?n.size:n.shape[0];if($(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),t.rank===1&&n.rank===1){let i=H(t,[1,-1]),a=H(n,[-1,1]),c=Tt(i,a);return H(c,[])}else if(t.rank===1&&n.rank===2){let i=H(t,[1,-1]),a=H(n,[n.shape[0],n.shape[1]]),c=Tt(i,a);return H(c,[c.size])}else if(t.rank===2&&n.rank===1){let i=H(n,[-1,1]),a=Tt(t,i);return H(a,[a.size])}else{let i=H(n,[n.shape[0],n.shape[1]]);return Tt(t,i)}}var qk=O({dot_:GDe});function WDe(r,...e){let t=e.map((o,s)=>D(o,`tensors${s}`,"einsum")),n={equation:r};return F.runKernel(of,t,n)}var jf=O({einsum_:WDe});function jDe(r){let t={x:D(r,"x","elu","float32")};return F.runKernel($c,t)}var xp=O({elu_:jDe});function HDe(r,e){let t=D(r,"x","ensureShape","string_or_numeric");if(!PL(t.shape,e))throw new Error(`EnsureShape: Shape of tensor ${t.shape} is not compatible with expected shape ${e}`);return r}var D8=O({ensureShape_:HDe});function qDe(r){let e=D(r,"x","erf");$(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=he(e,"float32"));let t={x:e};return F.runKernel(Lc,t)}var Kv=O({erf_:qDe});function y3(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function A8(r,e,t){let n=r.length+e.length,o=[],s=0,i=0;for(let a=0;a<n;a++)t.indexOf(a)===-1?o.push(r[s++]):o.push(e[i++]);return o}function x3(r,e){let t=[],n=r.length;for(let s=0;s<n;s++)e.indexOf(s)===-1&&t.push(r[s]);let o=e.map(s=>r[s]);return[t,o]}function Va(r,e){let t=e.map(n=>1);return A8(r,t,e)}function KDe(r,e,t){$(y3(e,t),()=>`${r} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function v3(r,e){if(y3(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function i_(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function XDe(r,e){let t=[];for(let n=e-r;n<e;++n)t.push(n);return t}function YDe(r,e=null,t=!1){let o={x:D(r,"x","max")},s={reductionIndices:e,keepDims:t};return F.runKernel(Lu,o,s)}var Io=O({max_:YDe});function ZDe(r,e=null,t=!1){let o={x:D(r,"x","min")},s={axis:e,keepDims:t};return F.runKernel(Uu,o,s)}var Nd=O({min_:ZDe});function QDe(r,e){let t=D(r,"base","pow"),n=D(e,"exp","pow");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(Jc,o)}var Xo=O({pow_:QDe});function Oe(r,e){if((cs(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&cs(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Is(r,[],[],e)}function JDe(r){let t={x:D(r,"x","sqrt","float32")};return F.runKernel(pl,t)}var Rr=O({sqrt_:JDe});function eAe(r){let e=D(r,"x","square"),t={};return F.runKernel("Square",{x:e},t)}var vt=O({square_:eAe});function tAe(r,e=null,t=!1){let n=D(r,"x","sum");n.dtype==="bool"&&(n=he(n,"int32"));let o={x:n},s={axis:e,keepDims:t};return F.runKernel(np,o,s)}var Pe=O({sum_:tAe});function rAe(r,e="euclidean",t=null,n=!1){r=D(r,"x","norm");let o=R8(r,e,t),s=o.shape;if(n){let i=Yn(t,r.shape);s=Va(o.shape,i)}return H(o,s)}function R8(r,e,t=null){if(r.rank===0)return Qr(r);if(r.rank!==1&&t===null)return R8(H(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Pe(Qr(r),t);if(e===1/0)return Io(Qr(r),t);if(e===-1/0)return Nd(Qr(r),t);if(e==="euclidean"||e===2)return Rr(Pe(Xo(Qr(r),Oe(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Io(Pe(Qr(r),t[0]),t[1]-1);if(e===1/0)return Io(Pe(Qr(r),t[1]),t[0]);if(e===-1/0)return Nd(Pe(Qr(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Rr(Pe(vt(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var Dd=O({norm_:rAe});function nAe(r,e=null,t=!1){return Dd(r,"euclidean",e,t)}var Kk=O({euclideanNorm_:nAe});function oAe(r){let t={x:D(r,"x","exp")};return F.runKernel(Vc,t)}var nn=O({exp_:oAe});function sAe(r,e=0){let t=D(r,"x","expandDims","string_or_numeric");$(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},o={dim:e};return F.runKernel(Ou,n,o)}var Hr=O({expandDims_:sAe});function iAe(r){let t={x:D(r,"x","expm1")};return F.runKernel(Bc,t)}var Xk=O({expm1_:iAe});function aAe(r,e){let t=D(r,"x","tile","string_or_numeric");$(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},o={reps:e};return F.runKernel(Ra,n,o)}var Uo=O({tile_:aAe});function cAe(r,e,t,n="float32"){e==null&&(e=r);let o=ze([r,e],n),s=r<=e?r:e;for(let a=0;a<s;++a)o.set(1,a,a);let i=H(o.toTensor(),[r,e]);if(t==null)return i;if(t.length===1)return Uo(Hr(i,0),[t[0],1,1]);if(t.length===2)return Uo(Hr(Hr(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return Uo(Hr(Hr(Hr(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}var Zg=O({eye_:cAe});function lAe(r){let t={x:D(r,"x","floor","float32")};return F.runKernel(zc,t)}var vp=O({floor_:lAe});function uAe(r,e,t=0,n=0){let o=D(r,"x","gather"),s=D(e,"indices","gather","int32"),i={x:o,indices:s},a={axis:t,batchDims:n};return F.runKernel(Fu,i,a)}var bp=O({gather_:uAe});function pAe(r,e){let t=D(r,"a","greater","string_or_numeric"),n=D(e,"b","greater","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(md,o)}var fn=O({greater_:pAe});function dAe(r,e){let t=D(r,"a","greaterEqual","string_or_numeric"),n=D(e,"b","greaterEqual","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(Gc,o)}var Es=O({greaterEqual_:dAe});function hAe(r){let t={input:D(r,"input","imag")};return F.runKernel(df,t)}var Hf=O({imag_:hAe});function fAe(r){let t={x:D(r,"x","isFinite")};return F.runKernel(Wc,t)}var Yk=O({isFinite_:fAe});function mAe(r){let t={x:D(r,"x","isInf")};return F.runKernel(jc,t)}var Zk=O({isInf_:mAe});function gAe(r){let t={x:D(r,"x","isNaN")};return F.runKernel(Hc,t)}var Qk=O({isNaN_:gAe});function yAe(r,e=.2){let n={x:D(r,"x","leakyRelu")},o={alpha:e};return F.runKernel(Pu,n,o)}var qf=O({leakyRelu_:yAe});function xAe(r,e){let t=D(r,"a","less","string_or_numeric"),n=D(e,"b","less","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(gd,o)}var Ad=O({less_:xAe});function vAe(r,e){let t=D(r,"a","lessEqual","string_or_numeric"),n=D(e,"b","lessEqual","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(yd,o)}var Di=O({lessEqual_:vAe});function O8(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");let n={start:r,stop:e,num:t};return F.runKernel(hf,{},n)}function bAe(r,e=5,t=1,n=1,o=.5){let s=D(r,"x","localResponseNormalization");$(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),$(hd(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=H(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let c={x:i},l={depthRadius:e,bias:t,alpha:n,beta:o},u=F.runKernel($u,c,l);return a?H(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var Jk=O({localResponseNormalization_:bAe});function wAe(r){let t={x:D(r,"x","log","float32")};return F.runKernel(qc,t)}var To=O({log_:wAe});function CAe(r){let t={x:D(r,"x","log1p")};return F.runKernel(Kc,t)}var Kf=O({log1p_:CAe});function w3(r,e){$(mv(r),()=>"The f passed in variableGrads(f) must be a function"),$(e==null||Array.isArray(e)&&e.every(l=>l instanceof Id),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let l in F.registeredVariables)e.push(F.registeredVariables[l])}let n=t?e.filter(l=>!l.trainable):null,o=e.length;e=e.filter(l=>l.trainable),$(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let s=!0,{value:i,grads:a}=F.gradients(r,e,null,s);$(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),$(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let c={};return e.forEach((l,u)=>{a[u]!=null&&(c[l.name]=a[u])}),n?.forEach(l=>c[l.name]=null),{value:i,grads:c}}function Zs(r){return F.customGrad(r)}function _Ae(r){let t={x:D(r,"x","neg")};return F.runKernel(Wu,t)}var Rt=O({neg_:_Ae});function SAe(r){let t={x:D(r,"x","softplus")};return F.runKernel(ul,t)}var wl=O({softplus_:SAe});function IAe(r){let e=D(r,"x","logSigmoid");return Zs(n=>({value:Rt(wl(Rt(n))),gradFunc:i=>W(i,co(Rt(n)))}))(e)}var eE=O({logSigmoid_:IAe});function TAe(r,e){let t=D(r,"a","sub"),n=D(e,"b","sub");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(hl,o)}var Te=O({sub_:TAe});function kAe(r,e=-1){let t=D(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Zs((o,s)=>{let a=Io(o,e,!0),c=Te(o,a),l=Te(he(c,"float32"),To(Pe(nn(c),e,!0)));return s([l]),{value:l,gradFunc:(p,d)=>{let[h]=d,f=!0,m=nn(h);return Te(p,W(Pe(p,e,f),m))}}})(t)}var Xv=O({logSoftmax_:kAe});function EAe(r,e=null,t=!1){let n=D(r,"x","logSumExp"),o=Yn(e,n.shape),s=Io(n,o,!0),i=Te(n,s),a=nn(i),c=Pe(a,o),l=To(c),u=ae(H(s,l.shape),l);if(t){let p=Va(u.shape,o);return H(u,p)}return u}var Xf=O({logSumExp_:EAe});function NAe(r,e){let t=D(r,"a","logicalAnd","bool"),n=D(e,"b","logicalAnd","bool");yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(xd,o)}var Yo=O({logicalAnd_:NAe});function DAe(r){let t={x:D(r,"x","logicalNot","bool")};return F.runKernel(vd,t)}var Yf=O({logicalNot_:DAe});function AAe(r,e){let t=D(r,"a","logicalOr","bool"),n=D(e,"b","logicalOr","bool");yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(bd,o)}var Yv=O({logicalOr_:AAe});function RAe(r,e){let t=D(r,"a","logicalXor","bool"),n=D(e,"b","logicalXor","bool");return yt(t.shape,n.shape),Yo(Yv(r,e),Yf(Yo(r,e)))}var tE=O({logicalXor_:RAe});var rE=2147483648;function OAe(r,e,t="left"){let n=D(r,"sortedSequence","searchSorted"),o=D(e,"values","searchSorted"),s=n.shape[n.shape.length-1],i=o.shape[o.shape.length-1],a=H(n,[-1,s]),c=H(o,[-1,i]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==c.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Vt(c.shape)>=rE)throw new Error(`values tensor size must less than ${rE}`);if(a.shape[1]>=rE)throw new Error(`trailing dim_size must less than ${rE} for int32 output type, was ${a.shape[1]}`);let l={sortedSequence:a,values:c},u={side:t};return F.runKernel(kf,l,u)}var a_=O({searchSorted_:OAe});function M8(r,e){return a_(r,e,"left")}function MAe(r,e,t,n,o){let s=D(r,"x","maxPool"),i=1,a=s,c=!1;s.rank===3&&(c=!0,a=H(s,[1,s.shape[0],s.shape[1],s.shape[2]])),$(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),$(zo(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Wr("maxPool",n,o);let l={x:a},u={filterSize:e,strides:t,pad:n,dimRoundingMode:o},p=F.runKernel(Vu,l,u);return c?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Zf=O({maxPool_:MAe});function FAe(r,e=[1,1,1],t,n,o,s="NDHWC"){let i=D(r,"x","maxPool3d"),a=i,c=!1;i.rank===4&&(c=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),$(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),$(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Wr("maxPool3d",n,o);let l={x:a},u={filterSize:e,strides:t,pad:n,dimRoundingMode:o,dataFormat:s},p=F.runKernel(Bu,l,u);return c?H(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var nE=O({maxPool3d_:FAe});function PAe(r,e,t,n,o=!1){let i={x:D(r,"x","maxPoolWithArgmax")},a={filterSize:e,strides:t,pad:n,includeBatchInIndex:o},c=F.runKernel(yf,i,a);return{result:c[0],indexes:c[1]}}var F8=O({maxPoolWithArgmax_:PAe});function $Ae(r,e){let t=D(r,"a","maximum"),n=D(e,"b","maximum");[t,n]=Bt(t,n),t.dtype==="bool"&&(t=he(t,"int32"),n=he(n,"int32")),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(Xc,o)}var Qs=O({maximum_:$Ae});function LAe(r,e=null,t=!1){let o={x:D(r,"x","mean")},s={axis:e,keepDims:t};return F.runKernel(zu,o,s)}var qr=O({mean_:LAe});function Cr(r,e="float32"){if(dn(r),e==="complex64"){let n=Cr(r,"float32"),o=Cr(r,"float32");return Xs(n,o)}let t=yv(Vt(r),e);return F.makeTensor(t,r,e)}function Vn(r,e="float32"){if(dn(r),e==="complex64"){let n=Vn(r,"float32"),o=Cr(r,"float32");return Xs(n,o)}let t=KC(Vt(r),e);return F.makeTensor(t,r,e)}function P8(r,e,{indexing:t="xy"}={}){if(t!=="xy"&&t!=="ij")throw new TypeError(`${t} is not a valid third argument to meshgrid`);if(r===void 0)return[];let n=D(r,"x","meshgrid",r instanceof Ct?r.dtype:"float32");if(e===void 0)return[n];let o=D(e,"y","meshgrid",e instanceof Ct?e.dtype:"float32"),s=Vt(n.shape),i=Vt(o.shape);return t==="xy"?(n=H(n,[1,-1]),o=H(o,[-1,1]),[Tt(Vn([i,1],n.dtype),n),Tt(o,Vn([1,s],o.dtype))]):(n=H(n,[-1,1]),o=H(o,[1,-1]),[Tt(n,Vn([1,i],n.dtype)),Tt(Vn([s,1],o.dtype),o)])}function VAe(r,e){let t=D(r,"a","minimum"),n=D(e,"b","minimum");[t,n]=Bt(t,n),t.dtype==="bool"&&(t=he(t,"int32"),n=he(n,"int32")),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(Yc,o)}var Js=O({minimum_:VAe});function BAe(r,e,t){$(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=D(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");$(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let o=t==="reflect"?1:0;for(let a=0;a<n.rank;a++)$(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),$(e[a][0]>=0&&e[a][0]<=n.shape[a]-o&&e[a][1]>=0&&e[a][1]<=n.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${n.shape[a]-o} or less than 0 for input of shape ${n.shape}`);let s={paddings:e,mode:t},i={x:n};return F.runKernel(Gu,i,s)}var Zv=O({mirrorPad_:BAe});function zAe(r,e){let t=D(r,"a","mod"),n=D(e,"b","mod");[t,n]=Bt(t,n);let o={a:t,b:n};return F.runKernel(Zc,o)}var oE=O({mod_:zAe});function UAe(r,e=null,t=!1){r=D(r,"x","moments");let n=Yn(e,r.shape),o=qr(r,n,t),s=o.shape;t||(s=Va(o.shape,n));let i=vt(Te(he(r,"float32"),H(o,s))),a=qr(i,n,t);return{mean:o,variance:a}}var Qg=O({moments_:UAe});function GAe(r,e,t,n){let o=D(e,"data","multiRNNCell"),s=Gg(t,"c","multiRNNCell"),i=Gg(n,"h","multiRNNCell"),a=o,c=[];for(let p=0;p<r.length;p++){let d=r[p](a,s[p],i[p]);c.push(d[0]),c.push(d[1]),a=d[1]}let l=[],u=[];for(let p=0;p<c.length;p+=2)l.push(c[p]),u.push(c[p+1]);return[l,u]}var $8=O({multiRNNCell_:GAe});function WAe(r,e,t,n=!1){let o=D(r,"logits","multinomial"),s=o.size,i=o.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);t=t||Math.random();let c={logits:i===1?H(o,[1,-1]):o},l={numSamples:e,seed:t,normalized:n},u=F.runKernel(xf,c,l);return i===1?H(u,[u.size]):u}var L8=O({multinomial_:WAe});function jAe(r,e){let t=D(r,"a","notEqual","string_or_numeric"),n=D(e,"b","notEqual","string_or_numeric");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n};return F.runKernel(wd,o)}var Cl=O({notEqual_:jAe});function HAe(r,e,t=1,n=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let i={indices:D(r,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:t,offValue:n};return F.runKernel(Hu,i,a)}var Jg=O({oneHot_:HAe});function qAe(r){let t={x:D(r,"x","onesLike")};return F.runKernel(ju,t)}var lo=O({onesLike_:qAe});function KAe(r,e){let t=D(r,"v1","outerProduct"),n=D(e,"v2","outerProduct");$(t.rank===1&&n.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${n.rank}.`);let o=H(t,[-1,1]),s=H(n,[1,-1]);return Tt(o,s)}var V8=O({outerProduct_:KAe});function XAe(r,e,t=0){let n=D(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:e,constantValue:t},s={x:n};return F.runKernel(Ku,s,o)}var ko=O({pad_:XAe});function YAe(r,e,t=0){return $(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),ko(r,[e],t)}var B8=O({pad1d_:YAe});function ZAe(r,e,t=0){return $(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ko(r,e,t)}var z8=O({pad2d_:ZAe});function QAe(r,e,t=0){return $(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ko(r,e,t)}var U8=O({pad3d_:QAe});function JAe(r,e,t=0){return $(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ko(r,e,t)}var G8=O({pad4d_:JAe});function eRe(r,e,t){let n=D(r,"x","spaceToBatchND");$(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),$(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),$(n.shape.reduce((i,a,c)=>c>0&&c<=e.length?i&&(a+t[c-1][0]+t[c-1][1])%e[c-1]===0:i,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let o={x:n},s={blockShape:e,paddings:t};return F.runKernel(op,o,s)}var Qf=O({spaceToBatchND_:eRe});function tRe(r,e,t,n,o,s,i){o==null&&(o=[1,1]),s==null&&(s=1),n===0&&(n="valid");let a=D(r,"x","maxPool"),c=a,l=!1;a.rank===3&&(l=!0,c=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),$(zo(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let u=m3(c.shape,e,s,o,n),p=[u.dilationHeight,u.dilationWidth],d;n==="same"?d=nRe([u.filterHeight,u.filterWidth],p):d=[[0,0],[0,0]];let h=p[0]===1&&p[1]===1,[f,m]=rRe([u.inHeight,u.inWidth],p,d),g=h?n:"valid",y=h?c:Qf(c,p,f),b=(t==="avg"?()=>Uf(y,e,s,g,i):()=>Zf(y,e,s,g,i))(),w=h?b:Gf(b,p,m);return l?H(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function rRe(r,e,t){let n=t.map(u=>u[0]),o=t.map(u=>u[1]),s=r.concat(n,o),i=e.map((u,p)=>(u-s[p]%u)%u),a=o.map((u,p)=>u+i[p]),c=e.map((u,p)=>[n[p],a[p]]),l=e.map((u,p)=>[0,i[p]]);return[c,l]}function nRe(r,e){let n=r.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=n.map(i=>Math.floor(i/2)),s=n.map((i,a)=>i-o[a]);return n.map((i,a)=>[o[a],s[a]])}var sE=O({pool_:tRe});function oRe(r,e){let t=D(r,"x","prelu"),n=D(e,"alpha","prelu"),o={x:t,alpha:n};return F.runKernel(Xu,o)}var Jf=O({prelu_:oRe});function sRe(r,e=null,t=!1){let n=D(r,"x","prod");n.dtype==="bool"&&(n=he(n,"int32"));let o={x:n},s={axis:e,keepDims:t};return F.runKernel(Yu,o,s)}var iE=O({prod_:sRe});function iRe(r,e,t,n){let o=r.map((u,p)=>D(u,`tensors${p}`,"raggedGather","int32")),s=D(e,"paramsDenseValues","raggedGather"),i=D(t,"indices","raggedGather","int32"),a={paramsNestedSplits:o,paramsDenseValues:s,indices:i},c={outputRaggedRank:n},l=F.runKernel(vv,a,c);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var W8=O({raggedGather_:iRe});function aRe(r,e,t){let n=D(r,"starts","raggedRange"),o=D(e,"limits","raggedRange",n.dtype),s=D(t,"deltas","raggedRange",n.dtype),i={starts:n,limits:o,deltas:s},a=F.runKernel(bv,i);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}var j8=O({raggedRange_:aRe});function cRe(r,e,t,n,o){let s=D(r,"shape","raggedTensorToTensor","int32"),i=D(e,"values","raggedTensorToTensor"),a=D(t,"defaultValue","raggedTensorToTensor",i.dtype),c=n.map((p,d)=>D(p,`tensors${d}`,"raggedTensorToTensor","int32")),l={shape:s,values:i,defaultValue:a,rowPartitionTensors:c},u={rowPartitionTypes:o};return F.runKernel(wv,l,u)}var H8=O({raggedTensorToTensor_:cRe});function lRe(r,e,t){dn(r);let n=Vt(r),o=null;if(t==null||t==="float32")o=new Float32Array(n);else if(t==="int32")o=new Int32Array(n);else if(t==="bool")o=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);for(let s=0;s<n;s++)o[s]=e();return F.makeTensor(o,r,t)}var q8=O({rand_:lRe});var uE=Wp(c_());var ty=class{constructor(e,t,n,o,s){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let i=s||Math.random();this.random=uE.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let e,t,n=!1;for(;!n;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);let a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,t=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},cE=class{constructor(e,t,n,o){this.alpha=e,this.beta=1/t,this.dtype=n;let s=o||Math.random();this.randu=uE.alea(s.toString()),this.randn=new ty(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,o,s,i;for(;;){do o=this.randn.nextValue(),i=1+this.c*o;while(i<=0);if(i*=i*i,e=o*o,t=1-.331*e*e,n=.5*e+this.d*(1-i+Math.log(i)),s=this.randu(),s<t||Math.log(s)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},lE=class{constructor(e=0,t=1,n,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=uE.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function gRe(r,e,t=1,n="float32",o){if(dn(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error(`Unsupported data type ${n}`);let s=new cE(e,t,n,o),i=ze(r,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var uX=O({randomGamma_:gRe});function yRe(r,e=0,t=1,n,o){if(dn(r),n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let s=new ty(e,t,n,!1,o),i=ze(r,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var ry=O({randomNormal_:yRe});function xRe(r,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return ry(r,0,1,e,t)}var pX=O({randomStandardNormal_:xRe});function vRe(r,e=0,t=1,n="float32",o){dn(r);let s=ze(r,n),i=new lE(e,t,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Ai=O({randomUniform_:vRe});function bRe(r,e,t,n){return Ai(r,e,t,"int32",n)}var dX=O({randomUniformInt_:bRe});function wp(r,e,t=1,n="float32"){if(t===0)throw new Error("Cannot have a step of zero");let o={start:r,stop:e,step:t,dtype:n};return F.runKernel(wf,{},o)}function wRe(r){let t={input:D(r,"input","real")};return F.runKernel(Cf,t)}var Rd=O({real_:wRe});function CRe(r){let t={x:D(r,"x","reciprocal")};return F.runKernel(el,t)}var pE=O({reciprocal_:CRe});function _Re(r){let t={x:D(r,"x","relu")};return F.runKernel(tl,t)}var Go=O({relu_:_Re});function SRe(r){let t={x:D(r,"x","relu6")};return F.runKernel(rl,t)}var Qv=O({relu6_:SRe});function IRe(r,e){let n={x:D(r,"x","reverse")},o={dims:e};return F.runKernel(ep,n,o)}var Qn=O({reverse_:IRe});function TRe(r){let e=D(r,"x","reverse");return $(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Qn(e,0)}var hX=O({reverse1d_:TRe});function kRe(r,e){let t=D(r,"x","reverse");return $(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Qn(t,e)}var fX=O({reverse2d_:kRe});function ERe(r,e){let t=D(r,"x","reverse");return $(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Qn(t,e)}var mX=O({reverse3d_:ERe});function NRe(r,e){let t=D(r,"x","reverse");return $(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Qn(t,e)}var gX=O({reverse4d_:NRe});function DRe(r){let t={x:D(r,"x","round")};return F.runKernel(nl,t)}var Jv=O({round_:DRe});function ARe(r){let t={x:D(r,"x","rsqrt","float32")};return F.runKernel(ol,t)}var eb=O({rsqrt_:ARe});function RRe(r){let t={x:D(r,"x","selu")};return F.runKernel(sl,t)}var tb=O({selu_:RRe});function ORe(r,e,t,n,o,s=[1,1],i="NHWC"){let a=D(r,"x","separableConv2d"),c=D(e,"depthwiseFilter","separableConv2d"),l=D(t,"pointwiseFilter","separableConv2d"),u=a,p=!1;if(a.rank===3&&(p=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");$(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),$(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),$(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),$(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),$(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);let d=c.shape[2],h=c.shape[3];$(l.shape[2]===d*h,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${d*h}, but got ${l.shape[2]}.`);let f=yp(u,c,n,o,i,s),g=Ys(f,l,1,"valid",i);return p?H(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var rb=O({separableConv2d_:ORe});function MRe(r,e){return M(this,null,function*(){let t=D(r,"x","setdiff1d"),n=D(e,"y","setdiff1d");$(t.dtype===n.dtype,()=>`x and y should have the same dtype, but got x (${t.dtype}) and y (${n.dtype}).`),$(t.rank===1,()=>`x should be 1D tensor, but got x (${t.shape}).`),$(n.rank===1,()=>`y should be 1D tensor, but got y (${n.shape}).`);let o=yield t.data(),s=yield n.data(),i=new Set(s),a=0;for(let u=0;u<o.length;u++)i.has(o[u])||a++;let c=new ur([a],t.dtype),l=new ur([a],"int32");for(let u=0,p=0;u<o.length;u++)i.has(o[u])||(c.values[p]=o[u],l.values[p]=u,p++);return[c.toTensor(),l.toTensor()]})}var yX=MRe;function FRe(r){let t={x:D(r,"x","sign")};return F.runKernel(cl,t)}var dE=O({sign_:FRe});function PRe(r){let t={x:D(r,"x","sin","float32")};return F.runKernel(il,t)}var nb=O({sin_:PRe});function $Re(r){let t={x:D(r,"x","sinh")};return F.runKernel(al,t)}var ob=O({sinh_:$Re});function LRe(r,e,t){let n=D(r,"x","slice1d");return $(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),tt(n,[e],[t])}var sb=O({slice1d_:LRe});function VRe(r,e,t){let n=D(r,"x","slice2d");return $(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),tt(n,e,t)}var l_=O({slice2d_:VRe});function BRe(r,e,t){let n=D(r,"x","slice3d");return $(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),tt(n,e,t)}var ib=O({slice3d_:BRe});function zRe(r,e,t){let n=D(r,"x","slice4d");return $(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),tt(n,e,t)}var ny=O({slice4d_:zRe});function URe(r,e=-1){let t=D(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},o={dim:e};return F.runKernel(ip,n,o)}var em=O({softmax_:URe});function GRe(r){$(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return F.runKernel(af,e)}var tm=O({fft_:GRe});function WRe(r){$(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return F.runKernel(pf,e)}var Od=O({ifft_:WRe});function jRe(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let o=H(r,[t,e]);n=Od(o)}else{let o=[t,2*(e-1)],s=H(Rd(r),[t,e]),i=H(Hf(r),[t,e]),a=Qn(tt(s,[0,1],[t,e-2]),1),c=W(Qn(tt(i,[0,1],[t,e-2]),1),Oe(-1)),l=Xt([s,a],1),u=Xt([i,c],1),p=H(Xs(l,u),[o[0],o[1]]);n=Od(p)}if(n=Rd(n),r.rank===3&&r.shape[0]!==0){let o=n,s=r.shape[0];n=H(n,[s,n.shape[0]/s,n.shape[1]]),o.dispose()}return n}var ab=O({irfft_:jRe});function HRe(r,e,t=0){let o={x:D(r,"x","split")},s={numOrSizeSplits:e,axis:t};return F.runKernel(sp,o,s)}var Jn=O({split_:HRe});function qRe(r,e){$(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,o;if(e!=null&&e<t){let f=r.shape.map(g=>0),m=r.shape.map(g=>g);m[r.shape.length-1]=e,o=tt(r,f,m),t=e}else if(e!=null&&e>t){let f=r.shape.map(m=>m);f[r.shape.length-1]=e-t,o=Xt([r,Cr(f)],r.shape.length-1),t=e}else o=r;let s=nt(o),i=H(Xs(o,s),[n,t]),a=tm(i),c=Math.floor(t/2)+1,l=Rd(a),u=Hf(a),p=Jn(l,[c,t-c],l.shape.length-1),d=Jn(u,[c,t-c],u.shape.length-1),h=o.shape.slice();return h[o.shape.length-1]=c,H(Xs(p[0],d[0]),h)}var rm=O({rfft_:qRe});function KRe(r,e){let t=D(r,"a","squaredDifference"),n=D(e,"b","squaredDifference");[t,n]=Bt(t,n),yt(t.shape,n.shape);let o={a:t,b:n},s={};return F.runKernel(dl,o,s)}var cb=O({squaredDifference_:KRe});function XRe(r,e){let t=D(r,"x","squeeze","string_or_numeric");return H(t,$L(t.shape,e).newShape)}var Jt=O({squeeze_:XRe});function YRe(r,e=0){let t=Gg(r,"tensors","stack","string_or_numeric");$(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&$(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,o={axis:e};return F.runKernel(qu,n,o)}var mn=O({stack_:YRe});function ZRe(r,e=0){let n={x:D(r,"x","step")},o={alpha:e};return F.runKernel(gl,n,o)}var Ba=O({step_:ZRe});function QRe(r,e,t,n,o=0,s=0,i=0,a=0,c=0){let u={x:D(r,"x","stridedSlice","string_or_numeric")},p={begin:e,end:t,strides:n,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};return F.runKernel(Rf,u,p)}var hE=O({stridedSlice_:QRe});function JRe(r){let t={x:D(r,"x","tan","float32")};return F.runKernel(fl,t)}var fE=O({tan_:JRe});function Or(r,e){ta(r);let t=Ks(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Is(r,null,t,e)}function us(r,e,t){if(ta(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=Ks(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Is(r,e,n,t)}function mE(r,e,t){if(ta(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=Ks(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Is(r,e,n,t)}function xX(r,e,t){if(ta(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let n=Ks(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Is(r,e,n,t)}function vX(r,e,t){if(ta(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let n=Ks(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Is(r,e,n,t)}function bX(r,e,t){if(ta(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let n=Ks(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,Is(r,e,n,t)}function wX(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${o}.`;if(t.rank<o)throw new Error(s+` update.rank < ${o}. `);if(r.length<n+(t.rank-o))throw new Error(s+` Output shape length < ${n+(t.rank-o)}`);if(t.rank!==o+r.length-n)throw new Error(s+` update.rank != ${o+r.length-n}`);for(let i=0;i<o;++i)if(t.shape[i]!==e.shape[i])throw new Error(s+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-o;++i)if(t.shape[i+o]!==r[i+n])throw new Error(s+` updates.shape[${i+o}] (${t.shape[i+o]}) != shape[${i+o}] (${r[i+o]})`)}function u_(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}wX(t,e,r)}function e2e(r,e,t){let n=e.shape.length,o=n>1?e.shape[n-1]:1,s=t.length,i=1;for(let p=o;p<s;++p)i*=t[p];let a=o<1?1:o,c=Vt(e.shape)/a,l=[...gu(t.slice(0,o)),1],u=Vt(t);return{sliceRank:o,numUpdates:c,sliceSize:i,strides:l,outputSize:u}}function t2e(r,e,t){let n=D(r,"tensor","tensorScatterupdate"),o=D(e,"indices","tensorScatterupdate","int32"),s=D(t,"updates","tensorScatterupdate");if(u_(s,o,n.shape),n.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${s.dtype}.`);let i={tensor:n,indices:o,updates:s},a={};return F.runKernel(Tf,i,a)}var _X=O({tensorScatterUpdate_:t2e});function r2e(r,e=1,t=!0){let n=D(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);let s={x:n},i={k:e,sorted:t},[a,c]=F.runKernel(Mf,s,i);return{values:a,indices:c}}var gE=O({topk_:r2e});function n2e(r,e=0,t=1,n,o){if(dn(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new ty(e,t,n,!0,o),i=ze(r,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var lb=O({truncatedNormal_:n2e});function o2e(r,e=0){let t=D(r,"x","unique","string_or_numeric");$(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},o={axis:e},[s,i]=F.runKernel(Tv,n,o);return{values:s,indices:i}}var yE=O({unique_:o2e});function s2e(r,e,t){let n=D(r,"x","unsortedSegmentSum"),o=D(e,"segmentIds","unsortedSegmentSum","int32");$(hd(t),()=>"numSegments must be of dtype int");let s={x:n,segmentIds:o},i={numSegments:t};return F.runKernel(cp,s,i)}var ub=O({unsortedSegmentSum_:s2e});function i2e(r,e=0){let t=D(r,"x","unstack","string_or_numeric");$(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},o={axis:e};return F.runKernel(ap,n,o)}var eo=O({unstack_:i2e});function SX(r,e){return a_(r,e,"right")}function xE(r,e=!0,t,n){return F.makeVariable(r,e,t,n)}function vE(r,e){let t=[];for(let s=0;s<e.length;s++)e[s]&&t.push(s);let n=ze(r,"int32"),o=ze([t.length,r.length],"int32");for(let s=0;s<t.length;s++){let i=n.indexToLoc(t[s]),a=s*r.length;o.values.set(i,a)}return o.toTensor()}function a2e(r){return M(this,null,function*(){let e=D(r,"condition","whereAsync","bool"),t=yield e.data(),n=vE(e.shape,t);return r!==e&&e.dispose(),n})}var bE=a2e;function c2e(r,e,t){return M(this,null,function*(){let n=D(r,"tensor","boolMask"),o=D(e,"mask","boolMask","bool"),s=t??0,i=o.rank,a=n.shape;$(i>0,()=>"mask cannot be scalar"),On(a.slice(s,s+i),o.shape,"mask's shape must match the first K dimensions of tensor's shape,");let c=1;for(let m=s;m<s+i;m++)c*=a[m];let l=a.slice(0,s).concat([c],a.slice(s+i)),u=H(n,l),p=H(o,[-1]),d=yield bE(p),h=Jt(d,[1]),f=bp(u,h,s);return r!==n&&n.dispose(),e!==o&&o.dispose(),h.dispose(),u.dispose(),p.dispose(),d.dispose(),f})}var l2e=c2e;function u2e(r,e,t){let n=D(r,"x","transpose");if(e==null&&(e=n.shape.map((i,a)=>a).reverse()),$(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(i=>{$(i>=0&&i<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let o={x:n},s={perm:e};return n.dtype==="complex64"?ee(()=>{let i=Rd(n),a=Hf(n);return i=F.runKernel(Oa,{x:i},s),a=F.runKernel(Oa,{x:a},s),t&&(a=Rt(a)),Xs(i,a)}):F.runKernel(Oa,o,s)}var kt=O({transpose_:u2e});function p2e(r,e,t,n,o=!0){let s=D(r,"v","movingAverage"),i=D(e,"x","movingAverage"),a=D(t,"decay","movingAverage");jK(s,i),$(ki(s.shape,i.shape),()=>"Shape mismatch in v and x");let c=Oe(1),l=Te(c,a),u=W(Te(i,s),l);if(o){$(n!=null,()=>"When using zeroDebias: true, step is required.");let p=D(n,"step","movingAverage");u=Ce(u,Te(c,Xo(a,p)))}return ae(s,u)}var d2e=O({movingAverage_:p2e});function h2e(r,e,t){dn(t);let n=D(r,"indices","scatterND","int32"),o=D(e,"updates","scatterND");u_(o,n,t);let s={indices:n,updates:o},i={shape:t};return F.runKernel(If,s,i)}var f2e=O({scatterND_:h2e});function IX(r,e,t,n){if(r.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${r.dtype}.`);if(r.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${r.shape}.`);let o=r.rank>0?r.shape[0]:1,s=r.rank>1?r.shape[1]:1;if(t.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${s}.`);let i=e.size;if(!(e.rank===0||e.rank===1&&i===o))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${o}]`);if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function g2e(r,e,t,n=0){dn(t);let o=D(r,"sparseIndices","sparseToDense","int32"),s=D(e,"sparseValues","sparseToDense","string_or_numeric"),i=D(n,"defaultValue","sparseToDense",s.dtype);IX(o,s,t,i);let a={sparseIndices:o,sparseValues:s,defaultValue:i},c={outputShape:t};return F.runKernel(Df,a,c)}var y2e=O({sparseToDense_:g2e});function x2e(r,e){let t=D(e,"indices","gatherND","int32"),o={params:D(r,"x","gatherND","string_or_numeric"),indices:t};return F.runKernel(uf,o)}var v2e=O({gatherND_:x2e});function TX(r,e){if(e==null)return r.shape.slice();if(ki(r.shape,e))return e;if(r.shape.length===e.length){let t=[];for(let n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function b2e(r,e,t,n){let o=D(r,"x","dropout");if($(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),$(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return r instanceof Ct?o.clone():o;let s=TX(o,t),i=1-e,a=Ce(vp(ae(Ai(s,0,1,"float32",n),i)),i);return W(o,a)}var E3=O({dropout_:b2e});function N3(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function p_(r,e,t){let n=1-r%2,o=new Float32Array(r);for(let s=0;s<r;++s){let i=2*Math.PI*s/(r+n-1);o[s]=e-t*Math.cos(i)}return Or(o,"float32")}function w2e(r,e,t=1){return M(this,null,function*(){let n=D(r,"predictions","inTopK"),o=D(e,"targets","inTopK");$(n.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${n.rank}`),$(n.rank-1===o.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${n.rank} and targets rank ${o.rank}`),On(n.shape.slice(0,n.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=n.shape[n.shape.length-1];$(t>0&&t<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${t}`);let i=yield n.data(),a=yield o.data(),[c,l]=[i.length/s,s],u=LL("bool",c);for(let p=0;p<c;p++){let d=p*l,h=i.subarray(d,d+l),f=[];for(let m=0;m<h.length;m++)f.push({value:h[m],index:m});f.sort((m,g)=>g.value-m.value),u[p]=0;for(let m=0;m<t;m++)if(f[m].index===a[p]){u[p]=1;break}}return r!==n&&n.dispose(),e!==o&&o.dispose(),Co(u,o.shape,"bool")})}var C2e=w2e;var nm={};Nr(nm,{conv2d:()=>kX,depthwiseConv2d:()=>EX,matMul:()=>NX});function _2e(r,e,t,n,o,s="NHWC",i){let a=r;r.rank===3&&(a=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let c=e;c.rank===3&&(c=H(e,[1,e.shape[0],e.shape[1],e.shape[2]])),$(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),$(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),$(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let l=s==="NHWC"?a.shape[3]:a.shape[1],u=s==="NHWC"?c.shape[3]:c.shape[1];$(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),$(u===t[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${t[3]}).`),Wr("conv2dDerFilter",o,i);let p={x:a,dy:c},d={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:t};return F.runKernel(Kh,p,d)}var pb=O({conv2DBackpropFilter_:_2e});function oy(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return W(r,Ba(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function sy(r,e){let t=e,n=Lr(r.shape,e.shape);return n.length>0&&(t=Pe(t,n)),H(t,r.shape)}function iy(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Go(r);if(e==="elu")return xp(r);if(e==="relu6")return Qv(r);if(e==="prelu")return Jf(r,t);if(e==="leakyrelu")return qf(r,n);if(e==="sigmoid")return co(r);throw new Error(`Unknown fused activation ${e}.`)}var ay=(r,e)=>!(r>0)||e==="linear";function S2e({x:r,filter:e,strides:t,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:u}){if(c=c||"linear",ay(F.state.gradientDepth,c)===!1){$(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let I=Ys(r,e,t,n,o,s,i);return a!=null&&(I=ae(I,a)),iy(I,c,l,u)}let p=D(r,"x","conv2d","float32"),d=D(e,"filter","conv2d","float32"),h=p,f=!1;p.rank===3&&(f=!0,h=H(p,[1,p.shape[0],p.shape[1],p.shape[2]])),$(h.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${h.rank}.`),$(d.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${d.rank}.`),Wr("fused conv2d",n,i);let m=o==="NHWC"?h.shape[3]:h.shape[1];$(d.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${d.shape[2]}.`),$(zo(t,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`);let g=Xg(h.shape,d.shape,t,s,n,i),y;a!=null&&(y=D(a,"bias","fused conv2d"),[y]=Bt(y,p),o==="NHWC"?yt(g.outShape,y.shape):($(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),$(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(l!=null){let I=l.shape;if($(I.length<=1||I.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${I.length}.`),I.length===1)$(I[0]===1||I[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the number of output channels (${g.outChannels}).`);else if(I.length===3)try{yt(I,g.outShape)}catch{let k=`Error in fused conv2d: PReLU activation weights (${I}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(k)}x=D(l,"prelu weights","fused conv2d")}let b=(I,S)=>{$(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[k,R,L,B]=S,z=oy(I,L,c);$(na(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let q=Wv(R.shape,z,k,t,n),U=pb(R,z,k.shape,t,n),G=[q,U];if(B!=null){let j=sy(B,z);G.push(j)}return G},w={x:h,filter:d,bias:y,preluActivationWeights:x},_={strides:t,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:c,leakyreluAlpha:u};return a==null?Zs((S,k,R)=>{let L=F.runKernel(_d,w,_);return R([k,S,L]),f&&(L=H(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:b}})(h,d):Zs((S,k,R,L)=>{let B=F.runKernel(_d,w,_);return L([k,S,B,R]),f&&(B=H(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:b}})(h,d,y)}var kX=O({fusedConv2d_:S2e});function I2e(r,e,t,n,o,s=[1,1],i){let a=r;r.rank===3&&(a=H(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let c=e;c.rank===3&&(c=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={x:a,dy:c},u={strides:n,pad:o,dimRoundingMode:i,dilations:s,filterShape:t};return F.runKernel(tf,l,u)}var wE=O({depthwiseConv2dNativeBackpropFilter_:I2e});function T2e(r,e,t,n,o,s=[1,1],i){let a=e,c=!1;e.rank===3&&(c=!0,a=H(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={dy:a,filter:t},u={strides:n,pad:o,dimRoundingMode:i,dilations:s,inputShape:r},p=F.runKernel(rf,l,u);return c?H(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var CE=O({depthwiseConv2dNativeBackpropInput_:T2e});function k2e({x:r,filter:e,strides:t,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:u}){if(ay(F.state.gradientDepth,c)===!1){let _=yp(r,e,t,n,o,s,i);return a!=null&&(_=ae(_,a)),iy(_,c,l,u)}let p=D(r,"x","depthwiseConv2d","float32"),d=D(e,"filter","depthwiseConv2d","float32"),h=p,f=!1;p.rank===3&&(f=!0,h=H(p,[1,p.shape[0],p.shape[1],p.shape[2]])),$(h.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${h.rank}.`),$(d.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${d.rank}.`),$(h.shape[3]===d.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${h.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),s==null&&(s=[1,1]),$(zo(t,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${s}'`),Wr("fused depthwiseConv2d",n,i);let m=Xg(h.shape,d.shape,t,s,n,i,!0),g;a!=null&&(g=D(a,"bias","fused conv2d"),[g]=Bt(g,p),yt(m.outShape,g.shape));let y;l!=null&&(y=D(l,"prelu weights","fused depthwiseConv2d"));let x=(_,I)=>{$(na(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[S,k,R,L]=I,B=oy(_,R,c),z=CE(k.shape,B,S,t,n,s,i),q=wE(k,B,S.shape,t,n,s,i);if(L!=null){let U=sy(g,B);return[z,q,U]}return[z,q]},b={x:h,filter:d,bias:g,preluActivationWeights:y},w={strides:t,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:c,leakyreluAlpha:u};return a==null?Zs((I,S,k)=>{let R=F.runKernel(Sd,b,w);return k([S,I,R]),f&&(R=H(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:x}})(h,d):Zs((I,S,k,R)=>{let L=F.runKernel(Sd,b,w);return R([S,I,L,k]),f&&(L=H(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:x}})(h,d,g)}var EX=O({fusedDepthwiseConv2d_:k2e});function E2e({a:r,b:e,transposeA:t=!1,transposeB:n=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(ay(F.state.gradientDepth,s)===!1){let B=Tt(r,e,t,n);return o!=null&&(B=ae(B,o)),iy(B,s,i,a)}let c=D(r,"a","fused matMul"),l=D(e,"b","fused matMul");[c,l]=Bt(c,l);let u=t?c.shape[c.rank-2]:c.shape[c.rank-1],p=n?l.shape[l.rank-1]:l.shape[l.rank-2],d=t?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-2]:l.shape[l.rank-1],f=c.shape.slice(0,-2),m=l.shape.slice(0,-2),g=Vt(f),y=Vt(m);$(u===p,()=>`Error in fused matMul: inner shapes (${u}) and (${p}) of Tensors with shapes ${c.shape} and ${l.shape} and transposeA=${t} and transposeB=${n} must match.`);let b=yt(c.shape.slice(0,-2),l.shape.slice(0,-2)).concat([d,h]),w=t?H(c,[g,u,d]):H(c,[g,d,u]),_=n?H(l,[y,h,p]):H(l,[y,p,h]),I;o!=null&&(I=D(o,"bias","fused matMul"),[I]=Bt(I,c),yt(b,I.shape));let S;i!=null&&(S=D(i,"prelu weights","fused matMul"));let k=(B,z)=>{let[q,U,G,j]=z,X=oy(H(B,G.shape),G,s),te,ne;if(!t&&!n?(te=Tt(X,U,!1,!0),ne=Tt(q,X,!0,!1)):!t&&n?(te=Tt(X,U,!1,!1),ne=Tt(X,q,!0,!1)):t&&!n?(te=Tt(U,X,!1,!0),ne=Tt(q,X,!1,!1)):(te=Tt(U,X,!0,!0),ne=Tt(X,q,!0,!0)),o!=null){let oe=sy(j,X);return[te,ne,oe]}else return[te,ne]},R={a:w,b:_,bias:I,preluActivationWeights:S},L={transposeA:t,transposeB:n,activation:s,leakyreluAlpha:a};return o==null?Zs((z,q,U)=>{let G=F.runKernel(Cd,R,L);return U([z,q,G]),{value:H(G,b),gradFunc:k}})(w,_):Zs((z,q,U,G)=>{let j=F.runKernel(Cd,R,L);return G([z,q,j,U]),{value:H(j,b),gradFunc:k}})(w,_,I)}var NX=O({fusedMatMul_:E2e});function N2e(r){return p_(r,.54,.46)}var DX=O({hammingWindow_:N2e});function D2e(r){return p_(r,.5,.5)}var _E=O({hannWindow_:D2e});function A2e(r,e,t,n=!1,o=0){let s=0,i=[];for(;s+e<=r.size;)i.push(tt(r,s,e)),s+=t;if(n)for(;s<r.size;){let a=s+e-r.size,c=Xt([tt(r,s,e-a),La([a],o)]);i.push(c),s+=t}return i.length===0?us([],[0,e]):H(Xt(i),[i.length,e])}var SE=O({frame_:A2e});function R2e(r,e,t,n,o=_E){n==null&&(n=N3(e));let s=SE(r,e,t),i=W(s,o(e));return rm(i,n)}var AX=O({stft_:R2e});function O2e(r,e,t,n,o="bilinear",s=0){let i=D(r,"image","cropAndResize"),a=D(e,"boxes","cropAndResize","float32"),c=D(t,"boxInd","cropAndResize","int32"),l=a.shape[0];$(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),$(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),$(c.rank===1&&c.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),$(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),$(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),$(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let u={image:i,boxes:a,boxInd:c},p={method:o,extrapolationValue:s,cropSize:n};return F.runKernel(Qh,u,p)}var RX=O({cropAndResize_:O2e});function M2e(r){let e=D(r,"image","flipLeftRight","float32");$(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);let t={image:e};return F.runKernel(lf,t,{})}var OX=O({flipLeftRight_:M2e});function F2e(r){let e=D(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];$(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),$(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let o=new Array(e.rank);return o.fill(1,0,t),o[t]=3,Uo(e,o)}var MX=O({grayscaleToRGB_:F2e});function P2e(r){let e=D(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];$(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),$(n===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${n}.`);let o=e.dtype,s=he(e,"float32"),i=Or([.2989,.587,.114]),a;switch(e.rank){case 2:a=jf("ij,j->i",s,i);break;case 3:a=jf("ijk,k->ij",s,i);break;case 4:a=jf("ijkl,l->ijk",s,i);break;case 5:a=jf("ijklm,m->ijkl",s,i);break;case 6:a=jf("ijklmn,n->ijklm",s,i);break;default:throw new Error("Not a valid tensor rank.")}return a=Hr(a,-1),he(a,o)}var FX=O({rgbToGrayscale_:P2e});function $2e(r,e,t=0,n=.5){let o=D(r,"image","rotateWithOffset","float32");$(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let s={image:o},i={radians:e,fillValue:t,center:n};return F.runKernel(Pf,s,i)}var PX=O({rotateWithOffset_:$2e});function za(r,e,t,n,o,s){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=r.shape[0];return t=Math.min(t,i),$(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),$(r.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${r.rank}'`),$(r.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${r.shape[1]}`),$(e.rank===1,()=>"scores must be a 1D tensor"),$(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),$(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:t,iouThreshold:n,scoreThreshold:o,softNmsSigma:s}}function L2e(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY){let s=D(r,"boxes","nonMaxSuppression","float32"),i=D(e,"scores","nonMaxSuppression","float32"),a=za(s,i,t,n,o);t=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let c={maxOutputSize:t,iouThreshold:n,scoreThreshold:o};return F.runKernel(vf,{boxes:s,scores:i},c)}var $X=O({nonMaxSuppression_:L2e});function LX(r,e,t){let n=V2e(r,e,t),o=n<0?-(n+1):n;r.splice(o,0,e)}function V2e(r,e,t){return z2e(r,e,t||B2e)}function B2e(r,e){return r>e?1:r<e?-1:0}function z2e(r,e,t){let n=0,o=r.length,s=0,i=!1;for(;n<o;){s=n+(o-n>>>1);let a=t(e,r[s]);a>0?n=s+1:(o=s,i=!a)}return i?n:-n-1}function IE(r,e,t,n,o){return D3(r,e,t,n,o,0)}function TE(r,e,t,n,o,s){return D3(r,e,t,n,o,0,!1,s,!0)}function kE(r,e,t,n,o,s){return D3(r,e,t,n,o,s,!0)}function D3(r,e,t,n,o,s,i=!1,a=!1,c=!1){let l=[];for(let g=0;g<e.length;g++)e[g]>o&&l.push({score:e[g],boxIndex:g,suppressBeginIndex:0});l.sort(VX);let u=s>0?-.5/s:0,p=[],d=[];for(;p.length<t&&l.length>0;){let g=l.pop(),{score:y,boxIndex:x,suppressBeginIndex:b}=g;if(y<o)break;let w=!1;for(let _=p.length-1;_>=b;--_){let I=U2e(r,x,p[_]);if(I>=n){w=!0;break}if(g.score=g.score*G2e(n,u,I),g.score<=o)break}g.suppressBeginIndex=p.length,w||(g.score===y?(p.push(x),d.push(g.score)):g.score>o&&LX(l,g,VX))}let h=p.length,f=t-h;a&&f>0&&(p.push(...new Array(f).fill(0)),d.push(...new Array(f).fill(0)));let m={selectedIndices:p};return i&&(m.selectedScores=d),c&&(m.validOutputs=h),m}function U2e(r,e,t){let n=r.subarray(e*4,e*4+4),o=r.subarray(t*4,t*4+4),s=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),a=Math.max(n[0],n[2]),c=Math.max(n[1],n[3]),l=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(a-s)*(c-i),f=(p-l)*(d-u);if(h<=0||f<=0)return 0;let m=Math.max(s,l),g=Math.max(i,u),y=Math.min(a,p),x=Math.min(c,d),b=Math.max(y-m,0)*Math.max(x-g,0);return b/(h+f-b)}function G2e(r,e,t){let n=Math.exp(e*t*t);return t<=r?n:0}function VX(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function W2e(s,i,a){return M(this,arguments,function*(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY){let c=D(r,"boxes","nonMaxSuppressionAsync"),l=D(e,"scores","nonMaxSuppressionAsync"),u=za(c,l,t,n,o);t=u.maxOutputSize,n=u.iouThreshold,o=u.scoreThreshold;let p=yield Promise.all([c.data(),l.data()]),d=p[0],h=p[1],{selectedIndices:f}=IE(d,h,t,n,o);return c!==r&&c.dispose(),l!==e&&l.dispose(),Or(f,"int32")})}var BX=W2e;function j2e(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=D(r,"boxes","nonMaxSuppression"),a=D(e,"scores","nonMaxSuppression"),c=za(i,a,t,n,o,s);t=c.maxOutputSize,n=c.iouThreshold,o=c.scoreThreshold,s=c.softNmsSigma;let l={boxes:i,scores:a},u={maxOutputSize:t,iouThreshold:n,scoreThreshold:o,softNmsSigma:s},p=F.runKernel(bf,l,u);return{selectedIndices:p[0],selectedScores:p[1]}}var zX=O({nonMaxSuppressionWithScore_:j2e});function H2e(i,a,c){return M(this,arguments,function*(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let l=D(r,"boxes","nonMaxSuppressionAsync"),u=D(e,"scores","nonMaxSuppressionAsync"),p=za(l,u,t,n,o,s);t=p.maxOutputSize,n=p.iouThreshold,o=p.scoreThreshold,s=p.softNmsSigma;let d=yield Promise.all([l.data(),u.data()]),h=d[0],f=d[1],{selectedIndices:m,selectedScores:g}=kE(h,f,t,n,o,s);return l!==r&&l.dispose(),u!==e&&u.dispose(),{selectedIndices:Or(m,"int32"),selectedScores:Or(g)}})}var UX=H2e;function q2e(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=D(r,"boxes","nonMaxSuppression"),a=D(e,"scores","nonMaxSuppression"),c=za(i,a,t,n,o,null),l=c.maxOutputSize,u=c.iouThreshold,p=c.scoreThreshold,d={boxes:i,scores:a},h={maxOutputSize:l,iouThreshold:u,scoreThreshold:p,padToMaxOutputSize:s},f=F.runKernel(xv,d,h);return{selectedIndices:f[0],validOutputs:f[1]}}var GX=O({nonMaxSuppressionPadded_:q2e});function K2e(i,a,c){return M(this,arguments,function*(r,e,t,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let l=D(r,"boxes","nonMaxSuppressionAsync"),u=D(e,"scores","nonMaxSuppressionAsync"),p=za(l,u,t,n,o,null),d=p.maxOutputSize,h=p.iouThreshold,f=p.scoreThreshold,[m,g]=yield Promise.all([l.data(),u.data()]),{selectedIndices:y,validOutputs:x}=TE(m,g,d,h,f,s);return l!==r&&l.dispose(),u!==e&&u.dispose(),{selectedIndices:Or(y,"int32"),validOutputs:Oe(x,"int32")}})}var WX=K2e;function X2e(r,e,t=!1,n=!1){let o=D(r,"images","resizeBilinear");$(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),$(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),$(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},c={alignCorners:t,halfPixelCenters:n,size:e},l=F.runKernel(Ju,a,c);return i?H(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var EE=O({resizeBilinear_:X2e});function Y2e(r,e,t=!1,n=!1){let o=D(r,"images","resizeNearestNeighbor");$(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),$(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),$(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),$(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=H(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},c={alignCorners:t,halfPixelCenters:n,size:e},l=F.runKernel(Qu,a,c);return i?H(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var NE=O({resizeNearestNeighbor_:Y2e});function Z2e(r,e="binary",t=!1,n=.5){let o=D(r,"image","threshold"),s=.2989,i=.587,a=.114,c=o.shape[0]*o.shape[1],l=W(Or([n]),255),u,p,d,h;if($(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),$(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),$(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),$(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[u,p,d]=Jn(o,[1,1,1],-1);let g=W(u,s),y=W(p,i),x=W(d,a);h=ae(ae(g,y),x)}else h=r;if(e==="otsu"){let g=Fk(he(Jv(h),"int32"),Co([]),256);l=Q2e(g,c)}let f=t?Di(h,l):fn(h,l);return he(W(f,255),"int32")}function Q2e(r,e){let t=Or([-1]),n=Or([0]),o=Or([0]),s,i,a,c,l,u;for(let p=0;p<r.size-1;p++){s=tt(r,0,p+1),i=tt(r,p+1),l=Ce(Pe(s),e),u=Ce(Pe(i),e);let d=Pe(W(s,wp(0,s.size)));a=Ce(d,Pe(s));let h=La(i.shape,s.size),f=ae(wp(0,i.size),h),m=W(i,f);c=Ce(Pe(m),Pe(i));let g=Te(a,c),y=Te(a,c),x=W(l,u);o=W(W(x,g),y);let b=fn(o,n);n=jr(b,o,n),t=jr(b,Or([p]),t)}return t}var jX=O({threshold_:Z2e});function J2e(r,e,t="nearest",n="constant",o=0,s){let i=D(r,"image","transform","float32"),a=D(e,"transforms","transform","float32");$(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),$(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),$(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let c={image:i,transforms:a},l={interpolation:t,fillMode:n,fillValue:o,outputShape:s};return F.runKernel(Ff,c,l)}var HX=O({transform_:J2e});function eOe(r,e,t){let n=D(r,"a","bandPart");$(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let o=n.shape,[s,i]=n.shape.slice(-2),a,c;typeof e=="number"?($(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),$(e<=s,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`),a=D(e<0?s:e,"numLower","bandPart")):($(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=jr(Ad(e,0),s,Js(e,s))),typeof t=="number"?($(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),$(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),c=D(t<0?i:t,"numUpper","bandPart")):($(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=jr(Ad(t,0),i,Js(t,i)));let l=H(wp(0,s,1,"int32"),[-1,1]),u=wp(0,i,1,"int32"),p=Te(l,u),d=Yo(Di(p,a),Es(p,Rt(c))),h=Cr([s,i],n.dtype);return H(mn(eo(H(n,[-1,s,i])).map(f=>jr(d,f,h))),o)}var qX=O({bandPart_:eOe});function tOe(r){let e;if(Array.isArray(r)){e=!1,$(r!=null&&r.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=r[0].shape[0];for(let s=1;s<r.length;++s)$(r[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${r[s].shape[0]} vs. ${o})`)}else e=!0,r=Jn(r,r.shape[0],0).map(o=>Jt(o,[0]));$(r.length<=r[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${r.length}) exceeds number of dimensions (${r[0].shape[0]}).`);let t=[],n=r;for(let o=0;o<r.length;++o)t.push(F.tidy(()=>{let s=n[o];if(o>0)for(let i=0;i<o;++i){let a=W(Pe(W(t[i],s)),t[i]);s=Te(s,a)}return Ce(s,Dd(s,"euclidean"))}));return e?mn(t,0):t}var KX=O({gramSchmidt_:tOe});function rOe(r,e=!1){if($(r.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${r.rank}`),r.rank===2)return XX(r,e);{let t=r.shape.slice(0,r.shape.length-2).reduce((c,l)=>c*l),n=eo(H(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),o=[],s=[];n.forEach(c=>{let[l,u]=XX(c,e);o.push(l),s.push(u)});let i=H(mn(o,0),r.shape),a=H(mn(s,0),r.shape);return[i,a]}}function XX(r,e=!1){return F.tidy(()=>{$(r.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${r.shape.length}D Tensor.`);let t=r.shape[0],n=r.shape[1],o=Zg(t),s=Ts(r),i=us([[1]],[1,1]),a=Ts(i),c=t>=n?n:t;for(let l=0;l<c;++l){let u=s,p=a,d=o;[a,s,o]=F.tidy(()=>{let h=tt(s,[l,l],[t-l,1]),f=Dd(h),m=tt(s,[l,l],[1,1]),g=jr(fn(m,0),us([[-1]]),us([[1]])),y=Te(m,W(g,f)),x=Ce(h,y);x.shape[0]===1?a=Ts(i):a=Xt([i,tt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);let b=Rt(Ce(Tt(g,y),f)),w=tt(s,[l,0],[t-l,n]),_=W(b,a),I=kt(a);if(l===0)s=Te(w,Tt(_,Tt(I,w)));else{let R=Te(w,Tt(_,Tt(I,w)));s=Xt([tt(s,[0,0],[l,n]),R],0)}let S=kt(_),k=tt(o,[0,l],[t,o.shape[1]-l]);if(l===0)o=Te(k,Tt(Tt(k,a),S));else{let R=Te(k,Tt(Tt(k,a),S));o=Xt([tt(o,[0,0],[t,l]),R],1)}return[a,s,o]}),Xe([u,p,d])}return!e&&t>n&&(o=tt(o,[0,0],[t,n]),s=tt(s,[0,0],[n,n])),[o,s]})}var YX=O({qr_:rOe});var Un=function(r){return r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS",r}(Un||{});function nOe(r,e,t=Un.SUM_BY_NONZERO_WEIGHTS){let n=D(r,"losses","computeWeightedLoss"),o=null;e!=null&&(o=D(e,"weights","computeWeightedLoss"));let s=o==null?n:W(n,o);if(t===Un.NONE)return s;if(t===Un.SUM)return Pe(s);if(t===Un.MEAN){if(o==null)return qr(s);{let i=n.size/o.size,a=Ce(Pe(s),Pe(o));return i>1?Ce(a,Oe(i)):a}}if(t===Un.SUM_BY_NONZERO_WEIGHTS){if(o==null)return Ce(Pe(s),Oe(n.size));{let i=W(o,Vn(n.shape)),a=he(Pe(Cl(i,Oe(0))),"float32");return Ce(Pe(s),a)}}throw Error(`Unknown reduction: ${t}`)}var Zo=O({computeWeightedLoss_:nOe});function oOe(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let o=D(r,"labels","absoluteDifference"),s=D(e,"predictions","absoluteDifference"),i=null;t!=null&&(i=D(t,"weights","absoluteDifference")),On(o.shape,s.shape,"Error in absoluteDifference: ");let a=Qr(Te(o,s));return Zo(a,i,n)}var ZX=O({absoluteDifference_:oOe});function sOe(r,e,t,n,o=Un.SUM_BY_NONZERO_WEIGHTS){let s=D(r,"labels","cosineDistance"),i=D(e,"predictions","cosineDistance"),a=null;n!=null&&(a=D(n,"weights","cosineDistance")),On(s.shape,i.shape,"Error in cosineDistance: ");let c=Oe(1),l=Te(c,Pe(W(s,i),t,!0));return Zo(l,a,o)}var QX=O({cosineDistance_:sOe});function iOe(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let o=D(r,"labels","hingeLoss"),s=D(e,"predictions","hingeLoss"),i=null;t!=null&&(i=D(t,"weights","hingeLoss")),On(o.shape,s.shape,"Error in hingeLoss: ");let a=Oe(1);o=Te(W(Oe(2),o),a);let c=Go(Te(a,W(o,s)));return Zo(c,i,n)}var JX=O({hingeLoss_:iOe});function aOe(r,e,t,n=1,o=Un.SUM_BY_NONZERO_WEIGHTS){let s=D(r,"labels","huberLoss"),i=D(e,"predictions","huberLoss"),a=null;t!=null&&(a=D(t,"weights","huberLoss")),On(s.shape,i.shape,"Error in huberLoss: ");let c=Oe(n),l=Qr(Te(i,s)),u=Js(l,c),p=Te(l,u),d=ae(W(Oe(.5),vt(u)),W(c,p));return Zo(d,a,o)}var eY=O({huberLoss_:aOe});function cOe(r,e,t,n=1e-7,o=Un.SUM_BY_NONZERO_WEIGHTS){let s=D(r,"labels","logLoss"),i=D(e,"predictions","logLoss"),a=null;t!=null&&(a=D(t,"weights","logLoss")),On(s.shape,i.shape,"Error in logLoss: ");let c=Oe(1),l=Oe(n),u=Rt(W(s,To(ae(i,l)))),p=W(Te(c,s),To(ae(Te(c,i),l))),d=Te(u,p);return Zo(d,a,o)}var tY=O({logLoss_:cOe});function lOe(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let o=D(r,"labels","meanSquaredError"),s=D(e,"predictions","meanSquaredError"),i=null;t!=null&&(i=D(t,"weights","meanSquaredError")),On(o.shape,s.shape,"Error in meanSquaredError: ");let a=cb(o,s);return Zo(a,i,n)}var rY=O({meanSquaredError_:lOe});function uOe(r,e){let t=D(r,"labels","sigmoidCrossEntropyWithLogits"),n=D(e,"logits","sigmoidCrossEntropyWithLogits");On(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");let o=Go(n),s=W(n,t),i=Kf(nn(Rt(Qr(n))));return ae(Te(o,s),i)}function pOe(r,e,t,n=0,o=Un.SUM_BY_NONZERO_WEIGHTS){let s=D(r,"multiClassLabels","sigmoidCrossEntropy"),i=D(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=D(t,"weights","sigmoidCrossEntropy")),On(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),n>0){let l=Oe(n),u=Oe(1),p=Oe(.5);s=ae(W(s,Te(u,l)),W(p,l))}let c=uOe(s,i);return Zo(c,a,o)}var nY=O({sigmoidCrossEntropy_:pOe});function dOe(r,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Zs((o,s,i)=>{let c=Xf(s,[t],!0),l=Te(he(s,"float32"),c);i([o,l]);let u=Rt(W(l,o));return{value:Pe(u,[t]),gradFunc:(h,f)=>{let[m,g]=f,y=Va(h.shape,[t]);return[W(H(h,y),Te(he(m,"float32"),nn(g))),W(H(h,y),Te(nn(g),he(m,"float32")))]}}})(r,e)}function hOe(r,e,t,n=0,o=Un.SUM_BY_NONZERO_WEIGHTS){let s=D(r,"onehotLabels","softmaxCrossEntropy"),i=D(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=D(t,"weights","softmaxCrossEntropy")),On(s.shape,i.shape,"Error in softmaxCrossEntropy: "),n>0){let l=Oe(n),u=Oe(1),p=Oe(s.shape[1]);s=ae(W(s,Te(u,l)),Ce(l,p))}let c=dOe(s,i);return Zo(c,a,o)}var oY=O({softmaxCrossEntropy_:hOe});function fOe(r,e,t,n){let o=D(r,"indices","sparseFillEmptyRows","int32"),s=D(e,"values","sparseFillEmptyRows"),i=D(t,"denseShape","sparseFillEmptyRows","int32"),a=D(n,"defaultValue","sparseFillEmptyRows",s.dtype);if(o.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${o.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);let c={indices:o,values:s,denseShape:i,defaultValue:a},l=F.runKernel(Cv,c);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var sY=O({sparseFillEmptyRows_:fOe});function mOe(r,e,t){let n=D(r,"inputIndices","sparseReshape","int32"),o=D(e,"inputShape","sparseReshape","int32"),s=D(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${n.shape}`);if(o.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${o.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);let i={inputIndices:n,inputShape:o,newShape:s},a=F.runKernel(_v,i);return{outputIndices:a[0],outputShape:a[1]}}var iY=O({sparseReshape_:mOe});function gOe(r,e,t){let n=D(r,"data","sparseSegmentMean"),o=D(e,"indices","sparseSegmentMean","int32"),s=D(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${o.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);let i={data:n,indices:o,segmentIds:s};return F.runKernel(Ef,i)}var aY=O({sparseSegmentMean_:gOe});function yOe(r,e,t){let n=D(r,"data","sparseSegmentSum"),o=D(e,"indices","sparseSegmentSum","int32"),s=D(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${o.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);let i={data:n,indices:o,segmentIds:s};return F.runKernel(Nf,i)}var cY=O({sparseSegmentSum_:yOe});function xOe(r,e,t,n,o,s,i,a){let c=D(r,"data","stringNGrams","string");if(c.dtype!=="string")throw new Error("Data must be of datatype string");if(c.shape.length!==1)throw new Error(`Data must be a vector, saw: ${c.shape}`);let l=D(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let u={separator:t,nGramWidths:n,leftPad:o,rightPad:s,padWidth:i,preserveShortSequences:a},p={data:c,dataSplits:l},d=F.runKernel(Of,p,u);return{nGrams:d[0],nGramsSplits:d[1]}}var lY=O({stringNGrams_:xOe});function vOe(r,e,t=!0){let n=D(r,"input","stringSplit","string"),o=D(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${n.shape}`);if(o.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${o.shape}`);let s={skipEmpty:t},i={input:n,delimiter:o},a=F.runKernel(Sv,i,s);return{indices:a[0],values:a[1],shape:a[2]}}var uY=O({stringSplit_:vOe});function bOe(r,e){let t=D(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");let o={input:t};return F.runKernel(Iv,o,n)}var pY=O({stringToHashBucketFast_:bOe});function wOe(r,e,t,n=!0){let o=D(r,"input","staticRegexReplace","string"),s={pattern:e,rewrite:t,replaceGlobal:n};return F.runKernel(Pg,{x:o},s)}var dY=O({staticRegexReplace_:wOe});var COe={fft:tm,ifft:Od,rfft:rm,irfft:ab},_Oe={hammingWindow:DX,hannWindow:_E,frame:SE,stft:AX},Gn={flipLeftRight:OX,grayscaleToRGB:MX,resizeNearestNeighbor:NE,resizeBilinear:EE,rgbToGrayscale:FX,rotateWithOffset:PX,cropAndResize:RX,nonMaxSuppression:$X,nonMaxSuppressionAsync:BX,nonMaxSuppressionWithScore:zX,nonMaxSuppressionWithScoreAsync:UX,nonMaxSuppressionPadded:GX,nonMaxSuppressionPaddedAsync:WX,threshold:jX,transform:HX},A3={bandPart:qX,gramSchmidt:KX,qr:YX},SOe={absoluteDifference:ZX,computeWeightedLoss:Zo,cosineDistance:QX,hingeLoss:JX,huberLoss:eY,logLoss:tY,meanSquaredError:rY,sigmoidCrossEntropy:nY,softmaxCrossEntropy:oY},IOe={sparseFillEmptyRows:sY,sparseReshape:iY,sparseSegmentMean:aY,sparseSegmentSum:cY},TOe={stringNGrams:lY,stringSplit:uY,stringToHashBucketFast:pY,staticRegexReplace:dY};var fe={};Nr(fe,{Serializable:()=>d_,SerializationMap:()=>DE,getRegisteredName:()=>EOe,registerClass:()=>O3});var kOe=new Map,R3=new Map,d_=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},DE=class r{constructor(){this.classNameMap={}}static getMap(){return r.instance==null&&(r.instance=new r),r.instance}static register(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function O3(r,e,t){$(r.className!=null,()=>"Class being registered does not have the static className property defined."),$(typeof r.className=="string",()=>"className is required to be a string, but got type "+typeof r.className),$(r.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=r.className);let n=t,o=e+">"+n;return DE.register(r),kOe.set(o,r),R3.set(r,o),r}function EOe(r){return R3.has(r)?R3.get(r):r.className}var Qo=class extends d_{minimize(e,t=!1,n){let{value:o,grads:s}=this.computeGradients(e,n);if(n!=null){let i=n.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return Xe(s),t?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return w3(e,t)}dispose(){this.iterations_!=null&&Xe(this.iterations_)}saveIterations(){return M(this,null,function*(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Oe(this.iterations_,"int32")}})}getWeights(){return M(this,null,function*(){throw new Error("getWeights() is not implemented for this optimizer yet.")})}setWeights(e){return M(this,null,function*(){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)})}extractIterations(e){return M(this,null,function*(){return this.iterations_=(yield e[0].tensor.data())[0],e.slice(1)})}};Object.defineProperty(Qo,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var db=class extends Qo{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=F.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=F.registeredVariables[n],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accum_grad`,variable:ee(()=>nt(s).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${n}/accum_var`,variable:ee(()=>nt(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let c=this.accumulatedGrads[o].variable,l=this.accumulatedUpdates[o].variable;ee(()=>{let u=ae(W(c,this.rho),W(vt(a),1-this.rho)),p=W(Ce(Rr(ae(l,this.epsilon)),Rr(ae(c,this.epsilon))),a),d=ae(W(l,this.rho),W(vt(p),1-this.rho));c.assign(u),l.assign(d);let h=ae(W(p,-this.learningRate),s);s.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Xe(this.accumulatedGrads.map(e=>e.variable)),Xe(this.accumulatedUpdates.map(e=>e.variable)))}getWeights(){return M(this,null,function*(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[yield this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(e){return M(this,null,function*(){e=yield this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))})}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}};var hb=class extends Qo{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=F.registeredVariables[n];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accumulator`,variable:ee(()=>La(s.shape,this.initialAccumulatorValue).variable(!1))});let i=Array.isArray(e)?e[o].tensor:e[n];if(i==null)return;let a=this.accumulatedGrads[o].variable;ee(()=>{let c=ae(a,vt(i));a.assign(c);let l=ae(W(Ce(i,Rr(ae(c,F.backend.epsilon()))),-this.learningRate),s);s.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Xe(this.accumulatedGrads.map(e=>e.variable))}getWeights(){return M(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(e){return M(this,null,function*(){e=yield this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))})}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}};var fb=class extends Qo{static get className(){return"Adam"}constructor(e,t,n,o=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ee(()=>{this.accBeta1=Oe(t).variable(),this.accBeta2=Oe(n).variable()}),o==null&&(this.epsilon=F.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ee(()=>{let n=Te(1,this.accBeta1),o=Te(1,this.accBeta2);t.forEach((s,i)=>{let a=F.registeredVariables[s],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:ee(()=>nt(a).variable(c))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${s}/v`,variable:ee(()=>nt(a).variable(c))});let l=Array.isArray(e)?e[i].tensor:e[s];if(l==null)return;let u=this.accumulatedFirstMoment[i].variable,p=this.accumulatedSecondMoment[i].variable,d=ae(W(u,this.beta1),W(l,1-this.beta1)),h=ae(W(p,this.beta2),W(vt(l),1-this.beta2)),f=Ce(d,n),m=Ce(h,o);u.assign(d),p.assign(h);let g=ae(W(Ce(f,ae(Rr(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(W(this.accBeta1,this.beta1)),this.accBeta2.assign(W(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Xe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Xe(this.accumulatedSecondMoment.map(e=>e.variable))}getWeights(){return M(this,null,function*(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[yield this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(e){return M(this,null,function*(){e=yield this.extractIterations(e),ee(()=>{this.accBeta1.assign(Xo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Xo(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}};var mb=class extends Qo{static get className(){return"Adamax"}constructor(e,t,n,o=null,s=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=o,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ee(()=>{this.iteration=Oe(0).variable(),this.accBeta1=Oe(t).variable()}),o==null&&(this.epsilon=F.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ee(()=>{let n=Te(1,this.accBeta1),o=Ce(-this.learningRate,ae(W(this.iteration,this.decay),1));t.forEach((s,i)=>{let a=F.registeredVariables[s],c=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:nt(a).variable(c)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${s}/v`,variable:nt(a).variable(c)});let l=Array.isArray(e)?e[i].tensor:e[s];if(l==null)return;let u=this.accumulatedFirstMoment[i].variable,p=this.accumulatedWeightedInfNorm[i].variable,d=ae(W(u,this.beta1),W(l,1-this.beta1)),h=W(p,this.beta2),f=Qr(l),m=Qs(h,f);u.assign(d),p.assign(m);let g=ae(W(Ce(o,n),Ce(d,ae(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(ae(this.iteration,1)),this.accBeta1.assign(W(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Xe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Xe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}getWeights(){return M(this,null,function*(){throw new Error("getWeights() is not implemented for Adamax yet.")})}setWeights(e){return M(this,null,function*(){throw new Error("setWeights() is not implemented for Adamax yet.")})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}};var om=class extends Qo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=Array.isArray(e)?e[o].tensor:e[n];if(s==null)return;let i=F.registeredVariables[n];ee(()=>{let a=ae(W(this.c,s),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=rn(Oe(-e))}dispose(){this.c.dispose()}getWeights(){return M(this,null,function*(){return[yield this.saveIterations()]})}setWeights(e){return M(this,null,function*(){if(e=yield this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")})}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}};var gb=class extends om{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=Oe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=F.registeredVariables[n];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${n}/momentum`,variable:ee(()=>nt(s).variable(!1))});let i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[n];a!=null&&ee(()=>{let c,l=ae(W(this.m,i),a);this.useNesterov?c=ae(W(this.c,ae(a,W(l,this.m))),s):c=ae(W(this.c,l),s),i.assign(l),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Xe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}getWeights(){return M(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(e){return M(this,null,function*(){e=yield this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))})}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}};var yb=class extends Qo{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,o=null,s=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,o==null&&(this.epsilon=F.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=F.registeredVariables[n],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${n}/rms`,variable:ee(()=>nt(s).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${n}/momentum`,variable:ee(()=>nt(s).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${n}/mg`,variable:ee(()=>nt(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let c=this.accumulatedMeanSquares[o].variable,l=this.accumulatedMoments[o].variable;ee(()=>{let u=ae(W(c,this.decay),W(vt(a),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[o].variable,d=ae(W(p,this.decay),W(a,1-this.decay)),h=Ce(W(a,this.learningRate),Rr(Te(u,ae(vt(d),this.epsilon)))),f=ae(W(l,this.momentum),h);c.assign(u),p.assign(d),l.assign(f);let m=Te(s,f);s.assign(m)}else{let p=ae(W(c,this.decay),W(vt(a),1-this.decay)),d=ae(W(l,this.momentum),Ce(W(a,this.learningRate),Rr(ae(p,this.epsilon))));c.assign(p),l.assign(d);let h=Te(s,d);s.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Xe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Xe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Xe(this.accumulatedMoments.map(e=>e.variable))}getWeights(){return M(this,null,function*(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[yield this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))})}setWeights(e){return M(this,null,function*(){e=yield this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})))})}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}};var NOe=[db,hb,fb,mb,gb,yb,om];function hY(){for(let r of NOe)O3(r)}var _l={};Nr(_l,{CompositeArrayBuffer:()=>Ko,browserFiles:()=>mY,browserHTTPRequest:()=>bY,concatenateArrayBuffers:()=>r8,copyModel:()=>g8,decodeWeights:()=>gk,decodeWeightsStream:()=>yk,encodeWeights:()=>QK,fromMemory:()=>wY,fromMemorySync:()=>B3,getLoadHandlers:()=>i8,getModelArtifactsForJSON:()=>Pv,getModelArtifactsForJSONSync:()=>a3,getModelArtifactsInfoForJSON:()=>hp,getSaveHandlers:()=>s8,getWeightSpecs:()=>r_,http:()=>RE,isHTTPScheme:()=>AE,listModels:()=>f8,loadWeights:()=>yY,moveModel:()=>y8,registerLoadRouter:()=>o8,registerSaveRouter:()=>n8,removeModel:()=>m8,weightsLoaderFactory:()=>L3,withSaveHandler:()=>CY,withSaveHandlerSync:()=>_Y});var DOe="model",AOe=".json",ROe=".weights.bin";function fY(r){return new Promise(e=>setTimeout(e)).then(r)}var M3=(()=>{class r{constructor(t){if(!Z().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(r.URL_SCHEME)&&(t=t.slice(r.URL_SCHEME.length)),(t==null||t.length===0)&&(t=DOe),this.modelJsonFileName=t+AOe,this.weightDataFileName=t+ROe}save(t){return M(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=Ko.join(t.weightData),o=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let s=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=xk(t,s),a=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),c=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(c.download=this.modelJsonFileName,c.href=a,yield fY(()=>c.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=o,yield fY(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:hp(t)}}})}}return r.URL_SCHEME="downloads://",r})();var F3=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}load(){return M(this,null,function*(){return new Promise((e,t)=>{let n=new FileReader;n.onload=o=>{let s=JSON.parse(o.target.result),i=s.modelTopology;if(i==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:i});return}let c=Pv(s,l=>this.loadWeights(l));e(c)},n.onerror=o=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})})}loadWeights(e){let t=[],n=[];for(let i of e)t.push(...i.weights),n.push(...i.paths);let o=this.checkManifestAndWeightFiles(e),s=n.map(i=>this.loadWeightsFile(i,o[i]));return Promise.all(s).then(i=>[t,i])}loadWeightsFile(e,t){return new Promise((n,o)=>{let s=new FileReader;s.onload=i=>{let a=i.target.result;n(a)},s.onerror=i=>o(`Failed to weights data from file of path '${e}'.`),s.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){let t=[],n=this.weightsFiles.map(s=>i3(s.name)),o={};for(let s of e)s.paths.forEach(i=>{let a=i3(i);if(t.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(t.push(a),n.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[i]=this.weightsFiles[n.indexOf(a)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},OOe=r=>Z().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(M3.URL_SCHEME)?MOe(r.slice(M3.URL_SCHEME.length)):null;So.registerSaveRouter(OOe);function MOe(r="model"){return new M3(r)}function mY(r){return new F3(r)}function P3(r,e,t,n){i(r),t=t??0,n=n??1,a(t,n);let o=0,s=c=>(c.then(l=>{let u=t+ ++o/r.length*(n-t);return e(u),l}),c);function i(c){$(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function a(c,l){$(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),$(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),$(l>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${l}`)}return Promise.all(r.map(s))}function $3(r,e){return M(this,null,function*(){e==null&&(e={});let t=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc,n=r.map(p=>t(p,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?yield Promise.all(n):yield P3(n,e.onProgress,0,.5)).map(p=>p.arrayBuffer());return e.onProgress==null?yield Promise.all(a):yield P3(a,e.onProgress,.5,1)})}function gY(r,e){var t;let n=e.fetchFunc==null?Z().platform.fetch:e.fetchFunc,o=0,s;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:i=>M(this,null,function*(){for(var a;o<r.length;){s||(s=(yield n(r[o],e.requestInit,{isBinary:!0})).body.getReader());let{done:c,value:l}=yield s.read();if(c){o++,s=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,o/r.length);continue}i.enqueue(l);return}i.close()})})}function yY(r,e="",t,n){return M(this,null,function*(){return L3(i=>$3(i,{requestInit:n}))(r,e,t)})}function L3(r){return(e,t="",n)=>M(this,null,function*(){let o=e.map(()=>!1),s={},i=n!=null?n.map(()=>!1):[],a=[];if(e.forEach((h,f)=>{let m=0;h.weights.forEach(g=>{let y="quantization"in g?g.quantization.dtype:g.dtype,x=kd[y]*Vt(g.shape),b=()=>{o[f]=!0,s[f]==null&&(s[f]=[]),s[f].push({manifestEntry:g,groupOffset:m,sizeBytes:x})};n!=null?n.forEach((w,_)=>{w===g.name&&(b(),i[_]=!0)}):b(),a.push(g.name),m+=x})}),!i.every(h=>h)){let h=n.filter((f,m)=>!i[m]);throw new Error(`Could not find weights in manifest with names: ${h.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let c=o.reduce((h,f,m)=>(f&&h.push(m),h),[]),l=[];c.forEach(h=>{e[h].paths.forEach(f=>{let m=t+(t.endsWith("/")?"":"/")+f;l.push(m)})});let u=yield r(l),p={},d=0;return c.forEach(h=>{let f=e[h].paths.length,m=new Ko(u.slice(d,d+f));s[h].forEach(y=>{let x=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),b=gk(x,[y.manifestEntry]);for(let w in b)p[w]=b[w]}),d+=f}),p})}var FOe="application/octet-stream",POe="application/json",xY=(()=>{class r{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?($(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=Z().platform.fetch,$(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&$(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}save(t){return M(this,null,function*(){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],s=xk(t,o);if(n.body.append("model.json",new Blob([JSON.stringify(s)],{type:POe}),"model.json"),t.weightData!=null){let a=Ko.join(t.weightData);n.body.append("model.weights.bin",new Blob([a],{type:FOe}),"model.weights.bin")}let i=yield this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:hp(t),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)})}loadModelJSON(){return M(this,null,function*(){let t=yield this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=yield t.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}let o=n.modelTopology,s=n.weightsManifest;if(o==null&&s==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n})}load(){return M(this,null,function*(){if(this.loadOptions.streamWeights)return this.loadStream();let t=yield this.loadModelJSON();return Pv(t,n=>this.loadWeights(n))})}loadStream(){return M(this,null,function*(){let t=yield this.loadModelJSON(),n=yield this.getWeightUrls(t.weightsManifest),o=r_(t.weightsManifest),s=()=>gY(n,this.loadOptions);return Object.assign(Object.assign({},t),{weightSpecs:o,getWeightStream:s})})}getWeightUrls(t){return M(this,null,function*(){let n=Array.isArray(this.path)?this.path[1]:this.path,[o,s]=$Oe(n),i=this.weightPathPrefix||o,a=[],c=[];for(let l of t)for(let u of l.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(u)):a.push(i+u+s);return this.weightUrlConverter&&a.push(...yield Promise.all(c)),a})}loadWeights(t){return M(this,null,function*(){let n=yield this.getWeightUrls(t),o=r_(t),s=yield $3(n,this.loadOptions);return[o,s]})}}return r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function $Oe(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),o=t>e?r.substring(t):"";return[n+"/",o]}function AE(r){return r.match(xY.URL_SCHEME_REGEX)!=null}var vY=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>AE(n)):t=AE(r),t)return RE(r,e)}return null};So.registerSaveRouter(vY);So.registerLoadRouter(vY);function RE(r,e){return new xY(r,e)}function bY(r,e){return RE(r,e)}var h_=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},OE=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},V3=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}};function wY(r,e,t,n){let o=arguments;return new V3(B3(...o))}function B3(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new h_(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new h_({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new h_({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))}function CY(r){return new OE(r)}function _Y(r){return new OE(r)}var Md={};Nr(Md,{draw:()=>jOe,fromPixels:()=>HOe,fromPixelsAsync:()=>UOe,toPixels:()=>WOe});var cy,SY=!1;function IY(r,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,n=!1,o=!1,s=!1,i=!1,a=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)s=!0;else if(r.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${r.constructor.name}`);if(kv($g,F.backendName)!=null){let f={pixels:r},m={numChannels:e};return F.runKernel($g,f,m)}let[l,u]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],p;if(i)p=r.getContext("2d").getImageData(0,0,l,u).data;else if(n||t)p=r.data;else if(s||o||a){if(cy==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")cy=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else cy=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});cy.canvas.width=l,cy.canvas.height=u,cy.drawImage(r,0,0,l,u),p=cy.getImageData(0,0,l,u).data}let d;if(e===4)d=new Int32Array(p);else{let f=l*u;d=new Int32Array(f*e);for(let m=0;m<f;m++)for(let g=0;g<e;++g)d[m*e+g]=p[m*4+g]}return mE(d,[u,l,e],"int32")}function LOe(r){return r!=null&&r.data instanceof Uint8Array}function VOe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function BOe(r){return r!=null&&r.width!==0&&r.height!==0}function zOe(r){return VOe()&&!(r instanceof ImageBitmap)&&BOe(r)&&!LOe(r)}function UOe(r,e=3){return M(this,null,function*(){let t=null;if(Z().getBool("WRAP_TO_IMAGEBITMAP")&&zOe(r)){let n;try{n=yield createImageBitmap(r,{premultiplyAlpha:"none"})}catch{n=null}n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r}else t=r;return IY(t,e)})}function TY(r){if(r.rank!==2&&r.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${r.rank}.`);let e=r.rank===2?1:r.shape[2];if(e>4||e===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${e}`);if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${r.dtype}. Please use float32 or int32 tensors.`)}function GOe(r){let e=r?.alpha||1;if(e>1||e<0)throw new Error(`Alpha value ${e} is suppoed to be in range [0 - 1].`)}function WOe(r,e){return M(this,null,function*(){let t=D(r,"img","toPixels");if(!(r instanceof Ct)){let l=t;t=he(l,"int32"),l.dispose()}TY(t);let[n,o]=t.shape.slice(0,2),s=t.rank===2?1:t.shape[2],i=yield t.data(),a=t.dtype==="float32"?255:1,c=new Uint8ClampedArray(o*n*4);for(let l=0;l<n*o;++l){let u=[0,0,0,255];for(let d=0;d<s;d++){let h=i[l*s+d];if(t.dtype==="float32"){if(h<0||h>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${h}.`)}else if(t.dtype==="int32"&&(h<0||h>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${h}.`);s===1?(u[0]=h*a,u[1]=h*a,u[2]=h*a):u[d]=h*a}let p=l*4;c[p+0]=Math.round(u[0]),c[p+1]=Math.round(u[1]),c[p+2]=Math.round(u[2]),c[p+3]=Math.round(u[3])}if(e!=null){SY||kv(Fg,F.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),SY=!0),e.width=o,e.height=n;let l=e.getContext("2d"),u=new ImageData(c,o,n);l.putImageData(u,0,0)}return t!==r&&t.dispose(),c})}function jOe(r,e,t){let n=D(r,"img","draw");if(!(r instanceof Ct)){let i=n;n=he(i,"int32"),i.dispose()}TY(n),GOe(t?.imageOptions);let o={image:n},s={canvas:e,options:t};F.runKernel(Fg,o,s)}var HOe=O({fromPixels_:IY});function qOe(r,e){let t=r.shape.length,n=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(n<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${n}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[n-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[n-1]} vs. ${t}`);if(Vt(r.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${r.shape}.`);let o=e.shape,s=o[o.length-1],i=1;for(let p=0;p<o.length-1;++p)i*=o[p];let a=r.shape,c=o.slice();c.pop();let l=1;for(let p=s;p<t;++p)l*=a[p],c.push(a[p]);let u=[...gu(r.shape).map(p=>p/l),1].slice(0,s);return[c,i,l,u]}var Tn={};Nr(Tn,{assertParamsValid:()=>XOe,computeFlatOffset:()=>eMe,computeOutShape:()=>ZOe,getNormalizedAxes:()=>QOe,isSliceContinous:()=>JOe,maskToAxes:()=>YOe,parseSliceParams:()=>U3,sliceInfo:()=>tMe,startForAxis:()=>MY,startIndicesWithElidedDims:()=>AY,stopForAxis:()=>FY,stopIndicesWithElidedDims:()=>RY,stridesForAxis:()=>OY,stridesWithElidedDims:()=>EY});var z3=-2,KOe=-1;function XOe(r,e,t){let n=r.shape.length;$(n===e.length,()=>`Error in slice${n}D: Length of begin ${e} must match the rank of the array (${n}).`),$(n===t.length,()=>`Error in slice${n}D: Length of size ${t} must match the rank of the array (${n}).`);for(let o=0;o<n;++o)$(e[o]+t[o]<=r.shape[o],()=>`Error in slice${n}D: begin[${o}] + size[${o}] (${e[o]+t[o]}) would overflow input.shape[${o}] (${r.shape[o]})`)}function YOe(r){let e=[],t=0;for(;r>0;)r&1&&e.push(t),r/=2,t++;return e}function ZOe(r,e,t){let n=[];for(let o=0;o<r.length;o++)n[o]=Math.ceil((e[o]-r[o])/t[o]);return n}function EY(r,e,t,n){let o=[...r];for(let s=o.length;s<n.length;s++)o.push(1);for(let s=0;s<t;s++)s===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function NY(r,e,t){return t<=r?t:t-(e-1)}function DY(r,e){let t=[];for(let n=0;n<r;n++)t.push(e+n);return t}function QOe(r,e,t,n,o,s,i,a,c){let l=r.length,u=new Array(l),p=new Array(l),d=new Array(l);if(e.length&&t>0){let h=e[0],f=t+1;u=AY(i,h,f,n,r),p=RY(a,h,f,o,r),d=EY(s,h,f,r)}else for(let h=0;h<l;h++)u[h]=MY(i,n,s,r,h,c),p[h]=FY(a,o,s,r,h,c),d[h]=OY(s,h,c);return{begin:u,end:p,strides:d}}function AY(r,e,t,n,o){let s=[...o],i=DY(t,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{let c=NY(e,t,a),l=n[c];r&1<<c&&(l=0),s[a]=l}return s}function RY(r,e,t,n,o){let s=[...o],i=DY(t,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{let c=NY(e,t,a),l=n[c];r&1<<c&&(l=Number.MAX_SAFE_INTEGER),s[a]=l}for(let a=0;a<s.length;a++){let c=o[a];s[a]<0&&(s[a]+=c),s[a]=dv(0,s[a],o[a])}return s}function OY(r,e,t){let n=r[e];return(t&1<<e||n==null)&&(n=1),n}function MY(r,e,t,n,o,s){let i=e[o],a=t[o]||1;(r&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let c=n[o];return i<0&&(i+=c),i=dv(0,i,c-1),i}function FY(r,e,t,n,o,s){let i=e[o],a=t[o]||1;(r&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let c=n[o];return i<0&&(i+=c),a>0?i=dv(0,i,c):i=dv(-1,i,c-1),i}function JOe(r,e,t){let n=t.length;for(let o=0;o<t.length;o++)if(t[o]>1){n=o;break}for(let o=n+1;o<t.length;o++)if(e[o]>0||t[o]!==r[o])return!1;return!0}function eMe(r,e){let t=r.length>0?r[r.length-1]:1;for(let n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function U3(r,e,t){let n,o=r.shape.length;typeof e=="number"?n=[e,...new Array(o-1).fill(0)]:e.length<o?n=e.concat(new Array(o-e.length).fill(0)):n=e.slice(),n.forEach(i=>{$(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return t==null?s=new Array(o).fill(-1):typeof t=="number"?s=[t,...new Array(o-1).fill(-1)]:t.length<o?s=t.concat(new Array(o-t.length).fill(-1)):s=t,s=s.map((i,a)=>i>=0?i:($(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),r.shape[a]-n[a])),[n,s]}function tMe(r,e,t,n,o,s,i,a,c){let l;if(n==null?(l=new Array(e.length),l.fill(1)):l=n,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1,p={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:c};for(let b=0;b<p.dims;b++)u&&1<<b&a&&p.numAddAxisAfterEllipsis++,1<<b&i&&(u=!0);u||(p.ellipsisMask|=1<<p.dims,p.dims++);let d={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};rMe(p,d);let h=!0,f=!0,m=!0,g=[],y=[];for(let b=0;b<r.length;++b){if(d.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let w=!!(d.shrinkAxisMask&1<<b),_=r[b];if(_===-1){g.push(w?1:-1);continue}let I=[d.beginMask&1<<b,d.endMask&1<<b],S=[d.strides[b]>0?0:-1,d.strides[b]>0?_:_-1];if(w&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[b]===1;let k=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(w){let z=d.begin[b]<0?_+d.begin[b]:d.begin[b];if(d.begin[b]=z,d.end[b]=d.begin[b]+1,z<0||z>=_)throw Error(`slice index ${d.begin[b]} of dimension ${b} out of bounds.`)}else d.begin[b]=kY(d.begin[b],0,d.strides[b],_,I,S),d.end[b]=kY(d.end[b],1,d.strides[b],_,I,S);let B=d.strides[b]===1&&d.begin[b]===0&&d.end[b]===_;h=h&&B,f=f&&(b===0&&d.strides[b]===1||B)}else h=h&&d.strides[b]===1&&k,f=f&&(b===0&&d.strides[b]===1||k);let R,L=!1;if(d.beginValid&&d.endValid?(R=d.end[b]-d.begin[b],L=!0):w?(R=1,L=!0):k&&_>=0&&(d.strides[b]<0?R=-_:R=_,L=!0),L){let B;R===0||R<0!=d.strides[b]<0?B=0:B=Math.trunc(R/d.strides[b])+(R%d.strides[b]!==0?1:0),g.push(B)}else g.push(-1)}for(let b=0;b<d.finalShapeGatherIndices.length;++b){let w=d.finalShapeGatherIndices[b];w>=0?y.push(g[w]):w===z3&&y.push(1)}return{finalShapeSparse:y.filter((b,w)=>d.finalShapeGatherIndices[w]!==z3),finalShape:y,isIdentity:h,sliceDim0:f,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function rMe(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask){let o=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);for(;t<o;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n}else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(z3),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(KOe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function kY(r,e,t,n,o,s){if(o[e])return t>0?s[e]:s[e+1&1];{let i=r<0?n+r:r;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var ME=class{static sgd(e){return new om(e)}static momentum(e,t,n=!1){return new gb(e,t,n)}static rmsprop(e,t=.9,n=0,o=null,s=!1){return new yb(e,t,n,o,s)}static adam(e=.001,t=.9,n=.999,o=null){return new fb(e,t,n,o)}static adadelta(e=.001,t=.95,n=null){return new db(e,t,n)}static adamax(e=.002,t=.9,n=.999,o=null,s=0){return new mb(e,t,n,o,s)}static adagrad(e,t=.1){return new hb(e,t)}};var ly=ME;var nMe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r();function f_(){return new Promise(r=>nMe(()=>r()))}var E={};Nr(E,{ERF_A1:()=>xMe,ERF_A2:()=>vMe,ERF_A3:()=>bMe,ERF_A4:()=>wMe,ERF_A5:()=>CMe,ERF_P:()=>yMe,PARALLELIZE_THRESHOLD:()=>FE,RowPartitionType:()=>Fd,SELU_SCALE:()=>W3,SELU_SCALEALPHA:()=>G3,applyActivation:()=>iy,assertAndGetBroadcastShape:()=>yt,assertAxesAreInnerMostDims:()=>KDe,assertParamsConsistent:()=>oMe,assignToTypedArray:()=>EMe,axesAreInnerMostDims:()=>y3,calculateShapes:()=>e2e,checkEinsumDimSizes:()=>MMe,checkPadOnDimRoundingMode:()=>Wr,combineLocations:()=>A8,combineRaggedTensorToTensorShapes:()=>iMe,complexWithEvenIndex:()=>IMe,complexWithOddIndex:()=>TMe,computeConv2DInfo:()=>Xg,computeConv3DInfo:()=>C8,computeDefaultPad:()=>g3,computeDilation2DInfo:()=>qNe,computeOptimalWindowSize:()=>uMe,computeOutAndReduceShapes:()=>x3,computeOutShape:()=>sMe,computePool2DInfo:()=>m3,computePool3DInfo:()=>KNe,convertConv2DDataFormat:()=>_8,decodeEinsumEquation:()=>RMe,eitherStridesOrDilationsAreOne:()=>zo,expandShapeToKeepDim:()=>Va,exponent:()=>DMe,exponents:()=>NMe,fromStringArrayToUint8:()=>tFe,fromUint8ToStringArray:()=>eFe,getAxesPermutation:()=>v3,getBroadcastDims:()=>N8,getComplexWithIndex:()=>kMe,getEinsumComputePath:()=>FMe,getEinsumPermutation:()=>OMe,getFusedBiasGradient:()=>sy,getFusedDyActivation:()=>oy,getImageCenter:()=>pMe,getInnerMostAxes:()=>XDe,getPermuted:()=>hMe,getRaggedRank:()=>cMe,getReductionAxes:()=>Lr,getReshaped:()=>dMe,getReshapedPermuted:()=>fMe,getRowPartitionTypesHelper:()=>aMe,getSliceBeginCoords:()=>mMe,getSliceSize:()=>gMe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>VMe,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>BMe,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>zMe,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>WMe,getSparseReshapeInputOutputMismatchErrorMessage:()=>HMe,getSparseReshapeInputOutputMultipleErrorMessage:()=>jMe,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>UMe,getSparseReshapeNegativeOutputDimErrorMessage:()=>GMe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>YMe,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>qMe,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>KMe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>XMe,getUndoAxesPermutation:()=>i_,isIdentityPermutation:()=>PMe,log:()=>LEe,mergeRealAndImagArrays:()=>_Me,prepareAndValidate:()=>qOe,prepareSplitSize:()=>LMe,segment_util:()=>H3,shouldFuse:()=>ay,slice_util:()=>Tn,splitRealAndImagArrays:()=>SMe,stridesOrDilationsArePositive:()=>fp,tupleValuesAreOne:()=>na,upcastType:()=>$r,validateDefaultValueShape:()=>lMe,validateInput:()=>u_,validateUpdateShape:()=>wX,warn:()=>up});function oMe(r,e){let t=r[0].length;r.forEach((o,s)=>{$(o.length===t,()=>`Error in concat${t}D: rank of tensors[${s}] must be the same as the rank of the rest (${t})`)}),$(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);let n=r[0];r.forEach((o,s)=>{for(let i=0;i<t;i++)$(i===e||o[i]===n[i],()=>`Error in concat${t}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${n}) along the non-concatenated axis ${s}.`)})}function sMe(r,e){let t=r[0].slice();for(let n=1;n<r.length;n++)t[e]+=r[n][e];return t}var Fd=function(r){return r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS",r}(Fd||{});function iMe(r,e,t){let n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${r+t.length}, but shape.rank = ${n.length}`);for(let o=1;o<t.length;++o){let s=t[o],i=n[n.length-t.length+o],a=n[i];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+r}] = ${s} but shape[${o+r}] = ${a}`)}else n[i]=s}return n}function aMe(r){let e={FIRST_DIM_SIZE:Fd.FIRST_DIM_SIZE,VALUE_ROWIDS:Fd.VALUE_ROWIDS,ROW_LENGTHS:Fd.ROW_LENGTHS,ROW_SPLITS:Fd.ROW_SPLITS,ROW_LIMITS:Fd.ROW_LIMITS,ROW_STARTS:Fd.ROW_STARTS},t=[];for(let n of r)if(n in e)t.push(e[n]);else break;return t}function cMe(r){return r.length===0?0:r[0]===Fd.FIRST_DIM_SIZE?r.length-1:r.length}function lMe(r,e){if(r==null||e==null)return;let t=r.length,n=e.length;if(t>=n)throw new Error(`defaultValue.shape=${r} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${n})`);for(let o=0;o<Math.min(t,n-1);++o){let s=r[o],i=e[o+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${r}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-r.length}] = ${s} but ragged tensor input.flatValues.shape[${o-r.length}] = ${i}`)}}var FE=30;function uMe(r){return r<=FE?r:gv(r,Math.floor(Math.sqrt(r)))}function pMe(r,e,t){let n=t*(typeof r=="number"?r:r[0]),o=e*(typeof r=="number"?r:r[1]);return[n,o]}function dMe(r,e,t,n=!0){let o=[];if(n)o=o.concat(e.slice(0)),o.push(r[0]/t),o=o.concat(r.slice(1));else{o=o.concat(r[0]);let s=e.length;for(let i=0;i<s;++i)o=o.concat([r[i+1]/e[i],e[i]]);o=o.concat(r.slice(s+1))}return o}function hMe(r,e,t=!0){let n=[];if(t){n.push(e);for(let o=e+1;o<r;++o)o<=2*e?(n.push(o),n.push(o-(e+1))):n.push(o)}else{let o=[],s=[];for(let i=1;i<r;++i)i>=e*2+1||i%2===1?s.push(i):o.push(i);n.push(...o),n.push(0),n.push(...s)}return n}function fMe(r,e,t,n=!0){let o=[];n?o.push(r[0]/t):o.push(r[0]*t);for(let s=1;s<r.length;++s)s<=e.length?n?o.push(e[s-1]*r[s]):o.push(r[s]/e[s-1]):o.push(r[s]);return o}function mMe(r,e){let t=[0];for(let n=0;n<e;++n)t.push(r[n][0]);return t}function gMe(r,e,t){let n=r.slice(0,1);for(let o=0;o<t;++o)n.push(r[o+1]-e[o][0]-e[o][1]);return n}var G3=1.7580993408473768,W3=1.0507009873554805;var yMe=.3275911,xMe=.254829592,vMe=-.284496736,bMe=1.421413741,wMe=-1.453152027,CMe=1.061405429;function _Me(r,e){if(r.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${r.length}, imag: ${e.length}.`);let t=new Float32Array(r.length*2);for(let n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function SMe(r){let e=new Float32Array(r.length/2),t=new Float32Array(r.length/2);for(let n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function IMe(r){let e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e);for(let o=0;o<r.length;o+=4)t[Math.floor(o/4)]=r[o],n[Math.floor(o/4)]=r[o+1];return{real:t,imag:n}}function TMe(r){let e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e);for(let o=2;o<r.length;o+=4)t[Math.floor(o/4)]=r[o],n[Math.floor(o/4)]=r[o+1];return{real:t,imag:n}}function kMe(r,e){let t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function EMe(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function NMe(r,e){let t=new Float32Array(r/2),n=new Float32Array(r/2);for(let o=0;o<Math.ceil(r/2);o++){let s=(e?2:-2)*Math.PI*(o/r);t[o]=Math.cos(s),n[o]=Math.sin(s)}return{real:t,imag:n}}function DMe(r,e,t){let n=(t?2:-2)*Math.PI*(r/e),o=Math.cos(n),s=Math.sin(n);return{real:o,imag:s}}var j3="->",AMe=/->/g,PY=",",$Y="...";function RMe(r,e){r=r.replace(/\s/g,"");let t=(r.length-r.replace(AMe,"").length)/j3.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${j3}").`);let[n,o]=r.split(j3);$(n.indexOf($Y)===-1,()=>`The ellipsis notation ("${$Y}") is not supported yet.`);let s=n.split(PY),i=s.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let d=0;d<o.length;++d){let h=o[d];if(!s.some(f=>f.indexOf(h)!==-1))throw new Error(`Output subscripts contain the label ${h} not present in the input subscripts.`);a.indexOf(h)===-1&&a.push(h)}for(let d=0;d<n.length;++d){let h=n[d];a.indexOf(h)===-1&&h!==PY&&a.push(h)}let c=new Array(s.length);for(let d=0;d<i;++d){if(new Set(s[d].split("")).size!==s[d].length)throw new Error(`Found duplicate axes in input component ${s[d]}. Support for duplicate axes in input is not implemented yet.`);c[d]=[];for(let h=0;h<s[d].length;++h)c[d].push(a.indexOf(s[d][h]))}let l=a.length,u=o.length,p=[];for(let d=u;d<l;++d)p.push(d);return{allDims:a,summedDims:p,idDims:c}}function OMe(r,e){let t=new Array(r);t.fill(-1);for(let o=0;o<e.length;++o)t[e[o]]=o;let n=[];for(let o=0;o<r;++o)t[o]===-1&&n.push(o);return t=t.filter(o=>o!==-1),{permutationIndices:t,expandDims:n}}function MMe(r,e,t){let n=new Array(r);for(let o=0;o<t.length;++o){let s=t[o].shape;for(let i=0;i<e[o].length;++i)n[e[o][i]]===void 0?n[e[o][i]]=s[i]:$(n[e[o][i]]===s[i],()=>`Expected dimension ${n[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function FMe(r,e){let t=r,n=[],o=0;r.length===0&&t.push(-1),o=r.length+1;for(let i=0;i<o;++i)n.push([]);let s=[];for(let i=0;i<t.length;++i){let a=t[i],c=$Me(e,a);for(let l of c)s.indexOf(l)===-1&&(n[i].push(l),s.push(l))}return{path:t,steps:n}}function PMe(r){return r.every((e,t)=>e===t)}function $Me(r,e){let t=[];for(let n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function LMe(r,e,t=0){let n=[];if(typeof e=="number")$(r.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),n=new Array(e).fill(r.shape[t]/e);else{let o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);$(o<=1,()=>"There should be only one negative value in split array.");let s=e.indexOf(-1);if(s!==-1){let i=e.reduce((a,c)=>c>0?a+c:a);e[s]=r.shape[t]-i}$(r.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),n=e}return n}function VMe(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${r}`}function BMe(r,e){return`indices(${r}, 0) is invalid: ${e} < 0`}function zMe(r,e,t){return`indices(${r}, 0) is invalid: ${e} >= ${t}`}function UMe(r,e){return`only one output dimension may be -1, not both ${r} and ${e}`}function GMe(r,e){return`size ${r} must be non-negative, not ${e}`}function WMe(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function jMe(r,e){let t=Vt(r),n=Vt(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${n}. inputShape=${r} outputShape= ${e}`}function HMe(r,e){let t=Vt(r),n=Vt(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${n}. inputShape=${r} outputShape=${e}`}function qMe(){return"segment ids must be >= 0"}function KMe(){return"segment ids are not increasing"}function XMe(r,e){return`Segment id ${r} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function YMe(r,e,t){return`Bad: indices[${r}] == ${e} out of range [0, ${t})`}var H3={};Nr(H3,{collectGatherOpShapeInfo:()=>JMe,computeOutShape:()=>QMe,segOpComputeOptimalWindowSize:()=>ZMe});function ZMe(r,e){let t=!1,n;for(r<=FE?(n=r,t=!0):n=gv(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=gv(r,n+1);return n}function QMe(r,e,t){let n=[],o=r.length;for(let s=0;s<o;s++)s!==e?n.push(r[s]):n.push(t);return n}function JMe(r,e,t,n){let o=e.shape.length,s=r.shape.length;if(n!==0&&(n<-o||n>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${n}`);if(n<0&&(n+=o),n>s)throw new Error(`batchDims (${n}) must be less than rank(x) (
    ${s}).`);if(t<n)throw new Error(`batchDims (${n}) must be less than or equal to axis (${t}).`);for(let p=0;p<n;++p)if(r.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${r.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);let i=r.shape[t],a=[],c=1,l=1,u=1;for(let p=0;p<n;++p)a.push(r.shape[p]),c*=r.shape[p];for(let p=n;p<t;p++)a.push(r.shape[p]),l*=r.shape[p];for(let p=n;p<o;p++)a.push(e.shape[p]);for(let p=t+1;p<s;p++)a.push(r.shape[p]),u*=r.shape[p];return{batchSize:c,sliceSize:u,outerSize:l,dimSize:i,outputShape:a}}function eFe(r){try{return r.map(e=>Ov(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function tFe(r){return r.map(e=>Rv(e))}var to={};Nr(to,{nonMaxSuppressionV3Impl:()=>IE,nonMaxSuppressionV4Impl:()=>TE,nonMaxSuppressionV5Impl:()=>kE,whereImpl:()=>vE});hY();var rFe=Z();rFe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,r=>{r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Ri=function(r){return r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF",r}(Ri||{}),LY;(function(r){let e;(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e=r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(LY||(LY={}));var oFe={};function PE(r){return oFe[r]}function N(r,e,t,n,o){let s=e.inputParams[r];if(s&&s.inputIndexStart!==void 0){let a=s.inputIndexStart,c=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?a+1:s.inputIndexEnd,l=a<0?e.inputNames.length+a:a;if(s.type==="tensor")return Wn(e.inputNames[l],t,n,o);if(s.type==="tensors"){let d=e.inputs.slice(a,c);return e.inputNames.slice(a,c).filter((f,m)=>{var g;return((g=d[m])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(f=>Wn(f,t,n,o))}let u=Wn(e.inputNames[l],t,n,o),p=u.dataSync();return s.type==="number"?p[0]:C.toNestedArray(u.shape,p)}let i=e.attrParams[r];return i&&i.value}function Wn(r,e,t,n){let[o,s]=Ns(r,t);if(n!=null){let a=n.getHashTableHandleByName(o);if(a!=null)return a}let i=t.currentContextIds.find(a=>!!e[$E(o,a)]);return i!==void 0?e[$E(o,i)][s]:void 0}function q3(r,e,t){return e[$E(r,t.currentContextId)]}function Sl(r,e){let[t,n,o]=Ns(r,e);return[$E(t,e&&e.currentContextId),n,o]}function $E(r,e){return e?`${r}-${e}`:r}function Ns(r,e){if(r==="")return["",0,void 0];let t=e!=null&&e.parseNodeNameCache!=null;if(t){let s=e.parseNodeNameCache.get(r);if(s!=null)return s}let n=r.split(":"),o;if(n.length===1)o=[r,0,void 0];else{let s=n[0],i=n.length===3?n[1]:void 0,a=Number(n[n.length-1]);o=[s,a,i]}return t&&e.parseNodeNameCache.set(r,o),o}function m_(r,e,t){let n=N("pad",r,e,t);if(n==="explicit"){n=N("explicitPaddings",r,e,t);let o=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)o[s][0]=n[s*2],o[s][1]=n[s*2+1];return o}return n}function Il(r){return r.kept?r:Ts(r)}var K3={};Nr(K3,{json:()=>sFe});var sFe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var X3={};Nr(X3,{json:()=>iFe});var iFe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var Y3={};Nr(Y3,{json:()=>aFe});var aFe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}];var Z3={};Nr(Z3,{json:()=>cFe});var cFe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}];var Q3={};Nr(Q3,{json:()=>lFe});var lFe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}];var J3={};Nr(J3,{json:()=>uFe});var uFe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}];var eV={};Nr(eV,{json:()=>pFe});var pFe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}];var tV={};Nr(tV,{json:()=>dFe});var dFe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}];var rV={};Nr(rV,{json:()=>hFe});var hFe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var nV={};Nr(nV,{json:()=>fFe});var fFe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}];var oV={};Nr(oV,{json:()=>mFe});var mFe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}];var sV={};Nr(sV,{json:()=>gFe});var gFe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}];var iV={};Nr(iV,{json:()=>yFe});var yFe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}];var aV={};Nr(aV,{json:()=>xFe});var xFe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}];var cV={};Nr(cV,{json:()=>vFe});var vFe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}];var lV={};Nr(lV,{json:()=>bFe});var bFe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}];var uV={};Nr(uV,{json:()=>wFe});var wFe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}];var pV={};Nr(pV,{json:()=>CFe});var CFe=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}];var dV={};Nr(dV,{json:()=>_Fe});var _Fe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}];var g_=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let e=[K3,X3,Y3,Z3,Q3,J3,eV,tV,rV,nV,oV,sV,iV,aV,cV,lV,uV,pV,dV],t=[].concat(...e.map(n=>n.json));this.opMappers=t.reduce((n,o)=>(n[o.tfOpName]=o,n),{})}transformGraph(e,t={}){let n=e.node,o=[],s=[],i=[],a=n.reduce((m,g)=>(m[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?o.push(m[g.name]):g.op==="Const"?s.push(m[g.name]):(g.input==null||g.input.length===0)&&i.push(m[g.name]),m),{}),c=[],l=[],u={},p={};t!=null&&(u=this.mapSignatureEntries(t.inputs),p=this.mapSignatureEntries(t.outputs));let d=Object.keys(a);d.forEach(m=>{let g=a[m];g.inputNames.forEach((y,x)=>{let[b,,w]=Sl(y),_=a[b];if(_.outputs!=null){let I=_.outputs.indexOf(w);if(I!==-1){let S=`${b}:${I}`;g.inputNames[x]=S}}g.inputs.push(_),_.children.push(g)})}),Object.keys(p).length===0?d.forEach(m=>{let g=a[m];g.children.length===0&&l.push(g)}):Object.keys(p).forEach(m=>{let[g]=Sl(m),y=a[g];y!=null&&(y.signatureKey=p[m],l.push(y))}),Object.keys(u).length>0?Object.keys(u).forEach(m=>{let[g]=Sl(m),y=a[g];y&&(y.signatureKey=u[m],c.push(y))}):c=o;let h={};e.library!=null&&e.library.function!=null&&(h=e.library.function.reduce((m,g)=>(m[g.signature.name]=this.mapFunction(g),m),{}));let f={nodes:a,inputs:c,outputs:l,weights:s,placeholders:o,signature:t,functions:h};return i.length>0&&(f.initNodes=i),f}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){let t=PE(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});let n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(o=>o.startsWith("^")?o.slice(1):o),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce((o,s)=>(o[s.name]={type:s.type,inputIndexStart:s.start,inputIndexEnd:s.end},o),{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce((o,s)=>{let i=s.type,a;switch(s.type){case"string":a=LE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=LE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"string[]":a=jE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=jE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"number":a=BE(e.attr,s.tfName,s.defaultValue||0),a===void 0&&s.tfDeprecatedName&&(a=BE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"number[]":a=WE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=WE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool":a=VE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=VE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"bool[]":a=qE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=qE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape":a=GE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=GE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"shape[]":a=HE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=HE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype":a=zE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=zE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"dtype[]":a=UE(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=UE(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"func":a=VY(e.attr,s.tfName,s.defaultValue),a===void 0&&s.tfDeprecatedName&&(a=VY(e.attr,s.tfDeprecatedName,s.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${s.type} for op: ${e.op}`)}return o[s.name]={value:a,type:i},o},{})),n}mapFunction(e){let t=e.nodeDef,n=[],o=[],s={};t!=null&&(s=t.reduce((p,d)=>(p[d.name]=this.mapNode(d),d.op==="Const"&&o.push(p[d.name]),p),{}));let i=[],a=[];e.signature.inputArg.forEach(p=>{let[d]=Sl(p.name),h={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:hV(p.type),type:"dtype"}},children:[]};h.signatureKey=p.name,i.push(h),s[d]=h}),Object.keys(s).forEach(p=>{let d=s[p];d.inputNames.forEach((h,f)=>{let[m,,g]=Sl(h),y=s[m];if(y.outputs!=null){let x=y.outputs.indexOf(g);if(x!==-1){let b=`${m}:${x}`;d.inputNames[f]=b}}d.inputs.push(y),y.children.push(d)})});let l=e.ret;e.signature.outputArg.forEach(p=>{let[d,h]=Sl(l[p.name]),f=s[d];f!=null&&(f.defaultOutput=h,a.push(f))});let u=this.mapArgsToSignature(e);return{nodes:s,inputs:i,outputs:a,weights:o,placeholders:n,signature:u}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n),t),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}}};function SFe(r){let e=Z().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function BY(r,e){let t=Array.isArray(r)?String.fromCharCode.apply(null,r):SFe(r);return e?t:t.toLowerCase()}function LE(r,e,t,n=!1){let o=r[e];return o!=null?BY(o.s,n):t}function VE(r,e,t){let n=r[e];return n?n.b:t}function BE(r,e,t){let n=r[e]||{},o=n.i!=null?n.i:n.f!=null?n.f:t;return typeof o=="number"?o:parseInt(o,10)}function hV(r){switch(typeof r=="string"&&(r=Ri[r]),r){case Ri.DT_FLOAT:case Ri.DT_HALF:return"float32";case Ri.DT_INT32:case Ri.DT_INT64:case Ri.DT_INT8:case Ri.DT_UINT8:return"int32";case Ri.DT_BOOL:return"bool";case Ri.DT_DOUBLE:return"float32";case Ri.DT_STRING:return"string";case Ri.DT_COMPLEX64:case Ri.DT_COMPLEX128:return"complex64";default:return null}}function VY(r,e,t){let n=r[e];return n&&n.func?n.func.name:t}function zE(r,e,t){let n=r[e];return n&&n.type?hV(n.type):t}function UE(r,e,t){let n=r[e];return n&&n.list&&n.list.type?n.list.type.map(o=>hV(o)):t}function zY(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function GE(r,e,t){let n=r[e];return n&&n.shape?zY(n.shape):t}function WE(r,e,t){let n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(o=>typeof o=="number"?o:parseInt(o,10)):t}function jE(r,e,t,n=!1){let o=r[e];return o&&o.list&&o.list.s?o.list.s.map(s=>BY(s,n)):t}function HE(r,e,t){let n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(o=>zY(o)):t}function qE(r,e,t){let n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var KE=class{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(o=>this.getInput(o)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((o,s)=>(o[s]=this.getAttr(s),o),{}))}getInput(e){return Wn(e,this.tensorMap,this.context)}getAttr(e,t){let n=this.node.rawAttrs[e];if(n.tensor!=null)return Wn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return BE(this.node.rawAttrs,e,t);if(n.s!=null)return LE(this.node.rawAttrs,e,t);if(n.b!=null)return VE(this.node.rawAttrs,e,t);if(n.shape!=null)return GE(this.node.rawAttrs,e,t);if(n.type!=null)return zE(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return WE(this.node.rawAttrs,e,t);if(n.list.s!=null)return jE(this.node.rawAttrs,e,t);if(n.list.shape!=null)return HE(this.node.rawAttrs,e,t);if(n.list.b!=null)return qE(this.node.rawAttrs,e,t);if(n.list.type!=null)return UE(this.node.rawAttrs,e,t)}return t}};var sr={};Nr(sr,{OP_SCOPE_SUFFIX:()=>o3,abs:()=>Qr,acos:()=>_k,acosh:()=>Sk,add:()=>ae,addN:()=>w8,all:()=>zv,any:()=>Kg,argMax:()=>$a,argMin:()=>Ik,asin:()=>Tk,asinh:()=>kk,atan:()=>Ek,atan2:()=>Nk,atanh:()=>Dk,avgPool:()=>Uf,avgPool3d:()=>Ak,basicLSTMCell:()=>S8,batchNorm:()=>mp,batchNorm2d:()=>Rk,batchNorm3d:()=>Ok,batchNorm4d:()=>Mk,batchToSpaceND:()=>Gf,bincount:()=>Fk,bitwiseAnd:()=>T8,booleanMaskAsync:()=>l2e,broadcastArgs:()=>k8,broadcastTo:()=>gp,buffer:()=>ze,cast:()=>he,ceil:()=>Pk,clipByValue:()=>Zn,clone:()=>Ts,complex:()=>Xs,concat:()=>Xt,concat1d:()=>$k,concat2d:()=>Lk,concat3d:()=>Vk,concat4d:()=>Bk,conv1d:()=>Gv,conv2d:()=>Ys,conv2dTranspose:()=>jv,conv3d:()=>zk,conv3dTranspose:()=>Gk,cos:()=>Wf,cosh:()=>Hv,cosineWindow:()=>p_,cumprod:()=>Yg,cumsum:()=>qv,denseBincount:()=>s_,depthToSpace:()=>Wk,depthwiseConv2d:()=>yp,diag:()=>E8,dilation2d:()=>jk,div:()=>Ce,divNoNan:()=>Hk,dot:()=>qk,dropout:()=>E3,einsum:()=>jf,elu:()=>xp,enclosingPowerOfTwo:()=>N3,ensureShape:()=>D8,equal:()=>ls,erf:()=>Kv,euclideanNorm:()=>Kk,exp:()=>nn,expandDims:()=>Hr,expm1:()=>Xk,eye:()=>Zg,fft:()=>tm,fill:()=>La,floor:()=>vp,floorDiv:()=>Bv,fused:()=>nm,gather:()=>bp,gatherND:()=>v2e,greater:()=>fn,greaterEqual:()=>Es,ifft:()=>Od,imag:()=>Hf,image:()=>Gn,inTopKAsync:()=>C2e,irfft:()=>ab,isFinite:()=>Yk,isInf:()=>Zk,isNaN:()=>Qk,leakyRelu:()=>qf,less:()=>Ad,lessEqual:()=>Di,linalg:()=>A3,linspace:()=>O8,localResponseNormalization:()=>Jk,log:()=>To,log1p:()=>Kf,logSigmoid:()=>eE,logSoftmax:()=>Xv,logSumExp:()=>Xf,logicalAnd:()=>Yo,logicalNot:()=>Yf,logicalOr:()=>Yv,logicalXor:()=>tE,losses:()=>SOe,lowerBound:()=>M8,matMul:()=>Tt,max:()=>Io,maxPool:()=>Zf,maxPool3d:()=>nE,maxPoolWithArgmax:()=>F8,maximum:()=>Qs,mean:()=>qr,meshgrid:()=>P8,min:()=>Nd,minimum:()=>Js,mirrorPad:()=>Zv,mod:()=>oE,moments:()=>Qg,movingAverage:()=>d2e,mul:()=>W,multiRNNCell:()=>$8,multinomial:()=>L8,neg:()=>Rt,norm:()=>Dd,notEqual:()=>Cl,oneHot:()=>Jg,ones:()=>Vn,onesLike:()=>lo,op:()=>O,outerProduct:()=>V8,pad:()=>ko,pad1d:()=>B8,pad2d:()=>z8,pad3d:()=>U8,pad4d:()=>G8,pool:()=>sE,pow:()=>Xo,prelu:()=>Jf,print:()=>Ck,prod:()=>iE,raggedGather:()=>W8,raggedRange:()=>j8,raggedTensorToTensor:()=>H8,rand:()=>q8,randomGamma:()=>uX,randomNormal:()=>ry,randomStandardNormal:()=>pX,randomUniform:()=>Ai,randomUniformInt:()=>dX,range:()=>wp,real:()=>Rd,reciprocal:()=>pE,relu:()=>Go,relu6:()=>Qv,reshape:()=>H,reverse:()=>Qn,reverse1d:()=>hX,reverse2d:()=>fX,reverse3d:()=>mX,reverse4d:()=>gX,rfft:()=>rm,round:()=>Jv,rsqrt:()=>eb,scalar:()=>Oe,scatterND:()=>f2e,searchSorted:()=>a_,selu:()=>tb,separableConv2d:()=>rb,setdiff1dAsync:()=>yX,sigmoid:()=>co,sign:()=>dE,signal:()=>_Oe,sin:()=>nb,sinh:()=>ob,slice:()=>tt,slice1d:()=>sb,slice2d:()=>l_,slice3d:()=>ib,slice4d:()=>ny,softmax:()=>em,softplus:()=>wl,spaceToBatchND:()=>Qf,sparse:()=>IOe,sparseToDense:()=>y2e,spectral:()=>COe,split:()=>Jn,sqrt:()=>Rr,square:()=>vt,squaredDifference:()=>cb,squeeze:()=>Jt,stack:()=>mn,step:()=>Ba,stridedSlice:()=>hE,string:()=>TOe,sub:()=>Te,sum:()=>Pe,tan:()=>fE,tanh:()=>bl,tensor:()=>Co,tensor1d:()=>Or,tensor2d:()=>us,tensor3d:()=>mE,tensor4d:()=>xX,tensor5d:()=>vX,tensor6d:()=>bX,tensorScatterUpdate:()=>_X,tile:()=>Uo,topk:()=>gE,transpose:()=>kt,truncatedNormal:()=>lb,unique:()=>yE,unsortedSegmentSum:()=>ub,unstack:()=>eo,upperBound:()=>SX,variable:()=>xE,where:()=>jr,whereAsync:()=>bE,zeros:()=>Cr,zerosLike:()=>nt});var UY=(r,e,t,n=sr)=>{switch(r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(N("a",r,e,t),N("b",r,e,t))];case"AddN":return[n.addN(N("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(N("a",r,e,t),N("b",r,e,t))];case"Mul":return[n.mul(N("a",r,e,t),N("b",r,e,t))];case"RealDiv":case"Div":return[n.div(N("a",r,e,t),N("b",r,e,t))];case"DivNoNan":return[n.divNoNan(N("a",r,e,t),N("b",r,e,t))];case"FloorDiv":return[n.floorDiv(N("a",r,e,t),N("b",r,e,t))];case"Sub":return[n.sub(N("a",r,e,t),N("b",r,e,t))];case"Minimum":return[n.minimum(N("a",r,e,t),N("b",r,e,t))];case"Maximum":return[n.maximum(N("a",r,e,t),N("b",r,e,t))];case"Pow":return[n.pow(N("a",r,e,t),N("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(N("a",r,e,t),N("b",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var GY=(r,e,t,n=sr)=>{switch(r.op){case"Abs":case"ComplexAbs":return[n.abs(N("x",r,e,t))];case"Acos":return[n.acos(N("x",r,e,t))];case"Acosh":return[n.acosh(N("x",r,e,t))];case"Asin":return[n.asin(N("x",r,e,t))];case"Asinh":return[n.asinh(N("x",r,e,t))];case"Atan":return[n.atan(N("x",r,e,t))];case"Atan2":return[n.atan2(N("x",r,e,t),N("y",r,e,t))];case"Atanh":return[n.atanh(N("x",r,e,t))];case"Ceil":return[n.ceil(N("x",r,e,t))];case"Complex":return[n.complex(N("real",r,e,t),N("imag",r,e,t))];case"Cos":return[n.cos(N("x",r,e,t))];case"Cosh":return[n.cosh(N("x",r,e,t))];case"Elu":return[n.elu(N("x",r,e,t))];case"Erf":return[n.erf(N("x",r,e,t))];case"Exp":return[n.exp(N("x",r,e,t))];case"Expm1":return[n.expm1(N("x",r,e,t))];case"Floor":return[n.floor(N("x",r,e,t))];case"Log":return[n.log(N("x",r,e,t))];case"Log1p":return[n.log1p(N("x",r,e,t))];case"Imag":return[n.imag(N("x",r,e,t))];case"Neg":return[n.neg(N("x",r,e,t))];case"Reciprocal":return[n.reciprocal(N("x",r,e,t))];case"Real":return[n.real(N("x",r,e,t))];case"Relu":return[n.relu(N("x",r,e,t))];case"Round":return[n.round(N("x",r,e,t))];case"Selu":return[n.selu(N("x",r,e,t))];case"Sigmoid":return[n.sigmoid(N("x",r,e,t))];case"Sin":return[n.sin(N("x",r,e,t))];case"Sign":return[n.sign(N("x",r,e,t))];case"Sinh":return[n.sinh(N("x",r,e,t))];case"Softplus":return[n.softplus(N("x",r,e,t))];case"Sqrt":return[n.sqrt(N("x",r,e,t))];case"Square":return[n.square(N("x",r,e,t))];case"Tanh":return[n.tanh(N("x",r,e,t))];case"Tan":return[n.tan(N("x",r,e,t))];case"ClipByValue":return[n.clipByValue(N("x",r,e,t),N("clipValueMin",r,e,t),N("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(N("x",r,e,t))];case"Rsqrt":return[n.rsqrt(Wn(r.inputNames[0],e,t))];case"LeakyRelu":return[n.leakyRelu(N("x",r,e,t),N("alpha",r,e,t))];case"Prelu":return[n.prelu(N("x",r,e,t),N("alpha",r,e,t))];case"IsNan":return[n.isNaN(Wn(r.inputNames[0],e,t))];case"IsInf":return[n.isInf(Wn(r.inputNames[0],e,t))];case"IsFinite":return[n.isFinite(Wn(r.inputNames[0],e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};function Oi(r,e,t=""){if(!(typeof r=="number"||typeof e=="number")){C.assert(r.length===e.length,()=>t+` Shapes ${r} and ${e} must match`);for(let n=0;n<r.length;n++){let o=r[n],s=e[n];C.assert(o<0||s<0||o===s,()=>t+` Shapes ${r} and ${e} must match`)}}}function WY(r){return!(typeof r=="number"||r.some(e=>e<0))}function xb(r,e,t){let n=XE(r,t),o=!WY(n);if(o&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${n}`);if(o&&e.forEach(s=>{n=XE(s.shape,n)}),!WY(n))throw new Error(`Non-fully-defined elementShape: ${n}`);return n}function XE(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error(`Incompatible ranks during merge: ${r} vs. ${e}`);let t=[];for(let n=0;n<r.length;++n){let o=r[n],s=e[n];if(o>=0&&s>=0&&o!==s)throw new Error(`Incompatible shape during merge: ${r} vs. ${e}`);t[n]=o>=0?o:s}return t}var YE=class{constructor(e,t,n,o,s,i,a){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=o,this.identicalElementShapes=s,this.dynamicSize=i,this.clearAfterRead=a,this.tensors=[],this.closed_=!1,this.idTensor=Oe(0),rn(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);let t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Oi(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,rn(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((n,o)=>this.write(n,t[o]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let o=0;o<this.size();o++)e.push(o)}if(e.length===0)return Co([],[0].concat(this.elementShape));let n=this.readMany(e);return Oi(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),mn(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Co([],[0].concat(this.elementShape));let t=[];for(let o=0;o<this.size();o++)t.push(o);let n=this.readMany(t);return Oi(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),Xt(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);let n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,eo(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0,o=e.map(c=>(n+=c,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);let s=n===0?0:t.size/n,i=[];ee(()=>{t=H(t,[1,n,s]);for(let c=0;c<e.length;++c){let u=[0,c===0?0:o[c-1],0],p=[1,e[c],s];i[c]=H(tt(t,u,p),this.elementShape)}return i});let a=[];for(let c=0;c<e.length;c++)a[c]=c;this.writeMany(a,i)}};var vb=class r{get id(){return this.idTensor.id}constructor(e,t,n,o=-1){this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(s=>{if(n!==s.dtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${s.dtype}`);Oi(t,s.shape,"TensorList shape mismatch: "),rn(s)}),this.idTensor=Oe(0),this.maxNumElements=o,rn(this.idTensor)}copy(){return new r([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,t,n=-1){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(n!==-1&&this.tensors.length!==n)throw new Error(`Operation expected a list with ${n} elements but got a list with ${this.tensors.length} elements.`);Oi(e,this.elementShape,"TensorList shape mismatch: ");let o=xb(this.elementShape,this.tensors,e);return ee(()=>{let s=this.tensors.map(i=>H(i,o));return mn(s,0)})}popBack(e,t){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let n=xb(this.elementShape,this.tensors,e),o=this.tensors.pop();return o.kept=!1,Oi(o.shape,e,"TensorList shape mismatch: "),H(o,n)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(Oi(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");rn(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);let t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(let n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t}getItem(e,t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);Oi(this.tensors[e].shape,t,"TensorList shape mismatch: ");let o=xb(this.elementShape,this.tensors,t);return H(this.tensors[e],o)}setItem(e,t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);Oi(this.elementShape,t.shape,"TensorList shape mismatch: "),rn(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t}gather(e,t,n){if(t!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t}, but list elements ${this.elementDtype}`);Oi(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());let o=xb(this.elementShape,this.tensors,n);return e.length===0?Co([],[0].concat(o)):ee(()=>{let s=e.map(i=>H(this.tensors[i],o));return mn(s,0)})}concat(e,t){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);Oi(this.elementShape,t,"TensorList shape mismatch: ");let n=xb(this.elementShape,this.tensors,t);return this.size()===0?Co([],[0].concat(n)):ee(()=>{let o=this.tensors.map(s=>H(s,n));return Xt(o,0)})}};function jY(r,e,t){let n=r.dtype;if(r.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${r.shape}`);if(r.dtype!==t)throw new Error(`Invalid data types; op elements ${r.dtype}, but list elements ${t}`);let o=r.shape.slice(1);Oi(o,e,"TensorList shape mismatch: ");let s=eo(r);return new vb(s,e,n)}function HY(r,e,t,n){return new vb([],r,e,n)}function qY(r,e,t,n){if(e.length!==r.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${r.shape[0]}`);let o=Math.max(...e);if(n!=null&&n!==-1&&o>=n)throw new Error(`Max index must be < array size (${o}  vs. ${n})`);let s=new vb([],t,r.dtype,n),i=eo(r,0);return e.forEach((a,c)=>{s.setItem(a,i[c])}),s}function KY(r,e,t){let n=0,o=e.map(u=>(n+=u,n));if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${r.shape}`);let s=r.shape.slice(1),i=XE(s,t),a=n===0?0:r.size/n,c=ee(()=>{let u=[];r=H(r,[1,n,a]);for(let p=0;p<e.length;++p){let h=[0,p===0?0:o[p-1],0],f=[1,e[p],a];u[p]=H(tt(r,h,f),i)}return r.dispose(),u}),l=new vb([],t,r.dtype,e.length);for(let u=0;u<c.length;u++)l.setItem(u,c[u]);return l}var XY=(r,e,t)=>M(void 0,null,function*(){switch(r.op){case"If":case"StatelessIf":{let n=N("thenBranch",r,e,t),o=N("elseBranch",r,e,t),s=N("cond",r,e,t),i=N("args",r,e,t);return(yield s.data())[0]?t.functionMap[n].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap):t.functionMap[o].executeFunctionAsync(i,t.tensorArrayMap,t.tensorListMap)}case"While":case"StatelessWhile":{let n=N("body",r,e,t),o=N("cond",r,e,t),s=N("args",r,e,t),i=yield t.functionMap[o].executeFunctionAsync(s,t.tensorArrayMap,t.tensorListMap),a=s.map(u=>u.id),c=yield i[0].data();i.forEach(u=>{!u.kept&&a.indexOf(u.id)===-1&&u.dispose()});let l=s;for(;c[0];){let u=l;l=yield t.functionMap[n].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap);let p=l.map(h=>h.id);u.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&p.indexOf(h.id)===-1&&h.dispose()});let d=yield t.functionMap[o].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap);c=yield d[0].data(),d.forEach(h=>{!h.kept&&a.indexOf(h.id)===-1&&p.indexOf(h.id)===-1&&h.dispose()})}return l}case"LoopCond":{let n=N("pred",r,e,t);return[Il(n)]}case"Switch":{let n=N("pred",r,e,t),o=N("data",r,e,t);return o.kept||(o=Il(o)),(yield n.data())[0]?[void 0,o]:[o,void 0]}case"Merge":{let n=r.inputNames.find(o=>Wn(o,e,t)!==void 0);if(n){let o=Wn(n,e,t);return[Il(o)]}return}case"Enter":{let n=N("frameName",r,e,t),o=N("tensor",r,e,t);return t.enterFrame(n),[Il(o)]}case"Exit":{let n=N("tensor",r,e,t);return t.exitFrame(),[Il(n)]}case"NextIteration":{let n=N("tensor",r,e,t);return t.nextIteration(),[Il(n)]}case"TensorArrayV3":{let n=N("size",r,e,t),o=N("dtype",r,e,t),s=N("elementShape",r,e,t),i=N("dynamicSize",r,e,t),a=N("clearAfterRead",r,e,t),c=N("identicalElementShapes",r,e,t),l=N("name",r,e,t),u=new YE(l,o,n,s,c,i,a);return t.addTensorArray(u),[u.idTensor,Oe(1)]}case"TensorArrayWriteV3":{let n=N("tensorArrayId",r,e,t),o=N("index",r,e,t),s=N("tensor",r,e,t),i=t.getTensorArray(n.id);return i.write(o,s),[i.idTensor]}case"TensorArrayReadV3":{let n=N("tensorArrayId",r,e,t),o=N("index",r,e,t);return[t.getTensorArray(n.id).read(o)]}case"TensorArrayGatherV3":{let n=N("tensorArrayId",r,e,t),o=N("indices",r,e,t),s=N("dtype",r,e,t);return[t.getTensorArray(n.id).gather(o,s)]}case"TensorArrayScatterV3":{let n=N("tensorArrayId",r,e,t),o=N("indices",r,e,t),s=N("tensor",r,e,t),i=t.getTensorArray(n.id);return i.scatter(o,s),[i.idTensor]}case"TensorArrayConcatV3":{let n=N("tensorArrayId",r,e,t),o=t.getTensorArray(n.id),s=N("dtype",r,e,t);return[o.concat(s)]}case"TensorArraySplitV3":{let n=N("tensorArrayId",r,e,t),o=N("tensor",r,e,t),s=N("lengths",r,e,t),i=t.getTensorArray(n.id);return i.split(s,o),[i.idTensor]}case"TensorArraySizeV3":{let n=N("tensorArrayId",r,e,t),o=t.getTensorArray(n.id);return[Oe(o.size(),"int32")]}case"TensorArrayCloseV3":{let n=N("tensorArrayId",r,e,t),o=t.getTensorArray(n.id);return o.clearAndClose(),[o.idTensor]}case"TensorListSetItem":{let n=N("tensorListId",r,e,t),o=N("index",r,e,t),s=N("tensor",r,e,t),i=t.getTensorList(n.id);return i.setItem(o,s),[i.idTensor]}case"TensorListGetItem":{let n=N("tensorListId",r,e,t),o=N("index",r,e,t),s=N("elementShape",r,e,t),i=N("elementDType",r,e,t);return[t.getTensorList(n.id).getItem(o,s,i)]}case"TensorListScatterV2":case"TensorListScatter":{let n=N("indices",r,e,t),o=N("tensor",r,e,t),s=N("elementShape",r,e,t),i=N("numElements",r,e,t),a=qY(o,n,s,i);return t.addTensorList(a),[a.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let n=N("elementShape",r,e,t),o=N("elementDType",r,e,t),s;r.op==="TensorListReserve"?s="numElements":s="maxNumElements";let i=N(s,r,e,t),a=r.op==="TensorListReserve"?-1:i,c=HY(n,o,i,a);return t.addTensorList(c),[c.idTensor]}case"TensorListGather":{let n=N("tensorListId",r,e,t),o=N("indices",r,e,t),s=N("elementShape",r,e,t),i=N("elementDType",r,e,t);return[t.getTensorList(n.id).gather(o,i,s)]}case"TensorListStack":{let n=N("tensorListId",r,e,t),o=N("elementShape",r,e,t),s=N("elementDType",r,e,t),i=N("numElements",r,e,t);return[t.getTensorList(n.id).stack(o,s,i)]}case"TensorListFromTensor":{let n=N("tensor",r,e,t),o=N("elementShape",r,e,t),s=N("elementDType",r,e,t),i=jY(n,o,s);return t.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let n=N("tensorListId",r,e,t),o=t.getTensorList(n.id),s=N("dtype",r,e,t),i=N("elementShape",r,e,t);return[o.concat(s,i)]}case"TensorListPushBack":{let n=N("tensorListId",r,e,t),o=N("tensor",r,e,t),s=t.getTensorList(n.id);return s.pushBack(o),[s.idTensor]}case"TensorListPopBack":{let n=N("tensorListId",r,e,t),o=N("elementShape",r,e,t),s=N("elementDType",r,e,t);return[t.getTensorList(n.id).popBack(o,s)]}case"TensorListSplit":{let n=N("tensor",r,e,t),o=N("elementShape",r,e,t),s=N("lengths",r,e,t),i=KY(n,s,o);return t.addTensorList(i),[i.idTensor]}case"TensorListLength":{let n=N("tensorListId",r,e,t),o=t.getTensorList(n.id);return[Oe(o.size(),"int32")]}case"TensorListResize":{let n=N("tensorListId",r,e,t),o=N("size",r,e,t),i=t.getTensorList(n.id).resize(o);return t.addTensorList(i),[i.idTensor]}default:throw TypeError(`Node type ${r.op} is not implemented`)}});function YY(r,e,t){let[n,o]=N("fusedOps",r,e,t),s=n==="biasadd",i=!s,a=o==="prelu",c=n==="fusedbatchnorm",l=N("numArgs",r,e,t);if(s){if(a&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&s&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let u=N("strides",r,e,t),p=m_(r,e,t),d=N("dataFormat",r,e,t).toUpperCase(),h=N("dilations",r,e,t),[f,m]=N("args",r,e,t);i&&(m=f,f=void 0);let g=N("leakyreluAlpha",r,e,t);return{stride:u,pad:p,dataFormat:d,dilations:h,biasArg:f,preluArg:m,activationFunc:o,leakyreluAlpha:g}}var ZY=(r,e,t,n=sr)=>{switch(r.op){case"Conv1D":{let o=N("stride",r,e,t),s=N("pad",r,e,t),i=N("dataFormat",r,e,t).toUpperCase(),a=N("dilation",r,e,t);return[n.conv1d(N("x",r,e,t),N("filter",r,e,t),o,s,i,a)]}case"Conv2D":{let o=N("strides",r,e,t),s=m_(r,e,t),i=N("dataFormat",r,e,t).toUpperCase(),a=N("dilations",r,e,t);return[n.conv2d(N("x",r,e,t),N("filter",r,e,t),[o[1],o[2]],s,i,[a[1],a[2]])]}case"_FusedConv2D":{let{stride:o,pad:s,dataFormat:i,dilations:a,biasArg:c,preluArg:l,activationFunc:u,leakyreluAlpha:p}=YY(r,e,t);return[n.fused.conv2d({x:N("x",r,e,t),filter:N("filter",r,e,t),strides:[o[1],o[2]],pad:s,dataFormat:i,dilations:[a[1],a[2]],bias:c,activation:u,preluActivationWeights:l,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{let{stride:o,pad:s,dataFormat:i,dilations:a,biasArg:c,preluArg:l,activationFunc:u,leakyreluAlpha:p}=YY(r,e,t);return[n.fused.depthwiseConv2d({x:N("x",r,e,t),filter:N("filter",r,e,t),strides:[o[1],o[2]],pad:s,dataFormat:i,dilations:[a[1],a[2]],bias:c,activation:u,preluActivationWeights:l,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let o=N("outputShape",r,e,t),s=N("strides",r,e,t),i=m_(r,e,t);return[n.conv2dTranspose(N("x",r,e,t),N("filter",r,e,t),o,[s[1],s[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let o=N("strides",r,e,t),s=m_(r,e,t),i=N("dilations",r,e,t),a=N("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(N("input",r,e,t),N("filter",r,e,t),[o[1],o[2]],s,a,[i[1],i[2]])]}case"Conv3D":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("dataFormat",r,e,t).toUpperCase(),a=N("dilations",r,e,t);return[n.conv3d(N("x",r,e,t),N("filter",r,e,t),[o[1],o[2],o[3]],s,i,[a[1],a[2],a[3]])]}case"AvgPool":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("kernelSize",r,e,t);return[n.avgPool(N("x",r,e,t),[i[1],i[2]],[o[1],o[2]],s)]}case"MaxPool":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("kernelSize",r,e,t);return[n.maxPool(N("x",r,e,t),[i[1],i[2]],[o[1],o[2]],s)]}case"MaxPoolWithArgmax":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("kernelSize",r,e,t),a=N("includeBatchInIndex",r,e,t),{result:c,indexes:l}=n.maxPoolWithArgmax(N("x",r,e,t),[i[1],i[2]],[o[1],o[2]],s,a);return[c,l]}case"AvgPool3D":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("kernelSize",r,e,t);return[n.avgPool3d(N("x",r,e,t),[i[1],i[2],i[3]],[o[1],o[2],o[3]],s)]}case"MaxPool3D":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("kernelSize",r,e,t);return[n.maxPool3d(N("x",r,e,t),[i[1],i[2],i[3]],[o[1],o[2],o[3]],s)]}case"Dilation2D":{let o=N("strides",r,e,t),s=N("pad",r,e,t),i=N("dilations",r,e,t),a=o[1],c=o[2],l=i[1],u=i[2];return[n.dilation2d(N("x",r,e,t),N("filter",r,e,t),[a,c],s,[l,u],"NHWC")]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};var QY=(r,e,t,n=sr)=>{switch(r.op){case"Fill":{let o=N("shape",r,e,t),s=N("dtype",r,e,t),i=N("value",r,e,t);return[n.fill(o,i,s)]}case"LinSpace":{let o=N("start",r,e,t),s=N("stop",r,e,t),i=N("num",r,e,t);return[n.linspace(o,s,i)]}case"Multinomial":{let o=N("logits",r,e,t),s=N("numSamples",r,e,t),i=N("seed",r,e,t);return[n.multinomial(o,s,i)]}case"OneHot":{let o=N("indices",r,e,t),s=N("depth",r,e,t),i=N("onValue",r,e,t),a=N("offValue",r,e,t),c=N("dtype",r,e,t);return[n.oneHot(o,s,i,a,c)]}case"Ones":return[n.ones(N("shape",r,e,t),N("dtype",r,e,t))];case"OnesLike":return[n.onesLike(N("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(N("shape",r,e,t),N("dtype",r,e,t),N("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(N("shape",r,e,t),N("minval",r,e,t),N("maxval",r,e,t),N("dtype",r,e,t))];case"RandomUniformInt":return[n.randomUniformInt(N("shape",r,e,t),N("minval",r,e,t),N("maxval",r,e,t),N("seed",r,e,t))];case"Range":{let o=N("start",r,e,t),s=N("stop",r,e,t),i=N("step",r,e,t);return[n.range(o,s,i,N("dtype",r,e,t))]}case"TruncatedNormal":{let o=N("shape",r,e,t),s=N("mean",r,e,t),i=N("stdDev",r,e,t),a=N("seed",r,e,t);return[n.truncatedNormal(o,s,i,N("dtype",r,e,t),a)]}case"Zeros":return[n.zeros(N("shape",r,e,t),N("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(N("x",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};function fV(r,e,t){let n=N("boxes",r,e,t),o=N("scores",r,e,t),s=N("maxOutputSize",r,e,t),i=N("iouThreshold",r,e,t),a=N("scoreThreshold",r,e,t),c=N("softNmsSigma",r,e,t);return{boxes:n,scores:o,maxOutputSize:s,iouThreshold:i,scoreThreshold:a,softNmsSigma:c}}var JY=(s,i,a,c,...l)=>M(void 0,[s,i,a,c,...l],function*(r,e,t,n,o=sr){switch(r.op){case"NonMaxSuppressionV5":{let{boxes:u,scores:p,maxOutputSize:d,iouThreshold:h,scoreThreshold:f,softNmsSigma:m}=fV(r,e,t),g=yield o.image.nonMaxSuppressionWithScoreAsync(u,p,d,h,f,m);return[g.selectedIndices,g.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:u,scores:p,maxOutputSize:d,iouThreshold:h,scoreThreshold:f}=fV(r,e,t),m=N("padToMaxOutputSize",r,e,t),g=yield o.image.nonMaxSuppressionPaddedAsync(u,p,d,h,f,m);return[g.selectedIndices,g.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:u,scores:p,maxOutputSize:d,iouThreshold:h,scoreThreshold:f}=fV(r,e,t);return[yield o.image.nonMaxSuppressionAsync(u,p,d,h,f)]}case"Where":{let u=o.cast(N("condition",r,e,t),"bool"),p=[yield o.whereAsync(u)];return u.dispose(),p}case"ListDiff":return o.setdiff1dAsync(N("x",r,e,t),N("y",r,e,t));default:throw TypeError(`Node type ${r.op} is not implemented`)}});var e7=(r,e,t,n=sr)=>{switch(r.op){case"LowerBound":{let o=N("sortedSequence",r,e,t),s=N("values",r,e,t);return[n.lowerBound(o,s)]}case"TopKV2":{let o=N("x",r,e,t),s=N("k",r,e,t),i=N("sorted",r,e,t),a=n.topk(o,s,i);return[a.values,a.indices]}case"UpperBound":{let o=N("sortedSequence",r,e,t),s=N("values",r,e,t);return[n.upperBound(o,s)]}case"Unique":{let o=N("x",r,e,t),s=n.unique(o);return[s.values,s.indices]}case"UniqueV2":{let o=N("x",r,e,t),s=N("axis",r,e,t),i=n.unique(o,s);return[i.values,i.indices]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};var t7=(r,e,t,n=sr)=>{switch(r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":let o=N("default",r,e,t);return[Wn(r.name,e,t)||o];case"Placeholder":return[Wn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let u=N("x",r,e,t);return[Il(u)]}case"IdentityN":return N("x",r,e,t).map(u=>Il(u));case"Snapshot":let s=N("x",r,e,t);return[Il(s)];case"Shape":return[n.tensor1d(N("x",r,e,t).shape,"int32")];case"ShapeN":return N("x",r,e,t).map(u=>n.tensor1d(u.shape));case"Size":return[n.scalar(N("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(N("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":let i=N("x",r,e,t),a=N("data",r,e,t),c=N("message",r,e,t),l=N("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(let u=0;u<a.length;u++)console.log(Array.prototype.slice.call(a[u].dataSync()).slice(0,l));return[i];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var ZE=class{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Oe(0),this.tensorMap=new Map,rn(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Oe(this.size(),"int32")}import(e,t){return M(this,null,function*(){this.checkKeyAndValueTensor(e,t);let n=yield e.data();return this.tensorMap.forEach(o=>o.dispose()),this.tensorMap.clear(),ee(()=>{let o=eo(t),s=n.length,i=o.length;C.assert(s===i,()=>`The number of elements doesn't match, keys has ${s} elements, the values has ${i} elements.`);for(let a=0;a<s;a++){let c=n[a],l=o[a];rn(l),this.tensorMap.set(c,l)}return this.handle})})}find(e,t){return M(this,null,function*(){this.checkKeyAndValueTensor(e,t);let n=yield e.data();return ee(()=>{let o=[];for(let s=0;s<n.length;s++){let i=n[s],a=this.findWithDefault(i,t);o.push(a)}return mn(o)})})}findWithDefault(e,t){let n=this.tensorMap.get(e);return n??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}};var r7=(r,e,t,n)=>M(void 0,null,function*(){switch(r.op){case"HashTable":case"HashTableV2":{let o=n.getHashTableHandleByName(r.name);if(o!=null)return[o];{let s=N("keyDType",r,e,t),i=N("valueDType",r,e,t),a=new ZE(s,i);return n.addHashTable(r.name,a),[a.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let o=N("tableHandle",r,e,t,n),s=N("keys",r,e,t),i=N("values",r,e,t);return[yield n.getHashTableById(o.id).import(s,i)]}case"LookupTableFind":case"LookupTableFindV2":{let o=N("tableHandle",r,e,t,n),s=N("keys",r,e,t),i=N("defaultValue",r,e,t);return[yield n.getHashTableById(o.id).find(s,i)]}case"LookupTableSize":case"LookupTableSizeV2":{let o=N("tableHandle",r,e,t,n);return[n.getHashTableById(o.id).tensorSize()]}default:throw TypeError(`Node type ${r.op} is not implemented`)}});var n7=(r,e,t,n=sr)=>{switch(r.op){case"ResizeBilinear":{let o=N("images",r,e,t),s=N("size",r,e,t),i=N("alignCorners",r,e,t),a=N("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(o,[s[0],s[1]],i,a)]}case"ResizeNearestNeighbor":{let o=N("images",r,e,t),s=N("size",r,e,t),i=N("alignCorners",r,e,t),a=N("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(o,[s[0],s[1]],i,a)]}case"CropAndResize":{let o=N("image",r,e,t),s=N("boxes",r,e,t),i=N("boxInd",r,e,t),a=N("cropSize",r,e,t),c=N("method",r,e,t),l=N("extrapolationValue",r,e,t);return[n.image.cropAndResize(o,s,i,a,c,l)]}case"ImageProjectiveTransformV3":{let o=N("images",r,e,t),s=N("transforms",r,e,t),i=N("outputShape",r,e,t),a=N("fillValue",r,e,t),c=N("interpolation",r,e,t),l=N("fillMode",r,e,t);return[n.image.transform(o,s,c.toLowerCase(),l.toLowerCase(),a,i)]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};var o7=(r,e,t,n=sr)=>{switch(r.op){case"Equal":return[n.equal(N("a",r,e,t),N("b",r,e,t))];case"NotEqual":return[n.notEqual(N("a",r,e,t),N("b",r,e,t))];case"Greater":return[n.greater(N("a",r,e,t),N("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(N("a",r,e,t),N("b",r,e,t))];case"Less":return[n.less(N("a",r,e,t),N("b",r,e,t))];case"LessEqual":return[n.lessEqual(N("a",r,e,t),N("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(N("a",r,e,t),N("b",r,e,t))];case"LogicalNot":return[n.logicalNot(N("a",r,e,t))];case"LogicalOr":return[n.logicalOr(N("a",r,e,t),N("b",r,e,t))];case"Select":case"SelectV2":return[n.where(N("condition",r,e,t),N("a",r,e,t),N("b",r,e,t))];case"BitwiseAnd":return[n.bitwiseAnd(N("a",r,e,t),N("b",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var s7=(r,e,t,n=sr)=>{switch(r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(N("a",r,e,t),N("b",r,e,t),N("transposeA",r,e,t),N("transposeB",r,e,t))];case"Einsum":return[n.einsum(N("equation",r,e,t),...N("tensors",r,e,t))];case"Transpose":return[n.transpose(N("x",r,e,t),N("perm",r,e,t))];case"_FusedMatMul":let[o,s]=N("fusedOps",r,e,t),i=o==="biasadd",a=s==="prelu",c=N("numArgs",r,e,t),l=N("leakyreluAlpha",r,e,t);if(i){if(a&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!a&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[u,p]=N("args",r,e,t);return[n.fused.matMul({a:N("a",r,e,t),b:N("b",r,e,t),transposeA:N("transposeA",r,e,t),transposeB:N("transposeB",r,e,t),bias:u,activation:s,preluActivationWeights:p,leakyreluAlpha:l})];case"MatrixBandPart":return[n.linalg.bandPart(N("a",r,e,t),N("numLower",r,e,t),N("numUpper",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var i7=(r,e,t,n=sr)=>{switch(r.op){case"EuclideanNorm":return[n.euclideanNorm(N("x",r,e,t),N("axis",r,e,t),N("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(N("x",r,e,t),N("mean",r,e,t),N("variance",r,e,t),N("offset",r,e,t),N("scale",r,e,t),N("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(N("x",r,e,t),N("mean",r,e,t),N("variance",r,e,t),N("offset",r,e,t),N("scale",r,e,t),N("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(N("x",r,e,t),N("radius",r,e,t),N("bias",r,e,t),N("alpha",r,e,t),N("beta",r,e,t))];case"Softmax":return[n.softmax(N("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(N("x",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var a7=(r,e,t,n=sr)=>{switch(r.op){case"RaggedGather":{let{outputNestedSplits:o,outputDenseValues:s}=n.raggedGather(N("paramsNestedSplits",r,e,t),N("paramsDenseValues",r,e,t),N("indices",r,e,t),N("outputRaggedRank",r,e,t));return o.concat(s)}case"RaggedRange":{let{rtNestedSplits:o,rtDenseValues:s}=n.raggedRange(N("starts",r,e,t),N("limits",r,e,t),N("splits",r,e,t));return[o,s]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(N("shape",r,e,t),N("values",r,e,t),N("defaultValue",r,e,t),N("rowPartitionTensors",r,e,t),N("rowPartitionTypes",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var c7=(r,e,t,n=sr)=>{switch(r.op){case"Max":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.max(N("x",r,e,t),a,c)]}case"Mean":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.mean(N("x",r,e,t),a,c)]}case"Min":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.min(N("x",r,e,t),a,c)]}case"Sum":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.sum(N("x",r,e,t),a,c)]}case"All":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.all(N("x",r,e,t),a,c)]}case"Any":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.any(N("x",r,e,t),a,c)]}case"ArgMax":{let a=N("axis",r,e,t);return[n.argMax(N("x",r,e,t),a)]}case"ArgMin":{let a=N("axis",r,e,t);return[n.argMin(N("x",r,e,t),a)]}case"Prod":{let a=N("axis",r,e,t),c=N("keepDims",r,e,t);return[n.prod(N("x",r,e,t),a,c)]}case"Cumprod":{let a=N("axis",r,e,t),c=N("exclusive",r,e,t),l=N("reverse",r,e,t);return[n.cumprod(N("x",r,e,t),a,c,l)]}case"Cumsum":{let a=N("axis",r,e,t),c=N("exclusive",r,e,t),l=N("reverse",r,e,t);return[n.cumsum(N("x",r,e,t),a,c,l)]}case"Bincount":let o=N("x",r,e,t),s=N("weights",r,e,t),i=N("size",r,e,t);return[n.bincount(o,s,i)];case"DenseBincount":{let a=N("x",r,e,t),c=N("weights",r,e,t),l=N("size",r,e,t),u=N("binaryOutput",r,e,t);return[n.denseBincount(a,c,l,u)]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};var l7=(r,e,t,n=sr)=>{switch(r.op){case"ConcatV2":case"Concat":{let o=N("n",r,e,t),s=N("axis",r,e,t),i=N("tensors",r,e,t);return i=i.slice(0,o),[n.concat(i,s)]}case"Gather":{let o=N("x",r,e,t),s=N("indices",r,e,t);return[n.gather(o,n.cast(s,"int32"),0)]}case"GatherV2":{let o=N("axis",r,e,t),s=N("batchDims",r,e,t),i=N("x",r,e,t),a=N("indices",r,e,t);return[n.gather(i,n.cast(a,"int32"),o,s)]}case"Reverse":{let o=N("dims",r,e,t),s=[];for(let a=0;a<o.length;a++)o[a]&&s.push(a);let i=N("x",r,e,t);return[n.reverse(i,s)]}case"ReverseV2":{let o=N("axis",r,e,t),s=N("x",r,e,t);return[n.reverse(s,o)]}case"Slice":{let o=N("begin",r,e,t),s=N("size",r,e,t);return[n.slice(N("x",r,e,t),o,s)]}case"StridedSlice":{let o=N("begin",r,e,t),s=N("end",r,e,t),i=N("strides",r,e,t),a=N("beginMask",r,e,t),c=N("endMask",r,e,t),l=N("ellipsisMask",r,e,t),u=N("newAxisMask",r,e,t),p=N("shrinkAxisMask",r,e,t),d=N("x",r,e,t);return[n.stridedSlice(d,o,s,i,a,c,l,u,p)]}case"Pack":return ee(()=>{let o=N("axis",r,e,t),s=N("tensors",r,e,t),i=s[0].shape,a=n.squeeze(s[0]).shape,c=s.map(l=>{let u=C.arraysEqual(l.shape,i);if(!u&&!C.arraysEqual(n.squeeze(l).shape,a))throw new Error("the input tensors shape does not match");return u?l:n.reshape(l,i)});return[n.stack(c,o)]});case"Unpack":{let o=N("axis",r,e,t),s=N("tensor",r,e,t);return n.unstack(s,o)}case"Tile":{let o=N("reps",r,e,t);return[n.tile(N("x",r,e,t),o)]}case"Split":case"SplitV":{let o=N("axis",r,e,t),s=N("numOrSizeSplits",r,e,t),i=N("x",r,e,t);return n.split(i,s,o)}case"ScatterNd":{let o=N("indices",r,e,t),s=N("values",r,e,t),i=N("shape",r,e,t);return[n.scatterND(o,s,i)]}case"GatherNd":{let o=N("x",r,e,t),s=N("indices",r,e,t);return[n.gatherND(o,s)]}case"SparseToDense":{let o=N("sparseIndices",r,e,t),s=N("outputShape",r,e,t),i=N("sparseValues",r,e,t),a=N("defaultValue",r,e,t);return[n.sparseToDense(o,i,s,i.dtype===a.dtype?a:n.cast(a,i.dtype))]}case"TensorScatterUpdate":{let o=N("indices",r,e,t),s=N("values",r,e,t),i=N("tensor",r,e,t);return[n.tensorScatterUpdate(i,o,s)]}default:throw TypeError(`Node type ${r.op} is not implemented`)}};var u7=(r,e,t,n=sr)=>{switch(r.op){case"SparseFillEmptyRows":{let{outputIndices:o,outputValues:s,emptyRowIndicator:i,reverseIndexMap:a}=n.sparse.sparseFillEmptyRows(N("indices",r,e,t),N("values",r,e,t),N("denseShape",r,e,t),N("defaultValue",r,e,t));return[o,s,i,a]}case"SparseReshape":{let{outputIndices:o,outputShape:s}=n.sparse.sparseReshape(N("inputIndices",r,e,t),N("inputShape",r,e,t),N("newShape",r,e,t));return[o,s]}case"SparseSegmentMean":return[n.sparse.sparseSegmentMean(N("data",r,e,t),N("indices",r,e,t),N("segmentIds",r,e,t))];case"SparseSegmentSum":return[n.sparse.sparseSegmentSum(N("data",r,e,t),N("indices",r,e,t),N("segmentIds",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var p7=(r,e,t,n=sr)=>{switch(r.op){case"FFT":return[n.fft(N("x",r,e,t))];case"IFFT":return[n.ifft(N("x",r,e,t))];case"RFFT":return[n.rfft(N("x",r,e,t))];case"IRFFT":return[n.irfft(N("x",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var d7=(r,e,t,n=sr)=>{switch(r.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(N("input",r,e,t),N("pattern",r,e,t),N("rewrite",r,e,t),N("replaceGlobal",r,e,t))];case"StringNGrams":{let{nGrams:o,nGramsSplits:s}=n.string.stringNGrams(N("data",r,e,t),N("dataSplits",r,e,t),N("separator",r,e,t),N("nGramWidths",r,e,t),N("leftPad",r,e,t),N("rightPad",r,e,t),N("padWidth",r,e,t),N("preserveShortSequences",r,e,t));return[o,s]}case"StringSplit":{let{indices:o,values:s,shape:i}=n.string.stringSplit(N("input",r,e,t),N("delimiter",r,e,t),N("skipEmpty",r,e,t));return[o,s,i]}case"StringToHashBucketFast":return[n.string.stringToHashBucketFast(N("input",r,e,t),N("numBuckets",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};var h7=(r,e,t,n=sr)=>{switch(r.op){case"Cast":return[n.cast(N("x",r,e,t),N("dtype",r,e,t))];case"ExpandDims":{let o=N("axis",r,e,t);return[n.expandDims(N("x",r,e,t),o)]}case"Squeeze":{let o=N("axis",r,e,t);return[n.squeeze(N("x",r,e,t),o)]}case"Reshape":return[n.reshape(N("x",r,e,t),N("shape",r,e,t))];case"EnsureShape":return[n.ensureShape(N("x",r,e,t),N("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(N("x",r,e,t),N("padding",r,e,t),N("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(N("x",r,e,t),N("padding",r,e,t),N("constantValue",r,e,t))];case"SpaceToBatchND":{let o=N("blockShape",r,e,t),s=N("paddings",r,e,t);return[n.spaceToBatchND(N("x",r,e,t),o,s)]}case"BatchToSpaceND":{let o=N("blockShape",r,e,t),s=N("crops",r,e,t);return[n.batchToSpaceND(N("x",r,e,t),o,s)]}case"DepthToSpace":{let o=N("blockSize",r,e,t),s=N("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(N("x",r,e,t),o,s)]}case"BroadcastTo":return[n.broadcastTo(N("x",r,e,t),N("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(N("s0",r,e,t),N("s1",r,e,t))];default:throw TypeError(`Node type ${r.op} is not implemented`)}};function mV(r,e,t,n,o=ee){let s=((i,a,c)=>{switch(i.category){case"arithmetic":return o(()=>UY(i,a,c));case"basic_math":return o(()=>GY(i,a,c));case"control":return XY(i,a,c);case"convolution":return o(()=>ZY(i,a,c));case"creation":return o(()=>QY(i,a,c));case"dynamic":return JY(i,a,c);case"evaluation":return o(()=>e7(i,a,c));case"image":return o(()=>n7(i,a,c));case"graph":return o(()=>t7(i,a,c));case"logical":return o(()=>o7(i,a,c));case"matrices":return o(()=>s7(i,a,c));case"normalization":return o(()=>i7(i,a,c));case"ragged":return o(()=>a7(i,a,c));case"reduction":return o(()=>c7(i,a,c));case"slice_join":return o(()=>l7(i,a,c));case"sparse":return o(()=>u7(i,a,c));case"spectral":return o(()=>p7(i,a,c));case"string":return o(()=>d7(i,a,c));case"transformation":return o(()=>h7(i,a,c));case"hash_table":return r7(i,a,c,n);case"custom":let l=PE(i.op);if(l&&l.customExecutor)return l.customExecutor(new KE(i,a,c));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(r,e,t);return C.isPromise(s)?s.then(i=>[].concat(i)):[].concat(s)}var y_=class{constructor(e={},t={},n={},o={},s){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=o,this.parseNodeNameCache=s,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let e=[];for(let t=0;t<this.contexts.length-1;t++){let n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(let t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(let t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}};function gV(r,e,t,n){let o=new Set,s=[],i=null,a=null,c=new Set,l=new Set(Object.keys(r).map(d=>Ns(d)[0]));n=n||[];let u=new Set(n.map(d=>Ns(d.name)[0])),p=[...e];for(;p.length>0;){let d=p.pop();if((sm(d)||YFe(d)||ZFe(d))&&i==null&&(i=d,a=i.children.map(h=>h.name).filter(h=>o.has(h))),o.add(d.name),t[d.name]==null&&!l.has(d.name)&&!u.has(d.name)){if(d.inputs.length===0){s.push(d.name);continue}d.inputs.forEach(h=>{c.has(h.name)||(c.add(h.name),p.push(h))})}}return{inputs:r,outputs:e,usedNodes:o,missingInputs:s,dynamicNode:i,syncInputs:a}}function f7(r,e){let{usedNodes:t,inputs:n}=e,o=Object.keys(n).map(g=>Ns(g)[0]).map(g=>r.nodes[g]),s=r.initNodes||[],i=g=>t.has(typeof g=="string"?g:g.name);function a(g){return[...new Map(g.map(y=>[y.name,y])).values()]}let c=a([...o,...r.weights,...s]).filter(i),l=a([...c,...Object.values(r.nodes)]).filter(i),u=new Map(l.map(g=>[g.name,g])),p={};for(let g of l){p[g.name]=p[g.name]||0;for(let y of g.children)i(y)||(p[y.name]=Number.POSITIVE_INFINITY),p[y.name]=(p[y.name]||0)+1}let d=Object.entries(p).filter(([,g])=>g===0).map(([g])=>g),h=[...d];for(;d.length>0;){let g=d.pop(),y=u.get(g);for(let x of y.children.filter(i))--p[x.name]===0&&(h.push(x.name),d.push(x.name))}let f=h.map(g=>u.get(g)),m=jFe(f,c);return HFe(m,c),m}function jFe(r,e){let t=new Map(r.map(i=>[i.name,i])),n=e.map(i=>i.name),o=new Set(n);for(;n.length>0;){let i=n.pop(),a=t.get(i);for(let c of a.children)!t.has(c.name)||o.has(c.name)||(o.add(c.name),n.push(c.name))}return r.filter(i=>o.has(i.name))}var bb=class extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}};function HFe(r,e){let t=new Map(r.map((a,c)=>[a.name,c])),n=new Set(e.map(a=>a.name)),o=a=>n.has(typeof a=="string"?a:a.name),s=new Set(r.map(a=>a.name)),i=a=>s.has(typeof a=="string"?a:a.name);for(let a of r){for(let c of a.children.filter(i)){if(!t.has(c.name))throw new bb(`Child ${c.name} of node ${a.name} is unreachable.`);if(t.get(a.name)>t.get(c.name))throw new bb(`Node ${a.name} is scheduled to run after its child ${c.name}.`)}if(!o(a))for(let c of a.inputs){if(!t.has(c.name))throw new bb(`Input ${c.name} of node ${a.name} is unreachable.`);if(t.get(c.name)>t.get(a.name))throw new bb(`Node ${a.name} is scheduled to run before its input ${c.name}.`)}}}function m7(r){let e=new Map(r.map((a,c)=>[a.name,c])),t=Number.MAX_SAFE_INTEGER,n=r.map((a,c)=>sm(a)?t:c),o=a=>{let c=n[e.get(a.name)];return c??-1},s=r.map((a,c)=>a.children.map(o).reduce((l,u)=>Math.max(l,u),n[c])),i=new Map;for(let a=0;a<r.length;++a){let c=s[a];if(c===t)continue;let l=r[a],u=r[c];i.has(u.name)||i.set(u.name,[]),i.get(u.name).push(l)}return i}var qFe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),KFe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),XFe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function sm(r){return qFe.has(r.op)}function YFe(r){return KFe.has(r.op)}function ZFe(r){return XFe.has(r.op)}var x_=class r{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){let t=Object.keys(e).map(n=>e[n].map(o=>o.id));this._weightIds=[].concat(...t),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{let t=e.signatureKey||e.name;return e.defaultOutput?`${t}:${e.defaultOutput}`:t})}get functions(){return Object.keys(this._functions).reduce((e,t)=>(e[t]=this._functions[t].signature,e),{})}constructor(e,t){this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(n=>{this._functionExecutorMap[n]=new r(e.functions[n],this)})}getCompilationKey(e,t){let n=e.map(s=>s.name).sort(),o=t.map(s=>s.name).sort();return n.join(this.SEPARATOR)+"--"+o.join(this.SEPARATOR)}compile(e,t){let n=gV(e,t,this.weightMap,this._initNodes),{missingInputs:o,dynamicNode:s,syncInputs:i}=n;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(o.length>0){let l=t.map(p=>p.name),u=Object.keys(e);throw new Error(`Cannot compute the outputs [${l}] from the provided inputs [${u}]. Missing the following inputs: [${o}]`)}let a=f7(this.graph,n),c=m7(a);return{orderedNodes:a,nodeLiveUntilMap:c}}cloneAndKeepTensor(e){if(e==null)return null;let t=e.clone();return rn(t),t}cloneTensorList(e){return e?e.map(n=>this.cloneAndKeepTensor(n)):null}cloneTensorMap(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,this.cloneTensorList(n)]))}execute(e,t){this.disposeIntermediateTensors(),e=this.mapInputs(e);let n=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);let o=n.map(d=>this.graph.nodes[Ns(d)[0]]),s=t.map(d=>Ns(d)[0]),i=new Set(s),a=s.map(d=>this.graph.nodes[d]);a.length===0&&(a=this._outputs);let c=this.getCompilationKey(o,a),l=this.compiledMap.get(c);l==null&&(l=this.compile(e,a),this.compiledMap.set(c,l));try{this.keepIntermediateTensors=Z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}let u={},p={};return ee(()=>{let d=new y_(this.weightMap,u,p,this.functionExecutorMap,this.parseNodeNameCache),h=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(e).forEach(y=>{let[x,b]=Ns(y,d),w=[];w[b]=e[y],h[x]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[x]=this.cloneTensorList(w))});let f=this.getFrozenTensorIds(h),{orderedNodes:m,nodeLiveUntilMap:g}=l;for(let y of m){if(h[y.name])continue;let x=mV(y,h,d,this._resourceManager);if(C.isPromise(x))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);h[y.name]=x,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(x)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,h,d,f,i,g.get(y.name))}return this.parent==null&&d.dispose(f),t.map(y=>Wn(y,h,d))})}getFrozenTensorIds(e){let t=[].concat.apply([],Object.keys(e).map(n=>e[n]).map(n=>n.map(o=>o.id)));return new Set(t)}checkTensorForDisposal(e,t,n,o,s,i,a){if(!(sm(t)||i.has(e))){for(let c of n[e])c!=null&&(a[c.id]=(a[c.id]||0)+t.children.length);for(let c of t.inputs){if(sm(c))continue;let l=q3(c.name,n,o);if(l!=null)for(let u of l){if(!u||u.kept||s.has(u.id))continue;let p=a[u.id];p===1?(u.dispose(),delete a[u.id]):p!=null&&a[u.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(e,t,n,o,s,i){function a(c){return sm(c)||s.has(c.name)}if(!(sm(e)||i==null))for(let c of i){if(a(c))continue;let l=q3(c.name,t,n);for(let u of l)!u||u.kept||o.has(u.id)||u.dispose()}}executeAsync(e,t){return M(this,null,function*(){return this._executeAsync(e,t)})}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(e=>{for(let t of e)t&&!t.isDisposed&&t.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}_executeAsync(i,a){return M(this,arguments,function*(e,t,n=!1,o={},s={}){this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Z().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(f){this.keepIntermediateTensors=!1,console.warn(f.message)}let c=new y_(this.weightMap,o,s,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let l=yield this.executeWithControlFlow(e,c,t,n),u=t.map(f=>Wn(f,l,c)),p=u.map(f=>f.id),d=Object.keys(e).map(f=>e[f].id),h=new Set([...p,...d,...this.weightIds]);return Object.values(l).forEach(f=>{f.forEach(m=>{m&&!m.isDisposed&&!h.has(m.id)&&m.dispose()})}),this.parent==null&&c.dispose(h),u})}executeFunctionAsync(e,t,n){return M(this,null,function*(){let o=e.reduce((s,i,a)=>(s[this.inputs[a].name]=i,s),{});return this._executeAsync(o,this.outputNodes,!0,t,n)})}executeWithControlFlow(e,t,n,o){return M(this,null,function*(){let s=Object.keys(e),i=s.map(w=>this.graph.nodes[Ns(w)[0]]),a=n.map(w=>Ns(w)[0]),c=new Set(a),l=a.map(w=>this.graph.nodes[w]);l.length===0&&(l=this._outputs);let{usedNodes:u,missingInputs:p,dynamicNode:d,syncInputs:h}=gV(e,l,this.weightMap,this._initNodes),f=[...i,...this.graph.weights,...this._initNodes||[]].map(w=>({node:w,contexts:t.currentContext})),m=Object.assign({},this.weightMap);Object.keys(e).forEach(w=>{let[_,I]=Ns(w),S=[];S[I]=e[w],m[_]=S});let g={},y=this.getFrozenTensorIds(m),x={};for(;f.length>0;){let w=this.processStack(i,f,t,m,x,y,c,g,u);yield Promise.all(w)}d==null&&!o&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let b=l.filter(w=>!sm(w)&&!Wn(w.name,m,t)).map(w=>w.name);if(b.length>0){let w="";throw d!=null&&(w=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${h}]`),new Error(`Cannot compute the outputs [${b}] from the provided inputs [${s}]. Consider providing the following inputs: [${p}]. ${w}`)}return m})}processStack(e,t,n,o,s,i,a,c,l){let u=[];for(;t.length>0;){let p=t.pop();n.currentContext=p.contexts;let d="";if(p.node.op==="Enter"&&N("isConstant",p.node,o,n)&&([d]=Sl(p.node.name,n)),o[p.node.name]==null){let h=mV(p.node,o,n,this._resourceManager);d||([d]=Sl(p.node.name,n));let f=n.currentContext;C.isPromise(h)?u.push(h.then(m=>(o[d]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(m)),n.currentContext=f,this.checkTensorForDisposal(d,p.node,o,n,i,a,c),this.processChildNodes(p.node,t,n,o,s,l),m))):(o[d]=h,this.keepIntermediateTensors&&(this.clonedTensorsMap[d]=this.cloneTensorList(h)),this.checkTensorForDisposal(d,p.node,o,n,i,a,c),this.processChildNodes(p.node,t,n,o,s,l))}else this.processChildNodes(p.node,t,n,o,s,l)}return u}processChildNodes(e,t,n,o,s,i){e.children.forEach(a=>{let[c]=Sl(a.name,n);s[c]||!i.has(a.name)||(a.op==="Merge"?a.inputNames.some(l=>!!Wn(l,o,n))&&(s[c]=!0,t.push({contexts:n.currentContext,node:a})):a.inputNames.every(l=>!!Wn(l,o,n))&&(s[c]=!0,t.push({contexts:n.currentContext,node:a})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(t=>t.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(t=>{let n=e[t],[o]=Ns(t),s=this.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){let i=s.attrParams.shape.value,a=i.length===n.shape.length&&n.shape.every((c,l)=>i[l]===-1||i[l]===c);C.assert(a,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${i}], but was [${n.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&C.assert(n.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${n.dtype}`)})}mapInputs(e){var t,n;let o={};for(let s in e){let i=(n=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||n===void 0?void 0:n[s];i!=null?o[i.name]=e[s]:o[s]=e[s]}return o}checkInputs(e){let t=Object.keys(e).filter(n=>{let[o]=Ns(n);return this.graph.nodes[o]==null});if(t.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${t}] that are not part of graph`)}mapOutputs(e){return e.map(t=>{var n,o;let s=(o=(n=this._signature)===null||n===void 0?void 0:n.outputs)===null||o===void 0?void 0:o[t];return s!=null?s.name:t},{})}checkOutputs(e){e.forEach(t=>{let[n]=Ns(t);if(!this.graph.nodes[n])throw new Error(`The output '${t}' is not found in the graph`)})}};var QE=class{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(let e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(let e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}};var QFe="?tfjs-format=file",JFe="model.json",JE=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=_l){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new QE}findIOHandler(){let e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{let t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let e=this.handler.load();return C.isPromise(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){let t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}loadStreaming(e){return M(this,null,function*(){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let t=yield yk(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)})}loadWithWeightMap(e,t){this.artifacts=e;let n=this.artifacts.modelTopology,o=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let s=this.artifacts.userDefinedMetadata;s.signature!=null&&(o=s.signature),s.structuredOutputKeys!=null&&(this.structuredOutputKeys=s.structuredOutputKeys)}if(this.signature=o,this.version=`${n.versions.producer}.${n.versions.minConsumer}`,this.executor=new x_(g_.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){let s=g_.Instance.transformGraph(e.modelInitializer);this.initializer=new x_(s),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}save(e,t){return M(this,null,function*(){if(typeof e=="string"){let n=this.io.getSaveHandlers(e);if(n.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(n.length>1)throw new Error(`Found more than one (${n.length}) save handlers for URL '${e}'`);e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)})}addStructuredOutputNames(e){if(this.structuredOutputKeys){let t=e instanceof Ct?[e]:e,n={};return t.forEach((o,s)=>n[this.structuredOutputKeys[s]]=o),n}return e}predict(e,t){let n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}predictAsync(e,t){return M(this,null,function*(){let n=yield this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)})}normalizeInputs(e){var t;if(!(e instanceof Ct)&&!Array.isArray(e)){let s=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(s!=null)for(let i in s){let a=s[i];a.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[a.resourceId])}return e}e=Array.isArray(e)?e:[e];let n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let o=0;return this.inputNodes.reduce((s,i)=>{var a,c,l;let u=(l=(c=(a=this.signature)===null||a===void 0?void 0:a.inputs)===null||c===void 0?void 0:c[i])===null||l===void 0?void 0:l.resourceId;return u!=null?s[i]=this.resourceIdToCapturedInput[u]:s[i]=e[o++],s},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}executeInitializerGraphAsync(){return M(this,null,function*(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))})}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){let t=this.initializerSignature.outputs,n=Object.keys(t);for(let o=0;o<n.length;o++){let s=n[o],i=t[s];this.resourceIdToCapturedInput[i.resourceId]=e[o]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=this.executor.execute(e,t);return n.length>1?n:n[0]}executeAsync(e,t){return M(this,null,function*(){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(yield this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=yield this.executor.executeAsync(e,t);return n.length>1?n:n[0]})}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Xe(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};function im(n){return M(this,arguments,function*(r,e={},t=_l){if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=ePe(r));let o=new JE(r,e,t);return yield o.load(),o})}function ePe(r){return r.endsWith("/")||(r=r+"/"),`${r}${JFe}${QFe}`}var sa=Z();sa.registerFlag("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE",()=>15);sa.registerFlag("WEBGPU_CPU_FORWARD",()=>!0);sa.registerFlag("WEBGPU_MATMUL_PROGRAM_TYPE",()=>-1);sa.registerFlag("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE",()=>!0);sa.registerFlag("WEBGPU_USE_LOW_POWER_GPU",()=>!1);sa.registerFlag("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e3);sa.registerFlag("WEBGPU_USE_PROFILE_TOOL",()=>!1);sa.registerFlag("WEBGPU_IMPORT_EXTERNAL_TEXTURE",()=>!0);sa.registerFlag("WEBGPU_USE_NAIVE_CONV2D_DEBUG",()=>!1);sa.registerFlag("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL",()=>-1);sa.registerFlag("WEBGPU_CONV_SEPARATE_IM2COL_SHADER",()=>!1);sa.registerFlag("WEBGPU_PRINT_SHADER",()=>"");sa.registerFlag("WEBGPU_ENGINE_COMPILE_ONLY",()=>!1);var eN=class{constructor(e){e&&(this.vendor=e.vendor,this.architecture=e.architecture,this.intelGPUGeneration=this.getIntelGPUGeneration())}getIntelGPUGeneration(){if(this.isIntel()){if(this.architecture.startsWith("gen"))return Number(this.architecture.match(/\d+/));if(this.architecture.startsWith("xe"))return 12}return 0}isIntel(){return this.vendor==="intel"}};var tN=class{constructor(e){this.device=e,this.numUsedBuffers=0,this.numFreeBuffers=0,this.freeBuffers=new Map,this.usedBuffers=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireBuffer(e,t,n=!1,o=!0){let s,i=g7(e,t);return o?(this.freeBuffers.has(i)||this.freeBuffers.set(i,[]),this.freeBuffers.get(i).length>0?(s=this.freeBuffers.get(i).pop(),this.numFreeBuffers--):(s=this.device.createBuffer({size:e,usage:t,mappedAtCreation:n}),this.numBytesAllocated+=e)):(s=this.device.createBuffer({size:e,usage:t,mappedAtCreation:n}),this.numBytesAllocated+=e),this.usedBuffers.has(i)||this.usedBuffers.set(i,[]),this.usedBuffers.get(i).push(s),this.numUsedBuffers++,this.numBytesUsed+=e,s}releaseBuffer(e,t=!0){if(this.freeBuffers.size===0)return;let n=e.size,o=e.usage,s=g7(n,o),i=this.usedBuffers.get(s),a=i.indexOf(e);if(a<0)throw new Error("Cannot find the buffer in buffer manager");i[a]=i[i.length-1],i.pop(),this.numUsedBuffers--,this.numBytesUsed-=n,t?(this.freeBuffers.get(s).push(e),this.numFreeBuffers++):(e.destroy(),this.numBytesAllocated-=n)}getNumUsedBuffers(){return this.numUsedBuffers}getNumFreeBuffers(){return this.numFreeBuffers}dispose(){this.freeBuffers.forEach((e,t)=>{e.forEach(n=>{n.destroy()})}),this.usedBuffers.forEach((e,t)=>{e.forEach(n=>{n.destroy()})}),this.freeBuffers=new Map,this.usedBuffers=new Map,this.numUsedBuffers=0,this.numFreeBuffers=0,this.numBytesUsed=0,this.numBytesAllocated=0}};function g7(r,e){return`${r}_${e}`}var rN=class{constructor(e){this.device=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures=new Map,this.usedTextures=new Map,this.numBytesUsed=0,this.numBytesAllocated=0}acquireTexture(e,t,n,o){let s=x7(n),i=e*t*s,a=y7(e,t,n,o);if(this.freeTextures.has(a)||this.freeTextures.set(a,[]),this.usedTextures.has(a)||this.usedTextures.set(a,[]),this.numBytesUsed+=i,this.numUsedTextures++,this.freeTextures.get(a).length>0){this.numFreeTextures--;let l=this.freeTextures.get(a).shift();return this.usedTextures.get(a).push(l),l}this.numBytesAllocated+=i;let c=this.device.createTexture({size:[e,t],format:n,usage:o});return this.usedTextures.get(a).push(c),c}releaseTexture(e){if(this.freeTextures.size===0)return;let t=e.width,n=e.height,o=e.format,s=e.usage,i=y7(t,n,o,s);this.freeTextures.has(i)||this.freeTextures.set(i,[]),this.freeTextures.get(i).push(e),this.numFreeTextures++,this.numUsedTextures--;let a=this.usedTextures.get(i),c=a.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(c,1);let l=x7(o),u=t*n*l;this.numBytesUsed-=u}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){this.freeTextures.forEach((e,t)=>{e.forEach(n=>{n.destroy()})}),this.usedTextures.forEach((e,t)=>{e.forEach(n=>{n.destroy()})}),this.freeTextures=new Map,this.usedTextures=new Map,this.numUsedTextures=0,this.numFreeTextures=0,this.numBytesUsed=0,this.numBytesAllocated=0}};function y7(r,e,t,n){return`${r}_${e}_${t}_${n}`}function x7(r){if(r==="rgba8unorm")return 16;throw new Error(`${r} is not supported!`)}function v7(r,e){if(Math.max(...r)>5)throw new Error("Cannot symbolically compute strides for rank > 6 tensor.");let t=r.length,n="xyzwuv",o=r.map(i=>`${e}.${n[i]}`),s=new Array(t-1);s[t-2]=o[t-1];for(let i=t-3;i>=0;--i)s[i]=`(${s[i+1]} * ${o[i+1]})`;return s}var Mi=(r,e,t)=>t==="int32"?`atomicAdd(${r}, bitcast<i32>(${e}));`:`
          {
            var oldValue = 0;
            loop {
              let newValueF32 = bitcast<f32>(oldValue) + (${e});
              let newValue = bitcast<i32>(newValueF32);
              let res = atomicCompareExchangeWeak(${r}, oldValue, newValue);
              if res.exchanged {
                break;
              }
              oldValue = res.old_value;
            }
          }`;var cm=function(r){return r[r.FROM_PIXELS=0]="FROM_PIXELS",r[r.DRAW=1]="DRAW",r}(cm||{}),_7=(r,e,t,n,o)=>{let s={dtype:n.dtype,shape:n.shape},i=nPe(t,s,e),a=r.createShaderModule({code:i,label:e.constructor.name}),c=Z().get("WEBGPU_PRINT_SHADER");if(c!==""){c=c.toLowerCase();let l=c.split(",");(c==="all"||l.some(u=>e.shaderKey.toLowerCase().includes(u)))&&(console.group(e.shaderKey),console.debug(i),console.groupEnd())}return o?r.createComputePipelineAsync({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"}):r.createComputePipeline({compute:{module:a,entryPoint:"_start"},label:e.constructor.name,layout:"auto"})},Mt=(r,e="f32")=>{switch(r){case 1:return`${e}`;case 2:return`vec2<${e}>`;case 3:return`vec3<${e}>`;case 4:return`vec4<${e}>`;default:throw new Error(`${r}-component ${e} is not supported.`)}};function Jr(r){if(r<=1)return"i32";if(r===2)return"vec2<i32>";if(r===3)return"vec3<i32>";if(r===4)return"vec4<i32>";if(r===5)return"vec5";if(r===6)return"vec6";throw Error(`GPU for rank ${r} is not yet supported`)}function Ua(r){if(r===0)return"x";if(r===1)return"y";if(r===2)return"z";if(r===3)return"w";if(r===4)return"u";if(r===5)return"v";throw Error(`Index ${r} is not yet supported`)}function ue(...r){let e;switch(r.length){case 0:e=`
        fn main()
      `;break;case 1:e=`
        fn main(${r[0]} : i32)
      `;break;default:throw Error("Unreachable")}return e}function b7(r,e){let t;return t=`
     ${rPe(e)}
      fn _start(@builtin(local_invocation_id) LocalId : vec3<u32>,
                @builtin(global_invocation_id) GlobalId : vec3<u32>,
                @builtin(local_invocation_index) LocalIndex: u32,
                @builtin(workgroup_id) WorkgroupId : vec3<u32>,
                @builtin(num_workgroups) NumWorkgroups : vec3<u32>) {
        localId = LocalId;
        localIndex = LocalIndex;
        globalId = GlobalId;
        numWorkgroups = NumWorkgroups;
        workgroupId = WorkgroupId;
        ${r?"main(getGlobalIndex());":"main();"};
      }
    `,t}function rPe(r){return`
  @compute @workgroup_size(${r.workgroupSize[0]}, ${r.workgroupSize[1]}, ${r.workgroupSize[2]})
`}function nPe(r,e,t){let n=[],o=t.workgroupSize[0]*t.workgroupSize[1]*t.workgroupSize[2];if(t.outputComponent=t.outputComponent?t.outputComponent:1,n.push(`

      var<private> localId: vec3<u32>;
      var<private> localIndex: u32;
      var<private> globalId: vec3<u32>;
      var<private> numWorkgroups: vec3<u32>;
      var<private> workgroupId: vec3<u32>;

      // Only used when the y/z dimension of workgroup size is 1.
      fn getGlobalIndex() -> i32 {
        ${I7(t)?"  return i32(globalId.x);":`  return i32((workgroupId.z * numWorkgroups.x * numWorkgroups.y +
                workgroupId.y * numWorkgroups.x + workgroupId.x) * ${o}u +
                localIndex);
        `}
      }
    `),t.pixelsOpType!=null){let f=t.pixelsOpType===cm.FROM_PIXELS?`@group(0) @binding(0) var<storage, read_write> result: array<${am(e.dtype,t.outputComponent)}>;`:`@group(0) @binding(1) var<storage, read> inBuf : array<${am(r[0].dtype,t.outputComponent)}>;`,m=e.shape.length===3?"vec2<i32>":"i32";n.push(`
        struct Uniform {
          outShapeStrides : ${m},
          size            : i32,
          numChannels     : i32,
          alpha           : f32,
        };

        ${f}
        @group(0) @binding(2) var<uniform> uniforms: Uniform;
      `);let g=C7(t);return[w7,n.join(`
`),v_(e.shape),t.getUserCode(),b7(g,t)].join(`
`)}let s,i,a="struct Uniforms { NAN : f32, INFINITY : f32, ";t.variableNames.forEach((f,m)=>{let g=Jr(r[m].shape.length);a+=`${f.charAt(0).toLowerCase()+f.slice(1)}Shape : ${g}, `,s=r[m].shape.length-1,i=Jr(s),a+=`${f.charAt(0).toLowerCase()+f.slice(1)}ShapeStrides: ${i}, `});let c=Jr(e.shape.length);a+=`outShape : ${c}, `,s=e.shape.length-1,i=Jr(s),a+=`
         outShapeStrides: ${i}, `,t.size&&(a+="size : i32, "),t.uniforms&&(a+=t.uniforms),a+="};",a=pPe(a),n.push(a),t.atomic?n.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<atomic<i32>>;
    `):n.push(`
      @group(0) @binding(0) var<storage, read_write> result: array<${am(e.dtype,t.outputComponent)}>;
    `),t.variableNames.forEach((f,m)=>{n.push(`
      @group(0) @binding(${1+m}) var<storage, read> ${f}: array<${t.variableComponents?am(r[m].dtype,t.variableComponents[m]):am(r[m].dtype,t.outputComponent)}>;
        `)}),a!==""&&n.push(`
      @group(0) @binding(${1+t.variableNames.length}) var<uniform> uniforms: Uniforms;
      `);let l=cPe(e.shape,t.dispatchLayout),u=[w7,n.join(`
`)+oPe,v_(e.shape),l,lPe(e.shape.length)];t.atomic||u.push(uPe(e.shape,e.dtype,t.outputComponent)),t.variableNames.forEach((f,m)=>{u.push(`${v_(r[m].shape,f)}`)});let p=r.map((f,m)=>aPe(f,e.shape,t.variableComponents?t.variableComponents[m]:t.outputComponent,t.dispatchLayout.x.length===e.shape.length)).join(`
`);u.push(p),u.push(t.getUserCode());let d=C7(t);return u.push(b7(d,t)),u.join(`
`)}function S7(r,e,t){let n=r.shaderKey;if(r.pixelsOpType!=null)return n;let o=[],s=[];e.forEach(u=>{o.push(u.shape),s.push(u.dtype)}),o.push(t.shape),s.push(t.dtype);let i=e.map(u=>E.getBroadcastDims(u.shape,t.shape)),a=e.map(u=>C.arraysEqual(u.shape,t.shape)).join("_"),c=i.map(u=>u.join("_")).join(";"),l=I7(r)?"flatDispatch":"";return n+="_"+(r.workgroupSize?r.workgroupSize.join(","):"")+o.map(u=>u.length).join(",")+s.join(",")+r.variableNames.join(",")+c+a+l,n}var w7=`
  struct vec5 {x: i32, y: i32, z: i32, w: i32, u: i32};
  struct vec6 {x: i32, y: i32, z: i32, w: i32, u: i32, v: i32};

  // Checks whether coordinates lie within the bounds of the shape.
  fn coordsInBounds2D(coord : vec2<i32>, shape : vec2<i32>) -> bool {
    return all(coord >= vec2<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds3D(coord : vec3<i32>, shape : vec3<i32>) -> bool {
    return all(coord >= vec3<i32>(0)) && all(coord < shape);
  }
  fn coordsInBounds4D(coord : vec4<i32>, shape : vec4<i32>) -> bool {
    return all(coord >= vec4<i32>(0)) && all(coord < shape);
  }

  fn getIndexFromCoords1D(coord : i32, shape : i32) -> i32 {
    return coord;
  }
  fn getIndexFromCoords2D(coords : vec2<i32>, shape : vec2<i32>) -> i32 {
    return dot(coords, vec2<i32>(shape.y, 1));
  }
  fn getIndexFromCoords3D(coords : vec3<i32>, shape : vec3<i32>) -> i32 {
    return dot(coords, vec3<i32>(shape.y * shape.z, shape.z, 1));
  }
  fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
    return dot(coords, vec4<i32>(
        shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
  }
  fn getIndexFromCoords5D(coords : vec5, shape : vec5) -> i32 {
    let shapeStrides: vec5 = vec5(shape.y * shape.z * shape.w * shape.u, shape.z * shape.w * shape.u, shape.w * shape.u, shape.u, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u;
  }
  fn getIndexFromCoords6D(coords : vec6, shape : vec6) -> i32 {
    let shapeStrides: vec6 = vec6(shape.y * shape.z * shape.w * shape.u * shape.v, shape.z * shape.w * shape.u * shape.v, shape.w * shape.u * shape.v, shape.u * shape.v, shape.v, 1);
    return coords.x*shapeStrides.x + coords.y*shapeStrides.y + coords.z*shapeStrides.z + coords.w*shapeStrides.w + coords.u*shapeStrides.u + coords.v*shapeStrides.v;
  }

  // NaN defination in IEEE 754-1985 is :
  //   - sign = either 0 or 1.
  //   - biased exponent = all 1 bits.
  //   - fraction = anything except all 0 bits (since all 0 bits represents infinity).
  // https://en.wikipedia.org/wiki/IEEE_754-1985#Representation_of_non-numbers
  fn isnan(val: f32) -> bool {
    let floatToUint: u32 = bitcast<u32>(val);
    return (floatToUint & 0x7fffffffu) > 0x7f800000u;
  }
  fn isnanVec4(val : vec4<f32>) -> vec4<bool> {
    let floatToUint: vec4<u32> = bitcast<vec4<u32>>(val);
    return (floatToUint & vec4<u32>(0x7fffffffu)) > vec4<u32>(0x7f800000u);
  }
`,oPe=`
  fn isinf(val: f32) -> bool {
    return abs(val) == uniforms.INFINITY;
  }
`;function v_(r,e=""){let t=r.length,n=e!==""?`get${e.charAt(0).toUpperCase()+e.slice(1)}CoordsFromIndex`:"getCoordsFromIndex",o=e!==""?`${e.charAt(0).toLowerCase()+e.slice(1)}ShapeStrides`:"outShapeStrides";if(t<=1)return`fn ${n}(index : i32) -> i32 { return index; }`;let s=C.computeStrides(r),i=Jr(t),a=[];for(let l=0;l<t;l++)a.push(`d${l}`);if(s.length===1)return`    fn ${n}(index : i32) -> vec2<i32> {
      let d0 = index / uniforms.${o}; let d1 = index - d0 * uniforms.${o};
      return vec2<i32>(d0, d1);
    }`;let c;return c="var index2 = index;"+s.map((l,u)=>{let p=`let ${a[u]} = index2 / uniforms.${o}.${Ua(u)}`,d=u===s.length-1?`let ${a[u+1]} = index2 - ${a[u]} * uniforms.${o}.${Ua(u)}`:`index2 = index2 - ${a[u]} * uniforms.${o}.${Ua(u)}`;return`${p}; ${d};`}).join(""),`
    fn ${n}(index : i32) -> ${i} {
      ${c}
      return ${i}(${a.join(",")});
    }
  `}function sPe(r,e){let t=r.name,n=r.shape.length,o=Jr(n),s="get"+t.charAt(0).toUpperCase()+t.slice(1),i=["d0","d1","d2","d3","d4","d5"].slice(0,n),a=i.map(u=>`${u} : i32`).join(", ");if(n<1)return`
      fn ${s}() -> ${Mt(e)} {
        return ${Mt(e)}(${t}[0]);
      }
    `;let c=`uniforms.${t.charAt(0).toLowerCase()+t.slice(1)}Shape`,l=`${n}D`;return n===0&&(l="1D"),`
    fn ${s}(${a}) -> ${Mt(e)} {
      return ${Mt(e)}(${t}[getIndexFromCoords${l}(${o}(${i.join(",")}),
        ${c})${e===1?"":` / ${e}`}]);
    }
   `}function iPe(r,e,t,n){let o=r.name,s=o.charAt(0).toUpperCase()+o.slice(1),i="get"+s+"ByOutput",a=r.shape.length,c=e.length,l=Jr(c);if(C.arraysEqual(r.shape,e)&&n)return`
    fn ${i}Index(globalIndex : i32) -> ${Mt(t)} {
      return ${Mt(t)}(${o}[globalIndex]);
    }

    fn ${i}Coords(coords : ${l}) -> ${Mt(t)} {
      return ${Mt(t)}(${o}[${c>1?"getOutputIndexFromCoords(coords)":"coords"}${t===1?"":` / ${t}`}]);
    }
    `;let u=E.getBroadcastDims(r.shape,e),p=c-a,d="";if(a===0)return`
    fn ${i}Index(globalIndex : i32) -> ${Mt(t)}{
      return get${s}();
    }

    fn ${i}Coords(coords : ${l}) -> ${Mt(t)}{
      return get${s}();
    }
  `;c<2&&u.length>=1?d="coords = 0;":d=u.map(g=>`coords.${Ua(g+p)} = 0;`).join(`
`);let h="";if(c<2&&a>0)h="coords";else if(c>1){let g=Jr(a),y=r.shape.map((x,b)=>`coords.${Ua(b+p)}`).join(", ");h=`${g}(${y})`}else h="coords";let f=`uniforms.${o.charAt(0).toLowerCase()+o.slice(1)}Shape`,m=`${a}D`;return`
  fn ${i}Index(globalIndex : i32) -> ${Mt(t)} {
    var coords = getCoordsFromIndex(globalIndex);
    ${d}
    return ${Mt(t)}(${o}[getIndexFromCoords${m}(${h}, ${f})${t===1?"":` / ${t}`}]);
  }

  fn ${i}Coords(coordsIn : ${l}) -> ${Mt(t)} {
    var coords = coordsIn;
    ${d}
    return ${Mt(t)}(${o}[getIndexFromCoords${m}(${h}, ${f})${t===1?"":` / ${t}`}]);
  }
`}function aPe(r,e,t,n){let o=sPe(r,t);return r.shape.length<=e.length&&(o+=iPe(r,e,t,n)),o}function cPe(r,e){let{x:t,y:n=[],z:o=[]}=e,s=r.length,i=t.length+n.length+o.length;if(i!==s)return"";if(t.length===s)return`fn getOutputCoords() -> ${Jr(s)}{
    let globalIndex = getGlobalIndex();
    return getCoordsFromIndex(globalIndex);
  }
  `;let a="",c=[t,n,o];for(let d=0;d<c.length;d++){let h=c[d];if(h.length!==0)if(h.length===1)a+=`let d${h[0]} = i32(globalId[${d}]);`;else{let f=v7(h,"uniforms.outShape");a+=`var index${d} = i32(globalId[${d}]);`;for(let m=0;m<f.length;m++)a+=`let d${h[m]} = index${d} / ${f[m]};`,m===f.length-1?a+=`let d${h[m+1]} = index${d} - d${h[m]} * ${f[m]};`:a+=`index${d} = index${d} - d${h[m]} * ${f[m]};`}}let l=[];for(let d=0;d<i;d++)l.push(`d${d}`);let u=Jr(i),p=`fn getOutputCoords() -> ${u} {
  ${a}
`;return l.length===0?p+=`return ${u}(0); }`:p+=`return ${u}(${l.join(",")}); }`,p}function lPe(r){let e="";switch(r){case 0:case 1:e+=`
        fn getOutputIndexFromCoords(coords : i32) -> i32 {
          return coords;
        }
        `;break;case 2:e+=`
        fn getOutputIndexFromCoords(coords : vec2<i32>) -> i32 {
          return dot(coords, vec2<i32>(uniforms.outShapeStrides, 1));
        }
        `;break;case 3:e+=`
        fn getOutputIndexFromCoords(coords : vec3<i32>) -> i32 {
          return dot(coords, vec3<i32>(uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, 1));
        }
        `;break;case 4:e+=`
        fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
          return dot(coords, vec4<i32>(
            uniforms.outShapeStrides.x, uniforms.outShapeStrides.y, uniforms.outShapeStrides.z, 1));
        }
        `;break;case 5:e+=`
        fn getOutputIndexFromCoords(coords : vec5) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u;
        }
        `;break;case 6:e+=`
        fn getOutputIndexFromCoords(coords : vec6) -> i32 {
          return coords.x * uniforms.outShapeStrides.x +
              coords.y * uniforms.outShapeStrides.y +
              coords.z * uniforms.outShapeStrides.z +
              coords.w * uniforms.outShapeStrides.w +
              coords.u * uniforms.outShapeStrides.u +
              coords.v;
        }
        `;break;default:C.assert(!1,()=>`Unsupported ${r}D shape`);break}return e}function I7(r){return r.dispatch[1]===1&&r.dispatch[2]===1}function am(r,e=1){if(r==="float32")return Mt(e,"f32");if(r==="int32"||r==="bool")return Mt(e,"i32");throw new Error(`type ${r} is not supported.`)}function uPe(r,e,t){let n=r.length,o=am(e,t),s=`fn setOutputAtIndex(flatIndex : i32, value : ${Mt(t)}) {
      result[flatIndex] = ${o}(value);
    }

    fn setOutputAtIndexI32(flatIndex : i32, value : ${Mt(t,"i32")}) {
      result[flatIndex] = ${o}(value);
    }
    `;if(n>=2){let i=["d0","d1","d2","d3","d4","d5"].slice(0,n),a=Jr(n);s+=`
      fn setOutputAtCoords(${i.map(c=>`${c} : i32`).join(", ")}, value : ${Mt(t)}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${i.join(", ")}));
        setOutputAtIndex(flatIndex${t===1?"":` / ${t}`}, value);
      }
      fn setOutputAtCoordsI32(${i.map(c=>`${c} : i32`).join(", ")}, value : ${Mt(t,"i32")}) {
        let flatIndex = getOutputIndexFromCoords(${a}(${i.join(", ")}));
        setOutputAtIndexI32(flatIndex${t===1?"":` / ${t}`}, value);
      }
    `}return s}function pPe(r){let e=/(\w+)\s*:\s*vec(5|6)/g;r=r.replace(e,n=>"@align(16) "+n);let t=/vec(5|6)\s*,\s*(\w+)/g;return r=r.replace(t,(n,o,s)=>`vec${o}, @align(16) ${s}`),r}function C7(r){return!(r.dispatchLayout.hasOwnProperty("y")&&r.dispatchLayout.y.length!==0||r.dispatchLayout.hasOwnProperty("z")&&r.dispatchLayout.z.length!==0)}var lm={};Nr(lm,{GPUBytesPerElement:()=>nN,MatMulProgramType:()=>Tl,assertNotComplex:()=>__,computeDispatch:()=>pe,computeWorkPerThreadForConv2d:()=>w_,computeWorkgroupInfoForMatMul:()=>yV,computeWorkgroupSizeForConv2d:()=>b_,flatDispatchLayout:()=>me,isWebGPUSupported:()=>C_,tilesFitEvenlyIntoShape:()=>hPe});var uy=r=>{let e=1;for(let t=0;t<r.length;t++)e*=r[t];return e};function hPe(r,e){if(r.length!==e.length)throw new Error(`Cannot compute whether rank ${r.length} tiles fit evenly into rank ${e.length} shape - ranks must match.`);return e.every((t,n)=>t%r[n]===0)}function pe(r,e,t=[1,1,1],n=[1,1,1]){let[o,s,i]=[Math.ceil(uy(r.x.map(a=>e[a]))/(t[0]*n[0])),r.y?Math.ceil(uy(r.y.map(a=>e[a]))/(t[1]*n[1])):1,r.z?Math.ceil(uy(r.z.map(a=>e[a]))/(t[2]*n[2])):1];return[o,s,i]}function yV(r,e,t,n=!1){let o=[8,8,1],s=[4,4,1];return n||(r<=8&&(s[1]=1),e<=16&&t<=16&&(o[0]=4)),{workgroupSize:o,elementsPerThread:s}}function b_(r,e,t=!1){if(t)return[8,8,1];let n=uy(r.x.map(s=>e[s])),o=uy(r.y.map(s=>e[s]));return n<=4?[4,16,1]:o<=4?[16,4,1]:[16,16,1]}function w_(r,e,t=!1){if(t)return[4,4,1];let n=uy(r.x.map(s=>e[s])),o=uy(r.y.map(s=>e[s]));return n<=4?[1,2,1]:o<=4?[2,1,1]:[2,2,1]}function me(r){return{x:r.map((e,t)=>t)}}function nN(r){if(r==="float32"||r==="int32"||r==="bool"||r==="string")return 4;if(r==="complex64")return 8;throw new Error(`Unknown dtype ${r}`)}function C_(){return!!(typeof globalThis<"u"&&globalThis.navigator&&globalThis.navigator.gpu)}function __(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>{t!=null&&C.assert(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGPU backend.`)})}var Tl=function(r){return r[r.MatMulReduceProgram=0]="MatMulReduceProgram",r[r.MatMulSplitKProgram=1]="MatMulSplitKProgram",r[r.MatMulSmallOutputSizeProgram=2]="MatMulSmallOutputSizeProgram",r[r.MatMulPackedProgram=3]="MatMulPackedProgram",r[r.MatMulMax=4]="MatMulMax",r}(Tl||{});var fPe=Z().getNumber("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD"),mPe=(r,e)=>{let t=r.limits.maxComputeWorkgroupsPerDimension,n=e.dispatchLayout,o=e.dispatch;if(o.every(i=>i<=t))return o;C.assert(o[0]>t&&n.y===void 0&&n.z===void 0,()=>"Dispatch size exceeds WebGPU limits in Y or Z dimension.");let s=Math.ceil(Math.sqrt(o[0]));return s>t?(s=Math.ceil(Math.cbrt(o[0])),C.assert(s<=t,()=>"Total dispatch size exceeds WebGPU maximum."),[s,s,s]):[s,s,1]},wb=(()=>{class r extends Sc{nextDataId(){return r.nextDataId++}constructor(t,n){if(super(),this.commandQueueOwnedIds=new WeakSet,this.dispatchCountInPass=0,this.disposed=!1,this.downloadWaitMs=0,this.tensorDataPendingDisposal=[],this.queryResolveBuffer=null,this.querySet=null,this.querySetCount=2,this.stagingPendingDisposal=[],this.uniformPendingDisposal=[],this.uploadWaitMs=0,this.hasReadSyncWarned=!1,this.hasTimestampQueryWarned=!1,!C_())throw new Error("WebGPU is not supported on this device");this.pipelineCache={},this.device=t,this.queue=t.queue,this.commandEncoder=null,this.computePassEncoder=null,this.adapterInfo=new eN(n),this.supportTimestampQuery=this.device.features.has("timestamp-query"),this.thresholdToIncreaseWorkgroups=this.adapterInfo.intelGPUGeneration>=12?16:8,this.bufferManager=new tN(this.device),this.textureManager=new rN(this.device),this.tensorMap=new dd(this,_o()),Z().getBool("WEBGPU_USE_PROFILE_TOOL")&&(this.dummyCanvas=document.createElement("canvas"),this.dummyCanvas.width=1,this.dummyCanvas.height=1,this.dummyContext=this.dummyCanvas.getContext("webgpu"),this.dummyContext.configure({device:t,format:"bgra8unorm"}),document.body.appendChild(this.dummyCanvas))}floatPrecision(){return 32}disposeData(t,n=!1){if(!this.tensorMap.has(t))return!0;let o=this.tensorMap.get(t);return n?o.refCount=0:o.refCount--,o.refCount>0?!1:(o.complexTensorInfos!=null&&(this.disposeData(o.complexTensorInfos.real.dataId),this.disposeData(o.complexTensorInfos.imag.dataId)),this.commandQueueOwnedIds.has(t)?(this.tensorDataPendingDisposal.push(t),!0):(this.releaseResource(t),this.tensorMap.delete(t),!0))}memory(){return{numBytesInGPU:this.bufferManager.numBytesUsed,numBytesAllocatedInGPU:this.bufferManager.numBytesAllocated,unreliable:!1}}releaseResource(t){let n=this.tensorMap.get(t);if(!(!n||!n.resource)){if(n.external){n.resource=null;return}n.resource instanceof GPUBuffer?this.bufferManager.releaseBuffer(n.resource):n.resource instanceof GPUTexture&&this.textureManager.releaseTexture(n.resource),n.resource=null}}refCount(t){return this.tensorMap.has(t)?this.tensorMap.get(t).refCount:0}incRef(t){let n=this.tensorMap.get(t);n.refCount++}decRef(t){if(this.tensorMap.has(t)){let n=this.tensorMap.get(t);n.refCount--}}write(t,n,o){if(o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let s={id:this.nextDataId()};return this.tensorMap.set(s,{dtype:o,shape:n,values:t,refCount:1}),s}move(t,n,o,s,i){if(s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.tensorMap.set(t,{dtype:s,shape:o,values:n,refCount:i})}submitQueue(){this.queue.submit([this.commandEncoder.finish()]),this.commandEncoder=null,this.dispatchCountInPass=0,this.commandQueueOwnedIds=new WeakSet,this.tensorDataPendingDisposal.forEach(t=>{this.releaseResource(t),this.tensorMap.delete(t)}),this.uniformPendingDisposal.forEach(t=>this.bufferManager.releaseBuffer(t)),this.stagingPendingDisposal.forEach(t=>this.bufferManager.releaseBuffer(t,!1)),this.tensorDataPendingDisposal=[],this.uniformPendingDisposal=[],this.stagingPendingDisposal=[]}ensureCommandEncoderReady(){this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder())}endComputePassEncoder(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}checkCompileCompletionAsync(){return M(this,null,function*(){let t;try{t=yield Promise.all(Object.values(this.pipelineCache))}catch(n){throw new Error(n.message)}Object.keys(this.pipelineCache).map((n,o)=>{this.pipelineCache[n]=t[o]})})}getBufferData(t){return M(this,null,function*(){if(Z().getBool("WEBGPU_ENGINE_COMPILE_ONLY"))return console.warn("The data may be invalid since WEBGPU_ENGINE_COMPILE_ONLY is true, this can only be called when WEBGPU_ENGINE_COMPILE_ONLY is false"),null;let n=t.size,o=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(t,0,o,0,n),this.submitQueue(),yield o.mapAsync(GPUMapMode.READ);let s=o.getMappedRange().slice(0);return o.unmap(),o!=null&&this.bufferManager.releaseBuffer(o),Z().getBool("WEBGPU_USE_PROFILE_TOOL")&&(C.assert(this.dummyContext!==void 0,()=>"Fail to get context for profiling tool"),this.dummyContext.getCurrentTexture()),s})}convertAndCacheOnCPU(t,n){let o=this.tensorMap.get(t);return o.values=n,o.values}readSync(t){let n=this.tensorMap.get(t),{values:o,complexTensorInfos:s}=n;if(o!=null||n.dtype==="string")return o;if(n.dtype==="complex64"){let g=this.readSync(s.real.dataId),y=this.readSync(s.imag.dataId),x=C.convertBackendValuesAndArrayBuffer(E.mergeRealAndImagArrays(g,y).buffer,"float32");return this.convertAndCacheOnCPU(t,x),x}this.hasReadSyncWarned||(this.hasReadSyncWarned=!0,console.warn("The performance of synchronously reading data from GPU to CPU is poor on the webgpu backend, please use asynchronous APIs instead."));let i=["opaque","premultiplied"],a=n.resource,c=a.size;C.assert(c%4===0,()=>"Because there is 4 bytes for one pixel, buffer size must be multiple of 4.");let l=c/4,u=new ArrayBuffer(c),p=256,d=256,h=i.map(g=>new OffscreenCanvas(p,d)),f=new OffscreenCanvas(p,d);this.endComputePassEncoder(),h.map((g,y)=>{let x=g.getContext("webgpu");return x.configure({device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.COPY_DST,alphaMode:i[y]}),x.getCurrentTexture()}).map((g,y)=>{let x=p*4,b=(R,L,B)=>{this.ensureCommandEncoderReady(),this.commandEncoder.copyBufferToTexture({buffer:a,bytesPerRow:x,offset:B},{texture:g},{width:R,height:L}),this.submitQueue();let z=f.getContext("2d",{willReadFrequently:!0});z.clearRect(0,0,R,L),z.drawImage(h[y],0,0);let q=z.getImageData(0,0,R,L).data,U=i[y],G=new Uint8ClampedArray(u,B,R*L*4);for(let j=0;j<G.length;j+=4)if(U==="premultiplied")G[j+3]=q[j+3];else{let X=q[j];G[j]=q[j+2],G[j+1]=q[j+1],G[j+2]=X}},w=Math.floor(l/(p*d)),_=p,I=d,S=0;for(let R=0;R<w;R++)b(_,I,S),S+=p*d*4;let k=l%(p*d);I=Math.floor(k/p),I>0&&(b(_,I,S),S+=I*(p*4)),_=k%p,_>0&&b(_,1,S)});let m=C.convertBackendValuesAndArrayBuffer(u,n.dtype);return this.convertAndCacheOnCPU(t,m),m}read(t){return M(this,null,function*(){if(!this.tensorMap.has(t))throw new Error(`Tensor ${t} was not registered!`);let n=this.tensorMap.get(t),{values:o}=n;if(o!=null)return o;let s;if(n.dtype==="complex64"){let i=yield Promise.all([this.read(n.complexTensorInfos.real.dataId),this.read(n.complexTensorInfos.imag.dataId)]),a=i[0],c=i[1];s=E.mergeRealAndImagArrays(a,c)}else{let i=yield this.getBufferData(n.resource);s=C.convertBackendValuesAndArrayBuffer(i,n.dtype)}return this.convertAndCacheOnCPU(t,s),s})}copyBuffer(t){let n=t.size,o=t.usage,s=this.bufferManager.acquireBuffer(n,o);return this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(t,0,s,0,n),this.submitQueue(),s}createTensorFromGPUData(t,n,o){let s=t.buffer;if(o==="complex64")throw new Error("Cannot write to a complex64 dtype. ");let i={id:this.nextDataId()};this.tensorMap.set(i,{dtype:o,shape:n,values:null,refCount:1,external:t.zeroCopy});let a=this.tensorMap.get(i),c=nN(a.dtype)*C.sizeFromShape(a.shape);if(t.buffer.size<c)throw new Error(`GPUBuffer size(${t.buffer.size}) is smaller than tensor size(${c})!`);if((t.buffer.usage&(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))!==(GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC))throw new Error("GPUBuffer.usage should include GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC!");return t.zeroCopy!==!0&&(s=this.copyBuffer(s)),a.resource=s,_o().makeTensorFromDataId(i,n,o,this)}readToGPU(t){let n=this.tensorMap.get(t),{values:o,dtype:s,shape:i,resource:a}=n;if(s==="complex64")throw new Error("Does not support reading buffer for complex64 dtype.");if(a==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let c=a,l=c.size,u=c.usage,p=this.bufferManager.acquireBuffer(l,u);this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(a,0,p,0,l),this.submitQueue();let d=this.makeTensorInfo(i,s),h=_o().makeTensorFromTensorInfo(d),f=this.tensorMap.get(d.dataId);return f.resource=p,{tensorRef:h,buffer:p}}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let o=n.map(s=>C.decodeString(s));return ze(t.shape,t.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(t.shape,t.dtype,n)}time(t){return M(this,null,function*(){!this.supportTimestampQuery&&!this.hasTimestampQueryWarned&&(console.warn("This device doesn't support timestamp-query extension. Start Chrome browser with flag --enable-dawn-features=allow_unsafe_apis to try it again. Otherwise, zero will be shown for the kernel time when profiling mode is enabled."),this.hasTimestampQueryWarned=!0);let n=this.activeTimers,o=[],s=!1;this.programTimersStack==null?(this.programTimersStack=o,s=!0):this.activeTimers.push(o),this.activeTimers=o,t();let i=C.flatten(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),a=C.flatten(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,s&&(this.programTimersStack=null);let c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},l=yield Promise.all(i);return c.kernelMs=C.sum(l),c.getExtraProfileInfo=()=>l.map((u,p)=>({name:a[p],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", "),this.uploadWaitMs=0,this.downloadWaitMs=0,c})}makeTensorInfo(t,n,o){return n==="string"&&o!=null&&o.length>0&&C.isString(o[0])&&(o=o.map(i=>C.encodeString(i))),{dataId:this.write(o,t,n),shape:t,dtype:n}}tensorToBinding(t){if(!t)return null;let o=this.tensorMap.get(t.dataId).resource;return o instanceof GPUBuffer?{buffer:o}:o instanceof GPUTexture?o.createView():o}uploadToGPU(t){let n=this.tensorMap.get(t);if(n.resource!=null)return;let o=nN(n.dtype)*C.sizeFromShape(n.shape),s,i=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;if(n.values){if(s=this.bufferManager.acquireBuffer(o,i,!0),s.mapState==="unmapped"){let a=this.bufferManager.acquireBuffer(o,GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC,!0,!1),c=a.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(c).set(n.values):new Float32Array(c).set(n.values),a.unmap(),this.ensureCommandEncoderReady(),this.endComputePassEncoder(),this.commandEncoder.copyBufferToBuffer(a,0,s,0,o),this.stagingPendingDisposal.push(a)}else{let a=s.getMappedRange();n.dtype==="int32"||n.dtype==="bool"?new Int32Array(a).set(n.values):new Float32Array(a).set(n.values),s.unmap()}n.values=null}else s=this.bufferManager.acquireBuffer(o,i);n.resource=s}makeUniforms(t){let n=0,o=0,s=[],i=1;t.forEach(l=>{l.data.length===0&&(l.data=[1]);let u;switch(l.data.length){case 1:u=4;break;case 2:u=8;break;case 3:u=16;break;case 4:u=16;break;case 5:u=16;break;case 6:u=16;break;default:C.assert(!1,()=>`Unsupported ${l.data.length}D shape`)}(o===5||o===6)&&(u=16),u>i&&(i=u),n=Math.ceil(n/u)*u,o=l.data.length,s.push(n),n+=l.data.length*4}),n=Math.ceil(n/i)*i;let a=new ArrayBuffer(n);t.forEach((l,u)=>{let p=s[u];l.type==="int32"?new Int32Array(a,p,l.data.length).set(l.data):l.type==="uint32"?new Uint32Array(a,p,l.data.length).set(l.data):new Float32Array(a,p,l.data.length).set(l.data)});let c=this.bufferManager.acquireBuffer(n,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);return this.queue.writeBuffer(c,0,a,0,n),this.uniformPendingDisposal.push(c),{offset:0,size:n,buffer:c}}runWebGPUProgram(t,n,o,s,i){if(i||(i=this.makeTensorInfo(t.outputShape,o)),C.sizeFromShape(i.shape)===0)return this.tensorMap.get(i.dataId).values=C.getTypedArrayFromDType(i.dtype,0),i;this.uploadToGPU(i.dataId),t.dispatch=mPe(this.device,t);let a=n.map((l,u)=>{if(l.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");return this.uploadToGPU(l.dataId),{dtype:this.tensorMap.get(l.dataId).dtype,shape:l.shape,name:t.variableNames[u]}});t.shaderKey=S7(t,a,i);let c=Z().getBool("WEBGPU_ENGINE_COMPILE_ONLY");return t.shaderKey in this.pipelineCache||(this.pipelineCache[t.shaderKey]=_7(this.device,t,a,i,c)),t.pipeline=this.pipelineCache[t.shaderKey],c||this.recordAndSubmit(t,i,n,s),i}recordAndSubmit(t,n,o,s){if(t.pipeline instanceof Promise)throw new Error("Please call checkCompileCompletionAsync to ensure parallel compilation is done!");let i=[],a=[],c="int32";if(t.pixelsOpType==null){i.push({type:"float32",data:[NaN]},{type:"float32",data:[1/0]}),a=o.concat(n).map(f=>f.shape);let h="int32";a.map(f=>{i.push({type:h,data:f});let m=C.computeStrides(f);i.push({type:h,data:m})})}else{let h=C.computeStrides(n.shape);i.push({type:c,data:h})}if(t.size){let h=C.sizeFromShape(t.outputShape);i.push({type:c,data:[t.outputComponent?h/t.outputComponent:h]})}s&&(i=[...i,...s]);let l=[this.tensorToBinding(n),...o.map(h=>this.tensorToBinding(h)),this.makeUniforms(i)];o.forEach(h=>{this.commandQueueOwnedIds.add(h.dataId)}),this.commandQueueOwnedIds.add(n.dataId);let u=this.device.createBindGroup({layout:t.pipeline.getBindGroupLayout(0),entries:l.map((h,f)=>({binding:f,resource:h}))}),p=this.activeTimers!=null;this.ensureCommandEncoderReady();let d={};p&&this.supportTimestampQuery?(this.endComputePassEncoder(),this.querySet==null&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.querySetCount})),d.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1},this.computePassEncoder=this.commandEncoder.beginComputePass(d)):this.computePassEncoder||(this.computePassEncoder=this.commandEncoder.beginComputePass(d)),this.computePassEncoder.setPipeline(t.pipeline),this.computePassEncoder.setBindGroup(0,u),this.computePassEncoder.dispatchWorkgroups(t.dispatch[0],t.dispatch[1],t.dispatch[2]),this.dispatchCountInPass++,(p||Z().get("WEBGPU_DEFERRED_SUBMIT_BATCH_SIZE")<=this.dispatchCountInPass||t.pixelsOpType===cm.DRAW)&&(this.endComputePassEncoder(),p?this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime()}):this.submitQueue())}getQueryTime(){return M(this,null,function*(){if(!this.supportTimestampQuery)return 0;this.queryResolveBuffer==null&&(this.queryResolveBuffer=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST|GPUBufferUsage.QUERY_RESOLVE)),this.commandEncoder.resolveQuerySet(this.querySet,0,this.querySetCount,this.queryResolveBuffer,0);let t=this.bufferManager.acquireBuffer(this.querySetCount*8,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST);this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,t,0,this.querySetCount*8),this.submitQueue(),yield t.mapAsync(GPUMapMode.READ);let n=new BigUint64Array(t.getMappedRange()),o=Number(n[1]-n[0])/1e6;return t.unmap(),this.bufferManager.releaseBuffer(t),o})}shouldExecuteOnCPU(t,n=fPe){return Z().getBool("WEBGPU_CPU_FORWARD")&&t.every(o=>this.tensorMap.get(o.dataId).resource==null&&C.sizeFromShape(o.shape)<n)}numDataIds(){return this.tensorMap.numDataIds()-this.tensorDataPendingDisposal.length}dispose(){this.disposed||(this.querySet!=null&&this.querySet.destroy(),this.bufferManager.dispose(),this.textureManager.dispose(),this.disposed=!0)}}return r.nextDataId=0,r})();C_()&&Fv("webgpu",()=>M(void 0,null,function*(){let r={powerPreference:Z().get("WEBGPU_USE_LOW_POWER_GPU")?"low-power":"high-performance"},e=yield navigator.gpu.requestAdapter(r),t={},n=[];e.features.has("timestamp-query")&&n.push("timestamp-query"),e.features.has("bgra8unorm-storage")&&n.push(["bgra8unorm-storage"]),t.requiredFeatures=n;let o=e.limits;t.requiredLimits={maxComputeWorkgroupStorageSize:o.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:o.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:o.maxStorageBufferBindingSize,maxBufferSize:o.maxBufferSize,maxComputeWorkgroupSizeX:o.maxComputeWorkgroupSizeX,maxComputeInvocationsPerWorkgroup:o.maxComputeInvocationsPerWorkgroup};let s=yield e.requestDevice(t),i=yield e.requestAdapterInfo();return new wb(s,i)}),3);var Ze=function(r){return r[r.ADD=0]="ADD",r[r.ATAN2=1]="ATAN2",r[r.COMPLEX_MULTIPLY_IMAG=2]="COMPLEX_MULTIPLY_IMAG",r[r.COMPLEX_MULTIPLY_REAL=3]="COMPLEX_MULTIPLY_REAL",r[r.DIV=4]="DIV",r[r.ELU_DER=5]="ELU_DER",r[r.EQUAL=6]="EQUAL",r[r.FLOOR_DIV=7]="FLOOR_DIV",r[r.GREATER=8]="GREATER",r[r.GREATER_EQUAL=9]="GREATER_EQUAL",r[r.LESS=10]="LESS",r[r.LESS_EQUAL=11]="LESS_EQUAL",r[r.LOGICAL_AND=12]="LOGICAL_AND",r[r.LOGICAL_OR=13]="LOGICAL_OR",r[r.MAX=14]="MAX",r[r.MIN=15]="MIN",r[r.MOD=16]="MOD",r[r.MUL=17]="MUL",r[r.NOT_EQUAL=18]="NOT_EQUAL",r[r.POW=19]="POW",r[r.PRELU=20]="PRELU",r[r.SQUARED_DIFFERENCE=21]="SQUARED_DIFFERENCE",r[r.SUB=22]="SUB",r}(Ze||{}),gPe="let resultTemp = a + b;",yPe="let resultTemp = atan2(a, b);",xPe="let resultTemp = areal * breal - aimag * bimag;",vPe="let resultTemp = areal * bimag + aimag * breal;",bPe="let resultTemp = a / b;",wPe="let resultTemp = select(a * (b + 1.0), a, b >= b - b);",CPe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a == b);
`,_Pe=`
  let remainder =
      select(a % b, round(a % b), (round(a) == a) & (round(b) == b));
  let quotient = (a - remainder) / b;
  let resultTemp =
      round(select(quotient, quotient - 1, sign(remainder) == -sign(b)));
`,SPe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a > b);
`,IPe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a >= b);
`,TPe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a < b);
`,kPe=`
  let zero = sign(a) * 0 + 0;
  let one = sign(b) * 0 + 1;
  let resultTemp = select(zero, one, a <= b);
`,EPe="return f32(a >= 1.0 && b >= 1.0);",NPe=`return (vec4<f32>(a >= vec4<f32>(1.0)) *
  vec4<f32>(b >= vec4<f32>(1.0)));`,DPe="return f32(a >= 1.0 || b >= 1.0);",APe=`return min(vec4<f32>(a >= vec4<f32>(1.0)) +
  vec4<f32>(b >= vec4<f32>(1.0)), vec4<f32>(1.0));`,RPe="let resultTemp = max(a, b);",OPe="let resultTemp = min(a, b);",MPe=`
  let isNaN = b == 0.;
  var resultTemp = a % b;
  resultTemp = select((resultTemp + b) % b, resultTemp,
      (a < 0. && b < 0.) || (a >= 0. && b > 0.));
`,FPe=`
  let isNaN = !vec4<bool>(b);
  var resultTemp = vec4<f32>(a % b);
  if (!((a[0] < 0. && b[0] < 0.) || (a[0] >= 0. && b[0] > 0.))) {
    resultTemp[0] = (resultTemp[0] + b[0]) % b[0];
  }
  if (!((a[1] < 0. && b[1] < 0.) || (a[1] >= 0. && b[1] > 0.))) {
    resultTemp[1] = (resultTemp[1] + b[1]) % b[1];
  }
  if (!((a[2] < 0. && b[2] < 0.) || (a[2] >= 0. && b[2] > 0.))) {
    resultTemp[2] = (resultTemp[2] + b[2]) % b[2];
  }
  if (!((a[3] < 0. && b[3] < 0.) || (a[3] >= 0. && b[3] > 0.))) {
    resultTemp[3] = (resultTemp[3] + b[3]) % b[3];
  }
`,PPe="let resultTemp = a * b;",$Pe=`
  var resultTemp = f32(a != b);
  let valueForNaN = 1.0;
`,LPe=`
  var resultTemp = vec4<f32>(a != b);
  let valueForNaN = 1.0;
`,VPe=`
  let isNaN = a < 0.0 && floor(b) < b;
  if (b == 0.0) {
    return 1.0;
  }
  var resultTemp = select(sign(a) * pow(abs(a), b), pow(abs(a), b),
      round(abs(b) % 2.0) != 1.0);
`,BPe=`
  let isModRound1Bool = vec4<i32>(round(abs(b) % vec4<f32>(2.0))) == vec4<i32>(1);
  let isModRound1 = vec4<f32>(isModRound1Bool);
  let multiplier = sign(a) * isModRound1 + (vec4<f32>(1.0) - isModRound1);
  var resultTemp = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  let isExpZero = b == vec4<f32>(0.0);
  if (isExpZero.r) {
    resultTemp.r = 1.0;
  }
  if (isExpZero.g) {
    resultTemp.g = 1.0;
  }
  if (isExpZero.b) {
    resultTemp.b = 1.0;
  }
  if (isExpZero.a) {
    resultTemp.a = 1.0;
  }
  let isNaN = (a < vec4<f32>(0.0)) & (floor(b) < b);
`,zPe="if (a < 0.0) { return b * a; }  return a;",UPe=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (b * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,GPe="let resultTemp = (a - b) * (a - b);",WPe="let resultTemp = a - b;";function Cb(r,e){let t;do{switch(r){case Ze.ATAN2:t=yPe;break;case Ze.MAX:t=RPe;break;case Ze.MIN:t=OPe;break;case Ze.MOD:t=e?FPe:MPe;break;case Ze.NOT_EQUAL:t=e?LPe:$Pe;break;case Ze.POW:t=e?BPe:VPe;break;default:continue}let n,o,s;return e?(n="isnanVec4",o="vec4<f32>",s="vec4<bool>"):(n="isnan",o="f32",s="bool"),`
      let aIsNaN = ${n}(a);
      let aPostLegalization = select(a, ${o}(42), aIsNaN);
      let bIsNaN = ${n}(b);
      let bPostLegalization = select(b, ${o}(42), bIsNaN);
      let isNaN = false;
      let valueForNaN = uniforms.NAN;
      {
        let a = aPostLegalization;
        let b = bPostLegalization;
        ${t}
        return select(
            resultTemp, ${o}(valueForNaN),
            ${s}(isNaN) | aIsNaN | bIsNaN);
      }
    `}while(!1);switch(r){case Ze.ADD:t=gPe;break;case Ze.COMPLEX_MULTIPLY_IMAG:t=vPe;break;case Ze.COMPLEX_MULTIPLY_REAL:t=xPe;break;case Ze.DIV:t=bPe;break;case Ze.ELU_DER:t=wPe;break;case Ze.EQUAL:t=CPe;break;case Ze.FLOOR_DIV:t=_Pe;break;case Ze.GREATER:t=SPe;break;case Ze.GREATER_EQUAL:t=IPe;break;case Ze.LESS:t=TPe;break;case Ze.LESS_EQUAL:t=kPe;break;case Ze.LOGICAL_AND:return e?NPe:EPe;case Ze.LOGICAL_OR:return e?APe:DPe;case Ze.MUL:t=PPe;break;case Ze.PRELU:return e?UPe:zPe;case Ze.SQUARED_DIFFERENCE:t=GPe;break;case Ze.SUB:t=WPe;break;default:}return`
    ${t}
    return resultTemp;
  `}var be=function(r){return r[r.ABS=0]="ABS",r[r.ACOS=1]="ACOS",r[r.ACOSH=2]="ACOSH",r[r.ASIN=3]="ASIN",r[r.ASINH=4]="ASINH",r[r.ATAN=5]="ATAN",r[r.ATANH=6]="ATANH",r[r.CEIL=7]="CEIL",r[r.COS=8]="COS",r[r.COSH=9]="COSH",r[r.ELU=10]="ELU",r[r.ERF=11]="ERF",r[r.EXP=12]="EXP",r[r.EXPM1=13]="EXPM1",r[r.FLOOR=14]="FLOOR",r[r.IS_FINITE=15]="IS_FINITE",r[r.IS_INF=16]="IS_INF",r[r.IS_NAN=17]="IS_NAN",r[r.LINEAR=18]="LINEAR",r[r.LOG=19]="LOG",r[r.LOG1P=20]="LOG1P",r[r.LOGICAL_NOT=21]="LOGICAL_NOT",r[r.NEG=22]="NEG",r[r.RELU=23]="RELU",r[r.RELU6=24]="RELU6",r[r.LEAKYRELU=25]="LEAKYRELU",r[r.RECIPROCAL=26]="RECIPROCAL",r[r.ROUND=27]="ROUND",r[r.RSQRT=28]="RSQRT",r[r.SELU=29]="SELU",r[r.SIGMOID=30]="SIGMOID",r[r.SIGN=31]="SIGN",r[r.SIN=32]="SIN",r[r.SINH=33]="SINH",r[r.SOFTPLUS=34]="SOFTPLUS",r[r.SQRT=35]="SQRT",r[r.SQUARE=36]="SQUARE",r[r.STEP=37]="STEP",r[r.TAN=38]="TAN",r[r.TANH=39]="TANH",r[r.TO_INT=40]="TO_INT",r}(be||{}),jPe="return abs(a);",HPe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return acos(a);
`,qPe=`
  if (a < 1.) {
    return uniforms.NAN;
  }
  return acosh(a);
`,KPe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  return asin(a);
`,XPe="return asinh(a);",YPe=`
  if (isnan(a)) {
    return uniforms.NAN;
  }
  return atan(a);
`,ZPe=`
  if (abs(a) > 1.) {
    return uniforms.NAN;
  }
  if (a == 1.) {
    return uniforms.INFINITY;
  }
  if (a == -1.) {
    return -uniforms.INFINITY;
  }
  return atanh(a);
`,QPe="return ceil(a);",JPe="return cos(a);",e$e=`
  let e2x = exp(-a);
  return (e2x + 1.0 / e2x) / 2.0;
`,t$e="return exp(a) - 1.0;",r$e="if (a >= 0.0) { return a; }  return (exp(a) - 1.0);",n$e=`
  var resFloat = exp(a) - vec4<f32>(1.0);
  if (a.r >= 0.0) {
    resFloat.r = a.r;
  }
  if (a.g >= 0.0) {
    resFloat.g = a.g;
  }
  if (a.b >= 0.0) {
    resFloat.b = a.b;
  }
  if (a.a >= 0.0) {
    resFloat.a = a.a;
  }
  return resFloat;
`,o$e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  let p = ${E.ERF_P};
  let a1 = ${E.ERF_A1};
  let a2 = ${E.ERF_A2};
  let a3 = ${E.ERF_A3};
  let a4 = ${E.ERF_A4};
  let a5 = ${E.ERF_A5};

  let sign = sign(a);
  let absA = abs(a);
  let t = 1.0 / (1.0 + p * absA);
  return sign * (1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * exp(-absA * absA));
`,s$e="return exp(a);",i$e="return floor(a);",a$e="return f32(!isnan(a) && !isinf(a));",c$e="return f32(isinf(a));",l$e="return f32(isnan(a));",u$e="return a;",p$e=`if (a < 0.0) { return uniforms.NAN; }
  return log(a);`,d$e=`
  if (isnan(a)) { return a; }
  return log(1.0 + a);
`,h$e="return f32(!(a >= 1.0));",f$e="return -a;",m$e="if (a < 0.0) { return uniforms.alpha * a; } return a;",g$e=`
  let aLessThanZero = vec4<f32>(a < vec4<f32>(0.0));
  return (aLessThanZero * (uniforms.alpha * a)) + ((vec4<f32>(1.0) - aLessThanZero) * a);
`,y$e="return 1.0 / a;",x$e="return select(a, 0.0, a < 0.0);",v$e="return clamp(a, 0.0, 6.0);",b$e="return clamp(a, vec4<f32>(0.0, 0.0, 0.0, 0.0), vec4<f32>(6.0, 6.0, 6.0, 6.0));",w$e=`
  return select(a, vec4<f32>(0.0), a < vec4<f32>(0.0));
`,C$e="return round(a);",_$e="return inverseSqrt(a);",S$e=`
  if (a >= 0.0) {
    return ${E.SELU_SCALE} * a;
  } else {
    return ${E.SELU_SCALEALPHA} * (exp(a) - 1.0);
  }
`,I$e="return 1.0 / (1.0 + exp(-1.0 * a));",T$e="return sign(a);",k$e="return sin(a);",E$e=`
  let e2x = exp(a);
  return (e2x - 1.0 / e2x) / 2.0;
`,N$e=`
  let epsilon = 1.1920928955078125e-7;
  let threshold = log(epsilon) + 2.0;

  let too_large = a > -threshold;
  let too_small = a < threshold;
  let exp_a = exp(a);

  if (too_large) {
    return a;
  } else if (too_small) {
    return exp_a;
  } else {
    return log(exp_a + 1.0);
  }
`,D$e="return sqrt(a);",A$e="return a * a;",R$e=`
  if (isnan(a)) {
    return a;
  }

  return select(uniforms.stepAlpha, 1.0, a > 0.0);
`,O$e="return tan(a);",M$e=`
  let e2x = exp(-2.0 * abs(a));
  return sign(a) * (1.0 - e2x) / (1.0 + e2x);
`,F$e="return f32(i32((a)));";function Pd(r,e){switch(r){case be.ABS:return jPe;case be.ACOS:return HPe;case be.ACOSH:return qPe;case be.ASIN:return KPe;case be.ASINH:return XPe;case be.ATAN:return YPe;case be.ATANH:return ZPe;case be.COS:return JPe;case be.COSH:return e$e;case be.CEIL:return QPe;case be.ELU:return e?n$e:r$e;case be.ERF:return o$e;case be.EXP:return s$e;case be.EXPM1:return t$e;case be.FLOOR:return i$e;case be.IS_FINITE:return a$e;case be.IS_INF:return c$e;case be.IS_NAN:return l$e;case be.LINEAR:return u$e;case be.LOG:return p$e;case be.LOG1P:return d$e;case be.LOGICAL_NOT:return h$e;case be.NEG:return f$e;case be.LEAKYRELU:return e?g$e:m$e;case be.RECIPROCAL:return y$e;case be.RELU:return e?w$e:x$e;case be.RELU6:return e?b$e:v$e;case be.ROUND:return C$e;case be.RSQRT:return _$e;case be.SELU:return S$e;case be.SIGMOID:return I$e;case be.SIGN:return T$e;case be.SIN:return k$e;case be.SINH:return E$e;case be.SOFTPLUS:return N$e;case be.SQRT:return D$e;case be.SQUARE:return A$e;case be.STEP:return R$e;case be.TAN:return O$e;case be.TANH:return M$e;case be.TO_INT:return F$e;default:throw new Error(`BinaryType ${r} is not implemented!`)}}function Jo(r,e=!1,t=!1,n=3){if(r===null)return"";let o="";if(r==="linear")o=Pd(be.LINEAR);else if(r==="relu")o=Pd(be.RELU,t);else if(r==="elu")o=Pd(be.ELU,t);else if(r==="relu6")o=Pd(be.RELU6,t);else if(r==="prelu")o=Cb(Ze.PRELU,t);else if(r==="sigmoid")o=Pd(be.SIGMOID,t);else if(r==="leakyrelu")o=Pd(be.LEAKYRELU,t);else throw new Error(`Activation ${r} has not been implemented for the WebGPU backend.`);let i=Mt(t?4:1),a="";return e?a=`
      fn activation(a : ${i}, coords : vec${n}<i32>) -> ${i} {
        let b = getPreluActivationWeightsByOutputCoords(coords);
        ${o}
      }`:a=`
      fn activation(a : ${i}, coords : vec${n}<i32>) -> ${i} {
        ${o}
      }`,a}function Fi(r,e){return`
      ${r?"value = value + getBiasByOutputCoords(coords);":""}
      ${e?"value = activation(value, coords);":""}
      `}function xV(r,e,t=!1,n=!1,o=!1,s=1){C.assert(r&&s===1||!r,()=>`transposeA ${r} is not compatible with component size ${s}`);let i=`
      ${r?"value = getA(batch, col, row);":"value = getA(batch, row, col);"}

    `,a=e?"value = getB(batch, col, row);":"value = getB(batch, row, col);";return`
  fn mm_readA(batch: i32, row: i32, col: i32) -> ${Mt(s)} {
    var value = ${Mt(s)}(0.0);
    ${t&&o?i:`
    ${r?"if(row < uniforms.dimAOuter && col < uniforms.dimInner)":"if(row < uniforms.aShape[1] && col < uniforms.aShape[2])"}
    {
      ${i}
    }
    `}
    return value;
  }

  fn mm_readB(batch: i32, row: i32, col: i32) -> ${Mt(s)} {
    var value = ${Mt(s)}(0.0);
    ${a}
    return value;
  }
  `}function S_(r,e,t,n,o=!1,s=!1,i=!1,a=1){return`
  ${xV(t,n,o,s,i,a)}
  fn mm_write(batch: i32, row: i32, col: i32, valueIn: ${Mt(a)}) {
    ${o&&s?"":"if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)"}
    {
      var value = valueIn;
      let coords = vec3<i32>(batch, row, col);
      ${Fi(r,e)}
      setOutputAtCoords(coords[0], coords[1], coords[2], value);
    }
  }
  `}var P$e=(r,e)=>r?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol * ${e});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRow + innerRow,
          kStart + inputCol * ${e});
        `,$$e=(r,e,t,n)=>{if(r)return`
      for (var k = 0; k < ${n}; k++) {
        let BCached0 = mm_Bsub[k][tileCol];
        let ACached0 = mm_Asub[k][localRow];
        for (var i = 0; i < ${t}; i++) {
          acc[i] = fma(BCached0, vec4<f32>(ACached0[i]), acc[i]);
        }
      }`;{let o="",s="";for(let i=0;i<e;i++)o+=`let BCached${i} = mm_Bsub[k * ${e} + ${i}][tileCol];`,s+=`acc[i] = fma(BCached${i}, vec4<f32>(ACached[${i}]), acc[i]);`;return`
      for (var k = 0; k < ${n/e}; k++) {
        ${o}
        for (var i = 0; i < ${t}; i++) {
          let ACached = mm_Asub[tileRow + i][k];
          ${s}
        }
      }`}};function py(r,e,t=!1,n=32,o=!1,s=32,i=!1){let a=e[1]*r[1],c=e[0]*r[0],l=t?a:n,u=t?n:a,p=l/e[0],d=n/e[1],h=r[1],f=r[0];return C.assert((t&&p===4&&r[1]===4||!t&&(p===3||p===4))&&l%e[0]===0&&n%e[1]===0&&r[0]===4,()=>`If transposeA ${t} is true, innerElementSize ${p} and workPerThread[1] ${r[1]} must be 4.
          Otherwise, innerElementSize ${p} must be 3 or 4.
      tileAWidth ${l} must be divisible by workgroupSize[0]${e[0]}. tileInner ${n} must be divisible by workgroupSize[1] ${e[1]}. colPerThread ${r[0]} must be 4.`),`
  var<workgroup> mm_Asub : array<array<vec${p}<f32>, ${l/p}>, ${u}>;
  var<workgroup> mm_Bsub : array<array<vec4<f32>, ${c/r[0]}>, ${n}>;

  ${ue()} {
    let localRow = i32(localId.y);
    let tileRow = localRow * ${h};
    let tileCol = i32(localId.x);

    let globalRow = i32(globalId.y) * ${h};
    let globalCol = i32(globalId.x) * ${f};
    let batch = ${o?"0":"i32(globalId.z)"};
    let batchA = ${o||!i?"batch":"batch % uniforms.aShape[0]"};
    let batchB = ${o||!i?"batch":"batch % uniforms.bShape[0]"};
    let globalRowStart = i32(workgroupId.y) * ${a};

    let numTiles = ${o?`${Math.ceil(s/n)}`:`(uniforms.dimInner - 1) / ${n} + 1`};
    var kStart = ${o?`i32(globalId.z) * ${s}`:"0"};

    var acc: array<vec4<f32>, ${h}>;

    // Loop over shared dimension.
    let tileRowB = localRow * ${d};
    for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var innerRow = 0; innerRow < ${h}; innerRow++) {
            let inputRow = tileRow + innerRow;
            let inputCol = tileCol;
            ${P$e(t,p)}
        }

        // Load one tile of B into local memory.
        for (var innerRow = 0; innerRow < ${d}; innerRow++) {
            let inputRow = tileRowB + innerRow;
            let inputCol = tileCol;
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB, kStart + inputRow, globalCol);
        }
        kStart = kStart + ${n};
        workgroupBarrier();

        // Compute acc values for a single thread.
        ${$$e(t,p,h,n)}
        workgroupBarrier();
    }

    for (var innerRow = 0; innerRow < ${h}; innerRow++) {
        mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
    }
  }`}var T7=r=>r?`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          kStart + inputRow,
          globalRowStart + inputCol);
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batchA,
          globalRowStart + inputRow,
          kStart + inputCol);
        `,L$e=r=>r?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];";function dy(r,e,t=!1,n=32,o=!1,s=32,i=!1,a=!1){let c=r[1]*e[1],l=r[0]*e[0],u=t?c:n,p=t?n:c;C.assert(p%e[1]===0&&u%e[0]===0&&n%e[1]===0,()=>`tileAHight ${p} must be divisible by workgroupSize[1]${e[1]}, tileAWidth ${u} must be divisible by workgroupSize[0]${e[0]}, tileInner ${n} must be divisible by workgroupSize[1]${e[1]}`);let d=p/e[1],h=u/e[0],f=n/e[1],m=r[1],g=r[0],y=i?`
      let localRow = i32(localId.y);
      let localCol = i32(localId.x);
      let globalRowStart = i32(workgroupId.y) * ${c};
      let globalColStart = i32(workgroupId.x) * ${l};

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        for (var inputRow = localRow; inputRow < ${p}; inputRow = inputRow + ${e[1]}) {
          for (var inputCol = localCol; inputCol < ${u}; inputCol = inputCol + ${e[0]}) {
            ${T7(t)}
          }
        }
        // Load one tile of B into local memory.
        for (var inputRow = localRow; inputRow < ${n}; inputRow = inputRow + ${e[1]}) {
              for (var inputCol = localCol; inputCol < ${l}; inputCol = inputCol + ${e[0]}) {
            mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
              kStart + inputRow,
              globalColStart + inputCol);
          }
        }
        kStart = kStart + ${n};
        workgroupBarrier();

        // Compute acc values for a single thread.
        var BCached : array<f32, ${g}>;
        for (var k = 0; k < ${n}; k++) {
          for (var inner = 0; inner < ${g}; inner++) {
            BCached[inner] = mm_Bsub[k][localCol + inner * ${e[0]}];
          }
          for (var innerRow = 0; innerRow < ${m}; innerRow++) {
            let ACached = ${t?`mm_Asub[k][localRow + innerRow * ${e[1]}];`:`mm_Asub[localRow + innerRow * ${e[1]}][k];`}
            for (var innerCol = 0; innerCol < ${g}; innerCol++) {
              acc[innerRow][innerCol] =
                  fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
            }
          }
        }
        workgroupBarrier();
      }
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        let gRow = globalRowStart + localRow + innerRow * ${e[1]};
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          let gCol = globalColStart + localCol + innerCol * ${e[0]};
          mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
        }
      }
      `:`
  let tileRow = i32(localId.y) * ${m};
  let tileCol = i32(localId.x) * ${g};

  let globalRow = i32(globalId.y) * ${m};
  let globalCol = i32(globalId.x) * ${g};
  let globalRowStart = i32(workgroupId.y) * ${c};

  let tileRowA = i32(localId.y) * ${d};
  let tileColA = i32(localId.x) * ${h};
  let tileRowB = i32(localId.y) * ${f};
  // Loop over shared dimension.
  for (var t = 0; t < numTiles; t++) {
    // Load one tile of A into local memory.
    for (var innerRow = 0; innerRow < ${d}; innerRow++) {
      for (var innerCol = 0; innerCol < ${h}; innerCol++) {
        let inputRow = tileRowA + innerRow;
        let inputCol = tileColA + innerCol;
        ${T7(t)}
      }
    }

    // Load one tile of B into local memory.
    for (var innerRow = 0; innerRow < ${f}; innerRow++) {
      for (var innerCol = 0; innerCol < ${g}; innerCol++) {
        let inputRow = tileRowB + innerRow;
        let inputCol = tileCol + innerCol;
        mm_Bsub[inputRow][inputCol] = mm_readB(batchB,
          kStart + inputRow,
          globalCol + innerCol);
      }
    }
    kStart = kStart + ${n};
    workgroupBarrier();

    // Compute acc values for a single thread.
    var BCached : array<f32, ${g}>;
    for (var k = 0; k < ${n}; k++) {
      for (var inner = 0; inner < ${g}; inner++) {
        BCached[inner] = mm_Bsub[k][tileCol + inner];
      }

      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        ${L$e(t)}
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] =
              fma(ACached, BCached[innerCol], acc[innerRow][innerCol]);
        }
      }
    }

    workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < ${m}; innerRow++) {
    for (var innerCol = 0; innerCol < ${g}; innerCol++) {
      mm_write(batch, globalRow + innerRow, globalCol + innerCol,
          acc[innerRow][innerCol]);
    }
  }
  `;return`
    var<workgroup> mm_Asub : array<array<f32, ${u}>, ${p}>;
    var<workgroup> mm_Bsub : array<array<f32, ${l}>, ${n}>;

    ${ue()} {
      let batch = ${o?"0":"i32(globalId.z)"};
      let batchA = ${o||!a?"batch":"batch % uniforms.aShape[0]"};
      let batchB = ${o||!a?"batch":"batch % uniforms.bShape[0]"};
      let numTiles = ${o?`${Math.ceil(s/n)}`:`(uniforms.dimInner - 1) / ${n} + 1`};
      var kStart = ${o?`i32(globalId.z) * ${s}`:"0"};

      var acc : array<array<f32, ${g}>, ${m}>;

      // Without this initialization strange values show up in acc.
      for (var innerRow = 0; innerRow < ${m}; innerRow++) {
        for (var innerCol = 0; innerCol < ${g}; innerCol++) {
          acc[innerRow][innerCol] = 0.0;
        }
      }
      ${y}
    }
  `}var V$e=r=>r?`
      mm_readA(batchA, colA, globalRow),
      mm_readA(batchA, colA + 1, globalRow),
      mm_readA(batchA, colA + 2, globalRow),
      mm_readA(batchA, colA + 3, globalRow)
  `:`
      mm_readA(batchA, globalRow, colA),
      mm_readA(batchA, globalRow, colA + 1),
      mm_readA(batchA, globalRow, colA + 2),
      mm_readA(batchA, globalRow, colA + 3)
  `;function B$e(r,e=!1){C.assert(r[1]===1&&r[2]===1,()=>`A linear work group size is required. But got ${r}.`);let t=r[0]*4;return`
    var<workgroup> mm_Asub : array<vec4<f32>, ${r[0]}>;

    ${ue()} {
      let tileCol = i32(localId.x);
      let globalCol = i32(globalId.x);
      let globalRow = i32(globalId.y);

      let numTiles = (uniforms.dimInner - 1) / ${t} + 1;
      let batch = i32(globalId.z);
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      // Without this initialization strange values show up in acc.
      var acc = 0.0;

      // Loop over shared dimension.
      for (var t = 0; t < numTiles; t++) {
        // Load one tile of A into local memory.
        let colA = t * ${t} + tileCol * 4;
        mm_Asub[tileCol] = vec4<f32>(${V$e(e)});
        workgroupBarrier();

        // Compute acc values for a single thread.
        for (var k = 0; k < ${t/4}; k++) {
          let rowB = t * ${t} + k * 4;
          let BCached = vec4<f32>(mm_readB(batchB, rowB, globalCol),
                              mm_readB(batchB, rowB + 1, globalCol),
                              mm_readB(batchB, rowB + 2, globalCol),
                              mm_readB(batchB, rowB + 3, globalCol));

          let ACached = mm_Asub[k];
          acc = acc + dot(ACached, BCached);
        }

        workgroupBarrier();
      }

      mm_write(batch, globalRow, globalCol, acc);
    }
  `}var oN=class{constructor(e,t,n=!1,o=!1,s=null,i=null,a=null,c=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=t,this.dispatchLayout={x:[2],y:[1],z:[0]};let l=n?e[1]:e[2];if(this.isVec4=(l%4===0&&!n||t[1]%4===0&&n)&&t[2]%4===0&&!o,this.outputComponent=this.isVec4?4:1,this.isVectorA=t[1]===1&&!n,!this.isVec4&&this.isVectorA)this.elementsPerThread=[1,1,1],this.workgroupSize=[32,1,1];else{let d=yV(t[1],l,t[2],n);this.workgroupSize=d.workgroupSize,this.elementsPerThread=d.elementsPerThread}this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread);let u=s!=null,p=a!=null;u&&this.variableNames.push("bias"),p&&this.variableNames.push("preluActivationWeights"),this.sequentialAccessByThreads=c,this.transposeA=n,this.transposeB=o,this.addBias=u,this.activation=i,this.hasPreluActivationWeights=p,[this.fitAOuter,this.fitBOuter,this.fitInner]=this.getShapeFit(t[1],t[2],l),this.shaderKey=`matMulPacked_${this.elementsPerThread}_${n}_${o}_${this.activation}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.isVectorA}_${this.sequentialAccessByThreads}`}getShapeFit(e,t,n){let o=this.workgroupSize[1]*this.elementsPerThread[1],s=this.workgroupSize[0]*this.elementsPerThread[0];!this.isVec4&&this.isVectorA?this.tileInner=this.workgroupSize[0]*4:this.tileInner=s;let i=e%o===0,a=t%s===0,c=n%this.tileInner===0;return[i,a,c]}getUserCode(){return`
      ${Jo(this.activation,this.hasPreluActivationWeights,this.isVec4)}
      ${S_(this.addBias,this.activation,!1,this.transposeB,this.fitAOuter,this.fitBOuter,this.fitInner,this.isVec4?4:1)}
      ${this.isVec4?py(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,!0):this.isVectorA?B$e(this.workgroupSize,this.transposeA):dy(this.elementsPerThread,this.workgroupSize,this.transposeA,this.tileInner,!1,null,this.sequentialAccessByThreads,!0)}
    `}};function z$e(r){return`
    var<workgroup> sumValues : array<f32, ${r}>;
    ${ue()} {
      let coords = getOutputCoords();
      let batch = coords[0];
      let batchA = batch % uniforms.aShape[0];
      let batchB = batch % uniforms.bShape[0];
      let row = coords[1];
      let col = coords[2];
      var sum = 0.0;
      let Length = uniforms.dimInner;
      for (var k = i32(localId.x); k < Length; k = k + ${r}) {
        let dataA = mm_readA(batchA, row, k);
        let dataB = mm_readB(batchB, k, col);
        sum = sum + dataA * dataB;
      }
      sumValues[localId.x] = sum;
      workgroupBarrier();

      for(var currentSize = ${r/2}u; currentSize > 1u;
          currentSize = currentSize / 2u) {
        if (localId.x < currentSize)
        {
          sumValues[localId.x] = sumValues[localId.x] + sumValues[localId.x + currentSize];
        }
        workgroupBarrier();
      }

      if (localId.x == 0u) {
        sum = sumValues[0] + sumValues[1];
        mm_write(batch, row, col, sum);
      }
    }
  `}var sN=class{constructor(e,t=!1,n=!1,o=null,s=null,i=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout={x:[],y:[1,2],z:[0]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize);let a=o!=null,c=i!=null;a&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),this.transposeA=t,this.transposeB=n,this.addBias=a,this.activation=s,this.hasPreluActivationWeights=c,this.shaderKey=`matMulReduce_${this.activation}_${t}_${n}`}getUserCode(){return`
      ${Jo(this.activation,this.hasPreluActivationWeights)}
      ${S_(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${z$e(this.workgroupSize[0])}
    `}};function U$e(r){let e=r[1],t=r[0],n=e>t?e:t;return`
  var<workgroup> mm_Asub : array<array<f32, ${n}>, ${e}>;
  var<workgroup> mm_Bsub : array<array<f32, ${t}>, ${n}>;

  // If the output size is small for matrix multiplication, avoid to use vec4
  // and handle some elements per thread to optimally utilize the ALU.
  // Read data from global memory to registers firstly, then store them into
  // shared memory, so it is instruction-Level parallelism for arithmetic
  // operations and others handle IO operations between barrier api, makes ALU
  // and load/store units work simultaneously, could improves the performance.
  ${ue()} {
    let tileRow = i32(localId.y);
    let tileCol = i32(localId.x);
    let globalRow = i32(globalId.y);
    let globalCol = i32(globalId.x);
    let batch = i32(globalId.z);
    let batchA = batch % uniforms.aShape[0];
    let batchB = batch % uniforms.bShape[0];

    // uniforms.dimInner should be greater than 0.
    let numTiles = (uniforms.dimInner - 1) / ${n} + 1;
    var acc = 0.0;

    var globalColA = tileCol;
    var globalRowB = 0;
    var regA = mm_readA(batchA, globalRow, globalColA);
    var regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
    var regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
    globalColA = globalColA + ${n};
    globalRowB = globalRowB + ${n};

    for (var t = 0; t < numTiles; t = t + 1) {
      mm_Asub[tileRow][tileCol] = regA;
      mm_Bsub[2 * tileRow][tileCol] = regB0;
      mm_Bsub[2 * tileRow + 1][tileCol] = regB1;

      workgroupBarrier();

      regA = mm_readA(batchA, globalRow, globalColA);
      regB0 = mm_readB(batchB, globalRowB + 2 * tileRow, globalCol);
      regB1 = mm_readB(batchB, globalRowB + 2 * tileRow + 1, globalCol);
      globalColA = globalColA + ${n};
      globalRowB = globalRowB + ${n};

      for (var k = 0; k < ${n}; k = k + 1) {
        acc = acc + mm_Asub[tileRow][k] * mm_Bsub[k][tileCol];
      }
      workgroupBarrier();
    }

    mm_write(batch, globalRow, globalCol, acc);
  }
  `}var iN=class{constructor(e,t,n,o=!1,s=!1,i=null,a=null,c=null){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[16,8,1],this.outputShape=n,this.dispatchLayout={x:[2],y:[1],z:[0]},this.dispatch=[Math.ceil(n[2]/this.workgroupSize[0]),Math.ceil(n[1]/this.workgroupSize[1]),n[0]];let l=i!=null;l&&this.variableNames.push("bias");let u=c!=null;u&&this.variableNames.push("preluActivationWeights"),this.transposeA=o,this.transposeB=s,this.addBias=l,this.activation=a,this.hasPreluActivationWeights=u,this.shaderKey=`matMulSmallOutputSize_${this.activation}_${o}_${s}`}getUserCode(){return`
      ${Jo(this.activation,this.hasPreluActivationWeights)}
      ${S_(this.addBias,this.activation,this.transposeA,this.transposeB)}
      ${U$e(this.workgroupSize)}
    `}};var aN=class{constructor(e,t,n=!1,o=!1){this.variableNames=["A","B"],this.uniforms="dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.workgroupSize=[8,8,1],this.atomic=!0,this.splitedDimInner=128,C.assert(e[0]===1,()=>"MatMulSplitKProgram only supports batch = 1."),this.outputShape=e,this.dispatchLayout={x:[2],y:[1],z:[0,3]};let s=(n&&this.outputShape[1]%4===0||!n&&t%4===0)&&this.outputShape[2]%4===0;this.elementsPerThread=[4,4,this.splitedDimInner],this.outputComponent=s?4:1,s||(this.outputShape[1]<16&&(this.elementsPerThread[1]=1),this.outputShape[2]<16&&(this.elementsPerThread[0]=1)),this.dispatch=pe(this.dispatchLayout,[this.outputShape[0],this.outputShape[1],this.outputShape[2],t],this.workgroupSize,this.elementsPerThread),this.transposeA=n,this.transposeB=o,this.shaderKey=`matMulSplitK_${n}_${o}_${this.elementsPerThread}_${this.outputComponent}`}getUserCode(){let e=this.outputComponent;return`
      ${xV(!1,this.transposeB,!1,!1,!1,e)}
      fn mm_write(batch: i32, row : i32, col : i32, value : ${Mt(e)}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
          let coords = vec3<i32>(batch, row, col);
          let flatIndex = getOutputIndexFromCoords(coords);
          // The problem is that we should initialize output to zero before using.
          // Otherwise, the original value will be added to the result.
          for (var i = 0; i < ${e}; i = i + 1) {
            ${Mi("&result[flatIndex + i]",`${e>1?"value[i]":"value"}`,"float32")}
          }
        }
      }
      ${e===4?py(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner):dy(this.elementsPerThread,this.workgroupSize,this.transposeA,32,!0,this.splitedDimInner)}
    `}},cN=class{constructor(e,t=null,n=null,o=null){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=t!=null,this.hasPreluActivationWeights=o!=null,this.activation=n,this.addBias&&this.variableNames.push("bias"),this.hasPreluActivationWeights&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`biasActivation_${n}`}getUserCode(){return`
    ${Jo(this.activation,this.hasPreluActivationWeights)}
    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        var value = getXByOutputIndex(index);
        ${Fi(this.addBias,this.activation)}
        setOutputAtIndex(index, value);
      }
    }
    `}};var lN=class{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="value : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="fill"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        setOutputAtIndex(index, uniforms.value);
      }
    }
  `}};function gn(r){let{backend:e,attrs:t}=r,{shape:n,value:o}=t,{dtype:s}=t;if(s=s||C.inferDtype(o),s==="string"){let i=C.getArrayFromDType(s,C.sizeFromShape(n));return i.fill(o),e.makeTensorInfo(n,s,i)}else{let i=new lN(n),a=[{type:"float32",data:[o]}];return e.runWebGPUProgram(i,[],s,a)}}var k7={kernelName:cf,backendName:"webgpu",kernelFunc:gn};function Le(r){let{inputs:e,attrs:t}=r,{x:n}=e,{shape:o}=t,s=C.sizeFromShape(n.shape),i=C.inferFromImplicitShape(o,s),a=C.sizeFromShape(i);return C.assert(s===a,()=>`The new shape (${i}) has ${a} elements and the old shape (${n.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),r.backend.incRef(n.dataId),{dataId:n.dataId,shape:i,dtype:n.dtype}}var E7={kernelName:Zu,backendName:"webgpu",kernelFunc:Le};function hy({a:r,b:e,transposeA:t,transposeB:n,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){let l=r.shape.length,u=e.shape.length,p=t?r.shape[l-2]:r.shape[l-1],d=n?e.shape[u-1]:e.shape[u-2],h=t?r.shape[l-1]:r.shape[l-2],f=n?e.shape[u-2]:e.shape[u-1],m=r.shape.slice(0,-2),g=e.shape.slice(0,-2),y=C.sizeFromShape(m),x=C.sizeFromShape(g),w=ks.assertAndGetBroadcastShape(r.shape.slice(0,-2),e.shape.slice(0,-2)).concat([h,f]);C.assert(p===d,()=>`Error in matMul: inner shapes (${p}) and (${d}) of Tensors with shapes ${r.shape} and ${e.shape} and transposeA=${t} and transposeB=${n} must match.`);let _=t?[y,p,h]:[y,h,p],I=n?[x,f,d]:[x,d,f],S=Le({inputs:{x:r},backend:o,attrs:{shape:_}}),k=Le({inputs:{x:e},backend:o,attrs:{shape:I}}),R=[S,k],L=Math.max(y,x),B=[S,k],z=[{type:"int32",data:[h]},{type:"int32",data:[f]},{type:"int32",data:[p]}],q,U,G=[L,h,f],j=Z().get("WEBGPU_MATMUL_PROGRAM_TYPE");if(j<0){let te=Z().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),ne=te>0?te:o.thresholdToIncreaseWorkgroups,oe=L*Math.ceil(h/32)*Math.ceil(f/32);oe<=ne||h<=8&&oe<=ne*2?L*h*f<=128?j=Tl.MatMulReduceProgram:L===1&&d>=2e3?j=Tl.MatMulSplitKProgram:j=Tl.MatMulSmallOutputSizeProgram:j=Tl.MatMulPackedProgram}switch(j){case Tl.MatMulReduceProgram:q=new sN(G,t,n,s,c,i);break;case Tl.MatMulSplitKProgram:{if(U=gn({backend:o,attrs:{shape:G,value:0,dtype:r.dtype}}),q=new aN(G,d,t,n),s||c){U=o.runWebGPUProgram(q,B,r.dtype,z,U);let ne=new cN(U.shape,s,c,i),oe=null,le=[U];s&&le.push(s),i&&le.push(i),c==="leakyrelu"&&(oe=[{type:"float32",data:[a]}],ne.uniforms+=" alpha : f32,");let xe=o.runWebGPUProgram(ne,le,U.dtype,oe);R.push(U);let ge=Le({inputs:{x:xe},backend:o,attrs:{shape:w}});R.push(xe);for(let Re of R)o.disposeData(Re.dataId);return ge}break}case Tl.MatMulSmallOutputSizeProgram:q=new iN(_,I,G,t,n,s,c,i);break;case Tl.MatMulPackedProgram:let te=o.adapterInfo.isIntel();q=new oN(_,G,t,n,s,c,i,te);break;default:throw new Error(`Unsupported MatMulProgramType ${j}.`)}s&&B.push(s),i&&B.push(i),c==="leakyrelu"&&(z.push({type:"float32",data:[a]}),q.uniforms+=" alpha : f32,"),U=o.runWebGPUProgram(q,B,r.dtype,z,U);let X=Le({inputs:{x:U},backend:o,attrs:{shape:w}});R.push(U);for(let te of R)o.disposeData(te.dataId);return X}function G$e(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:p}=n;return hy({a:o,b:s,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:p,activation:u})}var N7={kernelName:Cd,backendName:"webgpu",kernelFunc:G$e};var I_=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.workgroupSize=[128,1,1],this.size=!0,this.outputShape=E.assertAndGetBroadcastShape(t,n),this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`binaryOpComplex_${e}`,this.op=e}getUserCode(){return`
      fn binaryOpComplex(
          areal : f32, aimag : f32, breal : f32, bimag : f32) -> f32 {
        ${Cb(this.op,!1)}
      }

      ${ue("index")} {
        if(index < uniforms.size) {
          let areal = getARealByOutputIndex(index);
          let aimag = getAImagByOutputIndex(index);
          let breal = getBRealByOutputIndex(index);
          let bimag = getBImagByOutputIndex(index);
          setOutputAtIndex(index, binaryOpComplex(areal, aimag, breal, bimag));
        }
      }
    `}};var $d=class{constructor(e,t,n){if(this.size=!0,this.variableNames=["A","B"],this.outputShape=E.assertAndGetBroadcastShape(t,n),this.dispatchLayout=me(this.outputShape),this.op=e,this.useSharedMemoryWithA=t.length<=1&&n.length>1&&t[0]<128,this.useSharedMemoryWithB=n.length<=1&&t.length>1&&n[0]<128,this.useSharedMemoryWithA||this.useSharedMemoryWithB)this.outputComponent=1,this.variableComponents=[1,1],this.lastDimensionSize=this.useSharedMemoryWithB?n[0]:t[0],this.shaderKey=`binary_${e}_${this.lastDimensionSize}`,this.type="shared",this.workgroupSize=[256,1,1];else{let o=t.length>0&&t[t.length-1]%4===0,s=n.length>0&&n[n.length-1]%4===0;o&&s?(this.outputComponent=4,this.variableComponents=[4,4]):o&&(C.isScalarShape(n)||n[n.length-1]===1)||s&&(C.isScalarShape(t)||t[t.length-1]===1)?(this.outputComponent=4,this.variableComponents=o?[4,1]:[1,4]):(this.outputComponent=1,this.variableComponents=[1,1]),this.type="nonshared",this.shaderKey=`binary_${e}_${this.variableComponents}`,this.workgroupSize=[128,1,1]}this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.outputComponent,1,1])}getUserCode(){let e,t=this.outputComponent===4?"vec4<f32>":"f32",n=`
    fn binaryOperation(a : ${t}, b : ${t}) -> ${t} {
      ${Cb(this.op,this.outputComponent===4)}
    };
    `;if(this.type==="shared"){let o=this.lastDimensionSize>1?`coords[${this.outputShape.length-1}]`:"0",s=this.useSharedMemoryWithB?`let a = getAByOutputIndex(index);
          let b = sharedBuf[${o}];`:`let a = sharedBuf[${o}];
          let b = getBByOutputIndex(index);`;e=`
        ${n}
        var<workgroup> sharedBuf : array<f32, ${this.lastDimensionSize}>;
        ${ue("index")} {
          // Fill in the shared memory buffer.
          let localIndex = i32(localId.x);
          if(localIndex < ${this.lastDimensionSize}) {
            sharedBuf[localIndex] = f32(${this.useSharedMemoryWithB?"B":"A"}[localIndex]);
          }
          workgroupBarrier();

          if(index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            ${s}
            setOutputAtIndex(index, binaryOperation(a, b));
          }
        }
        `}else e=`
       ${n}
       ${ue("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index * ${this.outputComponent});
           let a = ${t}(getAByOutputCoords(coords));
           let b = ${t}(getBByOutputCoords(coords));
           setOutputAtIndex(index, binaryOperation(a, b));
         }
       }
       `;return e}};function Mn(r){let{inputs:e}=r,{x:t}=e;return r.backend.incRef(t.dataId),{dataId:t.dataId,shape:t.shape,dtype:t.dtype}}var D7={kernelName:Aa,backendName:"webgpu",kernelFunc:Mn};function ia(r){let{inputs:e,backend:t}=r,{real:n,imag:o}=e,s=t.makeTensorInfo(n.shape,"complex64"),i=t.tensorMap.get(s.dataId),a=Mn({inputs:{x:n},backend:t}),c=Mn({inputs:{x:o},backend:t});return i.complexTensorInfos={real:a,imag:c},s}var A7={kernelName:qh,backendName:"webgpu",kernelFunc:ia};var Pi=class{constructor(e,t,n=""){this.variableNames=["A"],this.size=!0;let o=128;this.workgroupSize=[o,1,1],this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.op=t,n!==""&&(this.uniforms=n),this.shaderKey=`unary_${t}`}getUserCode(){return`
      fn unaryOperation(a : f32) -> f32 {
        ${Pd(this.op,!1)}
      }
      ${ue("index")} {
        if (index < uniforms.size) {
          let a = getAByOutputIndex(index);
          setOutputAtIndex(index, unaryOperation(a));
        }
      }
      `}};function Je({opType:r,cpuKernelImpl:e,dtype:t}){return({inputs:n,backend:o})=>{let{x:s}=n,i=o,a=t||s.dtype;if(i.shouldExecuteOnCPU([s])&&e!=null){let l=i.tensorMap.get(s.dataId),u=e(l.values,a);return i.makeTensorInfo(s.shape,a,u)}let c=new Pi(s.shape,r);return i.runWebGPUProgram(c,[s],a)}}function ir({opType:r,cpuKernelImpl:e,supportsComplex:t=!1,dtype:n}){return({inputs:o,backend:s})=>{let{a:i,b:a}=o,c=s;if(t&&i.dtype==="complex64"){let p=c.tensorMap.get(i.dataId),d=c.tensorMap.get(a.dataId),h,f;if(r!==Ze.MUL)[h,f]=[[p.complexTensorInfos.real,d.complexTensorInfos.real],[p.complexTensorInfos.imag,d.complexTensorInfos.imag]].map(g=>{let[y,x]=g,b={dataId:y.dataId,dtype:y.dtype,shape:i.shape},w={dataId:x.dataId,dtype:x.dtype,shape:a.shape},_=new $d(r,i.shape,a.shape);return c.runWebGPUProgram(_,[b,w],$r(y.dtype,x.dtype))});else{let g=new I_(Ze.COMPLEX_MULTIPLY_REAL,i.shape,a.shape),y=new I_(Ze.COMPLEX_MULTIPLY_IMAG,i.shape,a.shape),x=[{dataId:p.complexTensorInfos.real.dataId,dtype:p.complexTensorInfos.real.dtype,shape:i.shape},{dataId:p.complexTensorInfos.imag.dataId,dtype:p.complexTensorInfos.imag.dtype,shape:i.shape},{dataId:d.complexTensorInfos.real.dataId,dtype:d.complexTensorInfos.real.dtype,shape:a.shape},{dataId:d.complexTensorInfos.imag.dataId,dtype:d.complexTensorInfos.imag.dtype,shape:a.shape}];h=c.runWebGPUProgram(g,x,"float32"),f=c.runWebGPUProgram(y,x,"float32")}let m=ia({inputs:{real:h,imag:f},backend:c});return c.disposeData(h.dataId),c.disposeData(f.dataId),m}let l=n||$r(i.dtype,a.dtype);if((i.dtype==="string"||a.dtype==="string"||c.shouldExecuteOnCPU([i,a]))&&e!=null){let p=c.tensorMap.get(i.dataId).values,d=c.tensorMap.get(a.dataId).values,h=i.dtype==="string"?E.fromUint8ToStringArray(p):p,f=i.dtype==="string"?E.fromUint8ToStringArray(d):d,[m,g]=e(i.shape,a.shape,h,f,l);return c.makeTensorInfo(g,l,m)}let u=new $d(r,i.shape,a.shape);return c.runWebGPUProgram(u,[i,a],l)}}var N_={};Nr(N_,{addImpl:()=>wV,bincountImpl:()=>Ib,bincountReduceImpl:()=>uN,bitwiseAndImpl:()=>CV,castImpl:()=>bV,ceilImpl:()=>_V,concatImpl:()=>pN,equalImpl:()=>SV,expImpl:()=>TV,expm1Impl:()=>EV,floorDivImpl:()=>DV,floorImpl:()=>NV,gatherNdImpl:()=>dN,gatherV2Impl:()=>hN,greaterEqualImpl:()=>RV,greaterImpl:()=>AV,lessEqualImpl:()=>MV,lessImpl:()=>OV,linSpaceImpl:()=>fN,logImpl:()=>FV,maxImpl:()=>mN,maximumImpl:()=>PV,minimumImpl:()=>$V,multiplyImpl:()=>T_,negImpl:()=>LV,notEqualImpl:()=>VV,prodImpl:()=>BV,raggedGatherImpl:()=>gN,raggedRangeImpl:()=>yN,raggedTensorToTensorImpl:()=>xN,rangeImpl:()=>vN,rsqrtImpl:()=>UV,scatterImpl:()=>kl,sigmoidImpl:()=>c9,simpleAbsImpl:()=>vV,sliceImpl:()=>WV,sparseFillEmptyRowsImpl:()=>bN,sparseReshapeImpl:()=>wN,sparseSegmentReductionImpl:()=>kb,sqrtImpl:()=>p9,squaredDifferenceImpl:()=>jV,staticRegexReplaceImpl:()=>HV,stridedSliceImpl:()=>CN,stringNGramsImpl:()=>_N,stringSplitImpl:()=>SN,stringToHashBucketFastImpl:()=>IN,subImpl:()=>KV,tileImpl:()=>TN,topKImpl:()=>kN,transposeImpl:()=>Tb,uniqueImpl:()=>EN});function ye(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>{t!=null&&C.assert(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}function vV(r){let e=new Float32Array(r.length);for(let t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var W$e=r=>{let{x:e}=r.inputs,t=r.backend;ye(e,"abs");let n=new Float32Array(C.sizeFromShape(e.shape)),o=t.data.get(e.dataId).values;return n=vV(o),t.makeOutput(n,e.shape,e.dtype)},R7={kernelName:yu,backendName:"cpu",kernelFunc:W$e};function Gt(r){return(e,t,n,o,s)=>{let i=E.assertAndGetBroadcastShape(e,t),a=i.length,c=C.computeStrides(i),l=C.sizeFromShape(i),u=C.getTypedArrayFromDType(s,l),p=e.length,d=t.length,h=C.computeStrides(e),f=C.computeStrides(t),m=E.getBroadcastDims(e,i),g=E.getBroadcastDims(t,i);if(m.length+g.length===0)for(let y=0;y<u.length;++y)u[y]=r(n[y%n.length],o[y%o.length]);else for(let y=0;y<u.length;++y){let x=C.indexToLoc(y,a,c),b=x.slice(-p);m.forEach(S=>b[S]=0);let w=C.locToIndex(b,p,h),_=x.slice(-d);g.forEach(S=>_[S]=0);let I=C.locToIndex(_,d,f);u[y]=r(n[w],o[I])}return[u,i]}}function uo(r){let{inputs:e,backend:t}=r,{real:n,imag:o}=e,s=t.data.get(n.dataId).values,i=t.data.get(o.dataId).values,a=t.makeTensorInfo(n.shape,"complex64"),c=t.data.get(a.dataId);return c.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",s),imag:t.makeTensorInfo(o.shape,"float32",i)},a}var O7={kernelName:qh,backendName:"cpu",kernelFunc:uo};function _b(r,e,t="float32"){if(t==="complex64"){let o=_b(r,e,"float32"),s=_b(r,e,"float32");return uo({inputs:{real:o,imag:s},backend:r})}let n=C.makeZerosTypedArray(C.sizeFromShape(e),t);return r.makeTensorInfo(e,t,n)}function es(r){let{inputs:e,backend:t}=r,{x:n}=e;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var M7={kernelName:Aa,backendName:"cpu",kernelFunc:es};function Ga(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.data.get(n.dataId).complexTensorInfos.real,s=t.data.get(o.dataId).values;return t.makeTensorInfo(o.shape,o.dtype,s)}var F7={kernelName:Cf,backendName:"cpu",kernelFunc:Ga};function bV(r,e,t,n){if(n==="int32"){let o=Int32Array.from(r);return[e,"int32",o]}if(n==="bool"){let o=C.toTypedArray([0],t),[s,i]=Gt((a,c)=>a!==c?1:0)(e,[],r,o,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${t} to ${n}`)}function Wa(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return es({inputs:{x:o},backend:t});let u=_b(t,o.shape,o.dtype),p=Wa({inputs:{x:o},backend:t,attrs:{dtype:"float32"}}),d=uo({inputs:{real:p,imag:u},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(p),d}if(o.dtype==="complex64"){let u=Ga({inputs:{input:o},backend:t}),p=Wa({inputs:{x:u},backend:t,attrs:{dtype:s}});return t.disposeIntermediateTensorInfo(u),p}if(!C.hasEncodingLoss(o.dtype,s)){let u=es({inputs:{x:o},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:s}}let i=t.data.get(o.dataId).values,[a,c,l]=bV(i,o.shape,o.dtype,s);return t.makeTensorInfo(a,c,l)}var P7={kernelName:Da,backendName:"cpu",kernelFunc:Wa};function er(r,e,t,n){return t==null?({inputs:o,backend:s})=>{let{a:i,b:a}=o,c=s;ye([i,a],r);let l=c.data.get(i.dataId).values,u=c.data.get(a.dataId).values,p=i.dtype==="string"?E.fromUint8ToStringArray(l):l,d=i.dtype==="string"?E.fromUint8ToStringArray(u):u,h=n||i.dtype,[f,m]=e(i.shape,a.shape,p,d,h);return c.makeTensorInfo(m,h,f)}:({inputs:o,backend:s})=>{let{a:i,b:a}=o,c=s;if(i.dtype==="complex64"||a.dtype==="complex64"){let l=Wa({inputs:{x:i},backend:c,attrs:{dtype:"complex64"}}),u=c.data.get(l.dataId),p=u.complexTensorInfos.real,d=u.complexTensorInfos.imag,h=c.data.get(p.dataId).values,f=c.data.get(d.dataId).values,m=Wa({inputs:{x:a},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(m.dataId),y=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,b=c.data.get(y.dataId).values,w=c.data.get(x.dataId).values,[_,I,S]=t(i.shape,a.shape,h,f,b,w),k=c.makeTensorInfo(S,"float32",_),R=c.makeTensorInfo(S,"float32",I),L=uo({inputs:{real:k,imag:R},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(k),c.disposeIntermediateTensorInfo(R),L}else{let l=c.data.get(i.dataId).values,u=c.data.get(a.dataId).values,p=n||i.dtype,[d,h]=e(i.shape,a.shape,l,u,p);return c.makeTensorInfo(h,p,d)}}}function Sb(r){return(e,t,n,o,s,i)=>{let a=E.assertAndGetBroadcastShape(e,t),c=C.sizeFromShape(a),l=a.length,u=C.computeStrides(a),p=C.getTypedArrayFromDType("float32",c),d=C.getTypedArrayFromDType("float32",c),h=E.getBroadcastDims(e,a),f=E.getBroadcastDims(t,a),m=E.mergeRealAndImagArrays(n,o),g=E.mergeRealAndImagArrays(s,i),y=e.length,x=C.computeStrides(e),b=t.length,w=C.computeStrides(t);if(h.length+f.length===0)for(let _=0;_<p.length;_++){let I=_%m.length,S=_%g.length,k=r(m[I*2],m[I*2+1],g[S*2],g[S*2+1]);p[_]=k.real,d[_]=k.imag}else for(let _=0;_<p.length;_++){let I=C.indexToLoc(_,l,u),S=I.slice(-y);h.forEach(z=>S[z]=0);let k=C.locToIndex(S,y,x),R=I.slice(-b);f.forEach(z=>R[z]=0);let L=C.locToIndex(R,b,w),B=r(m[k*2],m[k*2+1],g[L*2],g[L*2+1]);p[_]=B.real,d[_]=B.imag}return[p,d,a]}}var wV=Gt((r,e)=>r+e),j$e=Sb((r,e,t,n)=>({real:r+t,imag:e+n})),Cp=er(ra,wV,j$e),$7={kernelName:ra,backendName:"cpu",kernelFunc:Cp};function Ib(r,e,t,n,o){let s=C.sizeFromShape(n),i=C.makeZerosTypedArray(o,t);for(let a=0;a<r.length;a++){let c=r[a];if(c<0)throw new Error("Input x must be non-negative!");c>=o||(s>0?i[c]+=e[a]:i[c]+=1)}return i}function uN(r,e,t,n=!1){let o=r.shape[0],s=r.shape[1],i=ze([o,t],e.dtype);for(let a=0;a<o;a++)for(let c=0;c<s;c++){let l=r.get(a,c);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(n?i.set(1,a,l):e.size>0?i.set(i.get(a,l)+e.get(a,c),a,l):i.set(i.get(a,l)+1,a,l))}return i}var CV=Gt((r,e)=>r&e),H$e=er(Rg,CV),L7={kernelName:Rg,backendName:"cpu",kernelFunc:H$e};function Eo(r){return(e,t,n)=>{let o=C.getArrayFromDType(t,e.length);for(let s=0;s<e.length;++s)o[s]=r(e[s],n);return o}}function pt(r,e,t){let n=Eo(e);return ei(r,n,t)}function ei(r,e,t){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;ye(i,r);let a=s,c=a.data.get(i.dataId).values,l;if(i.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=E.fromUint8ToStringArray(c)}else l=c;let u=t||i.dtype,p=e(l,u,o);return a.makeTensorInfo(i.shape,u,p)}}var _V=Eo(r=>Math.ceil(r)),q$e=ei(Rc,_V),V7={kernelName:Rc,backendName:"cpu",kernelFunc:q$e};function pN(r,e,t,n){let o=C.getArrayFromDType(t,C.sizeFromShape(e));if(n&&t!=="string"){let s=0;r.forEach(i=>{let a=C.sizeFromShape(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;r.forEach(i=>{let a=t==="string"?E.fromUint8ToStringArray(i.vals):i.vals,c=0;for(let l=0;l<i.shape[0];++l){let u=l*e[1]+s;for(let p=0;p<i.shape[1];++p)o[u+p]=a[c++]}s+=i.shape[1]})}return o}var SV=Gt((r,e)=>r===e?1:0),IV=er(fd,SV,null,"bool"),B7={kernelName:fd,backendName:"cpu",kernelFunc:IV};var TV=Eo(r=>Math.exp(r)),kV=ei(Vc,TV,"float32"),z7={kernelName:Vc,backendName:"cpu",kernelFunc:kV};var EV=Eo(r=>Math.expm1(r)),K$e=ei(Bc,EV),U7={kernelName:Bc,backendName:"cpu",kernelFunc:K$e};var NV=Eo(r=>Math.floor(r)),X$e=ei(zc,NV),G7={kernelName:zc,backendName:"cpu",kernelFunc:X$e};var DV=Gt((r,e)=>Math.floor(r/e)),Y$e=er(Uc,DV,null,"int32"),W7={kernelName:Uc,backendName:"cpu",kernelFunc:Y$e};function dN(r,e,t,n,o,s,i,a,c){let l=ze([n,s],t);for(let u=0;u<n;u++){let p=[],d=0;for(let h=0;h<o;h++){let f=r[u*o+h];d+=f*i[h],p.push(f)}if(d<0||d>=c/s)throw new Error(`Invalid indices: ${p} does not index into ${a}`);for(let h=0;h<s;h++)l.values[u*s+h]=e.get(...e.indexToLoc(d*s+h))}return l}function hN(r,e,t){let n=ze(t,r.dtype);for(let o=0;o<n.size;++o){let i=n.indexToLoc(o).slice(),a=i[0],c=i[2],l=e.locToIndex([a,c]);i[2]=e.values[l];let u=r.locToIndex(i);0<=u&&u<r.values.length&&(n.values[o]=r.values[u])}return n}var AV=Gt((r,e)=>r>e?1:0),Z$e=er(md,AV,null,"bool"),j7={kernelName:md,backendName:"cpu",kernelFunc:Z$e};var RV=Gt((r,e)=>r>=e?1:0),Q$e=er(Gc,RV,null,"bool"),H7={kernelName:Gc,backendName:"cpu",kernelFunc:Q$e};var OV=Gt((r,e)=>r<e?1:0),J$e=er(gd,OV,null,"bool"),q7={kernelName:gd,backendName:"cpu",kernelFunc:J$e};var MV=Gt((r,e)=>r<=e?1:0),eLe=er(yd,MV,null,"bool"),K7={kernelName:yd,backendName:"cpu",kernelFunc:eLe};function fN(r,e,t){let n=(e-r)/(t-1),o=C.makeZerosTypedArray(t,"float32");o[0]=r;for(let s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var FV=Eo(r=>Math.log(r)),tLe=ei(qc,FV),X7={kernelName:qc,backendName:"cpu",kernelFunc:tLe};function mN(r,e,t,n){let o=C.getTypedArrayFromDType(n,C.sizeFromShape(t));for(let s=0;s<o.length;++s){let i=s*e,a=r[i];for(let c=0;c<e;++c){let l=r[i+c];(Number.isNaN(l)||l>a)&&(a=l)}o[s]=a}return o}var PV=Gt((r,e)=>Math.max(r,e)),rLe=er(Xc,PV),Y7={kernelName:Xc,backendName:"cpu",kernelFunc:rLe};var $V=Gt((r,e)=>Math.min(r,e)),nLe=er(Yc,$V),Z7={kernelName:Yc,backendName:"cpu",kernelFunc:nLe};var T_=Gt((r,e)=>r*e),oLe=Sb((r,e,t,n)=>({real:r*t-e*n,imag:r*n+e*t})),fy=er(Qc,T_,oLe),Q7={kernelName:Qc,backendName:"cpu",kernelFunc:fy};function LV(r,e,t){let n=C.createScalarValue(-1,t);return T_([],e,n,r,t)}function sLe(r){let{inputs:e,backend:t}=r,{x:n}=e;ye(n,"neg");let o=t.data.get(n.dataId).values,[s,i]=LV(o,n.shape,n.dtype);return t.makeTensorInfo(i,n.dtype,s)}var J7={kernelName:Wu,backendName:"cpu",kernelFunc:sLe};var VV=Gt((r,e)=>r!==e?1:0),iLe=er(wd,VV,null,"bool"),e9={kernelName:wd,backendName:"cpu",kernelFunc:iLe};function Tb(r,e,t,n,o){let s=e.length,i=C.sizeFromShape(e),a=C.computeStrides(e),c=C.computeStrides(o),l=C.getTypedArrayFromDType(t,C.sizeFromShape(o));for(let u=0;u<i;++u){let p=C.indexToLoc(u,s,a),d=new Array(p.length);for(let f=0;f<d.length;f++)d[f]=p[n[f]];let h=C.locToIndex(d,s,c);l[h]=r[u]}return l}function yn(r){let{inputs:e,attrs:t,backend:n}=r,{x:o}=e,{perm:s}=t;ye(o,"transpose");let i=o.shape.length,a=new Array(i);for(let p=0;p<a.length;p++)a[p]=o.shape[s[p]];let c=n.data.get(o.dataId).values,l=Tb(c,o.shape,o.dtype,s,a);return{dataId:n.write(l,a,o.dtype),shape:a,dtype:o.dtype}}var t9={kernelName:Oa,backendName:"cpu",kernelFunc:yn};function BV(r,e,t,n){let[o,s]=E.computeOutAndReduceShapes(r,n),i=$r(e,"int32"),a=C.makeZerosTypedArray(C.sizeFromShape(o),i),c=C.sizeFromShape(s);for(let l=0;l<a.length;++l){let u=l*c,p=1;for(let d=0;d<c;++d)p*=t[u+d];a[l]=p}return{outVals:a,outShape:o,outDtype:i}}function aLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;ye(o,"prod");let a=o.shape.length,c=C.parseAxisParam(s,o.shape),l=E.getAxesPermutation(c,a),u=c,p=o,d=[];l!=null&&(p=yn({inputs:{x:o},backend:t,attrs:{perm:l}}),d.push(p),u=E.getInnerMostAxes(u.length,a));let h=t.data.get(p.dataId).values,{outVals:f,outShape:m,outDtype:g}=BV(p.shape,p.dtype,h,u),y=m;return i&&(y=E.expandShapeToKeepDim(m,c)),d.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.makeTensorInfo(y,g,f)}var r9={kernelName:Yu,backendName:"cpu",kernelFunc:aLe};function cLe(r,e,t){r.forEach((n,o)=>{if(n<0||n>=t){let s=C.indexToLoc(o,e.length,C.computeStrides(e)).join(",");throw new Error(`indices[${s}] = ${n} is not in [0, ${t})`)}})}function lLe(r,e){for(let t=0;t<r.length;++t){let n=r[t],o=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>o)throw new Error("Ragged splits must not point past values");for(let s=1;s<n.length;++s)if(n[s-1]>n[s])throw new Error("Ragged splits must be sorted in ascending order")}}function uLe(r,e,t,n){let o=[],s=0,i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);lLe(t,n);let c=1;for(let l=0;l<e.length-1;++l){c*=e[l];let u=e[l+1];for(let p=1;p<c+1;++p)a[l].push(p*u)}for(let l=0;l<r.length;++l){let u=r[l],p=r[l]+1;for(let d=0;d<t.length;++d){let h=t[d],f=d+e.length-1;if(f>=0){let m=a[f],g=m[m.length-1]-h[u];for(let y=u;y<p;++y)a[f].push(h[y+1]+g)}u=h[u],p=h[p]}p!==u&&(o.push([u,p]),s+=p-u)}return{outSplits:a,valueSlices:o,numValues:s}}function pLe(r){let e=[];for(let t=0;t<r.length;++t){let n=r[t].length,o=C.getArrayFromDType("int32",n);e.push(o),r[t].forEach((s,i)=>o[i]=s)}return e}function n9(r,e){let t=r.slice(0,e);for(;t.length<e;)t.push(1);for(let n=e;n<r.length;n++)t[e-1]*=r[n];return t}function dLe(r,e,t,n,o,s){let i=n9(e,2)[1],a=n9(s,2)[1],c=0;for(let l of t)for(let u=l[0];u<l[1];++u){for(let p=0;p<n;++p)o[c*a+p]=r[u*i+p];++c}}function hLe(r,e,t,n,o){let s=e.slice();s[0]=o;let i=C.getArrayFromDType(t,C.sizeFromShape(s)),a=r.length,c=a===0?0:a/e[0];return dLe(r,e,n,c,i,s),[i,s]}function gN(r,e,t,n,o,s,i,a){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");let c=e[0][0]-1;if(cLe(s,i,c),n.length===0)throw new Error("params.rank must be nonzero");let l=n[0],{outSplits:u,valueSlices:p,numValues:d}=uLe(s,i,r,l),h=pLe(u),f=hLe(t,n,o,p,d);return[h,f[0],f[1]]}var o9=2147483647;function yN(r,e,t,n,o,s,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let a=e.length===0,c=o.length===0,l=i.length===0,u=[];a||u.push(e[0]),c||u.push(o[0]),l||u.push(i[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");let p=u.length===0?1:u[0],d=C.getArrayFromDType("int32",p+1);d[0]=0;for(let g=0;g<p;++g){let y=a?r[0]:r[g],x=c?n[0]:n[g],b=l?s[0]:s[g];if(b===0)throw new Error("Requires delta != 0");let w;if(b>0&&x<y||b<0&&x>y)w=0;else if(w=Math.ceil(Math.abs((x-y)/b)),w>o9)throw new Error(`Requires ((limit - start) / delta) <= ${o9}`);d[g+1]=d[g]+w}let h=d[p],f=C.getArrayFromDType(t,h),m=0;for(let g=0;g<p;++g){let y=d[g+1]-d[g],x=a?r[0]:r[g],b=l?s[0]:s[g];for(let w=0;w<y;++w)f[m++]=x,x+=b}return[d,f]}var ja=E.RowPartitionType,zV=class r{constructor(e,t,n,o,s,i,a,c,l,u){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=o,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=c,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=E.getRowPartitionTypesHelper(u),this.raggedRank=E.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ja.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ja.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){let t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ja.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case ja.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${ja[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){let t=e.length;if(t===0||t===1)return 0;let n=0;for(let o=0;o<t-1;++o){let s=e[o+1]-e[o];s>n&&(n=s)}return n}static getMaxWidthValueRowID(e){let t=e.length;if(t===0)return 0;let n=0,o=e[0],s=0;for(let i=1;i<t;++i){let a=e[i];a!==o&&(o=a,s=Math.max(i-n,s),n=i)}return Math.max(t-n,s)}tensorShapeFromTensor(e,t,n=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return i9(e,n)}calculateOutputSize(e){let t=this.valuesShape,n=this.defaultValueShape;E.validateDefaultValueShape(n,t);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=E.combineRaggedTensorToTensorShapes(this.raggedRank,o,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,n){let o=Math.min(e,n),s=[],i=0;for(let a=0;a<o;++a,i+=t)s.push(i);for(let a=o;a<e;++a)s.push(-1);return C.assert(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,t,n,o){let s=e.length,i=[];for(let a=0;a<s-1;++a){let c=e[a+1]-e[a],l=Math.min(o,c),u=t[a];u===-1&&(l=0);for(let p=0;p<l;++p)i.push(u),u+=n;for(let p=0;p<c-l;++p)i.push(-1)}if(s>0&&i.length!==e[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,n,o){let s=e.length,i=[];if(s===0)return[];let a=0,c=e[0];if(c>=t.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${t.length}`);let l=t[c];i.push(l);for(let u=1;u<s;++u){let p=e[u];if(p===c)l>=0&&(++a,a<o?l+=n:l=-1);else{if(a=0,c=p,p>=t.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${t.length}`);l=t[p]}i.push(l)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,n,o){let s=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case ja.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,t,n,o);case ja.ROW_SPLITS:if(s.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(s,t,n,o);default:throw new Error(`Unsupported partition type: ${ja[i]}`)}}getFirstDimensionSize(){let e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let t=this.rowPartitionTypes[0];switch(t){case ja.FIRST_DIM_SIZE:return e[0];case ja.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ja.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ja[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let c=o.length-2;c>=0;--c)o[c]=o[c+1]*n[c+1];let s=i9(n,!1),i=C.getArrayFromDType(this.valuesDType,C.sizeFromShape(s));if(o[0]*n[0]>0){let c=this.calculateFirstParentOutputIndex(t,o[0],n[0]);for(let l=1;l<=this.raggedRank;++l)c=this.calculateOutputIndex(l-1,c,o[l],n[l]);this.setOutput(this.raggedRank,c,i,s)}return[s,i]}setOutput(e,t,n,o){if(n.length===0)return;let s=this.values,i=n,a=o.slice();a=a.slice(e+1);let c=C.sizeFromShape(a),l=t.length,u=this.defaultValue;if(u.length!==c&&u.length!==1){let f=this.defaultValueShape;ee(()=>{let m=H(u,f);u=gp(m,a).dataSync()})}let p=0,d=0,h=0;for(let f=0;f<=l;++f){let m=f<l?t[f]:-1;if(m===h){++h;continue}if(d<h){let g=s.subarray(p*c),y=i.subarray(d*c),x=(h-d)*c;s9(y,g,x)}if(f>=l){let g=n.length;m=Math.floor(g/c)}if(m>h)if(this.defaultValue.length===1)i.subarray(h*c,m*c).fill(this.defaultValue[0]),h=m;else for(;m>h;){let g=i.slice(h*c);s9(g,u,c),++h}m<0?(p=f+1,d=h):(p=f,d=h,h=d+1)}}};function s9(r,e,t){for(let n=0;n<t;n++)r[n]=e[n]}function i9(r,e){let t=[];for(let n of r){if(n<0){if(!e)throw new Error(`Dimension ${n} must be >= 0`);if(n<-1)throw new Error(`Dimension ${n} must be >= -1`);n=-1}t.push(n)}return t}function xN(r,e,t,n,o,s,i,a,c,l){return new zV(r,e,t,n,o,s,i,a,c,l).compute()}function vN(r,e,t,n){let o=r===e,s=r<e&&t<0,i=e<r&&t>1;if(o||s||i)return C.makeZerosTypedArray(0,n);let a=Math.abs(Math.ceil((e-r)/t)),c=C.makeZerosTypedArray(a,n);e<r&&t===1&&(t=-1),c[0]=r;for(let l=1;l<c.length;l++)c[l]=c[l-1]+t;return c}var UV=Eo(r=>1/Math.sqrt(r)),fLe=ei(ol,UV),a9={kernelName:ol,backendName:"cpu",kernelFunc:fLe};function kl(r,e,t,n,o,s,i,a,c,l){let u=[n/o,o],p=r.values,d=e.values;if(n===0)return ze(t,e.dtype);let h=c instanceof ur?c:ze(u,e.dtype);typeof c=="string"||typeof c=="number"?h.values.fill(c):typeof c=="boolean"&&h.values.fill(+c);for(let f=0;f<s;f++){let m=[],g=0;for(let y=0;y<i;y++){let x=p[f*i+y];m.push(x),g+=x*a[y]}if(g<0||g>=n/o)throw new Error(`Invalid indices: ${m} does not index into ${t}`);for(let y=0;y<o;y++)l?h.values[g*o+y]+=d[f*o+y]:h.values[g*o+y]=e.rank===0?d[0]:d[f*o+y]}return h}var c9=Eo(r=>1/(1+Math.exp(-r))),GV=pt(ll,r=>1/(1+Math.exp(-r))),l9={kernelName:ll,backendName:"cpu",kernelFunc:GV};function WV(r,e,t,n,o){let s=Tn.isSliceContinous(n,e,t),i=C.sizeFromShape(t),a=C.computeStrides(n);if(s){let p=Tn.computeFlatOffset(e,a);return o==="string"?r.slice(p,p+i):r.subarray(p,p+i)}let c=o==="string"?E.fromUint8ToStringArray(r):r,l=ze(n,o,c),u=ze(t,o);for(let p=0;p<u.size;++p){let d=u.indexToLoc(p),h=d.map((f,m)=>f+e[m]);u.set(l.get(...h),...d)}return o==="string"?E.fromStringArrayToUint8(u.values):u.values}function Ha(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,size:i}=n;ye(o,"slice");let[a,c]=Tn.parseSliceParams(o,s,i);Tn.assertParamsValid(o,a,c);let l=t.data.get(o.dataId).values,u=WV(l,a,c,o.shape,o.dtype);return t.makeTensorInfo(c,o.dtype,u)}var u9={kernelName:rp,backendName:"cpu",kernelFunc:Ha};function bN(r,e,t,n,o,s,i){let a=e[0],c=s[0],l=new Array(c),u=new Array(a),p=e[1];if(c===0){if(a!==0)throw new Error(E.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let g=C.getArrayFromDType(t,0),y=C.getArrayFromDType(o,0);return[g,[0,p],y,l,u]}let d=!0,h=0,f=new Array(c).fill(0);for(let g=0;g<a;++g){let y=r[g*p];if(y<0)throw new Error(E.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=c)throw new Error(E.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,c));++f[y],d=d&&y>=h,h=y}let m=!0;for(let g=0;g<c;++g){let y=f[g]===0;l[g]=y,m=m&&!y,f[g]=Math.max(f[g],1),g>0&&(f[g]+=f[g-1])}if(m&&d){let g=r,y=n;for(let x=0;x<a;++x)u[x]=x;return[g,[a,p],y,l,u]}else{let g=f[c-1],y=C.getArrayFromDType(t,g*p),x=C.getArrayFromDType(o,g),b=new Array(c).fill(0);for(let w=0;w<a;++w){let _=r[w*p],I=b[_],S=(_===0?0:f[_-1])+I;b[_]++;for(let k=0;k<p;++k)y[S*p+k]=r[w*p+k];x[S]=n[w],u[w]=S}for(let w=0;w<c;++w)if(b[w]===0){let I=w===0?0:f[w-1];y[I*p+0]=w;for(let S=1;S<p;++S)y[I*p+S]=0;x[I]=i}return[y,[g,p],x,l,u]}}function wN(r,e,t,n,o){let s=C.sizeFromShape(n),i=e[0],a=o.length,c=[],l=1,u=-1;for(let g=0;g<a;++g){let y=o[g];if(y===-1){if(u!==-1)throw new Error(E.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(u,g));u=g,c.push(1)}else{if(y<0)throw new Error(E.getSparseReshapeNegativeOutputDimErrorMessage(g,y));l*=y,c.push(y)}}if(u!==-1){if(l<=0)throw new Error(E.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(s/l);if(l*g!==s)throw new Error(E.getSparseReshapeInputOutputMultipleErrorMessage(n,c));c[u]=g}if(C.sizeFromShape(c)!==s)throw new Error(E.getSparseReshapeInputOutputMismatchErrorMessage(n,c));let d=n.length,h=[];if(d>0){h[d-1]=1;for(let g=d-2;g>=0;--g)h[g]=h[g+1]*n[g+1]}let f=[];if(a>0){f[a-1]=1;for(let g=a-2;g>=0;--g)f[g]=f[g+1]*c[g+1]}let m=C.getArrayFromDType(t,i*a);for(let g=0;g<i;++g){let y=0;for(let x=0;x<d;++x)y+=r[g*d+x]*h[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(y/f[x]),y%=f[x]}return[m,[i,a],c]}function kb(r,e,t,n,o,s=!1,i=0){let a=n.length,c=[e[0],r.length/e[0]],l=c[1],p=a>0?o[a-1]+1:0;if(p<0)throw new Error(E.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let d=e.slice();d[0]=p;let h=d.reduce((b,w)=>b*w,1),f=C.getArrayFromDType(t,h);if(a===0)return p>0&&f.fill(i),[f,d];if(p<=0)throw new Error(E.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let m=0,g=1,y=0,x=o[m];for(;;){let b=0;if(g<a){if(b=o[g],x===b){++g;continue}if(x>=b)throw new Error(E.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(x<0||x>=p)throw new Error(E.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(x,p));x>y&&f.fill(i,y*l,x*l);for(let w=m;w<g;++w){let _=n[w];if(_<0||_>=c[0])throw new Error(E.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,n[w],c[0]));for(let I=0;I<l;I++)f[x*l+I]+=r[_*l+I]}if(s)for(let w=0;w<l;w++)f[x*l+w]/=g-m;if(m=g,++g,y=x+1,x=b,g>a)break}return y<p&&f.fill(i,y*l,p*l),[f,d]}var p9=Eo(r=>Math.sqrt(r)),mLe=pt(pl,r=>Math.sqrt(r)),d9={kernelName:pl,backendName:"cpu",kernelFunc:mLe};var jV=Gt((r,e)=>{let t=r-e;return t*t}),gLe=er(dl,jV),h9={kernelName:dl,backendName:"cpu",kernelFunc:gLe};var HV=Eo((r,e)=>{let{pattern:t,replaceGlobal:n,rewrite:o}=e;return r.replace(new RegExp(t,n?"g":""),o)}),yLe=ei(Pg,HV),f9={kernelName:Pg,backendName:"cpu",kernelFunc:yLe};function CN(r,e,t,n){let o=ze(r,e.dtype);for(let s=0;s<o.size;s++){let i=o.indexToLoc(s),a=new Array(i.length);for(let c=0;c<a.length;c++)a[c]=i[c]*t[c]+n[c];o.set(e.get(...a),...i)}return o}var qV=class{constructor(e,t,n,o,s,i){this.separator=C.encodeString(e),this.nGramWidths=t,this.leftPad=C.encodeString(n),this.rightPad=C.encodeString(o),this.padWidth=s,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){let n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,o,s,i){for(let a=0;a<s;++a){let c=this.getPadWidth(i),l=Math.max(0,c-a),u=Math.max(0,c-(s-(a+1))),p=i-(l+u),d=t+(l>0?0:a-c),h=0;h+=l*this.leftPad.length;for(let x=0;x<p;++x)h+=e[d+x].length;h+=u*this.rightPad.length;let f=l+u+p-1;h+=f*this.separator.length,n[o+a]=new Uint8Array(h);let m=n[o+a],g=0,y=x=>x.forEach(b=>m[g++]=b);for(let x=0;x<l;++x)y(this.leftPad),y(this.separator);for(let x=0;x<p-1;++x)y(e[d+x]),y(this.separator);if(p>0){y(e[d+p-1]);for(let x=0;x<u;++x)y(this.separator),y(this.rightPad)}else{for(let x=0;x<u-1;++x)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,t){let n=e.length,o=t.length;if(o>0){let c=t[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let l=1;l<o;++l){let u=t[l]>=c;if(u=u&&t[l]<=n,!u)throw new Error(`Invalid split value ${t[l]}, must be in [${c}, ${n}]`);c=t[l]}if(c!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${c}`)}let s=o-1,i=C.getArrayFromDType("int32",o);if(n===0||o===0){let c=new Array(n);for(let l=0;l<=s;++l)i[l]=0;return[c,i]}i[0]=0;for(let c=1;c<=s;++c){let l=t[c]-t[c-1],u=0;this.nGramWidths.forEach(p=>{u+=this.getNumNGrams(l,p)}),this.preserveShort&&l>0&&u===0&&(u=1),i[c]=i[c-1]+u}let a=new Array(i[s]);for(let c=0;c<s;++c){let l=t[c],u=i[c];if(this.nGramWidths.forEach(p=>{let d=t[c+1]-t[c],h=this.getNumNGrams(d,p);this.createNGrams(e,l,a,u,h,p),u+=h}),this.preserveShort&&u===i[c]){let p=t[c+1]-t[c];if(p===0)continue;let d=p+2*this.padWidth;this.createNGrams(e,l,a,u,1,d)}}return[a,i]}};function _N(r,e,t,n,o,s,i,a){return new qV(t,n,o,s,i,a).compute(r,e)}function xLe(r,e,t,n){if(!r.length)return;if(e.length===0){for(let s=0;s<r.length;++s)n.push(r.subarray(s,s+1));return}if(e.length===1){let s=e[0],i=r.indexOf(s);for(;i!==-1;){let a=r.subarray(0,i);(!t||a.length!==0)&&n.push(a),r=r.subarray(i+1),i=r.indexOf(s)}(!t||r.length!==0)&&n.push(r);return}let o=0;for(let s=0;s<r.length+1;s++)if(s===r.length||e.indexOf(r[s])!==-1){let i=r.subarray(o,s);(!t||i.length!==0)&&n.push(i),o=s+1}}function SN(r,e,t){let n=r.length,o=[],s=0,i=0,a=new Array(n);for(let d=0;d<n;++d){let h=o.length;xLe(r[d],e,t,o);let f=o.length-h;a[d]=f,s+=f,i=Math.max(i,f)}let c=C.getArrayFromDType("int32",s*2),l=new Array(s),u=[n,i],p=0;for(let d=0;d<n;++d)for(let h=0;h<a[d];++h)c[p*2]=d,c[p*2+1]=h,l[p]=o[p],++p;return[c,l,u]}function IN(r,e){let t=C.getArrayFromDType("int32",r.length);for(let n=0;n<r.length;++n)t[n]=C.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var KV=Gt((r,e)=>r-e),vLe=Sb((r,e,t,n)=>({real:r-t,imag:e-n})),k_=er(hl,KV,vLe),m9={kernelName:hl,backendName:"cpu",kernelFunc:k_};function TN(r,e){let t=new Array(r.rank);for(let o=0;o<t.length;o++)t[o]=r.shape[o]*e[o];let n=ze(t,r.dtype);for(let o=0;o<n.values.length;++o){let s=n.indexToLoc(o),i=new Array(r.rank);for(let c=0;c<i.length;c++)i[c]=s[c]%r.shape[c];let a=r.locToIndex(i);n.values[o]=r.values[a]}return n}var E_=(r,e)=>{let t=e.value-r.value;return t===0?r.index-e.index:t};function g9(r,e,t=0,n=r.length-1){for(;n>t;){if(n-t>600){let a=n-t+1,c=e-t+1,l=Math.log(a),u=.5*Math.exp(2*l/3),p=.5*Math.sqrt(l*u*(a-u)/a)*Math.sign(c-a/2),d=Math.max(t,Math.floor(e-c*u/a+p)),h=Math.min(n,Math.floor(e+(a-c)*u/a+p));g9(r,e,d,h)}let o=r[e],s=t,i=n;for(C.swap(r,t,e),E_(r[n],o)>0&&C.swap(r,t,n);s<i;){for(C.swap(r,s,i),s++,i--;E_(r[s],o)<0;)s=s+1;for(;E_(r[i],o)>0;)i=i-1}E_(r[t],o)===0?C.swap(r,t,i):(i=i+1,C.swap(r,i,n)),i<=e&&(t=i+1),e<=i&&(n=i-1)}}function kN(r,e,t,n,o){let s=e[e.length-1],[i,a]=[r.length/s,s],c=C.getTypedArrayFromDType(t,i*n),l=C.getTypedArrayFromDType("int32",i*n);for(let p=0;p<i;p++){let d=p*a,h=r.subarray(d,d+a),f=new Array(h.length);h.forEach((x,b)=>f[b]={value:x,index:b}),n<f.length&&(g9(f,n),f=f.slice(0,n)),o&&f.sort(E_);let m=p*n,g=c.subarray(m,m+n),y=l.subarray(m,m+n);for(let x=0;x<n;x++)g[x]=f[x].value,y[x]=f[x].index}let u=e.slice();return u[u.length-1]=n,[ze(u,t,c),ze(u,"int32",l)]}function EN(r,e,t,n){let o=C.parseAxisParam(e,t)[0],s=[1,t[0],1];for(let f=0;f<o;f++)s[0]*=t[f];s[1]=t[o];for(let f=o+1;f<t.length;f++)s[2]*=t[f];let i=new Map,a=new Int32Array(t[o]),c=new ur(s,n,r),l=[],u=s[0]===1&&s[2]===1;for(let f=0;f<t[o];f++){let m;if(u)m=r[f].toString();else{let y=[];for(let x=0;x<s[0];x++)for(let b=0;b<s[2];b++)y.push(c.get(x,f,b));m=y.join(",")}let g=i.get(m);if(g!=null)a[f]=g;else{let y=i.size;i.set(m,y),a[f]=y,l.push(f)}}let p=s.slice();p[1]=i.size;let d=new ur(p,n);l.forEach((f,m)=>{for(let g=0;g<s[0];g++)for(let y=0;y<s[2];y++)d.set(c.get(g,f,y),g,m,y)});let h=t.slice();return h[o]=p[1],{outputValues:d.values,outputShape:h,indices:a}}var{addImpl:y9,castImpl:x9,ceilImpl:v9,concatImpl:b9,equalImpl:w9,expImpl:C9,expm1Impl:_9,floorImpl:S9,floorDivImpl:I9,gatherNdImpl:T9,gatherV2Impl:k9,greaterEqualImpl:E9,greaterImpl:N9,lessEqualImpl:D9,lessImpl:A9,logImpl:R9,maxImpl:O9,maximumImpl:M9,minimumImpl:F9,multiplyImpl:P9,negImpl:$9,notEqualImpl:L9,prodImpl:V9,rangeImpl:B9,rsqrtImpl:z9,scatterImpl:U9,simpleAbsImpl:G9,sliceImpl:W9,stridedSliceImpl:j9,stringNGramsImpl:H9,subImpl:q9,tileImpl:K9,topKImpl:X9,transposeImpl:Y9,uniqueImpl:Qqt}=N_;var bLe=Je({opType:be.ABS,cpuKernelImpl:G9}),Z9={kernelName:yu,backendName:"webgpu",kernelFunc:bLe};var wLe=Je({opType:be.ACOS}),Q9={kernelName:Ic,backendName:"webgpu",kernelFunc:wLe};var CLe=Je({opType:be.ACOSH}),J9={kernelName:Tc,backendName:"webgpu",kernelFunc:CLe};var _Le=ir({opType:Ze.ADD,cpuKernelImpl:y9,supportsComplex:!0}),eZ={kernelName:ra,backendName:"webgpu",kernelFunc:_Le};var NN=class{constructor(e){this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e[0],this.variableNames=e.map((t,n)=>`T${n}`),this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="addN"}getUserCode(){let e=[];this.variableNames.forEach(o=>{e.push(`let v${o} = get${o}ByOutputCoords(coords);`)});let t=this.variableNames.map(o=>`v${o}`).join(" + ");return`
      ${ue("index")} {
        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if (flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            ${e.join(`
        `)}
            setOutputAtIndex(flatIndex, ${t});
          }
        }
      }
    `}};function SLe(r){let{inputs:e,backend:t}=r,n=e;if(n.length===1)return Mn({inputs:{x:n[0]},backend:t});let o=n.map(a=>a.dtype).reduce((a,c)=>$r(a,c)),s=n.map(a=>a.shape),i=new NN(s);return t.runWebGPUProgram(i,n,o)}var tZ={kernelName:xu,backendName:"webgpu",kernelFunc:SLe};var DN=class{constructor(e,t){this.variableNames=["A"],this.workgroupSize=[16,16,1];let n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e[t[o]];this.outputShape=n,this.dispatchLayout={x:[0],y:[1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[1,1,1]),this.shaderKey="transposeShared"}getUserCode(){C.assert(this.workgroupSize[0]===this.workgroupSize[1],()=>`Must be a square tile, current tile shape is ${this.workgroupSize[0]} x ${this.workgroupSize[1]}`);let e=this.workgroupSize[0];return`
      var<workgroup> tile : array<array<f32, ${this.workgroupSize[0]+1}>, ${this.workgroupSize[0]}>;
      ${ue()} {
        var x = i32(workgroupId.x) * ${e} + i32(localId.x);
        var y = i32(workgroupId.y) * ${e} + i32(localId.y);
        let width = uniforms.outShape[0];
        let height = uniforms.outShape[1];
        if (x < width && y < height) {
          tile[localId.y][localId.x] = f32(A[y * width + x]);
        }
        workgroupBarrier();

        x = i32(workgroupId.y) * ${e} + i32(localId.x);
        y = i32(workgroupId.x) * ${e} + i32(localId.y);
        if (x < height && y < width) {
          setOutputAtIndex((y * height + x), tile[localId.x]
            [localId.y]);
        }
      }
    `}};var AN=class{constructor(e,t){this.variableNames=["A"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0;let n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e[t[o]];this.outputShape=n,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.newDim=t,this.shaderKey=`transpose_${t}`}getUserCode(){let e=Jr(this.outputShape.length),t=XV(this.newDim);return`
      ${ue("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            setOutputAtIndex(flatIndex, A[getIndexFromCoords${this.outputShape.length}D(
              ${e}(${t}), uniforms.aShape)]);
          }
        }
      }
    `}};function XV(r){let e=r.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);let t=new Array(e);for(let n=0;n<r.length;n++)t[r[n]]=`coords.${Ua(n)}`;return t.join()}function ps(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{perm:s}=n,i=t,a=o.shape.length,c=new Array(a);for(let u=0;u<c.length;u++)c[u]=o.shape[s[u]];if(t.shouldExecuteOnCPU([o])){let p=i.tensorMap.get(o.dataId).values,d=Y9(p,o.shape,o.dtype,s,c);return t.makeTensorInfo(c,o.dtype,d)}if(o.shape.length===2&&C.arraysEqual(s,[1,0])){let u=new DN(o.shape,s);return i.runWebGPUProgram(u,[o],o.dtype)}let l=new AN(o.shape,s);return i.runWebGPUProgram(l,[o],o.dtype)}var rZ={kernelName:Oa,backendName:"webgpu",kernelFunc:ps};var RN=class{constructor(e,t,n){this.variableNames=["x"],this.uniforms="reduceSize : i32,",this.size=!0,this.inputShape=[e.batchSize,e.inSize];let[o]=E.computeOutAndReduceShapes(this.inputShape,[1]);this.outputShape=o.length===0?[1]:o,e.inSize>=32768&&n>=512?this.workgroupSize=[512,1,1]:e.inSize>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,[1,1,1]),this.reduceType=t,this.shaderKey=`reduce_${t}`}getUserCode(){let e="",t="0.0",n=this.workgroupSize[0];this.reduceType==="min"||this.reduceType==="max"?(e=`
         if (isnan(candidate)) {
          bestValue = uniforms.NAN;
         } else if (!isnan(bestValue) && candidate ${this.reduceType==="min"?"<":">"} bestValue)
           {  bestValue = candidate; }`,t="f32(x[offset])"):this.reduceType==="sum"||this.reduceType==="mean"?e=" bestValue = bestValue + candidate; ":this.reduceType==="prod"?(e=" bestValue = bestValue * candidate; ",t="1.0"):this.reduceType==="all"?(e=" bestValue = f32(bestValue >= 1.0 && candidate >= 1.0); ",t="1.0"):this.reduceType==="any"&&(e=" bestValue = f32(bestValue >= 1.0 || candidate >= 1.0); ",t="0.0");let o=this.reduceType==="mean"?"setOutputAtIndex(outputIndex, bestValue / f32(uniforms.reduceSize));":"setOutputAtIndex(outputIndex, bestValue);";return`
       fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
       }

       ${`
         var<workgroup> xBestValues : array<f32, ${n}>;
       `}
       fn getOffset(outputIndex : i32) -> i32 {
         let outputCoords = getCoordsFromIndex(outputIndex);
         let offset = ${this.outputShape.length===1?"outputCoords":"outputCoords[0]"} * uniforms.reduceSize;
          return offset;
       }
       ${ue("index")} {
         let outputIndex = index / ${n};
         let offset = getOffset(outputIndex);
         var bestValue = ${t};
         let Length = uniforms.reduceSize;
         let WorkPerThread = DIV_CEIL(u32(Length), ${n}u);
         for (var k = i32(localId.x); k < Length && outputIndex < uniforms.size;
             k = k + ${n}) {
           let candidate = f32(x[offset + k]);
           ${e}
         }
         xBestValues[localId.x] = bestValue;
         workgroupBarrier();

         var reduceSize = min(u32(Length), ${n}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            ${e}
            xBestValues[localId.x] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (localId.x == 0u && outputIndex < uniforms.size) {
          ${o}
        }
       }
     `}};var ILe={mean:"float32",all:"bool",any:"bool"};function $i(r,e,t,n,o){let s=r.shape.length,i=[],a=C.parseAxisParam(e,r.shape),c=a,l=E.getAxesPermutation(c,s),u=r;l!=null&&(u=ps({inputs:{x:r},attrs:{perm:l},backend:o}),c=E.getInnerMostAxes(c.length,s),i.push(u)),E.assertAxesAreInnerMostDims(n,c,s);let[p,d]=E.computeOutAndReduceShapes(u.shape,c),h=p;t&&(h=E.expandShapeToKeepDim(p,a));let f;if((n==="max"||n==="prod")&&o.shouldExecuteOnCPU([u])){let m=o.tensorMap.get(u.dataId).values;switch(n){case"max":let g=O9(m,C.sizeFromShape(d),h,r.dtype);f=o.makeTensorInfo(h,r.dtype,g);break;case"prod":let{outVals:y,outShape:x,outDtype:b}=V9(u.shape,u.dtype,m,c);f=o.makeTensorInfo(x,b,y);break;default:throw new Error(`${n} CPU implementation is not yet supported.`)}}else{let m=C.sizeFromShape(d),y=C.sizeFromShape(u.shape)/m,x={windowSize:m,inSize:m,batchSize:y,outSize:1},b=ILe[n]||Td(r.dtype),w=[{type:"int32",data:[m]}],_=new RN(x,n,o.device.limits.maxComputeWorkgroupSizeX),I=o.runWebGPUProgram(_,[u],b,w);i.push(I),f=Le({inputs:{x:I},attrs:{shape:h},backend:o})}return i.forEach(m=>o.disposeData(m.dataId)),f}function TLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{keepDims:s,axis:i}=n;return $i(o,i,s,"all",t)}var nZ={kernelName:zh,backendName:"webgpu",kernelFunc:TLe};function kLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{keepDims:s,axis:i}=n;return $i(o,i,s,"any",t)}var oZ={kernelName:Uh,backendName:"webgpu",kernelFunc:kLe};var Eb=class{constructor(e,t,n){this.workgroupSize=[64,1,1],this.variableNames=["x"],this.uniforms="infinityValue : f32,",this.size=!0;let o=[t];this.op=n==="min"?"<":">";let[s,i]=E.computeOutAndReduceShapes(e,o);this.outputShape=s.length===0?[1]:s,this.dispatchLayout=me(this.outputShape),C.sizeFromShape(i)<32?(this.type="plain",this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize)):(this.type="shared",this.dispatch=pe(this.dispatchLayout,this.outputShape,[1,1,1])),this.inputShape=e,this.shaderKey=`argMinMax_${this.op}_${this.type}`}getUserCode(){let e=this.workgroupSize[0],t=()=>this.inputShape.length===1?"uniforms.xShape":`uniforms.xShape.${Ua(this.inputShape.length-1)}`,n=()=>{let o="";if(this.outputShape.length===1)this.inputShape.length!==1&&(o+="outputCoords,");else for(let s=0;s<this.outputShape.length;s++)o+=`outputCoords.${Ua(s)},`;return o};return this.type==="shared"?`
      fn DIV_CEIL(a : u32, b : u32) -> u32 {
        return ((a - 1u) / b + 1u);
      }

      ${`
      var<workgroup> xBestIndices : array<i32, ${e}>;
      var<workgroup> xBestValues : array<f32, ${e}>;
    `}

      ${ue("index")} {
        let outputIndex = index / ${e};
        let reduceLength = ${t()};

        var bestIndex = i32(localId.x);
        var bestValue = uniforms.infinityValue;
        let outputCoords = getCoordsFromIndex(outputIndex);
        for (var k = i32(localId.x); k < reduceLength && outputIndex < uniforms.size;
            k = k + ${e}) {
          let candidate = getX(${n()} k);
          if (!isnan(candidate) && candidate ${this.op} bestValue) {
            bestValue = candidate;
            bestIndex = k;
          }
        }
        xBestValues[localId.x] = bestValue;
        xBestIndices[localId.x] = bestIndex;
        workgroupBarrier();

        var reduceSize = min(u32(reduceLength), ${e}u);
        for (var currentSize = reduceSize / 2u; reduceSize > 1u;
            currentSize = reduceSize / 2u) {
          let interval = DIV_CEIL(reduceSize, 2u);
          if (localId.x < currentSize) {
            let candidate = xBestValues[localId.x + interval];
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              xBestValues[localId.x] = bestValue;
              xBestIndices[localId.x] = xBestIndices[localId.x + interval];
            }
          }
          reduceSize = interval;
          workgroupBarrier();
        }

        if (localId.x == 0u && outputIndex < uniforms.size) {
          setOutputAtIndexI32(outputIndex, xBestIndices[localId.x]);
        }
      }
    `:`
      ${ue("index")} {
        if (index < uniforms.size) {
          let outputCoords = getCoordsFromIndex(index);
          var bestIndex = 0;
          var bestValue = getX(${n()} 0);
          let reduceLength = ${t()};
          for (var i = 1; i < reduceLength; i++) {
            let candidate = getX(${n()} i);
            if (candidate ${this.op} bestValue) {
              bestValue = candidate;
              bestIndex = i;
            }
          }
          setOutputAtIndexI32(index, bestIndex);
        }
      }
      `}};function ELe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n,i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=ps({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),E.assertAxesAreInnerMostDims("argMax",[i[0]],c.shape.length);let u=new Eb(c.shape,i[0],"max"),p=[{type:"float32",data:[Number.NEGATIVE_INFINITY]}],d=t.runWebGPUProgram(u,[c],"int32",p);return l.forEach(h=>t.disposeData(h.dataId)),d}var sZ={kernelName:vu,backendName:"webgpu",kernelFunc:ELe};function NLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n,i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=ps({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),E.assertAxesAreInnerMostDims("argMin",[i[0]],c.shape.length);let u=new Eb(c.shape,i[0],"min"),p=[{type:"float32",data:[Number.POSITIVE_INFINITY]}],d=t.runWebGPUProgram(u,[c],"int32",p);return l.forEach(h=>t.disposeData(h.dataId)),d}var iZ={kernelName:bu,backendName:"webgpu",kernelFunc:NLe};var DLe=Je({opType:be.ASIN}),aZ={kernelName:kc,backendName:"webgpu",kernelFunc:DLe};var ALe=Je({opType:be.ASINH}),cZ={kernelName:Ec,backendName:"webgpu",kernelFunc:ALe};var RLe=Je({opType:be.ATAN}),lZ={kernelName:Nc,backendName:"webgpu",kernelFunc:RLe};var OLe=ir({opType:Ze.ATAN2}),uZ={kernelName:Ac,backendName:"webgpu",kernelFunc:OLe};var MLe=Je({opType:be.ATANH}),pZ={kernelName:Dc,backendName:"webgpu",kernelFunc:MLe};var ON=class{constructor(e){this.variableNames=["x"],this.uniforms="strides : vec2<i32>,",this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="poolWithFilterSizeEqualsOne"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];

          let xRCCorner = coords.yz * uniforms.strides;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          let value = getX(batch, xRCorner, xCCorner, d);
          setOutputAtIndex(index, value);
        }
      }
    `}};var _p=class{constructor(e,t,n=!1,o=!1,s=!1){if(this.variableNames=["x"],this.uniforms="strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, convDims : vec2<i32>, filterDims : vec2<i32>,",this.workgroupSize=[128,1,1],this.size=!0,t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=t,this.computePositions=n,this.flattenPositions=o,this.includeBatchIndex=s,this.shaderKey=`pool2D_${t}_${n}_${o}_${s}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue = resultValue + value; count = count + 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"((batch * uniforms.xShape[1] + xR) * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"(xR * uniforms.xShape[2] + xC) * uniforms.xShape[3] + d":"wR * uniforms.filterDims.y + wC"};
      }`:e="resultValue = max(value, resultValue);";let t="resultValue";return this.poolType==="avg"&&(t="resultValue / max(count, 1.0)"),`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let batch = coords[0];
          let d = coords[3];
          let xRCCorner = vec2<i32>(coords.yz) * uniforms.strides - uniforms.pads;
          let xRCorner = xRCCorner.x;
          let xCCorner = xRCCorner.y;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + uniforms.dilations.x) {
            let xR = xRCorner + wR;

            if (xR < 0 || xR >= uniforms.convDims.x) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + uniforms.dilations.y) {
              let xC = xCCorner + wC;
              if (xC < 0 || xC >= uniforms.convDims.y) {
                continue;
              }

              let value = getX(batch, xR, xC, d);
              ${e}
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${t});`}
        }
      }
    `}},um=class{constructor(e,t,n=!1,o=!1,s=!1){if(this.variableNames=["x"],this.uniforms="strides : vec3<i32>, pads : vec3<i32>, convDims : vec3<i32>, filterDims : vec3<i32>,",this.workgroupSize=[128,1,1],this.size=!0,t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.poolType=t,this.computePositions=n,this.flattenPositions=o,this.includeBatchIndex=s,this.shaderKey=`pool3D_${t}_${n}_${o}_${s}`}getUserCode(){let e;this.poolType==="avg"?e="resultValue += value; count += 1.0;":this.computePositions?e=`let currMaxValue = mix(value, maxValue, maxValueFound);
      if (value >= currMaxValue) {
        maxValue = value;
        maxValueFound = 1.0;
        maxPosition = ${this.flattenPositions?this.includeBatchIndex?"(((batch * uniforms.xShape.y + xD) * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"((xD * uniforms.xShape.z + xR) * uniforms.xShape.w + xC) * uniforms.xShape.u + ch":"wD * uniforms.filterDims.y * uniforms.filterDims.y + wR * uniforms.filterDims.z + wC"};
      }`:e="resultValue = max(value, resultValue);";let t="resultValue";return this.poolType==="avg"&&(t="resultValue / max(count, 1.0)"),`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let batch = coords.x;
          let ch = coords.u;

          let xCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
          let xDCorner = xCorner.x;
          let xRCorner = xCorner.y;
          let xCCorner = xCorner.z;

          ${this.computePositions?`var maxValue = 0.0;
            var maxValueFound = 0.0;
            var maxPosition = 0;`:`var resultValue = ${this.poolType==="avg"?"0.0":"-1.0 / pow(10.0, -20.0)"};`}

          var count = 0.0;
          for (var wD = 0; wD < uniforms.filterDims.x; wD++) {
            let xD = xDCorner + wD;
            if (xD < 0 || xD >= uniforms.convDims.x) {
              continue;
            }

            for (var wR = 0; wR < uniforms.filterDims.y; wR++) {
              let xR = xRCorner + wR;
              if (xR < 0 || xR >= uniforms.convDims.y) {
                continue;
              }

              for (var wC = 0; wC < uniforms.filterDims.z; wC++) {
                let xC = xCCorner + wC;
                if (xC < 0 || xC >= uniforms.convDims.z) {
                  continue;
                }

                let value = getX(batch, xD, xR, xC, ch);
                ${e}
              }
            }
          }

          ${this.computePositions?"setOutputAtIndexI32(index, maxPosition);":`setOutputAtIndex(index, ${t});`}
        }
      }
    `}};function YV(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reductionIndices:s,keepDims:i}=n;return $i(o,s,i,"max",t)}var dZ={kernelName:Lu,backendName:"webgpu",kernelFunc:YV};function ZV(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{keepDims:s,axis:i}=n;return $i(o,i,s,"mean",t)}var hZ={kernelName:zu,backendName:"webgpu",kernelFunc:ZV};function MN(r,e,t,n){if(e.filterWidth===1&&e.filterHeight===1&&C.arraysEqual(e.inShape,e.outShape))return Mn({inputs:{x:r},backend:n});if(e.filterWidth===e.inWidth&&e.filterHeight===e.inHeight&&e.batchSize===1&&e.padInfo.type==="VALID"){let i=r.shape.length,a=Le({inputs:{x:r},backend:n,attrs:{shape:[r.shape[i-3]*r.shape[i-2],r.shape[i-1]]}}),c;t==="avg"?c=ZV({inputs:{x:a},backend:n,attrs:{axis:0,keepDims:!1}}):(C.assert(t==="max",()=>`Invalid pool type ${t}`),c=YV({inputs:{x:a},backend:n,attrs:{reductionIndices:0,keepDims:!1}}));let l=Le({inputs:{x:c},backend:n,attrs:{shape:e.outShape}});return n.disposeData(a.dataId),n.disposeData(c.dataId),l}let o,s=[{type:"int32",data:[e.strideHeight,e.strideWidth]}];return e.filterHeight===1&&e.filterWidth===1?o=new ON(e):(t==="avg"?o=new _p(e,"avg"):(C.assert(t==="max",()=>`Invalid pool type ${t}`),o=new _p(e,"max")),s.push({type:"int32",data:[e.padInfo.top,e.padInfo.left]},{type:"int32",data:[e.dilationHeight,e.dilationWidth]},{type:"int32",data:[e.inHeight,e.inWidth]},{type:"int32",data:[e.effectiveFilterHeight,e.effectiveFilterWidth]})),n.runWebGPUProgram(o,[r],r.dtype,s)}function FLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,u=E.computePool2DInfo(o.shape,s,i,1,a,c);return MN(o,u,"avg",t)}var fZ={kernelName:wu,backendName:"webgpu",kernelFunc:FLe};function PLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=n,u=[1,1,1],p=E.computePool3DInfo(o.shape,s,i,u,a,l,c),d=new um(p,"avg"),h=[{type:"int32",data:[p.strideDepth,p.strideHeight,p.strideWidth]},{type:"int32",data:[p.padInfo.front,p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.inDepth,p.inHeight,p.inWidth]},{type:"int32",data:[p.effectiveFilterDepth,p.effectiveFilterHeight,p.effectiveFilterWidth]}];return t.runWebGPUProgram(d,[o],o.dtype,h)}var mZ={kernelName:Cu,backendName:"webgpu",kernelFunc:PLe};var FN=class{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool2DBackprop"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR = wR + uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC = wC + uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);

            dotProd = dotProd + dyValue * uniforms.avgMultiplier;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},PN=class{constructor(e){this.variableNames=["dy"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
       outDepth : i32, outHeight : i32, outWidth : i32, avgMultiplier : f32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="avgPool3DBackprop"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              dotProd += dyValue * uniforms.avgMultiplier;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function $Le(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=n,p=E.computePool3DInfo(i.shape,a,c,1,l,u),d=new PN(p),h=1/(p.filterDepth*p.filterHeight*p.filterWidth),f=[{type:"int32",data:[p.strideDepth,p.strideHeight,p.strideWidth]},{type:"int32",data:[p.effectiveFilterDepth-1-p.padInfo.front,p.effectiveFilterHeight-1-p.padInfo.top,p.effectiveFilterWidth-1-p.padInfo.left]},{type:"int32",data:[p.effectiveFilterDepth,p.effectiveFilterHeight,p.effectiveFilterWidth]},{type:"int32",data:[p.outDepth]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]},{type:"float32",data:[h]}];return t.runWebGPUProgram(d,[o],i.dtype,f)}var gZ={kernelName:Wh,backendName:"webgpu",kernelFunc:$Le};function LLe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s;__([o,s],"avgPoolGrad");let{filterSize:a,strides:c,pad:l}=n,u=E.computePool2DInfo(i.shape,a,c,1,l),p=new FN(u),d=1/(u.filterHeight*u.filterWidth),h=[{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.effectiveFilterHeight-1-u.padInfo.top,u.effectiveFilterWidth-1-u.padInfo.left]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[u.effectiveFilterHeight,u.effectiveFilterWidth]},{type:"int32",data:[u.outHeight]},{type:"int32",data:[u.outWidth]},{type:"float32",data:[d]}];return t.runWebGPUProgram(p,[o],i.dtype,h)}var yZ={kernelName:Gh,backendName:"webgpu",kernelFunc:LLe};function VLe(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;return hy({a:o,b:s,transposeA:i,transposeB:a,backend:t})}var xZ={kernelName:_u,backendName:"webgpu",kernelFunc:VLe};var $N=class{constructor(e,t){this.variableNames=["source"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.rank=t.length,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.start=e,this.uniforms=`start : ${Jr(e.length)}, `,this.shaderKey="slice"}getUserCode(){let e=Jr(this.rank),t=BLe(this.rank),n;return this.start.length===1?n=this.outputShape.map((s,i)=>"sourceLoc = uniforms.start + coords;"):n=this.outputShape.map((s,i)=>`sourceLoc.${QV[i]} = uniforms.start.${Ua(i)} + coords.${QV[i]};`),`
      ${ue("index")} {
        if (index < uniforms.size) {
          var sourceLoc : ${e};
          let coords = getCoordsFromIndex(index);
          ${n.join(`
`)}
          setOutputAtIndex(index, getSource(${t}));
        }
      }
    `}},QV=["x","y","z","w","u","v"];function BLe(r){if(r===1)return"sourceLoc";if(r<=6)return QV.slice(0,r).map(e=>`sourceLoc.${e}`).join(",");throw Error(`Slicing for rank ${r} is not yet supported`)}function El(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,size:i}=n,[a,c]=Tn.parseSliceParams(o,s,i);if(Tn.assertParamsValid(o,a,c),t.shouldExecuteOnCPU([o])||o.dtype==="string"){let p=t.tensorMap.get(o.dataId),d=W9(p.values,a,c,o.shape,o.dtype);return t.makeTensorInfo(c,o.dtype,d)}if(C.sizeFromShape(c)===0)return t.makeTensorInfo(c,o.dtype,[]);let l=new $N(a,c),u=[{type:"int32",data:a}];return t.runWebGPUProgram(l,[o],o.dtype,u)}var vZ={kernelName:rp,backendName:"webgpu",kernelFunc:El};var zLe=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,crops:i}=n;C.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGPU backend not implemented yet");let a=s.reduce((x,b)=>x*b),c=E.getReshaped(o.shape,s,a),l=E.getPermuted(c.length,s.length),u=E.getReshapedPermuted(o.shape,s,a),p=E.getSliceBeginCoords(i,s.length),d=E.getSliceSize(u,i,s.length),h=[],f=Le({inputs:{x:o},backend:t,attrs:{shape:c}}),m=ps({inputs:{x:f},backend:t,attrs:{perm:l}}),g=Le({inputs:{x:m},backend:t,attrs:{shape:u}}),y=El({inputs:{x:g},backend:t,attrs:{begin:p,size:d}});return h.push(f),h.push(m),h.push(g),h.forEach(x=>t.disposeData(x.dataId)),y},bZ={kernelName:Su,backendName:"webgpu",kernelFunc:zLe};var ULe=`
  fn bincount_write(index: i32, value: f32) {
    ${Mi("&result[index]","value","float32")}
  }
`,GLe=`
  fn bincount_write(index: i32, value: f32) {
    atomicStore(&result[index], bitcast<i32>(value));
  }
`,Nb=class{constructor(e,t,n=!1){this.outputShape=[],this.variableNames=["x"],this.uniforms="binCountSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.hasWeights=!0,this.binaryOutput=!1,this.outputShape=e,this.rank=e.length,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.binaryOutput=n,n&&(this.atomic=!1),this.hasWeights=t,this.hasWeights&&this.variableNames.push("w"),this.shaderKey=`bincount_${this.hasWeights}_${this.binaryOutput}_${this.rank}`}getUserCode(){return`
    ${this.binaryOutput?GLe:ULe}
  ${ue("index")} {
    ${this.rank===1?`if (index < uniforms.xShape) {
      let indexVal = i32(getX(index));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(index)":"1."};
        bincount_write(indexVal, value);
      }
    }`:`let coord = getCoordsFromIndex(index);
    if (coordsInBounds2D(coord, uniforms.xShape)) {
      let indexVal = i32(getX(coord[0], coord[1]));
      if (indexVal < uniforms.binCountSize) {
        let value = ${this.binaryOutput?1:this.hasWeights?"getW(coord[0], coord[1])":"1."};
        bincount_write(coord.x * uniforms.binCountSize + indexVal, value);
      }
    }`}
  }
  `}};function WLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i}=n,a=C.sizeFromShape(o.shape),l=C.sizeFromShape(s.shape)>0,u=[i],p=s.dtype,d=gn({backend:t,attrs:{shape:u,value:0,dtype:p}}),h=new Nb([a],l),f=[{type:"int32",data:[i]}],m=l?[o,s]:[o];return t.runWebGPUProgram(h,m,p,f,d)}var wZ={kernelName:jh,backendName:"webgpu",kernelFunc:WLe};var LN=class{constructor(e){this.outputShape=[],this.variableNames=["s0","s1"],this.uniforms="s0Size : i32, s1Size : i32, ",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="broadcastArgs"}getUserCode(){return`
  ${ue("index")} {
    if (index < uniforms.size) {
      var s0 = 1.0;
      var s1 = 1.0;
      let indexS0 = index - uniforms.size + uniforms.s0Size;
      let indexS1 = index - uniforms.size + uniforms.s1Size;
      if (indexS0 >= 0) {
        s0 = getS0(indexS0);
      }
      if (indexS1 >= 0) {
        s1 = getS1(indexS1);
      }

      if (s0 == 1.0) {
        setOutputAtIndex(index, s1);
      } else if (s1 == 1.0) {
        setOutputAtIndex(index, s0);
      } else if (s0 != s1) {
        setOutputAtIndex(index, uniforms.NAN);
      } else {
        setOutputAtIndex(index, s0);
      }
    }
  }
  `}};function jLe(r){let{inputs:e,backend:t}=r,{s0:n,s1:o}=e;if(t.shouldExecuteOnCPU([n,o])){let u=t.tensorMap.get(n.dataId),p=t.tensorMap.get(o.dataId),d=u.values,h=p.values,f=E.assertAndGetBroadcastShape(Array.from(d),Array.from(h));return t.makeTensorInfo([f.length],"int32",Int32Array.from(f))}let s=C.sizeFromShape(n.shape),i=C.sizeFromShape(o.shape),a=Math.max(s,i),c=new LN(a),l=[{type:"int32",data:[s]},{type:"int32",data:[i]}];return t.runWebGPUProgram(c,[n,o],"int32",l)}var CZ={kernelName:Hh,backendName:"webgpu",kernelFunc:jLe};var JV=ir({opType:Ze.NOT_EQUAL,dtype:"bool",cpuKernelImpl:L9}),_Z={kernelName:wd,backendName:"webgpu",kernelFunc:JV};function Ld(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.tensorMap.get(n.dataId);return Mn({inputs:{x:o.complexTensorInfos.real},backend:t})}var SZ={kernelName:Cf,backendName:"webgpu",kernelFunc:Ld};function IZ(r,e){let t=new Pi(r.shape,be.TO_INT),n=e.runWebGPUProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function eB(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return Mn({inputs:{x:o},backend:t});let i=Cr(o.shape),a=eB({inputs:{x:o},backend:t,attrs:{dtype:"float32"}}),c=ia({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeData(a.dataId),c}if(o.dtype==="complex64"){let i=Ld({inputs:{input:o},backend:t}),a=eB({inputs:{x:i},backend:t,attrs:{dtype:s}});return t.disposeData(i.dataId),a}if(!C.hasEncodingLoss(o.dtype,s)){let i=Mn({inputs:{x:o},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(t.shouldExecuteOnCPU([o])){let i=t.tensorMap.get(o.dataId).values,[a,c,l]=x9(i,o.shape,o.dtype,s);return t.makeTensorInfo(a,c,l)}if(s==="int32")return IZ(o,t);if(s==="bool"){let i=t.makeTensorInfo([],"bool",C.getTypedArrayFromDType("bool",1)),c=JV({inputs:{a:o,b:i},backend:t});return t.disposeData(i.dataId),c}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var TZ={kernelName:Da,backendName:"webgpu",kernelFunc:eB};var HLe=Je({opType:be.CEIL,cpuKernelImpl:v9}),kZ={kernelName:Rc,backendName:"webgpu",kernelFunc:HLe};var VN=class{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workPerThread=4,this.workgroupSize=[64,1,1],this.outputComponent=4,this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.shaderKey="clipVec4"}getUserCode(){return`
      ${ue("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          var clampedValue = clamp(
              value, vec4<f32>(uniforms.minVal), vec4<f32>(uniforms.maxVal));
          clampedValue = select(clampedValue, value, isnanVec4(value));
          setOutputAtIndex(index, clampedValue);
        }
      }
    `}};var BN=class{constructor(e){this.variableNames=["A"],this.uniforms="minVal : f32, maxVal : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="clip"}getUserCode(){return`
      ${ue("index")} {
        if(index < uniforms.size) {
          let value = getAByOutputIndex(index);
          if (isnan(value)) {
            setOutputAtIndex(index, value);
            return;
          }
          setOutputAtIndex(index, clamp(value, uniforms.minVal, uniforms.maxVal));
        }
      }
    `}};function qLe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{clipValueMin:s,clipValueMax:i}=n,a,c=[{type:"float32",data:[s]},{type:"float32",data:[i]}];return C.sizeFromShape(o.shape)%4===0?a=new VN(o.shape):a=new BN(o.shape),t.runWebGPUProgram(a,[o],o.dtype,c)}var EZ={kernelName:Oc,backendName:"webgpu",kernelFunc:qLe};var zN=class{constructor(e){this.outputShape=[],this.variableNames=["real","imag"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="complexAbs"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let re = abs(getRealByOutputIndex(index));
        let im = abs(getImagByOutputIndex(index));
        let mx = max(re, im);

        // The length function in wgsl may be not underflow-safe on some GPUs.
        // So the safe solution is to ensure underflow-safety in all cases.
        setOutputAtIndex(index, select(mx * length(vec2<f32>(1, min(re, im)/mx)), 0.0, mx == 0.0));
      }
    }
  `}};function NZ(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function KLe(r){let{inputs:e,backend:t}=r,{x:n}=e,o=t.tensorMap.get(n.dataId),s=new zN(n.shape),i=[NZ(n,o.complexTensorInfos.real),NZ(n,o.complexTensorInfos.imag)];return t.runWebGPUProgram(s,i,i[0].dtype)}var DZ={kernelName:Iu,backendName:"webgpu",kernelFunc:KLe};var UN=class{constructor(e){this.uniforms="",this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=E.computeOutShape(e,1),this.variableNames=e.map((t,n)=>`T${n}`),this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]),this.offsetLength=e.length-1;for(let t=0;t<this.offsetLength;t++)this.uniforms+=`offset${t} : i32,`;this.shaderKey="concat"}getUserCode(){let e=[];if(this.offsetLength>0){e.push("if (yC < uniforms.offset0){ setOutputAtCoords(coords.x, coords.y, getT0(yR, yC)); }");for(let s=1;s<this.offsetLength;s++)e.push(`else if (yC < uniforms.offset${[s]}){ setOutputAtCoords(coords.x, coords.y, getT${s}(yR, yC - uniforms.offset${s-1})); }`);let n=this.offsetLength,o=this.offsetLength-1;e.push(`else { setOutputAtCoords(coords.x, coords.y, getT${n}(yR, yC - uniforms.offset${o})); }`)}else e.push("setOutputAtCoords(coords.x, coords.y, getT0(yR, yC));");return`
      ${ue("index")} {
        for(var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let flatIndex = index * ${this.workPerThread} + i;
          if(flatIndex < uniforms.size) {
            let coords = getCoordsFromIndex(flatIndex);
            let yR = coords.x;
            let yC = coords.y;

            ${e.join(`
        `)}
          }
        }
      }
    `}};function my(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.tensorMap.get(n.dataId);return Mn({inputs:{x:o.complexTensorInfos.imag},backend:t})}var AZ={kernelName:df,backendName:"webgpu",kernelFunc:my};function Db(r,e,t){let n=r[0].dtype;if(n==="complex64"){let f=r.map(b=>Ld({inputs:{input:b},backend:t})),m=r.map(b=>my({inputs:{input:b},backend:t})),g=Db(f,e,t),y=Db(m,e,t),x=ia({inputs:{real:g,imag:y},backend:t});return f.forEach(b=>t.disposeData(b.dataId)),m.forEach(b=>t.disposeData(b.dataId)),t.disposeData(g.dataId),t.disposeData(y.dataId),x}let o=t.shouldExecuteOnCPU(r);if(n==="string"&&(o=!0),o){let f=r.map(_=>{let S=[-1,C.sizeFromShape(_.shape.slice(e))];return Le({inputs:{x:_},backend:t,attrs:{shape:S}})}),m=f.map(_=>({vals:t.readSync(_.dataId),shape:_.shape})),g=E.computeOutShape(f.map(_=>_.shape),1),y=f[0].shape[0]===1,x=b9(m,g,n,y),b=E.computeOutShape(r.map(_=>_.shape),e),w=t.makeTensorInfo(b,n,x);return f.forEach(_=>t.disposeData(_.dataId)),w}let s=t.device.limits.maxStorageBuffersPerShaderStage-1;if(r.length>s){let f=[];for(let g=0;g<r.length;g+=s){let y=r.slice(g,g+s);f.push(Db(y,e,t))}let m=Db(f,e,t);for(let g of f)t.disposeData(g.dataId);return m}let{tensors2D:i,outShape:a}=XLe(r,e,t),c=i.map(f=>f.shape),l=new UN(c),u=[],p=new Array(c.length-1);if(p.length>0){p[0]=c[0][1],u.push({type:"int32",data:[p[0]]});for(let f=1;f<p.length;f++)p[f]=p[f-1]+c[f][1],u.push({type:"int32",data:[p[f]]})}let d=t.runWebGPUProgram(l,i,i[0].dtype,u);i.forEach(f=>t.disposeData(f.dataId));let h=Le({inputs:{x:d},backend:t,attrs:{shape:a}});return t.disposeData(d.dataId),h}function XLe(r,e,t){let n=E.computeOutShape(r.map(s=>s.shape),e);return{tensors2D:r.map(s=>Le({inputs:{x:s},backend:t,attrs:{shape:[C.sizeFromShape(s.shape.slice(0,e)),C.sizeFromShape(s.shape.slice(e))]}})),outShape:n}}function tB(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n,s=C.parseAxisParam(o,e[0].shape)[0],i=e.map(l=>l.shape);E.assertParamsConsistent(i,s);let a=E.computeOutShape(e.map(l=>l.shape),s);if(C.sizeFromShape(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);let c=e.filter(l=>C.sizeFromShape(l.shape)>0);return c.length===1?Mn({inputs:{x:c[0]},backend:t}):Db(c,s,t)}var RZ={kernelName:Tu,backendName:"webgpu",kernelFunc:tB};function YLe(r,e,t,n,o=!1,s=null,i=!1,a=4,c=4,l=4){let u=R=>{switch(R){case 1:return"resData = f32(x[xIndex]);";case 3:return"resData = vec3<f32>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);";case 4:return"resData = vec4<f32>(x[xIndex / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},p=R=>{switch(R){case 1:return"return f32(W[row * uniforms.wShape[3] + col]);";case 4:return"return vec4<f32>(W[(row * uniforms.wShape[3] + col) / 4]);";default:throw new Error(`innerElementSize ${R} is not supported.`)}},d=r?`
      let coord = vec4<i32>(batch, xRow, xCol, xCh);
      `:`
      let coord = vec4<i32>(batch, xCh, xRow, xCol);
      `,h=r?`
      let coords = vec4<i32>(
        batch,
        row / outWidth,
        row % outWidth,
        col);
      `:`
      let coords = vec4<i32>(
        batch,
        row,
        col / outWidth,
        col % outWidth);
      `,f=r?"uniforms.xShape[1]":"uniforms.xShape[2]",m=r?"uniforms.xShape[2]":"uniforms.xShape[3]",g=r?"row":"col",y=r?"col":"row",x=`
      let inChannels = uniforms.wShape[2];
      let outWidth = ${r?"uniforms.outShape[2]":"uniforms.outShape[3]"};
      let outRow = ${g} / outWidth;
      let outCol = ${g} % outWidth;

      let WRow = ${y} / (uniforms.filterDims[1] * inChannels);
      let WCol = ${y} / inChannels % uniforms.filterDims[1];
      let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * WRow - uniforms.pads[0];
      let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * WCol - uniforms.pads[1];
      let xCh = ${y} % inChannels;
      var resData = ${Mt(a)}(0.0);
      // The bounds checking is always needed since we use it to pad zero for
      // the 'same' padding type.
      if (xRow >= 0 && xRow < ${f} && xCol >= 0 && xCol < ${m}) {
        ${d}
        let xIndex = getIndexFromCoords4D(coord, uniforms.xShape);
        ${u(a)}
      }
      return resData;`,b=r?e&&n?`
      ${x}`:`
      if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${x}
      }
      return ${Mt(a)}(0.0);`:n&&t?`
      ${x}`:`
      if (row < uniforms.dimInner && col < uniforms.dimBOuter) {
        ${x}
      }
      return ${Mt(a)}(0.0);`,w=`${p(c)}`,_=Mt(l),I=r?Mt(a):Mt(c),S=r?Mt(c):Mt(a);return`
      ${Jo(s,i,l===4,4)}
      fn mm_readA(batch: i32, row : i32, col : i32) -> ${I} {
        ${r?b:w}
      }

      fn mm_readB(batch: i32, row : i32, col : i32) -> ${S} {
        ${r?w:b}
      }

      fn mm_write(batch: i32, row : i32, col : i32, valueIn : ${_}) {
        if (row < uniforms.dimAOuter && col < uniforms.dimBOuter)
        {
        var value = valueIn;
        let outWidth = ${r?"uniforms.outShape[2]":"uniforms.outShape[3]"};
        ${h}
        ${Fi(o,s)}
        setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }`}var GN=class{constructor(e,t,n,o,s=!1,i=null,a=!1,c=!1){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=((e.inChannels%4===0||e.inChannels%3===0)&&this.isChannelsLast||e.outWidth%4===0&&!this.isChannelsLast)&&e.outChannels%4===0,this.dispatchLayout=this.isChannelsLast?{x:[3],y:[1,2],z:[0]}:{x:[2,3],y:[1],z:[0]},this.workgroupSize=b_(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=w_(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4?(this.outputComponent=4,this.isChannelsLast&&e.inChannels%4!==0?(this.innerElementSize=3,this.variableComponents=[1,4]):(this.innerElementSize=4,this.variableComponents=[4,4]),s&&(this.variableNames.push("bias"),this.variableComponents.push(4)),a&&(this.variableNames.push("preluActivationWeights"),this.variableComponents.push(4))):(this.innerElementSize=this.elementsPerThread[0],s&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights")),this.sequentialAccessByThreads=c,this.addBias=s,this.activation=i,this.hasPreluActivationWeights=a,this.tileAOuter=this.workgroupSize[1]*this.elementsPerThread[1],this.tileBOuter=this.workgroupSize[0]*this.elementsPerThread[0],this.tileInner=Math.max(this.workgroupSize[0]*this.innerElementSize,this.workgroupSize[1]),this.fitAOuter=t%this.tileAOuter===0,this.fitBOuter=n%this.tileBOuter===0,this.fitInner=o%this.tileInner===0,this.shaderKey=`conv2DMM_${this.elementsPerThread}_${this.activation}}_${this.fitAOuter}_${this.fitBOuter}_${this.fitInner}_${this.isVec4}_${this.innerElementSize}_${this.isChannelsLast}_${this.sequentialAccessByThreads}`}getUserCode(){let e=this.isVec4?py(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner):dy(this.elementsPerThread,this.workgroupSize,!this.isChannelsLast,this.tileInner,!1,null,this.sequentialAccessByThreads),t=this.isVec4?[this.innerElementSize,4,4]:[1,1,1];return`
    ${YLe(this.isChannelsLast,this.fitAOuter,this.fitBOuter,this.fitInner,this.addBias,this.activation,this.hasPreluActivationWeights,t[0],t[1],t[2])}
    ${e}
  `}};var WN=class{constructor(e,t=!1,n=null,o=!1){this.variableNames=["x","W"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>,",this.workgroupSize=[4,4,8],this.outputShape=e.outShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.dispatchLayout=this.isChannelsLast?{x:[2],y:[1],z:[0,3]}:{x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.addBias=t,this.activation=n,this.hasPreluActivationWeights=o,t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.shaderKey=`conv2dnaive_${this.activation}_${this.isChannelsLast}`}getUserCode(){return`
       ${Jo(this.activation,this.hasPreluActivationWeights,!1,4)}
       fn readInp(batch : i32, row : i32, col : i32, chan : i32) -> f32{
         let coords = vec4<i32>(batch, row, col, chan);
         if (coordsInBounds4D(coords, uniforms.xShape)) {
           return  getX(batch, row, col, chan);
         } else {
          return 0.0;
         }
       }
       fn readFilt(row : i32, col : i32, xChannel : i32, outChannel : i32) -> f32{
         let coords = vec4<i32>(row, col, xChannel, outChannel);
         if(coordsInBounds4D(coords, uniforms.wShape)) {
           return getW(row, col, xChannel, outChannel);
          } else {
            return 0.0;
          }
       }
       fn writeResult(batch : i32, row : i32, col : i32, chan : i32, valueIn : f32) {
         let coords = ${this.isChannelsLast?"vec4<i32>(batch, row, col, chan);":"vec4<i32>(batch, chan, row, col);"}
         if (coordsInBounds4D(coords, uniforms.outShape)) {
           var value = valueIn;
           ${Fi(this.addBias,this.activation)}
           setOutputAtCoords(coords.x, coords.y, coords.z, coords.w, value);
         }
       }
       ${ue("index")} {
         let coords = getOutputCoords();
         let batch = coords[0];
         let outChannel = ${this.isChannelsLast?"coords[3];":"coords[1];"}
         let outRow = ${this.isChannelsLast?"coords[1];":"coords[2];"}
         let outCol = ${this.isChannelsLast?"coords[2];":"coords[3];"}
         var acc : f32 = 0.0;
         for (var row = 0; row < uniforms.filterDims[0]; row = row + 1) {
           for (var col = 0; col < uniforms.filterDims[1]; col = col + 1) {
             let xRow = outRow * uniforms.strides[0] + uniforms.dilations[0] * row - uniforms.pads[0];
             let xCol = outCol * uniforms.strides[1] + uniforms.dilations[1] * col - uniforms.pads[1];
             for (var xChannel = 0; xChannel < ${this.isChannelsLast?"uniforms.xShape[3];":"uniforms.xShape[1];"} xChannel = xChannel + 1) {
               ${this.isChannelsLast?"let v = readInp(batch, xRow, xCol, xChannel);":"let v = readInp(batch, xChannel, xRow, xCol);"}
               let f = readFilt(row, col, xChannel, outChannel);
               acc = acc + v * f;
             }
           }
         }
         writeResult(batch, outRow, outCol, outChannel, acc);
       }
     `}};var jN=class{constructor(e,t){this.variableNames=["x"],this.uniforms=`pads : vec2<i32>, strides : vec2<i32>, dilations : vec2<i32>, outWidth : i32, itemsPerBlockRow : i32,
       inChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=t,this.shaderKey=`im2col_${this.isChannelsLast}`}getUserCode(){let e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?"coords[1]":"coords[2]",o=this.isChannelsLast?"coords[2]":"coords[1]",s=this.isChannelsLast?"getX(batch, xRow, xCol, ch)":"getX(batch, ch, xRow, xCol)";return`
    ${ue("index")} {
      let coords = getCoordsFromIndex(index);
      if(index < uniforms.size) {
        let batch = coords[0];
        let row = ${n};
        let col = ${o};
        let offsetY = (row / uniforms.outWidth) * uniforms.strides[0] - uniforms.pads[0];
        let xRow = offsetY + uniforms.dilations[0] * (col / uniforms.itemsPerBlockRow);
        var value = 0.0;
        if(xRow < uniforms.xShape[${e}] && xRow >= 0) {
          let offsetX = (row % uniforms.outWidth) * uniforms.strides[1] -
              uniforms.pads[1];
          let xCol = offsetX + uniforms.dilations[1] * ((col %
              uniforms.itemsPerBlockRow) / uniforms.inChannels);
          let ch = col % uniforms.inChannels;
          if(xCol < uniforms.xShape[${t}] && xCol >= 0) {
            value = ${s};
          }
        }
        setOutputAtIndex(index, value);
      }
    }
   `}};function HN(r,e){let t=r.length;return t>=3?e?[...r.slice(0,-3),r[t-3]*r[t-2],r[t-1]]:[...r.slice(0,-3),r[t-3],r[t-2]*r[t-1]]:!e&&t===1&&r[0]>1?[r[0],1]:null}function ZLe({x:r,filter:e,convInfo:t,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let c=t.dataFormat==="channelsLast",l=!c,u=!1,p=c&&t.filterHeight===t.inHeight&&t.filterWidth===t.inWidth&&t.padInfo.type==="VALID",d=[],h,f;if(p){let y=t.inHeight*t.inWidth*t.inChannels;h=Le({inputs:{x:r},backend:n,attrs:{shape:[1,t.batchSize,y]}}),f=Le({inputs:{x:e},backend:n,attrs:{shape:[1,y,t.outChannels]}})}else h=Le({inputs:{x:r},backend:n,attrs:{shape:c?[t.batchSize,t.inHeight*t.inWidth,t.inChannels]:[t.batchSize,t.inChannels,t.inHeight*t.inWidth]}}),f=Le({inputs:{x:e},backend:n,attrs:{shape:[1,t.inChannels,t.outChannels]}});if(d.push(h),d.push(f),s!=null){let y=HN(s.shape,c);y!=null&&(s=Le({inputs:{x:s},backend:n,attrs:{shape:y}}),d.push(s))}if(o!=null){let y=HN(o.shape,c);y!=null&&(o=Le({inputs:{x:o},backend:n,attrs:{shape:y}}),d.push(o))}let m=hy({a:c?h:f,b:c?f:h,transposeA:l,transposeB:u,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),g=Le({inputs:{x:m},backend:n,attrs:{shape:t.outShape}});d.push(m);for(let y of d)n.disposeData(y.dataId);return g}function QLe({x:r,filter:e,convInfo:t,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:c,filterHeight:l,inChannels:u,strideWidth:p,strideHeight:d,padInfo:h,outWidth:f,outHeight:m,dilationWidth:g,dilationHeight:y,dataFormat:x}=t,b=x==="channelsLast",w=c*l*u,_=m*f,I=b?[t.batchSize,_,w]:[t.batchSize,w,_],S=new jN(I,b),k=[{type:"int32",data:[h.top,h.left]},{type:"int32",data:[d,p]},{type:"int32",data:[y,g]},{type:"int32",data:[f]},{type:"int32",data:[u*c]},{type:"int32",data:[u]}],R=n.runWebGPUProgram(S,[r],r.dtype,k),L=[];L.push(R);let B=Le({inputs:{x:e},backend:n,attrs:{shape:[1,w,-1]}});if(L.push(B),s!=null){let j=HN(s.shape,b);j!=null&&(s=Le({inputs:{x:s},backend:n,attrs:{shape:j}}),L.push(s))}if(o!=null){let j=HN(o.shape,b);j!=null&&(o=Le({inputs:{x:o},backend:n,attrs:{shape:j}}),L.push(o))}let U=hy({a:b?R:B,b:b?B:R,transposeA:!b,transposeB:!1,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),G=Le({inputs:{x:U},backend:n,attrs:{shape:t.outShape}});L.push(U);for(let j of L)n.disposeData(j.dataId);return G}function qN({x:r,filter:e,convInfo:t,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let c=o!=null,l=s!=null,u=t.dataFormat==="channelsLast",p=u&&t.filterHeight===t.inHeight&&t.filterWidth===t.inWidth&&t.padInfo.type==="VALID",d=Z().getBool("WEBGPU_USE_NAIVE_CONV2D_DEBUG");if(!d&&(p||t.filterHeight===1&&t.filterWidth===1&&t.dilationHeight===1&&t.dilationWidth===1&&t.strideHeight===1&&t.strideWidth===1&&(t.padInfo.type==="SAME"||t.padInfo.type==="VALID")))return ZLe({x:r,filter:e,convInfo:t,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});let h=Z().getNumber("WEBGPU_THRESHOLD_TO_INCREASE_WORKGROUPS_FOR_MATMUL"),f=h>-1?h:n.thresholdToIncreaseWorkgroups,m=t.batchSize*Math.ceil(t.outHeight*t.outWidth/32)*Math.ceil(t.outChannels/32);if(Z().getBool("WEBGPU_CONV_SEPARATE_IM2COL_SHADER")||m<=f)return QLe({x:r,filter:e,convInfo:t,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:i,activation:a});let g,y=[t.padInfo.top,t.padInfo.left],x=[{type:"int32",data:[t.filterHeight,t.filterWidth]},{type:"int32",data:[...y]},{type:"int32",data:[t.strideHeight,t.strideWidth]},{type:"int32",data:[t.dilationHeight,t.dilationWidth]}];if(d)g=new WN(t,c,a,l);else{let I=u?t.outHeight*t.outWidth:t.outChannels,S=u?t.outChannels:t.outHeight*t.outWidth,k=t.filterHeight*t.filterWidth*t.inChannels;x.push({type:"int32",data:[I]},{type:"int32",data:[S]},{type:"int32",data:[k]});let R=n.adapterInfo.isIntel();g=new GN(t,I,S,k,c,a,l,R)}let b=[],w=[r,e];c&&(!u&&o.shape.length===1&&(o=Le({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}}),b.push(o)),w.push(o)),l&&(!u&&s.shape.length===1&&(s=Le({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}}),b.push(s)),w.push(s)),a==="leakyrelu"&&(x.push({type:"float32",data:[i]}),g.uniforms+=" alpha : f32,");let _=n.runWebGPUProgram(g,w,r.dtype,x);for(let I of b)n.disposeData(I.dataId);return _}function JLe(r){let{inputs:e,attrs:t,backend:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=t,p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,s.shape,i,l,a,u,!1,p);return qN({x:o,filter:s,convInfo:d,backend:n})}var OZ={kernelName:ku,backendName:"webgpu",kernelFunc:JLe};var KN=class{constructor(e){this.variableNames=["dy","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>,",this.workgroupSize=[64,1,1],this.size=!1,this.isVec4=!1,this.workPerThread=1,this.outputShape=e.inShape,this.isChannelsLast=e.dataFormat==="channelsLast",this.isVec4=this.isChannelsLast&&e.outChannels%4===0&&e.inChannels%4===0,this.isVec4?(this.workPerThread=2,this.outputComponent=4,this.workgroupSize=[4,4,4],this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[4,this.workPerThread,1])):(this.size=!0,this.workPerThread=1,this.workgroupSize=[64,1,1],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize)),this.shaderKey=`conv2DDerInput_${this.isChannelsLast}_${this.isVec4}_${this.workPerThread}`}getUserCode(){let e=this.isChannelsLast?1:2,t=this.isChannelsLast?2:3,n=this.isChannelsLast?3:1,o=`
    ${ue()} {
      let batch = i32(globalId.z) / uniforms.outShape[1];
      let r = i32(globalId.z) % uniforms.outShape[1];
      let c = i32(globalId.y) * ${this.workPerThread};
      let d1 = i32(globalId.x) * 4;

      let dyCorner = vec2<i32>(r, c) - uniforms.pads;

      // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
      // ? = to be determined. : = across all values in that axis.
      var dotProd: array<vec4<f32>, ${this.workPerThread}>;
      for (var i = 0; i < ${this.workPerThread}; i++) {
        dotProd[i] = vec4<f32>(0.0);
      }
      for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
        let dyR = f32(dyCorner.x + wR) / f32(uniforms.strides.x);
        let wRPerm = uniforms.filterDims.x - 1 - wR;
        if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) ||
            fract(dyR) > 0.0) {
          continue;
        }
        let idyR = i32(dyR);

        for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
          let dyC = f32(dyCorner.y + wC) / f32(uniforms.strides.y);
          let dyC2 = f32(dyCorner.y + 1 + wC) / f32(uniforms.strides.y);
          let wCPerm = uniforms.filterDims.y - 1 - wC;
          var bDyCVal = true;
          var bDyCVal2 = true;
          if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
              fract(dyC) > 0.0) {
            bDyCVal = false;
          }
          if (dyC2 < 0.0 || dyC2 >= f32(uniforms.outBackprop[2]) ||
              fract(dyC2) > 0.0) {
            bDyCVal2 = false;
          }

          let idyC = i32(dyC);
          let idyC2 = i32(dyC2);
          if (bDyCVal && bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
              xValue = getDy(batch, idyR, idyC2, d2);
              dotProd[1] = dotProd[1] + vec4<f32>(dot(xValue, wValue0),
                                                  dot(xValue, wValue1),
                                                  dot(xValue, wValue2),
                                                  dot(xValue, wValue3));
            }
          } else if (bDyCVal) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[0] = dotProd[0] + tmpval;
            }
          } else if (bDyCVal2) {
            let d2Length = uniforms.outBackprop[3];
            for (var d2 = 0; d2 < d2Length; d2 = d2 + 4) {
              let wValue0 = getW(wRPerm, wCPerm, d1, d2);
              let wValue1 = getW(wRPerm, wCPerm, d1 + 1, d2);
              let wValue2 = getW(wRPerm, wCPerm, d1 + 2, d2);
              let wValue3 = getW(wRPerm, wCPerm, d1 + 3, d2);
              var xValue =  getDy(batch, idyR, idyC2, d2);
              let tmpval = vec4<f32>(dot(xValue, wValue0),
                                     dot(xValue, wValue1),
                                     dot(xValue, wValue2),
                                     dot(xValue, wValue3));
              dotProd[1] = dotProd[1] + tmpval;
            }
          }
        }
      }

      for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
        let coords = vec4<i32>(batch, r, c + i, d1);
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], dotProd[i]);
        }
      }
    }
    `;return this.isVec4?`
    ${o}
    `:`
    ${ue("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[${n}];

        let dyCorner = vec2<i32>(coords[${e}], coords[${t}]) - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims.x; wR = wR + 1) {
          let dyR = (f32(dyRCorner) + f32(wR)) / f32(uniforms.strides.x);
          let wRPerm = uniforms.filterDims.x - 1 - wR;
          if (dyR < 0.0 || dyR >= f32(uniforms.outBackprop[1]) || fract(dyR) > 0.0 ||
              wRPerm < 0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims.y; wC = wC + 1) {
            let dyC = (f32(dyCCorner) + f32(wC)) / f32(uniforms.strides.y);
            let wCPerm = uniforms.filterDims.y - 1 - wC;
            if (dyC < 0.0 || dyC >= f32(uniforms.outBackprop[2]) ||
                fract(dyC) > 0.0 || wCPerm < 0) {
              continue;
            }
            let idyC = i32(dyC);

            for (var d2 = 0; d2 < uniforms.outBackprop[3]; d2 = d2 + 1) {
              let xValue = ${this.isChannelsLast?"getDy(batch, idyR, idyC, d2)":"getDy(batch, d2, idyR, idyC)"};
              let wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd = dotProd + xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},XN=class{constructor(e){this.variableNames=["x","dy"],this.uniforms="pads : vec2<i32>, strides : vec2<i32>, batchSize : i32, outHeight : i32, outWidth : i32, inHeight : i32, inWidth : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",this.shaderKey=`conv2DDerFilter_${this.isChannelsLast}`}getUserCode(){return`
    ${ue("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let d2 = coords[3];

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b = b + 1) {
          for (var yR = 0; yR < uniforms.outHeight; yR = yR + 1) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];
            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC = yC + 1) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              if (${this.isChannelsLast}) {
                let dyValue = getDy(b, yR, yC, d2);
                let xValue = getX(b, xR, xC, d1);
                dotProd = dotProd + xValue * dyValue;
              } else {
                let dyValue = getDy(b, d2, yR, yC);
                let xValue = getX(b, d1, xR, xC);
                dotProd = dotProd + xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},YN=class{constructor(e){this.variableNames=["x","dy"],this.uniforms=`pads : vec3<i32>, strides : vec3<i32>, batchSize : i32, outDepth : i32,
       outHeight : i32, outWidth : i32, inDepth : i32, inHeight : i32, inWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerFilter"}getUserCode(){return`
    ${ue("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wF = coords.x;
        let wR = coords.y;
        let wC = coords.z;
        let d1 = coords.w;
        let d2 = coords.u;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yF = 0; yF < uniforms.outDepth; yF++) {
            let xF = wF + yF * uniforms.strides[0] - uniforms.pads[0];
            if (xF < 0 || xF >= uniforms.inDepth) {
              continue;
            }

            for (var yR = 0; yR < uniforms.outHeight; yR++) {
              let xR = wR + yR * uniforms.strides[1] - uniforms.pads[1];
              if (xR < 0 || xR >= uniforms.inHeight) {
                continue;
              }

              for (var yC = 0; yC < uniforms.outWidth; yC++) {
                let xC = wC + yC * uniforms.strides[2] - uniforms.pads[2];
                if (xC < 0 || xC >= uniforms.inWidth) {
                  continue;
                }

                let dyValue = getDy(b, yF, yR, yC, d2);
                let xValue = getX(b, xF, xR, xC, d1);
                dotProd += xValue * dyValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}},ZN=class{constructor(e){this.variableNames=["dy","W"],this.uniforms=`filterDims : vec3<i32>, pads : vec3<i32>, strides : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32, outChannels : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3DDerInput"}getUserCode(){return`
    ${ue("index")} {
      if(index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let d1 = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyFCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let dyF = f32(dyFCorner + wF) / f32(uniforms.strides[0]);
          if (dyF < 0.0 || dyF >= f32(uniforms.outDepth) || fract(dyF) > 0.0) {
            continue;
          }
          let idyF = i32(dyF);

          let wFPerm = uniforms.filterDims[0] - 1 - wF;

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            let wRPerm = uniforms.filterDims[1] - 1 - wR;

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let wCPerm = uniforms.filterDims[2] - 1 - wC;

              for (var d2 = 0; d2 < uniforms.outChannels; d2++) {
                let xValue = getDy(batch, idyF, idyR, idyC, d2);
                let wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
  `}};function e3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=n,p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,u,i,1,a,l,!1,p),h=new XN(d),f=[{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.batchSize]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]},{type:"int32",data:[d.inHeight]},{type:"int32",data:[d.inWidth]}];return t.runWebGPUProgram(h,[o,s],o.dtype,f)}var MZ={kernelName:Kh,backendName:"webgpu",kernelFunc:e3e};function t3e(r=4){let e=s=>{switch(s){case 1:return"return W[getIndexFromCoords4D(coord, uniforms.wShape)];";case 4:return`
            let coord1 = vec4<i32>(coordX, coordY, col + 1, rowInner);
            let coord2 = vec4<i32>(coordX, coordY, col + 2, rowInner);
            let coord3 = vec4<i32>(coordX, coordY, col + 3, rowInner);
            let v0 = W[getIndexFromCoords4D(coord, uniforms.wShape)];
            let v1 = W[getIndexFromCoords4D(coord1, uniforms.wShape)];
            let v2 = W[getIndexFromCoords4D(coord2, uniforms.wShape)];
            let v3 = W[getIndexFromCoords4D(coord3, uniforms.wShape)];
            return vec4<f32>(v0, v1, v2, v3);
            `;default:throw new Error(`innerElementSize ${s} is not supported.`)}},n=`if (row < uniforms.dimAOuter && col < uniforms.dimInner) {
        ${`
      let outRow = row / uniforms.outShape[2];
      let outCol = row % uniforms.outShape[2];

      let WRow = col / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
      let WCol = col / uniforms.outBackprop[3] % uniforms.filterDims[1];
      let xR = f32(outRow - uniforms.pads[0] + WRow) / f32(uniforms.strides[0]);
      let xC = f32(outCol - uniforms.pads[1] + WCol) / f32(uniforms.strides[1]);
      if (xR < 0.0 || xR >= f32(uniforms.outBackprop[1]) || fract(xR) > 0.0) {
        return ${Mt(r)}(0.0);
      }
      if (xC < 0.0 || xC >= f32(uniforms.outBackprop[2]) || fract(xC) > 0.0) {
        return ${Mt(r)}(0.0);
      }
      let coord = vec4<i32>(
          batch,
          i32(xR),
          i32(xC),
          col % uniforms.outBackprop[3]);
      return x[getIndexFromCoords4D(coord, uniforms.xShape)/${r}];`}
      }
      return ${Mt(r)}(0.0);`;return`
  fn mm_readA(batch: i32, row : i32, col : i32) -> ${Mt(r)} {
    ${n}
  }

  fn mm_readB(batch: i32, row : i32, col : i32) -> ${Mt(r)} {
    let coordX = uniforms.filterDims.x - 1 -
        row / (uniforms.filterDims[1] * uniforms.outBackprop[3]);
    let coordY = uniforms.filterDims.y - 1 -
        (row / uniforms.outBackprop[3]) % uniforms.filterDims[1];
    if (row < uniforms.dimInner && col < uniforms.dimBOuter &&
        coordX >= 0 && coordY >= 0) {
      let rowInner = row % uniforms.outBackprop[3];
      let coord = vec4<i32>(coordX, coordY, col, rowInner);
      ${e(r)}
    }
    return ${Mt(r)}(0.0);
  }

  fn mm_write(batch: i32, row : i32, col : i32, valueInput : ${Mt(r)}) {
    if (row < uniforms.dimAOuter && col < uniforms.dimBOuter) {
      var value = valueInput;
      let outCoord = vec4<i32>(
          batch,
          row / uniforms.outShape[2],
          row % uniforms.outShape[2],
          col);
      result[getIndexFromCoords4D(outCoord, uniforms.outShape)/${r}] = value;
    }
  }`}var QN=class{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims : vec2<i32>, pads : vec2<i32>, strides : vec2<i32>, outBackprop : vec4<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32,",this.outputShape=e.inShape,C.assert(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),this.isVec4=e.inChannels%4===0&&e.outChannels%4===0,this.dispatchLayout={x:[3],y:[1,2],z:[0]},this.workgroupSize=b_(this.dispatchLayout,this.outputShape,this.isVec4),this.elementsPerThread=w_(this.dispatchLayout,this.outputShape,this.isVec4),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,this.elementsPerThread),this.isVec4&&(this.outputComponent=4,this.variableComponents=[4,1]),this.shaderKey=`conv2DDerInputMM_${this.isVec4}_${this.elementsPerThread}`}getUserCode(){let e=this.isVec4?py(this.elementsPerThread,this.workgroupSize):dy(this.elementsPerThread,this.workgroupSize);return`
    ${t3e(this.isVec4?4:1)}
    ${e}
    `}};function r3e(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=n,p=E.convertConv2DDataFormat(l),d=E.computeConv2DInfo(i,s.shape,a,1,c,u,!1,p),h=[{type:"int32",data:[d.filterHeight,d.filterWidth]},{type:"int32",data:[d.filterHeight-1-d.padInfo.top,d.filterWidth-1-d.padInfo.left]},{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.batchSize,d.outHeight,d.outWidth,d.outChannels]}],f;if(Z().getBool("WEBGPU_USE_NAIVE_CONV2D_TRANSPOSE")||d.dataFormat!=="channelsLast")f=new KN(d);else{f=new QN(d);let m=d.inHeight*d.inWidth,g=d.inChannels,y=d.filterHeight*d.filterWidth*d.outChannels;h.push({type:"uint32",data:[m]},{type:"uint32",data:[g]},{type:"uint32",data:[y]})}return t.runWebGPUProgram(f,[o,s],"float32",h)}var FZ={kernelName:Eu,backendName:"webgpu",kernelFunc:r3e};var JN=class{constructor(e){this.variableNames=["x","W"],this.uniforms="filterDims: vec3<i32>, pads: vec3<i32>, strides: vec3<i32>, dilations: vec3<i32>,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="conv3dnaive"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords.x;
        let d2 = coords.u;

        let xFRCCorner = vec3<i32>(coords.y, coords.z, coords.w) * uniforms.strides - uniforms.pads;
        let xFCorner = xFRCCorner.x;
        let xRCorner = xFRCCorner.y;
        let xCCorner = xFRCCorner.z;

        let inputDepthNearestVec4 = (uniforms.xShape.u / 4) * 4;
        let inputDepthVec4Remainder = uniforms.xShape.u % 4;

        var dotProd = 0.0;
        for (var wF = 0; wF < uniforms.filterDims[0]; wF++) {
          let xF = xFCorner + wF * uniforms.dilations[0];
          if (xF < 0 || xF >= uniforms.xShape.y) {
            continue;
          }

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let xR = xRCorner + wR * uniforms.dilations[1];
            if (xR < 0 || xR >= uniforms.xShape.z) {
              continue;
            }

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let xC = xCCorner + wC * uniforms.dilations[2];
              if (xC < 0 || xC >= uniforms.xShape.w) {
                continue;
              }

              for (var d1 = 0; d1 < inputDepthNearestVec4; d1 += 4) {
                let xValues = vec4<f32>(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                let wValues = vec4<f32>(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (inputDepthVec4Remainder == 1) {
                dotProd += getX(batch, xF, xR, xC, inputDepthNearestVec4) *
                  getW(wF, wR, wC, inputDepthNearestVec4, d2);
              } else if (inputDepthVec4Remainder == 2) {
                let xValues = vec2<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1)
                );
                let wValues = vec2<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (inputDepthVec4Remainder == 3) {
                let xValues = vec3<f32>(
                  getX(batch, xF, xR, xC, inputDepthNearestVec4),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                  getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2)
                );
                let wValues = vec3<f32>(
                  getW(wF, wR, wC, inputDepthNearestVec4, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 1, d2),
                  getW(wF, wR, wC, inputDepthNearestVec4 + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }`}};function n3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c}=n,l=E.computeConv3DInfo(o.shape,s.shape,i,c,a),u=[l.padInfo.front,l.padInfo.top,l.padInfo.left],p=[{type:"int32",data:[l.filterDepth,l.filterHeight,l.filterWidth]},{type:"int32",data:[...u]},{type:"int32",data:[l.strideDepth,l.strideHeight,l.strideWidth]},{type:"int32",data:[l.dilationDepth,l.dilationHeight,l.dilationWidth]}],d=new JN(l),h=$r(o.dtype,s.dtype);return t.runWebGPUProgram(d,[o,s],h,p)}var PZ={kernelName:Nu,backendName:"webgpu",kernelFunc:n3e};function o3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:c}=n,l=E.computeConv3DInfo(o.shape,c,i,1,a),u=new YN(l),p=[{type:"int32",data:[l.padInfo.front,l.padInfo.top,l.padInfo.left]},{type:"int32",data:[l.strideDepth,l.strideHeight,l.strideWidth]},{type:"int32",data:[l.batchSize]},{type:"int32",data:[l.outDepth]},{type:"int32",data:[l.outHeight]},{type:"int32",data:[l.outWidth]},{type:"int32",data:[l.inDepth]},{type:"int32",data:[l.inHeight]},{type:"int32",data:[l.inWidth]}];return t.runWebGPUProgram(u,[o,s],s.dtype,p)}var $Z={kernelName:Xh,backendName:"webgpu",kernelFunc:o3e};function s3e(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{strides:i,pad:a,inputShape:c}=n,l=E.computeConv3DInfo(c,s.shape,i,1,a),u=new ZN(l),p=[{type:"int32",data:[l.filterDepth,l.filterHeight,l.filterWidth]},{type:"int32",data:[l.filterDepth-1-l.padInfo.front,l.filterHeight-1-l.padInfo.top,l.filterWidth-1-l.padInfo.left]},{type:"int32",data:[l.strideDepth,l.strideHeight,l.strideWidth]},{type:"int32",data:[l.outDepth]},{type:"int32",data:[l.outHeight]},{type:"int32",data:[l.outWidth]},{type:"int32",data:[l.outChannels]}];return t.runWebGPUProgram(u,[o,s],o.dtype,p)}var LZ={kernelName:Yh,backendName:"webgpu",kernelFunc:s3e};var i3e=Je({opType:be.COS}),VZ={kernelName:Mc,backendName:"webgpu",kernelFunc:i3e};var a3e=Je({opType:be.COSH}),BZ={kernelName:Fc,backendName:"webgpu",kernelFunc:a3e};var eD=class{constructor(e,t,n,o){this.variableNames=["Image","Boxes","BoxInd"],this.uniforms="extrapolationValue : f32,",this.workgroupSize=[64,1,1],this.size=!0;let[s]=t;this.outputShape=[s,n[0],n[1],e],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.methodId=o==="bilinear"?1:0,this.cropHeightBiggerThan1=this.outputShape[1]>1,this.cropWidthBiggerThan1=this.outputShape[2]>1,this.shaderKey=`cropAndResize_${this.methodId}_${this.cropHeightBiggerThan1}_${this.cropWidthBiggerThan1}`}getUserCode(){let[e,t]=["f32(uniforms.imageShape[1] - 1)","f32(uniforms.imageShape[2] - 1)"],[n,o,s]=this.cropHeightBiggerThan1?[`(${e} / f32(uniforms.outShape[1] - 1))`,"(y2-y1) * height_ratio",`y1*${e} + f32(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${e}`],[i,a,c]=this.cropWidthBiggerThan1?[`(${t} / f32(uniforms.outShape[2] - 1))`,"(x2-x1) * width_ratio",`x1*${t} + f32(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${t}`];return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let height_ratio = f32(${n});
        let width_ratio = f32(${i});
        let b = coords[0];
        let y = coords[1];
        let x = coords[2];
        let d = coords[3];
        // get box vals
        let y1 = getBoxes(b, 0);
        let x1 = getBoxes(b, 1);
        let y2 = getBoxes(b, 2);
        let x2 = getBoxes(b, 3);
        // get image in batch index
        let bInd = i32(round(getBoxInd(b)));
        if(bInd < 0 || bInd >= uniforms.outShape[0]) {
          return;
        }
        let height_scale = ${o};
        let width_scale = ${a};
        let in_y = ${s};
        if( in_y < 0.0 || in_y > ${e} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let in_x = ${c};
        if( in_x < 0.0 || in_x > ${t} ) {
          setOutputAtIndex(index, uniforms.extrapolationValue);
          return;
        }
        let sourceFracIndexCR = vec2<f32>(in_x,in_y);
        if(${this.methodId} == 1) {
          // Compute the four integer indices.
          let sourceFloorCR = vec2<i32>(sourceFracIndexCR);
          let sourceCeilCR = vec2<i32>(ceil(sourceFracIndexCR));
          let topLeft = getImage(bInd, sourceFloorCR.y, sourceFloorCR.x, d);
          let bottomLeft = getImage(bInd, sourceCeilCR.y, sourceFloorCR.x, d);
          let topRight = getImage(bInd, sourceFloorCR.y, sourceCeilCR.x, d);
          let bottomRight = getImage(bInd, sourceCeilCR.y, sourceCeilCR.x, d);
          let fracCR = sourceFracIndexCR - vec2<f32>(sourceFloorCR);
          let top = topLeft + (topRight - topLeft) * fracCR.x;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          let newValue = top + (bottom - top) * fracCR.y;
          setOutputAtIndex(index, newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          let sourceNearestCR = vec2<i32>(floor(
            sourceFracIndexCR + vec2<f32>(0.5,0.5)));
          let newValue = getImage(
            bInd, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutputAtIndex(index, newValue);
        }
      }
    }
    `}};var c3e=r=>{let{inputs:e,backend:t,attrs:n}=r,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=n,u=new eD(o.shape[3],s.shape,a,c),p=[{type:"float32",data:[l]}];return t.runWebGPUProgram(u,[o,s,i],"float32",p)},zZ={kernelName:Qh,backendName:"webgpu",kernelFunc:c3e};var Ab=function(r){return r.Prod="*",r.Sum="+",r}(Ab||{}),D_=class{constructor(e,t,n,o){this.variableNames=["x"],this.uniforms="index : f32,",this.size=!0,this.workgroupSize=[128,1,1],this.outputShape=t,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.exclusive=n,this.reverse=o,this.op=e,this.shaderKey=`cum_${this.op}_${this.exclusive}_${this.reverse}`}getUserCode(){let e=this.outputShape.length,t=this.op===Ab.Prod?"1.0":"0.0",n=this.exclusive?t:`getX(${UZ(e,"coords",this.op)})`,o=this.outputShape[this.outputShape.length-1],s="",i="";return this.exclusive?(s=this.reverse?`end != ${o-1}`:"end != 0",i=this.reverse?"end + 1":"end - 1"):(s=this.reverse?`end + pow2 < ${o}`:"end >= pow2",i=this.reverse?"end + pow2":"end - pow2"),`
      ${ue("index")} {
       if (index < uniforms.size) {
         var coords = getCoordsFromIndex(index);

         let end = ${GZ(e,"coords",this.op)};
         var val = ${n};
         let pow2 = i32(pow(2.0, uniforms.index));
         if (${s}) {
           let idx = ${i};
           ${GZ(e,"coords",this.op)} = idx;
           val ${this.op}= getX(${UZ(e,"coords",this.op)});
         }
         setOutputAtIndex(index, val);
       }
      }
    `}};function UZ(r,e,t){if(r===1)return`${e}`;if(r===2)return`${e}.x, ${e}.y`;if(r===3)return`${e}.x, ${e}.y, ${e}.z`;if(r===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative ${t} for rank ${r} is not yet supported`)}function GZ(r,e,t){if(r===1)return`${e}`;if(r===2)return`${e}.y`;if(r===3)return`${e}.z`;if(r===4)return`${e}.w`;throw Error(`Cumulative ${t} for rank ${r} is not yet supported`)}function tD(r,e,t,n,o,s){let i=e.shape.length,a=E.getAxesPermutation([n],i),c=e;a!=null&&(c=ps({inputs:{x:e},backend:t,attrs:{perm:a}}));let l=E.getInnerMostAxes(1,i)[0];if(l!==i-1)throw new Error(`WebGPU cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${n}`);let u=c.shape[l],p=Mn({inputs:{x:c},backend:t});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){let h=new D_(r,c.shape,!1,s),f=p,m=[{type:"float32",data:[d]}];p=t.runWebGPUProgram(h,[p],p.dtype,m),t.disposeData(f.dataId)}if(o){let d=new D_(r,c.shape,o,s),h=p,f=[{type:"float32",data:[0]}];p=t.runWebGPUProgram(d,[p],p.dtype,f),t.disposeData(h.dataId)}if(a!=null){let d=E.getUndoAxesPermutation(a),h=ps({inputs:{x:p},backend:t,attrs:{perm:d}});return t.disposeData(p.dataId),t.disposeData(c.dataId),h}return p}function l3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return tD(Ab.Prod,o,t,s,i,a)}var WZ={kernelName:Zh,backendName:"webgpu",kernelFunc:l3e};function u3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return tD(Ab.Sum,o,t,s,i,a)}var jZ={kernelName:Du,backendName:"webgpu",kernelFunc:u3e};function p3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n,c=o.shape.length===1,u=C.sizeFromShape(s.shape)>0,p=s.dtype,d=c?[o.shape[0]]:[o.shape[0],o.shape[1]],h=c?[i]:[o.shape[0],i],f=gn({backend:t,attrs:{shape:h,value:0,dtype:p}}),m=new Nb(d,u,a),g=[{type:"int32",data:[i]}],y=u?[o,s]:[o];return t.runWebGPUProgram(m,y,p,g,f)}var HZ={kernelName:Jh,backendName:"webgpu",kernelFunc:p3e};var rD=class{constructor(e,t){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.uniforms="blockSize : i32,",this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`depthToSpace_${t}`,this.dataFormat=t}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let h = ${this.getHeightCoordString()};
          let w = ${this.getWidthCoordString()};
          let d = ${this.getDepthCoordString()};

          let in_h = h / uniforms.blockSize;
          let offset_h = h % uniforms.blockSize;
          let in_w = w / uniforms.blockSize;
          let offset_w = w % uniforms.blockSize;
          let offset_d = (offset_h * uniforms.blockSize + offset_w) *
            ${this.getOutputDepthSize()};
          let in_d = d + offset_d;

          let rlt = ${this.getInputSamplingString()};
          setOutputAtIndex(index, rlt);
        }
      }`}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?"uniforms.outShape[3]":"uniforms.outShape[1]"}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function d3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockSize:s,dataFormat:i}=n,a=o.shape[0],c=i==="NHWC"?o.shape[1]:o.shape[2],l=i==="NHWC"?o.shape[2]:o.shape[3],u=i==="NHWC"?o.shape[3]:o.shape[1],p=c*s,d=l*s,h=u/(s*s),f=i==="NHWC"?[a,p,d,h]:[a,h,p,d],m=[{type:"int32",data:[s]}],g=new rD(f,i);return t.runWebGPUProgram(g,[o],o.dtype,m)}var qZ={kernelName:ef,backendName:"webgpu",kernelFunc:d3e};var nD=class{constructor(e,t,n,o=!1,s=null,i=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>,",this.workgroupSize=[16,16,1],this.outputShape=e,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.addBias=o,this.activation=s,this.hasPreluActivation=i,this.filterHeight=t,this.filterWidth=n,this.shaderKey=`depthwiseNCHW_${this.activation}_${this.filterHeight}_${this.filterWidth}`}getUserCode(){let e=this.filterWidth*this.filterHeight,t=this.workgroupSize[0]*this.workgroupSize[1]*this.workgroupSize[2],n=this.workgroupSize[1]+this.filterHeight-1,o=this.workgroupSize[0]+this.filterWidth-1;return`
      ${Jo(this.activation,this.hasPreluActivation,!1,4)}

      var<workgroup> mm_Asub : array<array<f32, ${o}>, ${n}>;
      var<workgroup> mm_Bsub : array<array<f32, ${this.filterWidth}>, ${this.filterHeight}>;
      fn readX(batch : i32, channel : i32, row : i32, col : i32) -> f32 {
        var value = 0.0;
        if (row >=0 && row < uniforms.inDims[0] && col >=0 && col < uniforms.inDims[1])
        {
          value = getX(batch, channel, row, col);
        }
        return value;
      }

      ${ue()} {
        let coords = getOutputCoords();
        let batch = coords[0];
        let xRCCorner = vec2<i32>(coords.zw) - uniforms.pads;
        let channelMul = uniforms.wShape[3];
        let d1 = coords[1] / channelMul;
        let q = coords[1] % channelMul;

        let inputRowStart = xRCCorner.x;
        let inputColStart = xRCCorner.y;

        let localRow = i32(localId.y);
        let localCol = i32(localId.x);

        // Load one tile of X into local memory.
        for (var inputRow = localRow; inputRow < ${n}; inputRow = inputRow + ${this.workgroupSize[1]}) {
          for (var inputCol = localCol; inputCol < ${o}; inputCol = inputCol + ${this.workgroupSize[0]}) {
            let rowOffset = inputRow - localRow;
            let colOffset = inputCol - localCol;
            mm_Asub[inputRow][inputCol] = readX(batch, d1, inputRowStart + rowOffset, inputColStart + colOffset);
          }
        }

        // Load one tile of W into local memory.
        var wIndex = i32(localIndex);
        ${e<t?`if (wIndex < ${e})`:`for(; wIndex < ${e}; wIndex = wIndex + ${t})`}

        {
          let wRow = wIndex / ${this.filterWidth};
          let wCol = wIndex % ${this.filterWidth};
          mm_Bsub[wRow][wCol] = getW(wRow, wCol, d1, q);
        }

        workgroupBarrier();

        var value = 0.0;
        for (var wR = 0; wR < ${this.filterHeight}; wR = wR + 1) {
          for (var wC = 0; wC < ${this.filterWidth}; wC = wC + 1) {
            let xVal = mm_Asub[localRow + wR][localCol + wC];
            let wVal = mm_Bsub[wR][wC];
            value = fma(xVal, wVal, value);
          }
        }
        ${Fi(this.addBias,this.activation)}
        if (coordsInBounds4D(coords, uniforms.outShape)) {
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}};var Rb=class{constructor(e,t=!1,n=null,o=!1){this.variableNames=["x","W"],this.uniforms="pads : vec2<i32>, inDims : vec2<i32>, virtualWidth : i32,",this.workgroupSize=[64,1,1],this.workPerThread=4,this.outputComponent=4,this.outputShape=e.outShape,this.virtualWidth=Math.ceil(this.outputShape[2]/this.workPerThread)*this.workPerThread;let s=[this.outputShape[0],this.outputShape[1],this.virtualWidth,this.outputShape[3]];this.dispatchLayout=me(s),this.dispatch=pe(this.dispatchLayout,s,this.workgroupSize,[this.outputComponent*this.workPerThread,1,1]),C.assert(e.dataFormat==="channelsLast",()=>"TODO: NCHW is unimplemented"),t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=t,this.activation=n,this.hasPreluActivation=o,this.shaderKey=`depthwiseVec4_${n}_${this.convInfo.filterHeight}_${this.convInfo.filterWidth}_${this.convInfo.strideHeight}_${this.convInfo.strideWidth}_${this.workPerThread}`}getUserCode(){let e=(this.workPerThread-1)*this.convInfo.strideWidth+this.convInfo.filterWidth,t=this.convInfo.strideHeight,n=this.convInfo.strideWidth;return`
      ${Jo(this.activation,this.hasPreluActivation,!0,4)}
      fn readX(batch : i32, row : i32, col : i32, channel : i32) -> vec4<f32> {
        var value = vec4<f32>(0.0);
        if (col >=0 && col < uniforms.inDims[1]) {
          value = getX(batch, row, col, channel);
        }
        return value;
      }

      ${ue("index")} {
        let width0 = uniforms.outShape[3] / ${this.outputComponent};
        let d1 = (index % width0) * ${this.outputComponent};
        var index1 = index / width0;
        let width1 = uniforms.virtualWidth / ${this.workPerThread};
        let c = (index1 % width1) * ${this.workPerThread};
        index1 = index1 / width1;
        let r = index1 % uniforms.outShape[1];
        let batch = index1 / uniforms.outShape[1];

        let xRCCorner = vec2<i32>(r, c) * vec2<i32>(${t}, ${n}) - uniforms.pads;

        let xRCorner = xRCCorner.x;
        let xCCorner = xRCCorner.y;
        var xVals : array<vec4<f32>, ${e}>;
        var dotProd : array<vec4<f32>, ${this.workPerThread}>;
        for (var i = 0; i < ${this.workPerThread}; i++) {
          dotProd[i] = vec4<f32>(0.0);
        }

        // Use constant instead of uniform can give better performance.
        for (var wR = 0; wR < ${this.convInfo.filterHeight}; wR = wR + 1) {
          let xR = xRCorner + wR;
          if (xR >=0 && xR < uniforms.inDims[0]) {
            for (var i = 0; i < ${e}; i++) {
              xVals[i] = readX(batch, xR, xCCorner + i, d1);
            }
            for (var wC = 0; wC < ${this.convInfo.filterWidth}; wC = wC + 1) {
              let wValue = getW(wR, wC, d1, 0);
              for (var i = 0; i < ${this.workPerThread}; i++) {
                dotProd[i] = fma(xVals[i * ${n} + wC], wValue, dotProd[i]);
              }
            }
          }
        }

        for (var i = 0; i < ${this.workPerThread}; i = i + 1) {
          let coords = vec4<i32>(batch, r, c + i, d1);
          if (coordsInBounds4D(coords, uniforms.outShape)) {
            var value = dotProd[i];
            ${Fi(this.addBias,this.activation)}
            setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
          }
        }
      }
    `}};var Ob=class{constructor(e,t=!1,n=null,o=!1){this.variableNames=["x","W"],this.uniforms=`pads : vec2<i32>, inDims : vec2<i32>, filterHeight : i32,
      filterWidth : i32, strides : vec2<i32>, dilations : vec2<i32>,`,this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.isChannelsLast=e.dataFormat==="channelsLast",t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),this.convInfo=e,this.addBias=t,this.activation=n,this.hasPreluActivation=o,this.shaderKey=`depthwise_${this.activation}_${this.isChannelsLast}`}getUserCode(){let e=this.isChannelsLast?"getX(batch, xR, xC, d1);":"getX(batch, d1, xR, xC);";return`
      ${Jo(this.activation,this.hasPreluActivation,!1,4)}

      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let batch = coords[0];
          let xRCCorner = vec2<i32>(coords.${this.isChannelsLast?"yz":"zw"}) * uniforms.strides - uniforms.pads;
          let d2 = coords[${this.isChannelsLast?3:1}];
          let channelMul = uniforms.wShape[3];
          let d1 = d2 / channelMul;
          let q = d2 % channelMul;

          let inputRowStart = xRCCorner.x;
          let inputColStart = xRCCorner.y;
          let inputRowEnd = inputRowStart + uniforms.filterHeight *
              uniforms.dilations[0];
          let inputColEnd = inputColStart + uniforms.filterWidth *
              uniforms.dilations[1];

          // Convolve x(?, ?, d1)|x(d1, ?, ?) with w(:, :, d1, q) to get
          // y(yR, yC, d2)|y(d2, yR, yC). ? = to be determined. : = across all
          // values in that axis. x(?, ?, d1) and y(yR, yC, d2) is for NHWC.
          // x(d1, ?, ?) and y(d2, yR, yC) is for NCHW.
          var value = 0.0;

          // Extract if checking out of for loop for performance.
          if (inputRowStart >= 0 && inputColStart >= 0 &&
            inputRowEnd < uniforms.inDims[0] &&
                inputColEnd < uniforms.inDims[1]) {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            } else {
              for (var wR = 0; wR < uniforms.filterHeight; wR = wR + 1) {
                let xR = inputRowStart + wR * uniforms.dilations[0];

                if (xR < 0 || xR >= uniforms.inDims[0]) {
                  continue;
                }

                for (var wC = 0; wC < uniforms.filterWidth; wC = wC + 1) {
                  let xC = inputColStart + wC * uniforms.dilations[1];

                  if (xC < 0 || xC >= uniforms.inDims[1]) {
                    continue;
                  }

                  let xVal = ${e};
                  let wVal = getW(wR, wC, d1, q);
                  value = value + xVal * wVal;
                }
              }
            }
            ${Fi(this.addBias,this.activation)}
          setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
        }
      }
    `}};function h3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=n,p=E.convertConv2DDataFormat(c),d=l;d==null&&(d=[1,1]);let h=E.computeConv2DInfo(o.shape,s.shape,i,d,a,u,!0,p),f=[{type:"int32",data:[h.padInfo.top,h.padInfo.left]},{type:"int32",data:[h.inHeight,h.inWidth]}],m=h.dataFormat==="channelsLast",g;return!m&&h.inHeight>16&&h.inWidth>16&&h.strideHeight===1&&h.strideWidth===1&&h.dilationWidth===1&&h.dilationHeight===1&&h.inChannels===h.outChannels?g=new nD(h.outShape,h.filterHeight,h.filterWidth):m&&h.outHeight>4&&h.outWidth>4&&h.strideWidth<=2&&h.inChannels===h.outChannels&&h.dilationHeight===1&&h.dilationWidth===1&&h.inChannels%4===0?(g=new Rb(h),f.push({type:"int32",data:[g.virtualWidth]})):(g=new Ob(h),f.push({type:"int32",data:[h.filterHeight]},{type:"int32",data:[h.filterWidth]},{type:"int32",data:[h.strideHeight,h.strideWidth]},{type:"int32",data:[h.dilationHeight,h.dilationWidth]})),t.runWebGPUProgram(g,[o,s],o.dtype,f)}var KZ={kernelName:Au,backendName:"webgpu",kernelFunc:h3e};var oD=class{constructor(e){this.variableNames=["x","dy"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>, outHeight : i32,
      outWidth : i32, inHeight : i32, inWidth : i32, batchSize : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.filterShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_filter"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let wR = coords[0];
        let wC = coords[1];
        let d1 = coords[2];
        let dm = coords[3];
        let d2 = d1 * uniforms.channelMul + dm;

        var dotProd = 0.0;
        for (var b = 0; b < uniforms.batchSize; b++) {
          for (var yR = 0; yR < uniforms.outHeight; yR++) {
            let xR = wR + yR * uniforms.strides[0] - uniforms.pads[0];

            if (xR < 0 || xR >= uniforms.inHeight) {
              continue;
            }

            for (var yC = 0; yC < uniforms.outWidth; yC++) {
              let xC = wC + yC * uniforms.strides[1] - uniforms.pads[1];

              if (xC < 0 || xC >= uniforms.inWidth) {
                continue;
              }

              let dyValue = getDy(b, yR, yC, d2);
              let xValue = getX(b, xR, xC, d1);
              dotProd += xValue * dyValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},sD=class{constructor(e){this.variableNames=["dy","W"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32, channelMul : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="depthwise_conv2d_backprop_input"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d1 = coords[3];
        let dyCorner = coords.yz - uniforms.pads;
        let dyRCorner = dyCorner.x;
        let dyCCorner = dyCorner.y;

        var dotProd = 0.0;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }

          let idyR = i32(dyR);
          let wRPerm = uniforms.filterDims[0] - 1 - wR;

          for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }

            let idyC = i32(dyC);
            let wCPerm = uniforms.filterDims[1] - 1 - wC;

            for (var dm = 0; dm < uniforms.channelMul; dm++) {
              let d2 = d1 * uniforms.channelMul + dm;
              let xValue = getDy(batch, idyR, idyC, d2);
              let wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function f3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=n,p=E.computeConv2DInfo(o.shape,u,i,a,c,l,!0),d=new oD(p),h=[{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.filterHeight,p.filterWidth]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]},{type:"int32",data:[p.inHeight]},{type:"int32",data:[p.inWidth]},{type:"int32",data:[p.batchSize]},{type:"int32",data:[p.outChannels/p.inChannels]}];return t.runWebGPUProgram(d,[o,s],"float32",h)}var XZ={kernelName:tf,backendName:"webgpu",kernelFunc:f3e};function m3e(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=n,p=E.computeConv2DInfo(u,s.shape,i,a,c,l,!0),d=new sD(p),h=[{type:"int32",data:[p.strideHeight,p.strideWidth]},{type:"int32",data:[p.filterHeight-1-p.padInfo.top,p.filterWidth-1-p.padInfo.left]},{type:"int32",data:[p.filterHeight,p.filterWidth]},{type:"int32",data:[p.outHeight]},{type:"int32",data:[p.outWidth]},{type:"int32",data:[p.outChannels/p.inChannels]}];return t.runWebGPUProgram(d,[o,s],o.dtype,h)}var YZ={kernelName:rf,backendName:"webgpu",kernelFunc:m3e};var iD=class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,e],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="diag"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let value = select(0.0, getX(coords[0]), coords[0] == coords[1]);
          setOutputAtIndex(index, value);
        }
      }
    `}};function g3e(r){let{inputs:e,backend:t}=r,{x:n}=e,o=[...n.shape,...n.shape],s=C.sizeFromShape(n.shape),i=Le({inputs:{x:n},backend:t,attrs:{shape:[s]}}),a=new iD(s),c=t.runWebGPUProgram(a,[i],i.dtype),l=Le({inputs:{x:c},backend:t,attrs:{shape:o}});return t.disposeData(i.dataId),t.disposeData(c.dataId),l}var ZZ={kernelName:nf,backendName:"webgpu",kernelFunc:g3e};var aD=class{constructor(e){this.variableNames=["x","w"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.outShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="dilation2d"}getUserCode(){return`
       ${ue("index")} {
         if (index < uniforms.size) {
           let neg_infinity = -3.4e38;
           let coords = getOutputCoords();
           let batch = coords.x;
           let d1 = coords.w;
           let outTopLeftCorner = coords.yz * uniforms.strides - uniforms.pads;
           let hBeg = outTopLeftCorner.x;
           let wBeg = outTopLeftCorner.y;

           var curVal = neg_infinity;
           for (var h = 0; h < uniforms.filterDims[0]; h = h + 1) {
             let hIn = hBeg + h * uniforms.dilations[0];

             if (hIn >= 0 && hIn < uniforms.xShape[1]) {
               for (var w = 0; w < uniforms.filterDims[1]; w = w + 1) {
                 let wIn = wBeg + w * uniforms.dilations[1];

                 if (wIn >= 0 && wIn < uniforms.xShape[2]) {
                   let val = getX(batch, hIn, wIn, d1) + getW(h, w, d1);
                   if (val > curVal) {
                     curVal = val;
                   }
                 }
               }
             }
           }

           setOutputAtIndex(index, curVal);
         }
       }
     `}};function y3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c}=n,l=E.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",c),u=[l.padInfo.top,l.padInfo.left],p=[{type:"int32",data:[l.filterHeight,l.filterWidth]},{type:"int32",data:[...u]},{type:"int32",data:[l.strideHeight,l.strideWidth]},{type:"int32",data:[l.dilationHeight,l.dilationWidth]}],d=new aD(l);return t.runWebGPUProgram(d,[o,s],o.dtype,p)}var QZ={kernelName:Ru,backendName:"webgpu",kernelFunc:y3e};var cD=class{constructor(e,t){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.inShape,this.dispatchLayout=me(e.outShape),this.dispatch=pe(this.dispatchLayout,e.outShape,this.workgroupSize),t!=="float32"&&t!=="int32")throw new Error(`Dilation2DBackpropInput only supports float32 and int32
          types, does not support ${t} type.`);this.type=t,this.shaderKey="dilation2DBackpropInput"}getUserCode(){return`
       ${ue("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var xRMax = 0;
           var xCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     xRMax = xR;
                     xCMax = xC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.xShape[3] *
               (xCMax + uniforms.xShape[2] * (xRMax + uniforms.xShape[1] * b));
           let value = getDy(b, r, c, d);
           ${Mi("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}},lD=class{constructor(e,t,n){if(this.variableNames=["x","w","dy"],this.uniforms="filterDims: vec2<i32>, pads: vec2<i32>, strides: vec2<i32>, dilations: vec2<i32>, dySize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e.filterShape,this.dispatchLayout=me(e.outShape),this.dispatch=pe(this.dispatchLayout,e.outShape,this.workgroupSize),n!=="float32"&&n!=="int32")throw new Error(`Dilation2DBackpropFilter only supports float32 and int32
          types, does not support ${n} type.`);this.type=n,this.shaderKey="dilation2DBackpropFilter"}getUserCode(){return`
       ${ue("index")} {
         if (index < uniforms.dySize) {
           let coords = getDyCoordsFromIndex(index);
           let b = coords[0];
           let r = coords[1];
           let c = coords[2];
           let d = coords[3];

           let dyCorner = vec2<i32>(r, c) * uniforms.strides - uniforms.pads;
           var curVal = -3.4e38;  // neg_infinity
           var wRMax = 0;
           var wCMax = 0;

           // In the case of multiple argmax branches, we only back-propagate
           // along the last branch, i.e., the one with largest value of
           // 'wR * uniforms.filterDims[1] + wC', similarly to the max-pooling
           // backward routines.
           for (var wR = 0; wR < uniforms.filterDims[0]; wR++) {
             let xR = dyCorner.x + wR * uniforms.dilations[0];

             if (xR >= 0 && xR < uniforms.xShape[1]) {
               for (var wC = 0; wC < uniforms.filterDims[1]; wC++) {
                 let xC = dyCorner.y + wC * uniforms.dilations[1];

                 if (xC >= 0 && xC < uniforms.xShape[2]) {
                   let val = getX(b, xR, xC, d) + getW(wR, wC, d);
                   if (val > curVal) {
                     curVal = val;
                     wRMax = wR;
                     wCMax = wC;
                   }
                 }
               }
             }
           }

           let flatIndexIn = d + uniforms.wShape[2] * (wCMax + wRMax * uniforms.wShape[1]);
           let value = getDy(b, r, c, d);
           ${Mi("&result[flatIndexIn]","value",this.type)}
         }
       }
     `}};function x3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,dy:i}=e,{strides:a,pad:c,dilations:l}=n,u=E.computeDilation2DInfo(o.shape,s.shape,a,c,"NHWC",l),p=s.dtype,d=new lD(u,s.shape,p),h=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[C.sizeFromShape(u.outShape)]}],f=gn({backend:t,attrs:{shape:s.shape,value:0,dtype:p}});return t.runWebGPUProgram(d,[o,s,i],p,h,f)}var JZ={kernelName:Mg,backendName:"webgpu",kernelFunc:x3e};function v3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,dy:i}=e,{strides:a,pad:c,dilations:l}=n,u=E.computeDilation2DInfo(o.shape,s.shape,a,c,"NHWC",l),p=o.dtype,d=new cD(u,p),h=[{type:"int32",data:[u.filterHeight,u.filterWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[C.sizeFromShape(u.outShape)]}],f=gn({backend:t,attrs:{shape:u.inShape,value:0,dtype:p}});return t.runWebGPUProgram(d,[o,s,i],p,h,f)}var eQ={kernelName:Og,backendName:"webgpu",kernelFunc:v3e};var uD=class{constructor(e,t,n){this.variableNames=["Image"],this.uniforms="alpha: f32,",this.workgroupSize=[64,1,1],this.pixelsOpType=cm.DRAW,this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.type=t,this.textureFormat=n,this.shaderKey=`draw_${t}_${n}`}getUserCode(){let e,t=this.type==="float32"?"value":"value / 255.0";return e=`
      if (uniforms.numChannels == 1) {
        rgba[0] = ${t};
        rgba[1] = ${t};
        rgba[2] = ${t};
      } else {
        rgba[d] = ${t};
      }`,`
       @group(0) @binding(0) var outImage : texture_storage_2d<${this.textureFormat}, write>;
       ${ue("index")} {
         if (index < uniforms.size) {
           var rgba = vec4<f32>(0.0, 0.0, 0.0, uniforms.alpha);
           for (var d = 0; d < uniforms.numChannels; d = d + 1) {
             let value = f32(inBuf[index * uniforms.numChannels + d]);
             ${e}
           }
           rgba.x = rgba.x * rgba.w;
           rgba.y = rgba.y * rgba.w;
           rgba.z = rgba.z * rgba.w;
           let coords = getCoordsFromIndex(index);
           textureStore(outImage, vec2<i32>(coords.yx), rgba);
         }
       }
      `}};function b3e(r){let{inputs:e,backend:t,attrs:n}=r,{image:o}=e,{canvas:s,options:i}=n,[a,c]=o.shape.slice(0,2),{imageOptions:l}=i||{},u=l?.alpha||1,p=t.device.features.has("bgra8unorm-storage")?"bgra8unorm":"rgba8unorm",d=[a,c],h=new uD(d,o.dtype,p);s.width=c,s.height=a;let f="webgpu",m=s.getContext(f),g;m||(g=new OffscreenCanvas(c,a),m=g.getContext(f));let y=o.shape.length===3?o.shape[2]:1;m.configure({device:t.device,format:p,usage:GPUTextureUsage.STORAGE_BINDING,alphaMode:"premultiplied"});let x="int32",b=t.makeTensorInfo(d,x),w=t.tensorMap.get(b.dataId);w.resource=m.getCurrentTexture(),w.external=!0;let _=[{type:"uint32",data:[y]},{type:"float32",data:[u]}];if(t.runWebGPUProgram(h,[o],x,_,b),g){let I=s.getContext("2d");if(!I)throw new Error("Please make sure this canvas has only been used for 2d or webgpu context!");I.drawImage(g,0,0)}return t.disposeData(b.dataId),o}var tQ={kernelName:Fg,backendName:"webgpu",kernelFunc:b3e};var rB=ir({opType:Ze.MUL,cpuKernelImpl:P9,supportsComplex:!0}),rQ={kernelName:Qc,backendName:"webgpu",kernelFunc:rB};function nB(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;return $i(o,s,i,"sum",t)}var nQ={kernelName:np,backendName:"webgpu",kernelFunc:nB};function w3e(r){let{inputs:e,backend:t,attrs:n}=r,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:c}=E.decodeEinsumEquation(o,s.length);E.checkEinsumDimSizes(i.length,c,s);let{path:l,steps:u}=E.getEinsumComputePath(a,c),p=u.length,d=null,h=i.length,f=[];for(let m=0;m<p;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:x}=E.getEinsumPermutation(h,c[g]),b;E.isIdentityPermutation(y)?b=s[g]:(b=ps({inputs:{x:s[g]},backend:t,attrs:{perm:y}}),f.push(b));let w=b.shape.slice();for(let _=0;_<x.length;++_)w.splice(x[_],0,1);C.arraysEqual(b.shape,w)||(b=Le({inputs:{x:b},backend:t,attrs:{shape:w}}),f.push(b)),d===null?d=b:(d=rB({inputs:{a:b,b:d},backend:t}),f.push(d))}m<p-1&&(l[m]>=0&&(d=nB({inputs:{x:d},backend:t,attrs:{axis:l[m]-(i.length-h),keepDims:!1}}),f.push(d)),h--)}for(let m of f)m!==d&&t.disposeData(m.dataId);return d}var oQ={kernelName:of,backendName:"webgpu",kernelFunc:w3e};var C3e=Je({opType:be.ELU}),sQ={kernelName:$c,backendName:"webgpu",kernelFunc:C3e};var _3e=r=>{let{inputs:e,backend:t}=r,{dy:n,y:o}=e,s=new $d(Ze.ELU_DER,n.shape,o.shape);return t.runWebGPUProgram(s,[n,o],n.dtype)},iQ={kernelName:sf,backendName:"webgpu",kernelFunc:_3e};var S3e=ir({opType:Ze.EQUAL,dtype:"bool",cpuKernelImpl:w9}),aQ={kernelName:fd,backendName:"webgpu",kernelFunc:S3e};var I3e=Je({opType:be.ERF}),cQ={kernelName:Lc,backendName:"webgpu",kernelFunc:I3e};var T3e=Je({opType:be.EXP,cpuKernelImpl:C9,dtype:"float32"}),lQ={kernelName:Vc,backendName:"webgpu",kernelFunc:T3e};function pD(r){let{inputs:e,attrs:t,backend:n}=r,{dim:o}=t,{input:s}=e,i=s.shape.length,a=s.shape.slice(),c=o;return o<0&&(C.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),Le({inputs:{x:s},backend:n,attrs:{shape:a}})}var uQ={kernelName:Ou,backendName:"webgpu",kernelFunc:pD};var k3e=Je({opType:be.EXPM1,cpuKernelImpl:_9}),pQ={kernelName:Bc,backendName:"webgpu",kernelFunc:k3e};var A_=class{constructor(e,t){this.variableNames=["real","imag"],this.outputShape=[],this.uniforms="exponentMultiplier : f32, denominator: f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.component=e,this.shaderKey=`fft_${e}`}getUserCode(){return`
    fn unaryOpComplex(real: f32, expR: f32, imag: f32, expI: f32) -> f32 {
      ${this.component==="real"?"return real * expR - imag * expI;":"return real * expI + imag * expR;"}
    }

    fn mulMatDFT(batch: i32, index: i32) -> f32 {
      let indexRatio = f32(index) / f32(uniforms.realShape[1]);
      let exponentMultiplierTimesIndexRatio =
          uniforms.exponentMultiplier * indexRatio;

      var result = 0.0;

      for (var i = 0; i < uniforms.realShape[1]; i = i + 1) {
        // x = (-2|2 * PI / N) * index * i;
        let x = exponentMultiplierTimesIndexRatio * f32(i);
        let expR = cos(x);
        let expI = sin(x);
        let real = getReal(batch, i);
        let imag = getImag(batch, i);

        result = result +
            unaryOpComplex(real, expR, imag, expI) / uniforms.denominator;
      }

      return result;
    }

    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        setOutputAtIndex(index, mulMatDFT(coords[0], coords[1]));
      }
    }
  `}};function dD(r,e,t){let n=t.tensorMap.get(r.dataId),o=C.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=[],c=Le({inputs:{x:r},backend:t,attrs:{shape:[i,s]}});a.push(c);let l=c.shape,u=new A_("real",l),p=new A_("imag",l),d=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:l},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:l}],h=e?2*Math.PI:-2*Math.PI,f=e?l[1]:1,m=[{type:"float32",data:[h]},{type:"float32",data:[f]}],g=t.runWebGPUProgram(u,d,"float32",m);a.push(g);let y=t.runWebGPUProgram(p,d,"float32",m);a.push(y);let x=ia({inputs:{real:g,imag:y},backend:t});a.push(x);let b=Le({inputs:{x},backend:t,attrs:{shape:r.shape}});return a.forEach(w=>t.disposeData(w.dataId)),b}function E3e(r){let{inputs:e,backend:t}=r,{input:n}=e;return dD(n,!1,t)}var dQ={kernelName:af,backendName:"webgpu",kernelFunc:E3e};var hD=class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="flipLeftRight"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let coordX = uniforms.xShape[2] - coords[2] - 1;
          let outputValue = getX(coords[0], coords[1], coordX, coords[3]);
          setOutputAtIndex(index, outputValue);
        }
      }
    `}};var hQ={kernelName:lf,backendName:"webgpu",kernelFunc:({inputs:r,backend:e})=>{let{image:t}=r,n=e,o=new hD(t.shape);return n.runWebGPUProgram(o,[t],t.dtype)}};var N3e=Je({opType:be.FLOOR,cpuKernelImpl:S9}),fQ={kernelName:zc,backendName:"webgpu",kernelFunc:N3e};var D3e=ir({opType:Ze.FLOOR_DIV,cpuKernelImpl:I9,dtype:"int32"}),mQ={kernelName:Uc,backendName:"webgpu",kernelFunc:D3e};var fD=class{constructor(e,t,n=!1){this.pixelsOpType=cm.FROM_PIXELS,this.outputShape=[0],this.variableNames=[],this.workgroupSize=[256,1,1],this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[t,1,1]),this.importVideo=n,this.shaderKey=`fromPixels_${this.importVideo}`}getUserCode(){let e=this.importVideo?"textureLoad(src, vec2<i32>(coords.yx));":"textureLoad(src, vec2<i32>(coords.yx), 0)";return`
      @binding(1) @group(0) var src: ${this.importVideo?"texture_external":"texture_2d<f32>"};
      ${ue("index")} {
        let flatIndex = index * uniforms.numChannels;
        if (flatIndex < uniforms.size) {
          let coords = getCoordsFromIndex(flatIndex);
          let values = ${e};
          for (var i = 0; i < uniforms.numChannels; i = i + 1) {
            result[flatIndex + i] = i32(floor(255.0 * values[i]));
          }
        }
      }
  `}};var gQ={kernelName:$g,backendName:"webgpu",kernelFunc:A3e},Mb,oB=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function A3e(r){let{inputs:e,backend:t,attrs:n}=r,{pixels:o}=e,{numChannels:s}=n;if(o==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,c=typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas,l=typeof ImageBitmap<"u"&&o instanceof ImageBitmap,[u,p]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],d=[p,u,s],h=Z().getBool("WEBGPU_IMPORT_EXTERNAL_TEXTURE")&&i,f=i||a;if(l||c||f){let x;if(h)x=t.device.importExternalTexture({source:o});else{if(f){let q=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Mb==null||q!==oB)&&(oB=q,Mb=document.createElement("canvas").getContext("2d",{willReadFrequently:oB})),Mb.canvas.width=u,Mb.canvas.height=p,Mb.drawImage(o,0,0,u,p),o=Mb.canvas}let L=GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,z=t.textureManager.acquireTexture(d[1],d[0],"rgba8unorm",L);t.queue.copyExternalImageToTexture({source:o},{texture:z},[d[1],d[0]]),x=z}let b=C.sizeFromShape(d),w=C.computeStrides(d),_=new fD(d,s,h),I=[{type:"uint32",data:[b]},{type:"uint32",data:[s]},{type:"uint32",data:[...w]}],S=t.makeTensorInfo([p,u],"int32"),k=t.tensorMap.get(S.dataId);k.resource=x;let R=t.runWebGPUProgram(_,[S],"int32",I);return t.disposeData(S.dataId),R}let m=o.data,g=m;if(s!=null&&s!==4){g=new Uint8Array(o.width*o.height*s);let x=m.length,b=0;for(let w=0;w<x;w++)w%4<s&&(g[b++]=m[w])}let y=t.makeTensorInfo(d,"int32",new Int32Array(g));return t.uploadToGPU(y.dataId),y}var mD=class{constructor(e,t,n,o,s){this.uniforms="varianceEpsilon : f32,",this.workgroupSize=[128,1,1],this.size=!0,this.variableNames=["x","mean","variance"],E.assertAndGetBroadcastShape(e,t),E.assertAndGetBroadcastShape(e,n),this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),o!=null&&(E.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset")),s!=null&&(E.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale")),this.offsetShape=o,this.scaleShape=s,this.shaderKey="batchNorm"}getUserCode(){let e="0.0";this.offsetShape!=null&&(e="getOffsetByOutputIndex(index)");let t="1.0";return this.scaleShape!=null&&(t="getScaleByOutputIndex(index)"),`
      ${ue("index")} {
        if (index < uniforms.size)
        {
          let xValue = getXByOutputIndex(index);
          let meanValue = getMeanByOutputIndex(index);
          let varianValue = getVarianceByOutputIndex(index);
          let offsetValue = ${e};
          let scaleValue = ${t};
          let inv = scaleValue * inverseSqrt(varianValue + f32(uniforms.varianceEpsilon));
          setOutputAtIndex(index,dot(vec3<f32>(xValue, -meanValue, offsetValue), vec3<f32>(inv, inv, 1.0)));
        }
      }
  `}};var yQ={kernelName:Mu,backendName:"webgpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{x:n,scale:o,offset:s,mean:i,variance:a}=r,{varianceEpsilon:c}=e,l=t,u=[n,i,a],p=null;s!=null&&(p=s.shape,u.push(s));let d=null;o!=null&&(d=o.shape,u.push(o));let h=new mD(n.shape,i.shape,a.shape,p,d),f=[{type:"float32",data:[c]}];return l.runWebGPUProgram(h,u,n.dtype,f)}};function R3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=n,m=E.convertConv2DDataFormat(u),g=E.computeConv2DInfo(o.shape,s.shape,c,p,l,d,!1,m);return qN({x:o,filter:s,convInfo:g,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:h})}var xQ={kernelName:_d,backendName:"webgpu",kernelFunc:R3e};function O3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:u,dimRoundingMode:p,activation:d,leakyreluAlpha:h}=n,f=u;f==null&&(f=[1,1]),C.assert(E.eitherStridesOrDilationsAreOne(c,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${f}'`);let m=E.computeConv2DInfo(o.shape,s.shape,c,f,l,p,!0),g=[o,s],y=i!=null,x=a!=null;y&&g.push(i),x&&g.push(a);let b=[{type:"int32",data:[m.padInfo.top,m.padInfo.left]},{type:"int32",data:[m.inHeight,m.inWidth]}],w;return m.outHeight>4&&m.outWidth>4&&m.strideWidth<=2&&m.inChannels===m.outChannels&&m.dilationHeight===1&&m.dilationWidth===1&&m.inChannels%4===0?(w=new Rb(m,y,d,x),b.push({type:"int32",data:[w.virtualWidth]})):(w=new Ob(m,y,d,x),b.push({type:"int32",data:[m.filterHeight]},{type:"int32",data:[m.filterWidth]},{type:"int32",data:[m.strideHeight,m.strideWidth]},{type:"int32",data:[m.dilationHeight,m.dilationWidth]})),d==="leakyrelu"&&(b.push({type:"float32",data:[h]}),w.uniforms+=" alpha : f32,"),t.runWebGPUProgram(w,g,"float32",b)}var vQ={kernelName:Sd,backendName:"webgpu",kernelFunc:O3e};var gD=class{constructor(e,t){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey=`gathernd_${e}`,this.sliceDim=e,this.uniforms=`sliceDim : i32, strides : ${Jr(e)},`}getUserCode(){let e;return this.sliceDim>1?e="uniforms.strides[j]":e="uniforms.strides",`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          var flattenIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexTemp = i32(round(getIndices(coords[0], j)));
            let strideNum = ${e};
            flattenIndex = flattenIndex + indexTemp * strideNum;
          }

          setOutputAtIndex(index, getA(flattenIndex, coords[1]));
        }
      }
      `}};function M3e(r){let{inputs:e,backend:t}=r,{params:n,indices:o}=e,s=o.shape,i=s[s.length-1],a=C.sizeFromShape(n.shape),[c,l,u,p]=E.prepareAndValidate(n,o),d=Le({inputs:{x:o},backend:t,attrs:{shape:[l,i]}}),h=Le({inputs:{x:n},backend:t,attrs:{shape:[C.sizeFromShape(n.shape)/u,u]}});if(t.shouldExecuteOnCPU([n,o])||n.dtype==="string"){let x=t.readSync(o.dataId),b=t.bufferSync(n),w=T9(x,b,n.dtype,l,i,u,p,n.shape,a);return t.makeTensorInfo(c,n.dtype,w.values)}let f=new gD(i,[l,u]),m=[{type:"int32",data:[i]},{type:"int32",data:p}],g=t.runWebGPUProgram(f,[h,d],h.dtype,m),y=Le({inputs:{x:g},backend:t,attrs:{shape:c}});return t.disposeData(d.dataId),t.disposeData(h.dataId),t.disposeData(g.dataId),y}var bQ={kernelName:uf,backendName:"webgpu",kernelFunc:M3e};var yD=class{constructor(e,t){this.variableNames=["A","indices"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.slice(),this.aShape=e,this.outputShape=t,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="gather"}getUserCode(){let e=F3e(this.aShape);return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let indexZ = i32(getIndices(resRC.x, resRC.z));
          let inBounds = select(0.0, 1.0, indexZ >= 0 && indexZ < uniforms.aShape[2]);
          setOutputAtIndex(index, inBounds * getA(${e}));
        }
      }
    `}};function F3e(r){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],t=[];for(let n=0;n<r.length;n++)n===2?t.push("indexZ"):t.push(`${e[n]}`);return t.join()}function sB(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,indices:s}=e,{axis:i,batchDims:a}=n,c=C.parseAxisParam(i,o.shape)[0],l=E.segment_util.collectGatherOpShapeInfo(o,s,c,a),u=C.sizeFromShape(s.shape),p=[],d=Le({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),h=Le({inputs:{x:s},backend:t,attrs:{shape:[l.batchSize,u/l.batchSize]}});p.push(d),p.push(h);let f=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([o,s])){let b=t.tensorMap.get(h.dataId).values,w=ze(h.shape,h.dtype,b),I=t.tensorMap.get(d.dataId).values,S=ze(d.shape,d.dtype,I),k=k9(S,w,f);return p.forEach(R=>t.disposeData(R.dataId)),t.makeTensorInfo(l.outputShape,k.dtype,k.values)}let m=new yD(d.shape,f),g=t.runWebGPUProgram(m,[d,h],d.dtype);p.push(g);let y=Le({inputs:{x:g},backend:t,attrs:{shape:l.outputShape}});return p.forEach(x=>t.disposeData(x.dataId)),y}var wQ={kernelName:Fu,backendName:"webgpu",kernelFunc:sB};var P3e=ir({opType:Ze.GREATER,cpuKernelImpl:N9,dtype:"bool"}),CQ={kernelName:md,backendName:"webgpu",kernelFunc:P3e};var $3e=ir({opType:Ze.GREATER_EQUAL,dtype:"bool",cpuKernelImpl:E9}),_Q={kernelName:Gc,backendName:"webgpu",kernelFunc:$3e};function L3e(r){let{inputs:e,backend:t}=r,{input:n}=e;return dD(n,!0,t)}var SQ={kernelName:pf,backendName:"webgpu",kernelFunc:L3e};var V3e=Je({opType:be.IS_FINITE,dtype:"bool"}),IQ={kernelName:Wc,backendName:"webgpu",kernelFunc:V3e};var B3e=Je({opType:be.IS_INF,dtype:"bool"}),TQ={kernelName:jc,backendName:"webgpu",kernelFunc:B3e};var z3e=Je({opType:be.IS_NAN,dtype:"bool"}),kQ={kernelName:Hc,backendName:"webgpu",kernelFunc:z3e};function U3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{alpha:s}=n,i=[{type:"float32",data:[s]}],a=new Pi(o.shape,be.LEAKYRELU,"alpha : f32,");return t.runWebGPUProgram(a,[o],"float32",i)}var EQ={kernelName:Pu,backendName:"webgpu",kernelFunc:U3e};var G3e=ir({opType:Ze.LESS,dtype:"bool",cpuKernelImpl:A9}),NQ={kernelName:gd,backendName:"webgpu",kernelFunc:G3e};var W3e=ir({opType:Ze.LESS_EQUAL,dtype:"bool",cpuKernelImpl:D9}),DQ={kernelName:yd,backendName:"webgpu",kernelFunc:W3e};var xD=class{constructor(e){this.variableNames=[],this.outputShape=[],this.uniforms="start : f32, step : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="linSpace"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          setOutputAtIndex(index, uniforms.start + f32(index) * uniforms.step);
        }
      }
    `}};function j3e(r){let{backend:e,attrs:t}=r,{start:n,stop:o,num:s}=t,i=(o-n)/(s-1),a=new xD(s),c=[{type:"float32",data:[n]},{type:"float32",data:[i]}];return e.runWebGPUProgram(a,[],"float32",c)}var AQ={kernelName:hf,backendName:"webgpu",kernelFunc:j3e};var H3e=Je({opType:be.LOG,cpuKernelImpl:R9}),RQ={kernelName:qc,backendName:"webgpu",kernelFunc:H3e};var q3e=Je({opType:be.LOG1P}),OQ={kernelName:Kc,backendName:"webgpu",kernelFunc:q3e};var K3e=ir({opType:Ze.LOGICAL_AND,dtype:"bool"}),MQ={kernelName:xd,backendName:"webgpu",kernelFunc:K3e};var X3e=Je({opType:be.LOGICAL_NOT}),FQ={kernelName:vd,backendName:"webgpu",kernelFunc:X3e};var Y3e=ir({opType:Ze.LOGICAL_OR}),PQ={kernelName:bd,backendName:"webgpu",kernelFunc:Y3e};var $Q=`
  var powValue = 0.0;
  let basis = uniforms.bias + uniforms.alpha * sum;
  if (uniforms.beta == 0.5) {
    powValue = inverseSqrt(basis);
  } else if (uniforms.beta == 1.0) {
    powValue = 1.0 / basis;
  } else {
    powValue = exp(log(basis) * (-uniforms.beta));
  }
`,vD=class{constructor(e){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];
        let d = coords[3];

        let x = getX(b, r, c, d);
        var sum = 0.0;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let idx = d + i;
          if (idx >= 0 && idx < uniforms.xShape[3]) {
            let z = getX(b, r, c, idx);
            sum = sum + z * z;
          }
        }
        ${$Q}

        setOutputAtIndex(index, x * powValue);
      }
    }
  `}},bD=class{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.uniforms="radius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[256,1,1],this.maxAllowRadius=16,C.assert(t<=this.maxAllowRadius,()=>`Radius must be less than or equal to ${this.maxAllowRadius}, current radius is ${t}`),this.outputShape=e,this.elementsPerWorkgroup=this.workgroupSize[0]-2*this.maxAllowRadius,this.dispatchLayout={x:[3],y:[2],z:[0,1]},this.dispatch=pe(this.dispatchLayout,this.outputShape,[this.elementsPerWorkgroup,this.workgroupSize[1],this.workgroupSize[2]]),this.shaderKey="lrn_shared"}getUserCode(){return`
    var <workgroup>lrnSub: array<f32, ${this.workgroupSize[0]}>;
    const elementsPerWorkgroup = ${this.elementsPerWorkgroup};
    const maxAllowRadius = ${this.maxAllowRadius};

    ${ue()} {
      let localDepth = i32(localId.x);
      let workgroupDepth = i32(workgroupId.x) * elementsPerWorkgroup;
      let xDepth = workgroupDepth + localDepth - maxAllowRadius;
      let b = i32(globalId.z) / uniforms.xShape[1];
      let r = i32(globalId.z) - b * uniforms.xShape[1];
      let c = i32(globalId.y);
      let d = workgroupDepth + localDepth;

      var x = 0.0;
      if (xDepth >= 0 && xDepth < uniforms.xShape[3]) {
        x = getX(b, r, c, xDepth);
      }
      lrnSub[localDepth] = x;
      workgroupBarrier();

      if (localDepth < elementsPerWorkgroup && d < uniforms.outShape[3]) {
        var sum = 0.0;
        let index = localDepth + maxAllowRadius;
        for (var i = -uniforms.radius; i <= uniforms.radius; i = i + 1) {
          let z = lrnSub[index + i];
          sum = sum + z * z;
        }
        ${$Q}

        setOutputAtCoords(b, r, c, d, lrnSub[index] * powValue);
      }
    } `}};function Z3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:c}=n,l;s>16?l=new vD(o.shape):l=new bD(o.shape,s);let u=[{type:"int32",data:[s]},{type:"float32",data:[i]},{type:"float32",data:[a]},{type:"float32",data:[c]}];return t.runWebGPUProgram(l,[o],o.dtype,u)}var LQ={kernelName:$u,backendName:"webgpu",kernelFunc:Z3e};var wD=class{constructor(e){this.outputShape=[],this.variableNames=["inputImage","outputImage","dy"],this.uniforms="depthRadius : i32, bias : f32, alpha : f32, beta : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="lrn_grad"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let b = coords[0];
        let r = coords[1];
        let c = coords[2];

        let MIN_DEPTH_BEGIN = 0;
        let MAX_DEPTH_END = uniforms.outShape[3];
        var result = 0.0;
        for (var d = MIN_DEPTH_BEGIN; d < MAX_DEPTH_END; d++) {
          let depthBegin = max(MIN_DEPTH_BEGIN, d - uniforms.depthRadius);
          let depthEnd = min(MAX_DEPTH_END, d + uniforms.depthRadius + 1);

          var norm = 0.0;
          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            } else {
              break;
            }
          }

          norm = uniforms.alpha * norm + uniforms.bias;

          for (var k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; k++) {
            if (k < depthBegin) {
              continue;
            } else if (k >= depthBegin && k < depthEnd) {
              var dyi = -2.0 * uniforms.alpha * uniforms.beta
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d) / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * uniforms.beta);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            } else {
              break;
            }
          }
        }

        setOutputAtIndex(index, result);
      }
    }
  `}};function Q3e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:u}=n,p=new wD(o.shape),d=[{type:"int32",data:[a]},{type:"float32",data:[c]},{type:"float32",data:[l]},{type:"float32",data:[u]}];return t.runWebGPUProgram(p,[o,s,i],o.dtype,d)}var VQ={kernelName:ff,backendName:"webgpu",kernelFunc:Q3e};var J3e=ir({opType:Ze.MAX,cpuKernelImpl:M9}),BQ={kernelName:Xc,backendName:"webgpu",kernelFunc:J3e};function eVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,u=E.computePool2DInfo(o.shape,s,i,1,a,c);return MN(o,u,"max",t)}var zQ={kernelName:Vu,backendName:"webgpu",kernelFunc:eVe};function tVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=n,u=[1,1,1],p=E.computePool3DInfo(o.shape,s,i,u,a,l,c),d=new um(p,"max"),h=[{type:"int32",data:[p.strideDepth,p.strideHeight,p.strideWidth]},{type:"int32",data:[p.padInfo.front,p.padInfo.top,p.padInfo.left]},{type:"int32",data:[p.inDepth,p.inHeight,p.inWidth]},{type:"int32",data:[p.effectiveFilterDepth,p.effectiveFilterHeight,p.effectiveFilterWidth]}];return t.runWebGPUProgram(d,[o],o.dtype,h)}var UQ={kernelName:Bu,backendName:"webgpu",kernelFunc:tVe};var CD=class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec2<i32>, pads : vec2<i32>, dilations : vec2<i32>, filterDims : vec2<i32>,
       outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool2DBackprop"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords[0];
        let d = coords[3];

        let dyRCCorner = vec2<i32>(coords.yz) - uniforms.pads;
        let dyRCorner = dyRCCorner.x;
        let dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] - 1;
        for (var wR = 0; wR < uniforms.filterDims[0]; wR += uniforms.dilations[0]) {
          let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[0]);

          if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
            continue;
          }
          let idyR = i32(dyR);

          for (var wC = 0; wC < uniforms.filterDims[1]; wC += uniforms.dilations[1]) {
            let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[1]);

            if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
              continue;
            }
            let idyC = i32(dyC);

            let dyValue = getDy(batch, idyR, idyC, d);
            let maxPosValue = lastIndex - i32(getMaxPos(batch, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            let curPosValue = wR * uniforms.filterDims[1] + wC;
            let mask = select(0.0, 1.0, maxPosValue == curPosValue);
            dotProd += dyValue * mask;
          }
        }
        setOutputAtIndex(index, dotProd);
      }
    }
    `}},_D=class{constructor(e){this.variableNames=["dy","maxPos"],this.uniforms=`strides : vec3<i32>, pads : vec3<i32>, filterDims : vec3<i32>,
      outDepth : i32, outHeight : i32, outWidth : i32`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e.inShape,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="maxPool3DBackprop"}getUserCode(){return`
      ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
        let batch = coords.x;
        let ch = coords.u;

        let dyCorner = vec3<i32>(coords.y, coords.z, coords.w) - uniforms.pads;
        let dyDCorner = dyCorner.x;
        let dyRCorner = dyCorner.y;
        let dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        var dotProd = 0.0;
        let lastIndex = uniforms.filterDims[0] * uniforms.filterDims[1] * uniforms.filterDims[2] - 1;

        for (var wD = 0; wD < uniforms.filterDims[0]; wD++) {
          let dyD = f32(dyDCorner + wD) / f32(uniforms.strides[0]);

          if (dyD < 0.0 || dyD >= f32(uniforms.outDepth) || fract(dyD) > 0.0) {
            continue;
          }
          let idyD = i32(dyD);

          for (var wR = 0; wR < uniforms.filterDims[1]; wR++) {
            let dyR = f32(dyRCorner + wR) / f32(uniforms.strides[1]);

            if (dyR < 0.0 || dyR >= f32(uniforms.outHeight) || fract(dyR) > 0.0) {
              continue;
            }
            let idyR = i32(dyR);

            for (var wC = 0; wC < uniforms.filterDims[2]; wC++) {
              let dyC = f32(dyCCorner + wC) / f32(uniforms.strides[2]);

              if (dyC < 0.0 || dyC >= f32(uniforms.outWidth) || fract(dyC) > 0.0) {
                continue;
              }
              let idyC = i32(dyC);

              let dyValue = getDy(batch, idyD, idyR, idyC, ch);
              let maxPosValue = lastIndex - i32(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              let curPosValue = wD * uniforms.filterDims[1] * uniforms.filterDims[2] + wR * uniforms.filterDims[2] + wC;
              let mask = select(0.0, 1.0, maxPosValue == curPosValue);
              dotProd += dyValue * mask;
            }
          }
        }

        setOutputAtIndex(index, dotProd);
      }
    }
    `}};function rVe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=n,p=[1,1,1],d=E.computePool3DInfo(i.shape,a,c,p,l,u),h=new um(d,"max",!0),f=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.front,d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.inDepth,d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]}],m=t.runWebGPUProgram(h,[i],"int32",f),g=new _D(d);f=[{type:"int32",data:[d.strideDepth,d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterDepth-1-d.padInfo.front,d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.effectiveFilterDepth,d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outDepth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]}];let y=t.runWebGPUProgram(g,[o,m],i.dtype,f);return t.disposeData(m.dataId),y}var GQ={kernelName:gf,backendName:"webgpu",kernelFunc:rVe};function nVe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s,output:i}=e,a=s;__([s,i],"maxPoolGrad");let{filterSize:c,strides:l,pad:u,dimRoundingMode:p}=n,d=E.computePool2DInfo(a.shape,c,l,1,u,p),h=new _p(d,"max",!0),f=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.padInfo.top,d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.inHeight,d.inWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]}],m=t.runWebGPUProgram(h,[a],"int32",f),g=new CD(d);f=[{type:"int32",data:[d.strideHeight,d.strideWidth]},{type:"int32",data:[d.effectiveFilterHeight-1-d.padInfo.top,d.effectiveFilterWidth-1-d.padInfo.left]},{type:"int32",data:[d.dilationHeight,d.dilationWidth]},{type:"int32",data:[d.effectiveFilterHeight,d.effectiveFilterWidth]},{type:"int32",data:[d.outHeight]},{type:"int32",data:[d.outWidth]}];let y=t.runWebGPUProgram(g,[o,m],a.dtype,f);return t.disposeData(m.dataId),y}var WQ={kernelName:mf,backendName:"webgpu",kernelFunc:nVe};function oVe(r){let{inputs:e,backend:t,attrs:n}=r,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=n,{x:c}=e;C.assert(c.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${c.shape.length}.`);let l=[1,1];C.assert(E.eitherStridesOrDilationsAreOne(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);let u=E.computePool2DInfo(c.shape,o,s,l,i),p=[{type:"int32",data:[u.strideHeight,u.strideWidth]},{type:"int32",data:[u.padInfo.top,u.padInfo.left]},{type:"int32",data:[u.dilationHeight,u.dilationWidth]},{type:"int32",data:[u.inHeight,u.inWidth]},{type:"int32",data:[u.effectiveFilterHeight,u.effectiveFilterWidth]}],d=new _p(u,"max",!1),h=t.runWebGPUProgram(d,[c],c.dtype,p);d=new _p(u,"max",!0,!0,a);let f=t.runWebGPUProgram(d,[c],"int32",p);return[h,f]}var jQ={kernelName:yf,backendName:"webgpu",kernelFunc:oVe};function sVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;return $i(o,s,i,"min",t)}var HQ={kernelName:Uu,backendName:"webgpu",kernelFunc:sVe};var iVe=ir({opType:Ze.MIN,cpuKernelImpl:F9}),qQ={kernelName:Yc,backendName:"webgpu",kernelFunc:iVe};var SD=class{constructor(e,t,n){this.uniforms="",this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.map((o,s)=>o[0]+e[s]+o[1]),this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,t.map((o,s)=>{this.uniforms+=` pad${s} : vec2<i32>,`}),this.offset=n==="reflect"?0:1,this.shaderKey=`mirrorPad_${n}`}getUserCode(){let e=this.xShape.length,t=this.xShape.map((l,u)=>`uniforms.pad${u}[0]`).join(","),n=this.xShape.map((l,u)=>`uniforms.pad${u}[0] + uniforms.xShape${e>1?`[${u}]`:""}`).join(","),o=e===1?"start":"start[i]",s=e===1?"end":"end[i]",i=e===1?"outC":"outC[i]",a=Jr(e),c=e>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,e):"coords";return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let start = ${a}(${t});
          let end = ${a}(${n});
          var outC = getCoordsFromIndex(index);
          for (var i = 0; i < ${e}; i = i + 1) {
            if (${i} < ${o}) {
              ${i} = ${o} * 2 - ${i} - ${this.offset};
            } else if(${i} >= ${s}) {
              ${i} = (${s} - 1) * 2 - ${i} + ${this.offset};
            }
          }
          let coords = outC - start;
          setOutputAtIndex(index, getX(${c}));
        }
      }
    `}};var KQ={kernelName:Gu,backendName:"webgpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{x:n}=r,{paddings:o,mode:s}=e,i=t,a=o.map(u=>({type:"int32",data:[u[0],u[1]]})),c=new SD(n.shape,o,s);return i.runWebGPUProgram(c,[n],n.dtype,a)}};var aVe=ir({opType:Ze.MOD}),XQ={kernelName:Zc,backendName:"webgpu",kernelFunc:aVe};var ID=class{constructor(e,t){this.variableNames=["probs"],this.outputShape=[],this.uniforms="seed : f32, numOutcomes: i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,t],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="multinomial"}getUserCode(){return`
    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    fn random (seed : f32, resultUV : vec2<f32>) -> f32 {
      let HASHSCALE1 = 443.8975;
      let p = resultUV * seed;
      var p3  = fract(vec3<f32>(p.xyx) * HASHSCALE1);
      p3 = p3 + dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${ue("index")} {
      if (index < uniforms.size) {
        let coords = getOutputCoords();
        let batch = coords[0];

        let resUV = vec2<f32>(f32(coords[1]) / f32(uniforms.outShape[1]),
            f32(coords[0]) / f32(uniforms.outShape[0]));
        let r = random(uniforms.seed, resUV);
        var cdf = 0.0;
        for (var i = 0; i < uniforms.numOutcomes - 1; i = i + 1) {
          cdf = cdf + getProbs(batch, i);

          if (r < cdf) {
            setOutputAtIndexI32(index, i);
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutputAtIndexI32(index, uniforms.numOutcomes - 1);
      }
    }
  `}};var TD=class{constructor(e){this.variableNames=["logits"],this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=[this.outputShape[0],1,1],this.outputShape[1]>=4096?this.workgroupSize=[256,1,1]:this.workgroupSize=[64,1,1],this.shaderKey="softmax"}getUserCode(){return`
    var<workgroup> buf : array<f32, ${this.workgroupSize[0]}>;
    var<workgroup> rowMaxShared : f32;
    var<workgroup> rowSumShared : f32;
    const blockSize = ${this.workgroupSize[0]};
    ${ue("index")} {
      let row = index / blockSize;
      let tid = i32(localId.x);
      let cols = uniforms.outShape[1];

      var threadMax = -3.402823e+38f;
      for (var col = tid; col < cols; col += blockSize) {
        let value = getLogits(row, col);
        threadMax = max(threadMax, value);
      }
      if (tid < cols) {
        buf[tid] = threadMax;
      }
      workgroupBarrier();

      var reduceSize = min(cols, blockSize);
      for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
        reduceSize = currSize + (reduceSize & 1);
        if (tid < currSize) {
          buf[tid] = max(buf[tid], buf[tid + reduceSize]);
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowMaxShared = buf[0];
      }
      workgroupBarrier();

      var threadSum = 0.0;
      for (var col = tid; col < cols; col += blockSize) {
        let subExp = exp(getLogits(row, col) - rowMaxShared);
        threadSum += subExp;
      }
      buf[tid] = threadSum;
      workgroupBarrier();

      for (var currSize = blockSize >> 1;  currSize > 0; currSize = currSize >> 1) {
        if (tid < currSize) {
          buf[tid] = buf[tid] + buf[tid + currSize];
        }
        workgroupBarrier();
      }

      if (tid == 0) {
        rowSumShared = buf[0];
      }
      workgroupBarrier();

      for (var col = tid; col < cols; col += blockSize) {
        let value = exp(getLogits(row, col) - rowMaxShared) / rowSumShared;
        setOutputAtCoords(row, col, value);
      }
  }
    `}};function iB(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{dim:s}=n,i=Le({inputs:{x:o},backend:t,attrs:{shape:[C.sizeFromShape(o.shape)/o.shape[s],o.shape[s]]}}),a=new TD(i.shape),c=t.runWebGPUProgram(a,[i],o.dtype),l=Le({inputs:{x:c},backend:t,attrs:{shape:o.shape}});return t.disposeData(i.dataId),t.disposeData(c.dataId),l}var YQ={kernelName:ip,backendName:"webgpu",kernelFunc:iB};function cVe(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n,c=a?o:iB({inputs:{logits:o},backend:t,attrs:{dim:o.shape.length-1}}),l=c.shape[0],u=c.shape[1],p=new ID(l,s),d=[{type:"float32",data:[i]},{type:"int32",data:[u]}],h=t.runWebGPUProgram(p,[c],"int32",d);return a||t.disposeData(c.dataId),h}var ZQ={kernelName:xf,backendName:"webgpu",kernelFunc:cVe};function lVe(r){let{inputs:e,backend:t}=r,{x:n}=e;if(t.shouldExecuteOnCPU([n])){let s=t.tensorMap.get(n.dataId),[i,a]=$9(s.values,n.shape,n.dtype);return t.makeTensorInfo(a,n.dtype,i)}let o=new Pi(n.shape,be.NEG);return t.runWebGPUProgram(o,[n],n.dtype)}var QQ={kernelName:Wu,backendName:"webgpu",kernelFunc:lVe};function uVe(r){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=n,l=t.readSync(o.dataId),u=t.readSync(s.dataId),{selectedIndices:p}=to.nonMaxSuppressionV3Impl(l,u,i,a,c);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}var JQ={kernelName:vf,backendName:"webgpu",kernelFunc:uVe};function pVe(r){console.warn("tf.nonMaxSuppression() in webgpu locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=n,u=t.readSync(o.dataId),p=t.readSync(s.dataId),d=i,h=a,f=c,m=l,{selectedIndices:g,selectedScores:y}=to.nonMaxSuppressionV5Impl(u,p,d,h,f,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var eJ={kernelName:bf,backendName:"webgpu",kernelFunc:pVe};var kD=class{constructor(e,t){this.variableNames=["x"],this.uniforms="onValue : f32, offValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e,t],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="onehot"}getUserCode(){return`
      ${ue("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          setOutputAtIndex(index, mix(uniforms.offValue, uniforms.onValue,
                                      f32(i32(round(getX(coords.x))) == coords.y)));
        }
      }
    `}};function dVe(r){let{inputs:e,backend:t,attrs:n}=r,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:c}=n,l=C.sizeFromShape(o.shape),u=new kD(l,i),p=Le({inputs:{x:o},backend:t,attrs:{shape:[l]}}),d=[{type:"float32",data:[a]},{type:"float32",data:[c]}],h=t.runWebGPUProgram(u,[p],s,d);t.disposeData(p.dataId);let f=[...o.shape,i],m=Le({inputs:{x:h},backend:t,attrs:{shape:f}});return t.disposeData(h.dataId),m}var tJ={kernelName:Hu,backendName:"webgpu",kernelFunc:dVe};function R_(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="complex64"){let o=Ld({inputs:{input:n},backend:t}),s=R_({inputs:{x:o},backend:t}),i=my({inputs:{input:n},backend:t}),a=R_({inputs:{x:i},backend:t}),c=ia({inputs:{real:s,imag:a},backend:t});return t.disposeData(o.dataId),t.disposeData(s.dataId),t.disposeData(i.dataId),t.disposeData(a.dataId),c}else return gn({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var rJ={kernelName:lp,backendName:"webgpu",kernelFunc:R_};function nJ(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){let o=Ld({inputs:{input:n},backend:t}),s=nJ({inputs:{x:o},backend:t}),i=my({inputs:{input:n},backend:t}),a=R_({inputs:{x:i},backend:t}),c=ia({inputs:{real:s,imag:a},backend:t});return t.disposeData(o.dataId),t.disposeData(s.dataId),t.disposeData(i.dataId),t.disposeData(a.dataId),c}else return gn({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var oJ={kernelName:ju,backendName:"webgpu",kernelFunc:nJ};function hVe(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n;if(e.length===1)return pD({inputs:{input:e[0]},backend:t,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(u=>{C.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),C.assert(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],c=e.map(u=>{let p=pD({inputs:{input:u},backend:t,attrs:{dim:o}});return a.push(p),p}),l=tB({inputs:c,backend:t,attrs:{axis:o}});return a.forEach(u=>t.disposeData(u.dataId)),l}var sJ={kernelName:qu,backendName:"webgpu",kernelFunc:hVe};function aB(r,e=!1){let t=r.length,n=Jr(t),o=r.map((p,d)=>`uniforms.pad${d}[0]`).join(","),s=r.map((p,d)=>`uniforms.pad${d}[0] + uniforms.xShape${t>1?`[${d}]`:""}`).join(","),i=t>1?`${n}(${o})`:`${o}`,a=t>1?`${n}(${s})`:`${s}`,c=t>1?"any(paddedCoords < start)":"paddedCoords < start",l=t>1?"any(paddedCoords >= end)":"paddedCoords >= end",u=t>1?["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,t):"coords";return`
        let start = ${i};
        let end = ${a};
        if (${c} || ${l}) {
          setOutputAtIndex(index, ${e?0:"uniforms.constantValue"});
        } else {
          let coords = paddedCoords - start;
          setOutputAtIndex(index, getX(${u}));
        }
  `}var ED=class{constructor(e,t){this.variableNames=["x"],this.uniforms="constantValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t.map((n,o)=>n[0]+e[o]+n[1]),this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),t.map((n,o)=>{this.uniforms+=` pad${o} : vec2<i32>,`}),this.xShape=e,this.shaderKey="pad"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let paddedCoords = getCoordsFromIndex(index);
          ${aB(this.xShape)}
        }
      }
    `}};var fVe=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{paddings:s,constantValue:i}=n;if(s.every(l=>C.arraysEqual(l,[0,0])))return Mn({inputs:{x:o},backend:t});if(C.sizeFromShape(o.shape)===0){let l=s.map((u,p)=>u[0]+o.shape[p]+u[1]);return gn({backend:t,attrs:{shape:l,value:i,dtype:o.dtype}})}let a=[{type:"float32",data:[i]}];s.map(l=>a.push({type:"int32",data:[l[0],l[1]]}));let c=new ED(o.shape,s);return t.runWebGPUProgram(c,[o],o.dtype,a)},iJ={kernelName:Ku,backendName:"webgpu",kernelFunc:fVe};var mVe=ir({opType:Ze.POW}),aJ={kernelName:Jc,backendName:"webgpu",kernelFunc:mVe};function gVe(r){let{inputs:e,backend:t}=r,{x:n,alpha:o}=e,s=new $d(Ze.PRELU,n.shape,o.shape);return t.runWebGPUProgram(s,[n,o],"float32")}var cJ={kernelName:Xu,backendName:"webgpu",kernelFunc:gVe};function yVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;return $i(o,s,i,"prod",t)}var lJ={kernelName:Yu,backendName:"webgpu",kernelFunc:yVe};var xVe=r=>{let{backend:e,attrs:t}=r,{start:n,stop:o,step:s,dtype:i}=t,a=B9(n,o,s,i);return e.makeTensorInfo([a.length],i,a)},uJ={kernelName:wf,backendName:"webgpu",kernelFunc:xVe};var vVe=ir({opType:Ze.DIV}),pJ={kernelName:Pc,backendName:"webgpu",kernelFunc:vVe};var bVe=Je({opType:be.RECIPROCAL}),dJ={kernelName:el,backendName:"webgpu",kernelFunc:bVe};var wVe=Je({opType:be.RELU}),hJ={kernelName:tl,backendName:"webgpu",kernelFunc:wVe};var CVe=Je({opType:be.RELU6}),fJ={kernelName:rl,backendName:"webgpu",kernelFunc:CVe};var ND=class{constructor(e,t,n){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, halfPixelCenters : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],t,n,e[3]],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="resizeBilinear"}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
        let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC =
            (vec2<f32>(rc) + vec2<f32>(uniforms.halfPixelCenters)) *
            effectiveInputOverOutputRatioRC - vec2<f32>(uniforms.halfPixelCenters);

          // Compute the four integer indices.
          let sourceFloorRC = vec2<i32>(sourceFracIndexRC);
          let sourceCeilRC = vec2<i32>(
            min(vec2<f32>(uniforms.xShape.yz) - vec2<f32>(1.0), ceil(sourceFracIndexRC)));

          let topLeft = getX(b, sourceFloorRC.x, sourceFloorRC.y, d);
          let bottomLeft = getX(b, sourceCeilRC.x, sourceFloorRC.y, d);
          let topRight = getX(b, sourceFloorRC.x, sourceCeilRC.y, d);
          let bottomRight = getX(b, sourceCeilRC.x, sourceCeilRC.y, d);

          let fracRC = sourceFracIndexRC - vec2<f32>(sourceFloorRC);

          let top = topLeft + (topRight - topLeft) * fracRC.y;
          let bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
          let newValue = top + (bottom - top) * fracRC.x;

          setOutputAtIndex(index, newValue);
        }
      }
    `}};function _Ve(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,size:i,halfPixelCenters:a}=n,[c,l]=i,u=s&&c>1?1:0,p=s&&l>1?1:0,h=[{type:"float32",data:[u,p]},{type:"float32",data:[a?.5:0]}],f=new ND(o.shape,c,l);return t.runWebGPUProgram(f,[o],"float32",h)}var mJ={kernelName:Ju,backendName:"webgpu",kernelFunc:_Ve};var DD=class{constructor(e,t){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, heightScale : f32, widthScale : f32,
       invHeightScale : f32, invWidthScale : f32, winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=t,this.shaderKey=`resizeBilinearBackprop_${t}`}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(startRLerp - f32(uniforms.winHeight / 2));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(startCLerp - f32(uniforms.winWidth / 2));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let dxR = f32(dyR) * uniforms.heightScale;
              let topDxRIndex = i32(floor(dxR));
              let bottomDxRIndex = i32(min(ceil(dxR), f32(uniforms.outShape[1] - 1)));
              let dxRLerp = dxR - f32(topDxRIndex);
              let inverseDxRLerp = 1.0 - dxRLerp;

              let dxC = f32(dyC) * uniforms.widthScale;
              let leftDxCIndex = i32(floor(dxC));
              let rightDxCIndex = i32(min(ceil(dxC), f32(uniforms.outShape[2] - 1)));
              let dxCLerp = dxC - f32(leftDxCIndex);
              let inverseDxCLerp = 1.0 - dxCLerp;

              if (r == topDxRIndex && c == leftDxCIndex) {
                // topLeft
                accumulator +=
                  getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
              }

              if (r == topDxRIndex && c == rightDxCIndex) {
                // topRight
                accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
              }

              if (r == bottomDxRIndex && c == leftDxCIndex) {
                // bottomLeft
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
              }

              if (r == bottomDxRIndex && c == rightDxCIndex) {
                // bottomRight
                accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};function SVe(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n,[,a,c]=o.shape,[,l,u]=s.shape,p=[i&&l>1?a-1:a,i&&u>1?c-1:c],d=[i&&l>1?l-1:l,i&&u>1?u-1:u],h=p[0]/d[0],f=p[1]/d[1],m=1/h,g=1/f,y=Math.ceil(m)*2+2,x=Math.ceil(g)*2+2,b=new DD(o.shape,i),w=[{type:"int32",data:p},{type:"int32",data:d},{type:"float32",data:[h]},{type:"float32",data:[f]},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[x]}];return t.runWebGPUProgram(b,[s],s.dtype,w)}var gJ={kernelName:Sf,backendName:"webgpu",kernelFunc:SVe};var AD=class{constructor(e,t,n,o){this.variableNames=["x"],this.uniforms="adjustHeightWidth : vec2<f32>, roundBase : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=[e[0],t,n,e[3]],this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.halfPixelCenters=o,this.shaderKey=`resizeNearest_${o}`}getUserCode(){let e;return this.halfPixelCenters?e="max((vec2<f32>(rc) + vec2<f32>(0.5)) * effectiveInputOverOutputRatioRC, vec2<f32>(0.0))":e="vec2<f32>(rc) * effectiveInputOverOutputRatioRC",`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let b = coords[0];
          let d = coords[3];
          let rc = coords.yz;

          let effectiveInSize = vec2<f32>(
            f32(uniforms.xShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.xShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveOutSize = vec2<f32>(
            f32(uniforms.outShape.y) - uniforms.adjustHeightWidth[0],
            f32(uniforms.outShape.z) - uniforms.adjustHeightWidth[1]);

          let effectiveInputOverOutputRatioRC =
              effectiveInSize / effectiveOutSize;

          // Fractional source index
          let sourceFracIndexRC = ${e};

          // Compute the coordinators of nearest neighbor point.
          let inputShapeRC = vec2<f32>(f32(uniforms.xShape.y), f32(uniforms.xShape.z));
          let sourceNearestRC = vec2<i32>(
            min(inputShapeRC - 1.0, floor(sourceFracIndexRC + uniforms.roundBase)));
          let newValue = getX(b, sourceNearestRC.x, sourceNearestRC.y, d);

          setOutputAtIndex(index, newValue);
        }
      }
    `}};function IVe(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[c,l]=a,u=s&&c>1?1:0,p=s&&l>1?1:0,h=[{type:"float32",data:[u,p]},{type:"float32",data:[s?.5:0]}],f=new AD(o.shape,c,l,i);return t.runWebGPUProgram(f,[o],o.dtype,h)}var yJ={kernelName:Qu,backendName:"webgpu",kernelFunc:IVe};var RD=class{constructor(e,t){this.variableNames=["dy"],this.uniforms=`effectiveXSize : vec2<i32>, effectiveYSize : vec2<i32>, invHeightScale : f32, invWidthScale : f32,
       winHeight : i32, winWidth : i32,`,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.alignCorners=t,this.shaderKey=`resizeNearestNeigborBackprop_${t}`}getUserCode(){return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getOutputCoords();
          let b = coords[0];
          let d = coords[3];
          let r = coords[1];
          let c = coords[2];

          var accumulator = 0.0;

          // Compute bounds for where in dy we will look
          let startRLerp = floor(f32(r) * uniforms.invHeightScale);
          let startDyR = i32(floor(startRLerp - f32(uniforms.winHeight / 2)));

          let startCLerp = floor(f32(c) * uniforms.invWidthScale);
          let startDyC = i32(floor(startCLerp - f32(uniforms.winWidth / 2)));

          // Loop over dy
          for (var dyROffset = 0; dyROffset < uniforms.winHeight; dyROffset++) {
            let dyR = startDyR + dyROffset;

            // Guard against the window exceeding the bounds of dy
            if (dyR < 0 || dyR >= uniforms.dyShape[1]) {
              continue;
            }

            for (var dyCOffset = 0; dyCOffset < uniforms.winWidth; dyCOffset++) {
              let dyC = startDyC + dyCOffset;

              // Guard against the window exceeding the bounds of dy
              if (dyC < 0 || dyC >= uniforms.dyShape[2]) {
                continue;
              }

              let sourceFracRow = f32(uniforms.effectiveXSize[0]) *
                  (f32(dyR) / f32(uniforms.effectiveYSize[0]));

              let sourceFracCol = f32(uniforms.effectiveXSize[1]) *
                  (f32(dyC) / f32(uniforms.effectiveYSize[1]));

              let sourceNearestRow =
                  i32(min(f32(uniforms.outShape[1] - 1),
                  ${this.alignCorners?"floor(sourceFracRow + 0.5)":"floor(sourceFracRow)"}));

              let sourceNearestCol =
                  i32(min(f32(uniforms.outShape[2] - 1),
                  ${this.alignCorners?"floor(sourceFracCol + 0.5)":"floor(sourceFracCol)"}));

              if (r == sourceNearestRow && c == sourceNearestCol) {
                accumulator += getDy(b, dyR, dyC, d);
              }
            }
          }
          // End loop over dy

          setOutputAtIndex(index, accumulator);
        }
      }
    `}};function TVe(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n,[,a,c]=o.shape,[,l,u]=s.shape,p=[i&&l>1?a-1:a,i&&u>1?c-1:c],d=[i&&l>1?l-1:l,i&&u>1?u-1:u],h=p[0]/d[0],f=p[1]/d[1],m=1/h,g=1/f,y=Math.ceil(m)*2+2,x=Math.ceil(g)*2+2,b=new RD(o.shape,i),w=[{type:"int32",data:p},{type:"int32",data:d},{type:"float32",data:[m]},{type:"float32",data:[g]},{type:"int32",data:[y]},{type:"int32",data:[x]}];return t.runWebGPUProgram(b,[s],s.dtype,w)}var xJ={kernelName:_f,backendName:"webgpu",kernelFunc:TVe};var OD=class{constructor(e){this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=" axis : vec4<i32>,",this.shaderKey="reverse"}getUserCode(){return`
      
      // Using uniform variables as judging conditions, so the function has
      // coherent execution within all threads.
      fn getReverseCoords(coords : vec4<i32>) -> vec4<i32> {
        var reverseCoords = coords;
        if (uniforms.axis[0] == 1) {
          reverseCoords[0] = uniforms.xShape[0] - coords[0] - 1;
        }
        if (uniforms.axis[1] == 1) {
          reverseCoords[1] = uniforms.xShape[1] - coords[1] - 1;
        }
        if (uniforms.axis[2] == 1) {
          reverseCoords[2] = uniforms.xShape[2] - coords[2] - 1;
        }
        if (uniforms.axis[3] == 1) {
          reverseCoords[3] = uniforms.xShape[3] - coords[3] - 1;
        }

        return reverseCoords;
      }
    
      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let reverseCoords = getReverseCoords(coords);
          setOutputAtIndex(index, getX(reverseCoords[0],
              reverseCoords[1], reverseCoords[2], reverseCoords[3]));
        }
      }
    `}};function kVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dims:s}=n,i=o.shape.length;if(i===0)return Mn({inputs:{x:o},backend:t});let a=o.shape,c=[1,1,1,1];a.forEach((g,y)=>{let x=y+4-i;c[x]=g});let l=C.parseAxisParam(s,o.shape),u=[0,0,0,0];l.forEach(g=>{let y=g+4-i;u[y]=1});let p=[{type:"int32",data:u}],d=Le({inputs:{x:o},backend:t,attrs:{shape:c}}),h=new OD(c),f=t.runWebGPUProgram(h,[d],d.dtype,p);t.disposeData(d.dataId);let m=Le({inputs:{x:f},backend:t,attrs:{shape:a}});return t.disposeData(f.dataId),m}var vJ={kernelName:ep,backendName:"webgpu",kernelFunc:kVe};var MD=class{constructor(e,t){this.outputShape=[],this.variableNames=["x"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`centerX : f32, centerY : f32, sinRadians : f32,
          cosRadians : f32,`,this.shaderKey="rotate",this.outputShape=e,typeof t=="number"?(this.uniforms+=" fillValue : f32,",this.fillSnippet="var outputValue = uniforms.fillValue;",this.shaderKey+="_float"):(this.uniforms+=" fillValue : vec3<f32>,",this.fillSnippet="var outputValue = uniforms.fillValue[coords[3]];",this.shaderKey+="_vec3")}getUserCode(){return`
        ${ue("index")} {
          if (index < uniforms.size) {
            let coords = getCoordsFromIndex(index);
            let coordXFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.cosRadians - (f32(coords[1]) - uniforms.centerY) *
                uniforms.sinRadians;
            let coordYFloat = (f32(coords[2]) - uniforms.centerX) *
                uniforms.sinRadians + (f32(coords[1]) - uniforms.centerY) *
                uniforms.cosRadians;
            let coordX = i32(round(coordXFloat + uniforms.centerX));
            let coordY = i32(round(coordYFloat + uniforms.centerY));
            ${this.fillSnippet}
            if(coordX >= 0 && coordX < uniforms.xShape[2] && coordY >= 0 &&
                coordY < uniforms.xShape[1]) {
              outputValue = getX(coords[0], coordY, coordX, coords[3]);
            }
            setOutputAtIndex(index, outputValue);
          }
        }
      `}};var bJ={kernelName:Pf,backendName:"webgpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{image:n}=r,{radians:o,fillValue:s,center:i}=e,a=t,c=new MD(n.shape,s),[l,u]=E.getImageCenter(i,n.shape[1],n.shape[2]),p=[{type:"float32",data:[l]},{type:"float32",data:[u]},{type:"float32",data:[Math.sin(o)]},{type:"float32",data:[Math.cos(o)]}];return typeof s=="number"?p.push({type:"float32",data:[Number.parseFloat(s.toFixed(2))]}):p.push({type:"float32",data:s}),a.runWebGPUProgram(c,[n],n.dtype,p)}};var EVe=Je({opType:be.ROUND}),wJ={kernelName:nl,backendName:"webgpu",kernelFunc:EVe};var NVe=Je({opType:be.RSQRT,cpuKernelImpl:z9}),CJ={kernelName:ol,backendName:"webgpu",kernelFunc:NVe};var Sp=class{constructor(e,t,n,o,s,i,a,c=!0){this.variableNames=["updates","indices"],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=i,this.type=a,this.sumDupeIndices=c,this.dispatchLayout=me(e),this.dispatch=pe(this.dispatchLayout,e,this.workgroupSize),this.sliceDimGreaterThanOne=t>1,this.shaderKey=`scatter_${n}_${o}_${this.sliceDimGreaterThanOne}_${a}_${c}_${s.length}`;let l=Jr(s.length);this.uniforms=`sliceDim : i32, strides: ${l}, updatesSize: i32,`,this.updatesRank=o,this.indicesRank=n}getUserCode(){let e="";this.indicesRank===1?e="coords[0]":this.indicesRank===2&&(e="coords[0], j");let t=`getIndices(${e})`,n=this.sliceDimGreaterThanOne?"uniforms.strides[j]":"uniforms.strides",o="",s="";this.dispatchLayout.x.length===1?(o="flattenedIndex",s=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> i32 {
        return index;
      }
      `):this.dispatchLayout.x.length===2&&(o="vec2<i32>(flattenedIndex, coords[1])",s=`
      fn getUpdatesCoordsFromFlatIndex(index : i32) -> vec2<i32> {
        // N.B. |updates| could be a scalar tensor, conceptually representing a
        // 2D tensor with all values equal to that. By design, its size must be
        // the same as |outShape[1]| in one dimension, and |indicesShape[0]|
        // gives the other.
        let sliceSize = uniforms.outShape[1];
        let d0 = index / sliceSize;
        let d1 = index - d0 * sliceSize;
        return vec2<i32>(d0, d1);
      }
      `);let a=`getUpdates(${Array.from({length:this.updatesRank},(l,u)=>`coords[${u}]`).join(", ")})`;return`
    ${s}
      ${ue("index")} {
        if (index < uniforms.updatesSize) {
          let coords = getUpdatesCoordsFromFlatIndex(index);
          var flattenedIndex = 0;
          for (var j = 0; j < uniforms.sliceDim; j = j + 1) {
            let indexInside = i32(round(${t}));
            flattenedIndex = flattenedIndex + indexInside * ${n};
          }
          let updateValue =
              ${am(this.type)}(${a});
          let flatIndex = getOutputIndexFromCoords(${o});

          ${this.sumDupeIndices?Mi("&result[flatIndex]","updateValue",this.type):"atomicStore(&result[flatIndex], bitcast<i32>(updateValue));"}
        }
      }`}};function DVe(r){let{inputs:e,backend:t,attrs:n}=r,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:p}=E.calculateShapes(s,o,i),d=[p/l,l];if(p===0)return t.makeTensorInfo(i,o.dtype);let h=Le({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),f=Le({inputs:{x:s},backend:t,attrs:{shape:[c,l]}}),m=f.dtype,g=gn({backend:t,attrs:{shape:d,value:0,dtype:m}}),y=C.sizeFromShape(f.shape),x=[{type:"int32",data:[a]},{type:"int32",data:u},{type:"int32",data:[y]}],b=new Sp(f.shape,a,h.shape.length,f.shape.length,u,d,m),w=t.runWebGPUProgram(b,[f,h],m,x,g),_=Le({inputs:{x:w},backend:t,attrs:{shape:i}});return t.disposeData(h.dataId),t.disposeData(f.dataId),t.disposeData(w.dataId),_}var _J={kernelName:If,backendName:"webgpu",kernelFunc:DVe};var FD=class{constructor(e,t){this.outputShape=[],this.variableNames=["sortedSequence","values"],this.uniforms="numInputs : i32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.side=t,this.shaderKey=`search_sorted_${t}`}getUserCode(){return`
      fn findBound(batch: i32, value: f32) -> i32 {
        var left = i32(0);
        var right = uniforms.numInputs;
        while (left < right) {
          var mid = (left + right) / 2;
          if (getSortedSequence(batch, mid) ${this.side==="left"?"<":"<="} value) {
            left = mid + 1;
          } else {
            right = mid;
          }
        }
        return right;
      }

      ${ue("index")} {
        if (index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let value = getValuesByOutputIndex(index);
          setOutputAtIndexI32(index, findBound(coords[0], value));
        }
      }
    `}};function AVe(r){let{inputs:e,backend:t,attrs:n}=r,{sortedSequence:o,values:s}=e,{side:i}=n,a=new FD([s.shape[0],s.shape[1]],i),c=[{type:"int32",data:[o.shape[1]]}];return t.runWebGPUProgram(a,[o,s],"int32",c)}var SJ={kernelName:kf,backendName:"webgpu",kernelFunc:AVe};var PD=class{constructor(e,t,n){this.variableNames=["c","a","b"],this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=t,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.cRank=e,this.rank=n,this.shaderKey="select"}getUserCode(){let e,t;if(this.rank>4)throw Error(`Where for rank ${this.rank} is not yet supported`);if(this.rank===1)t="resRC",e="resRC";else{let o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],i=[];for(let a=0;a<this.outputShape.length;a++)i.push(`${o[a]}`),a<this.cRank&&s.push(`${o[a]}`);e=s.join(),t=i.join()}return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          let cVal = getC(${e});
          if (cVal >= 1.0) {
            setOutputAtIndex(index, getA(${t}));
          } else {
            setOutputAtIndex(index, getB(${t}));
          }
        }
      }
    `}};function RVe(r){let{inputs:e,backend:t}=r,{condition:n,t:o,e:s}=e,i=new PD(n.shape.length,o.shape,o.shape.length);return t.runWebGPUProgram(i,[n,o,s],$r(o.dtype,s.dtype))}var IJ={kernelName:tp,backendName:"webgpu",kernelFunc:RVe};var OVe=Je({opType:be.SELU}),TJ={kernelName:sl,backendName:"webgpu",kernelFunc:OVe};var MVe=Je({opType:be.SIGMOID}),kJ={kernelName:ll,backendName:"webgpu",kernelFunc:MVe};var FVe=Je({opType:be.SIGN}),EJ={kernelName:cl,backendName:"webgpu",kernelFunc:FVe};var PVe=Je({opType:be.SIN}),NJ={kernelName:il,backendName:"webgpu",kernelFunc:PVe};var $Ve=Je({opType:be.SINH}),DJ={kernelName:al,backendName:"webgpu",kernelFunc:$Ve};var LVe=Je({opType:be.SOFTPLUS}),AJ={kernelName:ul,backendName:"webgpu",kernelFunc:LVe};var $D=class{constructor(e,t,n,o,s,i){this.variableNames=["x"],this.outputShape=[],this.uniforms="",this.workgroupSize=[64,1,1],this.size=!0;let a=new Array(o.length);for(let c=0;c<a.length;c++)a[c]=o[s[c]];this.outputShape=a,this.newDim=s,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.xShape=e,this.paddedXShape=t,this.uniforms+=`reshapedPaddedXShape : ${Jr(o.length)}, paddedXShapeStrides : ${Jr(i)}, `,n.map((c,l)=>{this.uniforms+=` pad${l} : vec2<i32>,`}),this.shaderKey=`spaceToBatchND_${s}`}getUserCode(){let e=Jr(this.outputShape.length),t=XV(this.newDim);return`
      ${v_(this.paddedXShape,"PaddedX")}
      ${ue("index")} {
        if(index < uniforms.size) {
          let coords = getCoordsFromIndex(index);
          let switchedIndex = getIndexFromCoords${this.outputShape.length}D(${e}(${t}), uniforms.reshapedPaddedXShape);
          let paddedCoords = getPaddedXCoordsFromIndex(switchedIndex);
          ${aB(this.xShape,!0)}
        }
      }
    `}};var VVe=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,paddings:i}=n;C.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGPU backend not implemented yet");let a=s.reduce((x,b)=>x*b),c=[[0,0]];c.push(...i);for(let x=1+s.length;x<o.shape.length;++x)c.push([0,0]);let l=c.map((x,b)=>x[0]+o.shape[b]+x[1]),u=E.getReshaped(l,s,a,!1),p=E.getPermuted(u.length,s.length,!1),d=E.getReshapedPermuted(l,s,a,!1),h=C.computeStrides(l),f=new $D(o.shape,l,c,u,p,h.length),m=[{type:"int32",data:u},{type:"int32",data:h}];c.map(x=>m.push({type:"int32",data:[x[0],x[1]]}));let g=t.runWebGPUProgram(f,[o],o.dtype,m),y=Le({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeData(g.dataId),y},RJ={kernelName:op,backendName:"webgpu",kernelFunc:VVe};var LD=class{constructor(e,t,n){this.variableNames=["input","indices","segmentIds"],this.outputShape=[],this.uniforms="segmentSize : i32, sparseSize : i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=e,this.type=n,this.dispatchLayout=me([t]),this.dispatch=pe(this.dispatchLayout,[t],this.workgroupSize),this.shaderKey="sparseSegmentSum"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.sparseSize) {
        let indexInSegmentIds = index / uniforms.segmentSize;
        let indexInSegment = index % uniforms.segmentSize;
        let indexInInput = indices[indexInSegmentIds];
        let segmentId = segmentIds[indexInSegmentIds];

        let value = input[indexInInput * uniforms.segmentSize + indexInSegment];
        let outIndex = segmentId * uniforms.segmentSize + indexInSegment;
        ${Mi("&result[outIndex]","value",this.type)}
      }
    }
  `}},VD=class{constructor(e,t){this.variableNames=["segmentIds"],this.outputShape=[],this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=[e],this.dispatchLayout=me(t),this.dispatch=pe(this.dispatchLayout,t,this.workgroupSize),this.shaderKey="sparseSegmentIdCountProgram"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.segmentIdsShape) {
        let segmentId = segmentIds[index];
        ${Mi("&result[segmentId]","1","int32")}
      }
    }
  `}},BD=class{constructor(e,t){this.variableNames=["segmentSum","sameSegmentIdCount"],this.outputShape=[],this.uniforms="segmentSize : i32",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.type=t,this.dispatchLayout=me(e),this.dispatch=pe(this.dispatchLayout,e,this.workgroupSize),this.shaderKey="sparseSegmentMean"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.size) {
        let segmentId = index / uniforms.segmentSize;
        let count = sameSegmentIdCount[segmentId];
        if (count != 0) {
          ${this.type==="float32"?"setOutputAtIndex(index, segmentSum[index] / f32(count));":"setOutputAtIndexI32(index, segmentSum[index] / count);"}
        }
      }
    }
  `}};function zD(r,e,t,n=!1,o){let i=C.sizeFromShape(r.shape)/r.shape[0],a=r.dtype,c=C.sizeFromShape(e.shape),l=o.readSync(t.dataId),p=c>0?l[c-1]+1:0,d,h=r.shape.slice();h[0]=p;let f=c*i,m=gn({backend:o,attrs:{shape:h,value:0,dtype:a}});d=new LD(h,f,a);let g=[{type:"int32",data:[i]},{type:"int32",data:[f]}],y=o.runWebGPUProgram(d,[r,e,t],a,g,m);if(n)return y;let x=gn({backend:o,attrs:{shape:[p],value:0,dtype:"int32"}});d=new VD(p,t.shape);let b=o.runWebGPUProgram(d,[t],"int32",null,x),w=gn({backend:o,attrs:{shape:h,value:0,dtype:a}});d=new BD(h,a),g=[{type:"int32",data:[i]}];let _=o.runWebGPUProgram(d,[y,b],a,g,w);return o.disposeData(y.dataId),o.disposeData(b.dataId),_}function BVe(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;return zD(n,o,s,!1,t)}var OJ={kernelName:Ef,backendName:"webgpu",kernelFunc:BVe};function zVe(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;return zD(n,o,s,!0,t)}var MJ={kernelName:Nf,backendName:"webgpu",kernelFunc:zVe};var UD=class{constructor(e,t){this.variableNames=["A"],this.workgroupSize=[64,1,1],this.size=!0;let n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e[o]*t[o];this.outputShape=n,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.rank=this.outputShape.length,this.shaderKey="tile"}getUserCode(){let e=UVe(this.rank,"uniforms.");return`
      ${ue("index")} {
        if (index < uniforms.size) {
          let resRC = getCoordsFromIndex(index);
          setOutputAtIndex(index, getA(${e}));
        }
      }
    `}};function UVe(r,e=""){if(r>=5)throw Error(`Tile for rank ${r} is not yet supported`);if(r===1)return`(resRC % ${e}aShape)`;let t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let o=0;o<r;o++)n.push(`(${t[o]} % ${e}aShape[${o}])`);return n.join()}function O_(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reps:s}=n;if(t.shouldExecuteOnCPU([o])||o.dtype==="string"||o.shape.length>=5){let c=t.readSync(o.dataId),l=o.dtype==="string"?c.map(d=>C.decodeString(d)):c,u=ze(o.shape,o.dtype,l),p=K9(u,s);return t.makeTensorInfo(p.shape,p.dtype,p.values)}let i=new UD(o.shape,s);return t.runWebGPUProgram(i,[o],o.dtype)}var FJ={kernelName:Ra,backendName:"webgpu",kernelFunc:O_};function GVe(r){let{inputs:e,backend:t,attrs:n}=r,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:c,numUpdates:l,sliceSize:u,strides:p,outputSize:d}=E.calculateShapes(s,o,a),h=!1;if(s.dtype==="string"){let k=t.bufferSync(o),R=t.bufferSync(s),L=C.decodeString(t.readSync(i.dataId)[0]),B=U9(k,R,a,d,u,l,c,p,L,h);return t.makeTensorInfo(a,B.dtype,B.values)}let f=[d/u,u],m=Le({inputs:{x:o},backend:t,attrs:{shape:[l,c]}}),g=s.shape.length?Le({inputs:{x:s},backend:t,attrs:{shape:[l,u]}}):Mn({inputs:{x:s},backend:t}),y=g.dtype,x=t.makeTensorInfo([],y,C.makeZerosTypedArray(1,y)),b=Le({inputs:{x:i},backend:t,attrs:{shape:Array(f.length).fill(1)}}),w=O_({inputs:{x:b},backend:t,attrs:{reps:f}}),_=C.sizeFromShape([l,u]),I=[{type:"int32",data:[c]},{type:"int32",data:p},{type:"int32",data:[_]}];switch(l){case 0:break;case 1:{let k=new Sp([l,u],c,m.shape.length,g.shape.length,p,f,y,h);t.runWebGPUProgram(k,[g,m],y,I,w)}break;default:{let k=new Sp([l,u],c,m.shape.length,x.shape.length,p,f,y,h);t.runWebGPUProgram(k,[x,m],y,I,w)}{let k=new Sp([l,u],c,m.shape.length,g.shape.length,p,f,y);t.runWebGPUProgram(k,[g,m],y,I,w)}}let S=Le({inputs:{x:w},backend:t,attrs:{shape:a}});return t.disposeData(m.dataId),t.disposeData(g.dataId),t.disposeData(b.dataId),t.disposeData(x.dataId),t.disposeData(w.dataId),S}var PJ={kernelName:Df,backendName:"webgpu",kernelFunc:GVe};function WVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=C.parseAxisParam(i,o.shape)[0],c=E.prepareSplitSize(o,s,a),l=o.shape.length,u=new Array(l).fill(0),p=o.shape.slice();return c.map(d=>{let h=[...p];h[a]=d;let f=El({inputs:{x:o},backend:t,attrs:{begin:u,size:h}});return u[a]+=d,f})}var $J={kernelName:sp,backendName:"webgpu",kernelFunc:WVe};var jVe=Je({opType:be.SQRT}),LJ={kernelName:pl,backendName:"webgpu",kernelFunc:jVe};var VJ={kernelName:Af,backendName:"webgpu",kernelFunc:({inputs:r,backend:e})=>{let{x:t}=r,n=e,o=new Pi(t.shape,be.SQUARE);return n.runWebGPUProgram(o,[t],t.dtype)}};var HVe=ir({opType:Ze.SQUARED_DIFFERENCE}),BJ={kernelName:dl,backendName:"webgpu",kernelFunc:HVe};function qVe({inputs:r,attrs:e,backend:t}){let{x:n}=r,o=new Pi(n.shape,be.STEP,"stepAlpha : f32,"),s=[{type:"float32",data:[e.alpha]}];return t.runWebGPUProgram(o,[n],n.dtype,s)}var zJ={kernelName:gl,backendName:"webgpu",kernelFunc:qVe};var GD=class{constructor(e){this.variableNames=["x"],this.workPerThread=1,this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize,[this.workPerThread,1,1]);let t=Jr(this.outputShape.length);this.uniforms=`begin : ${t},  strides : ${t}, `,this.shaderKey="stridedSlice"}getUserCode(){let e=this.outputShape.length,t="";if(e===1)t="coords * uniforms.strides + uniforms.begin";else{let o=0;t=this.outputShape.map((s,i)=>(o++,this.outputShape.length===1?`coords * uniforms.strides[${i}] + uniforms.begin[${i}]`:`coords[${o-1}] * uniforms.strides[${i}] + uniforms.begin[${i}]`)).join(",")}return`
       ${ue("index")} {
         if (index < uniforms.size) {
           let coords = getCoordsFromIndex(index);
           setOutputAtIndex(index, getX(${t}));
         }
       }
     `}};function KVe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:p,shrinkAxisMask:d}=n,{finalShapeSparse:h,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:b,strides:w}=Tn.sliceInfo(o.shape,s,i,a,c,l,u,p,d),_;if(m)_=Le({inputs:{x:o},backend:t,attrs:{shape:f}});else if(g||y){C.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let I=Tn.computeOutShape(x,b,w),S=El({inputs:{x:o},backend:t,attrs:{begin:x,size:I}});_=Le({inputs:{x:S},backend:t,attrs:{shape:f}}),t.disposeData(S.dataId)}else if(t.shouldExecuteOnCPU([o])){let S=t.readSync(o.dataId),k=ze(o.shape,o.dtype,S),R=j9(h,k,w,x);_=t.makeTensorInfo(f,o.dtype,R.values)}else{let S=new GD(h),k=[{type:"int32",data:x},{type:"int32",data:w}],R=t.runWebGPUProgram(S,[o],o.dtype,k);_=Le({inputs:{x:R},backend:t,attrs:{shape:f}}),t.disposeData(R.dataId)}return _}var UJ={kernelName:Rf,backendName:"webgpu",kernelFunc:KVe};function XVe(r){let{inputs:e,backend:t,attrs:n}=r,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=n,{data:u,dataSplits:p}=e,d=t.readSync(u.dataId),h=t.readSync(p.dataId),[f,m]=H9(d,h,o,s,i,a,c,l);return[t.makeTensorInfo([f.length],"string",f),t.makeTensorInfo(p.shape,"int32",m)]}var GJ={kernelName:Of,backendName:"webgpu",kernelFunc:XVe};var YVe=ir({opType:Ze.SUB,cpuKernelImpl:q9,supportsComplex:!0}),WJ={kernelName:hl,backendName:"webgpu",kernelFunc:YVe};var ZVe=Je({opType:be.TAN}),jJ={kernelName:fl,backendName:"webgpu",kernelFunc:ZVe};var QVe=Je({opType:be.TANH}),HJ={kernelName:ml,backendName:"webgpu",kernelFunc:QVe};function JVe(r){let{inputs:e,backend:t,attrs:n}=r,{tensor:o,indices:s,updates:i}=e,{}=n,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:p}=E.calculateShapes(i,s,o.shape),d=[p/l,l];if(p===0)return t.makeTensorInfo(o.shape,s.dtype);let h=[],f=Le({inputs:{x:s},backend:t,attrs:{shape:[c,a]}});h.push(f);let m=Le({inputs:{x:i},backend:t,attrs:{shape:[c,l]}});h.push(m);let g=Le({inputs:{x:o},backend:t,attrs:{shape:d}});h.push(g);let y=O_({inputs:{x:g},backend:t,attrs:{reps:Array(d.length).fill(1)}}),x=new Sp([c,l],a,f.shape.length,m.shape.length,u,d,o.dtype,!1),b=C.sizeFromShape([c,l]),w=[{type:"int32",data:[a]},{type:"int32",data:u},{type:"int32",data:[b]}],_=t.runWebGPUProgram(x,[m,f],g.dtype,w,y);h.push(_);let I=Le({inputs:{x:_},backend:t,attrs:{shape:o.shape}});return h.forEach(S=>t.disposeData(S.dataId)),I}var qJ={kernelName:Tf,backendName:"webgpu",kernelFunc:JVe};var WD=class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms=`inputSize : i32, firstPass : i32, negativeInf : f32,
        dir : i32, inc : i32,`,this.shaderKey="swap"}getUserCode(){return`
        ${ue("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // We compare elements pair-wise within a group of size 2 * inc.
            // The comparing rule for each group alternates between ascending
            // and descending. Within each group, we compare each pair at
            // positions i and i+inc. To decide whether an element at position i
            // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
            // inc, it is in the first half of the group, we denote it as x0,
            // otherwise we denote it as x1.
            // For example, as shown in the Bitonic top K paper referenced
            // above, Figure5(a) shows that element[1] is in the second half of
            // the group when group size is 2, but it is in the first half of
            // the group when group size is 4.
            let isFirstInPair = elemIdx % (2 * uniforms.inc) < uniforms.inc;
            var i = 0;
            if (isFirstInPair) {
              i = elemIdx;
            } else {
              i = elemIdx - uniforms.inc;
            }

            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }

            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.inc;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.inc));
            }

            var x0 = f32(0.0);
            var x1 = f32(0.0);
            if (i0 < uniforms.inputSize) {
              x0 = getX(batch, i0);
            } else {
              x0 = uniforms.negativeInf;
            }
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = uniforms.negativeInf;
            }

            let reverse = elemIdx % (2 * uniforms.dir) >= uniforms.dir;
            let isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
            if (reverse == isGreater) {
              // Elements in opposite order of direction
              let iTemp = i0;
              i0 = i1;
              i1 = iTemp;
            }
            if (isFirstInPair) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}},jD=class{constructor(e){this.variableNames=["x","indices"],this.workgroupSize=[256,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.uniforms="inputSize : i32, firstPass : i32, k : i32,",this.shaderKey="merge"}getUserCode(){return`
        ${ue("index")} {
          if (index < uniforms.size) {
            let outC = getCoordsFromIndex(index);
            let batch = outC[0];
            let elemIdx = outC[1];
            // The output size is half of the previous size.
            // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _
            // (k=4), we only need to output the indices at positions |, the
            // indices at positions _ can be thrown away, see Figure5(b) After
            // Phase 2 (Merge phase) in the Bitonic Top K paper referenced
            // above.
            // For example, the paper shows we only need to output the orange
            // bars. The output sequence should look like this | | | | | | | |.
            // Because the sequence is halved, to map the output index back to
            // the previous sequence to find the corresponding value, we need
            // to double the index. When we double the index, we basically
            // interpolate a position, so 2i looks like
            // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k
            // position of each 2k positions by - elemIdx % k. E.g. for output
            // at index 4,5,6,7, we want to get the corresponding element at
            // original index 8,9,10,11, for output at index 8,9,10,11,
            // we want to get the corresponding element at original index
            // 16,17,18,19, so on and so forth.

            var i = 0;
            if (elemIdx < uniforms.k) {
              i = elemIdx;
            } else {
              i = elemIdx * 2 - elemIdx % uniforms.k;
            }
            var i0 = 0;
            if (uniforms.firstPass == 1) {
              i0 = i;
            } else {
              i0 = i32(getIndices(batch, i));
            }
            var i1 = 0;
            if (uniforms.firstPass == 1) {
              i1 = i + uniforms.k;
            } else {
              i1 = i32(getIndices(batch, i + uniforms.k));
            }

            let x0 = getX(batch, i0);
            var x1 = f32(0.0);
            if (i1 < uniforms.inputSize) {
              x1 = getX(batch, i1);
            } else {
              x1 = x0;
            }

            if (x0 >= x1) {
              setOutputAtIndex(index, f32(i0));
            } else {
              setOutputAtIndex(index, f32(i1));
            }
          }
        }
      `}};function Fb(r,e){e!==null&&r.disposeData(e.dataId)}function KJ(r){let e=1;for(;e<r;)e*=2;return e}function eBe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{k:s,sorted:i}=n,a=o.shape,c=a[a.length-1];if(t.shouldExecuteOnCPU([o])){let _=t.readSync(o.dataId),[I,S]=X9(_,a,o.dtype,s,i);return[t.makeTensorInfo(I.shape,I.dtype,I.values),t.makeTensorInfo(S.shape,S.dtype,S.values)]}if(s===0)return a[a.length-1]=0,[t.makeTensorInfo(a,o.dtype,[]),t.makeTensorInfo(a,"int32",[])];if(c===1)return[o,gn({attrs:{shape:a,dtype:"int32",value:0},backend:t})];let u=C.sizeFromShape(a)/c,p=Le({inputs:{x:o},attrs:{shape:[u,c]},backend:t}),d=KJ(s),h=KJ(c),f=null,m=()=>f===null?[p,p]:[p,f],g=(_,I,S)=>{let k=m(),R=new WD(S),B=[{type:"int32",data:[c]},{type:"int32",data:[f===null?1:0]},{type:"float32",data:[Number.NEGATIVE_INFINITY]},{type:"int32",data:[_]},{type:"int32",data:[I]}],z=f;f=t.runWebGPUProgram(R,k,"int32",B),Fb(t,z)};for(let _=1;_<d;_*=2){let I=_*2;for(let S=_;S>=1;S/=2)g(I,S,[u,h])}for(let _=h;_>d;_/=2){let I=m(),S=new jD([u,_/2]),R=[{type:"int32",data:[c]},{type:"int32",data:[f===null?1:0]},{type:"int32",data:[d]}],L=f;f=t.runWebGPUProgram(S,I,"int32",R),Fb(t,L);let B=d/2,z=B*2;for(let q=B;q>=1;q/=2)g(z,q,f.shape)}let y=f;f=El({inputs:{x:f},backend:t,attrs:{begin:0,size:[u,s]}}),Fb(t,y);let x=sB({inputs:{x:p,indices:f},backend:t,attrs:{axis:1,batchDims:1}});Fb(t,p);let b=a.slice(0,-1);b.push(s),y=f,f=Le({inputs:{x:f},attrs:{shape:b},backend:t}),Fb(t,y);let w=x;return x=Le({inputs:{x},attrs:{shape:b},backend:t}),Fb(t,w),[x,f]}var XJ={kernelName:Mf,backendName:"webgpu",kernelFunc:eBe};var HD=class{constructor(e){this.variableNames=["Image","Transforms"],this.uniforms="interpolationModeId : i32, fillModeId : i32, fillValue : f32,",this.workgroupSize=[64,1,1],this.size=!0,this.outputShape=e,this.dispatchLayout=me(this.outputShape),this.dispatch=pe(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="transform"}getUserCode(){return`
          fn mapCoord(outCoord : f32, len : f32) -> f32{
            var inCoord = outCoord;
            if(uniforms.fillModeId == 2) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  if (inCoord < sz2) {
                    inCoord = sz2 * f32(i32(f32(-inCoord / sz2))) +
                    inCoord;
                  }
                  if (inCoord < -len) {
                    inCoord = inCoord + sz2;
                  } else {
                    inCoord = -inCoord - 1.0;
                  }
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz2 = 2.0 * len;
                  inCoord = inCoord - sz2 * f32(i32(f32(inCoord / sz2)));
                  if (inCoord >= len) {
                    inCoord = sz2 - inCoord - 1.0;
                  }
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 3) {
              if (inCoord < 0.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord + len * (f32(i32(f32(-inCoord / sz))) + 1.0);
                }
              } else if (inCoord > len - 1.0) {
                if (len <= 1.0) {
                  inCoord = 0.0;
                } else {
                  let sz = len - 1.0;
                  inCoord = inCoord - len * f32(i32(f32(inCoord / sz)));
                }
              }
              return clamp(inCoord, 0.0, len - 1.0);
            } else if (uniforms.fillModeId == 4) {
              return clamp(outCoord, 0.0, len - 1.0);
            }
            return outCoord;
          }
          fn readWithFillValue(batch : i32, coordY : i32, coordX : i32,
            channel : i32) -> f32 {
            var outputValue : f32;
            if (0 <= coordY && coordY < uniforms.imageShape[1] && 0 <= coordX && coordX < uniforms.imageShape[2]) {
                outputValue = getImage(batch, coordY, coordX, channel);
            } else {
              outputValue = uniforms.fillValue;
            }
            return outputValue;
          }

          ${ue("index")} {
            if (index < uniforms.size) {
              let coords = getCoordsFromIndex(index);
              var outputValue : f32;
              let batch = coords[0];
              let x = coords[2];
              let y = coords[1];
              let channel = coords[3];
              let xf = f32(x);
              let yf = f32(y);
              let a1 = getTransforms(batch, 0);
              let a2 = getTransforms(batch, 1);
              let a3 = getTransforms(batch, 2);
              let b1 = getTransforms(batch, 3);
              let b2 = getTransforms(batch, 4);
              let b3 = getTransforms(batch, 5);
              let c1 = getTransforms(batch, 6);
              let c2 = getTransforms(batch, 7);
              let projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = uniforms.fillValue;
              } else {
                let inX = (a1 * xf + a2 * yf + a3) / projection;
                let inY = (b1 * xf + b2 * yf + b3) / projection;
                let mapX = mapCoord(inX, f32(uniforms.imageShape[2]));
                let mapY = mapCoord(inY, f32(uniforms.imageShape[1]));

                if (uniforms.interpolationModeId == 1) {
                  let coordY = i32(round(mapY));
                  let coordX = i32(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  let yFloor = floor(mapY);
                  let xFloor = floor(mapX);
                  let yCeil = yFloor + 1.0;
                  let xCeil = xFloor + 1.0;
                  let valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yFloor), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yFloor), i32(xCeil), channel);
                  let valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, i32(yCeil), i32(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, i32(yCeil), i32(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutputAtIndex(index, outputValue);
            }
          }
        `}};function tBe(r){let{inputs:e,backend:t,attrs:n}=r,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=n,[u,p,d,h]=o.shape,[f,m]=l??[p,d],g=[u,f,m,h],y=new HD(g),x=i==="nearest"?1:2,b;switch(a){case"constant":b=1;break;case"reflect":b=2;break;case"wrap":b=3;break;case"nearest":b=4;break;default:b=1;break}let w=[{type:"int32",data:[x]},{type:"int32",data:[b]},{type:"float32",data:[c]}];return t.runWebGPUProgram(y,[o,s],"float32",w)}var YJ={kernelName:Ff,backendName:"webgpu",kernelFunc:tBe};function rBe(r){let{inputs:e,backend:t,attrs:n}=r,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,c=o.shape[s],l=new Array(a-1),u=0;for(let m=0;m<a;m++)m!==s&&(l[u++]=i.shape[m]);let p=[],d=new Array(a).fill(0),h=i.shape.slice();h[s]=1;let f=new Array(c);for(let m=0;m<f.length;m++){d[s]=m;let g=El({inputs:{x:i},backend:t,attrs:{begin:d,size:h}}),y=Le({inputs:{x:g},backend:t,attrs:{shape:l}});f[m]=y,p.push(g)}return p.forEach(m=>t.disposeData(m.dataId)),f}var ZJ={kernelName:ap,backendName:"webgpu",kernelFunc:rBe};var qD=class{constructor(e,t,n){if(this.outputShape=[],this.variableNames=["x","segmentIds"],this.uniforms="numSegments : i32, xSize: i32,",this.workgroupSize=[64,1,1],this.atomic=!0,this.outputShape=t,this.dispatchLayout=me(e),this.dispatch=pe(this.dispatchLayout,e,this.workgroupSize),n!=="float32"&&n!=="int32")throw new Error(`UnsortedSegmentSum only supports float32 and int32
              types, does not support ${n} type.`);this.type=n,this.shaderKey="unsortedSegmentSum"}getUserCode(){return`
    ${ue("index")} {
      if (index < uniforms.xSize) {
        let coords = getXCoordsFromIndex(index);
        let b = coords[0];
        let inCol = coords[1];

        let segmentId = i32(getSegmentIds(inCol));
        if (segmentId >= 0) {
          let flatIndex = b * uniforms.numSegments + segmentId % uniforms.numSegments;
          let value = getX(b, inCol);

          ${Mi("&result[flatIndex]","value",this.type)}
        }
      }
    }
  `}};function nBe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,segmentIds:s}=e,{numSegments:i}=n,a=o.shape.length,c=[],l=0,u=E.getAxesPermutation([l],a),p=o;u!=null&&(p=ps({inputs:{x:o},backend:t,attrs:{perm:u}}),c.push(p),l=E.getInnerMostAxes(1,a)[0]);let d=E.segment_util.computeOutShape(p.shape,l,i),h=C.sizeFromShape([p.shape[l]]),f=Le({inputs:{x:p},backend:t,attrs:{shape:[-1,h]}});c.push(f);let m=o.dtype,g=[f.shape[0],i],y=gn({backend:t,attrs:{shape:g,value:0,dtype:m}}),x=new qD(f.shape,g,m),b=[{type:"int32",data:[i]},{type:"int32",data:[C.sizeFromShape(f.shape)]}],w=t.runWebGPUProgram(x,[f,s],m,b,y),_=Le({inputs:{x:w},backend:t,attrs:{shape:d}});c.push(w);let I=_;if(u!=null){c.push(_);let S=E.getUndoAxesPermutation(u);I=ps({inputs:{x:I},backend:t,attrs:{perm:S}})}return c.forEach(S=>t.disposeData(S.dataId)),I}var QJ={kernelName:cp,backendName:"webgpu",kernelFunc:nBe};var oBe=[N7,Z9,Q9,J9,eZ,tZ,nZ,oZ,sZ,iZ,aZ,cZ,lZ,uZ,pZ,fZ,mZ,gZ,yZ,xZ,bZ,wZ,CZ,TZ,kZ,EZ,A7,DZ,RZ,OZ,MZ,FZ,PZ,$Z,LZ,VZ,BZ,zZ,WZ,jZ,HZ,qZ,XZ,YZ,KZ,ZZ,QZ,JZ,eQ,tQ,oQ,sQ,iQ,aQ,cQ,lQ,uQ,pQ,dQ,k7,hQ,gQ,fQ,mQ,yQ,xQ,vQ,bQ,wQ,CQ,_Q,D7,SQ,AZ,IQ,TQ,kQ,EQ,NQ,DQ,AQ,OQ,RQ,MQ,FQ,PQ,LQ,VQ,dZ,BQ,zQ,WQ,UQ,GQ,jQ,hZ,HQ,qQ,KQ,XQ,ZQ,rQ,QQ,JQ,eJ,_Z,tJ,oJ,sJ,iJ,aJ,cJ,lJ,uJ,SZ,pJ,dJ,hJ,fJ,E7,mJ,gJ,yJ,xJ,vJ,bJ,wJ,CJ,_J,SJ,IJ,TJ,kJ,EJ,NJ,DJ,vZ,zJ,UJ,GJ,YQ,AJ,RJ,OJ,MJ,PJ,$J,LJ,VJ,BJ,WJ,nQ,jJ,HJ,qJ,FJ,XJ,YJ,rZ,ZJ,QJ,rJ];for(let r of oBe)Ev(r);var Dee=function(r,e){return(Dee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])})(r,e)};function Aee(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}Dee(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var on=function(){return(on=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);return r}).apply(this,arguments)};function yr(r,e,t,n){return new(t||(t=Promise))(function(o,s){function i(l){try{c(n.next(l))}catch(u){s(u)}}function a(l){try{c(n.throw(l))}catch(u){s(u)}}function c(l){var u;l.done?o(l.value):(u=l.value,u instanceof t?u:new t(function(p){p(u)})).then(i,a)}c((n=n.apply(r,e||[])).next())})}function xr(r,e){var t,n,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(o=i.trys,!((o=o.length>0&&o[o.length-1])||u[0]!==6&&u[0]!==2)){i=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(u[0]===6&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(r,i)}catch(p){u=[6,p],n=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([c,l])}}}function gy(r,e,t){if(t||arguments.length===2)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return r.concat(n||Array.prototype.slice.call(e))}var Ip=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],F_=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"],sBe={left:[1,2,3,7,9,11,13,15,17,19,21,23,25,27,29,31],right:[4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32],middle:[0]},iBe={left:[1,3,5,7,9,11,13,15],right:[2,4,6,8,10,12,14,16],middle:[0]},aBe=[[0,1],[0,2],[1,3],[2,4],[5,6],[5,7],[5,11],[6,8],[6,12],[7,9],[8,10],[11,12],[11,13],[12,14],[13,15],[14,16]],cBe=[[0,1],[0,4],[1,2],[2,3],[3,7],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[11,23],[12,14],[14,16],[12,24],[13,15],[15,17],[16,18],[16,20],[15,17],[15,19],[15,21],[16,22],[17,19],[18,20],[23,25],[23,24],[24,26],[25,27],[26,28],[27,29],[28,30],[27,31],[28,32],[29,31],[30,32]];function KD(r){return r instanceof SVGAnimatedLength?r.baseVal.value:r}function Ree(r){return yr(this,void 0,void 0,function(){var e,t;return xr(this,function(n){switch(n.label){case 0:return e=document.createElement("canvas"),r instanceof Ct?[4,Md.toPixels(r,e)]:[3,2];case 1:return n.sent(),[3,3];case 2:e.width=KD(r.width),e.height=KD(r.height),t=e.getContext("2d"),r instanceof ImageData?t.putImageData(r,0,0):t.drawImage(r,0,0),n.label=3;case 3:return[2,e]}})})}function Oee(r){return yr(this,void 0,void 0,function(){var e,t,n,o,s,i;return xr(this,function(a){switch(a.label){case 0:return r instanceof Ct?(e=r.shape.slice(0,2),t=e[0],n=e[1],o=ImageData.bind,[4,Md.toPixels(r)]):[3,2];case 1:return[2,new(o.apply(ImageData,[void 0,a.sent(),n,t]))];case 2:return s=document.createElement("canvas"),i=s.getContext("2d"),s.width=KD(r.width),s.height=KD(r.height),i.drawImage(r,0,0),[2,i.getImageData(0,0,s.width,s.height)]}})})}function lBe(r){return yr(this,void 0,void 0,function(){var e,t;return xr(this,function(n){switch(n.label){case 0:return r instanceof SVGImageElement||r instanceof OffscreenCanvas?[4,Ree(r)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=r,n.label=3;case 3:return e=t,[2,Md.fromPixels(e,4)]}})})}function Mee(r){if(r<0||r>=256)throw new Error("Mask value must be in range [0, 255] but got ".concat(r));if(!Number.isInteger(r))throw new Error("Mask value must be an integer but got ".concat(r))}var M_={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},uBe=function(){function r(e){this.mask=e}return r.prototype.toCanvasImageSource=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,this.mask]})})},r.prototype.toImageData=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,Oee(this.mask)]})})},r.prototype.toTensor=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,lBe(this.mask)]})})},r.prototype.getUnderlyingType=function(){return"canvasimagesource"},r}();function pBe(r){return Mee(r),"person"}var dBe=function(){function r(e){var t,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new Nee.Pose({locateFile:function(o,s){if(e.solutionPath){var i=e.solutionPath.replace(/\/+$/,"");return"".concat(i,"/").concat(o)}return"".concat(s,"/").concat(o)}}),e.modelType){case"lite":t=0;break;case"heavy":t=2;break;case"full":default:t=1}this.poseSolution.setOptions({modelComplexity:t,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults(function(o){if(n.height=o.image.height,n.width=o.image.width,o.poseLandmarks==null)n.poses=[];else{var s=n.translateOutput(o.poseLandmarks,o.poseWorldLandmarks);o.segmentationMask&&(s.segmentation={maskValueToLabel:pBe,mask:new uBe(o.segmentationMask)}),n.poses=[s]}})}return r.prototype.translateOutput=function(e,t){var n=this,o={keypoints:e.map(function(s,i){return{x:s.x*n.width,y:s.y*n.height,z:s.z,score:s.visibility,name:F_[i]}})};return t!=null&&(o.keypoints3D=t.map(function(s,i){return{x:s.x,y:s.y,z:s.z,score:s.visibility,name:F_[i]}})),o},r.prototype.estimatePoses=function(e,t,n){return yr(this,void 0,void 0,function(){var o,s;return xr(this,function(i){switch(i.label){case 0:return t&&t.flipHorizontal&&t.flipHorizontal!==this.selfieMode&&(this.selfieMode=t.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Ct?(s=ImageData.bind,[4,Md.toPixels(e)]):[3,2];case 1:return o=new(s.apply(ImageData,[void 0,i.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:o=e,i.label=3;case 3:return e=o,[4,this.poseSolution.send({image:e},n)];case 4:return i.sent(),[2,this.poses]}})})},r.prototype.dispose=function(){this.poseSolution.close()},r.prototype.reset=function(){this.poseSolution.reset()},r.prototype.initialize=function(){return this.poseSolution.initialize()},r}();function hBe(r){return yr(this,void 0,void 0,function(){var e,t;return xr(this,function(n){switch(n.label){case 0:return e=function(o){if(o==null)return on({},M_);var s=on({},o);return s.runtime="mediapipe",s.enableSegmentation==null&&(s.enableSegmentation=M_.enableSegmentation),s.enableSmoothing==null&&(s.enableSmoothing=M_.enableSmoothing),s.smoothSegmentation==null&&(s.smoothSegmentation=M_.smoothSegmentation),s.modelType==null&&(s.modelType=M_.modelType),s}(r),[4,(t=new dBe(e)).initialize()];case 1:return n.sent(),[2,t]}})})}function $b(r){return r instanceof Ct?{height:r.shape[0],width:r.shape[1]}:{height:r.height,width:r.width}}function Fee(r){return r-2*Math.PI*Math.floor((r+Math.PI)/(2*Math.PI))}function wB(r){return r instanceof Ct?r:Md.fromPixels(r)}function Pee(r,e,t){return yB(t,"inputResolution"),[1/t.width*r[0][0]*e.width,1/t.height*r[0][1]*e.width,r[0][3]*e.width,1/t.width*r[1][0]*e.height,1/t.height*r[1][1]*e.height,r[1][3]*e.height,0,0]}function yB(r,e){C.assert(r.width!==0,function(){return"".concat(e," width cannot be 0.")}),C.assert(r.height!==0,function(){return"".concat(e," height cannot be 0.")})}function cB(r,e,t){var n=t.rotationVectorStartKeypointIndex,o=t.rotationVectorEndKeypointIndex,s=r.locationData,i=s.relativeKeypoints[n].x*e.width,a=s.relativeKeypoints[n].y*e.height,c=s.relativeKeypoints[o].x*e.width,l=s.relativeKeypoints[o].y*e.height,u=2*Math.sqrt((c-i)*(c-i)+(l-a)*(l-a)),p=function(d,h,f){var m,g=d.locationData,y=f.rotationVectorStartKeypointIndex,x=f.rotationVectorEndKeypointIndex;m=f.rotationVectorTargetAngle?f.rotationVectorTargetAngle:Math.PI*f.rotationVectorTargetAngleDegree/180;var b=g.relativeKeypoints[y].x*h.width,w=g.relativeKeypoints[y].y*h.height,_=g.relativeKeypoints[x].x*h.width,I=g.relativeKeypoints[x].y*h.height;return Fee(m-Math.atan2(-(I-w),_-b))}(r,e,t);return{xCenter:i/e.width,yCenter:a/e.height,width:u/e.width,height:u/e.height,rotation:p}}function $ee(r){if(r.length!==16)throw new Error("Array length must be 16 but got ".concat(r.length));return[[r[0],r[1],r[2],r[3]],[r[4],r[5],r[6],r[7]],[r[8],r[9],r[10],r[11]],[r[12],r[13],r[14],r[15]]]}function lB(r,e,t,n,o,s,i){return r[e][o]*(r[t][s]*r[n][i]-r[t][i]*r[n][s])}function Ds(r,e,t){var n=(e+1)%4,o=(e+2)%4,s=(e+3)%4,i=(t+1)%4,a=(t+2)%4,c=(t+3)%4;return lB(r,n,o,s,i,a,c)+lB(r,o,s,n,i,a,c)+lB(r,s,n,o,i,a,c)}function JJ(r,e,t){t===void 0&&(t={ignoreRotation:!1});for(var n=[],o=0,s=r;o<s.length;o++){var i=s[o],a=i.x-.5,c=i.y-.5,l=t.ignoreRotation?0:e.rotation,u=Math.cos(l)*a-Math.sin(l)*c,p=Math.sin(l)*a+Math.cos(l)*c;u=u*e.width+e.xCenter,p=p*e.height+e.yCenter;var d=i.z*e.width,h=on({},i);h.x=u,h.y=p,h.z=d,n.push(h)}return n}function Lee(r,e){var t=function(n,o,s,i){var a=o-n,c=i-s;if(a===0)throw new Error("Original min and max are both ".concat(n,", range cannot be 0."));var l=c/a;return{scale:l,offset:s-n*l}}(0,255,e[0],e[1]);return ee(function(){return ae(W(r,t.scale),t.offset)})}function xB(r,e,t){var n,o,s,i,a,c,l,u,p,d,h,f,m,g,y=e.outputTensorSize,x=e.keepAspectRatio,b=e.borderMode,w=e.outputTensorFloatRange,_=$b(r),I=function(R,L){return L?{xCenter:L.xCenter*R.width,yCenter:L.yCenter*R.height,width:L.width*R.width,height:L.height*R.height,rotation:L.rotation}:{xCenter:.5*R.width,yCenter:.5*R.height,width:R.width,height:R.height,rotation:0}}(_,t),S=function(R,L,B){if(B===void 0&&(B=!1),!B)return{top:0,left:0,right:0,bottom:0};var z=L.height,q=L.width;yB(L,"targetSize"),yB(R,"roi");var U,G,j=z/q,X=R.height/R.width,te=0,ne=0;return j>X?(U=R.width,G=R.width*j,ne=(1-X/j)/2):(U=R.height/j,G=R.height,te=(1-j/X)/2),R.width=U,R.height=G,{top:ne,left:te,right:te,bottom:ne}}(I,y,x),k=(n=I,o=_.width,s=_.height,i=!1,a=n.width,c=n.height,l=i?-1:1,u=Math.cos(n.rotation),p=Math.sin(n.rotation),d=n.xCenter,h=n.yCenter,f=1/o,m=1/s,(g=new Array(16))[0]=a*u*l*f,g[1]=-c*p*f,g[2]=0,g[3]=(-.5*a*u*l+.5*c*p+d)*f,g[4]=a*p*l*m,g[5]=c*u*m,g[6]=0,g[7]=(-.5*c*u-.5*a*p*l+h)*m,g[8]=0,g[9]=0,g[10]=a*f,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,$ee(g));return{imageTensor:ee(function(){var R=wB(r),L=us(Pee(k,_,y),[1,8]),B=b==="zero"?"constant":"nearest",z=Gn.transform(Hr(he(R,"float32")),L,"bilinear",B,0,[y.height,y.width]);return w!=null?Lee(z,w):z}),padding:S,transformationMatrix:k}}function eee(r,e,t,n){return n===1?.5*(r+e):r+(e-r)*t/(n-1)}function fBe(r){return ee(function(){var e=function(o){return ee(function(){return[tt(o,[0,0,0],[1,-1,1]),tt(o,[0,0,1],[1,-1,-1])]})}(r),t=e[0],n=e[1];return{boxes:Jt(n),logits:Jt(t)}})}function Vee(r){return r!=null&&r.currentTime!=null}function tee(r){for(var e={locationData:{relativeKeypoints:[]}},t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,i=0;i<r.length;++i){var a=r[i];t=Math.min(t,a.x),n=Math.max(n,a.x),o=Math.min(o,a.y),s=Math.max(s,a.y),e.locationData.relativeKeypoints.push({x:a.x,y:a.y})}return e.locationData.relativeBoundingBox={xMin:t,yMin:o,xMax:n,yMax:s,width:n-t,height:s-o},e}function mBe(r,e,t,n){return yr(this,void 0,void 0,function(){var o,s,i,a,c;return xr(this,function(l){switch(l.label){case 0:return r.sort(function(u,p){return Math.max.apply(Math,p.score)-Math.max.apply(Math,u.score)}),o=us(r.map(function(u){return[u.locationData.relativeBoundingBox.yMin,u.locationData.relativeBoundingBox.xMin,u.locationData.relativeBoundingBox.yMax,u.locationData.relativeBoundingBox.xMax]})),s=Or(r.map(function(u){return u.score[0]})),[4,Gn.nonMaxSuppressionAsync(o,s,e,t)];case 1:return[4,(i=l.sent()).array()];case 2:return a=l.sent(),c=r.filter(function(u,p){return a.indexOf(p)>-1}),Xe([o,s,i]),[2,c]}})})}function Bee(r,e){return r.map(function(t){var n=on(on({},t),{x:t.x*e.width,y:t.y*e.height});return t.z!=null&&(n.z=t.z*e.width),n})}function gBe(r,e,t){return yr(this,void 0,void 0,function(){var n,o,s,i,a,c,l,u,p,d,h,f,m,g,y,x,b,w,_,I,S,k,R,L;return xr(this,function(B){switch(B.label){case 0:if(n=Jt(e,[0]),o=n.shape,s=o[0],i=o[1],a=o[2],r.length!==a)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+"".concat(r.length,", heatmap length: ").concat(a));return c=[],[4,n.buffer()];case 1:for(l=B.sent(),u=0;u<r.length;u++)if(p=r[u],d=on({},p),c.push(d),h=Math.trunc(d.x*i),f=Math.trunc(d.y*s),!(h<0||h>=i||f<0||h>=s)){for(m=Math.trunc((t.kernelSize-1)/2),g=Math.max(0,h-m),y=Math.min(i,h+m+1),x=Math.max(0,f-m),b=Math.min(s,f+m+1),w=0,_=0,I=0,S=0,k=x;k<b;++k)for(R=g;R<y;++R)L=l.get(k,R,u),w+=L,S=Math.max(S,L),_+=R*L,I+=k*L;S>=t.minConfidenceToRefine&&w>0&&(d.x=_/i/w,d.y=I/s/w)}return n.dispose(),[2,c]}})})}function ree(r,e){var t=e.left,n=e.top,o=e.left+e.right,s=e.top+e.bottom;return r.map(function(i){return on(on({},i),{x:(i.x-t)/(1-o),y:(i.y-n)/(1-s),z:i.z/(1-o)})})}function yBe(r,e,t){return pp()==="webgl"?function(n,o,s){var i=s.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:n.shape,userCode:`
  void main() {
      ivec2 coords = getOutputCoords();
      int height = coords[0];
      int width = coords[1];

      float prevMaskValue = getPrevMask(height, width);
      float newMaskValue = getNewMask(height, width);

      /*
      * Assume p := newMaskValue
      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)
      * uncertainty alpha(p) =
      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the
      * uncertainty]
      *
      * The following polynomial approximates uncertainty alpha as a
      * function of (p + 0.5):
      */
      const float c1 = 5.68842;
      const float c2 = -0.748699;
      const float c3 = -57.8051;
      const float c4 = 291.309;
      const float c5 = -624.717;
      float t = newMaskValue - 0.5;
      float x = t * t;

      float uncertainty =
        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));

      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *
                             (uncertainty * `.concat(i,`);

      setOutput(outputValue);
    }
`)},c=dp();return ee(function(){var l=c.compileAndRun(a,[n,o]);return _o().makeTensorFromDataId(l.dataId,l.shape,l.dtype)})}(r,e,t):ee(function(){var n=Te(e,.5),o=vt(n),s=Te(1,Js(1,W(o,ae(5.68842,W(o,ae(-.748699,W(o,ae(-57.8051,W(o,ae(291.309,W(o,-624.717)))))))))));return ae(e,W(Te(r,e),W(s,t.combineWithPreviousRatio)))})}function xBe(r,e,t){return yr(this,void 0,void 0,function(){var n,o,s,i,a;return xr(this,function(c){switch(c.label){case 0:return n=r[0],o=r[1],s=function(l,u,p){return ee(function(){var d,h,f,m;p.reverseOutputOrder?(h=Jt(tt(l,[0,p.boxCoordOffset+0],[-1,1])),d=Jt(tt(l,[0,p.boxCoordOffset+1],[-1,1])),m=Jt(tt(l,[0,p.boxCoordOffset+2],[-1,1])),f=Jt(tt(l,[0,p.boxCoordOffset+3],[-1,1]))):(d=Jt(tt(l,[0,p.boxCoordOffset+0],[-1,1])),h=Jt(tt(l,[0,p.boxCoordOffset+1],[-1,1])),f=Jt(tt(l,[0,p.boxCoordOffset+2],[-1,1])),m=Jt(tt(l,[0,p.boxCoordOffset+3],[-1,1]))),h=ae(W(Ce(h,p.xScale),u.w),u.x),d=ae(W(Ce(d,p.yScale),u.h),u.y),p.applyExponentialOnBoxSize?(f=W(nn(Ce(f,p.hScale)),u.h),m=W(nn(Ce(m,p.wScale)),u.w)):(f=W(Ce(f,p.hScale),u.h),m=W(Ce(m,p.wScale),u.h));var g=Te(d,Ce(f,2)),y=Te(h,Ce(m,2)),x=ae(d,Ce(f,2)),b=ae(h,Ce(m,2)),w=Xt([H(g,[p.numBoxes,1]),H(y,[p.numBoxes,1]),H(x,[p.numBoxes,1]),H(b,[p.numBoxes,1])],1);if(p.numKeypoints)for(var _=0;_<p.numKeypoints;++_){var I=p.keypointCoordOffset+_*p.numValuesPerKeypoint,S=void 0,k=void 0;p.reverseOutputOrder?(S=Jt(tt(l,[0,I],[-1,1])),k=Jt(tt(l,[0,I+1],[-1,1]))):(k=Jt(tt(l,[0,I],[-1,1])),S=Jt(tt(l,[0,I+1],[-1,1])));var R=ae(W(Ce(S,p.xScale),u.w),u.x),L=ae(W(Ce(k,p.yScale),u.h),u.y);w=Xt([w,H(R,[p.numBoxes,1]),H(L,[p.numBoxes,1])],1)}return w})}(o,e,t),i=ee(function(){var l=n;return t.sigmoidScore?(t.scoreClippingThresh!=null&&(l=Zn(n,-t.scoreClippingThresh,t.scoreClippingThresh)),l=co(l)):l}),[4,vBe(s,i,t)];case 1:return a=c.sent(),Xe([s,i]),[2,a]}})})}function vBe(r,e,t){return yr(this,void 0,void 0,function(){var n,o,s,i,a,c,l,u,p,d,h,f;return xr(this,function(m){switch(m.label){case 0:return n=[],[4,r.data()];case 1:return o=m.sent(),[4,e.data()];case 2:for(s=m.sent(),i=0;i<t.numBoxes;++i)if(!(t.minScoreThresh!=null&&s[i]<t.minScoreThresh||(a=i*t.numCoords,c=bBe(o[a+0],o[a+1],o[a+2],o[a+3],s[i],t.flipVertically,i),(l=c.locationData.relativeBoundingBox).width<0||l.height<0))){if(t.numKeypoints>0)for((u=c.locationData).relativeKeypoints=[],p=t.numKeypoints*t.numValuesPerKeypoint,d=0;d<p;d+=t.numValuesPerKeypoint)h=a+t.keypointCoordOffset+d,f={x:o[h+0],y:t.flipVertically?1-o[h+1]:o[h+1]},u.relativeKeypoints.push(f);n.push(c)}return[2,n]}})})}function bBe(r,e,t,n,o,s,i){return{score:[o],ind:i,locationData:{relativeBoundingBox:{xMin:e,yMin:s?1-t:r,xMax:n,yMax:s?1-r:t,width:n-e,height:t-r}}}}function wBe(r,e){return r==="none"?e:function(t){return 1/(1+Math.exp(-t))}(e)}function nee(r,e,t,n){return yr(this,void 0,void 0,function(){var o,s,i,a,c,l,u,p;return xr(this,function(d){switch(d.label){case 0:return t=t||e.flipHorizontally||!1,n=n||e.flipVertically||!1,o=r.size,s=o/e.numLandmarks,[4,r.data()];case 1:for(i=d.sent(),a=[],c=0;c<e.numLandmarks;++c)l=c*s,(p={x:0,y:0}).x=t?e.inputImageWidth-i[l]:i[l],s>1&&(p.y=n?e.inputImageHeight-i[l+1]:i[l+1]),s>2&&(p.z=i[l+2]),s>3&&(p.score=wBe(e.visibilityActivation,i[l+3])),a.push(p);for(u=0;u<a.length;++u)(p=a[u]).x=p.x/e.inputImageWidth,p.y=p.y/e.inputImageHeight,p.z=p.z/e.inputImageWidth/(e.normalizeZ||1);return[2,a]}})})}function oee(r,e,t){var n=r.width,o=r.height,s=r.rotation;if(t.rotation==null&&t.rotationDegree==null||(s=function(u,p){return p.rotation!=null?u+=p.rotation:p.rotationDegree!=null&&(u+=Math.PI*p.rotationDegree/180),Fee(u)}(s,t)),s===0)r.xCenter=r.xCenter+n*t.shiftX,r.yCenter=r.yCenter+o*t.shiftY;else{var i=(e.width*n*t.shiftX*Math.cos(s)-e.height*o*t.shiftY*Math.sin(s))/e.width,a=(e.width*n*t.shiftX*Math.sin(s)+e.height*o*t.shiftY*Math.cos(s))/e.height;r.xCenter=r.xCenter+i,r.yCenter=r.yCenter+a}if(t.squareLong){var c=Math.max(n*e.width,o*e.height);n=c/e.width,o=c/e.height}else if(t.squareShort){var l=Math.min(n*e.width,o*e.height);n=l/e.width,o=l/e.height}return r.width=n*t.scaleX,r.height=o*t.scaleY,r}function CBe(r,e){return r.map(function(t){var n=on(on({},t),{x:t.x/e.width,y:t.y/e.height});return t.z!=null&&(t.z=t.z/e.width),n})}var pm=function(){function r(e){this.alpha=e,this.initialized=!1}return r.prototype.apply=function(e,t){var n;return this.initialized?n=t==null?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*t*Math.asinh((e-this.storedValue)/t):(n=e,this.initialized=!0),this.rawValue=e,this.storedValue=n,n},r.prototype.applyWithAlpha=function(e,t,n){return this.alpha=t,this.apply(e,n)},r.prototype.hasLastRawValue=function(){return this.initialized},r.prototype.lastRawValue=function(){return this.rawValue},r.prototype.reset=function(){this.initialized=!1},r}(),uB=function(){function r(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new pm(this.getAlpha(this.minCutOff)),this.dx=new pm(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return r.prototype.apply=function(e,t,n){if(e==null)return e;var o=Math.trunc(t);if(this.lastTimestamp>=o)return e;this.lastTimestamp!==0&&o!==0&&(this.frequency=1/(1e-6*(o-this.lastTimestamp))),this.lastTimestamp=o;var s=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*n*this.frequency:0,i=this.dx.applyWithAlpha(s,this.getAlpha(this.derivateCutOff)),a=this.minCutOff+this.beta*Math.abs(i),c=this.thresholdCutOff!=null?this.thresholdCutOff+this.thresholdBeta*Math.abs(i):null;return this.x.applyWithAlpha(e,this.getAlpha(a),c)},r.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},r}(),vB=function(){function r(e){this.config=e}return r.prototype.apply=function(e,t,n){var o=this;if(e==null)return this.reset(),null;this.initializeFiltersIfEmpty(e);var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return gy([],e,!0);s=1/n}return e.map(function(i,a){var c=on(on({},i),{x:o.xFilters[a].apply(i.x,t,s),y:o.yFilters[a].apply(i.y,t,s)});return i.z!=null&&(c.z=o.zFilters[a].apply(i.z,t,s)),c})},r.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},r.prototype.initializeFiltersIfEmpty=function(e){var t=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(n){return new uB(t.config)}),this.yFilters=e.map(function(n){return new uB(t.config)}),this.zFilters=e.map(function(n){return new uB(t.config)}))},r}(),pB=function(){function r(e){this.config=e,this.window=[],this.lowPassFilter=new pm(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return r.prototype.apply=function(e,t,n){if(e==null)return e;var o,s=Math.trunc(t);if(this.lastTimestamp>=s)return e;if(this.lastTimestamp===-1)o=1;else{for(var i=e*n-this.lastValue*this.lastValueScale,a=s-this.lastTimestamp,c=i,l=a,u=(1+this.window.length)*(1e6/30),p=0,d=this.window;p<d.length;p++){var h=d[p];if(l+h.duration>u)break;c+=h.distance,l+=h.duration}var f=c/(1e-6*l);o=1-1/(1+this.config.velocityScale*Math.abs(f)),this.window.unshift({distance:i,duration:a}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=n,this.lastTimestamp=s,this.lowPassFilter.applyWithAlpha(e,o)},r}(),_Be=function(){function r(e){this.config=e}return r.prototype.apply=function(e,t,n){var o=this;if(e==null)return this.reset(),null;var s=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return gy([],e,!0);s=1/n}return this.initializeFiltersIfEmpty(e),e.map(function(i,a){var c=on(on({},i),{x:o.xFilters[a].apply(i.x,t,s),y:o.yFilters[a].apply(i.y,t,s)});return i.z!=null&&(c.z=o.zFilters[a].apply(i.z,t,s)),c})},r.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},r.prototype.initializeFiltersIfEmpty=function(e){var t=this;this.xFilters!=null&&this.xFilters.length===e.length||(this.xFilters=e.map(function(n){return new pB(t.config)}),this.yFilters=e.map(function(n){return new pB(t.config)}),this.zFilters=e.map(function(n){return new pB(t.config)}))},r}(),dB=function(){function r(e){if(e.velocityFilter!=null)this.keypointsFilter=new _Be(e.velocityFilter);else{if(e.oneEuroFilter==null)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+"".concat(e,"."));this.keypointsFilter=new vB(e.oneEuroFilter)}}return r.prototype.apply=function(e,t,n,o,s){if(o===void 0&&(o=!1),e==null)return this.keypointsFilter.reset(),null;var i=s!=null?function(l,u){return(l.width*u.width+l.height*u.height)/2}(s,n):1,a=o?Bee(e,n):e,c=this.keypointsFilter.apply(a,t,i);return o?CBe(c,n):c},r}(),see=function(){function r(e){this.alpha=e.alpha}return r.prototype.apply=function(e){var t=this;if(e==null)return this.visibilityFilters=null,null;this.visibilityFilters!=null&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map(function(a){return new pm(t.alpha)}));for(var n=[],o=0;o<e.length;++o){var s=e[o],i=on({},s);i.score=this.visibilityFilters[o].apply(s.score),n.push(i)}return n},r}(),SBe={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},Pb={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},IBe={maxPoses:1,flipHorizontal:!1},TBe={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},kBe=.3,iee={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},EBe={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},NBe={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},DBe={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},ABe={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},RBe={kernelSize:7,minConfidenceToRefine:.5},aee={alpha:.1},OBe={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},MBe={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},FBe={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},PBe={activation:"none"},$Be={combineWithPreviousRatio:.7},LBe=function(){function r(e){this.mask=e}return r.prototype.toCanvasImageSource=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,Ree(this.mask)]})})},r.prototype.toImageData=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,Oee(this.mask)]})})},r.prototype.toTensor=function(){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,this.mask]})})},r.prototype.getUnderlyingType=function(){return"tensor"},r}();function VBe(r){return Mee(r),"person"}var BBe=function(){function r(e,t,n,o,s,i){this.detectorModel=e,this.landmarkModel=t,this.enableSmoothing=n,this.enableSegmentation=o,this.smoothSegmentation=s,this.modelType=i,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(p){p.reduceBoxesInLowestLayer==null&&(p.reduceBoxesInLowestLayer=!1),p.interpolatedScaleAspectRatio==null&&(p.interpolatedScaleAspectRatio=1),p.fixedAnchorSize==null&&(p.fixedAnchorSize=!1);for(var d=[],h=0;h<p.numLayers;){for(var f=[],m=[],g=[],y=[],x=h;x<p.strides.length&&p.strides[x]===p.strides[h];){var b=eee(p.minScale,p.maxScale,x,p.strides.length);if(x===0&&p.reduceBoxesInLowestLayer)g.push(1),g.push(2),g.push(.5),y.push(.1),y.push(b),y.push(b);else{for(var w=0;w<p.aspectRatios.length;++w)g.push(p.aspectRatios[w]),y.push(b);if(p.interpolatedScaleAspectRatio>0){var _=x===p.strides.length-1?1:eee(p.minScale,p.maxScale,x+1,p.strides.length);y.push(Math.sqrt(b*_)),g.push(p.interpolatedScaleAspectRatio)}}x++}for(var I=0;I<g.length;++I){var S=Math.sqrt(g[I]);f.push(y[I]/S),m.push(y[I]*S)}var k=0,R=0;if(p.featureMapHeight.length>0)k=p.featureMapHeight[h],R=p.featureMapWidth[h];else{var L=p.strides[h];k=Math.ceil(p.inputSizeHeight/L),R=Math.ceil(p.inputSizeWidth/L)}for(var B=0;B<k;++B)for(var z=0;z<R;++z)for(var q=0;q<f.length;++q){var U={xCenter:(z+p.anchorOffsetX)/R,yCenter:(B+p.anchorOffsetY)/k,width:0,height:0};p.fixedAnchorSize?(U.width=1,U.height=1):(U.width=m[q],U.height=f[q]),d.push(U)}h=x}return d}(SBe);var a=Or(this.anchors.map(function(p){return p.width})),c=Or(this.anchors.map(function(p){return p.height})),l=Or(this.anchors.map(function(p){return p.xCenter})),u=Or(this.anchors.map(function(p){return p.yCenter}));this.anchorTensor={x:l,y:u,w:a,h:c},this.prevFilteredSegmentationMask=this.enableSegmentation?us([],[0,0]):null}return r.prototype.estimatePoses=function(e,t,n){return yr(this,void 0,void 0,function(){var o,s,i,a,c,l,u,p,d,h,f,m,g,y,x,b,w,_,I,S,k,R,L;return xr(this,function(B){switch(B.label){case 0:return o=function(z){var q;if((q=z==null?IBe:on({},z)).maxPoses==null&&(q.maxPoses=1),q.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(q.maxPoses,". Should be > 0."));if(q.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return q}(t),e==null?(this.reset(),[2,[]]):(this.maxPoses=o.maxPoses,this.timestamp=n!=null?1e3*n:Vee(e)?1e6*e.currentTime:null,s=$b(e),i=ee(function(){return he(wB(e),"float32")}),(a=this.regionOfInterest)!=null?[3,2]:[4,this.detectPose(i)]);case 1:if((c=B.sent()).length===0)return this.reset(),i.dispose(),[2,[]];l=c[0],a=this.poseDetectionToRoi(l,s),B.label=2;case 2:return[4,this.poseLandmarksByRoi(a,i)];case 3:return u=B.sent(),i.dispose(),u==null?(this.reset(),[2,[]]):(p=u.landmarks,d=u.auxiliaryLandmarks,h=u.poseScore,f=u.worldLandmarks,m=u.segmentationMask,g=this.poseLandmarkFiltering(p,d,f,s),y=g.actualLandmarksFiltered,x=g.auxiliaryLandmarksFiltered,b=g.actualWorldLandmarksFiltered,w=this.poseLandmarksToRoi(x,s),this.regionOfInterest=w,_=this.smoothSegmentation&&m!=null?this.poseSegmentationFiltering(m):m,(I=y!=null?Bee(y,s):null)!=null&&I.forEach(function(z,q){z.name=F_[q]}),(S=b)!=null&&S.forEach(function(z,q){z.name=F_[q]}),k={score:h,keypoints:I,keypoints3D:S},_!==null&&(R=ee(function(){var z=Hr(_,2),q=ko(z,[[0,0],[0,0],[0,1]]);return Zv(q,[[0,0],[0,0],[0,2]],"symmetric")}),this.smoothSegmentation||Xe(_),L={maskValueToLabel:VBe,mask:new LBe(R)},k.segmentation=L),[2,[k]])}})})},r.prototype.poseSegmentationFiltering=function(e){var t=this.prevFilteredSegmentationMask;return t.size===0?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=yBe(t,e,$Be),Xe(e)),Xe(t),this.prevFilteredSegmentationMask},r.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),Xe([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},r.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(Xe(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=us([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},r.prototype.detectPose=function(e){return yr(this,void 0,void 0,function(){var t,n,o,s,i,a,c,l,u,p;return xr(this,function(d){switch(d.label){case 0:return t=xB(e,EBe),n=t.imageTensor,o=t.padding,s=this.detectorModel.predict(n),i=fBe(s),a=i.boxes,[4,xBe([c=i.logits,a],this.anchorTensor,TBe)];case 1:return(l=d.sent()).length===0?(Xe([n,s,c,a]),[2,l]):[4,mBe(l,this.maxPoses,kBe)];case 2:return u=d.sent(),p=function(h,f){h===void 0&&(h=[]);for(var m=f.left,g=f.top,y=f.left+f.right,x=f.top+f.bottom,b=0;b<h.length;b++){var w=h[b],_=w.locationData.relativeBoundingBox,I=(_.xMin-m)/(1-y),S=(_.yMin-g)/(1-x),k=_.width/(1-y),R=_.height/(1-x);_.xMin=I,_.yMin=S,_.width=k,_.height=R,_.xMax=I+k,_.yMax=S+R;var L=w.locationData.relativeKeypoints;L&&L.forEach(function(B){var z=(B.x-m)/(1-y),q=(B.y-g)/(1-x);B.x=z,B.y=q})}return h}(u,o),Xe([n,s,c,a]),[2,p]}})})},r.prototype.poseDetectionToRoi=function(e,t){return oee(cB(e,t,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),t,iee)},r.prototype.poseLandmarksByRoi=function(e,t){return yr(this,void 0,void 0,function(){var n,o,s,i,a,c,l,u,p,d,h,f,m,g;return xr(this,function(y){switch(y.label){case 0:if(n=$b(t),o=xB(t,NBe,e),s=o.imageTensor,i=o.padding,a=o.transformationMatrix,this.modelType!=="lite"&&this.modelType!=="full"&&this.modelType!=="heavy")throw new Error("Model type must be one of lite, full or heavy,"+"but got ".concat(this.modelType));return c=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&c.push("activation_segmentation"),l=this.landmarkModel.execute(s,c),[4,this.tensorsToPoseLandmarksAndSegmentation(l)];case 1:return(u=y.sent())==null?(Xe(l),Xe(s),[2,null]):(p=u.landmarks,d=u.auxiliaryLandmarks,h=u.poseScore,f=u.worldLandmarks,m=u.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,e,i,a,p,d,f,m)]);case 2:return g=y.sent(),Xe(l),Xe(s),[2,on({poseScore:h},g)]}})})},r.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,t,n,o,s,i,a,c){return yr(this,void 0,void 0,function(){var l,u,p,d,h,f;return xr(this,function(m){return l=ree(s,n),u=ree(i,n),p=JJ(l,t),d=JJ(u,t),h=function(g,y){for(var x=[],b=0,w=g;b<w.length;b++){var _=w[b],I=_.x,S=_.y,k=y.rotation,R=Math.cos(k)*I-Math.sin(k)*S,L=Math.sin(k)*I+Math.cos(k)*S,B=on({},_);B.x=R,B.y=L,x.push(B)}return x}(a,t),f=null,this.enableSegmentation&&(f=ee(function(){var g=c.shape,y=g[0],x=g[1],b=function(I){var S=$ee(new Array(16).fill(0));S[0][0]=Ds(I,0,0),S[1][0]=-Ds(I,0,1),S[2][0]=Ds(I,0,2),S[3][0]=-Ds(I,0,3),S[0][2]=Ds(I,2,0),S[1][2]=-Ds(I,2,1),S[2][2]=Ds(I,2,2),S[3][2]=-Ds(I,2,3),S[0][1]=-Ds(I,1,0),S[1][1]=Ds(I,1,1),S[2][1]=-Ds(I,1,2),S[3][1]=Ds(I,1,3),S[0][3]=-Ds(I,3,0),S[1][3]=Ds(I,3,1),S[2][3]=-Ds(I,3,2),S[3][3]=Ds(I,3,3);for(var k=I[0][0]*S[0][0]+I[1][0]*S[0][1]+I[2][0]*S[0][2]+I[3][0]*S[0][3],R=0;R<S.length;R++)for(var L=0;L<S.length;L++)S[R][L]/=k;return S}(o),w=us(Pee(b,{width:x,height:y},e),[1,8]),_=[1,y,x,1];return Jt(Gn.transform(H(c,_),w,"bilinear","constant",0,[e.height,e.width]),[0,3])}),Xe(c)),[2,{landmarks:p,auxiliaryLandmarks:d,worldLandmarks:h,segmentationMask:f}]})})},r.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return yr(this,void 0,void 0,function(){var t,n,o,s,i,a,c,l,u,p,d,h,f;return xr(this,function(m){switch(m.label){case 0:return t=e[0],n=e[1],o=e[2],s=e[3],i=this.enableSegmentation?e[4]:null,[4,n.data()];case 1:return(a=m.sent()[0])<.5?[2,null]:[4,nee(t,DBe)];case 2:return[4,gBe(m.sent(),o,RBe)];case 3:return c=m.sent(),l=c.slice(0,33),u=c.slice(33,35),[4,nee(s,ABe)];case 4:return p=m.sent(),d=p.slice(0,33),h=function(g,y,x){x===void 0&&(x=!0);for(var b=[],w=0;w<g.length;w++){var _=on({},y[w]);x&&(_.score=g[w].score),b.push(_)}return b}(l,d,!0),f=this.enableSegmentation?function(g,y,x){return ee(function(){var b=Jt(g,[0]),w=b.shape[2];if(w===1){var _=b;switch(y.activation){case"none":break;case"sigmoid":_=co(_);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported (".concat(y.activation,")"))}var I=x?Gn.resizeBilinear(_,[x.height,x.width]):_;return Jt(I,[2])}throw new Error("Unsupported number of tensor channels ".concat(w))})}(i,PBe):null,[2,{landmarks:l,auxiliaryLandmarks:u,poseScore:a,worldLandmarks:h,segmentationMask:f}]}})})},r.prototype.poseLandmarksToRoi=function(e,t){return oee(cB(tee(e),t,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),t,iee)},r.prototype.poseLandmarkFiltering=function(e,t,n,o){var s,i,a;if(this.timestamp!=null&&this.enableSmoothing){var c=cB(tee(t),o,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});this.visibilitySmoothingFilterActual==null&&(this.visibilitySmoothingFilterActual=new see(aee)),s=this.visibilitySmoothingFilterActual.apply(e),this.visibilitySmoothingFilterAuxiliary==null&&(this.visibilitySmoothingFilterAuxiliary=new see(aee)),i=this.visibilitySmoothingFilterAuxiliary.apply(t),a=this.visibilitySmoothingFilterActual.apply(n),this.landmarksSmoothingFilterActual==null&&(this.landmarksSmoothingFilterActual=new dB(OBe)),s=this.landmarksSmoothingFilterActual.apply(s,this.timestamp,o,!0,c),this.landmarksSmoothingFilterAuxiliary==null&&(this.landmarksSmoothingFilterAuxiliary=new dB(MBe)),i=this.landmarksSmoothingFilterAuxiliary.apply(i,this.timestamp,o,!0,c),this.worldLandmarksSmoothingFilterActual==null&&(this.worldLandmarksSmoothingFilterActual=new dB(FBe)),a=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else s=e,i=t,a=n;return{actualLandmarksFiltered:s,auxiliaryLandmarksFiltered:i,actualWorldLandmarksFiltered:a}},r}();function zBe(r){return yr(this,void 0,void 0,function(){var e,t,n,o,s,i;return xr(this,function(a){switch(a.label){case 0:return e=function(c){var l=on({},c??Pb);if(l.enableSmoothing==null&&(l.enableSmoothing=Pb.enableSmoothing),l.enableSegmentation==null&&(l.enableSegmentation=Pb.enableSegmentation),l.smoothSegmentation==null&&(l.smoothSegmentation=Pb.smoothSegmentation),l.modelType==null&&(l.modelType=Pb.modelType),l.detectorModelUrl==null&&(l.detectorModelUrl=Pb.detectorModelUrl),l.landmarkModelUrl==null)switch(l.modelType){case"lite":l.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":l.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;case"full":default:l.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return l}(r),t=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,n=typeof e.landmarkModelUrl=="string"&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([im(e.detectorModelUrl,{fromTFHub:t}),im(e.landmarkModelUrl,{fromTFHub:n})])];case 1:return o=a.sent(),s=o[0],i=o[1],[2,new BBe(s,i,e.enableSmoothing,e.enableSegmentation,e.smoothSegmentation,e.modelType)]}})})}var yy,ds,zee=function(){function r(e){(function(t){if(t.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but "+"encountered ".concat(t.maxTracks));if(t.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but "+"encountered ".concat(t.maxAge));if(t.keypointTrackerParams!==void 0){if(t.keypointTrackerParams.keypointConfidenceThreshold<0||t.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+"".concat(t.keypointTrackerParams.keypointConfidenceThreshold));if(t.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but "+"encountered ".concat(t.keypointTrackerParams.minNumberOfKeypoints));for(var n=0,o=t.keypointTrackerParams.keypointFalloff;n<o.length;n++){var s=o[n];if(s<=0)throw new Error("Must specify each keypoint falloff parameterto be positive "+"but encountered ".concat(s))}}})(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return r.prototype.apply=function(e,t){this.filterOldTracks(t);var n=this.computeSimilarity(e);return this.assignTracks(e,n,t),this.updateTracks(t),e},r.prototype.getTracks=function(){return this.tracks.slice()},r.prototype.getTrackIDs=function(){return new Set(this.tracks.map(function(e){return e.id}))},r.prototype.filterOldTracks=function(e){var t=this;this.tracks=this.tracks.filter(function(n){return e-n.lastTimestamp<=t.maxAge})},r.prototype.assignTracks=function(e,t,n){for(var o=Array.from(Array(t[0].length).keys()),s=[],i=0,a=Array.from(Array(e.length).keys());i<a.length;i++){var c=a[i];if(o.length!==0){for(var l=-1,u=-1,p=0,d=o;p<d.length;p++){var h=d[p],f=t[c][h];f>=this.minSimilarity&&f>u&&(l=h,u=f)}if(l>=0){var m=this.tracks[l];m=Object.assign(m,this.createTrack(e[c],n,m.id)),e[c].id=m.id;var g=o.indexOf(l);o.splice(g,1)}else s.push(c)}else s.push(c)}for(var y=0,x=s;y<x.length;y++){c=x[y];var b=this.createTrack(e[c],n);this.tracks.push(b),e[c].id=b.id}},r.prototype.updateTracks=function(e){this.tracks.sort(function(t,n){return n.lastTimestamp-t.lastTimestamp}),this.tracks=this.tracks.slice(0,this.maxTracks)},r.prototype.createTrack=function(e,t,n){var o={id:n||this.nextTrackID(),lastTimestamp:t,keypoints:gy([],e.keypoints,!0).map(function(s){return on({},s)})};return e.box!==void 0&&(o.box=on({},e.box)),o},r.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},r.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracks=this.tracks.filter(function(n){return!e.includes(n.id)})},r.prototype.reset=function(){this.tracks=[]},r}(),UBe=function(r){function e(t){return r.call(this,t)||this}return Aee(e,r),e.prototype.computeSimilarity=function(t){var n=this;return t.length===0||this.tracks.length===0?[[]]:t.map(function(o){return n.tracks.map(function(s){return n.iou(o,s)})})},e.prototype.iou=function(t,n){var o=Math.max(t.box.xMin,n.box.xMin),s=Math.max(t.box.yMin,n.box.yMin),i=Math.min(t.box.xMax,n.box.xMax),a=Math.min(t.box.yMax,n.box.yMax);if(o>=i||s>=a)return 0;var c=(i-o)*(a-s);return c/(t.box.width*t.box.height+n.box.width*n.box.height-c)},e}(zee),GBe=function(r){function e(t){var n=r.call(this,t)||this;return n.keypointThreshold=t.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=t.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=t.keypointTrackerParams.minNumberOfKeypoints,n}return Aee(e,r),e.prototype.computeSimilarity=function(t){if(t.length===0||this.tracks.length===0)return[[]];for(var n=[],o=0,s=t;o<s.length;o++){for(var i=s[o],a=[],c=0,l=this.tracks;c<l.length;c++){var u=l[c];a.push(this.oks(i,u))}n.push(a)}return n},e.prototype.oks=function(t,n){for(var o=this.area(n.keypoints)+1e-6,s=0,i=0,a=0;a<t.keypoints.length;++a){var c=t.keypoints[a],l=n.keypoints[a];if(!(c.score<this.keypointThreshold||l.score<this.keypointThreshold)){i+=1;var u=Math.pow(c.x-l.x,2)+Math.pow(c.y-l.y,2),p=2*this.keypointFalloff[a];s+=Math.exp(-1*u/(2*o*Math.pow(p,2)))}}return i<this.minNumKeyoints?0:s/i},e.prototype.area=function(t){var n=this,o=t.filter(function(c){return c.score>n.keypointThreshold}),s=Math.min.apply(Math,gy([1],o.map(function(c){return c.x}),!1)),i=Math.max.apply(Math,gy([0],o.map(function(c){return c.x}),!1)),a=Math.min.apply(Math,gy([1],o.map(function(c){return c.y}),!1));return(i-s)*(Math.max.apply(Math,gy([0],o.map(function(c){return c.y}),!1))-a)},e}(zee);function Uee(r){switch(r){case ds.BlazePose:return F_.reduce(function(e,t,n){return e[t]=n,e},{});case ds.PoseNet:case ds.MoveNet:return Ip.reduce(function(e,t,n){return e[t]=n,e},{});default:throw new Error("Model ".concat(r," is not supported."))}}(function(r){r.Keypoint="keypoint",r.BoundingBox="boundingBox"})(yy||(yy={})),function(r){r.MoveNet="MoveNet",r.BlazePose="BlazePose",r.PoseNet="PoseNet"}(ds||(ds={}));var Ncr=Object.freeze({__proto__:null,getKeypointIndexBySide:function(r){switch(r){case ds.BlazePose:return sBe;case ds.PoseNet:case ds.MoveNet:return iBe;default:throw new Error("Model ".concat(r," is not supported."))}},getAdjacentPairs:function(r){switch(r){case ds.BlazePose:return cBe;case ds.PoseNet:case ds.MoveNet:return aBe;default:throw new Error("Model ".concat(r," is not supported."))}},getKeypointIndexByName:Uee}),cee=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],Gee={modelType:"SinglePose.Lightning",enableSmoothing:!0},lee={},uee={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},hB={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},pee={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function WBe(r,e,t,n){for(var o={},s=0,i=Ip;s<i.length;s++){var a=i[s];o[a]=[e[t[a]].y*n.height,e[t[a]].x*n.width]}if(function(x,b){return(x[b.left_hip].score>.2||x[b.right_hip].score>.2)&&(x[b.left_shoulder].score>.2||x[b.right_shoulder].score>.2)}(e,t)){var c=(o.left_hip[0]+o.right_hip[0])/2,l=(o.left_hip[1]+o.right_hip[1])/2,u=function(x,b,w,_,I){for(var S=["left_shoulder","right_shoulder","left_hip","right_hip"],k=0,R=0,L=0;L<S.length;L++)(G=Math.abs(_-w[S[L]][0]))>k&&(k=G),(j=Math.abs(I-w[S[L]][1]))>R&&(R=j);for(var B=0,z=0,q=0,U=Object.keys(w);q<U.length;q++){var G,j,X=U[q];x[b[X]].score<.2||((G=Math.abs(_-w[X][0]))>B&&(B=G),(j=Math.abs(I-w[X][1]))>z&&(z=j))}return[k,R,B,z]}(e,t,o,c,l),p=u[0],d=u[1],h=u[2],f=u[3],m=Math.max(1.9*d,1.9*p,1.2*h,1.2*f),g=[c-(m=Math.min(m,Math.max(l,n.width-l,c,n.height-c))),l-m];if(m>Math.max(n.width,n.height)/2)return bB(r==null,n);var y=2*m;return{yMin:g[0]/n.height,xMin:g[1]/n.width,yMax:(g[0]+y)/n.height,xMax:(g[1]+y)/n.width,height:(g[0]+y)/n.height-g[0]/n.height,width:(g[1]+y)/n.width-g[1]/n.width}}return bB(r==null,n)}function bB(r,e){var t,n,o,s;return r?e.width>e.height?(t=1,n=e.height/e.width,o=0,s=(e.width/2-e.height/2)/e.width):(t=e.width/e.height,n=1,o=(e.height/2-e.width/2)/e.height,s=0):e.width>e.height?(t=e.width/e.height,n=1,o=(e.height/2-e.width/2)/e.height,s=0):(t=1,n=e.height/e.width,o=0,s=(e.width/2-e.height/2)/e.width),{yMin:o,xMin:s,yMax:o+t,xMax:s+n,height:t,width:n}}function jBe(r){var e,t=r==null?Gee:on({},r);if(t.modelType==null)t.modelType="SinglePose.Lightning";else if(cee.indexOf(t.modelType)<0)throw new Error("Invalid architecture ".concat(t.modelType,". ")+"Should be one of ".concat(cee));if(t.enableSmoothing==null&&(t.enableSmoothing=!0),t.minPoseScore!=null&&(t.minPoseScore<0||t.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(t.multiPoseMaxDimension!=null&&(t.multiPoseMaxDimension%32!=0||t.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if(t.modelType==="MultiPose.Lightning"&&t.enableTracking==null&&(t.enableTracking=!0),t.modelType==="MultiPose.Lightning"&&t.enableTracking===!0)if(t.trackerType==null&&(t.trackerType=yy.BoundingBox),t.trackerType===yy.Keypoint)t.trackerConfig!=null?t.trackerConfig=function(n){var o=dee(hB,n);return o.keypointTrackerParams=on({},hB.keypointTrackerParams),n.keypointTrackerParams!=null&&(n.keypointTrackerParams.keypointConfidenceThreshold!=null&&(o.keypointTrackerParams.keypointConfidenceThreshold=n.keypointTrackerParams.keypointConfidenceThreshold),n.keypointTrackerParams.keypointFalloff!=null&&(o.keypointTrackerParams.keypointFalloff=n.keypointTrackerParams.keypointFalloff),n.keypointTrackerParams.minNumberOfKeypoints!=null&&(o.keypointTrackerParams.minNumberOfKeypoints=n.keypointTrackerParams.minNumberOfKeypoints)),o}(t.trackerConfig):t.trackerConfig=hB;else{if(t.trackerType!==yy.BoundingBox)throw new Error("Tracker type not supported by MoveNet");t.trackerConfig!=null?t.trackerConfig=(e=t.trackerConfig,dee(pee,e)):t.trackerConfig=pee}return t}function dee(r,e){var t={maxTracks:r.maxTracks,maxAge:r.maxAge,minSimilarity:r.minSimilarity};return e.maxTracks!=null&&(t.maxTracks=e.maxTracks),e.maxAge!=null&&(t.maxAge=e.maxAge),e.minSimilarity!=null&&(t.minSimilarity=e.minSimilarity),t}var HBe=function(){function r(e,t){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=Uee(ds.MoveNet),t.modelType==="SinglePose.Lightning"?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):t.modelType==="SinglePose.Thunder"&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel=t.modelType==="MultiPose.Lightning",this.multiPoseModel||(this.keypointFilter=new vB(uee),this.cropRegionFilterYMin=new pm(.9),this.cropRegionFilterXMin=new pm(.9),this.cropRegionFilterYMax=new pm(.9),this.cropRegionFilterXMax=new pm(.9)),this.enableSmoothing=t.enableSmoothing,t.minPoseScore?this.minPoseScore=t.minPoseScore:this.minPoseScore=.25,t.multiPoseMaxDimension?this.multiPoseMaxDimension=t.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=t.enableTracking,this.multiPoseModel&&this.enableTracking&&(t.trackerType===yy.Keypoint?this.tracker=new GBe(t.trackerConfig):t.trackerType===yy.BoundingBox&&(this.tracker=new UBe(t.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return r.prototype.runSinglePersonPoseModel=function(e){return yr(this,void 0,void 0,function(){var t,n,o,s,i;return xr(this,function(a){switch(a.label){case 0:if((t=this.moveNetModel.execute(e)).shape.length!==4||t.shape[0]!==1||t.shape[1]!==1||t.shape[2]!==17||t.shape[3]!==3)throw t.dispose(),new Error("Unexpected output shape from model: [".concat(t.shape,"]"));return pp()==="webgpu"?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=a.sent(),a.label=3;case 3:for(t.dispose(),o={keypoints:[],score:0},s=0,i=0;i<17;++i)o.keypoints[i]={y:n[3*i],x:n[3*i+1],score:n[3*i+2]},o.keypoints[i].score>.2&&(++s,o.score+=o.keypoints[i].score);return s>0&&(o.score/=s),[2,o]}})})},r.prototype.runMultiPersonPoseModel=function(e){return yr(this,void 0,void 0,function(){var t,n,o,s,i,a,c,l;return xr(this,function(u){switch(u.label){case 0:if((t=this.moveNetModel.execute(e)).shape.length!==3||t.shape[0]!==1||t.shape[2]!==56)throw t.dispose(),new Error("Unexpected output shape from model: [".concat(t.shape,"]"));return pp()==="webgpu"?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=u.sent(),u.label=3;case 3:for(t.dispose(),o=[],s=n.length/56,i=0;i<s;++i)for(o[i]={keypoints:[]},a=56*i+51,o[i].box={yMin:n[a],xMin:n[a+1],yMax:n[a+2],xMax:n[a+3],width:n[a+3]-n[a+1],height:n[a+2]-n[a]},c=56*i+55,o[i].score=n[c],o[i].keypoints=[],l=0;l<17;++l)o[i].keypoints[l]={y:n[56*i+3*l],x:n[56*i+3*l+1],score:n[56*i+3*l+2]};return[2,o]}})})},r.prototype.estimatePoses=function(e,t,n){return t===void 0&&(t=lee),yr(this,void 0,void 0,function(){var o,s,i,a,c,l;return xr(this,function(u){switch(u.label){case 0:return t=function(p){return p==null?lee:on({},p)}(t),e==null?(this.reset(),[2,[]]):(n==null?Vee(e)&&(n=1e6*e.currentTime):n*=1e3,o=wB(e),s=$b(o),i=Hr(o,0),e instanceof Ct||o.dispose(),a=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(i,s,n)]);case 1:return a=u.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(i,s,n)];case 3:a=u.sent(),u.label=4;case 4:for(c=0;c<a.length;++c)for(l=0;l<a[c].keypoints.length;++l)a[c].keypoints[l].name=Ip[l],a[c].keypoints[l].y*=s.height,a[c].keypoints[l].x*=s.width;return[2,a]}})})},r.prototype.estimateSinglePose=function(e,t,n){return yr(this,void 0,void 0,function(){var o,s,i,a,c=this;return xr(this,function(l){switch(l.label){case 0:return this.cropRegion||(this.cropRegion=bB(this.cropRegion==null,t)),o=ee(function(){var u=us([[c.cropRegion.yMin,c.cropRegion.xMin,c.cropRegion.yMax,c.cropRegion.xMax]]),p=Cr([1],"int32"),d=[c.modelInputResolution.height,c.modelInputResolution.width];return he(Gn.cropAndResize(e,u,p,d,"bilinear",0),"int32")}),e.dispose(),[4,this.runSinglePersonPoseModel(o)];case 1:if(s=l.sent(),o.dispose(),s.score<this.minPoseScore)return this.reset(),[2,[]];for(i=0;i<s.keypoints.length;++i)s.keypoints[i].y=this.cropRegion.yMin+s.keypoints[i].y*this.cropRegion.height,s.keypoints[i].x=this.cropRegion.xMin+s.keypoints[i].x*this.cropRegion.width;return n!=null&&this.enableSmoothing&&(s.keypoints=this.keypointFilter.apply(s.keypoints,n,1)),a=WBe(this.cropRegion,s.keypoints,this.keypointIndexByName,t),this.cropRegion=this.filterCropRegion(a),[2,[s]]}})})},r.prototype.estimateMultiplePoses=function(e,t,n){return yr(this,void 0,void 0,function(){var o,s,i,a,c,l,u,p,d,h,f,m=this;return xr(this,function(g){switch(g.label){case 0:return t.width>t.height?(s=this.multiPoseMaxDimension,i=Math.round(this.multiPoseMaxDimension*t.height/t.width),o=Gn.resizeBilinear(e,[i,s]),c=s,l=32*Math.ceil(i/32),a=ko(o,[[0,0],[0,l-i],[0,0],[0,0]])):(s=Math.round(this.multiPoseMaxDimension*t.width/t.height),i=this.multiPoseMaxDimension,o=Gn.resizeBilinear(e,[i,s]),c=32*Math.ceil(s/32),l=i,a=ko(o,[[0,0],[0,0],[0,c-s],[0,0]])),o.dispose(),e.dispose(),u=he(a,"int32"),a.dispose(),[4,this.runMultiPersonPoseModel(u)];case 1:for(p=g.sent(),u.dispose(),p=p.filter(function(y){return y.score>=m.minPoseScore}),h=0;h<p.length;++h)for(d=0;d<p[h].keypoints.length;++d)p[h].keypoints[d].y*=l/i,p[h].keypoints[d].x*=c/s;if(this.enableTracking&&(this.tracker.apply(p,n),this.enableSmoothing)){for(h=0;h<p.length;++h)this.keypointFilterMap.has(p[h].id)||this.keypointFilterMap.set(p[h].id,new vB(uee)),p[h].keypoints=this.keypointFilterMap.get(p[h].id).apply(p[h].keypoints,n,1);f=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach(function(y,x){f.has(x)||m.keypointFilterMap.delete(x)})}return[2,p]}})})},r.prototype.filterCropRegion=function(e){if(e){var t=this.cropRegionFilterYMin.apply(e.yMin),n=this.cropRegionFilterXMin.apply(e.xMin),o=this.cropRegionFilterYMax.apply(e.yMax),s=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:t,xMin:n,yMax:o,xMax:s,height:o-t,width:s-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},r.prototype.dispose=function(){this.moveNetModel.dispose()},r.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},r.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},r}();function qBe(r){return r===void 0&&(r=Gee),yr(this,void 0,void 0,function(){var e,t,n,o;return xr(this,function(s){switch(s.label){case 0:return e=jBe(r),n=!0,e.modelUrl?(n=typeof e.modelUrl=="string"&&e.modelUrl.indexOf("https://tfhub.dev")>-1,[4,im(e.modelUrl,{fromTFHub:n})]):[3,2];case 1:return t=s.sent(),[3,4];case 2:return o=void 0,e.modelType==="SinglePose.Lightning"?o="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":e.modelType==="SinglePose.Thunder"?o="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":e.modelType==="MultiPose.Lightning"&&(o="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,im(o,{fromTFHub:n})];case 3:t=s.sent(),s.label=4;case 4:return pp()==="webgl"&&Z().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new HBe(t,e)]}})})}var hee={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},fee=["MobileNetV1","ResNet50"],mee={MobileNetV1:[8,16],ResNet50:[16]},KBe=[8,16,32],gee={MobileNetV1:[.5,.75,1],ResNet50:[1]},yee=[1,2,4],xee={maxPoses:1,flipHorizontal:!1},XBe={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},YBe=[-123.15,-115.9,-103.06];function fB(r){return Math.floor(r/2)}var ZBe=function(){function r(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return r.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},r.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},r.prototype.empty=function(){return this.numberOfElements===-1},r.prototype.size=function(){return this.numberOfElements+1},r.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},r.prototype.max=function(){return this.priorityQueue[0]},r.prototype.swim=function(e){for(;e>0&&this.less(fB(e),e);)this.exchange(e,fB(e)),e=fB(e)},r.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},r.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},r.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},r.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},r}();function QBe(r,e,t,n,o,s){for(var i=s.shape,a=i[0],c=i[1],l=!0,u=Math.max(t-o,0),p=Math.min(t+o+1,a),d=u;d<p;++d){for(var h=Math.max(n-o,0),f=Math.min(n+o+1,c),m=h;m<f;++m)if(s.get(d,m,r)>e){l=!1;break}if(!l)break}return l}function JBe(r){return yr(this,void 0,void 0,function(){return xr(this,function(e){return[2,Promise.all(r.map(function(t){return t.buffer()}))]})})}function Wee(r,e,t,n){return{y:n.get(r,e,t),x:n.get(r,e,t+17)}}function jee(r,e,t){var n=Wee(r.heatmapY,r.heatmapX,r.id,t),o=n.y,s=n.x;return{x:r.heatmapX*e+s,y:r.heatmapY*e+o}}function Hee(r,e,t,n){var o=t.x,s=t.y;return r.some(function(i){var a,c,l,u,p,d,h=i.keypoints;return a=s,c=o,l=h[n].y,u=h[n].x,(p=l-a)*p+(d=u-c)*d<=e})}var vee=Ip.reduce(function(r,e,t){return r[e]=t,r},{}),qee=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map(function(r){var e=r[0],t=r[1];return[vee[e],vee[t]]}),mB=qee.map(function(r){return r[1]}),bee=qee.map(function(r){return r[0]});function wee(r,e,t){return r<e?e:r>t?t:r}function gB(r,e,t,n){return{y:wee(Math.round(r.y/e),0,t-1),x:wee(Math.round(r.x/e),0,n-1)}}function Cee(r,e){return{x:r.x+e.x,y:r.y+e.y}}function _ee(r,e,t,n,o,s,i,a){a===void 0&&(a=2);for(var c=n.shape,l=c[0],u=c[1],p={y:e.y,x:e.x},d=Cee(p,function(x,b,w){var _=w.shape[2]/2;return{y:w.get(b.y,b.x,x),x:w.get(b.y,b.x,_+x)}}(r,gB(p,s,l,u),i)),h=0;h<a;h++){var f=gB(d,s,l,u),m=Wee(f.y,f.x,t,o);d=Cee({x:f.x*s,y:f.y*s},{x:m.x,y:m.y})}var g=gB(d,s,l,u),y=n.get(g.y,g.x,t);return{y:d.y,x:d.x,name:Ip[t],score:y}}function eze(r,e,t,n,o,s){var i=e.shape[2],a=mB.length,c=new Array(i),l=r.part,u=r.score,p=jee(l,n,t);c[l.id]={score:u,name:Ip[l.id],y:p.y,x:p.x};for(var d=a-1;d>=0;--d){var h=mB[d],f=bee[d];c[h]&&!c[f]&&(c[f]=_ee(d,c[h],f,e,t,n,s))}for(d=0;d<a;++d)h=bee[d],f=mB[d],c[h]&&!c[f]&&(c[f]=_ee(d,c[h],f,e,t,n,o));return c}function tze(r,e,t){return t.reduce(function(n,o,s){var i=o.y,a=o.x,c=o.score;return Hee(r,e,{y:i,x:a},s)||(n+=c),n},0)/t.length}function rze(r,e,t,n,o,s,i,a){return i===void 0&&(i=.5),a===void 0&&(a=20),yr(this,void 0,void 0,function(){var c,l,u,p,d,h,f,m,g,y,x,b;return xr(this,function(w){switch(w.label){case 0:return[4,JBe([r,e,t,n])];case 1:for(c=w.sent(),l=c[0],u=c[1],p=c[2],d=c[3],h=[],f=function(_,I,S){for(var k=S.shape,R=k[0],L=k[1],B=k[2],z=new ZBe(R*L*B,function(X){return X.score}),q=0;q<R;++q)for(var U=0;U<L;++U)for(var G=0;G<B;++G){var j=S.get(q,U,G);j<_||QBe(G,j,q,U,I,S)&&z.enqueue({score:j,part:{heatmapY:q,heatmapX:U,id:G}})}return z}(i,1,l),m=a*a;h.length<s&&!f.empty();)g=f.dequeue(),y=jee(g.part,o,u),Hee(h,m,y,g.part.id)||(x=eze(g,l,u,o,p,d),b=tze(h,m,x),h.push({keypoints:x,score:b}));return[2,h]}})})}function Kee(){for(var r,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];switch(e.length){case 0:r="fn main() ";break;case 1:r="fn main(".concat(e[0]," : i32)");break;default:throw Error("Unreachable")}return r}var nze=function(){function r(e){this.variableNames=["A","B"],this.size=!0,this.workgroupSize=[32,1,1],this.outputShape=[e[0],1],this.dispatchLayout=lm.flatDispatchLayout(this.outputShape),this.dispatch=lm.computeDispatch(this.dispatchLayout,this.outputShape,this.workgroupSize),this.shaderKey="getpointsConfidenceOp"}return r.prototype.getUserCode=function(){return`
        `.concat(Kee("index"),` {
          if (index < uniforms.size) {
            let y = B[index * 2];
            let x = B[index * 2 + 1];
            let outIndex = y * uniforms.aShape.x * uniforms.aShape.z + x * uniforms.aShape.z + index;
            result[index] = A[outIndex];
          }
        }
        `)},r}();function oze(r,e){if(dp()instanceof wb)return function(t,n){var o=dp(),s=new nze(n.shape),i=o.runWebGPUProgram(s,[t,n],"float32");return _o().makeTensorFromTensorInfo(i)}(r,e);throw new Error("getPointsConfidenceWebGPU is not supported in this backend!")}var sze=function(){function r(e){if(this.variableNames=["A","B"],this.size=!0,this.supportedLastDimension=2,e.length!==2||e[1]!==this.supportedLastDimension)throw new Error("GetOffsetVectorsProgram only supports shape of [x, ".concat(this.supportedLastDimension,"], but current shape is ").concat(e));this.workgroupSize=[32,1,1],this.outputShape=e;var t=[e[0],1];this.dispatchLayout=lm.flatDispatchLayout(t),this.dispatch=lm.computeDispatch(this.dispatchLayout,t,this.workgroupSize),this.shaderKey="GetOffsetVectors"}return r.prototype.getUserCode=function(){return`
    fn getOffsetPoint(y: i32, x: i32, index: i32) -> vec2<i32> {
      let outIndexY = y * uniforms.bShape.x * uniforms.bShape.y + x * uniforms.bShape.y + index;
      let outIndexX = outIndexY + uniforms.bShape.z;
      let outY = i32(B[outIndexY]);
      let outX = i32(B[outIndexX]);
      return vec2<i32>(outY, outX);
    }

    `.concat(Kee("index"),` {
      if (index < uniforms.size) {
        let indexY = index * `).concat(this.supportedLastDimension,`;
        let indexX = indexY + 1;
        let heatmapY = A[indexY];
        let heatmapX = A[indexX];
        let out = getOffsetPoint(i32(heatmapY), i32(heatmapX), index);
        result[indexY] = f32(out[0]);
        result[indexX] = f32(out[1]);
      }
    }
    `)},r}();function ize(r,e){if(dp()instanceof wb)return function(t,n){var o=dp(),s=new sze(t.shape),i=o.runWebGPUProgram(s,[t,n],"float32");return _o().makeTensorFromTensorInfo(i)}(r,e);throw new Error("getOffsetVectorsGPU is not supported in this backend!")}function Xee(r){var e=r.shape,t=e[0],n=e[1],o=e[2];return ee(function(){var s,i,a=H(r,[t*n,o]),c=$a(a,0),l=Hr(Ce(c,Oe(n,"int32")),1),u=Hr((s=c,i=n,ee(function(){var p=Ce(s,Oe(i,"int32"));return Te(s,W(p,Oe(i,"int32")))})),1);return Xt([l,u],1)})}function aze(r,e,t){return ee(function(){var n=function(o,s){for(var i=[],a=0;a<Ip.length;a++){var c=o.get(a,0).valueOf(),l=o.get(a,1).valueOf(),u=cze(c,l,a,s),p=u.x,d=u.y;i.push(d),i.push(p)}return us(i,[Ip.length,2])}(r,t);return ae(he(W(r.toTensor(),Oe(e,"int32")),"float32"),n)})}function cze(r,e,t,n){return{y:n.get(r,e,t),x:n.get(r,e,t+Ip.length)}}function lze(r,e,t){return yr(this,void 0,void 0,function(){var n,o,s,i,a,c,l,u,p,d;return xr(this,function(h){switch(h.label){case 0:return n=0,o=Xee(r),[4,Promise.all([r.buffer(),e.buffer(),o.buffer()])];case 1:return s=h.sent(),i=s[0],a=s[1],c=s[2],[4,(l=aze(c,t,a)).buffer()];case 2:return u=h.sent(),p=Array.from(function(f,m){for(var g=m.shape[0],y=new Float32Array(g),x=0;x<g;x++){var b=m.get(x,0),w=m.get(x,1);y[x]=f.get(b,w,x)}return y}(i,c)),d=p.map(function(f,m){return n+=f,{y:u.get(m,0),x:u.get(m,1),score:f,name:Ip[m]}}),o.dispose(),l.dispose(),[2,{keypoints:d,score:n/d.length}]}})})}function uze(r,e,t){return yr(this,void 0,void 0,function(){var n,o,s;return xr(this,function(i){return n=Xee(r),o=function(a,c,l){return ee(function(){var u=ize(a,l);return ae(he(W(a,Oe(c,"int32")),"float32"),u)})}(n,t,e),s=oze(r,n),[2,[o,s]]})})}function See(r,e){return(r-1)%e==0}var Iee="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",Tee="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function kee(r,e){return function(t,n){return(t-1)%n==0}(r,e)?r:Math.floor(r/e)*e+1}var Eee=function(){function r(e,t){this.posenetModel=e;var n=this.posenetModel.inputs[0].shape;C.assert(n[1]===-1&&n[2]===-1,function(){return"Input shape [".concat(n[1],", ").concat(n[2],"] ")+"must both be equal to or -1"});var o,s,i=(o=t.inputResolution,s=t.outputStride,{height:kee(o.height,s),width:kee(o.width,s)});(function(a){C.assert(KBe.indexOf(a)>=0,function(){return"outputStride of ".concat(a," is invalid. ")+"It must be either 8 or 16."})})(t.outputStride),function(a,c){C.assert(See(a.height,c),function(){return"height of ".concat(a.height," is invalid for output stride ")+"".concat(c,".")}),C.assert(See(a.width,c),function(){return"width of ".concat(a.width," is invalid for output stride ")+"".concat(c,".")})}(i,t.outputStride),this.inputResolution=i,this.outputStride=t.outputStride,this.architecture=t.architecture}return r.prototype.estimatePoses=function(e,t){return t===void 0&&(t=xee),yr(this,void 0,void 0,function(){return xr(this,function(n){return[2,this.estimatePosesGPU(e,t,!1)]})})},r.prototype.estimatePosesGPU=function(e,t,n){return t===void 0&&(t=xee),n===void 0&&(n=!1),yr(this,void 0,void 0,function(){var o,s,i,a,c,l,u,p,d,h,f,m,g,y,x,b,w,_;return xr(this,function(I){switch(I.label){case 0:return o=function(S){var k=S;if(k.maxPoses==null&&(k.maxPoses=1),k.maxPoses<=0)throw new Error("Invalid maxPoses ".concat(k.maxPoses,". Should be > 0."));if(k.maxPoses>1){if((k=on(on({},XBe),k)).scoreThreshold<0||k.scoreThreshold>1)throw new Error("Invalid scoreThreshold ".concat(k.scoreThreshold,". ")+"Should be in range [0.0, 1.0]");if(k.nmsRadius<=0)throw new Error("Invalid nmsRadius ".concat(k.nmsRadius,"."))}return k}(t),e==null?[2,n?[[],[]]:[]]:(this.maxPoses=o.maxPoses,s=xB(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),i=s.imageTensor,a=s.padding,c=this.architecture==="ResNet50"?ae(i,YBe):Lee(i,[-1,1]),l=this.posenetModel.predict(c),this.architecture==="ResNet50"?(u=Jt(l[2],[0]),p=Jt(l[3],[0]),d=Jt(l[0],[0]),h=Jt(l[1],[0])):(u=Jt(l[0],[0]),p=Jt(l[1],[0]),d=Jt(l[2],[0]),h=Jt(l[3],[0])),f=co(p),this.maxPoses!==1?[3,5]:n?[4,uze(f,u,this.outputStride)]:[3,2]);case 1:return g=I.sent(),x=g[0],y=g[1],m=[x,y],[3,4];case 2:return[4,lze(f,u,this.outputStride)];case 3:x=I.sent(),m=[x],I.label=4;case 4:return[3,7];case 5:if(n)throw new Error("GPU renderer only supports single pose!");return[4,rze(f,u,d,h,this.outputStride,this.maxPoses,o.scoreThreshold,o.nmsRadius)];case 6:m=I.sent(),I.label=7;case 7:if(n){if(o.flipHorizontal===!0)throw new Error("flipHorizontal is not supported!");b=this.getCanvasInfo($b(e),this.inputResolution,a)}else _=$b(e),w=function(S,k,R,L){var B=k.height,z=k.width,q=B/(R.height*(1-L.top-L.bottom)),U=z/(R.width*(1-L.left-L.right)),G=-L.top*R.height,j=-L.left*R.width;if(U===1&&q===1&&G===0&&j===0)return S;for(var X=0,te=S;X<te.length;X++)for(var ne=0,oe=te[X].keypoints;ne<oe.length;ne++){var le=oe[ne];le.x=(le.x+j)*U,le.y=(le.y+G)*q}return S}(m,_,this.inputResolution,a),o.flipHorizontal&&(w=function(S,k){for(var R=0,L=S;R<L.length;R++)for(var B=0,z=L[R].keypoints;B<z.length;B++){var q=z[B];q.x=k.width-1-q.x}return S}(w,_));return i.dispose(),c.dispose(),Xe(l),u.dispose(),p.dispose(),d.dispose(),h.dispose(),f.dispose(),[2,n?[m,b]:w]}})})},r.prototype.getCanvasInfo=function(e,t,n){var o=e.height,s=e.width,i=o/(t.height*(1-n.top-n.bottom)),a=s/(t.width*(1-n.left-n.right)),c=-n.top*t.height;return[-n.left*t.width,c,a,i,e.width,e.height]},r.prototype.dispose=function(){this.posenetModel.dispose()},r.prototype.reset=function(){},r}();function pze(r){return r===void 0&&(r=hee),yr(this,void 0,void 0,function(){var e,t,n,o,s;return xr(this,function(i){switch(i.label){case 0:return(e=function(u){var p=u||hee;if(p.architecture==null&&(p.architecture="MobileNetV1"),fee.indexOf(p.architecture)<0)throw new Error("Invalid architecture ".concat(p.architecture,". ")+"Should be one of ".concat(fee));if(p.inputResolution==null&&(p.inputResolution={height:257,width:257}),p.outputStride==null&&(p.outputStride=16),mee[p.architecture].indexOf(p.outputStride)<0)throw new Error("Invalid outputStride ".concat(p.outputStride,". ")+"Should be one of ".concat(mee[p.architecture]," ")+"for architecture ".concat(p.architecture,"."));if(p.multiplier==null&&(p.multiplier=1),gee[p.architecture].indexOf(p.multiplier)<0)throw new Error("Invalid multiplier ".concat(p.multiplier,". ")+"Should be one of ".concat(gee[p.architecture]," ")+"for architecture ".concat(p.architecture,"."));if(p.quantBytes==null&&(p.quantBytes=4),yee.indexOf(p.quantBytes)<0)throw new Error("Invalid quantBytes ".concat(p.quantBytes,". ")+"Should be one of ".concat(yee," ")+"for architecture ".concat(p.architecture,"."));if(p.architecture==="MobileNetV1"&&p.outputStride===32&&p.multiplier!==1)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return p}(r)).architecture!=="ResNet50"?[3,2]:(a=e.outputStride,c=e.quantBytes,l="model-stride".concat(a,".json"),t=c===4?Tee+"float/"+l:Tee+"quant".concat(c,"/")+l,[4,im(e.modelUrl||t)]);case 1:return n=i.sent(),[2,new Eee(n,e)];case 2:return o=function(u,p,d){var h={1:"100",.75:"075",.5:"050"},f="model-stride".concat(u,".json");return d===4?Iee+"float/".concat(h[p],"/")+f:Iee+"quant".concat(d,"/").concat(h[p],"/")+f}(e.outputStride,e.multiplier,e.quantBytes),[4,im(e.modelUrl||o)];case 3:return s=i.sent(),[2,new Eee(s,e)]}var a,c,l})})}function Yee(r,e){return yr(this,void 0,void 0,function(){var t,n;return xr(this,function(o){switch(r){case ds.PoseNet:return[2,pze(e)];case ds.BlazePose:if(n=void 0,(t=e)!=null){if(t.runtime==="tfjs")return[2,zBe(e)];if(t.runtime==="mediapipe")return[2,hBe(e)];n=t.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' "+"or 'mediapipe', but got ".concat(n));case ds.MoveNet:return[2,qBe(e)];default:throw new Error("".concat(r," is not a supported model name."))}})})}var XD={kernelName:yu,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,Ba(he(t,"float32"),-1))}}};var Zee={kernelName:Ic,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=vt(he(t,"float32")),o=Rr(Te(Oe(1),n));return Rt(Ce(r,o))}}}};var Qee={kernelName:Tc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Rr(Te(vt(he(t,"float32")),1));return Ce(r,n)}}}};var Jee={kernelName:ra,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=r,c=Lr(t.shape,o);return c.length>0&&(a=Pe(a,c)),H(a,t.shape)},b:()=>{let a=r,c=Lr(n.shape,o);return c.length>0&&(a=Pe(a,c)),H(a,n.shape)}}}};var ete={kernelName:xu,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,o)=>{t[o]=()=>r.clone()}),t}};var tte={kernelName:vu,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>nt(t)}}};var rte={kernelName:bu,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>nt(t)}}};var nte={kernelName:kc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,Rr(Te(Oe(1),vt(he(t,"float32")))))}}};var ote={kernelName:Ec,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Rr(ae(Oe(1),vt(he(t,"float32"))));return Ce(r,n)}}}};var ste={kernelName:Ac,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=ae(vt(t),vt(n)),c=W(r,Ce(n,a)),l=Lr(t.shape,o);return l.length>0&&(c=Pe(c,l)),H(c,t.shape)},b:()=>{let a=ae(vt(t),vt(n)),c=Rt(W(r,Ce(t,a))),l=Lr(n.shape,o);return l.length>0&&(c=Pe(c,l)),H(c,n.shape)}}}};var ite={kernelName:Nc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,ae(vt(he(t,"float32")),1))}}};var ate={kernelName:Dc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,Te(Oe(1),vt(he(t,"float32"))))}}};function hze(r,e,t,n,o,s){let i=D(r,"dy","avgPool3dGrad"),a=D(e,"input","avgPool3dGrad"),c=i,l=a,u=!1;a.rank===4&&(u=!0,c=H(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),l=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),$(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),$(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Wr("avgPool3dGrad",o,s);let p={dy:c,input:l},d={filterSize:t,strides:n,pad:o,dimRoundingMode:s},h=F.runKernel(Wh,p,d);return u?H(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var cte=O({avgPool3dGrad_:hze});var lte={kernelName:Cu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:o,strides:s,pad:i,dimRoundingMode:a}=t;return{x:()=>cte(r,n,o,s,i,a)}}};function fze(r,e,t,n,o){let s=D(r,"dy","avgPoolGrad"),i=D(e,"input","avgPoolGrad");$(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let a=i,c=s,l=!1;i.rank===3&&(l=!0,a=H(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=H(s,[1,s.shape[0],s.shape[1],s.shape[2]])),$(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),$(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:c,input:a},p={filterSize:t,strides:n,pad:o},d=F.runKernel(Gh,u,p);return l?H(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ute=O({avgPoolGrad_:fze});var pte={kernelName:wu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:o,strides:s,pad:i}=t;return{x:()=>ute(r,n,o,s,i)}}};var dte={kernelName:_u,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,o]=e,{transposeA:s,transposeB:i}=t;return!s&&!i?{a:()=>Tt(r,o,!1,!0),b:()=>Tt(n,r,!0,!1)}:!s&&i?{a:()=>Tt(r,o,!1,!1),b:()=>Tt(r,n,!0,!1)}:s&&!i?{a:()=>Tt(o,r,!1,!0),b:()=>Tt(n,r,!1,!1)}:{a:()=>Tt(o,r,!0,!0),b:()=>Tt(r,n,!0,!0)}}};var hte={kernelName:Su,gradFunc:(r,e,t)=>{let{blockShape:n,crops:o}=t;return{x:()=>Qf(r,n,o)}}};var fte={kernelName:fK,gradFunc:(r,e,t)=>{let n=t,o=n.inputShape,s=n.shape,i=Array.from(s);for(let c=o.length-1;c>=0;c--)if(o[c]===s[c])i[c]=1;else if(o[c]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${s}].`);let a=[];for(let c=0;c<i.length;c++)i[c]>1&&a.push(c);return{x:()=>Pe(r,a,!0)}}};var mte={kernelName:Da,gradFunc:r=>({x:()=>r.clone()})};var gte={kernelName:Rc,gradFunc:r=>({x:()=>nt(r)})};var yte={kernelName:Oc,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:o,clipValueMax:s}=t;return{x:()=>jr(Yo(Es(n,o),Di(n,s)),r,nt(r))}}};var xte={kernelName:Iu,inputsToSave:["x"],gradFunc:XD.gradFunc};var vte={kernelName:Tu,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(c=>c.shape),{axis:o}=t,s=Yn(o,e[0].shape)[0],i=n.map(c=>c[s]);return Jn(r,i,s).map(c=>()=>c)}};var bte={kernelName:ku,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,o]=e,{dilations:s,strides:i,pad:a,dataFormat:c}=t;return $(na(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>Wv(n.shape,r,o,i,a,c),filter:()=>pb(n,r,o.shape,i,a,c)}}};var wte={kernelName:Eu,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,o]=e,{strides:s,pad:i,dataFormat:a,dimRoundingMode:c}=t;return{dy:()=>Ys(r,o,s,i,a,1,c),filter:()=>pb(r,n,o.shape,s,i,a,c)}}};function mze(r,e,t,n,o){let s=r;r.rank===4&&(s=H(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let i=e;i.rank===4&&(i=H(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),$(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),$(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),$(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),$(s.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${t[3]}.`),$(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);let a={x:s,dy:i},c={strides:n,pad:o,filterShape:t};return F.runKernel(Xh,a,c)}var Cte=O({conv3DBackpropFilter_:mze});var _te={kernelName:Nu,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:o,pad:s}=t;$(na(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[i,a]=e;return{x:()=>Uk(i.shape,r,a,o,s),filter:()=>Cte(i,r,a.shape,o,s)}}};var Ste={kernelName:Mc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(Rt(nb(he(t,"float32"))),r)}}};var Ite={kernelName:Fc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(ob(he(t,"float32")),r)}}};var Tte={kernelName:Du,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:o,exclusive:s,reverse:i}=t;return{x:()=>{let a=v3([o],n.rank),c=qv(r,o,s,!i);return a!=null&&(c=kt(c,a)),c}}}};var kte={kernelName:Au,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:o,pad:s,dimRoundingMode:i}=t,a=n??[1,1];$(na(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[c,l]=e;return $(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),$(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),$(c.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),$(zo(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),Wr("depthwiseConv2d",s,i),{x:()=>CE(c.shape,r,l,o,s,a,i),filter:()=>wE(c,r,l.shape,o,s,a,i)}}};var Ete={kernelName:Ru,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,o]=e,s={x:n,filter:o,dy:r},i={x:n,filter:o,dy:r};return{x:()=>F.runKernel(Og,s,t),filter:()=>F.runKernel(Mg,i,t)}}};var Nte={kernelName:$c,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>F.runKernel(sf,n)}}};var Dte={kernelName:Lc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=W(nn(Rt(vt(t))),2/Math.sqrt(Math.PI));return{x:()=>W(r,n)}}};var Ate={kernelName:Vc,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,t)}}};var Rte={kernelName:Ou,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>H(r,t.shape)}}};var Ote={kernelName:Bc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,nn(t))}}};var Mte={kernelName:zc,gradFunc:r=>({x:()=>nt(r)})};var Fte={kernelName:Uc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=Ce(r,he(n,"float32")),c=Lr(t.shape,o);return c.length>0?H(Pe(a,c),t.shape):a},b:()=>{let a=W(r,he(t,"float32")),c=Lr(n.shape,o);c.length>0&&(a=H(Pe(a,c),n.shape));let l=vt(n);return Rt(Ce(a,he(l,"float32")))}}}};var Pte={kernelName:Mu,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[o,s,i,a]=e,c=a??Oe(1),l=Lr(s.shape,o.shape),u=[];if(s.rank===1){for(let w=0;w<o.shape.length-1;++w)u.push(o.shape[w]);u.push(1)}let p=Te(o,s),d=W(r,c),h=eb(ae(i,Oe(n))),f=W(W(W(h,h),h),Oe(-.5));return{x:()=>s.rank===1?H(W(W(r,Uo(H(h,[1,1,1,s.shape[0]]),u)),c),o.shape):H(W(W(r,h),c),o.shape),mean:()=>{let w=W(W(h,Oe(-1)),d);return s.rank===1&&(w=Pe(w,l)),H(w,s.shape)},variance:()=>{let w=W(W(f,p),d);return s.rank===1&&(w=Pe(w,l)),H(w,s.shape)},scale:()=>{let w=W(p,h),_=W(r,w);return s.rank===1&&(_=Pe(_,l)),H(_,s.shape)},offset:()=>{let w=r;return s.rank===1&&(w=Pe(w,l)),H(w,s.shape)}}}};var Vte={kernelName:Fu,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,o]=e,{axis:s,batchDims:i}=t,a=Yn(s,n.shape)[0],c=(l,u,p)=>()=>{let d=l.shape,h=u.size,f=d.slice(0,a),m=f.length,g=d.slice(s,d.length).slice(1),y=g.length,x=$te(0,m),b=$te(m+1,m+1+y),w=Lte([f,[h],g]),_=H(p,w),I=H(u,[h]),S=Lte([[m],x,b]),k=kt(_,S),R=ub(k,I,l.shape[a]),L=i_(S);return R=kt(R,L),R};if(i===1){let l=n.shape[0],u=n.split(l,0);return{x:()=>mn(u.map((h,f)=>c(h,o.slice(f,1),r.slice(f,1))())).reshape(n.shape),indices:()=>o}}else return{x:c(n,o,r),indices:()=>o}}};function $te(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function Lte(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Bte={kernelName:Gc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>nt(t),b:()=>nt(n)}}};var zte={kernelName:Aa,gradFunc:r=>({x:()=>he(r,"float32")})};var Ute={kernelName:Wc,gradFunc:r=>({x:()=>nt(r)})};var Gte={kernelName:jc,gradFunc:r=>({x:()=>nt(r)})};var Wte={kernelName:Hc,gradFunc:r=>({x:()=>nt(r)})};var jte={kernelName:Pu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:o}=t,s=fn(n,0);return{x:()=>jr(s,r,W(r,o))}}};var Hte={kernelName:Kc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,ae(t,1))}}};var qte={kernelName:qc,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,he(t,"float32"))}}};var Kte={kernelName:mK,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:o}=t;return{logits:()=>{let i=nn(n);return Te(r,W(Pe(r,o,!0),i))}}}};function gze(r,e,t,n=5,o=1,s=1,i=.5){let a={x:r,y:e,dy:t},c={depthRadius:n,bias:o,alpha:s,beta:i};return F.runKernel(ff,a,c)}var Xte=O({localResponseNormalizationBackprop_:gze});var Yte={kernelName:$u,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,o]=e,{depthRadius:s,bias:i,alpha:a,beta:c}=t;return{x:()=>Xte(n,o,r,s,i,a,c)}}};function YD(r,e,t,n){return e.rank<t.rank&&(e=H(e,Va(e.shape,n))),r.rank<t.rank&&(r=H(r,Va(r.shape,n))),{x:()=>W(r,he(ls(t,e),r.dtype))}}var CB={kernelName:Lu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:o}=n,s=e[0],i=e[1],a=Yn(o,s.shape),c=YD(r,i,s,a);return{x:()=>c.x()}}};var Zte={kernelName:Xc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>W(r,he(Es(t,n),"float32")),b:()=>W(r,he(Ad(t,n),"float32"))}}};function yze(r,e,t,n,o,s,i){let a=D(r,"dy","maxPool3dGrad"),c=D(e,"input","maxPool3dGrad"),l=D(t,"output","maxPool3dGrad"),u=a,p=c,d=l,h=!1;c.rank===4&&(h=!0,u=H(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),p=H(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=H(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),$(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),$(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),$(d.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`),Wr("maxPool3dGrad",s,i);let f={dy:u,input:p,output:d},m={filterSize:n,strides:o,pad:s,dimRoundingMode:i},g=F.runKernel(gf,f,m);return h?H(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var Qte=O({maxPool3dGrad_:yze});var Jte={kernelName:Bu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=t;return{x:()=>Qte(r,n,o,s,i,a,c)}}};function xze(r,e,t,n,o,s,i){let a=D(r,"dy","maxPoolGrad"),c=D(e,"input","maxPoolGrad"),l=D(t,"output","maxPoolGrad");$(c.rank===a.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${a.rank})`),$(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),$(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),Wr("maxPoolGrad",s,i);let u={dy:a,input:c,output:l},p={filterSize:n,strides:o,pad:s,dimRoundingMode:i};return F.runKernel(mf,u,p)}var ere=O({maxPoolGrad_:xze});var tre={kernelName:Vu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a}=t;return{x:()=>ere(r,n,o,s,i,a)}}};var rre={kernelName:zu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:o}=t,s=Yn(o,n.shape),a=x3(n.shape,s)[1],c=Vt(a);return{x:()=>{let u=n.shape.slice();s.forEach(h=>{u[h]=1});let p=H(r,u);return Ce(W(p,Vn(n.shape,"float32")),c)}}}};var nre={kernelName:Uu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:o}=n,[s,i]=e,a=Yn(o,s.shape),c=YD(r,i,s,a);return{x:()=>c.x()}}};var ore={kernelName:Yc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>W(r,he(Di(t,n),"float32")),b:()=>W(r,he(fn(t,n),"float32"))}}};var sre={kernelName:Gu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:o}=t,s=o.map(i=>i[0]);return{x:()=>tt(r,s,n.shape)}}};var ire={kernelName:Zc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=Lr(t.shape,o);return a.length>0?H(Pe(r,a),t.shape):r},b:()=>{let a=W(r,Rt(vp(Ce(t,n)))),c=Lr(n.shape,o);return c.length>0?H(Pe(a,c),n.shape):a}}}};var are={kernelName:Qc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=W(r,he(n,"float32")),c=Lr(t.shape,o);return c.length>0?H(Pe(a,c),t.shape):a},b:()=>{let a=W(r,he(t,"float32")),c=Lr(n.shape,o);return c.length>0?H(Pe(a,c),n.shape):a}}}};var cre={kernelName:Wu,gradFunc:r=>({x:()=>Rt(r)})};var lre={kernelName:Hu,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>Cr(t.shape,"float32")}}};var ure={kernelName:ju,gradFunc:r=>({x:()=>nt(r)})};var pre={kernelName:qu,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return eo(r,n).map(s=>()=>s)}};var _B={kernelName:Ku,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:o}=t,s=o.map(i=>i[0]);return{x:()=>tt(r,s,n.shape)}}};var dre={kernelName:Jc,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,o]=e,s=t,i=n,a=yt(s.shape,i.shape);return{a:()=>{let u=he(i,"float32"),p=W(r,W(u,Xo(s,Te(u,Oe(1))))),d=Lr(s.shape,a);return d.length>0&&(p=Pe(p,d)),H(p,s.shape)},b:()=>{let u=fn(s,0),p=jr(u,To(s),nt(s)),d=W(r,W(o,p)),h=Lr(i.shape,a);return h.length>0&&(d=Pe(d,h)),H(d,i.shape)}}}};var hre={kernelName:Xu,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,o=fn(t,0);return{x:()=>jr(o,r,W(r,n)),alpha:()=>{let s=jr(o,nt(r),W(r,t)),i=Lr(n.shape,r.shape);return i.length>0&&(s=Pe(s,i)),H(s,n.shape)}}}};function vze(r,e,t){let n=r.shape.slice();n[t]=1;let o=H(e,n),s=Yg(r,t,!0,!1),i=Yg(r,t,!0,!0),a=W(s,i);return W(o,a)}function bze(r,e,t){let n=r.shape.length,o=n-t.length,s=E.getAxesPermutation(t,n),i=r;s!=null&&(i=kt(r,s));let a=i.shape.slice(),l=a.splice(n-t.length,t.length).reduce((d,h)=>d*h,1);a.push(l);let u=i.reshape(a),p=vze(u,e,o);if(p=p.reshape(i.shape),s!=null){let d=E.getUndoAxesPermutation(s);p=kt(p,d)}return p}var fre={kernelName:Yu,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:o}=t,s=[];return o==null?s=n.shape.map((i,a)=>a):typeof o=="number"?s=[o]:s=o,{x:()=>bze(n,r,s)}}};var mre={kernelName:Pc,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=Ce(r,he(n,"float32")),c=Lr(t.shape,o);return c.length>0?H(Pe(a,c),t.shape):a},b:()=>{let a=W(r,he(t,"float32")),c=Lr(n.shape,o);c.length>0&&(a=H(Pe(a,c),n.shape));let l=vt(n);return Rt(Ce(a,he(l,"float32")))}}}};var gre={kernelName:el,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,Rt(vt(t)))}}};var yre={kernelName:rl,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=W(Di(t,6),Ba(t));return{x:()=>W(r,he(n,"float32"))}}};var xre={kernelName:tl,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,he(Ba(t),"float32"))}}};var vre={kernelName:Zu,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>H(r,t.shape)}}};var bre={kernelName:Ju,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,o={dy:r,images:n};return{images:()=>F.runKernel(Sf,o,t)}}};var wre={kernelName:Qu,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,o={dy:r,images:n};return{images:()=>F.runKernel(_f,o,t)}}};var Cre={kernelName:ep,gradFunc:(r,e,t)=>{let{dims:n}=t,o=Yn(n,r.shape);return{x:()=>Qn(r,o)}}};var _re={kernelName:nl,gradFunc:r=>({x:()=>nt(r)})};var Sre={kernelName:ol,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rt(Ce(r,W(Xo(t,1.5),2)))}}};var Ire={kernelName:tp,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>he(nt(t),"float32"),t:()=>W(r,he(t,r.dtype)),e:()=>W(r,he(Yf(t),r.dtype))}}};var Tre={kernelName:sl,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=fn(t,Oe(0)),o=Oe(G3),s=Oe(W3),i=W(r,s),a=W(W(r,o),nn(he(t,"float32")));return jr(n,i,a)}}}};var kre={kernelName:ll,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,W(t,Te(Oe(1),t)))}}};var Ere={kernelName:cl,gradFunc:r=>({x:()=>nt(r)})};var Nre={kernelName:il,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(Wf(he(t,"float32")),r)}}};var Dre={kernelName:al,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(Hv(he(t,"float32")),r)}}};var Are={kernelName:rp,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:o,size:s}=t,i=n.shape,[a,c]=U3(n,o,s),l=[];for(let u=0;u<r.rank;u++)l.push([a[u],i[u]-a[u]-c[u]]);return{x:()=>ko(r,l)}}};var Rre={kernelName:ip,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:o}=t,s=!0,i=W(r,n);return{logits:()=>Te(i,W(Pe(i,[o],s),n))}}};var Ore={kernelName:ul,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,co(t))}}};var SB={kernelName:op,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:o}=t;return{x:()=>Gf(r,n,o)}}};var IB={kernelName:sp,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Xt(r,n)}}};var Mre={kernelName:pl,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,W(Rr(he(t,"float32")),2))}}};var Fre={kernelName:Af,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(r,W(he(t,"float32"),2))}}};var Pre={kernelName:dl,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=Oe(2);return{a:()=>W(r,W(o,Te(t,n))),b:()=>W(r,W(o,Te(n,t)))}}};var $re={kernelName:gl,gradFunc:r=>({x:()=>nt(r)})};var Lre={kernelName:hl,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,o=yt(t.shape,n.shape);return{a:()=>{let a=r,c=Lr(t.shape,o);return c.length>0&&(a=Pe(a,c)),H(a,t.shape)},b:()=>{let a=r,c=Lr(n.shape,o);return c.length>0&&(a=Pe(a,c)),H(Rt(a),n.shape)}}}};var Vre={kernelName:np,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,o=n.shape.slice(),{axis:s}=t;Yn(s,n.shape).forEach(l=>{o[l]=1});let a=H(r,o),c=W(a,Vn(n.shape,"float32"));return{x:()=>c}}};var Bre={kernelName:fl,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ce(r,vt(Wf(t)))}}};var zre={kernelName:ml,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>W(Te(Oe(1),vt(t)),r)}}};var Ure={kernelName:Ra,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:o}=t;return{x:()=>{let i=nt(n);if(n.rank===1)for(let a=0;a<o[0];++a)i=ae(i,tt(r,[a*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let a=0;a<o[0];++a)for(let c=0;c<o[1];++c)i=ae(i,tt(r,[a*n.shape[0],c*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let a=0;a<o[0];++a)for(let c=0;c<o[1];++c)for(let l=0;l<o[2];++l)i=ae(i,tt(r,[a*n.shape[0],c*n.shape[1],l*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let a=0;a<o[0];++a)for(let c=0;c<o[1];++c)for(let l=0;l<o[2];++l)for(let u=0;u<o[3];++u)i=ae(i,tt(r,[a*n.shape[0],c*n.shape[1],l*n.shape[2],u*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return i}}}};var Gre={kernelName:Oa,gradFunc:(r,e,t)=>{let n=t,{perm:o}=n,s=i_(o);return{x:()=>kt(r,s)}}};var Wre={kernelName:ap,gradFunc:(r,e,t)=>{let n=t,{axis:o}=n;return{value:()=>mn(r,o)}}};var jre={kernelName:cp,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>wze(r,t)}}};function wze(r,e){let t=Qs(e,nt(e)),n=bp(r,t),o=Es(e,Oe(0,"int32")),s=n.rank-o.rank;for(let a=0;a<s;++a)o=Hr(o,a+1);o=Yo(o,Vn(n.shape,"bool"));let i=nt(n);return jr(o,n,i)}var Hre={kernelName:lp,gradFunc:r=>({x:()=>nt(r)})};var Cze=[XD,Zee,Qee,Jee,ete,tte,rte,nte,ote,ste,ite,ate,lte,pte,dte,hte,fte,mte,gte,yte,xte,vte,wte,bte,_te,Ste,Ite,Tte,kte,Ete,mre,Nte,Dte,Ate,Rte,Ote,Fte,Mte,Pte,Vte,Bte,zte,Ute,Gte,Wte,jte,Hte,qte,Kte,Yte,CB,CB,Zte,Jte,tre,rre,nre,ore,sre,ire,are,cre,lre,ure,pre,_B,_B,dre,hre,fre,gre,yre,xre,vre,bre,wre,Cre,_re,Sre,Ire,Tre,kre,Ere,Nre,Dre,Are,Rre,Ore,SB,SB,IB,IB,Mre,Pre,Fre,$re,Lre,Vre,Bre,zre,Ure,Gre,Wre,jre,Hre];for(let r of Cze)yK(r);K().prototype.abs=function(){return this.throwIfDisposed(),Qr(this)};K().prototype.acos=function(){return this.throwIfDisposed(),_k(this)};K().prototype.acosh=function(){return this.throwIfDisposed(),Sk(this)};K().prototype.add=function(r){return this.throwIfDisposed(),ae(this,r)};K().prototype.all=function(r,e){return this.throwIfDisposed(),zv(this,r,e)};K().prototype.any=function(r,e){return this.throwIfDisposed(),Kg(this,r,e)};K().prototype.argMax=function(r){return this.throwIfDisposed(),$a(this,r)};K().prototype.argMin=function(r){return this.throwIfDisposed(),Ik(this,r)};K().prototype.asScalar=function(){return this.throwIfDisposed(),$(this.size===1,()=>"The array must have only 1 element."),H(this,[])};K().prototype.asType=function(r){return this.throwIfDisposed(),he(this,r)};K().prototype.as1D=function(){return this.throwIfDisposed(),H(this,[this.size])};K().prototype.as2D=function(r,e){return this.throwIfDisposed(),H(this,[r,e])};K().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),H(this,[r,e,t])};K().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),H(this,[r,e,t,n])};K().prototype.as5D=function(r,e,t,n,o){return this.throwIfDisposed(),H(this,[r,e,t,n,o])};K().prototype.asin=function(){return this.throwIfDisposed(),Tk(this)};K().prototype.asinh=function(){return this.throwIfDisposed(),kk(this)};K().prototype.atan=function(){return this.throwIfDisposed(),Ek(this)};K().prototype.atan2=function(r){return this.throwIfDisposed(),Nk(this,r)};K().prototype.atanh=function(){return this.throwIfDisposed(),Dk(this)};K().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),Uf(this,r,e,t,n)};K().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),Gf(this,r,e)};K().prototype.batchNorm=function(r,e,t,n,o){return this.throwIfDisposed(),mp(this,r,e,t,n,o)};K().prototype.broadcastTo=function(r){return this.throwIfDisposed(),gp(this,r)};K().prototype.cast=function(r){return this.throwIfDisposed(),he(this,r)};K().prototype.ceil=function(){return this.throwIfDisposed(),Pk(this)};K().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),Zn(this,r,e)};K().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof Ct&&(r=[r]),Xt([this,...r],e)};K().prototype.conv1d=function(r,e,t,n,o,s){return this.throwIfDisposed(),Gv(this,r,e,t,n,o,s)};K().prototype.conv2dTranspose=function(r,e,t,n,o){return this.throwIfDisposed(),jv(this,r,e,t,n,o)};K().prototype.conv2d=function(r,e,t,n,o,s){return this.throwIfDisposed(),Ys(this,r,e,t,n,o,s)};K().prototype.cos=function(){return this.throwIfDisposed(),Wf(this)};K().prototype.cosh=function(){return this.throwIfDisposed(),Hv(this)};K().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),Yg(this,r,e,t)};K().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),qv(this,r,e,t)};K().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),Wk(this,r,e)};K().prototype.depthwiseConv2d=function(r,e,t,n,o,s){return this.throwIfDisposed(),yp(this,r,e,t,n,o,s)};K().prototype.dilation2d=function(r,e,t,n,o){return this.throwIfDisposed(),jk(this,r,e,t,n,o)};K().prototype.divNoNan=function(r){return this.throwIfDisposed(),Hk(this,r)};K().prototype.div=function(r){return this.throwIfDisposed(),Ce(this,r)};K().prototype.dot=function(r){return this.throwIfDisposed(),qk(this,r)};K().prototype.elu=function(){return this.throwIfDisposed(),xp(this)};K().prototype.equal=function(r){return this.throwIfDisposed(),ls(this,r)};K().prototype.erf=function(){return this.throwIfDisposed(),Kv(this)};K().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),Kk(this,r,e)};K().prototype.exp=function(){return this.throwIfDisposed(),nn(this)};K().prototype.expandDims=function(r){return this.throwIfDisposed(),Hr(this,r)};K().prototype.expm1=function(){return this.throwIfDisposed(),Xk(this)};K().prototype.fft=function(){return this.throwIfDisposed(),tm(this)};K().prototype.flatten=function(){return this.throwIfDisposed(),H(this,[this.size])};K().prototype.floor=function(){return this.throwIfDisposed(),vp(this)};K().prototype.floorDiv=function(r){return this.throwIfDisposed(),Bv(this,r)};K().prototype.gather=function(r,e,t){return this.throwIfDisposed(),bp(this,r,e,t)};K().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Es(this,r)};K().prototype.greater=function(r){return this.throwIfDisposed(),fn(this,r)};K().prototype.ifft=function(){return this.throwIfDisposed(),Od(this)};K().prototype.irfft=function(){return this.throwIfDisposed(),ab(this)};K().prototype.isFinite=function(){return this.throwIfDisposed(),Yk(this)};K().prototype.isInf=function(){return this.throwIfDisposed(),Zk(this)};K().prototype.isNaN=function(){return this.throwIfDisposed(),Qk(this)};K().prototype.leakyRelu=function(r){return this.throwIfDisposed(),qf(this,r)};K().prototype.lessEqual=function(r){return this.throwIfDisposed(),Di(this,r)};K().prototype.less=function(r){return this.throwIfDisposed(),Ad(this,r)};K().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),Jk(this,r,e,t,n)};K().prototype.logSigmoid=function(){return this.throwIfDisposed(),eE(this)};K().prototype.logSoftmax=function(r){return this.throwIfDisposed(),Xv(this,r)};K().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),Xf(this,r,e)};K().prototype.log=function(){return this.throwIfDisposed(),To(this)};K().prototype.log1p=function(){return this.throwIfDisposed(),Kf(this)};K().prototype.logicalAnd=function(r){return this.throwIfDisposed(),Yo(this,r)};K().prototype.logicalNot=function(){return this.throwIfDisposed(),Yf(this)};K().prototype.logicalOr=function(r){return this.throwIfDisposed(),Yv(this,r)};K().prototype.logicalXor=function(r){return this.throwIfDisposed(),tE(this,r)};K().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),Tt(this,r,e,t)};K().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),Zf(this,r,e,t,n)};K().prototype.max=function(r,e){return this.throwIfDisposed(),Io(this,r,e)};K().prototype.maximum=function(r){return this.throwIfDisposed(),Qs(this,r)};K().prototype.mean=function(r,e){return this.throwIfDisposed(),qr(this,r,e)};K().prototype.min=function(r,e){return this.throwIfDisposed(),Nd(this,r,e)};K().prototype.minimum=function(r){return this.throwIfDisposed(),Js(this,r)};K().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),Zv(this,r,e)};K().prototype.mod=function(r){return this.throwIfDisposed(),oE(this,r)};K().prototype.mul=function(r){return this.throwIfDisposed(),W(this,r)};K().prototype.neg=function(){return this.throwIfDisposed(),Rt(this)};K().prototype.norm=function(r,e,t){return this.throwIfDisposed(),Dd(this,r,e,t)};K().prototype.notEqual=function(r){return this.throwIfDisposed(),Cl(this,r)};K().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),Jg(this,r,e,t)};K().prototype.onesLike=function(){return this.throwIfDisposed(),lo(this)};K().prototype.pad=function(r,e){return this.throwIfDisposed(),ko(this,r,e)};K().prototype.pool=function(r,e,t,n,o,s){return this.throwIfDisposed(),sE(this,r,e,t,n,o,s)};K().prototype.pow=function(r){return this.throwIfDisposed(),Xo(this,r)};K().prototype.prelu=function(r){return this.throwIfDisposed(),Jf(this,r)};K().prototype.prod=function(r,e){return this.throwIfDisposed(),iE(this,r,e)};K().prototype.reciprocal=function(){return this.throwIfDisposed(),pE(this)};K().prototype.relu=function(){return this.throwIfDisposed(),Go(this)};K().prototype.relu6=function(){return this.throwIfDisposed(),Qv(this)};K().prototype.reshapeAs=function(r){return this.throwIfDisposed(),H(this,r.shape)};K().prototype.reshape=function(r){return this.throwIfDisposed(),H(this,r)};K().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),EE(this,r,e,t)};K().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),NE(this,r,e,t)};K().prototype.reverse=function(r){return this.throwIfDisposed(),Qn(this,r)};K().prototype.rfft=function(){return this.throwIfDisposed(),rm(this)};K().prototype.round=function(){return this.throwIfDisposed(),Jv(this)};K().prototype.rsqrt=function(){return this.throwIfDisposed(),eb(this)};K().prototype.selu=function(){return this.throwIfDisposed(),tb(this)};K().prototype.separableConv2d=function(r,e,t,n,o,s){return this.throwIfDisposed(),rb(this,r,e,t,n,o,s)};K().prototype.sigmoid=function(){return this.throwIfDisposed(),co(this)};K().prototype.sign=function(){return this.throwIfDisposed(),dE(this)};K().prototype.sin=function(){return this.throwIfDisposed(),nb(this)};K().prototype.sinh=function(){return this.throwIfDisposed(),ob(this)};K().prototype.slice=function(r,e){return this.throwIfDisposed(),tt(this,r,e)};K().prototype.softmax=function(r){return this.throwIfDisposed(),em(this,r)};K().prototype.softplus=function(){return this.throwIfDisposed(),wl(this)};K().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),Qf(this,r,e)};K().prototype.split=function(r,e){return this.throwIfDisposed(),Jn(this,r,e)};K().prototype.sqrt=function(){return this.throwIfDisposed(),Rr(this)};K().prototype.square=function(){return this.throwIfDisposed(),vt(this)};K().prototype.squaredDifference=function(r){return this.throwIfDisposed(),cb(this,r)};K().prototype.squeeze=function(r){return this.throwIfDisposed(),Jt(this,r)};K().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof Ct?[this,r]:[this,...r];return mn(t,e)};K().prototype.step=function(r){return this.throwIfDisposed(),Ba(this,r)};K().prototype.stridedSlice=function(r,e,t,n,o,s,i,a){return this.throwIfDisposed(),hE(this,r,e,t,n,o,s,i,a)};K().prototype.sub=function(r){return this.throwIfDisposed(),Te(this,r)};K().prototype.sum=function(r,e){return this.throwIfDisposed(),Pe(this,r,e)};K().prototype.tan=function(){return this.throwIfDisposed(),fE(this)};K().prototype.tanh=function(){return this.throwIfDisposed(),bl(this)};K().prototype.tile=function(r){return this.throwIfDisposed(),Uo(this,r)};K().prototype.toBool=function(){return this.throwIfDisposed(),he(this,"bool")};K().prototype.toFloat=function(){return this.throwIfDisposed(),he(this,"float32")};K().prototype.toInt=function(){return this.throwIfDisposed(),he(this,"int32")};K().prototype.topk=function(r,e){return this.throwIfDisposed(),gE(this,r,e)};K().prototype.transpose=function(r){return this.throwIfDisposed(),kt(this,r)};K().prototype.unique=function(r){return this.throwIfDisposed(),yE(this,r)};K().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),ub(this,r,e)};K().prototype.unstack=function(r){return this.throwIfDisposed(),eo(this,r)};K().prototype.where=function(r,e){return this.throwIfDisposed(),jr(r,this,e)};K().prototype.zerosLike=function(){return this.throwIfDisposed(),nt(this)};var aa=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}},As=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}},re=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}},lt=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}},ZD=class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}};var P_=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function Ka(r,e){if(Array.isArray(r)){let t=[];for(let n=0;n<e;n++)t=t.concat(r);return t}else{let t=new Array(e);return t.fill(r),t}}function ca(r,e){if(!r)throw new ZD(e)}function kB(r,e){let t=0;for(let n of r)n===e&&t++;return t}function No(r){return r.length===1?r[0]:r}function vr(r){return Array.isArray(r)?r:[r]}function Xa(r){let t=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Vd(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}var qa={};function Lb(r){if(r==null)return null;let e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function TB(r){if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(e=>TB(e));else{let e=Object.keys(r);for(let t of e){let n=r[t];n!=null&&typeof n=="object"&&(!Array.isArray(n)&&n.type==="ndarray"&&typeof n.value=="number"?r[t]=n.value:TB(n))}}}function Tp(r,e={},t={},n="object",o=!1){if(typeof r=="string"){let s=r,i;if(s in t)i=t[s];else if(s in qa)i=qa[s];else if(i=e[s],i==null)throw new re(`Unknown ${n}: ${r}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=r;if(s.className==null||s.config==null)throw new re(`${n}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,a,c;if(i in t?[a,c]=t[i]:i in qa?[a,c]=qa.className:i in e&&([a,c]=e[i]),a==null)throw new re(`Unknown ${n}: ${i}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){let l={};for(let h of Object.keys(qa))l[h]=qa[h];for(let h of Object.keys(t))l[h]=t[h];let u=s.config;u.customObjects=l;let p=Object.assign({},qa);for(let h of Object.keys(t))qa[h]=t[h];TB(s.config);let d=c(a,s.config,t,o);return qa=Object.assign({},p),d}else{let l=Object.assign({},qa);for(let p of Object.keys(t))qa[p]=t[p];let u=new a(s.config);return qa=Object.assign({},l),u}}}function _ze(r,e){return r<e?-1:r>e?1:0}function $_(r,e){return-1*_ze(r,e)}function Ya(r){if(r==null)return r;let e=[];for(let t of r)e.indexOf(t)===-1&&e.push(t);return e}function qre(r){if(r==null)throw new re(`Invalid value in obj: ${JSON.stringify(r)}`);for(let e in r)if(r.hasOwnProperty(e))return!1;return!0}function kp(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new re(`${t} is not a valid ${e}.  Valid values are ${r} or null/undefined.`)}function QD(r,e,t=0,n=1/0){return ca(t>=0),ca(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(o=>typeof o===e)}function Fn(r,e){Array.isArray(r)?(C.assert(r.length>0,()=>`${e} is unexpectedly an empty array.`),r.forEach((t,n)=>Fn(t,`element ${n+1} of ${e}`))):C.assert(Number.isInteger(r)&&r>0,()=>`Expected ${e} to be a positive integer, but got ${Kre(r)}.`)}function Kre(r){return r===null?"null":Array.isArray(r)?"["+r.map(e=>Kre(e)).join(",")+"]":typeof r=="string"?`"${r}"`:`${r}`}function Xre(r,e,t){let n=t!=null?t():C.now(),o;return(...i)=>{let a=t!=null?t():C.now();return a-n<e||(n=a,o=r(...i)),o}}function JD(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var Sze=0;function tA(){return Sze++}var eA={};function dm(r=""){return r in eA||(eA[r]=0),eA[r]+=1,r+eA[r].toString()}var Yre=["channelsFirst","channelsLast"],Zre=["nearest","bilinear"],Qre=["valid","same","causal"],Jre=["max","avg"],ene=["sum","mul","concat","ave"];var Vb=new Map;function sn(r){kp(Yre,"DataFormat",r)}function rne(r){kp(Zre,"InterpolationFormat",r)}function Rs(r){kp(Qre,"PaddingMode",r)}function EB(r){kp(Jre,"PoolMode",r)}var L_=[],tne="/";function Dl(r,e){L_.push(r);try{let t=e();return L_.pop(),t}catch(t){throw L_.pop(),t}}function Ize(){return L_.length===0?"":L_.join(tne)+tne}function rA(r){if(!nne(r))throw new Error("Not a valid tensor name: '"+r+"'");return Ize()+r}function nA(r){if(!nne(r))throw new Error("Not a valid tensor name: '"+r+"'");Vb.has(r)||Vb.set(r,0);let e=Vb.get(r);if(Vb.set(r,Vb.get(r)+1),e>0){let t=`${r}_${e}`;return Vb.set(t,1),t}else return r}var Tze=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function nne(r){return!!r.match(Tze)}function one(r){return r===parseInt(r.toString(),10)}function Za(r,e,t){e==null&&(e=0),t==null&&(t=r.length);let n=1;for(let o=e;o<t;++o)n*=r[o];return n}function xy(r){if(r.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<r.length;t++){let n=r[t];n<e&&(e=n)}return e}function Al(r){if(r.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<r.length;t++){let n=r[t];n>e&&(e=n)}return e}function Os(r,e){if(e<r)throw new re(`end (${e}) < begin (${r}) is forbidden.`);let t=[];for(let n=r;n<e;++n)t.push(n);return t}var NB;function jn(){return NB==null&&(NB=dp().epsilon()),NB}function Ms(){return"channelsLast"}function hs(r,e){return he(r,e)}function zd(r,e=-1){let t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),H(r,t)}function sne(r,e){return ee(()=>{if(r.shape.length!==2)throw new re(`repeat() expects a rank-2 tensor, but received a rank-${r.shape.length} tensor.`);let t=zd(r,1);return sA(t,[1,e,1])})}function ine(r){let e=[Za(r.shape)];return H(r,e)}function ane(r){if(r.rank<=1)throw new re(`batchFlatten requires a minimum rank of 2. Got rank: ${r.rank}.`);let e=[r.shape[0],Za(r.shape,1)];return H(r,e)}function Bd(r,e,t){return ee(()=>{switch(r.rank){case 1:return sb(r,e,t);case 2:return l_(r,[e,0],[t,r.shape[1]]);case 3:return ib(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return ny(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return tt(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return tt(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new re(`sliceAlongFirstAxis() received an unsupported tensor rank: ${r.rank}`)}})}function DB(r,e,t){return ee(()=>{switch(r.rank){case 1:return sb(r,e,t);case 2:return l_(r,[0,e],[r.shape[0],t]);case 3:return ib(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return ny(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new re(`sliceAlongLastAxis() received an unsupported tensor rank: ${r.rank}`)}})}function V_(r,e,t,n){return ee(()=>{switch(r.rank){case 1:return sb(r,e,t);case 2:switch(n){case 1:return Bd(r,e,t);case 2:return DB(r,e,t);default:throw new re(`The axis is not within the rank of the tensor ${n}`)}case 3:switch(n){case 1:return Bd(r,e,t);case 2:return ib(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return DB(r,e,t);default:throw new re(`The axis is not within the rank of the tensor ${n}`)}case 4:switch(n){case 1:return Bd(r,e,t);case 2:return ny(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return ny(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return DB(r,e,t);default:throw new re(`The axis is not within the rank of the tensor ${n}`)}default:throw new re(`sliceAlongLastAxis() received an unsupported tensor rank: ${r.rank}`)}})}function Bb(r,e=-1){let t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),Xt(r,e)}function RB(r,e){switch(r.rank){case 1:return $k([r,e]);case 2:return Lk([r,e],0);case 3:return Vk([r,e],0);case 4:return Bk([r,e],0);default:throw new re(`concatAlongFirstAxis() received an unsupported tensor rank: ${r.rank}`)}}function sA(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new re(`The length of input n (${e.length}) does not match the number of dimensions in input x (${r.rank})`);return Uo(r,e)}function zb(r,e=0,t=1,n,o){return ry(r,e,t,n,o)}function Qa(r,e,t,n){if(r.rank<2||e.rank<2)throw new lt(`dot requires both inputs to be rank >= 2 but got x shape = ${r.shape} and y shape = ${e.shape}`);if(e.rank>=3){let o=r.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(o!==s)throw new lt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${r.shape} and  y shape = ${e.shape}`)}if(r.rank===2&&e.rank===2)return nm.matMul({a:r,b:e,transposeA:!1,transposeB:!1,bias:n?AB(r.rank,n,Ms()):null,activation:t});{let o=r.shape.slice(),s=o.pop();r=H(r,[-1,s]);let i=e.shape.slice(),a=i.pop(),c=i.pop(),l=[...i,a],u=Array.from({length:e.rank},(f,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=H(kt(e,u),[c,-1]);let p=[...o,...l];return H(nm.matMul({a:r,b:e,transposeA:!1,transposeB:!1,bias:n?AB(r.rank,n,Ms()):null,activation:t}),p)}}function iA(r,e,t){return ee(()=>(Array.isArray(e)?e=Or(e,"int32"):e=he(e,"int32"),bp(r,e,t)))}function vy(r){return W(r,r)}function AB(r,e,t){let n=e.shape;if(e.rank!==1&&e.rank!==r)throw new re(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${r}`);if(r===5){if(t==="channelsFirst")return n.length===1?H(e,[1,n[0],1,1,1]):H(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?H(e,[1,1,1,1,n[0]]):H(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?H(e,[1,n[0],1,1]):H(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?H(e,[1,1,1,n[0]]):H(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?H(e,[1,n[0],1]):H(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?H(e,[1,1,n[0]]):H(e,[1].concat(n))}else if(r<3)return e;throw new re(`Unsupported input rank by biasAdd: ${e.rank}`)}function Fs(r,e,t){return ee(()=>(t==null&&(t=Ms()),sn(t),ae(r,AB(r.rank,e,t))))}function cne(r,e=1){if(e!==1)throw new lt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return xp(r)}function lne(r){return ee(()=>Ce(r,ae(Qr(r),1)))}function aA(r,e,t,n){return ee(()=>E3(r,e,t,n))}function une(r){return ee(()=>{let e=ae(.5,W(.2,r));return Zn(e,0,1)})}function hm(r,e,t=!1){return t?r():e()}var pne=["fanIn","fanOut","fanAvg"],dne=["normal","uniform","truncatedNormal"];function kze(r){kp(pne,"FanMode",r)}function Eze(r){kp(dne,"Distribution",r)}var Ps=class extends fe.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},mne=(()=>{class r extends Ps{apply(t,n){return Cr(t,n)}}return r.className="Zeros",r})();fe.registerClass(mne);var cA=(()=>{class r extends Ps{apply(t,n){return Vn(t,n)}}return r.className="Ones",r})();fe.registerClass(cA);var gne=(()=>{class r extends Ps{constructor(t){if(super(),typeof t!="object")throw new re(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new re(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return ee(()=>W(Oe(this.value),Vn(t,n)))}getConfig(){return{value:this.value}}}return r.className="Constant",r})();fe.registerClass(gne);var yne=(()=>{class r extends Ps{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return Ai(t,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return r.className="RandomUniform",r})();fe.registerClass(yne);var xne=(()=>{class r extends Ps{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new lt(`randomNormal does not support dType ${n}.`);return zb(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return r.className="RandomNormal",r})();fe.registerClass(xne);var vne=(()=>{class r extends Ps{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new lt(`truncatedNormal does not support dType ${n}.`);return lb(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return r.className="TruncatedNormal",r})();fe.registerClass(vne);var bne=(()=>{class r extends Ps{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return ee(()=>{if(t.length!==2||t[0]!==t[1])throw new re("Identity matrix initializer can only be used for 2D square matrices.");return W(this.gain,Zg(t[0]))})}getConfig(){return{gain:this.gain}}}return r.className="Identity",r})();fe.registerClass(bne);function Nze(r,e="channelsLast"){let t,n;if(sn(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){let o=Za(r,2);t=r[1]*o,n=r[0]*o}else if(e==="channelsLast"){let o=Za(r,0,r.length-2);t=r[r.length-2]*o,n=r[r.length-1]*o}}else{let o=Za(r);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}var Li=(()=>{class r extends Ps{constructor(t){if(super(),t.scale<0)throw new re(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,kze(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,Eze(this.distribution),this.seed=t.seed}apply(t,n){let o=Nze(t),s=o[0],i=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,s):this.mode==="fanOut"?a/=Math.max(1,i):a/=Math.max(1,(s+i)/2),this.distribution==="normal"){let c=Math.sqrt(a);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new lt(`${this.getClassName()} does not support dType ${n}.`);return lb(t,0,c,n,this.seed)}else{let c=Math.sqrt(3*a);return Ai(t,-c,c,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return r.className="VarianceScaling",r})();fe.registerClass(Li);var OB=(()=>{class r extends Li{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="GlorotUniform",r})();fe.registerClass(OB);var MB=(()=>{class r extends Li{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="GlorotNormal",r})();fe.registerClass(MB);var FB=(()=>{class r extends Li{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="HeNormal",r})();fe.registerClass(FB);var PB=(()=>{class r extends Li{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="HeUniform",r})();fe.registerClass(PB);var $B=(()=>{class r extends Li{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="LeCunNormal",r})();fe.registerClass($B);var LB=(()=>{class r extends Li{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return Li.className}}return r.className="LeCunUniform",r})();fe.registerClass(LB);var wne=(()=>{class r extends Ps{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,n){return ee(()=>{if(t.length<2)throw new lt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;let o=C.sizeFromShape(t.slice(0,-1)),s=t[t.length-1],i=o*s;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);let a=[Math.max(s,o),Math.min(s,o)],c=zb(a,0,1,n,this.seed),l=A3.qr(c,!1),u=l[0],d=l[1].flatten().stridedSlice([0],[Math.min(s,o)*Math.min(s,o)],[Math.min(s,o)+1]);return u=W(u,d.sign()),o<s&&(u=u.transpose()),W(Oe(this.gain),u.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}return r.className="Orthogonal",r})();fe.registerClass(wne);var hne={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function fne(r,e={}){return Tp(r,fe.SerializationMap.getMap().classNameMap,e,"initializer")}function Kr(r){return Lb(r)}function Mr(r){if(typeof r=="string"){let e=r in hne?hne[r]:r;if(e==="GlorotNormal")return new MB;if(e==="GlorotUniform")return new OB;if(e==="HeNormal")return new FB;if(e==="HeUniform")return new PB;if(e==="LeCunNormal")return new $B;if(e==="LeCunUniform")return new LB;{let t={};return t.className=e,t.config={},fne(t)}}else return r instanceof Ps?r:fne(r)}function lA(r){return Array.isArray(r)&&Array.isArray(r[0])}function Ub(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function ot(r){let e;if(Array.isArray(r)){if(r.length!==1)throw new re(`Expected Tensor length to be 1; got ${r.length}`);e=r[0]}else e=r;return e}function _t(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new re(`Expected exactly 1 Shape; got ${r.length}`)}else return r}function Gb(r){let e=0;for(let t of r)t.shape.length===0?e+=1:e+=t.shape.reduce((n,o)=>n*o);return e}var _ne="Variable",B_=class{constructor(e,t="float32",n=_ne,o=!0,s=null){this.dtype=t??"float32",this.shape=e.shape,this.id=tA(),n=n??_ne,this.originalName=rA(n),this.name=nA(this.originalName),this.trainable_=o,this.constraint=s,this.val=xE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Aze(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function Aze(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function z_(r){return r.map(e=>e.read())}function Wb(r){r.forEach(e=>{e[0].write(e[1])})}var Vr=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},fs=class{constructor(e,t,n,o,s,i,a){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=o,this.callArgs=s,this.outputTensorIndex=a,this.id=tA(),i!=null&&(this.originalName=rA(i),this.name=nA(this.originalName)),this.rank=t.length}},Rze=0,Ud=class{constructor(e,t){this.callArgs=t,this.id=Rze++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Oze=0,ut=class extends fe.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Oze++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){let n=this.getClassName();t=Xa(n)+"_"+dm(n)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),n=[s].concat(e.inputShape)}this.batchInputShape=n;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new As(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new re(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return No(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return No(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new aa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new aa(`Layer ${this.name} is not connected, no input to return.`);return No(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new aa(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new aa(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return No(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){let t=vr(e);if(this.inputSpec==null||this.inputSpec.length===0)return;let n=vr(this.inputSpec);if(t.length!==n.length)throw new re(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let o=0;o<t.length;o++){let s=t[o],i=n[o];if(i==null)continue;let a=s.rank;if(i.ndim!=null&&a!==i.ndim)throw new re(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new re(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new re(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&s.dtype!==i.dtype)throw new re(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${s.dtype}.`);if(i.axes){let c=s.shape;for(let l in i.axes){let u=Number(l),p=i.axes[l],d=u>=0?c[u]:c[c.length+u];if(p!=null&&[p,null].indexOf(d)===-1)throw new re(`Input ${o} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${p} but got shape ${c}.`)}}if(i.shape!=null)for(let c=0;c<i.shape.length;++c){let l=i.shape[c],u=s.shape[c];if(l!=null&&u!=null&&l!==u)throw new re(`Input ${o} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${s.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();let n=vr(e),o=Pze(e),s=$ze(e);if(o===s)throw new re("Arguments to apply() must be all SymbolicTensors or all Tensors");return Dl(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let i=[];for(let a of vr(e))i.push(a.shape);this.build(No(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(e),s){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);let a=vr(i),c=[];for(let l of a)n.indexOf(l)!==-1&&(l=l.clone()),c.push(l);if(i=No(c),this.activityRegularizer!=null)throw new lt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{let i=Mze(e),a=this.computeOutputShape(i),c,l=Fze(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?c=a.map((u,p)=>new fs(l,u,this,vr(e),t,this.name,p)):c=new fs(l,a,this,vr(e),t,this.name),this.addInboundNode(e,c,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new lt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,o)=>{n!=null&&e[o]!=null&&e[o]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new aa(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let t of this.inboundNodes){let n=JSON.stringify(t.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new aa(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new As(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Gb(this.weights)}build(e){this.built=!0}getWeights(e=!1){return z_(e?this.trainableWeights:this.weights)}setWeights(e){ee(()=>{let t=this.weights;if(t.length!==e.length)throw new re(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;let n=[],o=z_(t);for(let s=0;s<o.length;++s){let i=o[s],a=t[s],c=e[s];if(!C.arraysEqual(i.shape,c.shape))throw new re(`Layer weight shape ${i.shape} not compatible with provided weight shape ${c.shape}`);n.push([a,c])}Wb(n)})}addWeight(e,t,n,o,s,i,a,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new re(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(o=c!=null?c():Mr("zeros"));let l=o.apply(t,n),u=new B_(l,n,e,i,a);return l.dispose(),s!=null&&this.addLoss(()=>s.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=vr(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;let o=this.computeMask(e,n),s=vr(t),i=vr(o);if(s.length!==i.length)throw new Error(`${this.name} outputs ${s.length} tensors but ${s.length} masks for those tensors`);for(let a=0;a<s.length;a++)s[a].kerasMask=i[a]}addInboundNode(e,t,n,o,s,i,a=null){let c=vr(e);t=vr(t),n=vr(n),o=vr(o),s=Ub(s),i=Ub(i);let l=[],u=[],p=[];for(let d of c)l.push(d.sourceLayer),u.push(d.nodeIndex),p.push(d.tensorIndex);new Ud({outboundLayer:this,inboundLayers:l,nodeIndices:u,tensorIndices:p,inputTensors:c,outputTensors:t,inputMasks:n,outputMasks:o,inputShapes:s,outputShapes:i},a);for(let d=0;d<t.length;d++)t[d].sourceLayer=this,t[d].nodeIndex=this.inboundNodes.length-1,t[d].tensorIndex=d}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function Mze(r){r=vr(r);let e=[];for(let t of r)e.push(t.shape);return No(e)}function Fze(r){return"float32"}function VB(r,e,t){if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];{let n=e.inboundNodes[t];if(n.inboundLayers.length===0)return n.inputTensors;{let o=[];for(let s=0;s<n.inboundLayers.length;s++){let i=n.inputTensors[s],a=n.inboundLayers[s],c=n.nodeIndices[s],l=VB(i,a,c);for(let u of l)o.indexOf(u)===-1&&o.push(u)}return o}}}function Pze(r){let e=!0;for(let t of vr(r))if(!(t instanceof fs)){e=!1;break}return e}function $ze(r){let e=!0;for(let t of vr(r))if(t instanceof fs){e=!1;break}return e}var by=(()=>{class r extends ut{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:dm("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new re("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new re("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new re("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=t.dtype||"float32";this.batchInputShape=n,this.dtype=o,this.inputSpec=[{shape:n}];let s=new fs(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new re(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return r.className="InputLayer",r})();fe.registerClass(by);function BB(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new re("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));let t=r.dtype;return t==null&&(t="float32"),new by({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}).inboundNodes[0].outputTensors[0]}function Lze(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return he(e,r.dtype)}catch{throw new re(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${r.name}' (${r.dtype}).`)}}var Ep=class r{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(let t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(let t of e)this.add(t.key,t.value)}}add(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Lze(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new re(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof fs){if(this.id2Value[e.id]==null)throw new re(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{let t=this.name2Id[e];if(t==null)throw new re(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof fs){if(this.id2Value[e.id]==null)throw new re(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{let t=this.name2Id[e];if(t==null)throw new re(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Xe(this.id2Mask)}},uA=new P_,pA=new P_;function Ine(r){uA?.setMaxEntries(r),pA?.setMaxEntries(r)}function wy(r,e,t,n){let o=t==null?!1:t.training,s=Array.isArray(r),i=s?r:[r],a=i.map(f=>f.name),c=[],l=e.names();for(let f of a)l.indexOf(f)!==-1?c.push(e.getValue(f)):c.push(null);n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);let u=a.join(",")+"|"+e.names().sort().join(","),p=uA.get(u),d;if(p==null){let f=Vze(i,e);p=f.sorted,d=f.recipientCounts,uA.put(u,p),pA.put(u,d)}d={},o||Object.assign(d,pA.get(u));let h=new Ep(e);for(let f=0;f<p.length;++f){if(n!=null){let R=t_().numTensors;R>n.maxNumTensors&&(n.maxNumTensors=R),R<n.minNumTensors&&(n.minNumTensors=R)}let m=p[f],g=m.sourceLayer;if(g instanceof by)continue;let y=[],x=[],b=[],w=!1;for(let R of m.inputs){let L=h.getValue(R),B=h.getMask(R);y.push(L),x.push(B),B!=null&&(w=!0),o||(d[R.name]--,d[R.name]===0&&!e.hasKey(R)&&a.indexOf(R.name)===-1&&!L.isDisposed&&R.sourceLayer.stateful!==!0&&b.push(L))}w&&(t=t||{},t.mask=x[0]);let _=vr(g.apply(y,t)),I=null;g.supportsMasking&&(I=g.computeMask(y,x));let S=zze(m),k=Array.isArray(S)?S:[S];for(let R=0;R<k.length;++R){h.hasKey(k[R])||h.add(k[R],_[R],Array.isArray(I)?I[0]:I);let L=a.indexOf(k[R].name);L!==-1&&(c[L]=_[R])}o||Xe(b)}return h.disposeMasks(),s?c:c[0]}function Vze(r,e){C.assert(r!=null&&r.length>0,()=>"Expected at least one fetch, got none");let t=[],n={};if(r.length===1){let o=Sne(r[0],e);t=o.sorted,n=o.recipientMap}else{let o=new Set;for(let s of r){let{sorted:i,recipientMap:a}=Sne(s,e);for(let c of i)o.has(c.name)||(t.push(c),o.add(c.name));for(let c in a)n[c]==null&&(n[c]=new Set),a[c].forEach(l=>n[c].add(l))}}return{sorted:t,recipientCounts:Bze(n)}}function Bze(r){let e={};for(let t in r)e[t]=r[t].size;return e}function Sne(r,e){let t=new Set,n=[],o={};for(let a of e.names())t.add(a);let s=[],i=[];for(s.push(r);s.length>0;){let a=s[s.length-1];if(t.has(a.name)){s.pop();continue}let c=i[i.length-1]===s.length-1;if(a.inputs.length===0||c)s.pop(),n.push(a),t.add(a.name),c&&i.pop();else{i.push(s.length-1);for(let l of a.inputs)o[l.name]==null&&(o[l.name]=new Set),o[l.name].add(a.name),!t.has(l.name)&&s.push(l)}}return{sorted:n,recipientMap:o}}function zze(r){let e;if(r.sourceLayer.inboundNodes.length===1)e=r.sourceLayer.output;else{let t=null;for(let n=0;n<r.sourceLayer.inboundNodes.length;++n)for(let o of r.sourceLayer.inboundNodes[n].outputTensors)if(o.id===r.id){t=n;break}e=r.sourceLayer.getOutputAt(t)}return e}var Uze=Z();Uze.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Ine);function zB(r,e){return ee(()=>Rr(Pe(W(r,r),e,!0)))}var Cy=class extends fe.Serializable{getConfig(){return{}}},Ene=(()=>{class r extends Cy{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ee(()=>{let n=zB(t,this.axis),o=Zn(n,0,this.maxValue);return W(t,Ce(o,ae(jn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return r.className="MaxNorm",r})();fe.registerClass(Ene);var Nne=(()=>{class r extends Cy{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ee(()=>Ce(t,ae(jn(),zB(t,this.axis))))}getConfig(){return{axis:this.axis}}}return r.className="UnitNorm",r})();fe.registerClass(Nne);var Dne=(()=>{class r extends Cy{apply(t){return Go(t)}}return r.className="NonNeg",r})();fe.registerClass(Dne);var Ane=(()=>{class r extends Cy{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return ee(()=>{let n=zB(t,this.axis),o=ae(W(this.rate,Zn(n,this.minValue,this.maxValue)),W(1-this.rate,n));return W(t,Ce(o,ae(jn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return r.className="MinMaxNorm",r})();fe.registerClass(Ane);var Tne={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function xn(r){return Lb(r)}function kne(r,e={}){return Tp(r,fe.SerializationMap.getMap().classNameMap,e,"constraint")}function vn(r){if(r==null)return null;if(typeof r=="string"){let t={className:r in Tne?Tne[r]:r,config:{}};return kne(t)}else return r instanceof Cy?r:kne(r)}function Gd(r){return M(this,null,function*(){if(r==null)return;let e=[],t=[],n=[];for(let o in r){let s=r[o];if(typeof s!="number"){let i=s;e.push(i.data()),t.push(o),n.push(i)}}if(e.length>0){let o=yield Promise.all(e);for(let s=0;s<o.length;++s)r[t[s]]=o[s][0];Xe(n)}})}function dA(r){if(r!=null)for(let e in r){let t=r[e];typeof t!="number"&&t.dispose()}}var jze=125,fm=class{constructor(){this.validationData=null}setParams(e){this.params=e}onEpochBegin(e,t){return M(this,null,function*(){})}onEpochEnd(e,t){return M(this,null,function*(){})}onBatchBegin(e,t){return M(this,null,function*(){})}onBatchEnd(e,t){return M(this,null,function*(){})}onTrainBegin(e){return M(this,null,function*(){})}onTrainEnd(e){return M(this,null,function*(){})}setModel(e){}},hA=class{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(let t of this.callbacks)t.setParams(e)}setModel(e){for(let t of this.callbacks)t.setModel(e)}onEpochBegin(e,t){return M(this,null,function*(){t==null&&(t={});for(let n of this.callbacks)yield n.onEpochBegin(e,t)})}onEpochEnd(e,t){return M(this,null,function*(){t==null&&(t={});for(let n of this.callbacks)yield n.onEpochEnd(e,t)})}onBatchBegin(e,t){return M(this,null,function*(){t==null&&(t={});for(let n of this.callbacks)yield n.onBatchBegin(e,t)})}onBatchEnd(e,t){return M(this,null,function*(){t==null&&(t={});for(let n of this.callbacks)yield n.onBatchEnd(e,t)})}onTrainBegin(e){return M(this,null,function*(){e==null&&(e={});for(let t of this.callbacks)yield t.onTrainBegin(e)})}onTrainEnd(e){return M(this,null,function*(){e==null&&(e={});for(let t of this.callbacks)yield t.onTrainEnd(e)})}},UB=class extends fm{constructor(){super()}onEpochBegin(e){return M(this,null,function*(){this.seen=0,this.totals={}})}onBatchEnd(e,t){return M(this,null,function*(){t==null&&(t={});let n=t.size==null?0:t.size;this.seen+=n;for(let o in t){let s=t[o];if(typeof s=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+s*n;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;let a=ee(()=>ae(this.totals[o],W(s,n)));this.totals[o]=a,i?.dispose()}}})}onEpochEnd(e,t){return M(this,null,function*(){if(t!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?t[n]=this.totals[n]/this.seen:ee(()=>{let o=W(Ce(1,this.seen),this.totals[n]);t[n]=o,this.totals[n].dispose(),rn(t[n])}))})}},fA=class extends fm{onTrainBegin(e){return M(this,null,function*(){this.epoch=[],this.history={}})}onEpochEnd(e,t){return M(this,null,function*(){t==null&&(t={}),this.epoch.push(e);for(let n in t)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(t[n])})}syncData(){return M(this,null,function*(){let e=[],t=[],n=[];for(let s in this.history){let i=this.history[s];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){let c=i[a];e.push(c.data()),t.push(s),n.push(a)}}let o=yield Promise.all(e);for(let s=0;s<o.length;++s)this.history[t[s]][n[s]].dispose(),this.history[t[s]][n[s]]=o[s][0]})}},mA=class extends fm{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||f_,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=jze),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");C.isNumber(this.yieldEvery)&&(this.maybeWait=Xre(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}maybeWait(e,t,n){return M(this,null,function*(){let o=[];this.yield!=null&&(yield Gd(n),o.push(this.yield(e,t,n))),o.push(this.nextFrameFunc()),yield Promise.all(o)})}onEpochBegin(e,t){return M(this,null,function*(){this.currentEpoch=e,this.epochBegin!=null&&(yield Gd(t),yield this.epochBegin(e,t))})}onEpochEnd(e,t){return M(this,null,function*(){let n=[];this.epochEnd!=null&&(yield Gd(t),n.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),yield Promise.all(n)})}onBatchBegin(e,t){return M(this,null,function*(){this.batchBegin!=null&&(yield Gd(t),yield this.batchBegin(e,t))})}onBatchEnd(e,t){return M(this,null,function*(){let n=[];this.batchEnd!=null&&(yield Gd(t),n.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):C.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),yield Promise.all(n)})}onTrainBegin(e){return M(this,null,function*(){this.trainBegin!=null&&(yield Gd(e),yield this.trainBegin(e))})}onTrainEnd(e){return M(this,null,function*(){this.trainEnd!=null&&(yield Gd(e),yield this.trainEnd(e))})}};function gA(r,e){return r==null&&(r={}),r instanceof fm?[r]:Array.isArray(r)&&r[0]instanceof fm?r:vr(r).map(n=>new mA(n,e))}var Rne=(()=>{class r{constructor(){}static registerCallbackConstructor(t,n){C.assert(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),r.checkForDuplicate(n),r.constructors[t]==null&&(r.constructors[t]=[]),r.constructors[t].push(n)}static checkForDuplicate(t){for(let n in r.constructors)r.constructors[+n].forEach(s=>{if(s===t)throw new re("Duplicate callback constructor.")})}static clear(){r.constructors={}}static createCallbacks(t){let n=[];for(let o in r.constructors){let s=+o;t>=s&&n.push(...r.constructors[s])}return n.map(o=>new o)}}return r.constructors={},r})();function yA(r,e,t,n,o,s,i,a,c){let l=new fA,u=[new UB,...Rne.createCallbacks(e)];r!=null&&u.push(...r),u.push(l);let p=new hA(u);return p.setParams({epochs:t,initialEpoch:n,samples:o,steps:s,batchSize:i,verbose:e,doValidation:a,metrics:c}),{callbackList:p,history:l}}function Vi(r,e={},t=!1){return Tp(r,fe.SerializationMap.getMap().classNameMap,e,"layer",t)}function U_(r,e){return ee(()=>{r.dtype!=="float32"&&(r=he(r,"float32"));let t=Pe(vy(r),e,!0),n=La(t.shape,jn()),o=Rr(Qs(t,n));return Ce(r,o)})}function _y(r,e){return ee(()=>qr(vy(Te(e,r)),-1))}function W_(r,e){return ee(()=>qr(Qr(Te(e,r)),-1))}function j_(r,e){return ee(()=>{let t=Te(r,e),n=Zn(Qr(r),jn(),Number.MAX_VALUE),o=Qr(Ce(t,n));return W(100,qr(o,-1))})}function Hze(r,e){return ee(()=>{let t=Zn(e,jn(),Number.MAX_VALUE),n=To(ae(1,t)),o=Zn(r,jn(),Number.MAX_VALUE),s=To(ae(1,o));return qr(vy(Te(n,s)),-1)})}function qze(r,e){return ee(()=>{let t=Qs(0,Te(1,W(r,e)));return qr(vy(t),-1)})}function Kze(r,e){return ee(()=>{let t=Qs(0,Te(1,W(r,e)));return qr(t,-1)})}function Xze(r,e){return ee(()=>{let t=Pe(W(r,e),-1),n=Io(W(Te(1,r),e),-1);return Qs(0,ae(1,Te(n,t)))})}function Yze(r,e){return ee(()=>{let t=Math.log(2),n=Te(e,r),o=Te(ae(n,wl(W(-2,n))),t);return qr(o,-1)})}function Sy(r,e,t=!1){return ee(()=>{if(t)e=em(e);else{let n=Pe(e,e.shape.length-1,!0);e=Ce(e,n)}return e=Zn(e,jn(),1-jn()),Rt(Pe(W(he(r,"float32"),To(e)),e.shape.length-1))})}function jb(r,e,t=!1){return ee(()=>{let n=he(vp(ine(r)),"int32");e=Zn(e,jn(),1-jn());let o=e.shape,s=H(Jg(n,o[o.length-1]),o);return Sy(s,e,t)})}function Zze(r,e){if(!C.arraysEqual(r.shape,e.shape))throw new re(`logits and labels must have the same shape, but got shapes ${JSON.stringify(r.shape)} and ${JSON.stringify(e.shape)}`);return ee(()=>{let t=Go(e),n=Rt(Qr(e));return ae(Te(t,W(e,r)),Kf(nn(n)))})}function Hb(r,e){return ee(()=>{let t;return t=Zn(e,jn(),1-jn()),t=To(Ce(t,Te(1,t))),qr(Zze(r,t),-1)})}function Qze(r,e){return ee(()=>{let t=Zn(r,jn(),1),n=Zn(e,jn(),1);return Pe(W(r,To(Ce(t,n))),-1)})}function Jze(r,e){return ee(()=>{let t=To(ae(jn(),e));return qr(Te(e,W(r,t)),-1)})}function xA(r,e){return ee(()=>{let t=U_(r,-1),n=U_(e,-1),o=W(t,n);return Rt(Pe(o,-1))})}var G_={meanSquaredError:_y,meanAbsoluteError:W_,meanAbsolutePercentageError:j_,meanSquaredLogarithmicError:Hze,squaredHinge:qze,hinge:Kze,categoricalHinge:Xze,logcosh:Yze,categoricalCrossentropy:Sy,sparseCategoricalCrossentropy:jb,binaryCrossentropy:Hb,kullbackLeiblerDivergence:Qze,poisson:Jze,cosineProximity:xA};function vA(r){if(typeof r=="string"){if(r in G_)return G_[r];let e=`Unknown loss ${r}`;throw r.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${r}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new re(e)}else return r}function wA(r,e){return ee(()=>{let t=W(.5,lo(e)),n=hs(fn(e,t),r.dtype);return qr(ls(r,n),-1)})}function CA(r,e){return ee(()=>hs(ls($a(r,-1),$a(e,-1)),"float32"))}function eUe(r,e){return ee(()=>he(Pe(Yo(ls(r,1),ls(e,1))),"float32"))}function tUe(r,e){return ee(()=>he(Pe(Yo(ls(r,0),ls(e,1))),"float32"))}function Mne(r,e){return ee(()=>{let t=eUe(r,e),n=tUe(r,e),o=ae(t,n);return he(jr(fn(o,0),Ce(t,o),0),"float32")})}function GB(r,e){return Hb(r,e)}function WB(r,e){return r.rank===e.rank&&(r=Jt(r,[r.rank-1])),e=$a(e,-1),e.dtype!==r.dtype&&(e=he(e,r.dtype)),he(ls(r,e),"float32")}var rUe=_y,nUe=_y,oUe=W_,sUe=W_,iUe=j_,aUe=j_,_A=Sy,cUe=xA,jB=jb,bA={binaryAccuracy:wA,categoricalAccuracy:CA,precision:Mne,categoricalCrossentropy:_A,sparseCategoricalCrossentropy:jB,mse:rUe,MSE:nUe,mae:oUe,MAE:sUe,mape:iUe,MAPE:aUe,cosine:cUe};function Fne(r){if(typeof r=="string"&&r in bA)return bA[r];if(typeof r!="string"&&r!=null)return r;throw new re(`Unknown metric ${r}`)}function H_(r){if(ca(r!==null,`Unknown LossOrMetricFn ${r}`),typeof r=="string")return r;{let e;for(let t of Object.keys(G_))if(G_[t]===r){e=t;break}if(e!==void 0)return e;for(let t of Object.keys(bA))if(bA[t]===r){e=t;break}return e!==void 0?e:r.name}}function $ne(r){let e={Adagrad:()=>ly.adagrad(.01),Adadelta:()=>ly.adadelta(1,.95,jn()),Adam:()=>ly.adam(.001,.9,.999,jn()),Adamax:()=>ly.adamax(.002,.9,.999,jn(),0),RMSProp:()=>ly.rmsprop(.001,.9,0,jn()),SGD:()=>ly.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new re(`Unknown Optimizer ${r}`)}function qB(r,e,t=!1){if(r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!HB(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){let n=JSON.stringify(r);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function HB(r){if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){let e=Object.keys(r);for(let t of e)if(typeof t!="string"||!HB(r[t]))return!1;return!0}else if(Array.isArray(r)){for(let e of r)if(!HB(e))return!1;return!0}else return!1;else{let e=typeof r;return e==="string"||e==="number"||e==="boolean"}}function Lne(r,e,t,n=console.log){let o=pUe(r),s=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(u=>Math.floor(e*u)));let i;if(!o){s.push("Receives inputs"),i=[];for(let u in r.nodesByDepth)i.push(...r.nodesByDepth[u])}n("_".repeat(e)),SA(s,t,n),n("=".repeat(e));let a=r.layers;for(let u=0;u<a.length;++u)o?dUe(a[u],t,n):hUe(a[u],t,i,n),n((u===a.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();let c=uUe(r),l=Gb(r.nonTrainableWeights);n(`Total params: ${c+l}`),n(`Trainable params: ${c}`),n(`Non-trainable params: ${l}`),n("_".repeat(e))}function uUe(r){let e;return r.collectedTrainableWeights!=null?e=Gb(r.collectedTrainableWeights):e=Gb(r.trainableWeights),e}function pUe(r){let e=!0,t=[],n=[];for(let o in r.nodesByDepth)t.push(r.nodesByDepth[o]);for(let o of t){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}n.push(...o)}if(e)for(let o of r.layers){let s=!1;for(let i of o.inboundNodes)if(n.indexOf(i)!==-1)if(s){e=!1;break}else s=!0;if(!e)break}return e}function SA(r,e,t=console.log){let n="";for(let o=0;o<r.length;++o)o>0&&(n=n.slice(0,n.length-1)+" "),n+=r[o],n=n.slice(0,e[o]),n+=" ".repeat(e[o]-n.length);t(n)}function dUe(r,e,t){let n,o;try{o=r.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{o="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}let s=r.name,i=r.getClassName(),a=[`${s} (${i})`,o,n,r.countParams().toString()];SA(a,e,t)}function hUe(r,e,t,n){let o,s;try{s=r.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}let i=[];for(let p of r.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(p)===-1))for(let d=0;d<p.inboundLayers.length;++d){let h=p.inboundLayers[d].name,f=p.nodeIndices[d],m=p.tensorIndices[d];i.push(`${h}[${f}][${m}]`)}let a=r.name,c=r.getClassName(),l=i.length===0?"":i[0],u=[`${a} (${c})`,s,o,r.countParams().toString(),l];SA(u,e,n);for(let p=1;p<i.length;++p)SA(["","","","",i[p]],e,n)}function Vne(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function q_(r,e){if(r===null)return null;if(typeof r=="string")return Vd(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){let t=[],n=r.length;for(let o=0;o<n;++o){let s=r[o];Vne(e,o,s)?t.push(s):t.push(q_(s,e))}return t}else{let t={};for(let n of Object.keys(r)){let o=r[n];if(n==="name"&&typeof o=="string")t[n]=o;else{let s=Vd(n);t[s]=q_(o,s)}}return t}}function IA(r,e){if(r==null)return null;if(typeof r=="string")return Xa(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){let t=[],n=r.length;for(let o=0;o<n;++o){let s=r[o];Vne(e,o,s)?t.push(s):t.push(IA(s,e))}return t}else{let t={};for(let n of Object.keys(r)){let o=r[n],s=Xa(n);(n==="name"||n==="className")&&typeof o=="string"?t[s]=o:t[s]=IA(o,n)}return t}}var qb="4.20.0";var fUe=r=>{let e=Object.keys(r);if(e.length===0)return!1;let t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))},TA=class r extends ut{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){let x=this.getClassName().toLowerCase();this.name=dm(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Ya(this.inputs).length!==this.inputs.length)throw new re(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);Ya(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let x of this.outputs){let b=x.sourceLayer,w=x.nodeIndex,_=x.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(_)}for(let x of this.inputs){let b=x.sourceLayer,w=x.nodeIndex,_=x.tensorIndex;ca(w===0,"input layer has >1 nodes"),ca(_===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(_)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){let b=this.inputLayers[x];if(!(b instanceof by))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(let x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);let t={},n={},o={},s={},i={},a=[],c=(x,b,w,_,I,S)=>{(_==null||I==null||S==null)&&(_=x.sourceLayer,I=x.nodeIndex,S=x.tensorIndex);let k=_.inboundNodes[I];if(w.indexOf(k)!==-1)throw new As(`The tensor ${x.name} at layer "${_.name}" is part of a cycle.`);if(b.indexOf(k)!==-1)return;this.containerNodes.add(r.nodeKey(_,I)),_.id in i||(i[_.id]=Object.keys(i).length),w.indexOf(k)===-1&&w.push(k);let R=k.inboundLayers.length;for(let L=0;L<R;L++){let B=k.inputTensors[L],z=k.inboundLayers[L],q=k.nodeIndices[L],U=k.tensorIndices[L];c(B,b,w,z,q,U)}for(b.push(k);w.indexOf(k)>=0;)w.splice(w.indexOf(k),1);a.push(k)},l=[],u=[];for(let x of this.outputs)c(x,l,u);let p=a.slice().reverse();for(let x of p){n[x.id]=x,x.id in t||(t[x.id]=0);let b=t[x.id],w=o[x.outboundLayer.id]==null?0:o[x.outboundLayer.id];b=Math.max(b,w),o[x.outboundLayer.id]=b,s[x.outboundLayer.id]=x.outboundLayer,t[x.id]=b;for(let _=0;_<x.inboundLayers.length;_++){let I=x.inboundLayers[_],S=x.nodeIndices[_],k=I.inboundNodes[S],R=t[k.id]==null?0:t[k.id];t[k.id]=Math.max(b+1,R),n[k.id]=k}}let d={};for(let x in t){let b=t[x];b in d||(d[b]=[]),d[b].push(n[x])}let h={};for(let x in o){let b=o[x];b in h||(h[b]=[]),h[b].push(s[x])}let f=Object.keys(h).map(x=>parseInt(x,10)).sort($_);this.layers=[];for(let x of f){let b=h[x];b.sort((w,_)=>{let I=i[w.id],S=i[_.id];return I<S?-1:I>S?1:0});for(let w of b)w instanceof r&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=h,f=Object.keys(d).map(x=>parseInt(x,10)).sort($_);let m=this.inputs.slice(),g=[];for(let x of f)for(let b of d[x]){let w=b.outboundLayer;if(w!=null){for(let _ of b.inputTensors)if(m.indexOf(_)===-1)throw new As(`Graph disconnected: cannot obtain value for tensor ${_} at layer "${w.name}". The following previous layers were accessed without issue: ${g}`);for(let _ of b.outputTensors)m.push(_);g.push(w.name)}}this.nodesByDepth=d;let y=this.layers.map(x=>x.name);for(let x of y){let b=y.filter(w=>w===x).length;if(b!==1)throw new As(`The name "${x}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(let t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(n=>n.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new re("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(let t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let n of this.layers)t.push(...n.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){let n={},o=0,s=fUe(e);s&&this.parseWeights(e);for(let a of this.layers)for(let[c,l]of a.weights.entries()){let u=s?`${l.name.split("/").slice(0,-1).join("/")+"/"}${c}`:l.originalName;if(n[u]!=null)throw new re(`Duplicate weight name: ${u}`);n[u]=l,o++}let i=[];for(let a in e){let c=a;if(n[a]==null){let l=a.split("/");c=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(n[c]!=null)i.push([n[c],e[a]]);else if(t)throw new re(`Provided weight data has no target variable: ${a}`);delete n[c]}if(t){let a=[];for(let c in n)a.push(c);if(a.length>0)throw new re(`${a.length} of ${o} weights are not set: ${a}`)}Wb(i)}parseWeights(e){for(let t in Object.keys(e)){let n=t.split("/"),o=["vars","layer_checkpoint_dependencies"],s=n.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!o.includes(i)).join("/");s!==t&&(e[s]=e[t],delete e[t])}}updatedConfig(){let e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${qb}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){let n=IA(this.updatedConfig());return t?JSON.stringify(n):n}call(e,t){return ee(()=>{e=vr(e);let n=new Ep;for(let o=0;o<this.inputs.length;++o)n.add(this.inputs[o],e[o]);return wy(this.outputs,n,t)})}computeMask(e,t){return ee(()=>{e=vr(e);let n;return t==null?n=Ka(null,e.length):n=vr(t),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){let t=Ub(e);if(t.length!==this.inputLayers.length)throw new re(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);let n={};for(let a=0;a<t.length;a++){let c=this.inputLayers[a],l=t[a],u=c.name+"_0_0";n[u]=l}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort($_);if(o.length>1)for(let a of o){let c=this.nodesByDepth[a];for(let l of c){let u=l.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;let p=[];for(let m=0;m<l.inboundLayers.length;m++){let g=l.inboundLayers[m],y=l.nodeIndices[m],x=l.tensorIndices[m],b=`${g.name}_${y}_${x}`,w=n[b];p.push(w)}let d=u.computeOutputShape(No(p)),h=Ub(d),f=u.inboundNodes.indexOf(l);for(let m=0;m<h.length;m++){let g=`${u.name}_${f}_${m}`;n[g]=h[m]}}}let s=[],i=[];for(let a=0;a<this.outputLayers.length;a++){let c=this.outputLayers[a],l=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],p=`${c.name}_${l}_${u}`;i.push(p)}for(let a=0;a<i.length;a++){let c=i[a];ca(c in n),s.push(n[c])}return No(s)}runInternalGraph(e,t){t==null&&(t=Ka(null,e.length));let n={};for(let c=0;c<this.inputs.length;++c){let l=this.inputs[c],u=e[c],p=t[c];n[l.id]=[u,p]}let o=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort($_);for(let c of o){let l=this.nodesByDepth[c];for(let u of l){let p=u.outboundLayer,d=u.inputTensors,h=u.outputTensors,f=new Array;for(let m of d)m.id in n&&f.push(n[m.id]);if(f.length===d.length){let m={},g,y,x,b;if(u.callArgs!=null&&(m=u.callArgs),f.length===1){let[w,_]=f[0];m.mask==null&&(m.mask=_),x=vr(p.call(w,m)),b=vr(p.computeMask(w,_)),g=[w],y=[_]}else g=f.map(w=>w[0]),y=f.map(w=>w[1]),m.mask==null&&(m.mask=y),x=vr(p.call(g,m)),b=vr(p.computeMask(g,y));if(p.activityRegularizer)throw new lt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<h.length;++w){let _=h[w],I=x[w],S=b[w];n[_.id]=[I,S]}}}}let s=[],i=[],a=[];for(let c of this.outputs){ca(c.id in n,`Could not compute output ${c.name} : ${c.id}`);let[l,u]=n[c.id];a.push(l.shape),s.push(l),i.push(u)}return[s,i,a]}buildNodeConversionMap(e){let t={},n;for(let o of this.layers){n=o instanceof r?1:0;for(let s=0;s<o.inboundNodes.length;s++){let i=r.nodeKey(o,s);this.containerNodes.has(i)&&(t[i]=n,n+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new re("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(let n of this.layers)if(n.name===e)return n;throw new re(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new re(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ee(()=>{let e=[];for(let t of this.layers)for(let n=0;n<t.inboundNodes.length;++n){let o=r.nodeKey(t,n);this.containerNodes.has(o)&&e.push(...t.calculateLosses())}return e})}getConfig(){let e={name:this.name},t=this.buildNodeConversionMap(this.layers),n=[];for(let i of this.layers){let a=i.getClassName(),c=i.getConfig(),l=[];for(let p=0;p<i.inboundNodes.length;p++){let d=i.inboundNodes[p],h=r.nodeKey(i,p),f={};if(this.containerNodes.has(h)){if(d.callArgs)try{JSON.stringify(d.callArgs),f=d.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${d.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(d.inboundLayers.length>0){let m=[];for(let g=0;g<d.inboundLayers.length;g++){let y=d.inboundLayers[g],x=d.nodeIndices[g],b=d.tensorIndices[g],w=r.nodeKey(y,x),_=t[w];_==null&&(_=0),m.push([y.name,_,b,f])}l.push(m)}}}let u={};u.name=i.name,u.className=a,u.config=c,u.inboundNodes=l,n.push(u)}e.layers=n;let o=[];for(let i=0;i<this.inputLayers.length;i++){let a=this.inputLayers[i],c=this.inputLayersNodeIndices[i],l=r.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=t[l];u==null&&(u=0);let p=this.inputLayersTensorIndices[i];o.push([a.name,u,p])}e.inputLayers=o;let s=[];for(let i=0;i<this.outputLayers.length;i++){let a=this.outputLayers[i],c=this.outputLayersNodeIndices[i],l=r.nodeKey(a,c);if(!this.containerNodes.has(l))continue;let u=t[l];u==null&&(u=0);let p=this.outputLayersTensorIndices[i];s.push([a.name,u,p])}return e.outputLayers=s,e}static fromConfig(e,t,n={},o=!1){let s={},i={};function a(g,y){g.name in i?i[g.name].push(y):i[g.name]=[y]}function c(g,y){let x=[],b;for(let w of y){let _=w[0],I=w[1],S=w[2];if(b=w[3]==null?{}:w[3],!(_ in s)){a(g,y);return}let k=s[_];if(k.inboundNodes.length<=I){a(g,y);return}let R=k.inboundNodes[I];x.push(R.outputTensors[S])}x.length>0&&g.apply(No(x),b)}function l(g){let y=g.name,x=Vi(g,t.customObjects!=null?t.customObjects:{});x.setFastWeightInitDuringBuild(o),s[y]=x,g.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new re(`Corrupted configuration, expected array for nodeData: ${w}`);a(x,w)})}let u=t.name,p=t.layers;for(let g of p)l(g);for(;!qre(i);)for(let g of p){let y=s[g.name];if(y.name in i){let x=i[y.name];delete i[y.name];for(let b of x)c(y,b)}}let d=[],h=[],f=t.inputLayers;for(let g of f){let y=g[0],x=g[1],b=g[2];ca(y in s);let _=s[y].inboundNodes[x].outputTensors;d.push(_[b])}let m=t.outputLayers;for(let g of m){let y=g[0],x=g[1],b=g[2];ca(y in s);let _=s[y].inboundNodes[x].outputTensors;h.push(_[b])}return new e({inputs:d,outputs:h,name:u})}get stateful(){if(this._stateful)throw new re("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ee(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}};function mUe(r,e,t){let n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(o=>null);if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error(`Provided ${t} is an array of ${r.length} element(s), but the model has ${n} outputs. Make sure a set of weights is provided for each model output.`);return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){let o=[];return e.forEach(s=>{s in r?o.push(r[s]):o.push(null)}),o}else throw new Error(`The model has multiple (${n}) outputs, so ${t} must be either an array with ${n} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(r)}`)}function kA(r,e){return mUe(r,e,"classWeight")}function EA(r,e,t,n){return M(this,null,function*(){if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");if(t!=null){let o=ee(()=>{if(r.shape.length===1)return Ts(r);if(r.shape.length===2){if(r.shape[1]>1)return $a(r,1);if(r.shape[1]===1)return H(r,[r.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${r.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${r.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(yield o.data());Xe(o);let i=[];return s.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),Or(i,"float32")}else return null})}function Bne(r,e){return W(r,e)}var gUe=32;function Gne(r,e){let t,n,o=e;t=o.xs,n=o.ys,C.assert(t!=null&&n!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);let s=zne("input",r.inputNames,t),i=zne("output",r.outputNames,n),a=s[0].shape[0];C.assert(s.length===r.inputs.length,()=>`LayersModel has ${r.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(r.inputNames)})`),C.assert(i.length===r.outputs.length,()=>`LayersModel has ${r.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(r.outputNames)})`);for(let c=0;c<s.length;c++)C.assert(s[c].shape[0]===a,()=>`Batch size mismatch: input ${r.inputNames[c]} has ${s[c].shape[0]}; expected  ${a} based on input ${r.inputNames[0]}.`);for(let c=0;c<i.length;c++)C.assert(i[c].shape[0]===a,()=>`Batch size mismatch: output ${r.outputNames[c]} has ${i[c].shape[0]}; expected  ${a} based on input ${r.inputNames[0]}.`);return{xs:s,ys:i}}function zne(r,e,t){if(t instanceof Ct)return[t];if(Array.isArray(t))return C.assert(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${r} keys ${e}.`),t;{let n=[];for(let o of e){if(t[o]==null)throw new re(`The feature data generated by the dataset lacks the required ${r} key '${o}'.`);n.push(t[o])}return n}}function yUe(r){if(r.length===3)throw new lt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function Wne(r,e,t){return M(this,null,function*(){let n=t.batchesPerEpoch!=null;if(C.assert(r.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),C.assert(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),C.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),C.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),C.assert(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0;try{let o=t.validationData!=null,s,i;if(o)if(Une(t.validationData))C.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{let g=yUe(t.validationData);s=g.xs,i=g.ys}let a=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),l;o?l=c.slice().concat(c.map(g=>"val_"+g)):l=c.slice();let u=gA(t.callbacks,t.yieldEvery),p=t.verbose==null?1:t.verbose,{callbackList:d,history:h}=yA(u,p,t.epochs,null,null,xUe(e,t),null,o,l);d.setModel(r),r.history=h,yield d.onTrainBegin(),r.stopTraining_=!1;let f=t.initialEpoch==null?0:t.initialEpoch,m=yield e.iterator();for(;f<t.epochs;){let g={};yield d.onEpochBegin(f);let y=0,x=0;for(n||(m=yield e.iterator());!n||y<t.batchesPerEpoch;){let b=yield m.next();if(n&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){let{xs:w,ys:_}=Gne(r,b.value),I={};I.batch=x,I.size=w[0].shape[0],yield d.onBatchBegin(x,I);let S=[];if(t.classWeight!=null){let L=kA(t.classWeight,r.outputNames);for(let B=0;B<L.length;++B)S.push(yield EA(_[B],null,L[B]))}let k=w.concat(_).concat(S),R=a(k);Xe(k);for(let L=0;L<c.length;++L){let B=c[L],z=R[L];I[B]=z,rn(z)}yield d.onBatchEnd(x,I),dA(I),x++,y++}if(n?y>=t.batchesPerEpoch:b.done){if(o){let w;Une(t.validationData)?w=vr(yield r.evaluateDataset(t.validationData,{batches:t.validationBatches})):w=vr(r.evaluate(s,i,{batchSize:t.validationBatchSize==null?gUe:t.validationBatchSize,verbose:0}));for(let _=0;_<r.metricsNames.length;++_)g[`val_${r.metricsNames[_]}`]=w[_]}break}if(r.stopTraining_)break}if(yield d.onEpochEnd(f,g),f++,r.stopTraining_)break}return yield d.onTrainEnd(),yield r.history.syncData(),r.history}finally{r.isTraining=!1}})}function xUe(r,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function Une(r){return typeof r.iterator=="function"}function vUe(r){return typeof r.next=="function"}function jne(r,e,t){return M(this,null,function*(){t=t||{};let n=t.batches!=null,o=r.testFunction,s=[];if(t.verbose>0)throw new lt("Verbose mode is not implemented yet.");C.assert(!n||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);let i=vUe(e)?e:yield e.iterator(),a=0,c=0;for(;!n||c<t.batches;){let l=yield i.next();if(s=ee(()=>{if(l.value){let{xs:u,ys:p}=Gne(r,l.value),d=u.concat(p),h=ee(()=>o(d));if(Xe(d),c===0)for(let m=0;m<h.length;++m)s.push(Oe(0));let f=d[0].shape[0];for(let m=0;m<h.length;++m){let g=h[m],y=s[m];s[m]=ee(()=>ae(s[m],W(f,g))),c>0&&Xe(y)}Xe(h),a+=f,++c}return s}),l.done){n&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<s.length;++l){let u=s[l];s[l]=Ce(s[l],a),Xe(u)}return No(s)})}function NA(r){C.assert(r>0&&Number.isInteger(r),()=>`batchSize is required to be a positive integer, but got ${r}`)}function Kb(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(n=>Bd(n,e,t-e)):Bd(r,e,t-e)}function DA(r,e){return ee(()=>r==null?null:Array.isArray(r)?r.map(t=>DA(t,e)):iA(r,e.dtype==="int32"?e:he(e,"int32")))}function AA(r,e){let t=[],n=0,o=null;for(;n<r;)o=n+e,o>=r&&(o=r),t.push([n,o]),n=o;return t}function KB(r){let e=[];r instanceof Ct&&(r=[r]);for(let t=0;t<r.length;++t){let n=r[t];if(n.rank===1)e.push(zd(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function Ja(r,e){if(r==null)return;let t=[];if(e instanceof Ct)t.push(e.id);else if(Array.isArray(e))e.forEach(o=>t.push(o.id));else if(e!=null)for(let o in e){let s=e[o];t.push(s.id)}let n=[];if(r instanceof Ct)t.indexOf(r.id)===-1&&n.push(r);else if(Array.isArray(r))r.forEach(o=>{t.indexOf(o.id)===-1&&n.push(o)});else if(r!=null)for(let o in r){let s=r[o];t.indexOf(s.id)===-1&&n.push(s)}n.forEach(o=>{o.isDisposed||o.dispose()})}function bUe(r){return r instanceof Ct}function XB(r){return Array.isArray(r)}function Hne(r){return!bUe(r)&&!XB(r)}function qne(r,e,t,n=!0,o=""){if(e==null||e.length===0){if(r!=null){let i=!1;if(XB(r)&&r.length>0)i=!0;else if(Hne(r)){for(let a in r)if(r.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new re(`Error when checking model ${o} expected no data, but got ${r}`)}return[]}if(r==null)return e.map(i=>null);let s;if(Hne(r)){r=r,s=[];for(let i of e){if(r[i]==null)throw new re(`No data provided for "${i}". Need data for each key in: ${e}`);s.push(r[i])}}else if(XB(r)){if(r=r,r.length!==e.length)throw new re(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${r}`);s=r}else{if(r=r,e.length>1)throw new re(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${r.shape}`);s=[r]}if(s=KB(s),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;let a=s[i];if(a.shape.length!==t[i].length)throw new re(`Error when checking ${o}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let c=0;c<t[i].length;++c){if(c===0&&!n)continue;let l=a.shape[c],u=t[i][c];if(u!=null&&u>=0&&l!==u)throw new re(`${o} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function wUe(r,e,t){let n=Ya(r.map(s=>s.shape[0]));n.sort();let o=Ya(e.map(s=>s.shape[0]));if(o.sort(),n.length>1)throw new re(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(r.map(s=>s.shape))}`);if(o.length>1)throw new re(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(n.length>0&&o.length>0&&!C.arraysEqual(n,o))throw new re(`Input Tensors should have the same number of samples as target Tensors. Found ${n[0]} input sample(s) and ${o[0]} target sample(s).`)}function CUe(r,e,t){let n=[_y,Hb,Sy];for(let o=0;o<r.length;++o){let s=r[o],i=e[o],a=t[o];if(i!=null){if(i===Sy&&s.shape[s.shape.length-1]===1)throw new re(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(n.indexOf(i)!==-1){let c=s.shape.slice(1),l=a.slice(1);for(let u=0;u<c.length;++u){let p=c[u],d=l[u];if(d!=null&&p!==d)throw new re(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Kne(r,e,t,n=!0,o=""){let s;if(Array.isArray(r)){if(r.length!==e.length)throw new re(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${r.length} Tensors(s).`);s=r}else{if(e.length>1)throw new re(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(r.shape)}.`);s=[r]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;let a=s[i];if(a.shape.length!==t[i].length)throw new re(`Error when checking ${o}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let c=0;c<t[i].length;++c){if(c===0&&!n)continue;let l=a.shape[c],u=t[i][c];if(u!=null&&u!==l)throw new re(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function _Ue(r,e){if(r==null||Array.isArray(r)&&r.length===0)return e.map(n=>[]);let t;if(typeof r=="string"||typeof r=="function")t=[r];else if(Array.isArray(r)||typeof r=="object")t=r;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${r}`);if(Array.isArray(t))return e.map(n=>t);{let n=[];for(let o of e){let s=t.hasOwnProperty(o)?t[o]:[];Array.isArray(s)||(s=[s]),n.push(s)}return n}}var SUe="layers-model",Wd=(()=>{class r extends TA{constructor(t){super(t),this.isTraining=!1}summary(t,n,o=console.log){if(!this.built)throw new re("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Lne(this,t,n,o)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=$ne(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Qo))throw new re("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(let a in t.loss)if(this.outputNames.indexOf(a)===-1)throw new re(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)t.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),n.push(vA(t.loss[a]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new re(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(c=>vA(c))}else{let a=vA(t.loss);this.outputs.forEach(c=>{n.push(a)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let c=this.internalOutputShapes[a],l=this.outputNames[a];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Dl("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let c=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([c,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let s=_Ue(t.metrics,this.outputNames),i=(a,c,l)=>{this.outputNames.length>1&&(c=this.outputNames[a]+"_"+c),this.metricsNames.push(c),this.metricsTensors.push([l,a])};Dl("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let c=s[a];(u=>{let p="",d,h,f;for(let m of u){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let y=this.internalOutputShapes[a];y[y.length-1]===1||this.lossFunctions[a]===Hb?["accuracy","acc"].indexOf(m)!==-1?h=wA:["crossentropy","ce"].indexOf(m)!==-1&&(h=GB):this.lossFunctions[a]===jb?["accuracy","acc"].indexOf(m)!==-1?h=WB:["crossentropy","ce"].indexOf(m)!==-1&&(h=jB):["accuracy","acc"].indexOf(m)!==-1?h=CA:["crossentropy","ce"].indexOf(m)!==-1&&(h=_A);let x;["accuracy","acc"].indexOf(m)!==-1?x="acc":["crossentropy","ce"].indexOf(m)!==-1&&(x="ce"),f=h,d=p+x}else f=Fne(m),d=p+H_(m);let g;Dl(d,()=>{g=f}),i(a,d,g)}})(c)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,o={}){let s=o.batchSize==null?32:o.batchSize;NA(s);let a=this.standardizeUserDataXY(t,n,!0,s);try{let c=a[0].concat(a[1]);this.makeTestFunction();let l=this.testFunction,u=this.testLoop(l,c,s,o.verbose,o.steps);return No(u)}finally{Ja(a[0],t),Ja(a[1],n)}}evaluateDataset(t,n){return M(this,null,function*(){return this.makeTestFunction(),jne(this,t,n)})}checkNumSamples(t,n,o,s="steps"){let i;if(o!=null){if(i=null,n!=null)throw new re(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?i=t[0].shape[0]:i=t.shape[0];else throw new re(`Either the input data should have a defined shape, or ${s} shoud be specified.`);return i}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new re("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(n),s=o?n:[n],i=this.retrieveSymbolicTensors(s),a=new Ep;if(t instanceof Ct&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new re(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)a.add(this.inputs[l],t[l])}else for(let l of this.inputs){let u=t[l.name];if(u==null)throw new re(`No value is provided for the model's input ${l.name}`);a.add(l,u)}let c=wy(i,a);return o?c:c[0]}retrieveSymbolicTensors(t){let n=Ka(null,t.length),o=t.length;for(let s of this.layers){let i=Array.isArray(s.output)?s.output:[s.output],a=i.map(c=>c.name);for(let c=0;c<t.length;++c){let l=a.indexOf(t[c]);if(l!==-1&&(n[c]=i[l],o--),o===0)break}if(o===0)break}if(o>0){let s=[];throw n.forEach((i,a)=>{i==null&&s.push(t[a])}),new re(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(s)}`)}return n}predictLoop(t,n=32,o=!1){return ee(()=>{let s=this.checkNumSamples(t);if(o)throw new lt("Verbose predictLoop() is not implemented yet.");let i=AA(s,n),a=this.outputs.map(c=>[]);for(let c=0;c<i.length;++c)ee(()=>{let u=i[c][0],p=i[c][1],d=Kb(t,u,p),h=[];if(Array.isArray(d))for(let m=0;m<d.length;++m)h.push({key:this.inputs[m],value:d[m]});else h.push({key:this.inputs[0],value:d});let f=new Ep(h);return wy(this.outputs,f)}).forEach((u,p)=>a[p].push(u));return No(a.map(c=>Xt(c,0)))})}predict(t,n={}){let o=KB(t);Kne(o,this.inputNames,this.feedInputShapes,!1);try{let s=n.batchSize==null?32:n.batchSize;return NA(s),this.predictLoop(o,s)}finally{Ja(o,t)}}predictOnBatch(t){Kne(t,this.inputNames,this.feedInputShapes,!0);let n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,o=!0,s){if(this.optimizer_==null)throw new As("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let i=[];for(let a=0;a<this.feedOutputShapes.length;++a){let c=this.feedOutputShapes[a];this.feedLossFns[a]===jb?i.push(c.slice(0,c.length-1).concat([1])):i.push(c)}if(t=qne(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=qne(n,this.feedOutputNames,i,!1,"target"),wUe(t,n,null),CUe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&s!=null&&s>0&&t[0].shape[0]%s!==0)throw new re(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}standardizeUserData(t,n,o,s,i=!0,a){return M(this,null,function*(){let[c,l]=this.standardizeUserDataXY(t,n,i,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(s!=null){let p=kA(s,this.outputNames);u=[];for(let d=0;d<p.length;++d)u.push(yield EA(l[d],null,p[d]))}return[c,l,u]})}testLoop(t,n,o,s=0,i){return ee(()=>{let a=this.checkNumSamples(n,o,i,"steps"),c=[];if(s>0)throw new lt("Verbose mode is not implemented yet.");if(i!=null)throw new lt("steps mode in testLoop() is not implemented yet");{let l=AA(a,o),u=Or(Os(0,a));for(let p=0;p<l.length;++p){let d=l[p][0],h=l[p][1],f=Bd(u,d,h-d),m=DA(n,f),g=t(m);if(p===0)for(let y=0;y<g.length;++y)c.push(Oe(0));for(let y=0;y<g.length;++y){let x=g[y];c[y]=ae(c[y],W(h-d,x))}}for(let p=0;p<c.length;++p)c[p]=Ce(c[p],a)}return c})}getDedupedMetricsNames(){let t=this.metricsNames,n=[];for(let o=0;o<t.length;++o){let s=t[o],i=s;if(kB(t,s)>1){let a=kB(t.slice(0,o),s);i+=`_${a}`}n.push(i)}return n}makeTrainFunction(){return t=>{let n=[],o=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],c=()=>{let d=[];for(let g=0;g<this.inputs.length;++g)d.push({key:this.inputs[g],value:o[g]});let h=new Ep(d),f=wy(this.outputs,h,{training:!0}),m;for(let g=0;g<this.lossFunctions.length;++g){let y=this.lossFunctions[g],x=y(s[g],f[g]);i[g]!=null&&(x=Bne(x,i[g]));let b=qr(x);n.push(b),g===0?m=x:m=ae(m,x)}for(let g=0;g<this.metricsTensors.length;++g){let y;if(this.outputs.length>1&&g<this.outputs.length)y=n[g];else{let x=this.metricsTensors[g][0],b=this.metricsTensors[g][1];y=qr(x(s[b],f[b]))}rn(y),a.push(y)}return m=qr(m),this.calculateLosses().forEach(g=>{m=ae(m,g)}),m},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(c,!0,l)].concat(a)}}makeTestFunction(){this.testFunction=t=>ee(()=>{let n=[],o,s=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:s[u]});let c=new Ep(a),l=wy(this.outputs,c);for(let u=0;u<this.lossFunctions.length;++u){let p=this.lossFunctions[u],d=qr(p(i[u],l[u]));u===0?o=d:o=ae(o,d),n.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let p=this.metricsTensors[u][0],d=this.metricsTensors[u][1],h=qr(p(i[d],l[d]));n.push(h)}return n})}fit(s,i){return M(this,arguments,function*(t,n,o={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let a,c,l,u,p,d,h,f,m;try{let g=o.batchSize==null?32:o.batchSize;NA(g);let x=yield this.standardizeUserData(t,n,o.sampleWeight,o.classWeight,!1,g);a=x[0],c=x[1],m=x[2];let b=!1,w;if(o.validationData!=null&&o.validationData.length>0){if(b=!0,o.validationData.length===2)p=o.validationData[0],d=o.validationData[1];else throw o.validationData.length===3?new lt("validationData including sample weights is not supported yet."):new re(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${o.validationData} is invalid.`);let q=yield this.standardizeUserData(p,d,null,null,!0,g);h=q[0],f=q[1],w=h.concat(f)}else if(o.validationSplit!=null&&o.validationSplit>0&&o.validationSplit<1){b=!0;let z=Math.floor(a[0].shape[0]*(1-o.validationSplit)),q=a[0].shape[0];h=Kb(a,z,q),l=a,a=Kb(a,0,z),f=Kb(c,z,q),u=c,c=Kb(c,0,z),w=h.concat(f)}else o.validationSteps!=null&&(b=!0);let _=a.concat(c).concat(m);this.checkTrainableWeightsConsistency();let I=this.makeTrainFunction(),S=this.getDedupedMetricsNames(),k,R;b?(this.makeTestFunction(),k=this.testFunction,R=S.slice().concat(S.map(z=>"val_"+z))):(k=null,w=[],R=S.slice());let L=gA(o.callbacks,o.yieldEvery);return yield this.fitLoop(I,_,S,g,o.epochs,o.verbose,L,k,w,o.shuffle,R,o.initialEpoch,null,null)}finally{this.isTraining=!1,Ja(a,t),Ja(c,n),Ja(l,t),Ja(u,n),Ja(h,p),Ja(f,d),m!=null&&Xe(m)}})}fitLoop(t,n,o,s,i,a,c,l,u,p,d,h,f,m){return M(this,null,function*(){s==null&&(s=32),i==null&&(i=1),p==null&&(p=!0),h==null&&(h=0);let g=!1;if(l!=null&&u!=null&&(g=!0),m!=null&&(g=!0,f==null))throw new re("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let y=this.checkNumSamples(n,s,f,"steps_per_epoch"),x;y!=null&&(x=Os(0,y)),a==null&&(a=1);let{callbackList:b,history:w}=yA(c,a,i,h,y,f,s,g,d);b.setModel(this),this.history=w,yield b.onTrainBegin(),this.stopTraining_=!1;for(let _=h;_<i;++_){yield b.onEpochBegin(_);let I={};if(f!=null)throw new lt("stepsPerEpoch mode is not implemented yet.");{if(p==="batch")throw new lt("batch shuffling is not implemneted yet");p&&C.shuffle(x);let S=Or(x),k=AA(y,s);for(let R=0;R<k.length;++R){let L={};if(yield b.onBatchBegin(R,L),ee(()=>{let B=k[R][0],z=k[R][1],q=Bd(S,B,z-B);L.batch=R,L.size=z-B;let U=DA(n,q),G=t(U);for(let j=0;j<o.length;++j){let X=o[j],te=G[j];L[X]=te,rn(te)}if(R===k.length-1&&g){let j=this.testLoop(l,u,s);for(let X=0;X<o.length;++X){let te=o[X],ne=j[X];rn(ne),I["val_"+te]=ne}}}),yield b.onBatchEnd(R,L),dA(L),this.stopTraining_)break}S.dispose()}if(yield b.onEpochEnd(_,I),this.stopTraining_)break}return yield b.onTrainEnd(),yield this.history.syncData(),this.history})}fitDataset(t,n){return M(this,null,function*(){return Wne(this,t,n)})}trainOnBatch(t,n){return M(this,null,function*(){let o=yield this.standardizeUserData(t,n),s=o[0],i=o[1],c=this.makeTrainFunction()(s.concat(i)),l=[];for(let u of c){let p=yield u.data();l.push(p[0])}return Xe(c),Ja(o[0],t),Ja(o[1],n),No(l)})}getNamedWeights(t){let n=[],o=t!=null&&t.trainableOnly,s=o?this.trainableWeights:this.weights,i=this.getWeights(o);for(let a=0;a<s.length;++a)o&&!s[a].trainable||n.push({name:s[a].originalName,tensor:i[a]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){let t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let n=t_().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-t_().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Xa(this.loss);else if(Array.isArray(this.loss)){for(let n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Xa(n))}else{let n=Object.keys(this.loss);t={};let o=this.loss;for(let s of n)if(typeof o[s]=="string")t[s]=Xa(o[s]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Xa(H_(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Xa(H_(t)));{let t={};for(let n in this.metrics)t[n]=Xa(H_(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let n=q_(t.optimizer_config),o=Vi(n),s;if(typeof t.loss=="string")s=Vd(t.loss);else if(Array.isArray(t.loss))s=t.loss.map(a=>Vd(a));else if(t.loss!=null){s={};for(let a in t.loss)s[a]=Vd(t.loss[a])}let i;if(Array.isArray(t.metrics))i=t.metrics.map(a=>Vd(a));else if(t.metrics!=null){i={};for(let a in t.metrics)i[a]=Vd(t.metrics[a])}this.compile({loss:s,metrics:i,optimizer:o})}save(t,n){return M(this,null,function*(){if(typeof t=="string"){let u=_l.getSaveHandlers(t);if(u.length===0)throw new re(`Cannot find any save handlers for URL '${t}'`);if(u.length>1)throw new re(`Found more than one (${u.length}) save handlers for URL '${t}'`);t=u[0]}if(t.save==null)throw new re("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=yield _l.encodeWeights(this.getNamedWeights(n)),c={modelTopology:this.toJSON(null,!1),format:SUe,generatedBy:`TensorFlow.js tfjs-layers v${qb}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){c.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:p,specs:d}=yield _l.encodeWeights(yield this.optimizer.getWeights(),u);o.specs.push(...d),o.data=_l.concatenateArrayBuffers([o.data,p])}return this.userDefinedMetadata!=null&&(qB(this.userDefinedMetadata,this.name,!0),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=o.data,c.weightSpecs=o.specs,t.save(c)})}setUserDefinedMetadata(t){qB(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}return r.className="Model",r})();fe.registerClass(Wd);var IUe=(()=>{class r extends Wd{}return r.className="Functional",r})();fe.registerClass(IUe);var YB=(()=>{class r extends Wd{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:dm("sequential_"),t.layers!=null)for(let n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new re(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){let n=t instanceof r||t instanceof Wd,o;if(n){if(o=t,o.outputs.length!==1)throw new re("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new re("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new re("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let s=BB({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(s)}if(n)this.outputs=o.outputs,this.inputs=o.inputs;else{if(t.inboundNodes.length!==1)throw new re(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new re("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=VB(this.outputs[0])}this.inboundNodes=[],new Ud({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ka(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(s=>s.shape),outputShapes:this.outputs[0].shape})}else{let s=t.apply(this.outputs[0]);if(Array.isArray(s))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[s],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(_t(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Wd({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,o=console.log){this.built||this.build(),super.summary(t,n,o)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,o={}){if(!this.built)throw new As("The model needs to be compiled before being used.");return this.model.evaluate(t,n,o)}evaluateDataset(t,n){return M(this,null,function*(){if(!this.built)throw new As("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)})}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}fit(s,i){return M(this,arguments,function*(t,n,o={}){if(!this.built)throw new As("The model needs to be compiled before being used.");return this.model.fit(t,n,o)})}fitDataset(t,n){return M(this,null,function*(){if(!this.built)throw new As("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)})}trainOnBatch(t,n){return M(this,null,function*(){return this.model.trainOnBatch(t,n)})}static fromConfig(t,n,o={},s=!1){let i,a={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new re("Legacy serialization format not supported yet.");i=n}else C.assert(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,a=n;let c=new t(a);if(!(c instanceof r))throw new lt(`Sequential.fromConfig called on non-Sequential input: ${c}`);for(let l of i){let p=Vi(l,void 0,s);s&&p.setFastWeightInitDuringBuild(!0),c.add(p)}return c}set stopTraining(t){if(this.model==null)throw new re("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new re("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let t=[];for(let n of this.layers){let o={};o.className=n.getClassName(),o.config=n.getConfig(),t.push(o)}return{name:this.name,layers:t}}}return r.className="Sequential",r})();fe.registerClass(YB);var Wo=class extends fe.Serializable{getConfig(){return{}}},kUe=(()=>{class r extends Wo{apply(t,n=1){return cne(t,n)}}return r.className="elu",r})();fe.registerClass(kUe);var EUe=(()=>{class r extends Wo{apply(t){return tb(t)}}return r.className="selu",r})();fe.registerClass(EUe);var NUe=(()=>{class r extends Wo{apply(t){return Go(t)}}return r.className="relu",r})();fe.registerClass(NUe);var DUe=(()=>{class r extends Wo{apply(t){return ee(()=>Js(6,Go(t)))}}return r.className="relu6",r})();fe.registerClass(DUe);var AUe=(()=>{class r extends Wo{apply(t){return t}}return r.className="linear",r})();fe.registerClass(AUe);var RUe=(()=>{class r extends Wo{apply(t){return co(t)}}return r.className="sigmoid",r})();fe.registerClass(RUe);var OUe=(()=>{class r extends Wo{apply(t){return une(t)}}return r.className="hardSigmoid",r})();fe.registerClass(OUe);var MUe=(()=>{class r extends Wo{apply(t){return wl(t)}}return r.className="softplus",r})();fe.registerClass(MUe);var FUe=(()=>{class r extends Wo{apply(t){return lne(t)}}return r.className="softsign",r})();fe.registerClass(FUe);var PUe=(()=>{class r extends Wo{apply(t){return bl(t)}}return r.className="tanh",r})();fe.registerClass(PUe);var QB=(()=>{class r extends Wo{apply(t,n=-1){return em(t,n)}}return r.className="softmax",r})();fe.registerClass(QB);var $Ue=(()=>{class r extends Wo{apply(t,n=-1){return Xv(t,n)}}return r.className="logSoftmax",r})();fe.registerClass($Ue);var LUe=(()=>{class r extends Wo{apply(t){return ee(()=>ee(()=>{let n=Math.sqrt(2),o=W(.5,ae(1,Kv(Ce(t,n))));return W(t,o)}))}}return r.className="gelu",r})();fe.registerClass(LUe);var VUe=(()=>{class r extends Wo{apply(t){return ee(()=>W(.5,W(t,ae(1,bl(W(Rr(Ce(2,Math.PI)),ae(t,W(.044715,Xo(t,3)))))))))}}return r.className="gelu_new",r})();fe.registerClass(VUe);var BUe=(()=>{class r extends Wo{apply(t){return ee(()=>W(t,bl(wl(t))))}}return r.className="mish",r})();fe.registerClass(BUe);var zUe=(()=>{class r extends Wo{apply(t,n=1){return ee(()=>W(co(W(t,n)),t))}}return r.className="swish",r})();fe.registerClass(zUe);function Rl(r){return r.getClassName()}function ZB(r,e={}){return Tp(r,fe.SerializationMap.getMap().classNameMap,e,"activation")}function Ol(r){if(r==null){let e={};return e.className="linear",e.config={},ZB(e)}if(typeof r=="string"){let e={};return e.className=r,e.config={},ZB(e)}else return r instanceof Wo?r:ZB(r)}function UUe(r){if(r!=null&&typeof r!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${r}`)}var RA=class extends fe.Serializable{},Zne=(()=>{class r extends RA{constructor(t){super(),UUe(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return ee(()=>{let n=Cr([1]);return this.hasL1&&(n=ae(n,Pe(W(this.l1,Qr(t))))),this.hasL2&&(n=ae(n,Pe(W(this.l2,vy(t))))),H(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}return r.className="L1L2",r})();fe.registerClass(Zne);var Xne={l1l2:"L1L2"};function _r(r){return Lb(r)}function Yne(r,e={}){return Tp(r,fe.SerializationMap.getMap().classNameMap,e,"regularizer")}function Br(r){if(r==null)return null;if(typeof r=="string"){let t={className:r in Xne?Xne[r]:r,config:{}};return Yne(t)}else return r instanceof RA?r:Yne(r)}var Qne=(()=>{class r extends ut{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=ot(t);let o=Go(t);return this.maxValue!=null&&(o=Zn(o,0,this.maxValue)),o}computeOutputShape(t){return t}getConfig(){let t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}return r.className="ReLU",r})();fe.registerClass(Qne);var Jne=(()=>{class r extends ut{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){let o=ot(t);return qf(o,this.alpha)}computeOutputShape(t){return t}getConfig(){let t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}return r.className="LeakyReLU",r})();fe.registerClass(Jne);var eoe=(()=>{class r extends ut{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=Mr(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Br(t.alphaRegularizer),this.alphaConstraint=vn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new re(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=_t(t);let n=t.slice(1);if(this.sharedAxes!=null)for(let s of this.sharedAxes)n[s-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let s=1;s<t.length;++s)o[s]=t[s];this.inputSpec=[new Vr({ndim:t.length,axes:o})],this.built=!0}call(t,n){return t=ot(t),Jf(t,this.alpha.read())}getConfig(){let t={alphaInitializer:Kr(this.alphaInitializer),alphaRegularizer:_r(this.alphaRegularizer),alphaConstraint:xn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}return r.className="PReLU",r})();fe.registerClass(eoe);var toe=(()=>{class r extends ut{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new lt(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){let o=ot(t);return xp(o)}computeOutputShape(t){return t}getConfig(){let t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}return r.className="ELU",r})();fe.registerClass(toe);var roe=(()=>{class r extends ut{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){let o=ot(t);return W(o,he(fn(o,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){let t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}return r.className="ThresholdedReLU",r})();fe.registerClass(roe);var noe=(()=>{class r extends ut{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new QB().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){return ee(()=>{let o=ot(t),s=n.mask;if(s!=null){let i=W(Te(Vn(o.shape),he(s,o.dtype)),Oe(-1e9));o=ae(o,i)}return this.axis instanceof Array?this.axis.length>1?nn(Te(o,Xf(o,this.axis,!0))):this.softmax(o,this.axis[0]):this.softmax(o,this.axis)})}computeOutputShape(t){return t}getConfig(){let t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Softmax",r})();fe.registerClass(noe);function mm(r,e,t){if(typeof r=="number")return Ka(r,e);if(r.length!==e)throw new re(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${r.length} elements.`);for(let n=0;n<e;++n){let o=r[n];if(!one(o))throw new re(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(r)} including a non-integer number ${o}`)}return r}function ti(r,e,t,n,o=1){if(r==null)return r;let s=e+(e-1)*(o-1),i;return t==="same"?i=r:i=r-s+1,Math.floor((i+n-1)/n)}function Ml(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+Al([t-e,0]);else if(n==="same")r=r*e;else throw new re(`Unsupport padding mode: ${n}.`);return r}function X_(r,e){return ee(()=>(sn(e),e==="channelsFirst"?kt(r,[0,2,3,1]):r))}function JB(r,e){return ee(()=>(sn(e),e==="channelsFirst"?kt(r,[0,2,3,4,1]):r))}function WUe(r,e,t,n=1,o="valid",s,i=1){return ee(()=>{if(s==null&&(s=Ms()),sn(s),r.shape.length!==3)throw new re(`The input of a conv1dWithBias operation should be 3, but is ${r.shape.length} instead.`);if(e.shape.length!==3)throw new re(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new re(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(r=kt(r,[0,2,1])),o==="causal")throw new lt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Gv(r,e,n,o==="same"?"same":"valid","NWC",i);return t!=null&&(a=Fs(a,t)),a})}function ooe(r,e,t,n=[1,1],o="valid",s,i,a=null){return ee(()=>{if(s==null&&(s=Ms()),sn(s),r.rank!==3&&r.rank!==4)throw new re(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${r.rank}.`);if(e.rank!==3&&e.rank!==4)throw new re(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${r.rank}.`);let c=X_(r,s);if(o==="causal")throw new lt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=nm.conv2d({x:c,filter:e,strides:n,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),s==="channelsFirst"&&(c=kt(c,[0,3,1,2])),c})}function jUe(r,e,t,n=[1,1,1],o="valid",s,i){return ee(()=>{if(s==null&&(s=Ms()),sn(s),r.rank!==4&&r.rank!==5)throw new re(`conv3dWithBias expects input to be of rank 4 or 5, but received ${r.rank}.`);if(e.rank!==4&&e.rank!==5)throw new re(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${r.rank}.`);let a=JB(r,s);if(o==="causal")throw new lt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=zk(a,e,n,o==="same"?"same":"valid","NDHWC",i),t!=null&&(a=Fs(a,t)),s==="channelsFirst"&&(a=kt(a,[0,4,1,2,3])),a})}var K_=class r extends ut{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",r.verifyArgs(t),this.rank=e,Fn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new lt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=mm(t.kernelSize,e,"kernelSize"),this.strides=mm(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Rs(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,sn(this.dataFormat),this.activation=Ol(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=Mr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=vn(t.biasConstraint),this.biasRegularizer=Br(t.biasRegularizer),this.activityRegularizer=Br(t.activityRegularizer),this.dilationRate=mm(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new re(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new re(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new re(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(ca("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!QD(e.kernelSize,"number",1,3))throw new re(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){let e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Rl(this.activation),useBias:this.useBias,biasInitializer:Kr(this.biasInitializer),biasRegularizer:_r(this.biasRegularizer),activityRegularizer:_r(this.activityRegularizer),biasConstraint:xn(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}},Xb=class r extends K_{constructor(e,t){super(e,t),this.kernel=null,r.verifyArgs(t),this.filters=t.filters,Fn(this.filters,"filters"),this.kernelInitializer=Mr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=vn(t.kernelConstraint),this.kernelRegularizer=Br(t.kernelRegularizer)}build(e){e=_t(e);let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new re(`The channel dimension of the input should be defined. Found ${e[t]}`);let n=e[t],o=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:n}}],this.built=!0}call(e,t){return ee(()=>{e=ot(e);let n,o=this.bias==null?null:this.bias.read(),s=JD(this.activation.getClassName());if(s!=null&&this.rank===2)n=ooe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)n=WUe(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)n=ooe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)n=jUe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new lt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(n=this.activation.apply(n))}return n})}computeOutputShape(e){e=_t(e);let t=[],n=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let s=0;s<n.length;++s){let i=ti(n[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);t.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(t),o.push(this.filters)):(o.push(this.filters),o=o.concat(t)),o}getConfig(){let e={filters:this.filters,kernelInitializer:Kr(this.kernelInitializer),kernelRegularizer:_r(this.kernelRegularizer),kernelConstraint:xn(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new re(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}},ez=(()=>{class r extends Xb{constructor(t){super(2,t),r.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!QD(t.kernelSize,"number",1,2))throw new re(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}return r.className="Conv2D",r})();fe.registerClass(ez);var tz=(()=>{class r extends Xb{constructor(t){super(3,t),r.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new re(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}return r.className="Conv3D",r})();fe.registerClass(tz);var soe=(()=>{class r extends ez{constructor(t){if(super(t),this.inputSpec=[new Vr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new re(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=_t(t),t.length!==4)throw new re("Input should have rank 4; Received input shape: "+JSON.stringify(t));let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new re("The channel dimension of the inputs should be defined. Found `None`.");let o=t[n],s=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vr({ndim:4,axes:{[n]:o}})],this.built=!0}call(t,n){return ee(()=>{let o=ot(t);if(o.shape.length!==4)throw new re(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let s=o.shape,i=s[0],a,c;this.dataFormat==="channelsFirst"?(a=2,c=3):(a=1,c=2);let l=s[a],u=s[c],p=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],f=this.strides[1],m=Ml(l,h,p,this.padding),g=Ml(u,f,d,this.padding),y=[i,m,g,this.filters];this.dataFormat!=="channelsLast"&&(o=kt(o,[0,2,3,1]));let x=jv(o,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=kt(x,[0,3,1,2])),this.bias!=null&&(x=Fs(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(t){t=_t(t);let n=t.slice(),o,s,i;this.dataFormat==="channelsFirst"?(o=1,s=2,i=3):(o=3,s=1,i=2);let a=this.kernelSize[0],c=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return n[o]=this.filters,n[s]=Ml(n[s],l,a,this.padding),n[i]=Ml(n[i],u,c,this.padding),n}getConfig(){let t=super.getConfig();return delete t.dilationRate,t}}return r.className="Conv2DTranspose",r})();fe.registerClass(soe);var ioe=(()=>{class r extends tz{constructor(t){if(super(t),this.inputSpec=[new Vr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new re(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=_t(t),t.length!==5)throw new re("Input should have rank 5; Received input shape: "+JSON.stringify(t));let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new re("The channel dimension of the inputs should be defined. Found `None`.");let o=t[n],s=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Vr({ndim:5,axes:{[n]:o}})],this.built=!0}call(t,n){return ee(()=>{let o=ot(t);if(o.shape.length!==5)throw new re(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let s=o.shape,i=s[0],a,c,l;this.dataFormat==="channelsFirst"?(l=2,a=3,c=4):(l=1,a=2,c=3);let u=s[l],p=s[a],d=s[c],h=this.kernelSize[0],f=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],y=this.strides[1],x=this.strides[2],b=Ml(u,g,h,this.padding),w=Ml(p,y,f,this.padding),_=Ml(d,x,m,this.padding),I=[i,b,w,_,this.filters];this.dataFormat!=="channelsLast"&&(o=kt(o,[0,2,3,4,1]));let S=Gk(o,this.kernel.read(),I,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=kt(S,[0,4,1,2,3])),this.bias!==null&&(S=Fs(S,this.bias.read(),this.dataFormat)),this.activation!==null&&(S=this.activation.apply(S)),S})}computeOutputShape(t){t=_t(t);let n=t.slice(),o,s,i,a;this.dataFormat==="channelsFirst"?(o=1,s=2,i=3,a=4):(o=4,s=1,i=2,a=3);let c=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],p=this.strides[0],d=this.strides[1],h=this.strides[2];return n[o]=this.filters,n[s]=Ml(n[s],p,c,this.padding),n[i]=Ml(n[i],d,l,this.padding),n[a]=Ml(n[a],h,u,this.padding),n}getConfig(){let t=super.getConfig();return delete t.dilationRate,t}}return r.className="Conv3DTranspose",r})();fe.registerClass(ioe);var HUe=(()=>{class r extends Xb{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new re("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new re("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new re(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Mr(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Br(n.depthwiseRegularizer),this.depthwiseConstraint=vn(n.depthwiseConstraint),this.pointwiseInitializer=Mr(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Br(n.pointwiseRegularizer),this.pointwiseConstraint=vn(n.pointwiseConstraint)}build(t){if(t=_t(t),t.length<this.rank+2)throw new re(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new re(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);let o=t[n],s=this.kernelSize.concat([o,this.depthMultiplier]),i=[];for(let c=0;c<this.rank;++c)i.push(1);i.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Vr({ndim:this.rank+2,axes:{[n]:o}})],this.built=!0}call(t,n){return ee(()=>{t=ot(t);let o;if(this.rank===1)throw new lt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=kt(t,[0,2,3,1])),o=rb(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=Fs(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=kt(o,[0,3,1,2])),o})}getConfig(){let t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Kr(this.depthwiseInitializer),t.pointwiseInitializer=Kr(this.pointwiseInitializer),t.depthwiseRegularizer=_r(this.depthwiseRegularizer),t.pointwiseRegularizer=_r(this.pointwiseRegularizer),t.depthwiseConstraint=xn(this.depthwiseConstraint),t.pointwiseConstraint=xn(this.pointwiseConstraint),t}}return r.className="SeparableConv",r})();var aoe=(()=>{class r extends HUe{constructor(t){super(2,t)}}return r.className="SeparableConv2D",r})();fe.registerClass(aoe);var coe=(()=>{class r extends Xb{constructor(t){super(1,t),r.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){let t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!QD(t.kernelSize,"number",1,1))throw new re(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}return r.className="Conv1D",r})();fe.registerClass(coe);var loe=(()=>{class r extends ut{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return ee(()=>{if(t=ot(t),this.dataFormat==="channelsLast"){let o=V_(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return V_(o,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=V_(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return V_(o,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Cropping2D",r})();fe.registerClass(loe);var uoe=(()=>{class r extends ut{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,sn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,rne(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){let n=t[2]==null?null:this.size[0]*t[2],o=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,o]}else{let n=t[1]==null?null:this.size[0]*t[1],o=t[2]==null?null:this.size[1]*t[2];return[t[0],n,o,t[3]]}}call(t,n){return ee(()=>{let o=ot(t),s=o.shape;if(this.dataFormat==="channelsFirst"){o=kt(o,[0,2,3,1]);let i=this.size[0]*s[2],a=this.size[1]*s[3],c=this.interpolation==="nearest"?Gn.resizeNearestNeighbor(o,[i,a]):Gn.resizeBilinear(o,[i,a]);return kt(c,[0,3,1,2])}else{let i=this.size[0]*s[1],a=this.size[1]*s[2];return this.interpolation==="nearest"?Gn.resizeNearestNeighbor(o,[i,a]):Gn.resizeBilinear(o,[i,a])}})}getConfig(){let t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}return r.className="UpSampling2D",r})();fe.registerClass(uoe);function qUe(r,e,t=[1,1],n="valid",o,s){return ee(()=>{o==null&&(o=Ms()),sn(o);let i=X_(r,o);if(r.rank!==4)throw new re(`Input for depthwiseConv2d is required to be 4-D, but is instead ${r.rank}-D`);if(e.rank!==4)throw new re(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=yp(i,e,t,n==="same"?"same":"valid","NHWC",s),o==="channelsFirst"&&(i=kt(i,[0,3,1,2])),i})}var poe=(()=>{class r extends K_{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Mr(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=vn(t.depthwiseConstraint),this.depthwiseRegularizer=Br(t.depthwiseRegularizer)}build(t){if(t=_t(t),t.length<4)throw new re(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);let n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new re(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);let o=t[n],s=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ee(()=>{t=ot(t);let o=qUe(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=Fs(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(t){t=_t(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],o=this.dataFormat==="channelsFirst"?t[3]:t[2],s=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=ti(n,this.kernelSize[0],this.padding,this.strides[0]),a=ti(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],s,i,a]:[t[0],i,a,s]}getConfig(){let t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Kr(this.depthwiseInitializer),t.depthwiseRegularizer=_r(this.depthwiseRegularizer),t.depthwiseConstraint=xn(this.depthwiseRegularizer),t}}return r.className="DepthwiseConv2D",r})();fe.registerClass(poe);function rz(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new re("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function o(s){return s==null||Array.isArray(s)?s:[s]}return e=o(e),t=o(t),{inputs:r,initialState:e,constants:t}}function nz(r,e,t,n=!1,o,s,i=!1,a=!1){return ee(()=>{let c=e.shape.length;if(c<3)throw new re(`Input should be at least 3D, but is ${c}D.`);let l=[1,0].concat(Os(2,c));if(e=kt(e,l),s!=null)throw new lt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=he(he(o,"bool"),"float32"),o.rank===c-1&&(o=Hr(o,-1)),o=kt(o,l)),n&&(e=Qn(e,0),o!=null&&(o=Qn(o,0)));let u=[],p,d=t,h=e.shape[0],f=eo(e),m;o!=null&&(m=eo(o));for(let y=0;y<h;++y){let x=f[y],b=ee(()=>r(x,d));if(o==null)p=b[0],d=b[1];else{let w=ee(()=>{let _=m[y],I=Te(lo(_),_),S=ae(W(b[0],_),W(d[0],I)),k=d.map((R,L)=>ae(W(b[1][L],_),W(R,I)));return{output:S,newStates:k}});p=w.output,d=w.newStates}a&&u.push(p)}let g;return a&&(g=mn(u,1)),[p,g,d]})}var ym=(()=>{class r extends ut{constructor(t){super(t);let n;if(t.cell==null)throw new re("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new iz({cells:t.cell}):n=t.cell,n.stateSize==null)throw new re("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Vr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Os(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){lA(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let o=n[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){let i=[];for(let a of n)i.push([t[0],a]);return[s].concat(i)}else return s}computeMask(t,n){return ee(()=>{Array.isArray(n)&&(n=n[0]);let o=this.returnSequences?n:null;if(this.returnState){let s=this.states.map(i=>null);return[o].concat(s)}else return o})}get states(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let o=0;o<t;++o)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new lt("Constants support is not implemented in RNN yet.");lA(t)&&(t=t[0]),t=t;let o=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new Vr({shape:[o,null,...s]});let i=[t[0]].concat(t.slice(2));this.cell.build(i);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!C.arraysEqual(this.stateSpec.map(c=>c.shape[c.shape.length-1]),a))throw new re(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(c=>new Vr({shape:[null,c]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){ee(()=>{if(!this.stateful)throw new aa("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new re("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Cr([o,s])):this.states_=[Cr([o,this.cell.stateSize])];else if(t==null)Xe(this.states_),this.keptStates!=null&&(Xe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(s=>Cr([o,s])):this.states_[0]=Cr([o,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new re(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):Xe(this.states_);for(let s=0;s<this.states_.length;++s){let i=t[s],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[s]:this.cell.stateSize,c=[o,a];if(!C.arraysEqual(i.shape,c))throw new re(`State ${s} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>rn(s.clone()))})}apply(t,n){let o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});let i=rz(t,o,s,this.numConstants);t=i.inputs,o=i.initialState,s=i.constants;let a=[],c=[];if(o!=null){n.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new Vr({shape:u.shape}));c=c.concat(this.stateSpec)}if(s!=null&&(n.constants=s,a=a.concat(s),this.numConstants=s.length),a[0]instanceof fs){let u=[t].concat(a),p=this.inputSpec.concat(c),d=this.inputSpec;this.inputSpec=p;let h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(t,n)}call(t,n){return ee(()=>{let o=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;t=ot(t),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(t));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==a)throw new re(`RNN Layer has ${a} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let c={training:s},u=nz((m,g)=>{let y=this.cell.call([m].concat(g),c);return[y[0],y.slice(1)]},t,i,this.goBackwards,o,null,this.unroll,this.returnSequences),p=u[0],d=u[1],h=u[2];this.stateful&&this.resetStates(h,s);let f=this.returnSequences?d:p;return this.returnState?[f].concat(h):f})}getInitialState(t){return ee(()=>{let n=Cr(t.shape);return n=Pe(n,[1,2]),n=zd(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?sA(n,[1,o]):n):this.cell.stateSize>1?[sA(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){let t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===r.className&&(n.cell={className:this.cell.getClassName(),config:o}),Object.assign(Object.assign(Object.assign({},o),t),n)}static fromConfig(t,n,o={}){let s=n.cell,i=Vi(s,o);return new t(Object.assign(n,{cell:i}))}}return r.className="RNN",r})();fe.registerClass(ym);var gm=class extends ut{},oz=(()=>{class r extends gm{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Fn(this.units,"units"),this.activation=Ol(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Mr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Br(t.kernelRegularizer),this.recurrentRegularizer=Br(t.recurrentRegularizer),this.biasRegularizer=Br(t.biasRegularizer),this.kernelConstraint=vn(t.kernelConstraint),this.recurrentConstraint=vn(t.recurrentConstraint),this.biasConstraint=vn(t.biasConstraint),this.dropout=xy([1,Al([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=xy([1,Al([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=_t(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ee(()=>{if(t=t,t.length!==2)throw new re(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let o=t[1];t=t[0];let s=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>lo(t),rate:this.dropout,training:s,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>lo(o),rate:this.recurrentDropout,training:s,dropoutFunc:this.dropoutFunc}));let i,a=this.dropoutMask,c=this.recurrentDropoutMask;a!=null?i=Qa(W(t,a),this.kernel.read()):i=Qa(t,this.kernel.read()),this.bias!=null&&(i=Fs(i,this.bias.read())),c!=null&&(o=W(o,c));let l=ae(i,Qa(o,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:Rl(this.activation),useBias:this.useBias,kernelInitializer:Kr(this.kernelInitializer),recurrentInitializer:Kr(this.recurrentInitializer),biasInitializer:Kr(this.biasInitializer),kernelRegularizer:_r(this.kernelRegularizer),recurrentRegularizer:_r(this.recurrentRegularizer),biasRegularizer:_r(this.biasRegularizer),activityRegularizer:_r(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}return r.className="SimpleRNNCell",r})();fe.registerClass(oz);var doe=(()=>{class r extends ym{constructor(t){t.cell=new oz(t),super(t)}call(t,n){return ee(()=>{this.cell.dropoutMask!=null&&(Xe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Xe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(t,{mask:o,training:s,initialState:i})})}static fromConfig(t,n){return new t(n)}}return r.className="SimpleRNN",r})();fe.registerClass(doe);var sz=(()=>{class r extends gm{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new re("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Fn(this.units,"units"),this.activation=Ol(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Ol(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Mr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Br(t.kernelRegularizer),this.recurrentRegularizer=Br(t.recurrentRegularizer),this.biasRegularizer=Br(t.biasRegularizer),this.kernelConstraint=vn(t.kernelConstraint),this.recurrentConstraint=vn(t.recurrentConstraint),this.biasConstraint=vn(t.biasConstraint),this.dropout=xy([1,Al([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=xy([1,Al([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=_t(t);let n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return ee(()=>{if(t=t,t.length!==2)throw new re(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);let o=n.training==null?!1:n.training,s=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>lo(t),rate:this.dropout,training:o,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>lo(s),rate:this.recurrentDropout,training:o,count:3,dropoutFunc:this.dropoutFunc}));let i=this.dropoutMask,a=this.recurrentDropoutMask,c,l,u;0<this.dropout&&this.dropout<1&&(t=W(t,i[0]));let p=Qa(t,this.kernel.read());this.useBias&&(p=Fs(p,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=W(s,a[0]));let d=this.recurrentKernel.read(),[h,f]=Jn(d,[2*this.units,this.units],d.rank-1),m=Qa(s,h),[g,y,x]=Jn(p,3,p.rank-1),[b,w]=Jn(m,2,m.rank-1);c=this.recurrentActivation.apply(ae(g,b)),l=this.recurrentActivation.apply(ae(y,w));let _=Qa(W(l,s),f);u=this.activation.apply(ae(x,_));let I=ae(W(c,s),W(ae(1,Rt(c)),u));return[I,I]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:Rl(this.activation),recurrentActivation:Rl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kr(this.kernelInitializer),recurrentInitializer:Kr(this.recurrentInitializer),biasInitializer:Kr(this.biasInitializer),kernelRegularizer:_r(this.kernelRegularizer),recurrentRegularizer:_r(this.recurrentRegularizer),biasRegularizer:_r(this.biasRegularizer),activityRegularizer:_r(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}return r.className="GRUCell",r})();fe.registerClass(sz);var hoe=(()=>{class r extends ym{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new sz(t),super(t)}call(t,n){return ee(()=>{this.cell.dropoutMask!=null&&(Xe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Xe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(t,{mask:o,training:s,initialState:i})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}return r.className="GRU",r})();fe.registerClass(hoe);var Y_=(()=>{class r extends gm{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Fn(this.units,"units"),this.activation=Ol(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=Ol(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=Mr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Mr(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Mr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=Br(t.kernelRegularizer),this.recurrentRegularizer=Br(t.recurrentRegularizer),this.biasRegularizer=Br(t.biasRegularizer),this.kernelConstraint=vn(t.kernelConstraint),this.recurrentConstraint=vn(t.recurrentConstraint),this.biasConstraint=vn(t.biasConstraint),this.dropout=xy([1,Al([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=xy([1,Al([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=_t(t);let o=t[t.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let s;if(this.useBias){if(this.unitForgetBias){let i=this.biasInitializer,a=this.units;s=new(n=class extends Ps{apply(l,u){let p=i.apply([a]),d=new cA().apply([a]),h=i.apply([a*2]);return RB(RB(p,d),h)}},n.className="CustomInit",n)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return ee(()=>{let o=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new re(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let s=t[1],i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>lo(t),rate:this.dropout,training:o,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>lo(s),rate:this.recurrentDropout,training:o,count:4,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,c=this.recurrentDropoutMask,l,u,p,d;0<this.dropout&&this.dropout<1&&(t=W(t,a[0]));let h=Qa(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=W(s,c[0])),h=ae(h,Qa(s,this.recurrentKernel.read())),this.useBias&&(h=Fs(h,this.bias.read()));let[f,m,g,y]=Jn(h,4,h.rank-1);l=this.recurrentActivation.apply(f),u=this.recurrentActivation.apply(m),p=ae(W(u,i),W(l,this.activation.apply(g))),d=this.recurrentActivation.apply(y);let x=W(d,this.activation.apply(p));return[x,x,p]})}getConfig(){let t=super.getConfig(),n={units:this.units,activation:Rl(this.activation),recurrentActivation:Rl(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Kr(this.kernelInitializer),recurrentInitializer:Kr(this.recurrentInitializer),biasInitializer:Kr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:_r(this.kernelRegularizer),recurrentRegularizer:_r(this.recurrentRegularizer),biasRegularizer:_r(this.biasRegularizer),activityRegularizer:_r(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),recurrentConstraint:xn(this.recurrentConstraint),biasConstraint:xn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}return r.className="LSTMCell",r})();fe.registerClass(Y_);var foe=(()=>{class r extends ym{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Y_(t),super(t)}call(t,n){return ee(()=>{this.cell.dropoutMask!=null&&(Xe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Xe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(t,{mask:o,training:s,initialState:i})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}return r.className="LSTM",r})();fe.registerClass(foe);var iz=(()=>{class r extends gm{constructor(t){super(t),this.cells=t.cells}get stateSize(){let t=[];for(let n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return ee(()=>{t=t;let o=t.slice(1),s=[];for(let c of this.cells.slice().reverse())Array.isArray(c.stateSize)?s.push(o.splice(0,c.stateSize.length)):s.push(o.splice(0,1));s.reverse();let i=[],a;for(let c=0;c<this.cells.length;++c){let l=this.cells[c];o=s[c],c===0?a=[t[0]].concat(o):a=[a[0]].concat(o),a=l.call(a,n),i.push(a.slice(1))}o=[];for(let c of i.slice().reverse())o.push(...c);return[a[0]].concat(o)})}build(t){lA(t)&&(t=t[0]),t=t;let n;this.cells.forEach((o,s)=>{Dl(`RNNCell_${s}`,()=>{o.build(t),Array.isArray(o.stateSize)?n=o.stateSize[0]:n=o.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){let t=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),s={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),s)}static fromConfig(t,n,o={}){let s=[];for(let i of n.cells)s.push(Vi(i,o));return new t({cells:s})}get trainableWeights(){if(!this.trainable)return[];let t=[];for(let n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let o of this.cells)n.push(...o.trainableWeights);return n.concat(t)}return t}getWeights(){let t=[];for(let n of this.cells)t.push(...n.weights);return z_(t)}setWeights(t){let n=[];for(let o of this.cells){let s=o.weights.length,i=t.splice(s);for(let a=0;a<o.weights.length;++a)n.push([o.weights[a],i[a]])}Wb(n)}}return r.className="StackedRNNCells",r})();fe.registerClass(iz);function jd(r){let{ones:e,rate:t,training:n=!1,count:o=1,dropoutFunc:s}=r,i=()=>s!=null?s(e(),t):aA(e(),t),a=()=>hm(i,e,n);return!o||o<=1?rn(a().clone()):Array(o).fill(void 0).map(a).map(l=>rn(l.clone()))}var KUe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o])&&(t[n[o]]=r[n[o]]);return t};var XUe=(()=>{class r extends ym{constructor(t){if(t.unroll)throw new lt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new lt("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Vr({ndim:5})]}call(t,n){return ee(()=>{if(this.cell.dropoutMask!=null&&(Xe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Xe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new re("ConvRNN2D cell does not support constants");let o=n==null?null:n.mask,s=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(t,{mask:o,training:s,initialState:i})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return ee(()=>{let{stateSize:n}=this.cell,o=t.shape,s=this.computeSingleOutputShape(o),i=[s[0],...s.slice(2)],a=Cr(i);return Array.isArray(n)?Array(n.length).fill(a):[a]})}resetStates(t,n=!1){ee(()=>{if(!this.stateful)throw new aa("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,s=this.computeSingleOutputShape(o),i=[s[0],...s.slice(2)];if(o[0]==null)throw new re("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Cr(i)):this.states_=[Cr(i)];else if(t==null)Xe(this.states_),this.keptStates!=null&&(Xe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Cr(i)):this.states_[0]=Cr(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new re(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):Xe(this.states_);for(let c=0;c<this.states_.length;++c){let l=t[c],u=i;if(!C.arraysEqual(l.shape,u))throw new re(`State ${c} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[c]=l}}this.states_=this.states_.map(c=>rn(c.clone()))})}computeSingleOutputShape(t){let{dataFormat:n,filters:o,kernelSize:s,padding:i,strides:a,dilationRate:c}=this.cell,l=n==="channelsFirst",u=t[l?3:2],p=t[l?4:3],d=ti(u,s[0],i,a[0],c[0]),h=ti(p,s[1],i,a[1],c[1]);return[...t.slice(0,2),...l?[o,d,h]:[d,h,o]]}}return r.className="ConvRNN2D",r})(),az=(()=>{class r extends Y_{constructor(t){let{filters:n,kernelSize:o,strides:s,padding:i,dataFormat:a,dilationRate:c}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,Fn(this.filters,"filters"),this.kernelSize=mm(o,2,"kernelSize"),this.kernelSize.forEach(l=>Fn(l,"kernelSize")),this.strides=mm(s||1,2,"strides"),this.strides.forEach(l=>Fn(l,"strides")),this.padding=i||"valid",Rs(this.padding),this.dataFormat=a||"channelsLast",sn(this.dataFormat),this.dilationRate=mm(c||1,2,"dilationRate"),this.dilationRate.forEach(l=>Fn(l,"dilationRate"))}build(t){var n;t=_t(t);let o=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[o]==null)throw new re(`The channel dimension of the input should be defined. Found ${t[o]}`);let s=t[o],i=4,a=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let c=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",c,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){let u=this.biasInitializer,p=this.filters;l=new(n=class extends Ps{apply(h,f){let m=u.apply([p]),g=Vn([p]),y=u.apply([p*2]);return Bb([m,g,y])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return ee(()=>{if(t.length!==3)throw new re(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let o=n.training||!1,s=t[0],i=t[1],a=t[2],c=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=jd({ones:()=>lo(s),rate:this.dropout,training:o,count:c,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,u=(le,xe,ge)=>!xe||!xe[ge]?le:W(xe[ge],le),p=u(s,l,0),d=u(s,l,1),h=u(s,l,2),f=u(s,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=jd({ones:()=>lo(i),rate:this.recurrentDropout,training:o,count:c,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,g=u(i,m,0),y=u(i,m,1),x=u(i,m,2),b=u(i,m,3),w=3,[_,I,S,k]=Jn(this.kernel.read(),c,w),[R,L,B,z]=this.useBias?Jn(this.bias.read(),c):[null,null,null,null];p=this.inputConv(p,_,R,this.padding),d=this.inputConv(d,I,L,this.padding),h=this.inputConv(h,S,B,this.padding),f=this.inputConv(f,k,z,this.padding);let[q,U,G,j]=Jn(this.recurrentKernel.read(),c,w);g=this.recurrentConv(g,q),y=this.recurrentConv(y,U),x=this.recurrentConv(x,G),b=this.recurrentConv(b,j);let X=this.recurrentActivation.apply(ae(p,g)),te=this.recurrentActivation.apply(ae(d,y)),ne=ae(W(te,a),W(X,this.activation.apply(ae(h,x)))),oe=W(this.recurrentActivation.apply(ae(f,b)),this.activation.apply(ne));return[oe,oe,ne]})}getConfig(){let t=super.getConfig(),{units:n}=t,o=KUe(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},o),s)}inputConv(t,n,o,s){let i=Ys(t,n,this.strides,s||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?Fs(i,o,this.dataFormat):i}recurrentConv(t,n){return Ys(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return r.className="ConvLSTM2DCell",r})();fe.registerClass(az);var moe=(()=>{class r extends XUe{constructor(t){let n=new az(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}return r.className="ConvLSTM2D",r})();fe.registerClass(moe);var cz=(()=>{class r extends ut{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;let n=t.shape,o=[];for(let s=0;s<this.noiseShape.length;++s)o.push(this.noiseShape[s]==null?n[s]:this.noiseShape[s]);return o}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);if(0<this.rate&&this.rate<1){let s=n.training==null?!1:n.training,i=this.getNoiseShape(o);return hm(()=>aA(o,this.rate,i,this.seed),()=>o,s)}return t})}getConfig(){let t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}return r.className="Dropout",r})();fe.registerClass(cz);var goe=(()=>{class r extends cz{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){let n=t.shape;return[n[0],1,n[2]]}}return r.className="SpatialDropout1D",r})();fe.registerClass(goe);var yoe=(()=>{class r extends ut{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,Fn(this.units,"units"),this.activation=Ol(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=Mr(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Mr(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=vn(t.kernelConstraint),this.biasConstraint=vn(t.biasConstraint),this.kernelRegularizer=Br(t.kernelRegularizer),this.biasRegularizer=Br(t.biasRegularizer),this.activityRegularizer=Br(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=_t(t);let n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=_t(t);let n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t),s=JD(this.activation.getClassName()),i;return s!=null?i=Qa(o,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Qa(o,this.kernel.read()),this.bias!=null&&(i=Fs(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){let t={units:this.units,activation:Rl(this.activation),useBias:this.useBias,kernelInitializer:Kr(this.kernelInitializer),biasInitializer:Kr(this.biasInitializer),kernelRegularizer:_r(this.kernelRegularizer),biasRegularizer:_r(this.biasRegularizer),activityRegularizer:_r(this.activityRegularizer),kernelConstraint:xn(this.kernelConstraint),biasConstraint:xn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Dense",r})();fe.registerClass(yoe);var xoe=(()=>{class r extends ut{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=_t(t);for(let n of t.slice(1))if(n==null)throw new re(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Za(t,1)]}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);if(this.dataFormat==="channelsFirst"&&o.rank>1){let s=[0];for(let i=2;i<o.rank;++i)s.push(i);s.push(1),o=kt(o,s)}return ane(o)})}getConfig(){let t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);let n=super.getConfig();return Object.assign(t,n),t}}return r.className="Flatten",r})();fe.registerClass(xoe);var voe=(()=>{class r extends ut{constructor(t){super(t),this.supportsMasking=!0,this.activation=Ol(t.activation)}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);return this.activation.apply(o)})}getConfig(){let t={activation:Rl(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Activation",r})();fe.registerClass(voe);var boe=(()=>{class r extends ut{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return ee(()=>(t=ot(t),sne(t,this.n)))}getConfig(){let t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}return r.className="RepeatVector",r})();fe.registerClass(boe);var woe=(()=>{class r extends ut{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){let o="Total size of new array must be unchanged.",s=n.slice(),i=1,a=null;for(let l=0;l<s.length;++l){let u=s[l];if(this.isUnknown(u))if(a===null)a=l;else throw new re("Can only specifiy one unknown dimension.");else i*=u}let c=Za(t);if(a!==null){if(i===0||c%i!==0)throw new re(o);s[a]=c/i}else if(c!==i)throw new re(o);return s}computeOutputShape(t){let n=!1;for(let o=0;o<t.length;++o)if(this.isUnknown(t[o])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t),s=o.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return H(o,i)})}getConfig(){let t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Reshape",r})();fe.registerClass(woe);var Coe=(()=>{class r extends ut{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);let n=Os(1,t.dims.length+1);if(!C.arraysEqual(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Vr({ndim:this.dims.length+1})]}computeOutputShape(t){t=_t(t);let n=t.slice();return this.dims.forEach((o,s)=>{n[s+1]=t[o]}),n}call(t,n){return kt(ot(t),this.dimsIncludingBatch)}getConfig(){let t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Permute",r})();fe.registerClass(Coe);var _oe=(()=>{class r extends ut{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){let o=ot(t);return Kg(Cl(o,this.maskValue),-1)}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t),a=Kg(Cl(o,this.maskValue),-1,!0);return W(o,he(a,o.dtype))})}}return r.className="Masking",r})();fe.registerClass(_oe);var Soe=(()=>{class r extends ut{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(vr(t.inputLength))}this.inputDim=t.inputDim,Fn(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Fn(this.outputDim,"outputDim"),this.embeddingsInitializer=Mr(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Br(t.embeddingsRegularizer),this.activityRegularizer=Br(t.activityRegularizer),this.embeddingsConstraint=vn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return ee(()=>this.maskZero?(t=ot(t),Cl(t,nt(t))):null)}computeOutputShape(t){if(t=_t(t),this.inputLength==null)return[...t,this.outputDim];let n=vr(this.inputLength);if(n.length!==t.length-1)throw new re(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let o=0;for(let s=0;s<n.length;++s){let i=n[s],a=t[s+1];if(i!=null&&a!=null&&i!==a)throw new re(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);i==null&&(n[o]=a),o++}}return[t[0],...n,this.outputDim]}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);o.dtype!=="int32"&&(o=hs(o,"int32"));let s=iA(this.embeddings.read(),H(o,[o.size]));return H(s,_t(this.computeOutputShape(o.shape)))})}getConfig(){let t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Kr(this.embeddingsInitializer),embeddingsRegularizer:_r(this.embeddingsRegularizer),activityRegularizer:_r(this.activityRegularizer),embeddingsConstraint:xn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Embedding",r})();fe.registerClass(Soe);var Hd=class extends ut{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new lt}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;let n=e.slice(0,e.length-t.length);for(let o=0;o<t.length;++o){let s=e[e.length-t.length+o],i=t[o];if(s==null||i==null||s<0||i<0)n.push(null);else if(s===1)n.push(i);else if(i===1)n.push(s);else{if(s!==i)throw new re("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(s)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[_t(e)]),e=e,e.length<2)throw new re(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(let s of e)s!=null&&s[0]!==null&&t.push(s[0]);if(t=Ya(t),t.length>1)throw new re(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let s=1;s<e.length;++s){let i=e[s]==null?null:e[s].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let o=e.map(s=>s.length);e.indexOf(null)===-1&&Ya(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ee(()=>{if(e=e,this.reshapeRequired){let n=[],o=e.map(s=>s.rank);if(o.indexOf(null)===-1){let s=Al(o);for(let i of e){let a=i.rank;for(let c=0;c<s-a;++c)i=zd(i,1);n.push(i)}return this.mergeFunction(n)}else{let s=!1;for(let c of e){let l=c.rank;if(l==null){let u=c.shape,p=u[0],d=u.slice(1).concat([p]),h=H(c,[p].concat(Za(u.slice(1))));h=kt(h,[1,0]),h=H(h,d),n.push(h),s=!0}else if(l>1){let u=Os(1,l).concat([0]);n.push(kt(c,u)),s=!0}else n.push(c)}let i=this.mergeFunction(n),a=i.rank;if(s){if(a==null){let c=i.shape,l=c.length,u=c[l-1],p=[u].concat(c.slice(0,c.length-1));i=H(kt(H(i,[-1,u]),[1,0]),p)}else if(a>1){let c=[a-1].concat(Os(0,a-1));i=kt(i,c)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let o=1;o<e.length;++o){let s=e[o]==null?null:e[o].slice(1);t=this.computeElementwiseOpOutputShape(t,s)}let n=[];for(let o of e)o!=null&&o[0]!==null&&n.push(o[0]);return n=Ya(n),n.length===1?t=n.concat(t):t=[null].concat(t),t}computeMask(e,t){return ee(()=>{if(t==null)return null;if(!Array.isArray(t))throw new re("`mask` should be an Array");if(!Array.isArray(e))throw new re("`inputs` should be an Array");if(t.length!==e.length)throw new re(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(o=>o==null))return null;t=t.map(o=>o==null?o:Hr(o,0));let n=t[0];for(let o=1;o<t.length-1;++o)n=Yo(n,t[o]);return n})}},Ioe=(()=>{class r extends Hd{constructor(t){super(t)}mergeFunction(t){return ee(()=>{let n=t[0].clone();for(let o=1;o<t.length;++o)n=ae(n,t[o]);return n})}}return r.className="Add",r})();fe.registerClass(Ioe);var Toe=(()=>{class r extends Hd{constructor(t){super(t)}mergeFunction(t){return ee(()=>{let n=t[0].clone();for(let o=1;o<t.length;++o)n=W(n,t[o]);return n})}}return r.className="Multiply",r})();fe.registerClass(Toe);var koe=(()=>{class r extends Hd{constructor(t){super(t)}mergeFunction(t){return ee(()=>{let n=t[0].clone();for(let o=1;o<t.length;++o)n=ae(n,t[o]);return W(1/t.length,n)})}}return r.className="Average",r})();fe.registerClass(koe);var Eoe=(()=>{class r extends Hd{constructor(t){super(t)}mergeFunction(t){return ee(()=>{let n=t[0];for(let o=1;o<t.length;++o)n=Qs(n,t[o]);return n})}}return r.className="Maximum",r})();fe.registerClass(Eoe);var Noe=(()=>{class r extends Hd{constructor(t){super(t)}mergeFunction(t){return ee(()=>{let n=t[0];for(let o=1;o<t.length;++o)n=Js(n,t[o]);return n})}}return r.className="Minimum",r})();fe.registerClass(Noe);var Doe=(()=>{class r extends Hd{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new re("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(let s of t)if(s!=null){n=!1;break}if(n)return;let o=[];for(let s=0;s<t.length;++s){let i=t[s].slice();i.splice(this.axis,1);let a=!1;for(let c of o)if(C.arraysEqual(c,i)){a=!0;break}a||o.push(i)}if(o.length>1)throw new re("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return ee(()=>Bb(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new re("A `Concatenate` layer should be called on a list of inputs.");let n=t,o=n[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;for(let i of n.slice(1)){if(o[s]==null||i[s]==null){o[s]=null;break}o[s]+=i[s]}return o}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new re("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new re("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new re(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return ee(()=>{let o=!0;if(n.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let s=[];for(let a=0;a<t.length;++a)n[a]==null?s.push(he(lo(t[a]),"bool")):n[a].rank<t[a].rank?s.push(Hr(n[a],-1)):s.push(n[a]);let i=Xt(s,this.axis);return zv(i,-1,!1)})}getConfig(){let t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Concatenate",r})();fe.registerClass(Doe);function Z_(r,e){for(;r<0;)r+=e;return r}function YUe(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new lt("batchDot is not implemented for tensors of 4D or higher rank yet");if(C.assert(r.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${r.shape.length}`),C.assert(r.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new lt("batchDot is not implemented for complex64-type Tensors yet.");let n=r.shape.length,o=e.shape.length;t==null&&(t=[n-1,o-2]);let s=t;return ee(()=>{let i;if(n>o){i=n-o;let c=[];for(let l=0;l<i;++l)c.push(1);e=H(e,e.shape.concat(c))}else if(o>n){i=o-n;let c=[];for(let l=0;l<i;++l)c.push(1);r=H(r,r.shape.concat(c))}else i=0;let a;if(r.shape.length===2&&e.shape.length===2)s[0]===s[1]?a=Pe(W(r,e),s[0]):a=Pe(W(kt(r,[1,0]),e),s[1]);else{let c=s[0]!==r.shape.length-1,l=s[1]===e.shape.length-1;a=Tt(r,e,c,l)}if(i>0){let c;n>o?c=n+o-3:c=n-1;let l=[];for(let u=c;u<c+i;++u)l.push(u);a=Jt(a,l)}return a.shape.length===1&&(a=Hr(a,1)),a})}var Aoe=(()=>{class r extends Hd{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){C.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let n=t[0],o=t[1];if(n.length>3||o.length>3)throw new lt("Dot layer does not support tensors of 4D or higher rank yet.");let s=this.interpretAxes(n,o);if(n[s[0]]!==o[s[1]])throw new re(`Dimension incompatibility: ${n[s[0]]} !== ${o[s[1]]}`)}mergeFunction(t){if(t.length!==2)throw new re(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],o=t[1],s;return Array.isArray(this.axes)?s=this.axes.map((i,a)=>Z_(i,t[a].shape.length)):s=[Z_(this.axes,n.shape.length),Z_(this.axes,o.shape.length)],this.normalize&&(n=U_(n,s[0]),o=U_(o,s[1])),YUe(n,o,s)}interpretAxes(t,n){let o;return Array.isArray(this.axes)?o=this.axes:o=[Z_(this.axes,t.length),Z_(this.axes,n.length)],o}computeOutputShape(t){C.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let n=t[0].slice(),o=t[1].slice();if(n.length>3||o.length>3)throw new lt("Dot layer does not support tensors of 4D or higher rank yet.");let s=this.interpretAxes(n,o);n.splice(s[0],1),o.splice(s[1],1),o.splice(0,1);let i=n.concat(o);return i.length===1&&i.push(1),i}computeMask(t,n){return null}getConfig(){let t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}return r.className="Dot",r})();fe.registerClass(Aoe);var Roe=(()=>{class r extends ut{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);return hm(()=>ae(zb(o.shape,0,this.stddev),o),()=>o,n.training||!1)})}}return r.className="GaussianNoise",r})();fe.registerClass(Roe);var Ooe=(()=>{class r extends ut{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return ee(()=>{this.invokeCallHook(t,n);let o=ot(t);return this.rate>0&&this.rate<1?hm(()=>{let i=Math.sqrt(this.rate/(1-this.rate));return W(o,zb(o.shape,1,i))},()=>o,n.training||!1):o})}}return r.className="GaussianDropout",r})();fe.registerClass(Ooe);var Moe=(()=>{class r extends ut{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||ot(t).shape}computeOutputShape(t){return t}getConfig(){let t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return ee(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(t);return hm(()=>{let i=ot(t),l=-1.6732632423543772*1.0507009873554805,u=Es(Ai(o),this.rate);u=hs(u,"float32");let p=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-p*l*this.rate,h=ae(W(i,u),W(ae(u,-1),l));return ae(W(h,p),d)},()=>ot(t),n.training||!1)}return t})}}return r.className="AlphaDropout",r})();fe.registerClass(Moe);function Q_(r,e,t,n,o,s=.001){let i;if(r.rank===2)i=Rk(r,e,t,n,o,s);else if(r.rank===3)i=Ok(r,e,t,n,o,s);else if(r.rank===4)i=Mk(r,e,t,n,o,s);else throw new lt(`batchNormalization is not implemented for array of rank ${r.rank} yet`);return i}function ZUe(r,e,t,n,o=.001){return ee(()=>{let s=Qg(r,n),i=s.mean,a=s.variance;return[Q_(r,i,a,t,e,o),i,a]})}function QUe(r,e,t,n,o=.001){return ee(()=>{let s=Qg(r,n),i=s.mean,a=s.variance,c=[];for(let f of Os(0,r.rank))n.indexOf(f)!==-1?c.push(1):c.push(r.shape[f]);let l=H(i,c),u=H(a,c),p=e==null?null:H(e,c),d=t==null?null:H(t,c);return[Q_(r,l,u,d,p,o),i,a]})}function JUe(r,e,t,n,o=.001){return C.arraysEqual(n.slice().sort(),Os(0,r.rank-1))?ZUe(r,e,t,n,o):QUe(r,e,t,n,o)}var Foe=(()=>{class r extends ut{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=Mr(t.betaInitializer||"zeros"),this.gammaInitializer=Mr(t.gammaInitializer||"ones"),this.movingMeanInitializer=Mr(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Mr(t.movingVarianceInitializer||"ones"),this.betaConstraint=vn(t.betaConstraint),this.gammaConstraint=vn(t.gammaConstraint),this.betaRegularizer=Br(t.betaRegularizer),this.gammaRegularizer=Br(t.gammaRegularizer)}build(t){t=_t(t);let n=this.axis>=0?this.axis:this.axis+t.length,o=t[n];if(o==null)throw new re(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Vr({ndim:t.length,axes:{[n]:o}})];let s=[o];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return ee(()=>{let o=n.training==null?!1:n.training,s=ot(t),i=s.shape,a=i.length,c=Os(0,a),l=this.axis>=0?this.axis:this.axis+a;c.splice(l,1);let u=Ka(1,a);u[l]=i[l];let p=c.slice();p.sort();let d=!C.arraysEqual(p,Os(0,a).slice(0,a-1)),h=()=>{if(d){let b=H(this.movingMean.read(),u),w=H(this.movingVariance.read(),u),_=this.center?H(this.beta.read(),u):null,I=this.scale?H(this.gamma.read(),u):null;return Q_(s,b,w,_,I,this.epsilon)}else return Q_(s,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return h();let[f,m,g]=JUe(s,this.gamma.read(),this.beta.read(),c,this.epsilon),y=(b,w,_)=>{ee(()=>{let I=1-_,S=b.read(),k=W(Te(S,w),I);b.write(Te(S,k))})};return(()=>{y(this.movingMean,m,this.momentum),y(this.movingVariance,g,this.momentum)})(),f})}getConfig(){let t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kr(this.betaInitializer),gammaInitializer:Kr(this.gammaInitializer),movingMeanInitializer:Kr(this.movingMeanInitializer),movingVarianceInitializer:Kr(this.movingVarianceInitializer),betaRegularizer:_r(this.betaRegularizer),gammaRegularizer:_r(this.gammaRegularizer),betaConstraint:xn(this.betaConstraint),gammaConstraint:xn(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}return r.className="BatchNormalization",r})();fe.registerClass(Foe);var Poe=(()=>{class r extends ut{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=Mr(t.betaInitializer||"zeros"),this.gammaInitializer=Mr(t.gammaInitializer||"ones"),this.betaRegularizer=Br(t.betaRegularizer),this.gammaRegularizer=Br(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=_t(t);let n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(let i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Ya(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(i=>t[i]),s=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(t,n){let o=ot(t),s=o.shape,i=s.length;return ee(()=>{let{mean:c,variance:l}=Qg(o,this.axis,!0),u=Ka(1,i);for(let g of this.axis)u[g]=s[g];let p=g=>g!=null&&g.shape.length!==i?H(g,u):g,d=this.scale?p(this.gamma.read()):null,h=this.center?p(this.beta.read()):null,f=[],m=[];for(let g=0;g<i;++g)this.axis.indexOf(g)!==-1?(f.push(s[g]),m.push(1)):(f.push(1),m.push(s[g]));return c=Uo(c,f),l=Uo(l,f),d!=null&&(d=Uo(d,m)),h!=null&&(h=Uo(h,m)),Q_(o,c,l,h,d,this.epsilon)})}getConfig(){let t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Kr(this.betaInitializer),gammaInitializer:Kr(this.gammaInitializer),betaRegularizer:_r(this.betaRegularizer),gammaRegularizer:_r(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}return r.className="LayerNormalization",r})();fe.registerClass(Poe);function eGe(r,e,t){return ee(()=>{if(r.rank!==4)throw new re(`temporalPadding expects input tensor to be 4-D, but received a ${r.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new re("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ms()),t!=="channelsLast"&&t!=="channelsFirst")throw new re(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],ko(r,n)})}var $oe=(()=>{class r extends ut{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?Ms():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new re(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,o;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],o=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new re(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new re(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);o=t.padding[1]}this.padding=[n,o]}this.inputSpec=[new Vr({ndim:4})]}computeOutputShape(t){t=_t(t);let n,o;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?o=t[3]+this.padding[1][0]+this.padding[1][1]:o=null,[t[0],t[1],n,o]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?o=t[2]+this.padding[1][0]+this.padding[1][1]:o=null,[t[0],n,o,t[3]])}call(t,n){return ee(()=>eGe(ot(t),this.padding,this.dataFormat))}getConfig(){let t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}return r.className="ZeroPadding2D",r})();fe.registerClass($oe);function LA(r,e,t,n,o,s){return ee(()=>{sn(o),EB(s),Rs(n),t==null&&(t=[1,1]),n==null&&(n="valid"),o==null&&(o=Ms()),s==null&&(s="max"),r=X_(r,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=Zf(r,e,t,a):i=Uf(r,e,t,a),o==="channelsFirst"&&(i=kt(i,[0,3,1,2])),i})}function Loe(r,e,t,n,o,s){return ee(()=>{sn(o),EB(s),Rs(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),o==null&&(o=Ms()),s==null&&(s="max"),r=JB(r,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=nE(r,e,t,a):i=Ak(r,e,t,a),o==="channelsFirst"&&(i=kt(i,[0,4,1,2,3])),i})}var OA=class extends ut{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new re(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Fn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new re(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Rs(this.padding),this.inputSpec=[new Vr({ndim:3})]}computeOutputShape(e){e=_t(e);let t=ti(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ee(()=>{this.invokeCallHook(e,t),e=zd(ot(e),2);let n=this.poolingFunction(ot(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Jt(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}},Voe=(()=>{class r extends OA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),LA(t,n,o,s,i,"max")}}return r.className="MaxPooling1D",r})();fe.registerClass(Voe);var Boe=(()=>{class r extends OA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),LA(t,n,o,s,i,"avg")}}return r.className="AveragePooling1D",r})();fe.registerClass(Boe);var MA=class extends ut{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new re(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Fn(this.poolSize,"poolSize"),Fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),Rs(this.padding),this.inputSpec=[new Vr({ndim:4})]}computeOutputShape(e){e=_t(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=ti(t,this.poolSize[0],this.padding,this.strides[0]),n=ti(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return ee(()=>(this.invokeCallHook(e,t),this.poolingFunction(ot(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},zoe=(()=>{class r extends MA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),LA(t,n,o,s,i,"max")}}return r.className="MaxPooling2D",r})();fe.registerClass(zoe);var Uoe=(()=>{class r extends MA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),LA(t,n,o,s,i,"avg")}}return r.className="AveragePooling2D",r})();fe.registerClass(Uoe);var FA=class extends ut{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new re(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Fn(this.poolSize,"poolSize"),Fn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),Rs(this.padding),this.inputSpec=[new Vr({ndim:5})]}computeOutputShape(e){e=_t(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=ti(t,this.poolSize[0],this.padding,this.strides[0]),n=ti(n,this.poolSize[1],this.padding,this.strides[1]),o=ti(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n,o]:[e[0],t,n,o,e[4]]}call(e,t){return ee(()=>(this.invokeCallHook(e,t),this.poolingFunction(ot(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},Goe=(()=>{class r extends FA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),Loe(t,n,o,s,i,"max")}}return r.className="MaxPooling3D",r})();fe.registerClass(Goe);var Woe=(()=>{class r extends FA{constructor(t){super(t)}poolingFunction(t,n,o,s,i){return sn(i),Rs(s),Loe(t,n,o,s,i,"avg")}}return r.className="AveragePooling3D",r})();fe.registerClass(Woe);var PA=class extends ut{constructor(e){super(e),this.inputSpec=[new Vr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new lt}},joe=(()=>{class r extends PA{constructor(t){super(t||{})}call(t,n){return ee(()=>{let o=ot(t);return qr(o,1)})}}return r.className="GlobalAveragePooling1D",r})();fe.registerClass(joe);var Hoe=(()=>{class r extends PA{constructor(t){super(t||{})}call(t,n){return ee(()=>{let o=ot(t);return Io(o,1)})}}return r.className="GlobalMaxPooling1D",r})();fe.registerClass(Hoe);var $A=class extends ut{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),this.inputSpec=[new Vr({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new lt}getConfig(){let e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},qoe=(()=>{class r extends $A{call(t,n){return ee(()=>{let o=ot(t);return this.dataFormat==="channelsLast"?qr(o,[1,2]):qr(o,[2,3])})}}return r.className="GlobalAveragePooling2D",r})();fe.registerClass(qoe);var Koe=(()=>{class r extends $A{call(t,n){return ee(()=>{let o=ot(t);return this.dataFormat==="channelsLast"?Io(o,[1,2]):Io(o,[2,3])})}}return r.className="GlobalMaxPooling2D",r})();fe.registerClass(Koe);var VA=class extends ut{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){let o=t.layer,s=Vi(o,n);delete t.layer;let i={layer:s};return Object.assign(i,t),new e(i)}},Xoe=(()=>{class r extends VA{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=_t(t),t.length<3)throw new re(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];let n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=_t(t);let n=[t[0]].concat(t.slice(2)),o=this.layer.computeOutputShape(n),s=t[1];return[o[0],s].concat(o.slice(1))}call(t,n){return ee(()=>(t=ot(t),nz((a,c)=>[ot(this.layer.call(a,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}return r.className="TimeDistributed",r})();fe.registerClass(Xoe);function tGe(r){kp(ene,"BidirectionalMergeMode",r)}var rGe="concat",Yoe=(()=>{class r extends VA{constructor(t){super(t);let n=t.layer.getConfig(),o={};o.className=t.layer.getClassName(),o.config=n,this.forwardLayer=Vi(o),n.goBackwards=n.goBackwards!==!0;let s={};if(s.className=t.layer.getClassName(),s.config=n,this.backwardLayer=Vi(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?rGe:t.mergeMode,tGe(this.mergeMode),t.weights)throw new lt("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){let n=t.length,o=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,o)),this.backwardLayer.setWeights(t.slice(o))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let o,s,i;return this.returnState&&(i=n.slice(1)),o=n[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,s=[o]):this.mergeMode==null?s=[o,o.slice()]:s=[o],this.returnState?this.mergeMode==null?s.concat(i).concat(i.slice()):[o].concat(i).concat(i.slice()):No(s)}apply(t,n){let o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});let i=rz(t,o,s,this.numConstants);if(t=i.inputs,o=i.initialState,s=i.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return super.apply(t,n);let a=[],c=[];if(o!=null){let u=o.length;if(u%2>0)throw new re("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,a.push(...o);let p=o.map(d=>new Vr({shape:d.shape}));this.forwardLayer.stateSpec=p.slice(0,u/2),this.backwardLayer.stateSpec=p.slice(u/2),c.push(...p)}if(s!=null)throw new lt("Support for constants in Bidirectional layers is not implemented yet.");let l=a[0]instanceof fs;for(let u of a)if(u instanceof fs!==l)throw new re("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){let u=[t].concat(a),p=this.inputSpec.concat(c),d=this.inputSpec;this.inputSpec=p;let h=super.apply(u,n);return this.inputSpec=d,h}else return super.apply(t,n)}call(t,n){return ee(()=>{let o=n.initialState,s,i;if(o==null)s=this.forwardLayer.call(t,n),i=this.backwardLayer.call(t,n);else{let l=o.slice(0,o.length/2),u=o.slice(o.length/2);s=this.forwardLayer.call(t,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(t,Object.assign(n,{initialState:u}))}let a;this.returnState&&(Array.isArray(s)&&(a=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=Qn(i,1));let c;return this.mergeMode==="concat"?c=Bb([s,i]):this.mergeMode==="sum"?c=ae(s,i):this.mergeMode==="ave"?c=W(.5,ae(s,i)):this.mergeMode==="mul"?c=W(s,i):this.mergeMode==null&&(c=[s,i]),this.returnState?this.mergeMode==null?c.concat(a):[c].concat(a):c})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Dl(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Dl(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[n,n]:o=n:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let i=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(i).concat(i):[o].concat(i).concat(i)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){let t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){let o=Vi(n.layer);if(delete n.layer,n.numConstants!=null)throw new lt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let s=n;return s.layer=o,new t(s)}}return r.className="Bidirectional",r})();fe.registerClass(Yoe);var Zoe=(()=>{class r extends ut{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){let t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return ee(()=>(t=ot(t),t.dtype!=="float32"&&(t=hs(t,"float32")),ae(W(t,this.scale),this.offset)))}}return r.className="Rescaling",r})();fe.registerClass(Zoe);var{resizeBilinear:nGe,cropAndResize:oGe}=Gn,Qoe=(()=>{class r extends ut{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,o,s,i,a,c,l){return ee(()=>{let u,p=!1,d=n/a,h=o/c,f=(s+n)/a,m=(i+o)/c,g=[d,h,f,m],y=[];t.rank===3?(p=!0,u=mn([t])):u=t;for(let I=0;I<u.shape[0];I++)y.push(g);let x=Co(y,[y.length,4]),b=wp(0,y.length,1,"int32"),_=oGe(u,x,b,[s,i],"nearest");return p?hs(ot(eo(_)),l):hs(_,l)})}upsize(t,n,o,s){return ee(()=>{let i=nGe(t,[n,o]);return hs(i,s)})}call(t,n){return ee(()=>{let o=ot(t),s=o.dtype,i=o.shape,a=i[i.length-3],c=i[i.length-2],l=0;a!==this.height&&(l=Math.floor((a-this.height)/2));let u=0;return c!==this.width&&(u=Math.floor((c-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(o,l,u,this.height,this.width,a,c,s):this.upsize(t,this.height,this.width,s)})}getConfig(){let t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=_t(t);let n=t.length-3,o=t.length-2;return t[n]=this.height,t[o]=this.width,t}}return r.className="CenterCrop",r})();fe.registerClass(Qoe);function Joe(r,e,t,n){let o=ot(r);if(o.dtype!=="int32"&&(o=hs(o,"int32")),e==="int")return o;let s=o.shape;if(o.rank===0&&(o=Hr(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=Hr(o,-1)),o.rank>2)throw new re(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${o.rank}.`);let i=["multiHot","oneHot"].includes(e),a=o,c;if(typeof n<"u"&&e==="count"?c=s_(a,n,t,i):c=s_(a,[],t,i),e!=="tfIdf")return c;if(n)return W(c,n);throw new re("When outputMode is 'tfIdf', weights must be provided.")}var ese=(()=>{class r extends ut{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){let t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=_t(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return ee(()=>{t=ot(t),t.dtype!=="int32"&&(t=hs(t,"int32"));let o;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new re(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);o=ot(n.countWeights)}let s=Io(t),i=Nd(t),a=fn(this.numTokens,s).bufferSync().get(0),c=Es(i,0).bufferSync().get(0);if(!(a&&c))throw new re(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return Joe(t,this.outputMode,this.numTokens,o)})}}return r.className="CategoryEncoding",r})();fe.registerClass(ese);var iGe=["bilinear","nearest"],tse=new Set(iGe),rse=(()=>{class r extends ut{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(tse.has(t.interpolation))this.interpolation=t.interpolation;else throw new re(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=_t(t);let n=t[2];return[this.height,this.width,n]}getConfig(){let t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return ee(()=>{let o=[this.height,this.width];if(this.interpolation==="bilinear")return Gn.resizeBilinear(t,o,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Gn.resizeNearestNeighbor(t,o,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...tse]} are supported`)})}}return r.className="Resizing",r})();fe.registerClass(rse);var nse=(()=>{class r{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}return r.className="RandomSeed",r})();var ose=(()=>{class r extends ut{constructor(t){super(t),this.randomGenerator=new nse(t.seed)}getConfig(){let t={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(t,n),t}}return r.className="BaseRandomLayer",r})();var aGe=["bilinear","nearest"],sse=new Set(aGe),ise=(()=>{class r extends ose{constructor(t){super(t);let{factor:n,interpolation:o="bilinear"}=t;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new re(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new re(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new re(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(o)if(sse.has(o))this.interpolation=o;else throw new re(`Invalid interpolation parameter: ${o} is not implemented`)}getConfig(){let t={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=_t(t);let n=t[2];return[this.imgHeight,-1,n]}call(t,n){return ee(()=>{let o=ot(t);this.imgHeight=o.shape[o.shape.length-3];let s=o.shape[o.shape.length-2];this.widthFactor=Ai([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*s;i=Math.round(i);let a=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Gn.resizeBilinear(t,a);case"nearest":return Gn.resizeNearestNeighbor(t,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...sse]} are supported`)}})}}return r.className="RandomWidth",r})();fe.registerClass(ise);var xGe=Wp(c_());var gGe=Wp(c_());var c2r=Symbol("out"),l2r=Symbol("field"),u2r=Symbol("quote"),p2r=Symbol("quoteafterquote"),d2r=Symbol("quoteinquote");var NGe=to.whereImpl,cse=(()=>{class r extends Sc{nextDataId(){return r.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new dd(this,_o())}write(t,n,o){this.firstUse&&(this.firstUse=!1,Z().get("IS_NODE")&&E.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let s={id:this.nextDataId()};return this.data.set(s,{values:t,dtype:o,refCount:1}),s}makeTensorInfo(t,n,o){let s;if(n==="string"&&o!=null&&o.length>0&&C.isString(o[0])){let i=o.map(a=>C.encodeString(a));s=this.write(i,t,n)}else s=this.write(o,t,n);return{dataId:s,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){let n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){let n=this.data.get(t);n.refCount--}}move(t,n,o,s,i){this.data.set(t,{values:n,dtype:s,refCount:i})}numDataIds(){return this.data.numDataIds()}read(t){return M(this,null,function*(){return this.readSync(t)})}readSync(t){let{dtype:n,complexTensorInfos:o}=this.data.get(t);if(n==="complex64"){let s=this.readSync(o.real.dataId),i=this.readSync(o.imag.dataId);return E.mergeRealAndImagArrays(s,i)}return C.convertBackendValuesAndArrayBuffer(this.data.get(t).values,n)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let o=n.map(s=>C.decodeString(s));return ze(t.shape,t.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(t.shape,t.dtype,n)}makeOutput(t,n,o){return _o().makeTensorFromTensorInfo(this.makeTensorInfo(n,o,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(t);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}time(t){return M(this,null,function*(){let n=C.now();return t(),{kernelMs:C.now()-n}})}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){ye([t],"where");let n=this.readSync(t.dataId);return NGe(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return r.nextDataId=0,r})();Fv("cpu",()=>new cse,1);var uz=pt($c,r=>r>=0?r:Math.exp(r)-1),lse={kernelName:$c,backendName:"cpu",kernelFunc:uz};function pz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{alpha:s}=n;ye([o],"leakyRelu");let i=C.sizeFromShape(o.shape),a=t.data.get(o.dataId).values,c=C.getTypedArrayFromDType("float32",i);for(let l=0;l<a.length;l++)c[l]=a[l]<0?s*a[l]:a[l];return t.makeTensorInfo(o.shape,"float32",c)}var use={kernelName:Pu,backendName:"cpu",kernelFunc:pz};var DGe=Gt((r,e)=>r<0?e*r:r);function dz(r){let{inputs:e,backend:t}=r,{x:n,alpha:o}=e;ye([n,o],"prelu");let s=t.data.get(n.dataId).values,i=t.data.get(o.dataId).values,[a,c]=DGe(n.shape,o.shape,s,i,"float32");return t.makeTensorInfo(c,"float32",a)}var pse={kernelName:Xu,backendName:"cpu",kernelFunc:dz};var hz=pt(tl,r=>Math.max(0,r)),dse={kernelName:tl,backendName:"cpu",kernelFunc:hz};var fz=pt(rl,r=>Math.min(Math.max(0,r),6)),hse={kernelName:rl,backendName:"cpu",kernelFunc:fz};function Iy(r,e,t,n,o){if(t==="linear")return es({inputs:{x:e},backend:r});if(t==="relu")return hz({inputs:{x:e},backend:r});if(t==="elu")return uz({inputs:{x:e},backend:r});if(t==="relu6")return fz({inputs:{x:e},backend:r});if(t==="prelu")return dz({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return pz({inputs:{x:e},backend:r,attrs:{alpha:o}});if(t==="sigmoid")return GV({inputs:{x:e},backend:r});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}function Wt(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{shape:s}=n,i=C.sizeFromShape(o.shape),a=C.inferFromImplicitShape(s,i),c=C.sizeFromShape(a);C.assert(i===c,()=>`The new shape (${a}) has ${c} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(o.dataId);let l=t.data.get(o.dataId);if(l.complexTensorInfos!=null){let u=l.complexTensorInfos.real,p=l.complexTensorInfos.imag;u.shape=a,p.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var fse={kernelName:Zu,backendName:"cpu",kernelFunc:Wt};function mz(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;ye([o,s],"matMul");let c=o.shape.length,l=s.shape.length,u=i?o.shape[c-2]:o.shape[c-1],p=a?s.shape[l-1]:s.shape[l-2],d=i?o.shape[c-1]:o.shape[c-2],h=a?s.shape[l-2]:s.shape[l-1],f=o.shape.slice(0,-2),m=s.shape.slice(0,-2),g=C.sizeFromShape(f),y=C.sizeFromShape(m),b=ks.assertAndGetBroadcastShape(o.shape.slice(0,-2),s.shape.slice(0,-2)).concat([d,h]);C.assert(u===p,()=>`Error in matMul: inner shapes (${u}) and (${p}) of Tensors with shapes ${o.shape} and ${s.shape} and transposeA=${i} and transposeB=${a} must match.`);let w=i?[g,u,d]:[g,d,u],_=a?[y,h,p]:[y,p,h],I=Wt({inputs:{x:o},backend:t,attrs:{shape:w}}),S=Wt({inputs:{x:s},backend:t,attrs:{shape:_}}),k=i?I.shape[1]:I.shape[2],R=i?I.shape[2]:I.shape[1],L=a?S.shape[1]:S.shape[2],B=Math.max(g,y),z=t.data.get(I.dataId).values,q=t.data.get(S.dataId).values,U=C.computeStrides(I.shape),G=C.computeStrides(S.shape),[j,X,te]=i?[U[0],1,U[1]]:[U[0],U[1],1],[ne,oe,le]=a?[1,G[1],G[0]]:[G[1],1,G[0]],xe=R*L,ge=ze([B,R,L],I.dtype),Re=ge.values,Ee=t.blockSize;for(let Ne=0;Ne<B;Ne++){let we=Ne%g,qe=Ne%y;for(let Qe=0;Qe<R;Qe+=Ee){let De=Math.min(Qe+Ee,R);for(let Me=0;Me<L;Me+=Ee){let dt=Math.min(Me+Ee,L);for(let Be=0;Be<k;Be+=Ee){let at=Math.min(Be+Ee,k);for(let _e=Qe;_e<De;_e++)for(let Ae=Me;Ae<dt;Ae++){let wt=0;for(let xt=Be;xt<at;xt++){let zt=z[we*j+_e*X+xt*te],Ut=q[xt*ne+Ae*oe+qe*le];wt+=zt*Ut}Re[Ne*xe+(_e*L+Ae)]+=wt}}}}}return t.disposeIntermediateTensorInfo(I),t.disposeIntermediateTensorInfo(S),t.makeTensorInfo(b,ge.dtype,ge.values)}var mse={kernelName:_u,backendName:"cpu",kernelFunc:mz};function AGe(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:p}=n,d,h,f,m=[];d=mz({inputs:{a:o,b:s},attrs:{transposeA:c,transposeB:l},backend:t}),i&&(h=Cp({inputs:{a:d,b:i},backend:t}),m.push(d),d=h),u&&(f=Iy(t,d,u,a,p),m.push(d),d=f);for(let y of m)t.disposeIntermediateTensorInfo(y);return d}var gse={kernelName:Cd,backendName:"cpu",kernelFunc:AGe};var RGe=pt(Ic,r=>Math.acos(r)),yse={kernelName:Ic,backendName:"cpu",kernelFunc:RGe};var OGe=pt(Tc,r=>Math.acosh(r)),xse={kernelName:Tc,backendName:"cpu",kernelFunc:OGe};function MGe(r){let{inputs:e,backend:t}=r,n=e;ye(e,"addN");let o=n.map(a=>t.data.get(a.dataId).values),s=ze(n[0].shape,n[0].dtype),i=s.values;for(let a=0;a<n.length;a++){let c=o[a];for(let l=0;l<i.length;l++)i[l]+=c[l]}return t.makeTensorInfo(s.shape,s.dtype,s.values)}var vse={kernelName:xu,backendName:"cpu",kernelFunc:MGe};function FGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;ye(o,"all");let a=C.parseAxisParam(s,o.shape),c=a,l=E.getAxesPermutation(c,o.shape.length),u=o;l!=null&&(u=yn({inputs:{x:o},backend:t,attrs:{perm:l}}),c=E.getInnerMostAxes(c.length,o.shape.length)),E.assertAxesAreInnerMostDims("all",c,u.shape.length);let[p,d]=E.computeOutAndReduceShapes(u.shape,c),h=C.sizeFromShape(d),f=C.makeZerosTypedArray(C.sizeFromShape(p),u.dtype),m=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let x=y*h,b=m[x];for(let w=0;w<h;++w){let _=m[x+w];b=b&&_}f[y]=b}l!=null&&t.disposeIntermediateTensorInfo(u);let g=t.makeTensorInfo(p,u.dtype,f);if(i){let y=E.expandShapeToKeepDim(p,a),x=Wt({inputs:{x:g},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(g),x}return g}var bse={kernelName:zh,backendName:"cpu",kernelFunc:FGe};function PGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;ye(o,"any");let a=C.parseAxisParam(s,o.shape),c=a,l=E.getAxesPermutation(c,o.shape.length),u=o;l!=null&&(u=yn({inputs:{x:o},backend:t,attrs:{perm:l}}),c=E.getInnerMostAxes(c.length,o.shape.length)),E.assertAxesAreInnerMostDims("any",c,u.shape.length);let[p,d]=E.computeOutAndReduceShapes(u.shape,c),h=C.sizeFromShape(d),f=C.makeZerosTypedArray(C.sizeFromShape(p),u.dtype),m=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let x=y*h,b=m[x];for(let w=0;w<h;++w){let _=m[x+w];b=b||_}f[y]=b}l!=null&&t.disposeIntermediateTensorInfo(u);let g=t.makeTensorInfo(p,u.dtype,f);if(i){let y=E.expandShapeToKeepDim(p,a),x=Wt({inputs:{x:g},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(g),x}return g}var wse={kernelName:Uh,backendName:"cpu",kernelFunc:PGe};function $Ge(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n;ye(o,"argMax");let i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=yn({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),i=[i[0]],E.assertAxesAreInnerMostDims("argMax",i,c.shape.length);let[u,p]=E.computeOutAndReduceShapes(c.shape,i),d=C.sizeFromShape(u),h=C.makeZerosTypedArray(d,"int32"),f=C.sizeFromShape(p),m=t.data.get(c.dataId).values;for(let g=0;g<h.length;++g){let y=g*f,x=m[y],b=0;for(let w=0;w<f;++w){let _=m[y+w];_>x&&(x=_,b=w)}h[g]=b}return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(u,"int32",h)}var Cse={kernelName:vu,backendName:"cpu",kernelFunc:$Ge};function LGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n;ye(o,"argMin");let i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=yn({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),i=[i[0]],E.assertAxesAreInnerMostDims("argMin",i,c.shape.length);let[u,p]=E.computeOutAndReduceShapes(c.shape,i),d=C.sizeFromShape(u),h=C.makeZerosTypedArray(d,"int32"),f=C.sizeFromShape(p),m=t.data.get(c.dataId).values;for(let g=0;g<h.length;++g){let y=g*f,x=m[y],b=0;for(let w=0;w<f;++w){let _=m[y+w];_<x&&(x=_,b=w)}h[g]=b}return l.forEach(g=>t.disposeIntermediateTensorInfo(g)),t.makeTensorInfo(u,"int32",h)}var _se={kernelName:bu,backendName:"cpu",kernelFunc:LGe};var VGe=pt(kc,r=>Math.asin(r)),Sse={kernelName:kc,backendName:"cpu",kernelFunc:VGe};var BGe=pt(Ec,r=>Math.asinh(r)),Ise={kernelName:Ec,backendName:"cpu",kernelFunc:BGe};var zGe=pt(Nc,r=>Math.atan(r)),Tse={kernelName:Nc,backendName:"cpu",kernelFunc:zGe};var UGe=Gt((r,e)=>Math.atan2(r,e)),GGe=er(Ac,UGe),kse={kernelName:Ac,backendName:"cpu",kernelFunc:GGe};var WGe=pt(Dc,r=>Math.atanh(r)),Ese={kernelName:Dc,backendName:"cpu",kernelFunc:WGe};function Yb(r,e,t,n,o,s){let i=o.strideHeight,a=o.strideWidth,c=o.dilationHeight,l=o.dilationWidth,u=o.effectiveFilterHeight,p=o.effectiveFilterWidth,d=o.padInfo.top,h=o.padInfo.left,f=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ze(o.outShape,t),g=m.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],x=o.outShape[2]*o.outShape[3],b=o.outShape[3];for(let w=0;w<o.batchSize;++w){let _=w*y,I=w*n[0];for(let S=0;S<o.inChannels;++S)for(let k=0;k<o.outHeight;++k){let R=k*i-d,L=Math.max(0,R),B=Math.min(o.inHeight,u+R),z=_+k*x;for(let q=0;q<o.outWidth;++q){let U=q*a-h,G=Math.max(0,U),j=Math.min(o.inWidth,p+U),X=f,te=0,ne=0;for(let le=L;le<B;le+=c){let xe=I+le*n[1];for(let ge=G;ge<j;ge+=l){let Re=xe+ge*n[2],Ee=r[Re+S];s==="max"&&Ee>X?X=Ee:s==="avg"&&(te+=Ee,ne++)}if(isNaN(X))break}let oe=z+q*b+S;g[oe]=s==="avg"?te/ne:X}}}return m}function BA(r,e,t,n,o=!1,s=!1){let i=ze(n.outShape,"int32"),a=n.strideHeight,c=n.strideWidth,l=n.dilationHeight,u=n.dilationWidth,p=n.effectiveFilterHeight,d=n.effectiveFilterWidth,h=n.padInfo.top,f=n.padInfo.left,m=ze(e,t,r);for(let g=0;g<n.batchSize;++g)for(let y=0;y<n.inChannels;++y)for(let x=0;x<n.outHeight;++x){let b=x*a-h,w=b;for(;w<0;)w+=l;let _=Math.min(n.inHeight,p+b);for(let I=0;I<n.outWidth;++I){let S=I*c-f,k=S;for(;k<0;)k+=u;let R=Math.min(n.inWidth,d+S),L=Number.NEGATIVE_INFINITY,B=-1;for(let z=w;z<_;z+=l){let q=z-b;for(let U=k;U<R;U+=u){let G=U-S,j=m.get(g,z,U,y);j>L&&(L=j,o?B=s?((g*n.inHeight+z)*n.inWidth+U)*n.inChannels+y:(z*n.inWidth+U)*n.inChannels+y:B=q*d+G)}}i.set(B,g,x,I,y)}}return i}function zA(r,e,t,n,o,s){let i=o.strideDepth,a=o.strideHeight,c=o.strideWidth,l=o.dilationDepth,u=o.dilationHeight,p=o.dilationWidth,d=o.effectiveFilterDepth,h=o.effectiveFilterHeight,f=o.effectiveFilterWidth,m=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,x=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=ze(o.outShape,t),w=b.values,_=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],I=o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[3]*o.outShape[4],k=o.outShape[4];for(let R=0;R<o.batchSize;++R){let L=R*_,B=R*n[0];for(let z=0;z<o.inChannels;++z)for(let q=0;q<o.outDepth;++q){let U=q*i-m,G=U;for(;G<0;)G+=l;let j=Math.min(o.inDepth,d+U),X=L+q*I;for(let te=0;te<o.outHeight;++te){let ne=te*a-g,oe=ne;for(;oe<0;)oe+=u;let le=Math.min(o.inHeight,h+ne),xe=X+te*S;for(let ge=0;ge<o.outWidth;++ge){let Re=ge*c-y,Ee=Re;for(;Ee<0;)Ee+=p;let Ne=Math.min(o.inWidth,f+Re),we=xe+ge*k,qe=x,Qe=0,De=0;for(let dt=G;dt<j;dt+=l){let Be=B+dt*n[1];for(let at=oe;at<le;at+=u){let _e=Be+at*n[2];for(let Ae=Ee;Ae<Ne;Ae+=p){let wt=_e+Ae*n[3],xt=r[wt+z];if(s==="max"&&xt>qe?qe=xt:s==="avg"&&(Qe+=xt,De++),isNaN(qe))break}if(isNaN(qe))break}if(isNaN(qe))break}let Me=we+z;w[Me]=s==="avg"?Qe/Math.max(De,1):qe}}}}return b}function Nse(r,e){let t=ze(e.outShape,"int32"),n=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=e.padInfo.front,h=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){let x=y*n-d,b=x;for(;b<0;)b+=i;let w=Math.min(e.inDepth,l+x);for(let _=0;_<e.outHeight;++_){let I=_*o-h,S=I;for(;S<0;)S+=a;let k=Math.min(e.inHeight,u+I);for(let R=0;R<e.outWidth;++R){let L=R*s-f,B=L;for(;B<0;)B+=c;let z=Math.min(e.inWidth,p+L),q=Number.NEGATIVE_INFINITY,U=-1;for(let G=b;G<w;G+=i){let j=G-x;for(let X=S;X<k;X+=a){let te=X-I;for(let ne=B;ne<z;ne+=c){let oe=ne-L,le=r.get(m,G,X,ne,g);le>=q&&(q=le,U=j*u*p+te*u+oe)}}}t.set(U,m,y,_,R,g)}}}return t}function jGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e;ye(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,l=1;C.assert(E.eitherStridesOrDilationsAreOne(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);let u=E.computePool2DInfo(o.shape,s,i,l,a,c),p;if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))p=es({inputs:{x:o},backend:t});else{let d=t.data.get(o.dataId).values,h=C.computeStrides(o.shape),f=Yb(d,o.shape,o.dtype,h,u,"avg");p=t.makeTensorInfo(u.outShape,o.dtype,f.values)}return p}var Dse={kernelName:wu,backendName:"cpu",kernelFunc:jGe};function HGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=n;ye(o,"avgPool3d");let u=E.computePool3DInfo(o.shape,s,i,1,a,c,l),p=t.data.get(o.dataId).values,d=zA(p,o.shape,o.dtype,C.computeStrides(o.shape),u,"avg");return t.makeTensorInfo(d.shape,"float32",d.values)}var Ase={kernelName:Cu,backendName:"cpu",kernelFunc:HGe};function qGe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=n;ye([o,s],"avgPool3DGrad");let u=E.computePool3DInfo(s.shape,i,a,1,c,l),p=u.strideDepth,d=u.strideHeight,h=u.strideWidth,f=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,w=u.effectiveFilterDepth,_=u.effectiveFilterHeight,I=u.effectiveFilterWidth,S=w-1-u.padInfo.front,k=I-1-u.padInfo.left,R=_-1-u.padInfo.top,L=ze(s.shape,"float32"),B=1/(f*m*g),z=t.bufferSync(o);for(let q=0;q<u.batchSize;++q)for(let U=0;U<u.inChannels;++U)for(let G=0;G<u.inDepth;++G)for(let j=0;j<u.inHeight;++j)for(let X=0;X<u.inWidth;++X){let te=G-S,ne=j-R,oe=X-k,le=0;for(let xe=0;xe<w;xe+=y){let ge=(te+xe)/p;if(!(ge<0||ge>=u.outDepth||Math.floor(ge)!==ge))for(let Re=0;Re<_;Re+=x){let Ee=(ne+Re)/d;if(!(Ee<0||Ee>=u.outHeight||Math.floor(Ee)!==Ee))for(let Ne=0;Ne<I;Ne+=b){let we=(oe+Ne)/h;if(we<0||we>=u.outWidth||Math.floor(we)!==we)continue;let qe=z.get(q,ge,Ee,we,U);le+=qe}}}L.set(le*B,q,G,j,X,U)}return t.makeTensorInfo(L.shape,L.dtype,L.values)}var Rse={kernelName:Wh,backendName:"cpu",kernelFunc:qGe};function KGe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s;ye([o,s],"avgPoolGrad");let{filterSize:a,strides:c,pad:l}=n,u=E.computePool2DInfo(i.shape,a,c,1,l),p=u.strideHeight,d=u.strideWidth,h=u.filterHeight,f=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,x=u.effectiveFilterWidth,b=x-1-u.padInfo.left,w=y-1-u.padInfo.top,_=ze(i.shape,"float32"),I=1/(h*f),S=t.data.get(o.dataId).values,k=ze(o.shape,"float32",S);for(let R=0;R<u.batchSize;++R)for(let L=0;L<u.inChannels;++L)for(let B=0;B<u.inHeight;++B)for(let z=0;z<u.inWidth;++z){let q=B-w,U=z-b,G=0;for(let j=0;j<y;j+=m){let X=(q+j)/p;if(!(X<0||X>=u.outHeight||Math.floor(X)!==X))for(let te=0;te<x;te+=g){let ne=(U+te)/d;if(ne<0||ne>=u.outWidth||Math.floor(ne)!==ne)continue;let oe=k.get(R,X,ne,L);G+=oe}}_.set(G*I,R,B,z,L)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}var Ose={kernelName:Gh,backendName:"cpu",kernelFunc:KGe};function XGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,scale:s,offset:i,mean:a,variance:c}=e;C.assert(a.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ye([o,a,c,s,i],"batchNorm");let{varianceEpsilon:l}=n;l==null&&(l=.001);let u=t.data.get(o.dataId).values,p=t.data.get(a.dataId).values,d=t.data.get(c.dataId).values,h=s?t.data.get(s.dataId).values:new Float32Array([1]),f=i?t.data.get(i.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=f.length,y=h.length,x=d.length,b=p.length,w=0,_=0,I=0,S=0;for(let k=0;k<u.length;++k)m[k]=f[w++]+(u[k]-p[_++])*h[I++]/Math.sqrt(d[S++]+l),w>=g&&(w=0),_>=b&&(_=0),I>=y&&(I=0),S>=x&&(S=0);return t.makeTensorInfo(o.shape,o.dtype,m)}var Mse={kernelName:Mu,backendName:"cpu",kernelFunc:XGe};function YGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,crops:i}=n;ye([o],"batchToSpaceND");let a=s.reduce((y,x)=>y*x),c=E.getReshaped(o.shape,s,a),l=E.getPermuted(c.length,s.length),u=E.getReshapedPermuted(o.shape,s,a),p=E.getSliceBeginCoords(i,s.length),d=E.getSliceSize(u,i,s.length),h=Wt({inputs:{x:o},backend:t,attrs:{shape:c}}),f=yn({inputs:{x:h},backend:t,attrs:{perm:l}}),m=Wt({inputs:{x:f},backend:t,attrs:{shape:u}}),g=Ha({inputs:{x:m},backend:t,attrs:{begin:p,size:d}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),g}var Fse={kernelName:Su,backendName:"cpu",kernelFunc:YGe};function ZGe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i}=n,a=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,l=Ib(a,c,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,l)}var Pse={kernelName:jh,backendName:"cpu",kernelFunc:ZGe};function QGe(r){let{inputs:e,backend:t}=r,{s0:n,s1:o}=e,s=t.data.get(n.dataId).values,i=t.data.get(o.dataId).values,a=E.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var $se={kernelName:Hh,backendName:"cpu",kernelFunc:QGe};var JGe=pt(Oc,(r,e)=>{let t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),Lse={kernelName:Oc,backendName:"cpu",kernelFunc:JGe};var eWe=r=>{let{x:e}=r.inputs,t=r.backend,n=new Float32Array(C.sizeFromShape(e.shape)),o=t.data.get(e.dataId),s=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values;for(let l=0;l<a.length;l++){let u=a[l],p=c[l];n[l]=Math.hypot(u,p)}return t.makeOutput(n,e.shape,"float32")},Vse={kernelName:Iu,backendName:"cpu",kernelFunc:eWe};function Np(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.data.get(n.dataId).complexTensorInfos.imag,s=t.data.get(o.dataId).values;return t.makeTensorInfo(o.shape,o.dtype,s)}var Bse={kernelName:df,backendName:"cpu",kernelFunc:Np};function xm(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n,s=C.parseAxisParam(o,e[0].shape)[0],i=e.map(m=>m.shape);E.assertParamsConsistent(i,s);let a=E.computeOutShape(e.map(m=>m.shape),s);if(C.sizeFromShape(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);let c=e.filter(m=>C.sizeFromShape(m.shape)>0);if(c.length===1)return es({inputs:{x:c[0]},backend:t});if(c[0].dtype==="complex64"){let m=c.map(w=>Ga({inputs:{input:w},backend:t})),g=c.map(w=>Np({inputs:{input:w},backend:t})),y=xm({inputs:m,backend:t,attrs:{axis:s}}),x=xm({inputs:g,backend:t,attrs:{axis:s}}),b=uo({inputs:{real:y,imag:x},backend:t});return m.forEach(w=>t.disposeIntermediateTensorInfo(w)),g.forEach(w=>t.disposeIntermediateTensorInfo(w)),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(x),b}let l=c.map(m=>{let y=[-1,C.sizeFromShape(m.shape.slice(s))];return Wt({inputs:{x:m},backend:t,attrs:{shape:y}})}),u=l.map(m=>({vals:t.data.get(m.dataId).values,shape:m.shape}));a=E.computeOutShape(l.map(m=>m.shape),1);let p=l[0].shape[0]===1,d=pN(u,a,e[0].dtype,p),h=E.computeOutShape(c.map(m=>m.shape),s),f=t.makeTensorInfo(h,e[0].dtype,d);return l.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}var zse={kernelName:Tu,backendName:"cpu",kernelFunc:xm};function gz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=n;ye([o,s],"conv2d");let p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,s.shape,i,l,a,u,!1,p),h=d.filterHeight,f=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo.left,x=d.padInfo.top,b=d.dataFormat==="channelsLast",w=new ur(d.outShape,o.dtype),_=C.computeStrides(o.shape),I=C.computeStrides(s.shape),S=_[0],k=b?_[1]:_[2],R=b?_[2]:1,L=b?1:_[1],B=w.strides[0],z=b?w.strides[1]:w.strides[2],q=b?w.strides[2]:1,U=b?1:w.strides[1],G=t.data.get(o.dataId).values,j=t.data.get(s.dataId).values,X=w.values;for(let te=0;te<d.batchSize;++te){let ne=te*S,oe=te*B;for(let le=0;le<d.outHeight;++le){let xe=oe+le*z,ge=le*d.strideHeight-x;for(let Re=0;Re<h;++Re){let Ee=ge+Re*m;if(Ee<0||Ee>=d.inHeight)continue;let Ne=Re*I[0],we=ne+Ee*k;for(let qe=0;qe<d.outWidth;++qe){let Qe=xe+qe*q,De=qe*d.strideWidth-y;for(let Me=0;Me<f;++Me){let dt=De+Me*g;if(dt<0||dt>=d.inWidth)continue;let Be=Ne+Me*I[1],at=we+dt*R,_e=Be;for(let Ae=0;Ae<d.inChannels;++Ae){let wt=G[at+Ae*L];for(let xt=0;xt<d.outChannels;++xt)X[Qe+xt*U]+=wt*j[_e+xt];_e+=d.outChannels}}}}}}return t.makeTensorInfo(w.shape,w.dtype,X)}var Use={kernelName:ku,backendName:"cpu",kernelFunc:gz};function tWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=n;ye([o,s],"conv2dBackpropFilter");let p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,u,i,1,a,l,!1,p),{strideHeight:h,strideWidth:f,filterHeight:m,filterWidth:g}=d,y=d.dataFormat==="channelsLast",x=new ur(d.filterShape,"float32"),b=d.padInfo.left,w=d.padInfo.top,_=t.data.get(o.dataId).values,I=t.data.get(s.dataId).values,S=new ur(o.shape,o.dtype,_),k=new ur(s.shape,s.dtype,I);for(let R=0;R<m;++R){let L=Math.max(0,Math.ceil((w-R)/h)),B=Math.min(d.outHeight,(d.inHeight+w-R)/h);for(let z=0;z<g;++z){let q=Math.max(0,Math.ceil((b-z)/f)),U=Math.min(d.outWidth,(d.inWidth+b-z)/f);for(let G=0;G<d.inChannels;++G)for(let j=0;j<d.outChannels;++j){let X=0;for(let te=0;te<d.batchSize;++te)for(let ne=L;ne<B;++ne){let oe=R+ne*h-w;for(let le=q;le<U;++le){let xe=z+le*f-b;y?X+=S.get(te,oe,xe,G)*k.get(te,ne,le,j):X+=S.get(te,G,oe,xe)*k.get(te,j,ne,le)}}x.set(X,R,z,G,j)}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var Gse={kernelName:Kh,backendName:"cpu",kernelFunc:tWe};function rWe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=n;ye([o,s],"conv2dBackpropInput");let p=C.computeStrides(s.shape),d=C.computeStrides(o.shape),h=E.convertConv2DDataFormat(l),f=E.computeConv2DInfo(i,s.shape,a,1,c,u,!1,h),m=new ur(f.inShape,"float32"),g=m.values,y=t.data.get(o.dataId).values,x=t.data.get(s.dataId).values,[b,w,_]=p,{batchSize:I,filterHeight:S,filterWidth:k,inChannels:R,inHeight:L,inWidth:B,outChannels:z,outHeight:q,outWidth:U,strideHeight:G,strideWidth:j}=f;h=f.dataFormat;let X=S-1-f.padInfo.top,te=k-1-f.padInfo.left,ne=h==="channelsLast",oe=m.strides[0],le=ne?m.strides[1]:m.strides[2],xe=ne?m.strides[2]:1,ge=ne?1:m.strides[1],Re=d[0],Ee=ne?d[1]:d[2],Ne=ne?d[2]:1,we=ne?1:d[1];for(let qe=0;qe<I;++qe)for(let Qe=0;Qe<R;++Qe)for(let De=0;De<L;++De){let Me=De-X,dt=Math.max(0,Math.ceil(Me/G)),Be=Math.min(q,(S+Me)/G);for(let at=0;at<B;++at){let _e=at-te,Ae=Math.max(0,Math.ceil(_e/j)),wt=Math.min(U,(k+_e)/j),xt=0;for(let Ut=dt;Ut<Be;++Ut){let Ln=Ut*G-Me;for(let wn=Ae;wn<wt;++wn){let xs=wn*j-_e,zn=Re*qe+Ee*Ut+Ne*wn,hi=b*(S-1-Ln)+w*(k-1-xs)+_*Qe;for(let Bs=0;Bs<z;++Bs){let ma=y[zn+we*Bs],Kl=x[hi+Bs];xt+=ma*Kl}}}let zt=oe*qe+le*De+xe*at+ge*Qe;g[zt]=xt}}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var Wse={kernelName:Eu,backendName:"cpu",kernelFunc:rWe};function nWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c}=n;ye([o,s],"conv3d");let l=E.computeConv3DInfo(o.shape,s.shape,i,c,a),{filterDepth:u,filterHeight:p,filterWidth:d,dilationDepth:h,dilationHeight:f,dilationWidth:m,padInfo:g}=l,y=g.front,x=g.left,b=g.top,w=new ur(l.outShape,o.dtype),_=t.data.get(o.dataId).values,I=t.data.get(s.dataId).values,S=w.values,k=C.computeStrides(o.shape),R=C.computeStrides(s.shape);for(let L=0;L<l.batchSize;++L){let B=L*k[0],z=L*w.strides[0];for(let q=0;q<l.outDepth;++q){let U=z+q*w.strides[1],G=q*l.strideDepth-y;for(let j=0;j<u;++j){let X=G+j*h;if(X<0||X>=l.inDepth)continue;let te=j*R[0],ne=B+X*k[1];for(let oe=0;oe<l.outHeight;++oe){let le=U+oe*w.strides[2],xe=oe*l.strideHeight-b;for(let ge=0;ge<p;++ge){let Re=xe+ge*f;if(Re<0||Re>=l.inHeight)continue;let Ee=te+ge*R[1],Ne=ne+Re*k[2];for(let we=0;we<l.outWidth;++we){let qe=le+we*l.outChannels,Qe=we*l.strideWidth-x;for(let De=0;De<d;++De){let Me=Qe+De*m;if(Me<0||Me>=l.inWidth)continue;let dt=Ee+De*R[2],Be=Ne+Me*l.inChannels,at=dt;for(let _e=0;_e<l.inChannels;++_e){let Ae=_[Be+_e];for(let wt=0;wt<l.outChannels;++wt)S[qe+wt]+=Ae*I[at+wt];at+=l.outChannels}}}}}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var jse={kernelName:Nu,backendName:"cpu",kernelFunc:nWe};function oWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:c}=n;ye([o,s],"conv3dBackpropFilterV2");let l=C.computeStrides(o.shape),u=C.computeStrides(s.shape),p=E.computeConv3DInfo(o.shape,c,i,1,a),d=p.strideDepth,h=p.strideHeight,f=p.strideWidth,m=p.filterDepth,g=p.filterHeight,y=p.filterWidth,x=new ur(p.filterShape,"float32"),b=x.values,[w,_,I,S]=x.strides,k=t.data.get(s.dataId).values,[R,L,B,z]=u,q=t.data.get(o.dataId).values,[U,G,j,X]=l,te=p.padInfo.front,ne=p.padInfo.left,oe=p.padInfo.top;for(let le=0;le<m;++le){let xe=Math.max(0,Math.ceil((te-le)/d)),ge=Math.min(p.outDepth,(p.inDepth+te-le)/d),Re=le*w;for(let Ee=0;Ee<g;++Ee){let Ne=Math.max(0,Math.ceil((oe-Ee)/h)),we=Math.min(p.outHeight,(p.inHeight+oe-Ee)/h),qe=Ee*_+Re;for(let Qe=0;Qe<y;++Qe){let De=Math.max(0,Math.ceil((ne-Qe)/f)),Me=Math.min(p.outWidth,(p.inWidth+ne-Qe)/f),dt=Qe*I+qe;for(let Be=0;Be<p.inChannels;++Be){let at=Be*S+dt;for(let _e=0;_e<p.outChannels;++_e){let Ae=0;for(let wt=0;wt<p.batchSize;++wt){let xt=wt*U,zt=wt*R;for(let Ut=xe;Ut<ge;++Ut){let wn=(le+Ut*d-te)*G+xt,xs=Ut*L+zt;for(let zn=Ne;zn<we;++zn){let Bs=(Ee+zn*h-oe)*j+wn,ma=zn*B+xs;for(let Kl=De;Kl<Me;++Kl){let s0=(Qe+Kl*f-ne)*X+Bs,Xy=Kl*z+ma;Ae+=q[s0+Be]*k[Xy+_e]}}}}b[at+_e]=Ae}}}}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var Hse={kernelName:Xh,backendName:"cpu",kernelFunc:oWe};function sWe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:c}=n;ye([o],"conv3dBackpropInputV2");let l=C.computeStrides(o.shape),u=C.computeStrides(s.shape),p=E.computeConv3DInfo(c,s.shape,a,1,i),d=new ur(p.inShape,"float32"),h=d.values,[f,m,g,y]=d.strides,x=t.data.get(o.dataId).values,[b,w,_,I]=l,S=t.data.get(s.dataId).values,[k,R,L,B]=u,{batchSize:z,filterDepth:q,filterHeight:U,filterWidth:G,inChannels:j,inDepth:X,inHeight:te,inWidth:ne,outChannels:oe,outDepth:le,outHeight:xe,outWidth:ge,strideDepth:Re,strideHeight:Ee,strideWidth:Ne}=p,we=q-1-p.padInfo.front,qe=U-1-p.padInfo.top,Qe=G-1-p.padInfo.left;for(let De=0;De<z;++De)for(let Me=0;Me<j;++Me)for(let dt=0;dt<X;++dt){let Be=dt-we,at=Math.max(0,Math.ceil(Be/Re)),_e=Math.min(le,(q+Be)/Re);for(let Ae=0;Ae<te;++Ae){let wt=Ae-qe,xt=Math.max(0,Math.ceil(wt/Ee)),zt=Math.min(xe,(U+wt)/Ee);for(let Ut=0;Ut<ne;++Ut){let Ln=Ut-Qe,wn=Math.max(0,Math.ceil(Ln/Ne)),xs=Math.min(ge,(G+Ln)/Ne),zn=0;for(let hi=at;hi<_e;++hi){let Bs=hi*Re-Be;for(let ma=xt;ma<zt;++ma){let Kl=ma*Ee-wt;for(let sh=wn;sh<xs;++sh){let s0=sh*Ne-Ln,Xy=b*De+w*hi+_*ma+I*sh,YS=k*(q-1-Bs)+R*(U-1-Kl)+L*(G-1-s0)+B*Me;for(let Xl=0;Xl<oe;++Xl){let i0=x[Xy+Xl],ZS=S[YS+Xl];zn+=i0*ZS}}}}h[f*De+m*dt+g*Ae+y*Ut+Me]=zn}}}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var qse={kernelName:Yh,backendName:"cpu",kernelFunc:sWe};var iWe=pt(Mc,r=>Math.cos(r)),Kse={kernelName:Mc,backendName:"cpu",kernelFunc:iWe};var aWe=pt(Fc,r=>Math.cosh(r)),Xse={kernelName:Fc,backendName:"cpu",kernelFunc:aWe};function cWe(r){let{inputs:e,backend:t,attrs:n}=r,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=n,[u,p,d,h]=o.shape,f=s.shape[0],[m,g]=a,y=ze([f,m,g,h],"float32"),x=t.data.get(s.dataId).values,b=t.data.get(i.dataId).values,w=t.data.get(o.dataId).values,_=C.computeStrides(o.shape),I=C.computeStrides(y.shape);for(let S=0;S<f;S++){let k=S*4,R=x[k],L=x[k+1],B=x[k+2],z=x[k+3],q=b[S];if(q>=u)continue;let U=m>1?(B-R)*(p-1)/(m-1):0,G=g>1?(z-L)*(d-1)/(g-1):0;for(let j=0;j<m;j++){let X=m>1?R*(p-1)+j*U:.5*(R+B)*(p-1);if(X<0||X>p-1){for(let te=0;te<g;te++)for(let ne=0;ne<h;ne++){let oe=ne+te*I[2]+j*I[1]+S*I[0];y.values[oe]=l}continue}if(c==="bilinear"){let te=Math.floor(X),ne=Math.ceil(X),oe=X-te;for(let le=0;le<g;le++){let xe=g>1?L*(d-1)+le*G:.5*(L+z)*(d-1);if(xe<0||xe>d-1){for(let Ne=0;Ne<h;Ne++){let we=Ne+le*I[2]+j*I[1]+S*I[0];y.values[we]=l}continue}let ge=Math.floor(xe),Re=Math.ceil(xe),Ee=xe-ge;for(let Ne=0;Ne<h;Ne++){let we=Ne+ge*_[2]+te*_[1]+q*_[0],qe=w[we];we=Ne+Re*_[2]+te*_[1]+q*_[0];let Qe=w[we];we=Ne+ge*_[2]+ne*_[1]+q*_[0];let De=w[we];we=Ne+Re*_[2]+ne*_[1]+q*_[0];let Me=w[we],dt=qe+(Qe-qe)*Ee,Be=De+(Me-De)*Ee;we=Ne+le*I[2]+j*I[1]+S*I[0],y.values[we]=dt+(Be-dt)*oe}}}else for(let te=0;te<g;++te){let ne=g>1?L*(d-1)+te*G:.5*(L+z)*(d-1);if(ne<0||ne>d-1){for(let xe=0;xe<h;xe++){let ge=xe+te*I[2]+j*I[1]+S*I[0];y.values[ge]=l}continue}let oe=Math.round(ne),le=Math.round(X);for(let xe=0;xe<h;xe++){let ge=xe+oe*_[2]+le*_[1]+q*_[0],Re=xe+te*I[2]+j*I[1]+S*I[0];y.values[Re]=w[ge]}}}}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var Yse={kernelName:Qh,backendName:"cpu",kernelFunc:cWe};function lWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ye(o,"cumprod");let c=E.getAxesPermutation([s],o.shape.length),l=o;c!=null&&(l=yn({inputs:{x:o},backend:t,attrs:{perm:c}}));let u=E.getInnerMostAxes(1,o.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);let p=$r(l.dtype,"int32"),d=C.makeOnesTypedArray(C.sizeFromShape(l.shape),p),h=t.data.get(l.dataId).values,f=l.shape[l.shape.length-1],m=a?(y,x)=>y+f-x-1:(y,x)=>y+x;for(let y=0;y<h.length;y+=f)for(let x=0;x<f;x++){let b=m(y,x);if(x===0)d[b]=i?1:h[b];else{let w=m(y,x-1);d[b]=i?h[w]*d[w]:h[b]*d[w]}}let g=t.makeTensorInfo(l.shape,p,d);if(c!=null){let y=E.getUndoAxesPermutation(c),x=yn({inputs:{x:g},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(l),x}return g}var Zse={kernelName:Zh,backendName:"cpu",kernelFunc:lWe};function uWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ye(o,"cumsum");let c=E.getAxesPermutation([s],o.shape.length),l=o;c!=null&&(l=yn({inputs:{x:o},backend:t,attrs:{perm:c}}));let u=E.getInnerMostAxes(1,o.shape.length)[0];if(u!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${u}`);let p=$r(l.dtype,"int32"),d=C.makeZerosTypedArray(C.sizeFromShape(l.shape),p),h=t.data.get(l.dataId).values,f=l.shape[l.shape.length-1],m=a?(y,x)=>y+f-x-1:(y,x)=>y+x;for(let y=0;y<h.length;y+=f)for(let x=0;x<f;x++){let b=m(y,x);if(x===0)d[b]=i?0:h[b];else{let w=m(y,x-1);d[b]=i?h[w]+d[w]:h[b]+d[w]}}let g=t.makeTensorInfo(l.shape,p,d);if(c!=null){let y=E.getUndoAxesPermutation(c),x=yn({inputs:{x:g},backend:t,attrs:{perm:y}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(l),x}return g}var Qse={kernelName:Du,backendName:"cpu",kernelFunc:uWe};function pWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let c=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,u=Ib(c,l,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,u)}else if(o.shape.length===2){let c=t.bufferSync(o),l=t.bufferSync(s),u=uN(c,l,i,a);return t.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var Jse={kernelName:Jh,backendName:"cpu",kernelFunc:pWe};function dWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockSize:s,dataFormat:i}=n;C.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);let a=o.shape[0],c=o.shape[1],l=o.shape[2],u=o.shape[3],p=c*s,d=l*s,h=u/(s*s),f=t.data.get(o.dataId).values,m=new Float32Array(a*p*d*h),g=0;for(let y=0;y<a;++y)for(let x=0;x<p;++x){let b=Math.floor(x/s),w=x%s;for(let _=0;_<d;++_){let I=Math.floor(_/s),S=_%s,k=(w*s+S)*h;for(let R=0;R<h;++R){let B=R+k+u*(I+l*(b+c*y));m[g++]=f[B]}}}return t.makeTensorInfo([a,p,d,h],o.dtype,m)}var eie={kernelName:ef,backendName:"cpu",kernelFunc:dWe};function yz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=n;ye([o,s],"depthwiseConv2DNative");let u=C.computeStrides(o.shape),p=C.computeStrides(s.shape),d=c;d==null&&(d=[1,1]),C.assert(E.eitherStridesOrDilationsAreOne(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let h=E.computeConv2DInfo(o.shape,s.shape,i,d,a,l,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:x}=h,b=x.left,w=x.top,_=h.outChannels/h.inChannels,I=new ur(h.outShape,o.dtype),S=t.data.get(o.dataId).values,k=t.data.get(s.dataId).values,R=I.values;for(let L=0;L<h.batchSize;++L){let B=L*u[0],z=L*I.strides[0];for(let q=0;q<h.outHeight;++q){let U=z+q*I.strides[1],G=q*h.strideHeight-w;for(let j=0;j<f;++j){let X=G+j*g;if(X<0||X>=h.inHeight)continue;let te=j*p[0],ne=B+X*u[1];for(let oe=0;oe<h.outWidth;++oe){let le=U+oe*I.strides[2],xe=oe*h.strideWidth-b;for(let ge=0;ge<m;++ge){let Re=xe+ge*y;if(Re<0||Re>=h.inWidth)continue;let Ee=te+ge*p[1],Ne=ne+Re*h.inChannels,we=le,qe=Ee;for(let Qe=0;Qe<h.inChannels;++Qe){let De=S[Ne+Qe];for(let Me=0;Me<_;++Me)R[we+Me]+=De*k[qe+Me];we+=_,qe+=_}}}}}}return t.makeTensorInfo(I.shape,I.dtype,I.values)}var tie={kernelName:Au,backendName:"cpu",kernelFunc:yz};function hWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=n;ye([o,s],"depthwiseConv2dNativeBackpropFilter");let p=E.computeConv2DInfo(o.shape,u,i,a,c,l,!0),{strideHeight:d,strideWidth:h,filterHeight:f,filterWidth:m}=p,g=new ur(p.filterShape,"float32"),y=p.padInfo.left,x=p.padInfo.top,b=p.outChannels/p.inChannels,w=t.data.get(o.dataId).values,_=new ur(o.shape,o.dtype,w),I=t.data.get(s.dataId).values,S=new ur(s.shape,s.dtype,I);for(let k=0;k<f;++k){let R=Math.max(0,Math.ceil((x-k)/d)),L=Math.min(p.outHeight,(p.inHeight+x-k)/d);for(let B=0;B<m;++B){let z=Math.max(0,Math.ceil((y-B)/h)),q=Math.min(p.outWidth,(p.inWidth+y-B)/h);for(let U=0;U<p.outChannels;++U){let G=Math.trunc(U/b),j=U%b,X=0;for(let te=0;te<p.batchSize;++te)for(let ne=R;ne<L;++ne){let oe=k+ne*d-x;for(let le=z;le<q;++le){let xe=B+le*h-y;X+=_.get(te,oe,xe,G)*S.get(te,ne,le,U)}}g.set(X,k,B,G,j)}}}return t.makeTensorInfo(g.shape,g.dtype,g.values)}var rie={kernelName:tf,backendName:"cpu",kernelFunc:hWe};function fWe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=n;ye([o,s],"depthwiseConv2DNativeBackpropInput");let p=C.computeStrides(o.shape),d=C.computeStrides(s.shape),h=E.computeConv2DInfo(u,s.shape,i,a,c,l,!0),f=new ur(h.inShape,"float32"),m=f.values,[g,y,x]=f.strides,b=t.data.get(o.dataId).values,[w,_,I]=p,S=t.data.get(s.dataId).values,[k,R,L]=d,{batchSize:B,filterHeight:z,filterWidth:q,inChannels:U,inHeight:G,inWidth:j,outChannels:X,outHeight:te,outWidth:ne,strideHeight:oe,strideWidth:le}=h,xe=z-1-h.padInfo.top,ge=q-1-h.padInfo.left,Re=X/U;for(let Ee=0;Ee<B;++Ee)for(let Ne=0;Ne<U;++Ne)for(let we=0;we<G;++we){let qe=we-xe,Qe=Math.max(0,Math.ceil(qe/oe)),De=Math.min(te,(z+qe)/oe);for(let Me=0;Me<j;++Me){let dt=Me-ge,Be=Math.max(0,Math.ceil(dt/le)),at=Math.min(ne,(q+dt)/le),_e=0;for(let Ae=Qe;Ae<De;++Ae){let wt=Ae*oe-qe;for(let xt=Be;xt<at;++xt){let zt=xt*le-dt,Ut=w*Ee+_*Ae+I*xt,Ln=k*(z-1-wt)+R*(q-1-zt)+L*Ne;for(let wn=0;wn<Re;++wn){let xs=Ne*Re+wn,zn=b[Ut+xs],hi=S[Ln+wn];_e+=zn*hi}}}m[g*Ee+y*we+x*Me+Ne]=_e}}return t.makeTensorInfo(f.shape,f.dtype,f.values)}var nie={kernelName:rf,backendName:"cpu",kernelFunc:fWe};function mWe(r){let{inputs:e,backend:t}=r,{x:n}=e,o=C.sizeFromShape(n.shape),s=t.data.get(n.dataId).values,i=ze([o,o],n.dtype),a=i.values;for(let l=0;l<s.length;l++)a[l*o+l]=s[l];let c=[...n.shape,...n.shape];return t.makeTensorInfo(c,i.dtype,i.values)}var oie={kernelName:nf,backendName:"cpu",kernelFunc:mWe};var sie={kernelName:Ru,backendName:"cpu",kernelFunc:({inputs:r,backend:e,attrs:t})=>{let{x:n,filter:o}=r,{strides:s,pad:i,dilations:a}=t,c=e,l=c.data.get(n.dataId).values,u=n.shape.length,p=c.data.get(o.dataId).values,d=o.shape.length,{batchSize:h,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:x,padInfo:b,strideHeight:w,strideWidth:_,filterHeight:I,filterWidth:S,dilationHeight:k,dilationWidth:R,outShape:L}=E.computeDilation2DInfo(n.shape,o.shape,s,i,"NHWC",a),B=C.sizeFromShape(L),z=L.length,q=C.getArrayFromDType(n.dtype,B);for(let G=0;G<h;++G)for(let j=0;j<y;++j){let X=j*w-b.top;for(let te=0;te<x;++te){let ne=te*_-b.left;for(let oe=0;oe<g;++oe){let le=Number.MIN_SAFE_INTEGER;for(let ge=0;ge<I;++ge){let Re=X+ge*k;if(Re>=0&&Re<f)for(let Ee=0;Ee<S;++Ee){let Ne=ne+Ee*R;if(Ne>=0&&Ne<m){let we=C.locToIndex([G,Re,Ne,oe],u,C.computeStrides(n.shape)),qe=C.locToIndex([ge,Ee,oe],d,C.computeStrides(o.shape)),Qe=l[we]+p[qe];Qe>le&&(le=Qe)}}}let xe=C.locToIndex([G,j,te,oe],z,C.computeStrides(L));q[xe]=le}}}return{dataId:c.write(C.toTypedArray(q,n.dtype),L,n.dtype),shape:L,dtype:n.dtype}}};var iie={kernelName:Mg,backendName:"cpu",kernelFunc:({inputs:r,backend:e,attrs:t})=>{let{x:n,filter:o,dy:s}=r,{strides:i,pad:a,dilations:c}=t,l=e,u=C.toNestedArray(n.shape,l.data.get(n.dataId).values),p=C.toNestedArray(o.shape,l.data.get(o.dataId).values),{batchSize:d,inHeight:h,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:_,filterWidth:I,dilationHeight:S,dilationWidth:k,outShape:R}=E.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",c);C.assert(s.rank===R.length,()=>`Error in ${Mg}, dy must have the same rank as output ${R.length}, but got ${s.rank}`);let L=C.toNestedArray(R,l.data.get(s.dataId).values),B=C.makeZerosNestedTypedArray(o.shape,o.dtype);for(let q=0;q<d;++q)for(let U=0;U<g;++U){let G=U*b-x.top;for(let j=0;j<y;++j){let X=j*w-x.left;for(let te=0;te<m;++te){let ne=Number.MIN_SAFE_INTEGER,oe=0,le=0;for(let xe=0;xe<_;++xe){let ge=G+xe*S;if(ge>=0&&ge<h)for(let Re=0;Re<I;++Re){let Ee=X+Re*k;if(Ee>=0&&Ee<f){let Ne=u[q][ge][Ee][te]+p[xe][Re][te];Ne>ne&&(ne=Ne,oe=xe,le=Re)}}}B[oe][le][te]+=L[q][U][j][te]}}}return{dataId:l.write(C.toTypedArray(B,n.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var aie={kernelName:Og,backendName:"cpu",kernelFunc:({inputs:r,backend:e,attrs:t})=>{let{x:n,filter:o,dy:s}=r,{strides:i,pad:a,dilations:c}=t,l=e,u=C.toNestedArray(n.shape,l.data.get(n.dataId).values),p=C.toNestedArray(o.shape,l.data.get(o.dataId).values),{batchSize:d,inHeight:h,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:_,filterWidth:I,dilationHeight:S,dilationWidth:k,outShape:R}=E.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",c);C.assert(s.rank===R.length,()=>`Error in ${Og}, dy must have the same rank as output ${R.length}, but got ${s.rank}`);let L=C.toNestedArray(R,l.data.get(s.dataId).values),B=C.makeZerosNestedTypedArray(n.shape,n.dtype);for(let q=0;q<d;++q)for(let U=0;U<g;++U){let G=U*b-x.top;for(let j=0;j<y;++j){let X=j*w-x.left;for(let te=0;te<m;++te){let ne=Number.MIN_SAFE_INTEGER,oe=G<0?0:G,le=X<0?0:X;for(let xe=0;xe<_;++xe){let ge=G+xe*S;if(ge>=0&&ge<h)for(let Re=0;Re<I;++Re){let Ee=X+Re*k;if(Ee>=0&&Ee<f){let Ne=u[q][ge][Ee][te]+p[xe][Re][te];Ne>ne&&(ne=Ne,oe=ge,le=Ee)}}}B[q][oe][le][te]+=L[q][U][j][te]}}}return{dataId:l.write(C.toTypedArray(B,n.dtype),n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};function gWe(r){let{inputs:e,backend:t,attrs:n}=r,{image:o}=e,{canvas:s,options:i}=n,{contextOptions:a,imageOptions:c}=i||{},l=c?.alpha||1,u=a?.contextType||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);let p=s.getContext(u,a?.contextAttributes||{});if(p==null)throw new Error(`Could not get the context with ${u} type.`);let[d,h]=o.shape.slice(0,2),f=o.shape.length===2?1:o.shape[2],m=t.data.get(o.dataId).values,g=o.dtype==="float32"?255:1,y=new Uint8ClampedArray(h*d*4);for(let b=0;b<d*h;++b){let w=[0,0,0,255*l];for(let I=0;I<f;I++){let S=m[b*f+I];if(o.dtype==="float32"){if(S<0||S>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${S}.`)}else if(o.dtype==="int32"&&(S<0||S>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${S}.`);f===1?(w[0]=S*g,w[1]=S*g,w[2]=S*g):w[I]=S*g}let _=b*4;y[_+0]=Math.round(w[0]),y[_+1]=Math.round(w[1]),y[_+2]=Math.round(w[2]),y[_+3]=Math.round(w[3])}s.width=h,s.height=d;let x=new ImageData(y,h,d);return p.putImageData(x,0,0),o}var cie={kernelName:Fg,backendName:"cpu",kernelFunc:gWe};function qd(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;ye(o,"sum");let a;o.dtype==="bool"?a=Wa({inputs:{x:o},backend:t,attrs:{dtype:"int32"}}):a=es({inputs:{x:o},backend:t});let c=a.shape.length,l=C.parseAxisParam(s,a.shape),u=E.getAxesPermutation(l,c),p=l,d=a;u!=null&&(d=yn({inputs:{x:a},backend:t,attrs:{perm:u}}),p=E.getInnerMostAxes(p.length,c)),E.assertAxesAreInnerMostDims("sum",p,d.shape.length);let[h,f]=E.computeOutAndReduceShapes(d.shape,p),m=E.upcastType(d.dtype,"int32"),g=_b(t,h,m),y=C.sizeFromShape(f),x=t.data.get(g.dataId).values,b=t.data.get(d.dataId).values;for(let w=0;w<x.length;++w){let _=w*y,I=0;for(let S=0;S<y;++S)I+=b[_+S];x[w]=I}if(i){let w=E.expandShapeToKeepDim(g.shape,l),_=g;g=Wt({inputs:{x:g},backend:t,attrs:{shape:w}}),t.disposeIntermediateTensorInfo(_)}return t.disposeIntermediateTensorInfo(a),u!=null&&t.disposeIntermediateTensorInfo(d),g}var lie={kernelName:np,backendName:"cpu",kernelFunc:qd};function yWe(r){let{inputs:e,backend:t,attrs:n}=r,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:c}=E.decodeEinsumEquation(o,s.length);E.checkEinsumDimSizes(i.length,c,s);let{path:l,steps:u}=E.getEinsumComputePath(a,c),p=u.length,d=null,h=i.length,f=[];for(let m=0;m<p;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:x}=E.getEinsumPermutation(h,c[g]),b;E.isIdentityPermutation(y)?b=s[g]:(b=yn({inputs:{x:s[g]},backend:t,attrs:{perm:y}}),f.push(b));let w=b.shape.slice();for(let _=0;_<x.length;++_)w.splice(x[_],0,1);C.arraysEqual(b.shape,w)||(b=Wt({inputs:{x:b},backend:t,attrs:{shape:w}}),f.push(b)),d===null?d=b:(d=fy({inputs:{a:b,b:d},backend:t}),f.push(d))}m<p-1&&(l[m]>=0&&(d=qd({inputs:{x:d},backend:t,attrs:{axis:l[m]-(i.length-h),keepDims:!1}}),f.push(d)),h--)}for(let m of f)m!==d&&t.disposeIntermediateTensorInfo(m);return d}var uie={kernelName:of,backendName:"cpu",kernelFunc:yWe};function xWe(r){let{inputs:e,backend:t}=r,{dy:n,y:o}=e;ye([n,o],"eluGrad");let s=new Float32Array(C.sizeFromShape(o.shape)),i=t.data.get(o.dataId).values,a=t.data.get(n.dataId).values;for(let c=0;c<i.length;++c){let l=i[c];l>=0?s[c]=a[c]:s[c]=a[c]*(l+1)}return t.makeTensorInfo(o.shape,"float32",s)}var pie={kernelName:sf,backendName:"cpu",kernelFunc:xWe};var vWe=E.ERF_P,bWe=E.ERF_A1,wWe=E.ERF_A2,CWe=E.ERF_A3,_We=E.ERF_A4,SWe=E.ERF_A5,IWe=pt(Lc,r=>{let e=Math.sign(r),t=Math.abs(r),n=1/(1+vWe*t);return e*(1-((((SWe*n+_We)*n+CWe)*n+wWe)*n+bWe)*n*Math.exp(-t*t))}),die={kernelName:Lc,backendName:"cpu",kernelFunc:IWe};function Zb(r){let{inputs:e,backend:t,attrs:n}=r,{input:o}=e,{dim:s}=n,i=o.shape.length,a=o.shape.slice(),c=s;return s<0&&(C.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+s+1),a.splice(c,0,1),Wt({inputs:{x:o},backend:t,attrs:{shape:a}})}var hie={kernelName:Ou,backendName:"cpu",kernelFunc:Zb};var TWe=Gt((r,e)=>r/e),J_=er(Pc,TWe),eS={kernelName:Pc,backendName:"cpu",kernelFunc:J_};function UA(r,e,t){let n=r.shape,o=n[0],s=n[1],i=t.data.get(r.dataId),a=i.complexTensorInfos.real,c=i.complexTensorInfos.imag,l=[o,s],u=C.sizeFromShape(l),p=C.getTypedArrayFromDType("float32",u),d=C.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let y=Ha({inputs:{x:a},backend:t,attrs:{begin:[g,0],size:[1,s]}}),x=Ha({inputs:{x:c},backend:t,attrs:{begin:[g,0],size:[1,s]}}),b=uo({inputs:{real:y,imag:x},backend:t}),{real:w,imag:_}=kWe(b,e,t),I=E.mergeRealAndImagArrays(w,_);for(let S=0;S<s;S++){let k=E.getComplexWithIndex(I,S);p[g*s+S]=k.real,d[g*s+S]=k.imag}t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(b)}let h=t.makeTensorInfo(l,"float32",p),f=t.makeTensorInfo(l,"float32",d),m=uo({inputs:{real:h,imag:f},backend:t});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),m}function kWe(r,e,t){let n=C.sizeFromShape(r.shape),o=t.data.get(r.dataId),s=t.data.get(o.complexTensorInfos.real.dataId).values,i=t.data.get(o.complexTensorInfos.imag.dataId).values;if(EWe(n)){let a=xz(s,i,n,e,t),c=[r.shape[0],r.shape[1]];if(e){let l=t.makeTensorInfo(c,"float32",a.real),u=t.makeTensorInfo(c,"float32",a.imag),p=t.makeTensorInfo([],"float32",C.createScalarValue(n,"float32")),d=es({inputs:{x:p},backend:t}),h=eS.kernelFunc({inputs:{a:l,b:p},backend:t}),f=eS.kernelFunc({inputs:{a:u,b:d},backend:t}),m=t.data.get(h.dataId).values,g=t.data.get(f.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),{real:m,imag:g}}return a}else{let a=E.mergeRealAndImagArrays(s,i),c=NWe(a,n,e);return E.splitRealAndImagArrays(c)}}function EWe(r){return(r&r-1)===0}function xz(r,e,t,n,o){if(t===1)return{real:r,imag:e};let s=E.mergeRealAndImagArrays(r,e),i=t/2,a=E.complexWithEvenIndex(s),c=a.real,l=a.imag,u=[c.length],p=o.makeTensorInfo(u,"float32",c),d=o.makeTensorInfo(u,"float32",l),h=uo({inputs:{real:p,imag:d},backend:o}),f=E.complexWithOddIndex(s),m=f.real,g=f.imag,y=[m.length],x=o.makeTensorInfo(y,"float32",m),b=o.makeTensorInfo(y,"float32",g),w=uo({inputs:{real:x,imag:b},backend:o}),_=xz(c,l,i,n,o),I=_.real,S=_.imag,k=[I.length],R=o.makeTensorInfo(k,"float32",I),L=o.makeTensorInfo(k,"float32",S),B=uo({inputs:{real:R,imag:L},backend:o}),z=xz(m,g,i,n,o),q=z.real,U=z.imag,G=[q.length],j=o.makeTensorInfo(G,"float32",q),X=o.makeTensorInfo(G,"float32",U),te=uo({inputs:{real:j,imag:X},backend:o}),ne=E.exponents(t,n),oe=[ne.real.length],le=o.makeTensorInfo(oe,"float32",ne.real),xe=o.makeTensorInfo(oe,"float32",ne.imag),ge=uo({inputs:{real:le,imag:xe},backend:o}),Re=fy({inputs:{a:ge,b:te},backend:o}),Ee=Cp({inputs:{a:B,b:Re},backend:o}),Ne=k_({inputs:{a:B,b:Re},backend:o}),we=Ga({inputs:{input:Ee},backend:o}),qe=Ga({inputs:{input:Ne},backend:o}),Qe=Np({inputs:{input:Ee},backend:o}),De=Np({inputs:{input:Ne},backend:o}),Me=xm({inputs:[we,qe],backend:o,attrs:{axis:0}}),dt=xm({inputs:[Qe,De],backend:o,attrs:{axis:0}}),Be=o.data.get(Me.dataId).values,at=o.data.get(dt.dataId).values;return o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo(L),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(j),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(te),o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(Re),o.disposeIntermediateTensorInfo(Ee),o.disposeIntermediateTensorInfo(Ne),o.disposeIntermediateTensorInfo(we),o.disposeIntermediateTensorInfo(Qe),o.disposeIntermediateTensorInfo(qe),o.disposeIntermediateTensorInfo(De),o.disposeIntermediateTensorInfo(Me),o.disposeIntermediateTensorInfo(dt),{real:Be,imag:at}}function NWe(r,e,t){let n=new Float32Array(e*2);for(let o=0;o<e;o++){let s=0,i=0;for(let a=0;a<e;a++){let c=E.exponent(o*a,e,t),l=E.getComplexWithIndex(r,a);s+=l.real*c.real-l.imag*c.imag,i+=l.real*c.imag+l.imag*c.real}t&&(s/=e,i/=e),E.assignToTypedArray(n,s,i,o)}return n}function DWe(r){let{inputs:e,backend:t}=r,{input:n}=e,o=C.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=Wt({inputs:{x:n},backend:t,attrs:{shape:[i,s]}}),c=UA(a,!1,t),l=Wt({inputs:{x:c},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}var fie={kernelName:af,backendName:"cpu",kernelFunc:DWe};function tS(r){let{backend:e,attrs:t}=r,{shape:n,value:o,dtype:s}=t,i=s||C.inferDtype(o),a=C.getArrayFromDType(i,C.sizeFromShape(n));return AWe(a,o,i),e.makeTensorInfo(n,i,a)}var mie={kernelName:cf,backendName:"cpu",kernelFunc:tS};function AWe(r,e,t){r.fill(e)}var gie={kernelName:lf,backendName:"cpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{image:n}=r,o=t,s=C.getTypedArrayFromDType(n.dtype,C.sizeFromShape(n.shape)),[i,a,c,l]=n.shape,u=o.data.get(n.dataId).values;for(let d=0;d<i;d++){let h=d*c*a*l;for(let f=0;f<a;f++){let m=f*(c*l);for(let g=0;g<c;g++){let y=g*l;for(let x=0;x<l;x++){let b=Math.round(c-g-1),w=h+m+y+x,_=u[w];if(b>=0&&b<c){let I=b*l,S=h+m+I+x;_=u[S]}s[w]=_}}}}return{dataId:o.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};function RWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=n,m=gz({inputs:{x:o,filter:s},backend:t,attrs:{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d}});if(i){let g=m;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){let y=Wt({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});m=Cp({inputs:{a:m,b:y},backend:t}),t.disposeIntermediateTensorInfo(y)}else m=Cp({inputs:{a:m,b:i},backend:t});t.disposeIntermediateTensorInfo(g)}if(h){let g=m;if(u==="NCHW"&&h==="prelu"&&a.shape.length===1&&a.shape[0]!==1){let y=Wt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});m=Iy(t,m,h,y,f),t.disposeIntermediateTensorInfo(y)}else m=Iy(t,m,h,a,f);t.disposeIntermediateTensorInfo(g)}return m}var yie={kernelName:_d,backendName:"cpu",kernelFunc:RWe};function OWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=n,m=yz({inputs:{x:o,filter:s},backend:t,attrs:{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d}});if(i){let g=m;m=Cp({inputs:{a:m,b:i},backend:t}),t.disposeIntermediateTensorInfo(g)}if(h){let g=m;m=Iy(t,m,h,a,f),t.disposeIntermediateTensorInfo(g)}return m}var xie={kernelName:Sd,backendName:"cpu",kernelFunc:OWe};function MWe(r){let{inputs:e,backend:t}=r,{params:n,indices:o}=e,s=C.sizeFromShape(n.shape),i=o.shape,a=i[i.length-1],[c,l,u,p]=E.prepareAndValidate(n,o);if(l===0)return t.makeTensorInfo(c,n.dtype,[]);let d=t.data.get(o.dataId).values,h=t.bufferSync(n),f=dN(d,h,n.dtype,l,a,u,p,n.shape,s);return t.makeTensorInfo(c,n.dtype,f.values)}var vie={kernelName:uf,backendName:"cpu",kernelFunc:MWe};function FWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,indices:s}=e,{axis:i,batchDims:a}=n;ye([o,s],"gatherV2");let c=C.parseAxisParam(i,o.shape)[0],l=t.data.get(s.dataId).values,u=o.shape[c];for(let w=0;w<l.length;++w){let _=l[w];C.assert(_<=u-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${u-1}]`)}let p=a;a==null&&(p=0);let d=C.sizeFromShape(s.shape),h=E.segment_util.collectGatherOpShapeInfo(o,s,c,p),f=Wt({inputs:{x:o},backend:t,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),m=Wt({inputs:{x:s},backend:t,attrs:{shape:[h.batchSize,d/h.batchSize]}}),g=[h.batchSize,h.outerSize,d/h.batchSize,h.sliceSize],y=t.bufferSync(m),x=t.bufferSync(f),b=hN(x,y,g);return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.makeTensorInfo(h.outputShape,b.dtype,b.values)}var bie={kernelName:Fu,backendName:"cpu",kernelFunc:FWe};function PWe(r){let{inputs:e,backend:t}=r,{input:n}=e,o=C.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=Wt({inputs:{x:n},backend:t,attrs:{shape:[i,s]}}),c=UA(a,!0,t),l=Wt({inputs:{x:c},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(c),l}var wie={kernelName:pf,backendName:"cpu",kernelFunc:PWe};var $We=pt(Wc,r=>Number.isFinite(r)?1:0,"bool"),Cie={kernelName:Wc,backendName:"cpu",kernelFunc:$We};var LWe=pt(jc,r=>Math.abs(r)===1/0?1:0,"bool"),_ie={kernelName:jc,backendName:"cpu",kernelFunc:LWe};var VWe=pt(Hc,r=>Number.isNaN(r)?1:0,"bool"),Sie={kernelName:Hc,backendName:"cpu",kernelFunc:VWe};function BWe(r){let{backend:e,attrs:t}=r,{start:n,stop:o,num:s}=t,i=fN(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var Iie={kernelName:hf,backendName:"cpu",kernelFunc:BWe};var zWe=pt(Kc,r=>Math.log1p(r)),Tie={kernelName:Kc,backendName:"cpu",kernelFunc:zWe};var UWe=Gt((r,e)=>r&&e),GWe=er(xd,UWe,null,"bool"),kie={kernelName:xd,backendName:"cpu",kernelFunc:GWe};var WWe=pt(vd,r=>r?0:1,"bool"),Eie={kernelName:vd,backendName:"cpu",kernelFunc:WWe};var jWe=Gt((r,e)=>r||e),HWe=er(bd,jWe,null,"bool"),Nie={kernelName:bd,backendName:"cpu",kernelFunc:HWe};function qWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:c}=n;ye(o,"LRN");let l=o.shape[3],u=l-1,p=t.data.get(o.dataId).values,d=C.sizeFromShape(o.shape),h=new Float32Array(d);function f(m){let g=m%l,y=m-g+Math.max(0,g-s),x=m-g+Math.min(g+s,u),b=0;for(;y<=x;y++){let w=p[y];b+=w*w}return b}for(let m=0;m<d;m++){let g=f(m),y=p[m]*Math.pow(i+a*g,-c);h[m]=y}return t.makeTensorInfo(o.shape,o.dtype,h)}var Die={kernelName:$u,backendName:"cpu",kernelFunc:qWe};function KWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:u}=n;ye(i,"LRNGrad");let p=C.sizeFromShape(i.shape),d=i.shape[3],h=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,m=t.data.get(s.dataId).values,g=new Float32Array(p),y=p;for(let x=0;x<y;x++){let b=x%d,w=x-b+Math.max(0,b-a),_=x-b+Math.min(d,b+a+1),I=0;for(let S=w;S<_;S++)I+=Math.pow(f[S],2);I=l*I+c;for(let S=w;S<_;S++){let k=-2*l*u*f[S]*m[x]/I;x===S&&(k+=Math.pow(I,-u)),k*=h[x],g[S]+=k}}return t.makeTensorInfo(i.shape,o.dtype,g)}var Aie={kernelName:ff,backendName:"cpu",kernelFunc:KWe};function vz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=t,c=o.shape,l=c.length,u=C.parseAxisParam(s,c),p=u,d=E.getAxesPermutation(p,l),h=a.data.get(o.dataId).values;if(d!=null){let w=new Array(l);for(let _=0;_<w.length;_++)w[_]=c[d[_]];h=Tb(h,c,o.dtype,d,w),p=E.getInnerMostAxes(p.length,l),c=w}ye(o,"max"),E.assertAxesAreInnerMostDims("max",p,l);let[f,m]=E.computeOutAndReduceShapes(c,p),g=C.sizeFromShape(m),y=mN(h,g,f,o.dtype),x=a.write(y,f,o.dtype),b=f;return i&&(b=E.expandShapeToKeepDim(f,u)),{dataId:x,shape:b,dtype:o.dtype}}var Rie={kernelName:Lu,backendName:"cpu",kernelFunc:vz};function XWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e;ye(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,l=1;C.assert(E.eitherStridesOrDilationsAreOne(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);let u=E.computePool2DInfo(o.shape,s,i,l,a,c),p;if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))p=es({inputs:{x:o},backend:t});else{let d=t.data.get(o.dataId).values,h=C.computeStrides(o.shape),f=Yb(d,o.shape,o.dtype,h,u,"max");p=t.makeTensorInfo(u.outShape,o.dtype,f.values)}return p}var Oie={kernelName:Vu,backendName:"cpu",kernelFunc:XWe};function YWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=n;ye(o,"maxPool3d");let u=E.computePool3DInfo(o.shape,s,i,1,a,c,l),p=t.data.get(o.dataId).values,d=zA(p,o.shape,o.dtype,C.computeStrides(o.shape),u,"max");return t.makeTensorInfo(d.shape,"float32",d.values)}var Mie={kernelName:Bu,backendName:"cpu",kernelFunc:YWe};function ZWe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:c,dimRoundingMode:l}=n;ye([o,s],"maxPool3DGrad");let u=E.computePool3DInfo(s.shape,i,a,1,c,l),p=t.bufferSync(s),d=Nse(p,u),h=u.strideDepth,f=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,y=u.dilationHeight,x=u.dilationWidth,b=u.effectiveFilterDepth,w=u.effectiveFilterHeight,_=u.effectiveFilterWidth,I=b-1-u.padInfo.front,S=_-1-u.padInfo.left,k=w-1-u.padInfo.top,R=ze(s.shape,"float32"),L=t.bufferSync(o);for(let B=0;B<u.batchSize;++B)for(let z=0;z<u.inChannels;++z)for(let q=0;q<u.inDepth;++q)for(let U=0;U<u.inHeight;++U)for(let G=0;G<u.inWidth;++G){let j=q-I,X=U-k,te=G-S,ne=0;for(let oe=0;oe<b;oe+=g){let le=(j+oe)/h;if(!(le<0||le>=u.outDepth||Math.floor(le)!==le))for(let xe=0;xe<w;xe+=y){let ge=(X+xe)/f;if(!(ge<0||ge>=u.outHeight||Math.floor(ge)!==ge))for(let Re=0;Re<_;Re+=x){let Ee=(te+Re)/m;if(Ee<0||Ee>=u.outWidth||Math.floor(Ee)!==Ee)continue;let Ne=b*w*_-1-d.get(B,le,ge,Ee,z),we=oe*w*_+xe*_+Re,qe=Ne===we?1:0;if(qe===0)continue;let Qe=L.get(B,le,ge,Ee,z);ne+=Qe*qe}}}R.set(ne,B,q,U,G,z)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var Fie={kernelName:gf,backendName:"cpu",kernelFunc:ZWe};function QWe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s,output:i}=e,a=s;ye([s,i],"maxPoolGrad");let{filterSize:c,strides:l,pad:u,dimRoundingMode:p}=n,d=E.computePool2DInfo(a.shape,c,l,1,u,p),h=t.data.get(a.dataId).values,f=ze(d.outShape,a.dtype,BA(h,a.shape,a.dtype,d).values),m=d.strideHeight,g=d.strideWidth,y=d.dilationHeight,x=d.dilationWidth,b=d.effectiveFilterHeight,w=d.effectiveFilterWidth,_=w-1-d.padInfo.left,I=b-1-d.padInfo.top,S=ze(a.shape,"float32"),k=t.data.get(o.dataId).values,R=ze(o.shape,"float32",k);for(let L=0;L<d.batchSize;++L)for(let B=0;B<d.inChannels;++B)for(let z=0;z<d.inHeight;++z)for(let q=0;q<d.inWidth;++q){let U=z-I,G=q-_,j=0;for(let X=0;X<b;X+=y){let te=(U+X)/m;if(!(te<0||te>=d.outHeight||Math.floor(te)!==te))for(let ne=0;ne<w;ne+=x){let oe=(G+ne)/g;if(oe<0||oe>=d.outWidth||Math.floor(oe)!==oe)continue;let le=b*w-1-f.get(L,te,oe,B),xe=X*w+ne,ge=le===xe?1:0;if(ge===0)continue;let Re=R.get(L,te,oe,B);j+=Re*ge}}S.set(j,L,z,q,B)}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var Pie={kernelName:mf,backendName:"cpu",kernelFunc:QWe};function $ie(r,e,t,n,o){let s=C.computeStrides(e),i=Yb(r,e,t,s,o,"max"),a=BA(r,e,t,o,!0,n);return[i.values,a.values]}var Lie={kernelName:yf,backendName:"cpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{x:n}=r,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,c=t;ye(n,"MaxPoolWithArgmax");let l=c.data.get(n.dataId).values,u=E.computePool2DInfo(n.shape,o,s,[1,1],i),[p,d]=$ie(l,n.shape,n.dtype,a,u),h=c.write(p,u.outShape,n.dtype),f=c.write(d,u.outShape,n.dtype);return[{dataId:h,shape:u.outShape,dtype:n.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};function JWe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n,a=C.parseAxisParam(s,o.shape),l=E.computeOutAndReduceShapes(o.shape,a)[1],u=C.sizeFromShape(l),p=[],d=t.makeTensorInfo([],"float32",new Float32Array([u]));p.push(d);let h=Wa({inputs:{x:o},backend:t,attrs:{dtype:"float32"}});p.push(h);let f=J_({inputs:{a:h,b:d},backend:t});p.push(f);let m=qd({inputs:{x:f},backend:t,attrs:{axis:s,keepDims:i}});return p.forEach(g=>t.disposeIntermediateTensorInfo(g)),m}var Vie={kernelName:zu,backendName:"cpu",kernelFunc:JWe};function e4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;ye(o,"min");let a=C.parseAxisParam(s,o.shape),c=a,l=E.getAxesPermutation(c,o.shape.length),u=o;l!=null&&(u=yn({inputs:{x:o},backend:t,attrs:{perm:l}}),c=E.getInnerMostAxes(c.length,o.shape.length)),E.assertAxesAreInnerMostDims("min",c,u.shape.length);let[p,d]=E.computeOutAndReduceShapes(u.shape,c),h=C.sizeFromShape(d),f=C.makeZerosTypedArray(C.sizeFromShape(p),u.dtype),m=t.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let x=y*h,b=m[x];for(let w=0;w<h;++w){let _=m[x+w];(Number.isNaN(_)||_<b)&&(b=_)}f[y]=b}l!=null&&t.disposeIntermediateTensorInfo(u);let g=t.makeTensorInfo(p,u.dtype,f);if(i){let y=E.expandShapeToKeepDim(p,a),x=Wt({inputs:{x:g},backend:t,attrs:{shape:y}});return t.disposeIntermediateTensorInfo(g),x}return g}var Bie={kernelName:Uu,backendName:"cpu",kernelFunc:e4e};function t4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{paddings:s,mode:i}=n;ye(o,"mirrorPad");let a=s.map((b,w)=>b[0]+o.shape[w]+b[1]),c=s.map(b=>b[0]),l=s.map((b,w)=>b[0]+o.shape[w]),u=i==="reflect"?0:1,p=t.data.get(o.dataId).values,d=o.shape.length,h=C.computeStrides(o.shape),f=C.sizeFromShape(a),m=a.length,g=C.computeStrides(a),y=C.getTypedArrayFromDType(o.dtype,f);for(let b=0;b<f;b++){let w=C.indexToLoc(b,m,g);for(let I=0;I<m;I++)w[I]<c[I]?w[I]=c[I]*2-w[I]-u:w[I]>=l[I]&&(w[I]=(l[I]-1)*2-w[I]+u);w=w.map((I,S)=>I-c[S]);let _=C.locToIndex(w,d,h);y[b]=p[_]}return{dataId:t.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var zie={kernelName:Gu,backendName:"cpu",kernelFunc:t4e};var r4e=Gt((r,e)=>{let t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e}),n4e=er(Zc,r4e),Uie={kernelName:Zc,backendName:"cpu",kernelFunc:n4e};var Wie=Wp(c_());function bz(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{dim:s}=n,i=o.shape.length,a=s;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);let c=C.parseAxisParam([a],o.shape),l=vz({inputs:{x:o},backend:t,attrs:{reductionIndices:c,keepDims:!1}}),u=E.expandShapeToKeepDim(l.shape,c),p=Wt({inputs:{x:l},backend:t,attrs:{shape:u}}),d=k_({inputs:{a:o,b:p},backend:t}),h=kV({inputs:{x:d},backend:t}),f=qd({inputs:{x:h},backend:t,attrs:{axis:c,keepDims:!1}}),m=Wt({inputs:{x:f},backend:t,attrs:{shape:u}}),g=J_({inputs:{a:h,b:m},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),g}var Gie={kernelName:ip,backendName:"cpu",kernelFunc:bz};function o4e(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n;ye(o,"multinomial");let c=a?o:bz({inputs:{logits:o},backend:t,attrs:{dim:-1}}),l=c.shape[0],u=c.shape[1],p=t.data.get(c.dataId).values,d=[l,s],h=C.makeZerosTypedArray(C.sizeFromShape(d),"int32");for(let f=0;f<l;++f){let m=f*u,g=new Float32Array(u-1);g[0]=p[m];for(let b=1;b<g.length;++b)g[b]=g[b-1]+p[m+b];let y=Wie.alea(i.toString()),x=f*s;for(let b=0;b<s;++b){let w=y();h[x+b]=g.length;for(let _=0;_<g.length;_++)if(w<g[_]){h[x+b]=_;break}}}return a||t.disposeIntermediateTensorInfo(c),t.makeTensorInfo(d,"int32",h)}var jie={kernelName:xf,backendName:"cpu",kernelFunc:o4e};var s4e=to.nonMaxSuppressionV3Impl;function i4e(r){let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=n;ye(o,"NonMaxSuppression");let l=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values,{selectedIndices:p}=s4e(l,u,i,a,c);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}var Hie={kernelName:vf,backendName:"cpu",kernelFunc:i4e};var a4e=to.nonMaxSuppressionV4Impl;function c4e(r){let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=n;ye(o,"NonMaxSuppressionPadded");let u=t.data.get(o.dataId).values,p=t.data.get(s.dataId).values,{selectedIndices:d,validOutputs:h}=a4e(u,p,i,a,c,l);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([h]))]}var qie={kernelName:xv,backendName:"cpu",kernelFunc:c4e};var l4e=to.nonMaxSuppressionV5Impl;function u4e(r){let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=n;ye(o,"NonMaxSuppressionWithScore");let u=t.data.get(o.dataId).values,p=t.data.get(s.dataId).values,d=i,h=a,f=c,m=l,{selectedIndices:g,selectedScores:y}=l4e(u,p,d,h,f,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Kie={kernelName:bf,backendName:"cpu",kernelFunc:u4e};function p4e(r){let{inputs:e,backend:t,attrs:n}=r,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:c}=n;ye(o,"oneHot");let l=C.sizeFromShape(o.shape),u=new Float32Array(l*i);u.fill(c);let p=t.data.get(o.dataId).values;for(let d=0;d<l;++d)p[d]>=0&&p[d]<i&&(u[d*i+p[d]]=a);return t.makeTensorInfo([...o.shape,i],s,u)}var Xie={kernelName:Hu,backendName:"cpu",kernelFunc:p4e};function rS(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){let o=Ga({inputs:{input:n},backend:t}),s=rS({inputs:{x:o},backend:t}),i=Np({inputs:{input:n},backend:t}),a=rS({inputs:{x:i},backend:t}),c=uo({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return tS({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var Yie={kernelName:lp,backendName:"cpu",kernelFunc:rS};function Zie(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){let o=Ga({inputs:{input:n},backend:t}),s=Zie({inputs:{x:o},backend:t}),i=Np({inputs:{input:n},backend:t}),a=rS({inputs:{x:i},backend:t}),c=uo({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return tS({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var Qie={kernelName:ju,backendName:"cpu",kernelFunc:Zie};function wz(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n;if(e.length===1)return Zb({inputs:{input:e[0]},backend:t,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(u=>{C.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),C.assert(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],c=e.map(u=>{let p=Zb({inputs:{input:u},backend:t,attrs:{dim:o}});return a.push(p),p}),l=xm({inputs:c,backend:t,attrs:{axis:o}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),l}var Jie={kernelName:qu,backendName:"cpu",kernelFunc:wz};function d4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{paddings:s,constantValue:i}=n;ye(o,"pad");let a=s.map((x,b)=>x[0]+o.shape[b]+x[1]),c=s.map(x=>x[0]),l=t.data.get(o.dataId).values,u=C.sizeFromShape(o.shape),p=o.shape.length,d=C.computeStrides(o.shape),h=C.sizeFromShape(a),f=a.length,m=C.computeStrides(a),g=C.getTypedArrayFromDType(o.dtype,h);i!==0&&g.fill(i);for(let x=0;x<u;x++){let w=C.indexToLoc(x,p,d).map((I,S)=>I+c[S]),_=C.locToIndex(w,f,m);g[_]=l[x]}return{dataId:t.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var GA={kernelName:Ku,backendName:"cpu",kernelFunc:d4e};var h4e=Gt((r,e)=>Math.pow(r,e)),f4e=er(Jc,h4e),eae={kernelName:Jc,backendName:"cpu",kernelFunc:f4e};function m4e(r){let{inputs:e,backend:t,attrs:n}=r,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,c=o.map(y=>t.data.get(y.dataId).values),l=o.map(y=>y.shape),u=t.data.get(s.dataId).values,p=t.data.get(i.dataId).values,[d,h,f]=gN(c,l,u,s.shape,s.dtype,p,i.shape,a),m=d.map(y=>t.makeTensorInfo([y.length],"int32",y)),g=t.makeTensorInfo(f,s.dtype,h);return m.concat([g])}var tae={kernelName:vv,backendName:"cpu",kernelFunc:m4e};function g4e(r){let{inputs:e,backend:t}=r,{starts:n,limits:o,deltas:s}=e,i=t.data.get(n.dataId).values,a=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,[l,u]=yN(i,n.shape,n.dtype,a,o.shape,c,s.shape),p=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([u.length],n.dtype,u);return[p,d]}var rae={kernelName:bv,backendName:"cpu",kernelFunc:g4e};function y4e(r){let{inputs:e,backend:t,attrs:n}=r,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=n,l=t.data.get(o.dataId).values,u=t.data.get(s.dataId).values,p=t.data.get(i.dataId).values,d=a.map(g=>t.data.get(g.dataId).values),h=a.map(g=>g.shape),[f,m]=xN(l,o.shape,u,s.shape,s.dtype,p,i.shape,d,h,c);return t.makeTensorInfo(f,s.dtype,m)}var nae={kernelName:wv,backendName:"cpu",kernelFunc:y4e};function x4e(r){let{backend:e,attrs:t}=r,{start:n,stop:o,dtype:s,step:i}=t,a=vN(n,o,i,s);return e.makeTensorInfo([a.length],s,a)}var oae={kernelName:wf,backendName:"cpu",kernelFunc:x4e};var v4e=pt(el,r=>1/r),sae={kernelName:el,backendName:"cpu",kernelFunc:v4e};function b4e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ye(o,"resizeBilinear");let c=C.computeStrides(o.shape),[l,u]=a,[p,d,h,f]=o.shape,m=t.data.get(o.dataId).values,g=new Float32Array(C.sizeFromShape([p,l,u,f])),y=[s&&l>1?d-1:d,s&&u>1?h-1:h],x=[s&&l>1?l-1:l,s&&u>1?u-1:u],b=0,w=y[0]/x[0],_=y[1]/x[1];for(let I=0;I<p;I++)for(let S=0;S<l;S++){let k;i?k=w*(S+.5)-.5:k=w*S;let R=Math.max(0,Math.floor(k)),L=k-R,B=Math.min(d-1,Math.ceil(k)),z=I*c[0]+R*c[1],q=I*c[0]+B*c[1];for(let U=0;U<u;U++){let G;i?G=_*(U+.5)-.5:G=_*U;let j=Math.max(0,Math.floor(G)),X=G-j,te=Math.min(h-1,Math.ceil(G)),ne=z+j*c[2],oe=q+j*c[2],le=z+te*c[2],xe=q+te*c[2];for(let ge=0;ge<f;ge++){let Re=m[ne+ge],Ee=m[oe+ge],Ne=m[le+ge],we=m[xe+ge],qe=Re+(Ne-Re)*X,Qe=Ee+(we-Ee)*X,De=qe+(Qe-qe)*L;g[b++]=De}}}return t.makeTensorInfo([p,l,u,f],"float32",g)}var iae={kernelName:Ju,backendName:"cpu",kernelFunc:b4e};function w4e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n;ye([s,o],"resizeBilinearGrad");let a=C.computeStrides(o.shape),[c,l,u,p]=o.shape,[,d,h]=s.shape,f=new Float32Array(c*l*u*p),m=[i&&d>1?l-1:l,i&&h>1?u-1:u],g=[i&&d>1?d-1:d,i&&h>1?h-1:h],y=m[0]/g[0],x=m[1]/g[1],b=t.data.get(s.dataId).values,w=0;for(let _=0;_<c;_++){let I=_*a[0];for(let S=0;S<d;S++){let k=S*y,R=Math.floor(k),L=Math.min(Math.ceil(k),l-1),B=I+R*a[1],z=I+L*a[1],q=k-R,U=1-q;for(let G=0;G<h;G++){let j=G*x,X=Math.floor(j),te=Math.min(Math.ceil(j),u-1),ne=j-X,oe=1-ne,le=B+X*a[2],xe=B+te*a[2],ge=z+X*a[2],Re=z+te*a[2],Ee=U*oe,Ne=U*ne,we=q*oe,qe=q*ne;for(let Qe=0;Qe<p;Qe++){let De=b[w++];f[le+Qe]+=De*Ee,f[xe+Qe]+=De*Ne,f[ge+Qe]+=De*we,f[Re+Qe]+=De*qe}}}}return t.makeTensorInfo([c,u,l,p],"float32",f)}var aae={kernelName:Sf,backendName:"cpu",kernelFunc:w4e};function C4e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ye(o,"resizeNearestNeighbor");let c=C.computeStrides(o.shape),[l,u]=a,[p,d,h,f]=o.shape,m=t.data.get(o.dataId).values,g=new Float32Array(p*l*u*f),y=[s&&l>1?d-1:d,s&&u>1?h-1:h],x=[s&&l>1?l-1:l,s&&u>1?u-1:u],b=y[0]/x[0],w=y[1]/x[1],_=0;for(let I=0;I<p;I++){let S=I*c[0];for(let k=0;k<l;k++){let R=i?b*(k+.5):b*k,L=Math.min(d-1,s?Math.round(R):Math.floor(R));i&&(L=Math.max(0,L));let B=S+L*c[1];for(let z=0;z<u;z++){let q=i?w*(z+.5):w*z,U=Math.min(h-1,s?Math.round(q):Math.floor(q));i&&(U=Math.max(0,U));let G=B+U*c[2];for(let j=0;j<f;j++){let X=m[G+j];g[_++]=X}}}}return t.makeTensorInfo([p,l,u,f],o.dtype,g)}var cae={kernelName:Qu,backendName:"cpu",kernelFunc:C4e};function _4e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n;ye([s,o],"resizeNearestNeighborGrad");let a=C.computeStrides(o.shape),c=C.computeStrides(s.shape),[l,u,p,d]=o.shape,[,h,f]=s.shape,m=new Float32Array(l*u*p*d),g=t.data.get(s.dataId).values,y=[i&&h>1?u-1:u,i&&f>1?p-1:p],x=[i&&h>1?h-1:h,i&&f>1?f-1:f],b=y[0]/x[0],w=y[1]/x[1],_=1/b,I=1/w,S=Math.ceil(_)*2+2,k=Math.ceil(I)*2+2;for(let R=0;R<l;R++){let L=R*a[0];for(let B=0;B<u;B++){let z=L+B*a[1],q=Math.floor(B*_),U=Math.floor(q-S/2);for(let G=0;G<p;G++){let j=z+G*a[2],X=Math.floor(G*I),te=Math.floor(X-k/2);for(let ne=0;ne<d;ne++){let oe=0;for(let le=0;le<S;le++){let xe=le+U;if(xe<0||xe>=h)continue;let ge=L+xe*c[1],Re=xe*b,Ee=Math.min(u-1,i?Math.round(Re):Math.floor(Re));if(B===Ee)for(let Ne=0;Ne<k;Ne++){let we=Ne+te;if(we<0||we>=f)continue;let qe=ge+we*c[2],Qe=we*w,De=Math.min(p-1,i?Math.round(Qe):Math.floor(Qe));G===De&&(oe+=g[qe+ne])}}m[j+ne]=oe}}}}return t.makeTensorInfo(o.shape,o.dtype,m)}var lae={kernelName:_f,backendName:"cpu",kernelFunc:_4e};function S4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dims:s}=n;ye(o,"reverse");let i=o.shape.length,a=C.parseAxisParam(s,o.shape);if(i===0)return es({inputs:{x:o},backend:t});let c=new ur(o.shape,o.dtype),l=t.bufferSync(o);for(let u=0;u<c.size;u++){let p=c.indexToLoc(u),d=p.slice();a.forEach(h=>d[h]=o.shape[h]-1-d[h]),c.set(l.get(...d),...p)}return t.makeTensorInfo(c.shape,c.dtype,c.values)}var uae={kernelName:ep,backendName:"cpu",kernelFunc:S4e};var pae={kernelName:Pf,backendName:"cpu",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{image:n}=r,{radians:o,fillValue:s,center:i}=e,a=t,c=C.getTypedArrayFromDType(n.dtype,C.sizeFromShape(n.shape)),[l,u,p,d]=n.shape,[h,f]=E.getImageCenter(i,u,p),m=255,g=Math.sin(o),y=Math.cos(o),x=a.data.get(n.dataId).values;for(let w=0;w<l;w++){let _=w*p*u*d;for(let I=0;I<u;I++){let S=I*(p*d);for(let k=0;k<p;k++){let R=k*d;for(let L=0;L<d;L++){let B=[l,I,k,L],z=B[2],q=B[1],U=(z-h)*y-(q-f)*g,G=(z-h)*g+(q-f)*y;U=Math.round(U+h),G=Math.round(G+f);let j=s;if(typeof s!="number"&&(L===3?j=m:j=s[L]),U>=0&&U<p&&G>=0&&G<u){let te=G*(p*d),ne=U*d,oe=_+te+ne+L;j=x[oe]}let X=_+S+R+L;c[X]=j}}}}return{dataId:a.write(c,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};var I4e=pt(nl,r=>{let e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),dae={kernelName:nl,backendName:"cpu",kernelFunc:I4e};function T4e(r){let{inputs:e,backend:t,attrs:n}=r,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:p}=E.calculateShapes(s,o,i),d=!0,h=t.bufferSync(o),f=t.bufferSync(s),m=kl(h,f,i,p,l,c,a,u,0,d);return t.makeTensorInfo(i,m.dtype,m.values)}var hae={kernelName:If,backendName:"cpu",kernelFunc:T4e};function k4e(r,e){let t=0,n=r.length,o=0;for(;t<n;)o=Math.floor((t+n)/2),r[o]<e?t=o+1:n=o;return n}function E4e(r,e){let t=0,n=r.length,o=0;for(;t<n;)o=Math.floor((t+n)/2),r[o]<=e?t=o+1:n=o;return n}function fae(r,e,t,n,o,s){let i=C.getArrayFromDType("int32",t*o);for(let a=0;a<t;++a){let c=r.slice(a*n,(a+1)*n),l=a*o;for(let u=0;u<o;++u)i[l+u]=s==="left"?k4e(c,e[u+l]):E4e(c,e[u+l])}return i}function N4e(r){let{inputs:e,backend:t,attrs:n}=r,{sortedSequence:o,values:s}=e,{side:i}=n,a=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,l=fae(a,c,o.shape[0],o.shape[1],s.shape[1],i);return t.makeTensorInfo(s.shape,"int32",l)}var mae={kernelName:kf,backendName:"cpu",kernelFunc:N4e};function D4e(r){let{inputs:e,backend:t}=r,{condition:n,t:o,e:s}=e;ye([n,o,s],"select");let i=n.shape.length,a=t.data.get(n.dataId).values,c=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,u=$r(o.dtype,s.dtype),p=C.makeZerosTypedArray(C.sizeFromShape(o.shape),u),d=0,h=i===0||i>1||o.shape.length===1?1:C.sizeFromShape(o.shape.slice(1));for(let f=0;f<a.length;f++)for(let m=0;m<h;m++)a[f]===1?p[d++]=c[f]:p[d++]=l[f];return t.makeTensorInfo(o.shape,u,p)}var gae={kernelName:tp,backendName:"cpu",kernelFunc:D4e};var A4e=E.SELU_SCALEALPHA,R4e=E.SELU_SCALE,O4e=pt(sl,r=>r>=0?R4e*r:A4e*(Math.exp(r)-1)),yae={kernelName:sl,backendName:"cpu",kernelFunc:O4e};var M4e=pt(cl,r=>r<0?-1:r>0?1:0),xae={kernelName:cl,backendName:"cpu",kernelFunc:M4e};var F4e=pt(il,r=>Math.sin(r)),vae={kernelName:il,backendName:"cpu",kernelFunc:F4e};var P4e=pt(al,r=>Math.sinh(r)),bae={kernelName:al,backendName:"cpu",kernelFunc:P4e};var $4e=11920928955078125e-23,wae=Math.log($4e)+2,L4e=pt(ul,r=>{let e=r>-wae,t=r<wae,n=Math.exp(r),o;return t?o=n:e?o=r:o=Math.log(1+n),o}),Cae={kernelName:ul,backendName:"cpu",kernelFunc:L4e};function V4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,paddings:i}=n;ye([o],"spaceToBatchND");let a=C.sizeFromShape(s),c=[[0,0]];c.push(...i);for(let I=1+s.length;I<o.shape.length;++I)c.push([0,0]);let l=GA.kernelFunc({inputs:{x:o},backend:t,attrs:{paddings:c,constantValue:0}}),u=E.getReshaped(l.shape,s,a,!1),p=E.getPermuted(u.length,s.length,!1),d=E.getReshapedPermuted(l.shape,s,a,!1),m=Wt({inputs:{x:l},backend:t,attrs:{shape:u}}),x=yn({inputs:{x:m},backend:t,attrs:{perm:p}}),_=Wt({inputs:{x},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(x),_}var _ae={kernelName:op,backendName:"cpu",kernelFunc:V4e};function B4e(r){let{inputs:e,backend:t}=r,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=t.data.get(n.dataId).values,c=t.data.get(o.dataId).values,l=t.data.get(s.dataId).values,u=t.data.get(i.dataId).values[0],[p,d,h,f,m]=bN(a,n.shape,n.dtype,c,o.dtype,l,u);return[t.makeTensorInfo(d,n.dtype,p),t.makeTensorInfo([d[0]],o.dtype,h),t.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),t.makeTensorInfo([m.length],n.dtype,new Int32Array(m))]}var Sae={kernelName:Cv,backendName:"cpu",kernelFunc:B4e};function z4e(r){let{inputs:e,backend:t}=r,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(t.data.get(o.dataId).values),a=t.data.get(n.dataId).values,c=Array.from(t.data.get(s.dataId).values),[l,u,p]=wN(a,n.shape,n.dtype,i,c);return[t.makeTensorInfo(u,n.dtype,l),t.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var Iae={kernelName:_v,backendName:"cpu",kernelFunc:z4e};function U4e(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=t.data.get(n.dataId).values,a=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,[l,u]=kb(i,n.shape,n.dtype,a,c,!0);return t.makeTensorInfo(u,n.dtype,l)}var Tae={kernelName:Ef,backendName:"cpu",kernelFunc:U4e};function G4e(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=t.data.get(n.dataId).values,a=t.data.get(o.dataId).values,c=t.data.get(s.dataId).values,[l,u]=kb(i,n.shape,n.dtype,a,c);return t.makeTensorInfo(u,n.dtype,l)}var kae={kernelName:Nf,backendName:"cpu",kernelFunc:G4e};function W4e(r){let{inputs:e,backend:t,attrs:n}=r,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:c,numUpdates:l,sliceSize:u,strides:p,outputSize:d}=E.calculateShapes(s,o,a),h=!1,f=t.bufferSync(o),m;switch(s.dtype){case"bool":{let g=t.bufferSync(s),y=!!t.data.get(i.dataId).values[0];m=kl(f,g,a,d,u,l,c,p,y,h);break}case"float32":{let g=t.bufferSync(s),y=t.data.get(i.dataId).values[0];m=kl(f,g,a,d,u,l,c,p,y,h);break}case"int32":{let g=t.bufferSync(s),y=t.data.get(i.dataId).values[0];m=kl(f,g,a,d,u,l,c,p,y,h);break}case"string":{let g=t.bufferSync(s),y=C.decodeString(t.data.get(i.dataId).values[0]);m=kl(f,g,a,d,u,l,c,p,y,h);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return t.makeTensorInfo(a,m.dtype,m.values)}var Eae={kernelName:Df,backendName:"cpu",kernelFunc:W4e};function j4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=C.parseAxisParam(i,o.shape)[0],c=E.prepareSplitSize(o,s,a),l=new Array(o.shape.length).fill(0),u=o.shape.slice();return c.map(p=>{let d=[...u];d[a]=p;let h=Ha({inputs:{x:o},backend:t,attrs:{begin:l,size:d}});return l[a]+=p,h})}var Nae={kernelName:sp,backendName:"cpu",kernelFunc:j4e};var Dae={kernelName:Af,backendName:"cpu",kernelFunc:({inputs:r,backend:e})=>{let{x:t}=r,n=e;ye(t,"square");let o=n.data.get(t.dataId).values,s=new Float32Array(o.length);for(let a=0;a<o.length;++a){let c=o[a];s[a]=c*c}return{dataId:n.write(s,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};var H4e=pt(gl,(r,e)=>{let t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),Aae={kernelName:gl,backendName:"cpu",kernelFunc:H4e};function q4e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:p,shrinkAxisMask:d}=n;ye(o,"stridedSlice");let{finalShapeSparse:h,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:b,strides:w}=Tn.sliceInfo(o.shape,s,i,a,c,l,u,p,d),_;if(m)_=Wt({inputs:{x:o},backend:t,attrs:{shape:f}});else if(g||y){C.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let I=Tn.computeOutShape(x,b,w),S=Ha({inputs:{x:o},backend:t,attrs:{begin:x,size:I}});_=Wt({inputs:{x:S},backend:t,attrs:{shape:f}}),t.disposeIntermediateTensorInfo(S)}else{let I=t.bufferSync(o),S=CN(h,I,w,x);_=t.makeTensorInfo(f,S.dtype,S.values)}return _}var Rae={kernelName:Rf,backendName:"cpu",kernelFunc:q4e};function K4e(r){let{inputs:e,backend:t,attrs:n}=r,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=n,{data:u,dataSplits:p}=e,d=t.data.get(u.dataId).values,h=t.data.get(p.dataId).values,[f,m]=_N(d,h,o,s,i,a,c,l);return[t.makeTensorInfo([f.length],"string",f),t.makeTensorInfo(p.shape,"int32",m)]}var Oae={kernelName:Of,backendName:"cpu",kernelFunc:K4e};function X4e(r){let{inputs:e,backend:t,attrs:n}=r,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=t.data.get(s.dataId).values,c=t.data.get(i.dataId).values[0],[l,u,p]=SN(a,c,o),d=u.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(p))]}var Mae={kernelName:Sv,backendName:"cpu",kernelFunc:X4e};function Y4e(r){let{inputs:e,backend:t,attrs:n}=r,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=t.data.get(s.dataId).values,a=IN(i,o);return t.makeTensorInfo(s.shape,"int32",a)}var Fae={kernelName:Iv,backendName:"cpu",kernelFunc:Y4e};var Z4e=pt(fl,r=>Math.tan(r)),Pae={kernelName:fl,backendName:"cpu",kernelFunc:Z4e};var Q4e=pt(ml,r=>Math.tanh(r)),$ae={kernelName:ml,backendName:"cpu",kernelFunc:Q4e};function J4e(r){let{inputs:e,backend:t}=r,{tensor:n,indices:o,updates:s}=e,{sliceRank:i,numUpdates:a,sliceSize:c,strides:l,outputSize:u}=E.calculateShapes(s,o,n.shape),p=!1,d=t.bufferSync(o),h=t.bufferSync(s),f=t.bufferSync(n),m=kl(d,h,n.shape,u,c,a,i,l,f,p);return t.makeTensorInfo(n.shape,m.dtype,m.values)}var Lae={kernelName:Tf,backendName:"cpu",kernelFunc:J4e};function eje(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reps:s}=n;ye(o,"tile");let i=TN(t.bufferSync(o),s);return t.makeTensorInfo(i.shape,i.dtype,i.values)}var Vae={kernelName:Ra,backendName:"cpu",kernelFunc:eje};function tje(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{k:s,sorted:i}=n;ye(o,"topk");let a=t.data.get(o.dataId).values,[c,l]=kN(a,o.shape,o.dtype,s,i);return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var Bae={kernelName:Mf,backendName:"cpu",kernelFunc:tje};function rje(r){let{inputs:e,attrs:t,backend:n}=r,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=t,[u,p,d,h]=o.shape,[f,m]=l??[p,d],g=[u,f,m,h],y=C.computeStrides(o.shape),x=y[0],b=y[1],w=y[2],_=C.computeStrides(g),I=_[0],S=_[1],k=_[2],R=C.getTypedArrayFromDType(o.dtype,C.sizeFromShape(g));R.fill(c);let L=n.data.get(o.dataId).values,B=n.data.get(s.dataId).values;for(let q=0;q<u;++q){let U=s.shape[0]===1?B:B.subarray(q*8,q*8+8);for(let G=0;G<f;++G)for(let j=0;j<m;++j)for(let X=0;X<h;++X){let te,ne=U[6]*j+U[7]*G+1;if(ne===0)continue;let oe=(U[0]*j+U[1]*G+U[2])/ne,le=(U[3]*j+U[4]*G+U[5])/ne,xe=zae(oe,d,a),ge=zae(le,p,a);switch(i){case"nearest":te=aje(L,p,d,x,b,w,q,ge,xe,X,c);break;case"bilinear":te=cje(L,p,d,x,b,w,q,ge,xe,X,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}let Re=q*I+G*S+j*k+X;R[Re]=te}return n.makeTensorInfo(g,o.dtype,R)}return{dataId:n.write(R,g,o.dtype),shape:o.shape,dtype:o.dtype}}var Uae={kernelName:Ff,backendName:"cpu",kernelFunc:rje};function zae(r,e,t){switch(t){case"reflect":return nje(r,e);case"wrap":return oje(r,e);case"nearest":return ije(r,e);case"constant":default:return sje(r,e)}}function nje(r,e){let t=r;if(t<0)if(e<=1)t=0;else{let n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{let n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return C.clamp(0,t,e-1)}function oje(r,e){let t=r;if(t<0)if(e<=1)t=0;else{let n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{let n=e-1;t-=e*Math.trunc(t/n)}return C.clamp(0,t,e-1)}function sje(r,e){return r}function ije(r,e){return C.clamp(0,r,e-1)}function nS(r,e,t,n,o,s,i,a,c,l,u){let p=i*n+a*o+c*s+l;return 0<=a&&a<e&&0<=c&&c<t?r[p]:u}function aje(r,e,t,n,o,s,i,a,c,l,u){let p=Math.round(a),d=Math.round(c);return nS(r,e,t,n,o,s,i,p,d,l,u)}function cje(r,e,t,n,o,s,i,a,c,l,u){let p=Math.floor(a),d=Math.floor(c),h=p+1,f=d+1,m=(f-c)*nS(r,e,t,n,o,s,i,p,d,l,u)+(c-d)*nS(r,e,t,n,o,s,i,p,f,l,u),g=(f-c)*nS(r,e,t,n,o,s,i,h,d,l,u)+(c-d)*nS(r,e,t,n,o,s,i,h,f,l,u);return(h-a)*m+(a-p)*g}function lje(r){let{inputs:e,attrs:t,backend:n}=r,{axis:o}=t,{x:s}=e;ye(s,"unique");let i=n.data.get(s.dataId).values,{outputValues:a,outputShape:c,indices:l}=EN(i,o,s.shape,s.dtype);return[n.makeTensorInfo(c,s.dtype,a),n.makeTensorInfo([l.length],"int32",l)]}var Gae={kernelName:Tv,backendName:"cpu",kernelFunc:lje};function uje(r){let{inputs:e,backend:t,attrs:n}=r,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o.shape.length,a=o.shape[s],c=new Array(i-1),l=0;for(let h=0;h<i;h++)h!==s&&(c[l++]=o.shape[h]);let u=new Array(i).fill(0),p=o.shape.slice();p[s]=1;let d=new Array(a);for(let h=0;h<d.length;h++){u[s]=h;let f=Ha({inputs:{x:o},backend:t,attrs:{begin:u,size:p}});d[h]=Wt({inputs:{x:f},backend:t,attrs:{shape:c}}),t.disposeIntermediateTensorInfo(f)}return d}var Wae={kernelName:ap,backendName:"cpu",kernelFunc:uje};function pje(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,segmentIds:s}=e,{numSegments:i}=n;ye(o,"unsortedSegmentSum");let a=o.shape.length,c=s.shape.length,l=[],u=[],p=a-c,d=s;for(let f=0;f<p;++f){let m=Zb({inputs:{input:d},backend:t,attrs:{dim:f+1}});d=m,u.push(m)}for(let f=0;f<i;++f){let m=C.createScalarValue(f,"int32"),g=t.makeTensorInfo([],"int32",m),y=IV({inputs:{a:g,b:d},backend:t}),x=Wa({inputs:{x:y},backend:t,attrs:{dtype:"float32"}}),b=fy({inputs:{a:x,b:o},backend:t}),w=qd({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),u.push(g),u.push(y),u.push(x),u.push(b),u.push(w)}let h=wz({inputs:l,backend:t,attrs:{axis:0}});return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}var jae={kernelName:cp,backendName:"cpu",kernelFunc:pje};var dje=[gse,R7,yse,xse,$7,vse,bse,wse,Cse,_se,Sse,Ise,Tse,kse,Ese,Dse,Ase,Rse,Ose,mse,Mse,Fse,Pse,L7,$se,P7,V7,Lse,O7,Vse,zse,Use,Gse,Wse,jse,Hse,qse,Kse,Xse,Yse,Zse,Qse,Jse,eie,tie,rie,nie,oie,sie,iie,aie,cie,uie,lse,pie,B7,die,z7,hie,U7,fie,mie,gie,G7,W7,yie,xie,vie,bie,j7,H7,M7,wie,Bse,Cie,_ie,Sie,use,q7,K7,Iie,X7,Tie,kie,Eie,Nie,Die,Aie,Rie,Y7,Oie,Mie,Fie,Pie,Lie,Vie,Bie,Z7,zie,Uie,jie,Q7,J7,Hie,qie,Kie,e9,Xie,Qie,Jie,GA,eae,pse,r9,tae,rae,nae,oae,F7,eS,sae,dse,hse,fse,iae,aae,cae,lae,uae,pae,dae,a9,hae,mae,gae,yae,l9,xae,vae,bae,u9,Gie,Cae,_ae,Sae,Iae,Tae,kae,Eae,Nae,d9,Dae,h9,f9,Aae,Rae,Oae,Mae,Fae,m9,lie,Pae,$ae,Lae,Vae,Bae,Uae,t9,Gae,Wae,jae,Yie];for(let r of dje)Ev(r);var Ty={},WA={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Hae(r,e){Ty[r]=e}function Bi(r,e){if(!(r in Ty)||e!=null){let n=fje(r,e);if(n!==null)Ty[r]=n;else return console.log("Could not get context for WebGL version",r),null}let t=Ty[r];return t==null||t.isContextLost()?(delete Ty[r],Bi(r)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Ty[r])}function hje(r){if(!Z().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function fje(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let t=e??hje(r);return t.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete Ty[r]},!1),Z().getBool("SOFTWARE_WEBGL_ENABLED")&&(WA.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",WA)||t.getContext("experimental-webgl",WA):t.getContext("webgl2",WA)}var ky=function(r){return r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH",r}(ky||{}),ms=function(r){return r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD",r}(ms||{}),ts=function(r){return r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",r}(ts||{});function Ey(r,e){return[e,r]}function qae(r,e){return r*e}function oS(r){let e=C.sizeFromShape(r),t=Math.ceil(e/4);return C.sizeToSquarishShape(t)}function Dp(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function Kae(r,e){let[t,n]=Dp(r,e);return t*n*4}function sS(r,e){let t=r,n,o,s,i,a,c,l,u,p,d;return Z().getNumber("WEBGL_VERSION")===2?(n=t.R32F,o=t.R16F,s=t.RGBA16F,i=t.RGBA32F,a=t.RED,l=4,u=1,p=t.HALF_FLOAT,d=t.FLOAT,c=t.RGBA8):(n=r.RGBA,o=r.RGBA,s=r.RGBA,i=t.RGBA,a=r.RGBA,l=4,u=4,p=e!=null?e.HALF_FLOAT_OES:null,d=r.FLOAT,c=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:c,downloadUnpackNumChannels:l,defaultNumChannels:u,textureTypeHalfFloat:p,textureTypeFloat:d}}function je(r,e){let t=e();return Z().getBool("DEBUG")&&mje(r),t}function mje(r){let e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+xje(r,e))}var gje=596e-10,yje=65504;function Xae(r){return!!(Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||gje<Math.abs(r)&&Math.abs(r)<yje)}function xje(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function iS(r,e){return Kd(r,()=>r.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Yae(r,e){let t=Kd(r,()=>r.createShader(r.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(je(r,()=>r.shaderSource(t,e)),je(r,()=>r.compileShader(t)),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function Zae(r,e){let t=Kd(r,()=>r.createShader(r.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(je(r,()=>r.shaderSource(t,e)),je(r,()=>r.compileShader(t)),Z().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw Tz(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var vje=/ERROR: [0-9]+:([0-9]+):/g;function Tz(r,e){let t=vje.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(r);return}let n=+t[1],o=r.split(`
`),s=o.length.toString().length+2,i=o.map((p,d)=>C.rightPad((d+1).toString(),s)+p),a=0;for(let p=0;p<i.length;p++)a=Math.max(i[p].length,a);let c=i.slice(0,n-1),l=i.slice(n-1,n),u=i.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${C.rightPad(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function Qae(r){return Kd(r,()=>r.createProgram(),"Unable to create WebGLProgram.")}function Jae(r,e){if(je(r,()=>r.linkProgram(e)),!Z().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function HA(r,e){if(je(r,()=>r.validateProgram(e)),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function ece(r,e){let t=Kd(r,()=>r.createBuffer(),"Unable to create WebGLBuffer");return je(r,()=>r.bindBuffer(r.ARRAY_BUFFER,t)),je(r,()=>r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)),t}function tce(r,e){let t=Kd(r,()=>r.createBuffer(),"Unable to create WebGLBuffer");return je(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)),je(r,()=>r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)),t}function rce(r){return Kd(r,()=>r.createTexture(),"Unable to create WebGLTexture.")}function nce(r,e){let t=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){let n=`[${r}x${e}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){let n=`[${r}x${e}]`,o=`[${t}x${t}]`;throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+o+".")}}function oce(r){return Kd(r,()=>r.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function kz(r,e,t,n,o,s,i){let a=r.getAttribLocation(e,t);return a===-1?!1:(je(r,()=>r.bindBuffer(r.ARRAY_BUFFER,n)),je(r,()=>r.vertexAttribPointer(a,o,r.FLOAT,!1,s,i)),je(r,()=>r.enableVertexAttribArray(a)),!0)}function bje(r,e,t){Cje(r,t),je(r,()=>r.activeTexture(r.TEXTURE0+t)),je(r,()=>r.bindTexture(r.TEXTURE_2D,e))}function sce(r,e,t){return Kd(r,()=>r.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function ice(r,e,t){return r.getUniformLocation(e,t)}function ace(r,e,t,n){je(r,()=>bje(r,e,n)),je(r,()=>r.uniform1i(t,n))}function qA(r,e,t){je(r,()=>r.bindFramebuffer(r.FRAMEBUFFER,t)),je(r,()=>r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0))}function Ez(r,e){je(r,()=>r.bindFramebuffer(r.FRAMEBUFFER,e)),je(r,()=>r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0))}function aS(r){let e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+wje(r,e))}function wje(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Kd(r,e,t){let n=je(r,()=>e());if(n==null)throw new Error(t);return n}function Cje(r,e){let t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){let o=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${o}.`)}}function vm(r,e=2){return C.sizeFromShape(r.slice(0,r.length-e))}function bm(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function cS(r){let e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[vm(r),...bm(r)]),e}function cce(r,e=!1){let t=Z().getNumber("WEBGL_MAX_TEXTURE_SIZE"),n=Z().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");n===1/0&&Z().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(n=t/2),e&&(t=t*2,n=n*2,r=r.map((a,c)=>c>=r.length-2?C.nearestLargerEven(r[c]):r[c]),r.length===1&&(r=[2,r[0]])),r.length!==2&&(r=C.squeezeShape(r).newShape);let o=C.sizeFromShape(r),s=null;r.length<=1&&o<=t?s=[1,o]:r.length===2&&r[0]<=t&&r[1]<=t?s=r:r.length===3&&r[0]*r[1]<=t&&r[2]<=t?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=t&&r[1]*r[2]<=t?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=t&&r[3]<=t?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=t&&r[1]*r[2]*r[3]<=t&&(s=[r[0],r[1]*r[2]*r[3]]);let i=s!=null&&Math.max(...s)>n&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||i)if(e){let a=vm(r),c=2,l=2;r.length&&([c,l]=bm(r)),o=a*(c/2)*(l/2),s=C.sizeToSquarishShape(o).map(u=>u*2)}else s=C.sizeToSquarishShape(o);return s}function jA(r){return r%2===0}function Ny(r,e){if(r=r.slice(-2),e=e.slice(-2),C.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){let t=r[r.length-1],n=e[e.length-1];if(t===n||jA(t)&&jA(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&jA(r[0])&&jA(e[0])}var _z,Sz;function lce(r){if(_z==null){let e=Bi(r);_z=e.getParameter(e.MAX_TEXTURE_SIZE)}return _z}function uce(r){if(Sz==null){let e=Bi(r);Sz=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Sz)}function pce(r){if(r===0)return 0;let e,t=Bi(r);return la(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:la(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function la(r,e){return r.getExtension(e)!=null}function Nz(r){try{if(Bi(r)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function dce(r){if(r===0)return!1;let e=Bi(r);if(r===1){if(!la(e,"OES_texture_float"))return!1}else if(!la(e,"EXT_color_buffer_float"))return!1;return Iz(e)}function hce(r){if(r===0)return!1;let e=Bi(r);if(r===1){if(!la(e,"OES_texture_float")||!la(e,"WEBGL_color_buffer_float"))return!1}else{if(la(e,"EXT_color_buffer_float"))return Iz(e);let n="EXT_color_buffer_half_float";if(la(e,n)){let o=e.getExtension(n);return _je(e,o)}return!1}return Iz(e)}function Iz(r){let e=sS(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);let s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);let i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(s),i}function _je(r,e){let t=sS(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);let i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);let a=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(i),a}function fce(r){return r!==2?!1:Bi(r).fenceSync!=null}function Ap(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>{t!=null&&C.assert(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}var ct=Z();ct.registerFlag("HAS_WEBGL",()=>ct.getNumber("WEBGL_VERSION")>0);ct.registerFlag("WEBGL_VERSION",()=>Nz(2)?2:Nz(1)?1:0);ct.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ct.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ct.get("WEBGL_VERSION")===2);ct.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ct.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ct.registerFlag("WEBGL_PACK",()=>ct.getBool("HAS_WEBGL"));ct.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_CLIP",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_REDUCE",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_LAZILY_UNPACK",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_CONV_IM2COL",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ct.getBool("WEBGL_PACK"));ct.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>lce(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>uce(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let r=ct.getNumber("WEBGL_VERSION");return r===0?0:pce(r)});ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ct.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Vf.isMobile());ct.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>dce(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ct.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ct.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ct.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>hce(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_FENCE_API_ENABLED",()=>fce(ct.getNumber("WEBGL_VERSION")));ct.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ct.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ct.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,r=>{if(typeof r!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${r}.`);if(r<0&&r!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${r}.`)});ct.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Vf.isMobile()?1:-1,r=>{if(typeof r!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${r}.`);if(r<0&&r!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${r}.`)});ct.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ct.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ct.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ct.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ct.registerFlag("WEBGL_EXP_CONV",()=>!1);ct.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ct.getBool("IS_TEST"));ct.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ct.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ct.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ct.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function bn(){let r,e,t,n,o,s,i,a,c,l;return Z().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=Z().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:c,defineRound:l}}function Fl(r,e,t="index"){let n=C.computeStrides(e);return n.map((o,s)=>{let i=`int ${r[s]} = ${t} / ${o}`,a=s===n.length-1?`int ${r[s+1]} = ${t} - ${r[s]} * ${o}`:`index -= ${r[s]} * ${o}`;return`${i}; ${a};`}).join("")}function Dy(r,e,t="index"){let n=C.computeStrides(e);return n.map((o,s)=>{let i=`int ${r[s]} = ${t} / outShapeStrides[${s}]`,a=s===n.length-1?`int ${r[s+1]} = ${t} - ${r[s]} * outShapeStrides[${s}]`:`index -= ${r[s]} * outShapeStrides[${s}]`;return`${i}; ${a};`}).join("")}function Sje(r,e){let t=r.length,n=r.map(s=>`${e}[${s}]`),o=new Array(t-1);o[t-2]=n[t-1];for(let s=t-3;s>=0;--s)o[s]=`(${o[s+1]} * ${n[s+1]})`;return o}function mce(r,e,t="index"){let n=r.map((s,i)=>i),o=Sje(n,e);return o.map((s,i)=>{let a=`int ${r[i]} = ${t} / ${o[i]}`,c=i===o.length-1?`int ${r[i+1]} = ${t} - ${r[i]} * ${o[i]}`:`index -= ${r[i]} * ${o[i]}`;return`${a}; ${c};`}).join("")}function Qb(r){let e=C.computeStrides(r).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Jb(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var XA=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:gce}=E;function yce(r,e,t){let n=[];if(r.forEach(h=>{let f=C.sizeFromShape(h.shapeInfo.logicalShape);if(h.shapeInfo.isUniform?n.push(`uniform float ${h.name}${f>1?`[${f}]`:""};`):(n.push(`uniform sampler2D ${h.name};`),n.push(`uniform int offset${h.name};`)),t.enableShapeUniforms){let{uniformShape:m}=YA(t.packedInputs,h.shapeInfo.logicalShape,h.shapeInfo.texShape);switch(m.length){case 1:n.push(`uniform int ${h.name}Shape;`);break;case 2:n.push(`uniform ivec2 ${h.name}Shape;`);break;case 3:n.push(`uniform ivec3 ${h.name}Shape;`);break;case 4:n.push(`uniform ivec4 ${h.name}Shape;`);break;default:break}n.push(`uniform ivec2 ${h.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break;default:break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(h=>{n.push(`uniform ${h.type} ${h.name}${h.arrayIndex?`[${h.arrayIndex}]`:""};`)});let o=n.join(`
`),s=r.map(h=>Ije(h,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=bn(),c=Eje(a),l,u,p=Aje(a);return e.isPacked?(l=Tje(e.logicalShape,i,t.enableShapeUniforms),u=Dje(a)):(l=kje(e.logicalShape,i,t.enableShapeUniforms),u=Nje(a)),t.packedInputs&&(p+=Fje),[p,c,u,o,l,s,t.userCode].join(`
`)}function tw(r,e=!1){let t=r.shapeInfo.logicalShape;switch(t.length){case 0:return qje(r,e);case 1:return Xje(r,e);case 2:return Zje(r,e);case 3:return Jje(r,e);case 4:return tHe(r,e);case 5:return rHe(r);case 6:return nHe(r);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function xce(r,e){switch(r.shapeInfo.logicalShape.length){case 0:return Hje(r);case 1:return Kje(r,e);case 2:return Yje(r,e);case 3:return Qje(r,e);default:return eHe(r,e)}}function Ije(r,e,t=!1,n){let o="";t?o+=xce(r,n):o+=tw(r,n);let s=r.shapeInfo.logicalShape,i=e.logicalShape;return s.length<=i.length&&(t?o+=oHe(r,e):o+=sHe(r,e)),o}function Tje(r,e,t){switch(r.length){case 0:return vce();case 1:return Pje(r,e,t);case 2:return Wje(r,e,t);case 3:return Lje(r,e,t);default:return Bje(r,e,t)}}function kje(r,e,t){switch(r.length){case 0:return vce();case 1:return $je(r,e,t);case 2:return jje(r,e,t);case 3:return Vje(r,e,t);case 4:return zje(r,e,t);case 5:return Uje(r,e);case 6:return Gje(r,e);default:throw new Error(`${r.length}-D output sampling is not yet supported`)}}function Eje(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${r.texture2D}(textureSampler, uv).r;
    }
  `}function Nje(r){return`
    void setOutput(float val) {
      ${r.output} = vec4(val, 0, 0, 0);
    }
  `}function Dje(r){return`
    void setOutput(vec4 val) {
      ${r.output} = val;
    }
  `}function Aje(r){return`${r.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${r.varyingFs} vec2 resultUV;
    ${r.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${r.defineSpecialNaN}
    ${r.defineSpecialInf}
    ${r.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Rje}
    ${Oje}
    ${Mje}
  `}var Rje=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Oje=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Mje=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Fje=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function vce(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Pje(r,e,t){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${n[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);
    }
  `}function $je(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Lje(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(r[2]/2),s=o*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function Vje(r,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Dy(["r","c","d"],r)}
    return ivec3(r, c, d);
  }
`;let n=Fl(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec3(r, c, d);
    }
  `}function Bje(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(r[r.length-1]/2),s=o*Math.ceil(r[r.length-2]/2),i=s,a="",c="b, r, c";for(let l=2;l<r.length-1;l++)i*=r[r.length-l-1],a=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+a,c=`b${l}, `+c;return`
    ivec${r.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${r.length}(${c});
    }
  `}function zje(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Dy(["r","c","d","d2"],r)}
      return ivec4(r, c, d, d2);
    }
  `;let n=Fl(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec4(r, c, d, d2);
    }
  `}function Uje(r,e){let t=Fl(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Gje(r,e){let t=Fl(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Wje(r,e,t){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(C.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `;let o=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function jje(r,e,t){return C.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${r[1]};
      int c = index - r * ${r[1]};
      return ivec2(r, c);
    }
  `}function Ay(r){return`offset${r}`}function Hje(r){let e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=bn();return`
    vec4 ${t}() {
      return ${n.texture2D}(${e}, halfCR);
    }
  `}function qje(r,e){let t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`float ${n}() {return ${t};}`;let[o,s]=r.shapeInfo.texShape;if(o===1&&s===1)return`
      float ${n}() {
        return sampleTexture(${t}, halfCR);
      }
    `;let i=Ay(t);if(e)return`
    float ${n}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;let[a,c]=r.shapeInfo.texShape;return`
    float ${n}() {
      vec2 uv = uvFromFlat(${a}, ${c}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function Kje(r,e){let t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),o=r.shapeInfo.texShape,s=bn();if(e)return`
    vec4 ${n}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${t}, uv);
    }
  `;let i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${n}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${t}, uv);
    }
  `}function Xje(r,e){let t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float ${n}(int index) {
        ${rw(r)}
      }
    `;let o=r.shapeInfo.texShape,s=o[0],i=o[1];if(i===1&&s===1)return`
      float ${n}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;let a=Ay(t);return i===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${t}, uv);
      }
    `:s===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function Yje(r,e){let t=r.shapeInfo.logicalShape,n=r.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r.shapeInfo.texShape,i=s[0],a=s[1],c=bn();if(s!=null&&C.arraysEqual(t,s))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);

        return ${c.texture2D}(${n}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${c.texture2D}(${n}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${n}, uv);
    }
  `;let l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(t[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${l[0]}, ${l[1]}, row, col);
      return ${c.texture2D}(${n}, uv);
    }
  `}function Zje(r,e){let t=r.shapeInfo.logicalShape,n=r.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r.shapeInfo.texShape;if(s!=null&&C.arraysEqual(t,s)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `;let d=s[0],h=s[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${n}, uv);
    }
  `}let{newShape:i,keptDims:a}=C.squeezeShape(t),c=i;if(c.length<t.length){let d=nw(r,c),h=["row","col"];return`
      ${tw(d,e)}
      float ${o}(int row, int col) {
        return ${o}(${ow(h,a)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${rw(r)}
      }
    `;let l=s[0],u=s[1],p=Ay(n);return u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${n}, uv);
    }
  `:l===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${n}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${n}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
        return sampleTexture(${n}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${p};
    vec2 uv = uvFromFlat(${l}, ${u}, index);
    return sampleTexture(${n}, uv);
  }
`}function Qje(r,e){let t=r.shapeInfo.logicalShape,n=r.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(t[0]===1){let d=t.slice(1),h=[1,2],f=nw(r,d),m=["b","row","col"];return`
        ${xce(f,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${ow(m,h)});
        }
      `}let a=bn();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `;let c=i[0],l=i[1],u=Math.ceil(t[2]/2),p=u*Math.ceil(t[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${l}, ${p}, ${u}, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `}function Jje(r,e){let t=r.shapeInfo.logicalShape,n=r.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t[1]*t[2],i=t[2],{newShape:a,keptDims:c}=C.squeezeShape(t),l=a;if(l.length<t.length){let m=nw(r,l),g=["row","col","depth"];return`
        ${tw(m,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${ow(g,c)});
        }
      `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${rw(r)}
      }
    `;let u=r.shapeInfo.texShape,p=u[0],d=u[1],h=r.shapeInfo.flatOffset;if(d===s&&h==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${n}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${p}.0);
          return sampleTexture(${n}, uv);
        }
      `;if(d===i&&h==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${n}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${p}.0);
      return sampleTexture(${n}, uv);
    }
  `;let f=Ay(n);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${n}Shape[1] * ${n}Shape[2];
      int stride1 = ${n}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
      return sampleTexture(${n}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${p}, ${d}, index);
        return sampleTexture(${n}, uv);
      }
  `}function eHe(r,e){let t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),o=bn();if(e)return`
    vec4 ${n}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${t}, uv);
    }
  `;let s=r.shapeInfo.logicalShape,i=s.length,a=r.shapeInfo.texShape,c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=c[0],u=c[1],p=Math.ceil(s[i-1]/2),d=p*Math.ceil(s[i-2]/2),h="int b, int row, int col",f=`b * ${d} + (row / 2) * ${p} + (col / 2)`;for(let m=2;m<i-1;m++)h=`int b${m}, `+h,d*=s[i-m-1],f=`b${m} * ${d} + `+f;return`
    vec4 ${n}(${h}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${l});
      return ${o.texture2D}(${t}, uv);
    }
  `}function tHe(r,e){let t=r.shapeInfo.logicalShape,n=r.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t[3],i=t[2]*s,a=t[1]*i,{newShape:c,keptDims:l}=C.squeezeShape(t);if(c.length<t.length){let x=nw(r,c),b=["row","col","depth","depth2"];return`
      ${tw(x,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${ow(b,l)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${s}, 1)));
        ${rw(r)}
      }
    `;let u=r.shapeInfo.flatOffset,p=r.shapeInfo.texShape,d=p[0],h=p[1],f=`int stride2 = ${n}Shape[3];`,m=`int stride1 = ${n}Shape[2] * stride2;`,g=`int stride0 = ${n}Shape[1] * stride1;`;if(h===a&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${f}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(h===s&&u==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n}Shape[1] * ${n}Shape[2], ${n}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;let y=Ay(n);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${y});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${d}, ${h}, index + ${y});
      return sampleTexture(${n}, uv);
    }
  `}function rHe(r){let e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),o=e[4],s=e[3]*o,i=e[2]*s,a=e[1]*i,{newShape:c,keptDims:l}=C.squeezeShape(e);if(c.length<e.length){let m=nw(r,c),g=["row","col","depth","depth2","depth3"];return`
      ${tw(m)}
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        return ${n}(${ow(g,l)});
      }
    `}if(r.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${rw(r)}
      }
    `;let u=r.shapeInfo.flatOffset,p=r.shapeInfo.texShape,d=p[0],h=p[1];if(h===a&&u==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(h===o&&u==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${d}.0);
        return sampleTexture(${t}, uv);
      }
    `;let f=Ay(t);return`
    float ${n}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${f};
      vec2 uv = uvFromFlat(${d}, ${h}, index);
      return sampleTexture(${t}, uv);
    }
  `}function nHe(r){let e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:o,keptDims:s}=C.squeezeShape(e);if(o.length<e.length){let g=nw(r,o),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${tw(g)}
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${n}(${ow(y,s)});
      }
    `}let i=e[5],a=e[4]*i,c=e[3]*a,l=e[2]*c,u=e[1]*l;if(r.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${l}, ${c}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${rw(r)}
      }
    `;let p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,h=d[0],f=d[1];if(f===u&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${c}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(f===i&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${t}, uv);
      }
    `;let m=Ay(t);return`
    float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${l} + depth * ${c} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${m};
      vec2 uv = uvFromFlat(${h}, ${f}, index);
      return sampleTexture(${t}, uv);
    }
  `}function rw(r){let e=r.name,t=C.sizeFromShape(r.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function oHe(r,e){let t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),o="get"+n+"AtOutCoords",s=r.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=gce(r.shapeInfo.logicalShape,e.logicalShape),c=bt(i),l=i-s,u,p=["x","y","z","w","u","v"];s===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(x=>`coords.${p[x+l]} = 0;`).join(`
`);let d="";i<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map((x,b)=>`coords.${p[b+l]}`).join(", ");let h="return outputValue;",m=C.sizeFromShape(r.shapeInfo.logicalShape)===1,y=C.sizeFromShape(e.logicalShape)===1;if(s===1&&!m&&!y)h=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)i===1?h=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:h=`
        return vec4(outputValue.x);
      `;else if(a.length){let x=s-2,b=s-1;a.indexOf(x)>-1&&a.indexOf(b)>-1?h="return vec4(outputValue.x);":a.indexOf(x)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${n}(${d});
      ${h}
    }
  `}function sHe(r,e){let t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),o="get"+n+"AtOutCoords",s=e.texShape,i=r.shapeInfo.texShape,a=r.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!r.shapeInfo.isUniform&&a===c&&r.shapeInfo.flatOffset==null&&C.arraysEqual(i,s))return`
      float ${o}() {
        return sampleTexture(${t}, resultUV);
      }
    `;let l=bt(c),u=gce(r.shapeInfo.logicalShape,e.logicalShape),p=c-a,d,h=["x","y","z","w","u","v"];a===0?d="":c<2&&u.length>=1?d="coords = 0;":d=u.map(m=>`coords.${h[m+p]} = 0;`).join(`
`);let f="";return c<2&&a>0?f="coords":f=r.shapeInfo.logicalShape.map((m,g)=>`coords.${h[g+p]}`).join(", "),`
    float ${o}() {
      ${l} coords = getOutputCoords();
      ${d}
      return get${n}(${f});
    }
  `}function bt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error(`GPU for rank ${r} is not yet supported`)}function YA(r,e,t){let{newShape:n,keptDims:o}=C.squeezeShape(e),s=e.length,i=r&&s===3&&e[0]===1,a=i?e.slice(1):n,c=!r&&s>1&&!C.arraysEqual(e,t)&&n.length<s||i;return{useSqueezeShape:c,uniformShape:c?a:e,keptDims:o}}function nw(r,e){let t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function ow(r,e){return e.map(t=>r[t]).join(", ")}function wce(r,e,t,n){let o=t.map((u,p)=>{let d={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(d.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:d}}),s=o.map(u=>u.shapeInfo),i={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},a=yce(o,i,e),c=Zae(r.gl,a),l=r.createProgram(c);return Z().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(r.buildVao(l),Object.assign({program:e,fragmentShader:c,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:i},Dz(r,e,l)))}function Dz(r,e,t){let n=[],o=[],s,i,a,c=null,l=null;l=r.getUniformLocation(t,"NAN",!1),Z().getNumber("WEBGL_VERSION")===1&&(c=r.getUniformLocation(t,"INFINITY",!1));let u=!1;for(let p of e.variableNames){let d={name:p,uniform:r.getUniformLocation(t,p,u),offset:r.getUniformLocation(t,`offset${p}`,u)};e.enableShapeUniforms&&(d.shape=r.getUniformLocation(t,`${p}Shape`,u),d.texShape=r.getUniformLocation(t,`${p}TexShape`,u)),n.push(d)}if(e.enableShapeUniforms&&(s=r.getUniformLocation(t,"outShape",u),a=r.getUniformLocation(t,"outShapeStrides",u),i=r.getUniformLocation(t,"outTexShape",u)),e.customUniforms)for(let p of e.customUniforms)o.push(r.getUniformLocation(t,p.name,u));return{variablesLocations:n,customUniformLocations:o,infLoc:c,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:i}}function bce(r,e){if(r.length!==e.length)throw Error(`Binary was compiled with ${r.length} inputs, but was executed with ${e.length} inputs`);r.forEach((t,n)=>{let o=t.logicalShape,s=e[n],i=s.shape;if(!C.arraysEqual(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(t.isUniform&&s.isUniform)return;let a=t.texShape,c=s.isUniform?null:s.texData.texShape;if(!C.arraysEqual(a,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${c} must match`)})}function Cce(r,e,t,n,o){e.program.enableShapeUniforms||(bce(e.inShapeInfos,t),bce([e.outShapeInfo],[n]));let s=n.texData.texture,i=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):r.setOutputMatrixTexture(s.texture,i[0],i[1]),r.setProgram(e.webGLProgram),r.bindVertexArray(e.webGLProgram.vao),Z().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<t.length;++c){let l=t[c],{uniform:u,offset:p,shape:d,texShape:h}=e.variablesLocations[c];if(d){let{uniformShape:f}=YA(e.program.packedInputs,l.shape,l.texData.texShape);switch(f.length){case 1:r.gl.uniform1iv(d,new Int32Array(f));break;case 2:r.gl.uniform2iv(d,new Int32Array(f));break;case 3:r.gl.uniform3iv(d,new Int32Array(f));break;case 4:r.gl.uniform4iv(d,new Int32Array(f));break;default:break}}if(h&&r.gl.uniform2i(h,l.texData.texShape[0],l.texData.texShape[1]),u!=null){if(l.isUniform){if(C.sizeFromShape(l.shape)<2)r.gl.uniform1f(u,l.uniformValues[0]);else{let f=l.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),r.gl.uniform1fv(u,f)}continue}l.texData.slice!=null&&p!=null&&r.gl.uniform1i(p,l.texData.slice.flatOffset),r.setInputMatrixTexture(l.texData.texture.texture,u,c)}}let a=e.outShapeLocation;if(a)switch(n.shape.length){case 1:r.gl.uniform1iv(a,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(a,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(a,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(a,new Int32Array(n.shape));break;default:break}if(e.outShapeStridesLocation){let c=C.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break;default:break}}if(e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&o)for(let c=0;c<e.program.customUniforms.length;++c){let l=e.program.customUniforms[c],u=e.customUniformLocations[c],p=o[c];if(l.type==="float")r.gl.uniform1fv(u,p);else if(l.type==="vec2")r.gl.uniform2fv(u,p);else if(l.type==="vec3")r.gl.uniform3fv(u,p);else if(l.type==="vec4")r.gl.uniform4fv(u,p);else if(l.type==="int")r.gl.uniform1iv(u,p);else if(l.type==="ivec2")r.gl.uniform2iv(u,p);else if(l.type==="ivec3")r.gl.uniform3iv(u,p);else if(l.type==="ivec4")r.gl.uniform4iv(u,p);else throw Error(`uniform type ${l.type} is not supported yet.`)}r.executeProgram()}function _ce(r,e,t){let n="";e.concat(t).forEach(i=>{let a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!i.isUniform){let c=i.texData.texShape,{useSqueezeShape:l,uniformShape:u,keptDims:p}=YA(r.packedInputs,i.shape,c),d="",h="",f="";if(u.length===1&&r.packedInputs){let _=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];d=`${_[0]>1}_${_[1]>1}`}else if(u.length===2&&!r.packedInputs)h=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!r.packedInputs){let _=C.computeStrides(u);f=`${_[0]===c[1]}_${_[_.length-1]===c[1]}`}let m=i.shape.length,g=u.length===2&&C.arraysEqual(i.shape,c),y=C.sizeFromShape(i.shape)===1,x=E.getBroadcastDims(i.shape,t.shape),b=!r.packedInputs&&m===t.shape.length&&C.arraysEqual(c,t.texData.texShape),w=r.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;n+=`${m}_${b}_${l?p:""}_${u.length}_${y}_${x}_${g}_${d}_${h}_${f}_${w}_${a}`}else{let c=i.isUniform?"uniform":i.texData.texShape;n+=`${i.shape}_${c}_${a}`}});let o=r.userCode,s=r.constructor.name;return s+="_"+n+"_"+o+`${Z().getNumber("WEBGL_VERSION")}`,s}function Er(r){return Z().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var ZA=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ky.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=bn();this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Dy(["r","c","d"],e):Fl(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}};var QA=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ky.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=bn();this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Dy(["r","c","d"],e):Fl(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}};var JA=class{constructor(e){this.variableNames=["A"],this.outTexUsage=ms.DOWNLOAD;let t=bn();this.outputShape=e,this.userCode=`
      ${XA}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}};var eR=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ms.DOWNLOAD;let t=bn();this.outputShape=e,this.userCode=`
      ${XA}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}};var cHe={R:0,G:1,B:2,A:3},lS=class{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=bn();this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length);let s="result";t&&(s="floor(result * 255. + 0.5)");let i="";for(let a=0;a<n.length;a++){let c=n[a];i+=`
          if(offset == ${a}) {
            result = values[${cHe[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Jb():Qb(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${s}, 0., 0., 0.);
      }
    `}};var tR=class{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=bn();this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length);let o="",s="result";t&&(s="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){let c=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Jb():Qb(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${n.output} = ${s};
        }
    `}};function Sce(r){let e=bn(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Yae(r,t)}function Ice(r){let e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return ece(r,e)}function Tce(r){let e=new Uint16Array([0,1,2,2,1,3]);return tce(r,e)}function uS(r,e,t,n,o,s){nce(e,t);let i=rce(r),a=r.TEXTURE_2D;return je(r,()=>r.bindTexture(a,i)),je(r,()=>r.texParameteri(a,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)),je(r,()=>r.texParameteri(a,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),je(r,()=>r.texParameteri(a,r.TEXTURE_MIN_FILTER,r.NEAREST)),je(r,()=>r.texParameteri(a,r.TEXTURE_MAG_FILTER,r.NEAREST)),Z().getNumber("WEBGL_VERSION")===1?je(r,()=>r.texImage2D(a,0,n,e,t,0,o,s,null)):je(r,()=>r.texStorage2D(a,1,n,e,t)),je(r,()=>r.bindTexture(r.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function Az(r){return r.internalFormatFloat}function kce(r,e,t,n){let[o,s]=Ey(e,t);return uS(r,o,s,Az(n),n.textureFormatFloat,r.FLOAT)}function Rz(r){return r.internalFormatHalfFloat}function Ece(r,e,t,n){let[o,s]=Ey(e,t);return uS(r,o,s,Rz(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function Oz(r){return r.downloadTextureFormat}function Nce(r,e,t,n){let[o,s]=Ey(e,t);return uS(r,o,s,Oz(n),r.RGBA,r.UNSIGNED_BYTE)}function Mz(r){return r.internalFormatPackedFloat}function Dce(r,e,t,n){let[o,s]=Dp(e,t);return uS(r,o,s,Mz(n),r.RGBA,r.FLOAT)}function Fz(r){return r.internalFormatPackedHalfFloat}function Ace(r,e,t,n){let[o,s]=Dp(e,t);return uS(r,o,s,Fz(n),r.RGBA,n.textureTypeHalfFloat)}function Rce(r,e,t){return je(r,()=>r.bindBuffer(r.ARRAY_BUFFER,t)),kz(r,e,"clipSpacePos",t,3,20,0)&&kz(r,e,"uv",t,2,20,12)}function Oce(r,e,t,n,o,s){je(r,()=>r.bindTexture(r.TEXTURE_2D,e));let i,a,c;o instanceof Uint8Array?(i=new Uint8Array(t*n*4),a=r.UNSIGNED_BYTE,c=r.RGBA):(i=new Float32Array(t*n*4),a=r.FLOAT,c=s.internalFormatPackedFloat),i.set(o),Z().getNumber("WEBGL_VERSION")===2?je(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,a,i)):je(r,()=>r.texImage2D(r.TEXTURE_2D,0,c,t,n,0,r.RGBA,a,i)),je(r,()=>r.bindTexture(r.TEXTURE_2D,null))}function Mce(r,e,t){je(r,()=>r.bindTexture(r.TEXTURE_2D,e)),t.data instanceof Uint8Array?Z().getNumber("WEBGL_VERSION")===2?je(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)):je(r,()=>r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)):Z().getNumber("WEBGL_VERSION")===2?je(r,()=>r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)):je(r,()=>r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)),je(r,()=>r.bindTexture(r.TEXTURE_2D,null))}function Fce(r,e,t,n){let o=r.createBuffer();je(r,()=>r.bindBuffer(r.PIXEL_PACK_BUFFER,o));let a=4*4*e*t;return je(r,()=>r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)),je(r,()=>r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)),je(r,()=>r.bindBuffer(r.PIXEL_PACK_BUFFER,null)),o}function Pce(r,e,t){let n=r,o=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function $ce(r,e,t,n){let[o,s]=Ey(e,t),i=4,a=new Uint8Array(qae(e*t,i));return je(r,()=>r.readPixels(0,0,o,s,n.downloadTextureFormat,r.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Lce(r,e,t,n,o,s,i,a){let c=r,l=new Float32Array(Kae(s,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function Vce(r,e,t){let n=new Float32Array(e*t*4);return je(r,()=>r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)),n}var sw=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=Z().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Hae(t,e)):this.gl=Bi(t),e=this.gl,Z().getNumber("WEBGL_VERSION")===2){let s=e;this.createVertexArray=()=>je(s,()=>s.createVertexArray()),this.bindVertexArray=i=>je(s,()=>s.bindVertexArray(i)),this.deleteVertexArray=i=>je(s,()=>s.deleteVertexArray(i)),this.getVertexArray=()=>je(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){let s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>je(e,()=>s.createVertexArrayOES()),this.bindVertexArray=i=>je(e,()=>s.bindVertexArrayOES(i)),this.deleteVertexArray=i=>je(e,()=>s.deleteVertexArrayOES(i)),this.getVertexArray=()=>je(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Z().getNumber("WEBGL_VERSION")===1){let s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=iS(this.gl,s),la(this.gl,i))this.textureHalfFloatExtension=iS(this.gl,i);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),la(this.gl,o))this.colorBufferHalfFloatExtension=iS(this.gl,o);else if(Z().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",la(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(la(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Ice(this.gl),this.indexBuffer=Tce(this.gl),this.framebuffer=oce(this.gl),this.textureConfig=sS(this.gl,this.textureHalfFloatExtension)}get debug(){return Z().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;je(e,()=>e.finish()),je(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),je(e,()=>e.deleteFramebuffer(this.framebuffer)),je(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),je(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),je(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),kce(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),Ece(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),Nce(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),Mce(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,o){this.throwIfDisposed(),Oce(this.gl,e,t,n,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Ace(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),Dce(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Ez(this.gl,this.framebuffer),this.outputTexture=null),je(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>$ce(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,o,s,i){return Lce(this.gl,e,t,n,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return Pce(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let o=Fce(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(Z().getBool("WEBGL_FENCE_API_ENABLED")){let o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},t=s}else Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>Vce(this.gl,t,n))}createProgram(e){this.throwIfDisposed();let t=this.gl;this.vertexShader==null&&(this.vertexShader=Sce(t));let n=Qae(t);je(t,()=>t.attachShader(n,this.vertexShader)),je(t,()=>t.attachShader(n,e)),Jae(t,n);let o=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&HA(t,o),o}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;je(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Rce(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(je(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&HA(this.gl,this.program),je(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?sce(this.gl,e,t):ice(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),je(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),ace(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[o,s]=Dp(t,n);this.setOutputMatrixTextureDriver(e,o,s)}setOutputMatrixWriteRegion(e,t,n,o){this.setOutputMatrixWriteRegionDriver(n,e,o,t)}setOutputPackedMatrixWriteRegion(e,t,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&HA(this.gl,this.program),aS(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}je(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),je(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=iS(this.gl,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.createQuery();return n.beginQuery(o.TIME_ELAPSED_EXT,s),s}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(e){return M(this,null,function*(){return yield C.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(e,t){if(t===0)return null;if(t===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),o=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=uHe(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:n}=this.itemsToPoll[t];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in Z().platform&&(n=Z().platform.setTimeoutCustom.bind(Z().platform)),C.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),qA(this.gl,e,this.framebuffer),this.debug&&aS(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(qA(this.gl,this.outputTexture,this.framebuffer),this.debug&&aS(this.gl)):Ez(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let o=this.gl;qA(o,e,this.framebuffer),this.debug&&aS(o),this.outputTexture=e,je(o,()=>o.viewport(0,0,t,n)),je(o,()=>o.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,o){this.throwIfDisposed(),je(this.gl,()=>this.gl.scissor(e,t,n,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function uHe(r){let e=0;for(;e<r.length&&r[e]();++e);return e-1}var{addImpl:Bce,bincountImpl:rR,bincountReduceImpl:zce,bitwiseAndImpl:Uce,castImpl:Gce,ceilImpl:Wce,concatImpl:jce,equalImpl:Hce,expImpl:qce,expm1Impl:Kce,floorImpl:Xce,gatherNdImpl:Yce,gatherV2Impl:Zce,greaterImpl:Qce,greaterEqualImpl:Jce,lessImpl:ele,lessEqualImpl:tle,linSpaceImpl:rle,logImpl:nle,maxImpl:ole,maximumImpl:sle,minimumImpl:ile,multiplyImpl:ale,negImpl:cle,notEqualImpl:lle,prodImpl:ule,raggedGatherImpl:ple,raggedRangeImpl:dle,raggedTensorToTensorImpl:hle,rangeImpl:fle,rsqrtImpl:mle,scatterImpl:gle,sigmoidImpl:yle,simpleAbsImpl:nR,sliceImpl:xle,sparseFillEmptyRowsImpl:vle,sparseReshapeImpl:ble,sparseSegmentReductionImpl:oR,sqrtImpl:wle,staticRegexReplaceImpl:Cle,stridedSliceImpl:_le,stringNGramsImpl:Sle,stringSplitImpl:Ile,stringToHashBucketFastImpl:Tle,subImpl:kle,tileImpl:Ele,topKImpl:Nle,transposeImpl:Ry,uniqueImpl:Dle}=N_;function Pz(r,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${r}.${t}`)}function Pn(r,e){return e===1?[r]:Pz(r,e)}function Ale(r,e){if(r===1)return"rc";let t="";for(let n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var sR=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Er(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let t=Pn("rc",this.rank),n=bt(this.rank),o=this.getOutOfBoundsCondition(t),s=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let s=`${n===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)s=`${e[e.length-1-i]},`+s;t.push(s)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){let t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}};var iw=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length);let n="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),n+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${pHe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Jb():Qb(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function pHe(r,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?mce(["r","c","d"],"inputShape"):Fl(["r","c","d"],r)}
      return ivec3(r, c, d);
    }
  `}var iR=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let o=Ole(t,n),s=Mle(e,o,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let i=Rle(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();let c=this.freeTextures[s].pop();return this.usedTextures[s].push(c),c}let a;return o===ts.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===ts.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===ts.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===ts.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===ts.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,n,o){if(this.freeTextures==null)return;let s=Ole(n,o),i=Mle(t,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);let a=Rle(t,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),c=Z().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let l=this.usedTextures[i],u=l&&l.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[u]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function dHe(r,e){let t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function Rle(r,e,t,n,o){let s=hHe(e,n),i;if(o){let[c,l]=Dp(r[0],r[1]);i=c*l}else{let[c,l]=Ey(r[0],r[1]);i=c*l}let a=dHe(t,s);return i*a}function hHe(r,e){switch(r){case ts.PACKED_2X2_FLOAT32:return Mz(e);case ts.PACKED_2X2_FLOAT16:return Fz(e);case ts.UNPACKED_FLOAT32:return Az(e);case ts.UNPACKED_FLOAT16:return Rz(e);case ts.PACKED_4X1_UNSIGNED_BYTE:return Oz(e);default:throw new Error(`Unknown physical texture type ${r}`)}}function fHe(r){return Z().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?ts.PACKED_2X2_FLOAT32:ts.UNPACKED_FLOAT32:r?ts.PACKED_2X2_FLOAT16:ts.UNPACKED_FLOAT16}function Ole(r,e){if(r===ms.UPLOAD)return ts.PACKED_2X2_FLOAT32;if(r===ms.RENDER||r==null)return fHe(e);if(r===ms.DOWNLOAD||r===ms.PIXELS)return ts.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${r}`)}function Mle(r,e,t){return`${r[0]}_${r[1]}_${e}_${t}`}var jo=class{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},ro="if (isnan(x)) return x;",Fle="return x;",$z="return abs(x);";var Ple="return (x >= 0.0) ? x : (exp(x) - 1.0);",$le=ro+`
  return (x < 0.0) ? 0.0 : x;
`,Lle=ro+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Rp="return x;",Vle="return 1.0 / (1.0 + exp(-1.0 * x));";var zle="return x;",Ule=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Gle=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Wle=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jle="return 1.0 / (1.0 + exp(-1.0 * x));",ri=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var aR=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length);let t=e.length,n=Pn("rc",t),o=bt(t),s=Ale(t,n),i=n.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var gHe=to.whereImpl,yHe=1e-7,xHe=1e-4,cR={};function vHe(r){return r in cR||(cR[r]={}),cR[r]}var bHe=Z().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),wHe=600;function CHe(){return Z().global.screen==null?1024:Z().global.screen.height*Z().global.screen.width*window.devicePixelRatio*wHe/1024/1024}var Hle=(()=>{class r extends Sc{nextDataId(){return r.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Z().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof sw)n=t;else{let o=Bi(Z().getNumber("WEBGL_VERSION"),t);n=new sw(o)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let o=Bi(Z().getNumber("WEBGL_VERSION"));n=new sw(o),this.binaryCache=vHe(Z().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new iR(this.gpgpu),this.numMBBeforeWarning=CHe(),this.texData=new dd(this,_o())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,o,s,i,a){let c=this.makeTensorInfo(n,o),l=this.texData.get(c.dataId);l.isPacked=!1,l.texture={texture:t,texShape:[s,i]},l.texShape=[s,i];let u=cS(n),p=new lS(u,!1,a),d=this.runWebGLProgram(p,[c],o,[[s,i]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(c),d.dataId}write(t,n,o){if((Z().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Z().getBool("DEBUG"))&&this.checkNumericalProblems(t),o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let s={id:this.nextDataId()};return this.texData.set(s,{shape:n,dtype:o,values:t,usage:ms.UPLOAD,refCount:1}),s}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){let n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){let n=this.texData.get(t);n.refCount--}}move(t,n,o,s,i){if(Z().getBool("DEBUG")&&this.checkNumericalProblems(n),s==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:s,values:n,usage:ms.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){let n=this.texData.get(t),{values:o,dtype:s,complexTensorInfos:i,slice:a,shape:c,isPacked:l}=n;if(a!=null){let h;l?h=new ri(c,Rp):h=new jo(c,Rp);let f=this.runWebGLProgram(h,[{dataId:t,shape:c,dtype:s}],s),m=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),m}if(o!=null)return this.convertAndCacheOnCPU(t);if(s==="string")return o;let u=this.activeTimers!=null,p;u&&(p=C.now());let d;if(s==="complex64"){let h=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);d=E.mergeRealAndImagArrays(h,f)}else d=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=C.now()-p),this.convertAndCacheOnCPU(t,d)}read(t){return M(this,null,function*(){if(this.pendingRead.has(t)){let m=this.pendingRead.get(t);return new Promise(g=>m.push(g))}let n=this.texData.get(t),{values:o,shape:s,slice:i,dtype:a,complexTensorInfos:c,isPacked:l}=n;if(i!=null){let m;l?m=new ri(s,Rp):m=new jo(s,Rp);let g=this.runWebGLProgram(m,[{dataId:t,shape:s,dtype:a}],a),y=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(o!=null)return this.convertAndCacheOnCPU(t);if(Z().getBool("DEBUG")&&!Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Z().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,p;if(a!=="complex64"&&Z().get("WEBGL_BUFFER_SUPPORTED")){p=this.decode(t);let m=this.texData.get(p.dataId);u=this.gpgpu.createBufferFromTexture(m.texture.texture,...oS(s))}this.pendingRead.set(t,[]),a!=="complex64"&&(yield this.gpgpu.createAndWaitForFence());let d;if(a==="complex64"){let m=yield Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]),g=m[0],y=m[1];d=E.mergeRealAndImagArrays(g,y)}else if(u==null)d=this.getValuesFromTexture(t);else{let m=C.sizeFromShape(s);d=this.gpgpu.downloadFloat32MatrixFromBuffer(u,m)}if(p!=null&&this.disposeIntermediateTensorInfo(p),u!=null){let m=this.gpgpu.gl;je(m,()=>m.deleteBuffer(u))}let h=this.convertAndCacheOnCPU(t,d),f=this.pendingRead.get(t);return this.pendingRead.delete(t),f.forEach(m=>m(h)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&_o().removeDataId(t,this),this.pendingDeletes--),h})}readToGPU(t,n={}){let o=this.texData.get(t),{values:s,shape:i,slice:a,dtype:c,isPacked:l,texture:u}=o;if(c==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let f;l?f=new ri(i,Rp):f=new jo(i,Rp);let m=this.runWebGLProgram(f,[{dataId:t,shape:i,dtype:c}],c),g=this.readToGPU(m,n);return this.disposeIntermediateTensorInfo(m),g}if(u==null)throw s!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let p=this.decode(t,n.customTexShape),d=_o().makeTensorFromTensorInfo(p),h=this.texData.get(p.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let o=n.map(s=>C.decodeString(s));return ze(t.shape,t.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ze(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){let o=t[n];if(!Xae(o))throw Z().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:n,dtype:o,isPacked:s}=this.texData.get(t),i=C.sizeFromShape(n);if(Z().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let h=this.decode(t),f=this.texData.get(h.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...oS(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(h),m}let a=Z().getBool("WEBGL_PACK")&&s===!0,c=a?cS(n):n,l=a?new eR(c):new JA(c),u=this.runWebGLProgram(l,[{shape:c,dtype:o,dataId:t}],"float32"),p=this.texData.get(u.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),d}timerAvailable(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){let n=this.activeTimers,o=[],s=!1;this.programTimersStack==null?(this.programTimersStack=o,s=!0):this.activeTimers.push(o),this.activeTimers=o,t();let i=C.flatten(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),a=C.flatten(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,s&&(this.programTimersStack=null);let c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return M(this,null,function*(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let l=yield Promise.all(i);c.kernelMs=C.sum(l),c.getExtraProfileInfo=()=>l.map((u,p)=>({name:a[p],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else c.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,c})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:C.now(),endMs:null}}endTimer(t){return Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=C.now(),t)}getQueryTime(t){return M(this,null,function*(){if(Z().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let n=t;return n.endMs-n.startMs})}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);let{complexTensorInfos:o}=this.texData.get(t);return o!=null&&(this.disposeData(o.real.dataId,n),this.disposeData(o.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){let{texture:n,dtype:o,texShape:s,usage:i,isPacked:a,slice:c}=this.texData.get(t),l=c&&c.origDataId||t,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(n,s,i,a)));let p=this.texData.get(t);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=bHe){return Z().getBool("WEBGL_CPU_FORWARD")&&t.every(o=>this.texData.get(o.dataId).texture==null&&C.sizeFromShape(o.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){E.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=t.dataSync();return gHe(t.shape,n)}packedUnaryOp(t,n,o){let s=new ri(t.shape,n),i=this.compileAndRun(s,[t],o);return _o().makeTensorFromTensorInfo(i)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let s=nR(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,s)}if(Z().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$z,t.dtype);let n=new jo(t.shape,$z),o=this.compileAndRun(n,[t]);return _o().makeTensorFromTensorInfo(o)}makeTensorInfo(t,n,o){let s;if(n==="string"&&o!=null&&o.length>0&&C.isString(o[0])){let i=o.map(a=>C.encodeString(a));s=this.write(i,t,n)}else s=this.write(o,t,n);return this.texData.get(s).usage=null,{dataId:s,shape:t,dtype:n}}makeOutput(t,n,o){return _o().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,o),this)}unpackTensor(t){let n=new aR(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){let n=new sR(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){let o=[vm(t.shape),...bm(t.shape)],s={dtype:t.dtype,shape:o,dataId:t.dataId},i=[vm(n),...bm(n)],a=new iw(i,o),c=!0,l=[o],u=this.runWebGLProgram(a,[s],t.dtype,l,c);return{dataId:u.dataId,shape:n,dtype:u.dtype}}decode(t,n){let o=this.texData.get(t),{isPacked:s,shape:i,dtype:a}=o;if(n!=null){let h=C.sizeFromShape(i),f=n[0]*n[1]*4;C.assert(h<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let c=cS(i),l;s?l=new QA(c):l=new ZA(c);let u=!0,p=[n??oS(c)],d=this.runWebGLProgram(l,[{shape:c,dtype:a,dataId:t}],a,p,u,n);return{dtype:a,shape:i,dataId:d.dataId}}runWebGLProgram(t,n,o,s,i=!1,a){let c=this.makeTensorInfo(t.outputShape,o),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===ky.DENSE){let x=a??oS(t.outputShape);l.texShape=x.map(b=>b*2)}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),C.sizeFromShape(c.shape)===0)return l.values=C.getTypedArrayFromDType(c.dtype,0),c;let u=[],p=n.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!t.packedInputs&&C.sizeFromShape(x.shape)<=Z().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!b.isPacked!=!!t.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),u.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!Ny(b.shape,x.shape)){let w=x,_=x.shape;x.shape=b.shape,x=this.packedReshape(x,_),u.push(x),b=this.texData.get(x.dataId),w.shape=_}return{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(c.dataId);let d={shape:c.shape,texData:l,isUniform:!1},h=_ce(t,p,d),f=this.getAndSaveBinary(h,()=>wce(this.gpgpu,t,p,d)),m=this.activeTimers!=null,g;m&&(g=this.startTimer()),Z().get("ENGINE_COMPILE_ONLY")||Cce(this.gpgpu,f,p,d,s),u.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));let y=Z().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){let x=C.now();x-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!Z().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){let x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c}compileAndRun(t,n,o,s,i=!1){return o=o||n[0].dtype,this.runWebGLProgram(t,n,o,s,i)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Z().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ee(()=>{if(!Z().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=Z().getBool("DEBUG");Z().set("DEBUG",!1);let n=this.abs(Oe(1e-8)).dataSync()[0];if(Z().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?yHe:xHe}uploadToGPU(t){let n=this.texData.get(t),{shape:o,dtype:s,values:i,texture:a,usage:c,isPacked:l}=n;if(a!=null)return;let u=this.activeTimers!=null,p;u&&(p=C.now());let d=n.texShape;if(d==null&&(d=cce(o,l),n.texShape=d),i!=null){let h=cS(o),f,m=d[1],g=d[0],y=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!y)&&([m,g]=Dp(d[0],d[1])),l?f=new tR(h,y):f=new lS(h,y);let x=y?[g,m]:d,b=this.makeTensorInfo(x,s),w=this.texData.get(b.dataId);y?w.usage=ms.PIXELS:w.usage=ms.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,i);let _=[[g,m]],S=this.runWebGLProgram(f,[b],s,_,!0),k=this.texData.get(S.dataId);n.texShape=k.texShape,n.isPacked=k.isPacked,n.usage=k.usage,Z().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(n.texture=k.texture,n.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(b),u&&(this.uploadWaitMs+=C.now()-p)}else{let h=this.acquireTexture(d,c,s,l);n.texture=h}}convertAndCacheOnCPU(t,n){let o=this.texData.get(t),{dtype:s}=o;return n!=null&&(o.values=_He(n,s)),o.values}acquireTexture(t,n,o,s){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,s)}computeBytes(t,n){return t[0]*t[1]*C.bytesPerElement(n)}checkCompileCompletion(){for(let[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}checkCompileCompletionAsync(){return M(this,null,function*(){let t=[];if(this.gpgpu.parallelCompilationExtension){for(let[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(let[,n]of Object.entries(this.binaryCache)){let o=new Promise(s=>{try{this.checkCompletion_(n),s(!0)}catch(i){throw i}});t.push(o)}return Promise.all(t)}})}checkCompletionAsync_(t){return M(this,null,function*(){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(yield f_(),this.checkCompletionAsync_(t))})}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Tz(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);let{variablesLocations:n,customUniformLocations:o,infLoc:s,nanLoc:i,outShapeLocation:a,outShapeStridesLocation:c,outTexShapeLocation:l}=Dz(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=o,t.infLoc=s,t.nanLoc=i,t.outShapeLocation=a,t.outShapeStridesLocation=c,t.outTexShapeLocation=l}}createTensorFromGPUData(t,n,o){t.channels=t.channels||"RGBA";let{texture:s,height:i,width:a,channels:c}=t,l=_o().backend;if(!l.gpgpu.gl.isTexture(s))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let u=l.writeTexture(s,n,o,i,a,c);return _o().makeTensorFromDataId(u,n,o,l)}}return r.nextDataId=0,r})();function _He(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){let t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length);for(let n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error(`Unknown dtype ${e}`)}Vf.isBrowser()&&Fv("webgl",()=>new Hle,2);var aw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var ni=class{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=E.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Er(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var Ui=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var zi=class{constructor(e,t,n,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=E.assertAndGetBroadcastShape(t,n);let s=this.outputShape.length;this.enableShapeUniforms=Er(s);let i="";if(o)if(s===0||C.sizeFromShape(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${bt(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let c=Pn("coords",s);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${c[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${c[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${c[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${c[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}};function $n(r){let{inputs:e,backend:t}=r,{x:n}=e;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var qle={kernelName:Aa,backendName:"webgl",kernelFunc:$n};function oi(r){let{inputs:e,backend:t}=r,{real:n,imag:o}=e,s=t.makeTensorInfo(n.shape,"complex64"),i=t.texData.get(s.dataId),a=$n({inputs:{x:n},backend:t}),c=$n({inputs:{x:o},backend:t});return i.complexTensorInfos={real:a,imag:c},s}var Kle={kernelName:qh,backendName:"webgl",kernelFunc:oi};var Lz="return (a < 0.) ? b * a : a;",Vz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function SHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{alpha:s}=n,i=t.makeTensorInfo([],"float32",C.createScalarValue(s,"float32")),a=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zi(Vz,o.shape,i.shape):new ni(Lz,o.shape,i.shape),c=t.runWebGLProgram(a,[o,i],"float32");return t.disposeIntermediateTensorInfo(i),c}var Xle={kernelName:Pu,backendName:"webgl",kernelFunc:SHe};var Bz="return (a < 0.) ? b * a : a;",zz=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function IHe(r){let{inputs:e,backend:t}=r,{x:n,alpha:o}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zi(zz,n.shape,o.shape):new ni(Bz,n.shape,o.shape);return t.runWebGLProgram(s,[n,o],"float32")}var Yle={kernelName:Xu,backendName:"webgl",kernelFunc:IHe};var ec="if (isnan(x)) return x;";function et({opSnippet:r,packedOpSnippet:e,cpuKernelImpl:t,dtype:n}){return({inputs:o,backend:s})=>{let{x:i}=o,a=s,c=n||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){let p=a.texData.get(i.dataId),d=t(p.values,c);return a.makeTensorInfo(i.shape,c,d)}let l=Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null,u;return l?u=new ri(i.shape,e):u=new jo(i.shape,r),a.runWebGLProgram(u,[i],c)}}function br({opSnippet:r,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:n=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{let{a:c,b:l}=i,u=a;if(n&&c.dtype==="complex64"){let f=u.texData.get(c.dataId),m=u.texData.get(l.dataId),[g,y]=[[f.complexTensorInfos.real,m.complexTensorInfos.real],[f.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{let[w,_]=b,I={dataId:w.dataId,dtype:w.dtype,shape:c.shape},S={dataId:_.dataId,dtype:_.dtype,shape:l.shape},k=new ni(r,c.shape,l.shape);return u.runWebGLProgram(k,[I,S],$r(w.dtype,_.dtype))}),x=oi({inputs:{real:g,imag:y},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(y),x}let p=s||$r(c.dtype,l.dtype);if((c.dtype==="string"||l.dtype==="string"||u.shouldExecuteOnCPU([c,l]))&&o!=null){let f=u.texData.get(c.dataId).values,m=u.texData.get(l.dataId).values,g=c.dtype==="string"?E.fromUint8ToStringArray(f):f,y=c.dtype==="string"?E.fromUint8ToStringArray(m):m,[x,b]=o(c.shape,l.shape,g,y,p),w=u.makeTensorInfo(b,p),_=u.texData.get(w.dataId);return _.values=x,w}let d=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null,h;return d?h=new zi(e,c.shape,l.shape,t):h=new ni(r,c.shape,l.shape),u.runWebGLProgram(h,[c,l],p)}}function Xd(r,e=!1){if(r==="linear")return e?zle:Fle;if(r==="relu")return e?Gle:$le;if(r==="elu")return e?Ule:Ple;if(r==="relu6")return e?Wle:Lle;if(r==="prelu")return e?zz:Bz;if(r==="leakyrelu")return e?Vz:Lz;if(r==="sigmoid")return e?jle:Vle;throw new Error(`Activation ${r} has not been implemented for the WebGL backend.`)}var cw=class{constructor(e,t,n,o=!1,s=!1,i=!1,a=null,c=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Er(this.outputShape.length);let u=o?e[1]:e[2],p=Math.ceil(u/2),d=o?"i * 2, rc.y":"rc.y, i * 2",h=s?"rc.z, i * 2":"i * 2, rc.z",f=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";a&&(c?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");let x=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";e[0]<t[0]?b=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(w=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${w};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${d});
          vec4 b = getMatrixB(batchB, ${h});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${f[0]} * ${m[0]});
          result += (${f[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${y}

        setOutput(result);
      }
    `}};var Uz={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},pS=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=E.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var Zle="return a * b;";function dS(r){let{inputs:e,backend:t}=r,{a:n,b:o}=e,s=E.upcastType(n.dtype,o.dtype);if(n.dtype==="complex64"){let a=t.texData.get(n.dataId),c=t.texData.get(o.dataId),l=new pS(Uz.REAL,n.shape,o.shape),u=new pS(Uz.IMAG,n.shape,o.shape),p=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:n.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:o.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:o.shape}],d=t.runWebGLProgram(l,p,"float32"),h=t.runWebGLProgram(u,p,"float32"),f=oi({inputs:{real:d,imag:h},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),f}if(t.shouldExecuteOnCPU([n,o])){let a=t.texData.get(n.dataId),c=t.texData.get(o.dataId),[l,u]=ale(n.shape,o.shape,a.values,c.values,s),p=t.makeTensorInfo(u,s),d=t.texData.get(p.dataId);return d.values=l,p}let i;return Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new zi(Zle,n.shape,o.shape):i=new ni(Zle,n.shape,o.shape),t.runWebGLProgram(i,[n,o],s)}var Qle={kernelName:Qc,backendName:"webgl",kernelFunc:dS};function Jle(r,e,t){let n=[vm(r.shape),...bm(r.shape)],o={dtype:r.dtype,shape:n,dataId:r.dataId},s=[vm(e),...bm(e)],i=new iw(s,n),a=!0,c=[n],l=t.runWebGLProgram(i,[o],r.dtype,c,a);return{dataId:l.dataId,shape:e,dtype:l.dtype}}function ke(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{shape:s}=n,i=t,a=C.sizeFromShape(o.shape),c=C.inferFromImplicitShape(s,a),l=C.sizeFromShape(c);C.assert(a===l,()=>`The new shape (${c}) has ${l} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=i.texData.get(o.dataId);return u.isPacked&&!Ny(o.shape,c)&&!(u.texture!==null&&Ny(u.shape,c))?Jle(o,c,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:c,dtype:o.dtype})}var eue={kernelName:Zu,backendName:"webgl",kernelFunc:ke};var hS=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a=Math.floor(n/4)*4,c=n%4,l="sumValue += dot(values, ones);";if(t!=null){let p=1/t;l=`sumValue += dot(values * ${C.isInt(p)?p.toPrecision(2):p}, ones);`}let u="";s%n>0&&(u=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}};var lR=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a="0.0",c="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",c="min"):t==="max"&&(a="-1.0 / 1e-20",c="max");let l=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");let u=Math.floor(n/4)*4,p=n%4,d=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,h="vec4";t==="all"?(a="1.0",d=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,h="bvec4"):t==="any"&&(a="0.0",d=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,h="bvec4");let f="";s%n>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${p===1}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${p===2}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${d}
        } else if (${p===3}) {
          ${h} values = ${h}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${d}
        }
        setOutput(${l});
      }
    `}};function kHe(r){let e=[];for(;e.length===0||e[e.length-1].outSize!==1;){let t=e.length?e[e.length-1].outSize:r[1],n=E.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function Gi(r,e,t,n){let o=kHe(r.shape),s=r;for(let i=0;i<o.length;i++){let{inSize:a,windowSize:c,outSize:l}=o[i],u,p;t==="mean"?u=i===0?new hS({windowSize:c,inSize:a,batchSize:r.shape[0],outSize:l},a):new hS({windowSize:c,inSize:a,batchSize:r.shape[0],outSize:l}):u=new lR({windowSize:c,inSize:a,batchSize:r.shape[0],outSize:l},t),p=s,s=n.runWebGLProgram(u,[s],e),p.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(p)}return s}var uR=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[t[i]];this.outputShape=n,this.rank=n.length;let o=bt(this.rank),s=EHe(t);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}};function EHe(r){let e=r.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);let t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e);for(let o=0;o<r.length;o++)n[r[o]]=t[o];return n.join()}var pR=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[t[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=bt(this.rank),s=Pz("rc",this.rank),i=new Array(this.rank);for(let u=0;u<t.length;u++)i[t[u]]=s[u];let a=`vec2(${i.slice(-2).join()})`,c=`++${s[this.rank-1]} < ${n[this.rank-1]}`,l=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${c}) {
        result[1] = ${l};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${l};
        if(${c}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}};function wm(r,e,t){let n=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pR(r.shape,e):new uR(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function tue(r,e,t,n){let o=e,s=r.shape.length,i=C.parseAxisParam(o,r.shape),a=i,c=E.getAxesPermutation(a,s),l=c!=null,u=r;l&&(u=wm(r,c,n),a=E.getInnerMostAxes(a.length,s)),E.assertAxesAreInnerMostDims("sum",a,s);let[p,d]=E.computeOutAndReduceShapes(u.shape,a),h=p;t&&(h=E.expandShapeToKeepDim(p,i));let f=C.sizeFromShape(d),g=C.sizeFromShape(r.shape)/f,y=ke({inputs:{x:u},attrs:{shape:[g,f]},backend:n}),x=Td(r.dtype),b=Gi(y,x,"sum",n),w=ke({inputs:{x:b},attrs:{shape:h},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),l&&n.disposeIntermediateTensorInfo(u),w}function Oy(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n;return tue(o,s,i,t)}var rue={kernelName:np,backendName:"webgl",kernelFunc:Oy};function an(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{perm:s}=n,i=t,a=o.shape.length,c=new Array(a);for(let u=0;u<c.length;u++)c[u]=o.shape[s[u]];let l;if(i.shouldExecuteOnCPU([o])){let p=i.texData.get(o.dataId).values,d=Ry(p,o.shape,o.dtype,s,c);l=i.makeTensorInfo(c,o.dtype);let h=i.texData.get(l.dataId);h.values=d}else l=wm(o,s,i);return l}var nue={kernelName:Oa,backendName:"webgl",kernelFunc:an};var Gz=1e3;function My({a:r,b:e,transposeA:t,transposeB:n,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:c=null}){let l=r.shape.length,u=e.shape.length,p=t?r.shape[l-2]:r.shape[l-1],d=n?e.shape[u-1]:e.shape[u-2],h=t?r.shape[l-1]:r.shape[l-2],f=n?e.shape[u-2]:e.shape[u-1],m=r.shape.slice(0,-2),g=e.shape.slice(0,-2),y=C.sizeFromShape(m),x=C.sizeFromShape(g),w=ks.assertAndGetBroadcastShape(r.shape.slice(0,-2),e.shape.slice(0,-2)).concat([h,f]);C.assert(p===d,()=>`Error in matMul: inner shapes (${p}) and (${d}) of Tensors with shapes ${r.shape} and ${e.shape} and transposeA=${t} and transposeB=${n} must match.`);let _=t?[y,p,h]:[y,h,p],I=n?[x,f,d]:[x,d,f],S=ke({inputs:{x:r},backend:o,attrs:{shape:_}}),k=ke({inputs:{x:e},backend:o,attrs:{shape:I}}),R=[S,k],L=Math.max(y,x),B=t?S.shape[1]:S.shape[2],z=s!=null,q=i!=null,U=c==="leakyrelu",G=c!=null?Xd(c,!0):null,j=z||q||U||G!=null,X;if((h===1||f===1)&&B>Gz&&j===!1){let ne=S,oe=k;t&&(ne=an({inputs:{x:S},backend:o,attrs:{perm:[0,2,1]}}),R.push(ne)),n&&(oe=an({inputs:{x:k},backend:o,attrs:{perm:[0,2,1]}}),R.push(oe));let le=f!==1,xe=f===1,ge=ne;le&&(ge=ke({inputs:{x:ne},backend:o,attrs:{shape:[L,B,1]}}),R.push(ge));let Re=f===1?2:1,Ee=oe;xe&&(Ee=ke({inputs:{x:oe},backend:o,attrs:{shape:[L,1,B]}}),R.push(Ee));let Ne=dS({inputs:{a:ge,b:Ee},backend:o});X=Oy({inputs:{x:Ne},backend:o,attrs:{axis:Re,keepDims:!0}}),R.push(Ne)}else{let ne=$r(r.dtype,e.dtype),oe=new cw(_,I,[L,h,f],t,n,z,G,q,U),le=[S,k];if(s!=null&&le.push(s),q&&le.push(i),U){let xe=o.makeTensorInfo([],"float32",C.createScalarValue(a,"float32"));le.push(xe),R.push(xe)}X=o.runWebGLProgram(oe,le,ne)}let te=ke({inputs:{x:X},backend:o,attrs:{shape:w}});R.push(X);for(let ne of R)o.disposeIntermediateTensorInfo(ne);return te}function NHe(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:c,transposeB:l,activation:u,leakyreluAlpha:p}=n;return My({a:o,b:s,transposeA:c,transposeB:l,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:p,activation:u})}var oue={kernelName:Cd,backendName:"webgl",kernelFunc:NHe};var sue="return abs(x);";function DHe(r){let{inputs:e,backend:t}=r,{x:n}=e;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){let s=t.texData.get(n.dataId),i=nR(s.values);return t.makeTensorInfo(n.shape,n.dtype,i)}let o;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new ri(n.shape,sue):o=new jo(n.shape,sue),t.runWebGLProgram(o,[n],n.dtype)}var iue={kernelName:yu,backendName:"webgl",kernelFunc:DHe};var AHe=ro+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,RHe=et({opSnippet:AHe}),aue={kernelName:Ic,backendName:"webgl",kernelFunc:RHe};var OHe=ro+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,MHe=et({opSnippet:OHe}),cue={kernelName:Tc,backendName:"webgl",kernelFunc:MHe};var lue="return a + b;",FHe=br({opSnippet:lue,packedOpSnippet:lue,supportsComplex:!0,cpuKernelImpl:Bce}),uue={kernelName:ra,backendName:"webgl",kernelFunc:FHe};var dR=class{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`float v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var hR=class{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`vec4 v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function fR(r){let{inputs:e,backend:t}=r,n=e;if(n.length===1)return $n({inputs:{x:n[0]},backend:t});if(n.length>Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let c=Math.floor(n.length/2),l=fR({inputs:n.slice(0,c),backend:t}),u=fR({inputs:n.slice(c),backend:t});return fR({inputs:[l,u],backend:t})}let o=n.map(c=>c.dtype).reduce((c,l)=>$r(c,l)),s=n.map(c=>c.shape),a=Z().getBool("WEBGL_PACK")?new hR(n[0].shape,s):new dR(n[0].shape,s);return t.runWebGLProgram(a,n,o)}var pue={kernelName:xu,backendName:"webgl",kernelFunc:fR};function PHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,c=C.parseAxisParam(s,o.shape),l=c,u=E.getAxesPermutation(l,a),p=o;u!=null&&(p=an({inputs:{x:o},backend:t,attrs:{perm:u}}),l=E.getInnerMostAxes(l.length,a)),E.assertAxesAreInnerMostDims("all",l,a);let[d,h]=E.computeOutAndReduceShapes(p.shape,l),f=C.sizeFromShape(h),m=ke({inputs:{x:p},backend:t,attrs:{shape:[-1,f]}}),g=Gi(m,m.dtype,"all",t),y;if(i){let x=E.expandShapeToKeepDim(d,c);y=ke({inputs:{x:g},backend:t,attrs:{shape:x}})}else y=ke({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(p),y}var due={kernelName:zh,backendName:"webgl",kernelFunc:PHe};function $He(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,c=C.parseAxisParam(s,o.shape),l=c,u=E.getAxesPermutation(l,a),p=o;u!=null&&(p=an({inputs:{x:o},backend:t,attrs:{perm:u}}),l=E.getInnerMostAxes(l.length,a)),E.assertAxesAreInnerMostDims("any",l,a);let[d,h]=E.computeOutAndReduceShapes(p.shape,l),f=C.sizeFromShape(h),m=ke({inputs:{x:p},backend:t,attrs:{shape:[-1,f]}}),g=Gi(m,m.dtype,"any",t),y;if(i){let x=E.expandShapeToKeepDim(d,c);y=ke({inputs:{x:g},backend:t,attrs:{shape:x}})}else y=ke({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(p),y}var hue={kernelName:Uh,backendName:"webgl",kernelFunc:$He};var mR=class{constructor(e,t,n){this.variableNames=["A"];let{windowSize:o,batchSize:s,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];let a=t==="max"?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var gR=class{constructor(e,t,n,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let s=e[e.length-1],i=Math.ceil(s/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,c=a.length,l=bt(c),u=Pn("coords",c),p,d;if(i===1){d=c+1;let k=bt(d);p=`
        ${k} sourceLocR = ${k}(${u.join()}, 0);
        ++${u[c-1]};
        ${k} sourceLocG = ${k}(${u.join()}, 0);
        ++${u[c-2]};
        ${k} sourceLocA = ${k}(${u.join()}, 0);
        --${u[c-1]};
        ${k} sourceLocB = ${k}(${u.join()}, 0);
        --${u[c-2]};`}else d=c,p=`
        ${l} sourceLocR = coords;
        ++${u[c-1]};
        ${l} sourceLocG = coords;
        ++${u[c-2]};
        ${l} sourceLocA = coords;
        --${u[c-1]};
        ${l} sourceLocB = coords;
        --${u[c-2]};`;let h=["x","y","z","w","u","v"].slice(0,d),f="."+h[d-1],m=h.map(k=>"int "+k),g=Pn("sourceLocR",d-1).concat("inIdx.r"),y=Pn("sourceLocG",d-1).concat("inIdx.g"),x=Pn("sourceLocB",d-1).concat("inIdx.b"),b=Pn("sourceLocA",d-1).concat("inIdx.a"),w=n==="max"?"greaterThan":"lessThan",_=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()})));`,I=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,S=o?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${h.join()}),
                                          vec2(${h.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${h.join()}),
                               vec2(${h.slice(-2).join()}));
      }
      ${S}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${u[c-1]} < ${a[c-1]-1};
        bool hasNextRow = ${u[c-2]} < ${a[c-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${f}, sourceLocG${f},
          sourceLocB${f}, sourceLocA${f}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${_}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function fue(r,e,t,n=null){let o=e.shape[0],s=e.shape[1];n!=null&&(o=n.shape[0],s=n.shape[1]);let i=E.computeOptimalWindowSize(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},c=new mR(a,t,n==null),l=[e];n!=null&&l.push(n);let u=r.runWebGLProgram(c,l,"int32");if(u.shape[1]===1)return u;let p=fue(r,e,t,u);return r.disposeIntermediateTensorInfo(u),p}function mue(r,e,t,n=null){let o=n!=null?n.shape:e.shape,s=o[o.length-1],i=E.computeOptimalWindowSize(s),a=new gR(o,i,t,n==null),c=n==null?[e]:[e,n],l=r.runWebGLProgram(a,c,"int32");if(l.shape.length===e.shape.length){let u=mue(r,e,t,l);return r.disposeIntermediateTensorInfo(l),u}return l}function yR(r,e,t,n){let o=[t];if(E.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),o,e.shape.length),!Z().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){let s=[],i=r.texData.get(e.dataId),a=i!==null&&i.isPacked,c=e;a&&(c=r.unpackTensor(e),s.push(c));let[l,u]=E.computeOutAndReduceShapes(c.shape,o),p=C.sizeFromShape(u),d=ke({inputs:{x:c},backend:r,attrs:{shape:[-1,p]}});s.push(d);let h=fue(r,d,n);s.push(h);let f=ke({inputs:{x:h},backend:r,attrs:{shape:l}});return s.forEach(m=>r.disposeIntermediateTensorInfo(m)),f}return mue(r,e,n)}function LHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n,i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=an({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),E.assertAxesAreInnerMostDims("argMax",[i[0]],c.shape.length);let u=yR(t,c,i[0],"max");return l.forEach(p=>t.disposeIntermediateTensorInfo(p)),u}var gue={kernelName:vu,backendName:"webgl",kernelFunc:LHe};function VHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s}=n,i=C.parseAxisParam(s,o.shape),a=E.getAxesPermutation(i,o.shape.length),c=o,l=[];a!=null&&(c=an({inputs:{x:o},backend:t,attrs:{perm:a}}),l.push(c),i=E.getInnerMostAxes(i.length,c.shape.length)),E.assertAxesAreInnerMostDims("argMin",[i[0]],c.shape.length);let u=yR(t,c,i[0],"min");return l.forEach(p=>t.disposeIntermediateTensorInfo(p)),u}var yue={kernelName:bu,backendName:"webgl",kernelFunc:VHe};var BHe=ro+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,zHe=et({opSnippet:BHe}),xue={kernelName:kc,backendName:"webgl",kernelFunc:zHe};var UHe=ro+"return log(x + sqrt(x * x + 1.0));",GHe=et({opSnippet:UHe}),vue={kernelName:Ec,backendName:"webgl",kernelFunc:GHe};var WHe=ro+`
  return atan(x);
`,jHe=et({opSnippet:WHe}),bue={kernelName:Nc,backendName:"webgl",kernelFunc:jHe};var HHe=aw+`
  return atan(a, b);
`,qHe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ui+`
  return result;
`,KHe=br({opSnippet:HHe,packedOpSnippet:qHe}),wue={kernelName:Ac,backendName:"webgl",kernelFunc:KHe};var XHe=ro+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,YHe=et({opSnippet:XHe}),Cue={kernelName:Dc,backendName:"webgl",kernelFunc:YHe};var Pl=class{constructor(e,t,n,o=!1,s=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,u=e.dilationWidth,p=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;let m=t==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,x="0.0";if(m||(x="-1.0 / 1e-20"),n){let k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${c});
        const ivec2 pads = ivec2(${h}, ${f});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?g:y:`wR * ${d} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",w=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(w="avgValue / max(count, 1.0)");let _=Math.floor(i/4)*4,I=i%4,S=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${c});
      const ivec2 pads = ivec2(${h}, ${f});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${_}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${S}
          }

          int xC = xCCorner + ${_};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${S}
          }
        }
        setOutput(${w});
      }
    `}},Cm=class{constructor(e,t,n,o=!1,s=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideDepth,c=e.strideHeight,l=e.strideWidth,u=e.dilationDepth,p=e.dilationHeight,d=e.dilationWidth,h=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,y=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;let b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),n){let L=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${c}, ${l});
        const ivec3 pads = ivec3(${g}, ${y}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${h};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${f};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${d}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${L} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${f} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let _="max",I=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(I="avgValue / max(count, 1.0)");let S=Math.floor(i/4)*4,k=i%4,R=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${_}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${c}, ${l});
      const ivec3 pads = ivec3(${g}, ${y}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${S}; wC += 4) {
              int xC = xCCorner + wC * ${d};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                getValue(batch, xD, xR, xC + 3 * ${d}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${S};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${d}, ch),
                getValue(batch, xD, xR, xC + 2 * ${d}, ch),
                initializationValue
              );

              ${R}
            }
          }
        }
        setOutput(${I});
      }
    `}};function ZHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e;Ap(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,l=1;C.assert(E.eitherStridesOrDilationsAreOne(i,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);let u=E.computePool2DInfo(o.shape,s,i,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))return $n({inputs:{x:o},backend:t});let p=new Pl(u,"avg",!1);return t.runWebGLProgram(p,[o],"float32")}var _ue={kernelName:wu,backendName:"webgl",kernelFunc:ZHe};function QHe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:c,dataFormat:l}=n,u=[1,1,1],p=E.computePool3DInfo(o.shape,s,i,u,a,c,l),d=new Cm(p,"avg",!1);return t.runWebGLProgram(d,[o],"float32")}var Sue={kernelName:Cu,backendName:"webgl",kernelFunc:QHe};var xR=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,u=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${p});
      const float avgMultiplier = float(${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},vR=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=p-1-e.padInfo.front,m=d-1-e.padInfo.top,g=h-1-e.padInfo.left,y=1/(t*n*o);this.userCode=`
      const ivec3 pads = ivec3(${f}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function JHe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=n,p=[1,1,1],d=E.computePool3DInfo(i.shape,a,c,p,l,u),h=new vR(d);return t.runWebGLProgram(h,[o],i.dtype)}var Iue={kernelName:Wh,backendName:"webgl",kernelFunc:JHe};function eqe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s;Ap([o,s],"avgPoolGrad");let{filterSize:a,strides:c,pad:l}=n,u=E.computePool2DInfo(i.shape,a,c,1,l),p=new xR(u);return t.runWebGLProgram(p,[o],i.dtype)}var Tue={kernelName:Gh,backendName:"webgl",kernelFunc:eqe};function tqe(r){let{inputs:e,backend:t,attrs:n}=r,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;return My({a:o,b:s,transposeA:i,transposeB:a,backend:t})}var kue={kernelName:_u,backendName:"webgl",kernelFunc:tqe};var bR=class{constructor(e,t,n,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],E.assertAndGetBroadcastShape(e,t),E.assertAndGetBroadcastShape(e,n);let a="0.0";o!=null&&(E.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="1.0";s!=null&&(E.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var wR=class{constructor(e,t,n,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],E.assertAndGetBroadcastShape(e,t),E.assertAndGetBroadcastShape(e,n);let a="vec4(0.0)";o!=null&&(E.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let c="vec4(1.0)";s!=null&&(E.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var rqe=({inputs:r,backend:e,attrs:t})=>{let{x:n,mean:o,variance:s,offset:i,scale:a}=r;C.assert(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=t;c==null&&(c=.001);let l=[n,o,s],u=null;i!=null&&(u=i.shape,l.push(i));let p=null;a!=null&&(p=a.shape,l.push(a));let d=Z().getBool("WEBGL_PACK_NORMALIZATION")?new wR(n.shape,o.shape,s.shape,u,p,c):new bR(n.shape,o.shape,s.shape,u,p,c);return e.runWebGLProgram(d,l,l[0].dtype)},Eue={kernelName:Mu,backendName:"webgl",kernelFunc:rqe};var CR=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let t=bt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=nqe(this.rank),o,s=e.map((i,a)=>`sourceLoc.${Wz[a]} = start[${a}] + coords.${Wz[a]};`);o=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${n}));
      }
    `}},Wz=["x","y","z","w","u","v"];function nqe(r){if(r===1)return"sourceLoc";if(r<=6)return Wz.slice(0,r).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${r} is not yet supported`)}var _R=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=bt(this.rank),n=Pn("coords",this.rank),o=Pn("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((u,p)=>`start[${p}]`).join()});`:e.map((u,p)=>`${o[p]} = ${n[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${c}
        setOutput(result);
      }
    `}};function oqe(r,e,t,n){let o=n.texData.get(r.dataId),s=n.makeTensorInfo(t,r.dtype),i=n.texData.get(s.dataId);Object.assign(i,o),i.refCount=1,i.shape=t,i.dtype=r.dtype;let a=Tn.computeFlatOffset(e,C.computeStrides(r.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||r.dataId};let c=n.dataRefCount.get(i.slice.origDataId)||1;return n.dataRefCount.set(i.slice.origDataId,c+1),s}function $l(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,size:i}=n,[a,c]=Tn.parseSliceParams(o,s,i);if(Tn.assertParamsValid(o,a,c),C.sizeFromShape(c)===0)return t.makeTensorInfo(c,o.dtype,[]);if(t.shouldExecuteOnCPU([o])||o.dtype==="string"){let p=t.texData.get(o.dataId),d=xle(p.values,a,c,o.shape,o.dtype);return t.makeTensorInfo(c,o.dtype,d)}let{isPacked:l}=t.texData.get(o.dataId),u=Tn.isSliceContinous(o.shape,a,c);if(l||!u){let p=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _R(c):new CR(c),d=[a];return t.runWebGLProgram(p,[o],o.dtype,d)}return t.uploadToGPU(o.dataId),oqe(o,a,c,t)}var Nue={kernelName:rp,backendName:"webgl",kernelFunc:$l};var sqe=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,crops:i}=n;C.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((x,b)=>x*b),c=E.getReshaped(o.shape,s,a),l=E.getPermuted(c.length,s.length),u=E.getReshapedPermuted(o.shape,s,a),p=E.getSliceBeginCoords(i,s.length),d=E.getSliceSize(u,i,s.length),h=[],f=ke({inputs:{x:o},backend:t,attrs:{shape:c}}),m=an({inputs:{x:f},backend:t,attrs:{perm:l}}),g=ke({inputs:{x:m},backend:t,attrs:{shape:u}}),y=$l({inputs:{x:g},backend:t,attrs:{begin:p,size:d}});return h.push(f),h.push(m),h.push(g),h.forEach(x=>t.disposeIntermediateTensorInfo(x)),y},Due={kernelName:Su,backendName:"webgl",kernelFunc:sqe};function iqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i}=n,a=t.readSync(o.dataId),c=t.readSync(s.dataId),l=rR(a,c,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,l)}var Aue={kernelName:jh,backendName:"webgl",kernelFunc:iqe};var aqe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,cqe=`
  return float(int(a.r) & int(b.r));
`;function lqe(r){let{inputs:e,backend:t}=r,{a:n,b:o}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=Z().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([n,o])||i===1){let c=t.texData.get(n.dataId).values,l=t.texData.get(o.dataId).values,[u,p]=Uce(n.shape,o.shape,c,l,n.dtype),d=t.makeTensorInfo(p,n.dtype),h=t.texData.get(d.dataId);return h.values=u,d}let a;return s?a=new zi(aqe,n.shape,o.shape,!1):a=new ni(cqe,n.shape,o.shape),t.runWebGLProgram(a,[n,o],n.dtype)}var Rue={kernelName:Rg,backendName:"webgl",kernelFunc:lqe};function uqe(r){let{inputs:e,backend:t}=r,{s0:n,s1:o}=e,s=t.readSync(n.dataId),i=t.readSync(o.dataId),a=E.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var Oue={kernelName:Hh,backendName:"webgl",kernelFunc:uqe};var pqe="return float(a != b);",jz=br({opSnippet:pqe,cpuKernelImpl:lle,dtype:"bool"}),Mue={kernelName:wd,backendName:"webgl",kernelFunc:jz};function Yd(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.texData.get(n.dataId);return $n({inputs:{x:o.complexTensorInfos.real},backend:t})}var Fue={kernelName:Cf,backendName:"webgl",kernelFunc:Yd};var dqe="return float(int(x));";function Pue(r,e){let t=new jo(r.shape,dqe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function Hz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return $n({inputs:{x:o},backend:t});let i=Cr(o.shape),a=Hz({inputs:{x:o},backend:t,attrs:{dtype:"float32"}}),c=oi({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),c}if(o.dtype==="complex64"){let i=Yd({inputs:{input:o},backend:t}),a=Hz({inputs:{x:i},backend:t,attrs:{dtype:s}});return t.disposeIntermediateTensorInfo(i),a}if(!C.hasEncodingLoss(o.dtype,s)){let i=$n({inputs:{x:o},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(t.shouldExecuteOnCPU([o])){let i=t.texData.get(o.dataId).values,[a,c,l]=Gce(i,o.shape,o.dtype,s);return t.makeTensorInfo(a,c,l)}if(s==="int32")return Pue(o,t);if(s==="bool"){let i=t.makeTensorInfo([],"bool",C.getTypedArrayFromDType("bool",1)),c=jz({inputs:{a:o,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),c}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var $ue={kernelName:Da,backendName:"webgl",kernelFunc:Hz};var Lue="return ceil(x);",hqe=et({opSnippet:Lue,packedOpSnippet:Lue,cpuKernelImpl:Wce}),Vue={kernelName:Rc,backendName:"webgl",kernelFunc:hqe};var SR=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var IR=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function fqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{clipValueMin:s,clipValueMax:i}=n,a;Z().getBool("WEBGL_PACK_CLIP")?a=new IR(o.shape):a=new SR(o.shape);let c=[[s],[i]];return t.runWebGLProgram(a,[o],o.dtype,c)}var Bue={kernelName:Oc,backendName:"webgl",kernelFunc:fqe};var TR=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function zue(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function mqe(r){let{inputs:e,backend:t}=r,{x:n}=e,o=t.texData.get(n.dataId),s=new TR(n.shape),i=[zue(n,o.complexTensorInfos.real),zue(n,o.complexTensorInfos.imag)];return t.runWebGLProgram(s,i,i[0].dtype)}var Uue={kernelName:Iu,backendName:"webgl",kernelFunc:mqe};var kR=class{constructor(e){this.outputShape=[],this.outputShape=E.computeOutShape(e,1),this.variableNames=e.map((i,a)=>`T${a}`);let t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){let a=t[i-1];n.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}let o=t.length,s=t[t.length-1];n.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}};var NR=class{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=E.computeOutShape(e,t);let n=this.outputShape,o=n.length,s=bt(o),i=Pn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((m,g)=>`T${g}`);let c=new Array(e.length-1);c[0]=e[0][t];for(let m=1;m<c.length;m++)c[m]=c[m-1]+e[m][t];let l=a[t],u=a.slice(-2),p=a.join(),d=`if (${l} < ${c[0]}) {
        return getChannel(
            getT0(${p}), vec2(${u.join()}));
        }`;for(let m=1;m<c.length;m++){let g=c[m-1];d+=`
        if (${l} < ${c[m]}  && ${l} >= ${c[m-1]}) {
          return getChannel(
            getT${m}(${ER(a,l,g)}),
            vec2(${ER(u,l,g)}));
        }`}let h=c.length,f=c[c.length-1];d+=`
        return getChannel(
          getT${h}(${ER(a,l,f)}),
          vec2(${ER(u,l,f)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${d}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${n[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${n[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${n[o-2]} &&
            ${i[o-1]} < ${n[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}};function ER(r,e,t){let n=r.indexOf(e);return r.map((s,i)=>i===n?`${s} - ${t}`:s).join()}function Fy(r){let{inputs:e,backend:t}=r,{input:n}=e,o=t.texData.get(n.dataId);return $n({inputs:{x:o.complexTensorInfos.imag},backend:t})}var Gue={kernelName:df,backendName:"webgl",kernelFunc:Fy};function lw(r,e,t){let n=r[0].dtype;if(n==="complex64"){let h=r.map(x=>Yd({inputs:{input:x},backend:t})),f=r.map(x=>Fy({inputs:{input:x},backend:t})),m=lw(h,e,t),g=lw(f,e,t),y=oi({inputs:{real:m,imag:g},backend:t});return h.forEach(x=>t.disposeIntermediateTensorInfo(x)),f.forEach(x=>t.disposeIntermediateTensorInfo(x)),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}let o=t.shouldExecuteOnCPU(r);if(n==="string"&&(o=!0),o){let h=r.map(w=>{let I=[-1,C.sizeFromShape(w.shape.slice(e))];return ke({inputs:{x:w},backend:t,attrs:{shape:I}})}),f=h.map(w=>({vals:t.readSync(w.dataId),shape:w.shape})),m=E.computeOutShape(h.map(w=>w.shape),1),g=h[0].shape[0]===1,y=jce(f,m,n,g),x=E.computeOutShape(r.map(w=>w.shape),e),b=t.makeTensorInfo(x,n,y);return h.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}let s=r.filter(h=>C.sizeFromShape(h.shape)>0),i=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let h=i?new jo(r[0].shape,Rp):new ri(r[0].shape,Rp);return t.runWebGLProgram(h,r,n)}let a=Z().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){let h=[];for(let m=0;m<s.length;m+=a){let g=s.slice(m,m+a);h.push(lw(g,e,t))}let f=lw(h,e,t);for(let m of h)t.disposeIntermediateTensorInfo(m);return f}if(i){let h=new NR(s.map(f=>f.shape),e);return t.runWebGLProgram(h,s,n)}let{tensors2D:c,outShape:l}=gqe(s,e,t),u=new kR(c.map(h=>h.shape)),p=t.runWebGLProgram(u,c,n);c.forEach(h=>t.disposeIntermediateTensorInfo(h));let d=ke({inputs:{x:p},attrs:{shape:l},backend:t});return t.disposeIntermediateTensorInfo(p),d}function gqe(r,e,t){let n=E.computeOutShape(r.map(s=>s.shape),e);return{tensors2D:r.map(s=>ke({inputs:{x:s},attrs:{shape:[-1,C.sizeFromShape(s.shape.slice(e))]},backend:t})),outShape:n}}function qz(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n,s=C.parseAxisParam(o,e[0].shape)[0],i=e.map(l=>l.shape);E.assertParamsConsistent(i,s);let a=E.computeOutShape(e.map(l=>l.shape),s);if(C.sizeFromShape(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);let c=e.filter(l=>C.sizeFromShape(l.shape)>0);return c.length===1?$n({inputs:{x:c[0]},backend:t}):lw(c,s,t)}var Wue={kernelName:Tu,backendName:"webgl",kernelFunc:qz};var uw=class{constructor(e,t=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let i=e.padInfo.top,a=e.padInfo.left,c=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,p=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",y=g?1:2,x=g?2:3,b=g?3:1,w="",_="";n&&(o?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:w=`
          float activation(float x) {
            ${n}
          }
        `,_="result = activation(result);");let I=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${d}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${f}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${f}) *
                    getW(wR, wC, ${f}, d2);
              } else {
                dotProd +=
                    getX(batch, ${f}, xR, xC) *
                    getW(wR, wC, ${f}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${f}, d2),
                getW(wR, wC, ${f} + 1, d2),
                getW(wR, wC, ${f} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${f}),
                  getX(batch, xR, xC, ${f} + 1),
                  getX(batch, xR, xC, ${f} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${f}, xR, xC),
                  getX(batch, ${f} + 1, xR, xC),
                  getX(batch, ${f} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${_}
        setOutput(result);
      }
    `}},DR=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,o=e.padInfo.left,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,u=e.dilationWidth,p=e.filterDepth,d=e.filterHeight,h=e.filterWidth,f=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${n}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${d}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${f}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${f}) *
                  getW(wF, wR, wC, ${f}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${f}),
                  getX(batch, xF, xR, xC, ${f} + 1),
                  getX(batch, xF, xR, xC, ${f} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${f}, d2),
                  getW(wF, wR, wC, ${f} + 1, d2),
                  getW(wF, wR, wC, ${f} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var pw=class{constructor(e,t=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Er(this.outputShape.length);let i=e.padInfo.left,a=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,u=e.filterWidth,p=u,d=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)d+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;d+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)d+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;d+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(p+1)/2;g++){let y=g*2;if(d+=`
           xC = xCCorner + ${y*c};
           `,a===1){if(y<u&&(i%2===1?(d+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,c===1&&y>0?d+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:d+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):d+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){let x=i%2===0?C.nearestLargerEven(c):c;c%2===0&&i%2===1||c%2!==0&&i%2!==1?(d+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,c>1?d+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:d+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):x===1?d+=`
                     xC${y+1} = xTexelC${y};
                     `:d+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(i%2===1?(d+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(d+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(d+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(d+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(d+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(d+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}d+=`
     }
   `,d+=`
     }
   `,d+=`
     }
   `;let h="",f="";n&&(o?h=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:s?h=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:h=`vec4 activation(vec4 x) {
           ${n}
         }`,f="result = activation(result);");let m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${h}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${d}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${f}
         setOutput(result);
       }
     `}};var AR=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Er(this.outputShape.length);let{dataFormat:n}=t,o=bn(),s=n==="channelsLast",i=s?1:2,a=s?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,l="";for(let u=0;u<=1;u++)for(let p=0;p<=1;p++)l+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${u};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${o.output} = result;
      }
    `}};function RR(r,e){let t=r.length;return t>=3?e?[...r.slice(0,-3),r[t-3]*r[t-2],r[t-1]]:[...r.slice(0,-3),r[t-3],r[t-2]*r[t-1]]:!e&&t===1&&r[0]>1?[r[0],1]:null}function OR({x:r,filter:e,convInfo:t,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let c=r.shape,l=n.texData.get(r.dataId),u=t.inChannels,p=c[0]*c[1]*c[2],d=t.outChannels,h=t.dataFormat==="channelsLast",f=!1,m=!1,g,y=[];if(s!=null){let w=RR(s.shape,h);w!=null&&(s=ke({inputs:{x:s},backend:n,attrs:{shape:w}}),y.push(s))}if(o!=null){let w=RR(o.shape,h);w!=null&&(o=ke({inputs:{x:o},backend:n,attrs:{shape:w}}),y.push(o))}if(!((p===1||d===1)&&u>Gz)&&l.isPacked&&h&&l.texture!=null&&c[2]%2!==0&&C.arraysEqual(l.shape.slice(-3),c.slice(-3))){let w=c[0]*c[1]*(c[2]+1),_={dataId:r.dataId,shape:[1,w,t.inChannels],dtype:r.dtype},I=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,C.assert(Ny(l.shape,_.shape),()=>`packed reshape ${l.shape} to ${_.shape} isn't free`);let S=ke({inputs:{x:e},backend:n,attrs:{shape:[1,t.inChannels,t.outChannels]}});y.push(S);let k=My({a:_,b:S,backend:n,transposeA:f,transposeB:m,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),R=n.texData.get(k.dataId);C.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=I,R.shape=t.outShape,g=$n({inputs:{x:k},backend:n}),g.shape=t.outShape,y.push(k)}else{let w=t.outHeight*t.outWidth,_=ke({inputs:{x:r},backend:n,attrs:{shape:h?[t.batchSize,w,t.inChannels]:[t.batchSize,t.inChannels,w]}}),I=ke({inputs:{x:e},backend:n,attrs:{shape:[1,t.inChannels,t.outChannels]}}),S=My({a:h?_:I,b:h?I:_,transposeA:!h,transposeB:m,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});g=ke({inputs:{x:S},backend:n,attrs:{shape:t.outShape}}),y.push(_),y.push(I),y.push(S)}for(let w of y)n.disposeIntermediateTensorInfo(w);return g}function MR({x:r,filter:e,convInfo:t,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:c,filterHeight:l,inChannels:u,outWidth:p,outHeight:d,dataFormat:h}=t,f=h==="channelsLast",m=c*l*u,g=d*p,y=[t.batchSize,m,g],x=!0,b=!1,w=[];if(s!=null){let te=RR(s.shape,f);te!=null&&(s=ke({inputs:{x:s},backend:n,attrs:{shape:te}}),w.push(s))}if(o!=null){let te=RR(o.shape,f);te!=null&&(o=ke({inputs:{x:o},backend:n,attrs:{shape:te}}),w.push(o))}let _=ke({inputs:{x:e},backend:n,attrs:{shape:[1,m,C.sizeFromShape(e.shape)/m]}});w.push(_);let I=new AR(y,t),S=[r.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],k=n.runWebGLProgram(I,[r],"float32",S),R=ke({inputs:{x:k},backend:n,attrs:{shape:y}});w.push(k),w.push(R);let L=o!=null,B=s!=null,z=a==="leakyrelu",q=a?Xd(a,!0):null,U=new cw(f?R.shape:_.shape,f?_.shape:R.shape,f?[t.batchSize,g,t.outChannels]:[t.batchSize,t.outChannels,g],x,b,L,q,B,z),G=f?[R,_]:[_,R];if(o&&G.push(o),B&&G.push(s),z){let te=n.makeTensorInfo([],"float32",C.createScalarValue(i,"float32"));G.push(te),w.push(te)}let j=n.runWebGLProgram(U,G,"float32"),X=ke({inputs:{x:j},backend:n,attrs:{shape:t.outShape}});w.push(j);for(let te of w)n.disposeIntermediateTensorInfo(te);return X}function yqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:c,dilations:l,dimRoundingMode:u}=n,p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,s.shape,i,l,a,u,!1,p),h;if(d.filterHeight===1&&d.filterWidth===1&&d.dilationHeight===1&&d.dilationWidth===1&&d.strideHeight===1&&d.strideWidth===1&&(d.padInfo.type==="SAME"||d.padInfo.type==="VALID"))h=OR({x:o,filter:s,convInfo:d,backend:t});else if(d.strideWidth<=2&&p==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){let m=new pw(d),g=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];h=t.runWebGLProgram(m,[o,s],"float32",g)}else if(Z().getBool("WEBGL_CONV_IM2COL"))h=MR({x:o,filter:s,convInfo:d,backend:t});else{let m=new uw(d);h=t.runWebGLProgram(m,[o,s],"float32")}let f=ke({inputs:{x:h},backend:t,attrs:{shape:d.outShape}});return t.disposeIntermediateTensorInfo(h),f}var jue={kernelName:ku,backendName:"webgl",kernelFunc:yqe};var FR=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},PR=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,c=n-1-e.padInfo.left,l=i?1:2,u=i?2:3,p=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},$R=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},LR=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,c=t-1-e.padInfo.front,l=n-1-e.padInfo.top,u=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${l}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function xqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:c,dimRoundingMode:l,filterShape:u}=n,p=E.convertConv2DDataFormat(c),d=E.computeConv2DInfo(o.shape,u,i,1,a,l,!1,p),h=new FR(d);return t.runWebGLProgram(h,[o,s],"float32")}var Hue={kernelName:Kh,backendName:"webgl",kernelFunc:xqe};var VR=class{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Er(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function vqe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:c,dataFormat:l,dimRoundingMode:u}=n,p=E.convertConv2DDataFormat(l),d=E.computeConv2DInfo(i,s.shape,a,1,c,u,!1,p);if(Z().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){let h=[[d.strideHeight,d.strideWidth]],f=new VR(d);return t.runWebGLProgram(f,[o,s],"float32",h)}else{let h=new PR(d);return t.runWebGLProgram(h,[o,s],"float32")}}var que={kernelName:Eu,backendName:"webgl",kernelFunc:vqe};function bqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c}=n,l=E.computeConv3DInfo(o.shape,s.shape,i,c,a),u=new DR(l);return t.runWebGLProgram(u,[o,s],"float32")}var Kue={kernelName:Nu,backendName:"webgl",kernelFunc:bqe};function wqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:c}=n,l=E.computeConv3DInfo(o.shape,c,i,1,a),u=new $R(l);return t.runWebGLProgram(u,[o,s],"float32")}var Xue={kernelName:Xh,backendName:"webgl",kernelFunc:wqe};function Cqe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:c}=n,l=E.computeConv3DInfo(c,s.shape,a,1,i),u=new LR(l);return t.runWebGLProgram(u,[o,s],"float32")}var Yue={kernelName:Yh,backendName:"webgl",kernelFunc:Cqe};var _qe=ec+`
  return cos(x);
`,Sqe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Ui}
  return result;
`,Iqe=et({opSnippet:_qe,packedOpSnippet:Sqe}),Zue={kernelName:Mc,backendName:"webgl",kernelFunc:Iqe};var Tqe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,kqe=et({opSnippet:Tqe}),Que={kernelName:Fc,backendName:"webgl",kernelFunc:kqe};var BR=class{constructor(e,t,n,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,a,c,l]=e,[u]=t,[p,d]=n;this.outputShape=[u,p,d,l];let h=o==="bilinear"?1:0,[f,m]=[`${a-1}.0`,`${c-1}.0`],[g,y,x]=p>1?[`${(a-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${f} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${f}`],[b,w,_]=d>1?[`${(c-1)/(d-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${f} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${_};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${h} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var Eqe=r=>{let{inputs:e,backend:t,attrs:n}=r,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:c,extrapolationValue:l}=n,u=new BR(o.shape,s.shape,a,c,l);return t.runWebGLProgram(u,[o,s,i],"float32")},Jue={kernelName:Qh,backendName:"webgl",kernelFunc:Eqe};var dw=function(r){return r.Prod="*",r.Sum="+",r}(dw||{}),fS=class{constructor(e,t,n,o){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let s=this.outputShape.length,i=this.op===dw.Prod?"1.0":"0.0",a=n?i:`getX(${epe(s,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1],l="",u="";n?(l=o?`end != ${c-1}`:"end != 0",u=o?"end + 1":"end - 1"):(l=o?`end + pow2 < ${c}`:"end >= pow2",u=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${bt(s)} coords = getOutputCoords();
        int end = ${tpe(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${u};
          ${tpe(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${epe(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function epe(r,e,t){if(r===1)return`${e}`;if(r===2)return`${e}.x, ${e}.y`;if(r===3)return`${e}.x, ${e}.y, ${e}.z`;if(r===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${r} is not yet supported`)}function tpe(r,e,t){if(r===1)return`${e}`;if(r===2)return`${e}.y`;if(r===3)return`${e}.z`;if(r===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${r} is not yet supported`)}function zR(r,e,t,n,o,s){let i=e.shape.length,a=E.getAxesPermutation([n],i),c=e;a!=null&&(c=an({inputs:{x:e},backend:t,attrs:{perm:a}}));let l=E.getInnerMostAxes(1,i)[0];if(l!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${n}`);let u=c.shape[l],p=$n({inputs:{x:c},backend:t});for(let d=0;d<=Math.ceil(Math.log2(u))-1;d++){let h=new fS(r,c.shape,!1,s),f=[[d]],m=p;p=t.runWebGLProgram(h,[p],p.dtype,f),t.disposeIntermediateTensorInfo(m)}if(o){let d=new fS(r,c.shape,o,s),h=p;p=t.runWebGLProgram(d,[p],p.dtype),t.disposeIntermediateTensorInfo(h)}if(a!=null){let d=E.getUndoAxesPermutation(a),h=an({inputs:{x:p},backend:t,attrs:{perm:d}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(c),h}return p}function Nqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return zR(dw.Prod,o,t,s,i,a)}var rpe={kernelName:Zh,backendName:"webgl",kernelFunc:Nqe};function Dqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return zR(dw.Sum,o,t,s,i,a)}var npe={kernelName:Du,backendName:"webgl",kernelFunc:Dqe};function Aqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let c=t.readSync(o.dataId),l=t.readSync(s.dataId),u=rR(c,l,s.dtype,s.shape,i);return t.makeTensorInfo([i],s.dtype,u)}else if(o.shape.length===2){let c=t.bufferSync(o),l=t.bufferSync(s),u=zce(c,l,i,a);return t.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var ope={kernelName:Jh,backendName:"webgl",kernelFunc:Aqe};var UR=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Rqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockSize:s,dataFormat:i}=n,a=o.shape[0],c=i==="NHWC"?o.shape[1]:o.shape[2],l=i==="NHWC"?o.shape[2]:o.shape[3],u=i==="NHWC"?o.shape[3]:o.shape[1],p=c*s,d=l*s,h=u/(s*s),f=i==="NHWC"?[a,p,d,h]:[a,h,p,d],m=new UR(f,s,i);return t.runWebGLProgram(m,[o],o.dtype)}var spe={kernelName:ef,backendName:"webgl",kernelFunc:Rqe};var hw=class{constructor(e,t=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Er(this.outputShape.length);let i=e.filterHeight,a=e.filterWidth,c=e.outChannels/e.inChannels,l="",u="";n&&(o?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:l=`
          float activation(float x) {
            ${n}
          }
        `,u="result = activation(result);");let p=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${u}
        setOutput(result);
      }
    `}};var fw=class{constructor(e,t=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Er(this.outputShape.length);let i=e.outChannels/e.inChannels,a=e.padInfo.left,c=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,p=e.filterWidth,d=p,h=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<p;y++)h+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;h+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<p;y++)h+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;h+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(d+1)/2;y++){let x=y*2;if(h+=`
          xC = xCCorner + ${x*l};
          `,c===1){if(x<p&&(a%2===1?(h+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,l===1&&x>0?h+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:h+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):h+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<p)){let b=a%2===0?C.nearestLargerEven(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(h+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,l>1?h+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:h+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):b===1?h+=`
                    xC${x+1} = xTexelC${x};
                    `:h+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<p&&(a%2===1?(h+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<p&&(h+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(h+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<p&&(h+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<p&&(h+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<p&&(h+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}h+=`
    }
  `,h+=`
      }
    `;let f="",m="";n&&(o?f=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?f=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:f=`vec4 activation(vec4 x) {
          ${n}
        }`,m="result = activation(result);");let g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${h}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}};function Oqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c,dimRoundingMode:l}=n,u=c;u==null&&(u=[1,1]),C.assert(E.eitherStridesOrDilationsAreOne(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let p=E.computeConv2DInfo(o.shape,s.shape,i,u,a,l,!0),d;Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?d=new fw(p):d=new hw(p);let h=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return t.runWebGLProgram(d,[o,s],"float32",h)}var ipe={kernelName:Au,backendName:"webgl",kernelFunc:Oqe};var GR=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},WR=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=t-1-e.padInfo.top,a=n-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Mqe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,dy:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,filterShape:u}=n,p=E.computeConv2DInfo(o.shape,u,i,a,c,l,!0),d=new GR(p);return t.runWebGLProgram(d,[o,s],"float32")}var ape={kernelName:tf,backendName:"webgl",kernelFunc:Mqe};function Fqe(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:c,dimRoundingMode:l,inputShape:u}=n,p=E.computeConv2DInfo(u,s.shape,i,a,c,l,!0),d=new WR(p);return t.runWebGLProgram(d,[o,s],"float32")}var cpe={kernelName:rf,backendName:"webgl",kernelFunc:Fqe};var jR=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function Pqe(r){let{inputs:e,backend:t}=r,{x:n}=e,o=[...n.shape,...n.shape],s=C.sizeFromShape(n.shape),i=ke({inputs:{x:n},backend:t,attrs:{shape:[s]}}),a=new jR(s),c=t.runWebGLProgram(a,[i],i.dtype),l=ke({inputs:{x:c},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(c),l}var lpe={kernelName:nf,backendName:"webgl",kernelFunc:Pqe};var HR=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:c,dilationHeight:l,dilationWidth:u}=e,{top:p,left:d}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${p}, ${d});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function $qe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s}=e,{strides:i,pad:a,dilations:c}=n,l=E.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",c),u,p=new HR(l);u=t.runWebGLProgram(p,[o,s],"float32");let d=ke({inputs:{x:u},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(u),d}var upe={kernelName:Ru,backendName:"webgl",kernelFunc:$qe};function Lqe(r){let{inputs:e,backend:t,attrs:n}=r,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:c}=E.decodeEinsumEquation(o,s.length);E.checkEinsumDimSizes(i.length,c,s);let{path:l,steps:u}=E.getEinsumComputePath(a,c),p=u.length,d=null,h=i.length,f=[];for(let m=0;m<p;++m){for(let g of u[m]){let{permutationIndices:y,expandDims:x}=E.getEinsumPermutation(h,c[g]),b;E.isIdentityPermutation(y)?b=s[g]:(b=an({inputs:{x:s[g]},backend:t,attrs:{perm:y}}),f.push(b));let w=b.shape.slice();for(let _=0;_<x.length;++_)w.splice(x[_],0,1);C.arraysEqual(b.shape,w)||(b=ke({inputs:{x:b},backend:t,attrs:{shape:w}}),f.push(b)),d===null?d=b:(d=dS({inputs:{a:b,b:d},backend:t}),f.push(d))}m<p-1&&(l[m]>=0&&(d=Oy({inputs:{x:d},backend:t,attrs:{axis:l[m]-(i.length-h),keepDims:!1}}),f.push(d)),h--)}for(let m of f)m!==d&&t.disposeIntermediateTensorInfo(m);return d}var ppe={kernelName:of,backendName:"webgl",kernelFunc:Lqe};var Vqe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Bqe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zqe=et({opSnippet:Vqe,packedOpSnippet:Bqe}),dpe={kernelName:$c,backendName:"webgl",kernelFunc:zqe};var Uqe="return (b >= 0.0) ? a : a * (b + 1.0);",Gqe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Wqe=r=>{let{inputs:e,backend:t}=r,{dy:n,y:o}=e,s=Z().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new zi(Gqe,n.shape,o.shape):new ni(Uqe,n.shape,o.shape);return t.runWebGLProgram(s,[n,o],n.dtype)},hpe={kernelName:sf,backendName:"webgl",kernelFunc:Wqe};var jqe=`
  return vec4(equal(a, b));
`,Hqe="return float(a == b);",qqe=br({opSnippet:Hqe,packedOpSnippet:jqe,dtype:"bool",cpuKernelImpl:Hce}),fpe={kernelName:fd,backendName:"webgl",kernelFunc:qqe};var Kqe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${E.ERF_P};
  float a1 = ${E.ERF_A1};
  float a2 = ${E.ERF_A2};
  float a3 = ${E.ERF_A3};
  float a4 = ${E.ERF_A4};
  float a5 = ${E.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Xqe=et({opSnippet:Kqe}),mpe={kernelName:Lc,backendName:"webgl",kernelFunc:Xqe};var Yqe=ec+`
  return exp(x);
`,Zqe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Kz=et({opSnippet:Yqe,packedOpSnippet:Zqe,cpuKernelImpl:qce,dtype:"float32"}),gpe={kernelName:Vc,backendName:"webgl",kernelFunc:Kz};function qR(r){let{inputs:e,attrs:t,backend:n}=r,{dim:o}=t,{input:s}=e,i=s.shape.length,a=s.shape.slice(),c=o;return o<0&&(C.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),c=i+o+1),a.splice(c,0,1),ke({inputs:{x:s},backend:n,attrs:{shape:a}})}var ype={kernelName:Ou,backendName:"webgl",kernelFunc:qR};var xpe="return exp(x) - 1.0;",Qqe=et({opSnippet:xpe,packedOpSnippet:xpe,cpuKernelImpl:Kce}),vpe={kernelName:Bc,backendName:"webgl",kernelFunc:Qqe};var mS=class{constructor(e,t,n){this.variableNames=["real","imag"];let o=t[1];this.outputShape=t;let s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=n?`${o}.0`:"1.0",a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function KR(r,e,t){let n=t.texData.get(r.dataId),o=C.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=o/s,a=ke({inputs:{x:r},backend:t,attrs:{shape:[i,s]}}),c=a.shape,l=new mS("real",c,e),u=new mS("imag",c,e),p=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:c},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:c}],d=t.runWebGLProgram(l,p,"float32"),h=t.runWebGLProgram(u,p,"float32"),f=oi({inputs:{real:d,imag:h},backend:t});t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h);let m=ke({inputs:{x:f},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(f),m}function Jqe(r){let{inputs:e,backend:t}=r,{input:n}=e;return KR(n,!1,t)}var bpe={kernelName:af,backendName:"webgl",kernelFunc:Jqe};var XR=class{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function Zd(r){let{backend:e,attrs:t}=r,{shape:n,value:o}=t,{dtype:s}=t;if(s=s||C.inferDtype(o),s==="string"){let i=C.getArrayFromDType(s,C.sizeFromShape(n));return i.fill(o),e.makeTensorInfo(n,s,i)}else{let i=new XR(n,o),a=[[o]];return e.runWebGLProgram(i,[],s,a)}}var wpe={kernelName:cf,backendName:"webgl",kernelFunc:Zd};var YR=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var Cpe={kernelName:lf,backendName:"webgl",kernelFunc:({inputs:r,backend:e})=>{let{image:t}=r,n=e,o=new YR(t.shape);return n.runWebGLProgram(o,[t],t.dtype)}};var _pe="return floor(x);",e6e=et({opSnippet:_pe,packedOpSnippet:_pe,cpuKernelImpl:Xce}),Spe={kernelName:zc,backendName:"webgl",kernelFunc:e6e};var t6e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,r6e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,n6e=br({opSnippet:t6e,packedOpSnippet:r6e,dtype:"int32"}),Ipe={kernelName:Uc,backendName:"webgl",kernelFunc:n6e};var ZR=class{constructor(e){this.variableNames=["A"];let t=bn(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${n}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var QR=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=bn(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${n}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}};var Tpe={kernelName:$g,backendName:"webgl",kernelFunc:o6e},mw,Xz=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function o6e(r){let{inputs:e,backend:t,attrs:n}=r,{pixels:o}=e,{numChannels:s}=n,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[c,l]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[l,c],p=[l,c,s];if(a||i){let m=Z().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(mw==null||m!==Xz)&&(Xz=m,mw=document.createElement("canvas").getContext("2d",{willReadFrequently:Xz})),mw.canvas.width=c,mw.canvas.height=l,mw.drawImage(o,0,0,c,l),o=mw.canvas}let d=t.makeTensorInfo(u,"int32");t.texData.get(d.dataId).usage=ms.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),o);let h=Z().getBool("WEBGL_PACK")?new QR(p):new ZR(p),f=t.runWebGLProgram(h,[d],"int32");return t.disposeData(d.dataId),f}function s6e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dataFormat:u,dilations:p,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=n,m=E.convertConv2DDataFormat(u),g=E.computeConv2DInfo(o.shape,s.shape,c,p,l,d,!1,m),y,x=[],b=i!=null,w=a!=null,_=h==="leakyrelu",I=()=>{let k=[o,s],R=(L,B)=>{if(B==="NCHW"&&L.shape.length===1&&L.shape[0]!==1){let z=ke({inputs:{x:L},backend:t,attrs:{shape:[L.shape[0],1,1]}});return x.push(z),z}return L};if(b&&k.push(R(i,u)),w&&k.push(R(a,u)),_){let L=t.makeTensorInfo([],"float32",C.createScalarValue(f,"float32"));k.push(L),x.push(L)}return k};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=OR({x:o,filter:s,convInfo:g,backend:t,bias:i,activation:h,preluActivationWeights:a,leakyreluAlpha:f});else if(g.strideWidth<=2&&m==="channelsLast"&&Z().getBool("WEBGL_EXP_CONV")){let k=h?Xd(h,!0):null,R=new pw(g,b,k,w,_),L=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],B=I();y=t.runWebGLProgram(R,B,"float32",L)}else if(Z().getBool("WEBGL_CONV_IM2COL"))y=MR({x:o,filter:s,convInfo:g,backend:t,bias:i,activation:h,preluActivationWeights:a,leakyreluAlpha:f});else{let k=h?Xd(h,!1):null,R=new uw(g,b,k,w,_),L=I();y=t.runWebGLProgram(R,L,"float32")}let S=ke({inputs:{x:y},backend:t,attrs:{shape:g.outShape}});return x.push(y),x.forEach(k=>t.disposeIntermediateTensorInfo(k)),S}var kpe={kernelName:_d,backendName:"webgl",kernelFunc:s6e};function i6e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:c,pad:l,dilations:u,dimRoundingMode:p,activation:d,leakyreluAlpha:h}=n,f=[],m=u;m==null&&(m=[1,1]),C.assert(E.eitherStridesOrDilationsAreOne(c,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${m}'`);let g=E.computeConv2DInfo(o.shape,s.shape,c,m,l,p,!0),y=Z().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=d?Xd(d,y):null,b=[o,s],w=i!=null,_=a!=null,I=d==="leakyrelu";if(w&&b.push(i),_&&b.push(a),I){let L=t.makeTensorInfo([],"float32",C.createScalarValue(h,"float32"));b.push(L),f.push(L)}let S;y?S=new fw(g,w,x,_,I):S=new hw(g,w,x,_,I);let k=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],R=t.runWebGLProgram(S,b,"float32",k);return f.forEach(L=>t.disposeIntermediateTensorInfo(L)),R}var Epe={kernelName:Sd,backendName:"webgl",kernelFunc:i6e};var JR=class{constructor(e,t,n,o){this.sliceDim=e,this.strides=t,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=n;let s=bt(n.length),i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function a6e(r){let{inputs:e,backend:t}=r,{params:n,indices:o}=e,s=o.shape,i=s[s.length-1],a=C.sizeFromShape(n.shape),[c,l,u,p]=E.prepareAndValidate(n,o),d=ke({inputs:{x:o},backend:t,attrs:{shape:[l,i]}}),h=ke({inputs:{x:n},backend:t,attrs:{shape:[C.sizeFromShape(n.shape)/u,u]}});if(t.shouldExecuteOnCPU([n,o])||n.dtype==="string"){let y=t.readSync(o.dataId),x=t.bufferSync(n),b=Yce(y,x,n.dtype,l,i,u,p,n.shape,a);return t.makeTensorInfo(c,n.dtype,b.values)}let f=new JR(i,p,[l,u],n.shape),m=t.runWebGLProgram(f,[h,d],h.dtype),g=ke({inputs:{x:m},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(m),g}var Npe={kernelName:uf,backendName:"webgl",kernelFunc:a6e};var e2=class{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=bt(this.rank),o=c6e(e,2);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function c6e(r,e){let t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let o=0;o<r.length;o++)o===2?n.push("index"):n.push(`${t[o]}`);return n.join()}function Yz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,indices:s}=e,{axis:i,batchDims:a}=n,c=C.parseAxisParam(i,o.shape)[0];if(Z().get("DEBUG")){let x=t.readSync(s.dataId),b=o.shape[c];for(let w=0;w<x.length;++w){let _=x[w];C.assert(_<=b-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${b-1}]`)}}let l=E.segment_util.collectGatherOpShapeInfo(o,s,c,a),u=C.sizeFromShape(s.shape),p=[],d=ke({inputs:{x:o},backend:t,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),h=ke({inputs:{x:s},backend:t,attrs:{shape:[l.batchSize,u/l.batchSize]}});p.push(d),p.push(h);let f=[l.batchSize,l.outerSize,u/l.batchSize,l.sliceSize];if(t.shouldExecuteOnCPU([o,s])||o.dtype==="string"){let x=t.bufferSync(h),b=t.bufferSync(d),w=Zce(b,x,f);return p.forEach(_=>t.disposeIntermediateTensorInfo(_)),t.makeTensorInfo(l.outputShape,w.dtype,w.values)}let m=new e2(d.shape,f),g=t.runWebGLProgram(m,[d,h],d.dtype);p.push(g);let y=ke({inputs:{x:g},backend:t,attrs:{shape:l.outputShape}});return p.forEach(x=>t.disposeIntermediateTensorInfo(x)),y}var Dpe={kernelName:Fu,backendName:"webgl",kernelFunc:Yz};var l6e="return float(a > b);",u6e=`
  return vec4(greaterThan(a, b));
`,p6e=br({opSnippet:l6e,packedOpSnippet:u6e,cpuKernelImpl:Qce,dtype:"bool"}),Ape={kernelName:md,backendName:"webgl",kernelFunc:p6e};var d6e="return float(a >= b);",h6e=`
  return vec4(greaterThanEqual(a, b));
`,f6e=br({opSnippet:d6e,packedOpSnippet:h6e,dtype:"bool",cpuKernelImpl:Jce}),Rpe={kernelName:Gc,backendName:"webgl",kernelFunc:f6e};function m6e(r){let{inputs:e,backend:t}=r,{input:n}=e;return KR(n,!0,t)}var Ope={kernelName:pf,backendName:"webgl",kernelFunc:m6e};var g6e="return float(!isnan(x) && !isinf(x));",y6e=et({opSnippet:g6e,dtype:"bool"}),Mpe={kernelName:Wc,backendName:"webgl",kernelFunc:y6e};var x6e="return float(isinf(x));",v6e=et({opSnippet:x6e,dtype:"bool"}),Fpe={kernelName:jc,backendName:"webgl",kernelFunc:v6e};var b6e="return float(isnan(x));",w6e=et({opSnippet:b6e,dtype:"bool"}),Ppe={kernelName:Hc,backendName:"webgl",kernelFunc:w6e};var C6e="return float(a < b);",_6e=`
  return vec4(lessThan(a, b));
`,S6e=br({opSnippet:C6e,packedOpSnippet:_6e,cpuKernelImpl:ele,dtype:"bool"}),$pe={kernelName:gd,backendName:"webgl",kernelFunc:S6e};var I6e="return float(a <= b);",T6e=`
  return vec4(lessThanEqual(a, b));
`,k6e=br({opSnippet:I6e,packedOpSnippet:T6e,cpuKernelImpl:tle,dtype:"bool"}),Lpe={kernelName:yd,backendName:"webgl",kernelFunc:k6e};function E6e(r){let{backend:e,attrs:t}=r,{start:n,stop:o,num:s}=t,i=rle(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var Vpe={kernelName:hf,backendName:"webgl",kernelFunc:E6e};var N6e=ec+`
  return x < 0.0 ? 0./0. : log(x);
`,D6e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,A6e=et({opSnippet:N6e,packedOpSnippet:D6e,cpuKernelImpl:nle}),Bpe={kernelName:qc,backendName:"webgl",kernelFunc:A6e};var R6e=ec+`
  return log(1.0 + x);
`,O6e=et({opSnippet:R6e}),zpe={kernelName:Kc,backendName:"webgl",kernelFunc:O6e};var M6e="return float(a >= 1.0 && b >= 1.0);",F6e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,P6e=br({opSnippet:M6e,packedOpSnippet:F6e,dtype:"bool"}),Upe={kernelName:xd,backendName:"webgl",kernelFunc:P6e};var $6e="return float(!(x >= 1.0));",L6e=et({opSnippet:$6e}),Gpe={kernelName:vd,backendName:"webgl",kernelFunc:L6e};var V6e="return float(a >= 1.0 || b >= 1.0);",B6e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,z6e=br({opSnippet:V6e,packedOpSnippet:B6e,dtype:"bool"}),Wpe={kernelName:bd,backendName:"webgl",kernelFunc:z6e};var t2=class{constructor(e,t,n,o,s){this.variableNames=["x"],this.outputShape=[];let i=t,a=e[3]-1;this.outputShape=e;let c,l=`float(${n}) + float(${o}) * sum`;s===.5?c=`inversesqrt(${l})`:s===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}};var r2=class{constructor(e,t,n,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=t,a=e[3]-1;this.outputShape=e;let c,l=`float(${n}) + float(${o}) * sum`;s===.5?c=`inversesqrt(${l})`:s===1?c=`1.0/(${l})`:c=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}};var U6e=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:c}=n,l=Z().getBool("WEBGL_PACK_NORMALIZATION")?new r2(o.shape,s,i,a,c):new t2(o.shape,s,i,a,c);return t.runWebGLProgram(l,[o],o.dtype)},jpe={kernelName:$u,backendName:"webgl",kernelFunc:U6e};var n2=class{constructor(e,t,n,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var G6e=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:c,alpha:l,beta:u}=n,p=new n2(o.shape,a,c,l,u);return t.runWebGLProgram(p,[o,s,i],o.dtype)},Hpe={kernelName:ff,backendName:"webgl",kernelFunc:G6e};function qpe(r,e,t,n){let o=C.sizeFromShape(e),i=C.sizeFromShape(r.shape)/o,a=ke({inputs:{x:r},attrs:{shape:[i,o]},backend:n}),c=Gi(a,r.dtype,"max",n),l=ke({inputs:{x:c},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),l}function Zz(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=o.shape.length,c=C.parseAxisParam(s,o.shape),l=c,u=E.getAxesPermutation(l,a),p=u!=null,d=t.shouldExecuteOnCPU([o]),h=o;if(p){if(d){let b=t.texData.get(h.dataId).values,w=new Array(a);for(let S=0;S<w.length;S++)w[S]=o.shape[u[S]];let _=Ry(b,o.shape,o.dtype,u,w);h=t.makeTensorInfo(w,o.dtype);let I=t.texData.get(h.dataId);I.values=_}else h=wm(o,u,t);l=E.getInnerMostAxes(l.length,a)}E.assertAxesAreInnerMostDims("max",l,a);let[f,m]=E.computeOutAndReduceShapes(h.shape,l),g=f;i&&(g=E.expandShapeToKeepDim(f,c));let y;if(d){let b=t.texData.get(h.dataId).values,w=ole(b,C.sizeFromShape(m),g,o.dtype);y=t.makeTensorInfo(g,o.dtype);let _=t.texData.get(y.dataId);_.values=w}else y=qpe(h,m,g,t);return p&&t.disposeIntermediateTensorInfo(h),y}var Kpe={kernelName:Lu,backendName:"webgl",kernelFunc:Zz};var W6e=aw+`
  return max(a, b);
`,j6e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ui+`
  return result;
`,H6e=br({opSnippet:W6e,packedOpSnippet:j6e,cpuKernelImpl:sle}),Xpe={kernelName:Xc,backendName:"webgl",kernelFunc:H6e};function q6e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e;Ap(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:c}=n,l=1;C.assert(E.eitherStridesOrDilationsAreOne(i,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${l}'`);let u=E.computePool2DInfo(o.shape,s,i,l,a,c);if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))return $n({inputs:{x:o},backend:t});let p=new Pl(u,"max",!1);return t.runWebGLProgram(p,[o],o.dtype)}var Ype={kernelName:Vu,backendName:"webgl",kernelFunc:q6e};function K6e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:c,dimRoundingMode:l}=n,u=[1,1,1],p=E.computePool3DInfo(o.shape,s,i,u,a,l,c),d=new Cm(p,"max",!1);return t.runWebGLProgram(d,[o],o.dtype)}var Zpe={kernelName:Bu,backendName:"webgl",kernelFunc:K6e};var o2=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,o=e.dilationHeight,s=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=s-1-e.padInfo.top,c=i-1-e.padInfo.left,l=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},s2=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,p=c-1-e.padInfo.front,d=l-1-e.padInfo.top,h=u-1-e.padInfo.left,f=c*l*u-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${d}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${f} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function X6e(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s}=e,i=s,{filterSize:a,strides:c,pad:l,dimRoundingMode:u}=n,p=[1,1,1],d=E.computePool3DInfo(i.shape,a,c,p,l,u),h=new Cm(d,"max",!0),f=t.runWebGLProgram(h,[i],i.dtype),m=new s2(d),g=t.runWebGLProgram(m,[o,f],i.dtype);return t.disposeIntermediateTensorInfo(f),g}var Qpe={kernelName:gf,backendName:"webgl",kernelFunc:X6e};function Y6e(r){let{inputs:e,backend:t,attrs:n}=r,{dy:o,input:s,output:i}=e,a=s;Ap([s,i],"maxPoolGrad");let{filterSize:c,strides:l,pad:u,dimRoundingMode:p}=n,d=E.computePool2DInfo(a.shape,c,l,1,u,p),h=!0,f=new Pl(d,"max",h),m=t.runWebGLProgram(f,[a],a.dtype),g=new o2(d),y=t.runWebGLProgram(g,[o,m],a.dtype);return t.disposeIntermediateTensorInfo(m),y}var Jpe={kernelName:mf,backendName:"webgl",kernelFunc:Y6e};function ede(r,e,t,n){let o=new Pl(t,"max",!1),s=n.runWebGLProgram(o,[r],"float32");o=new Pl(t,"max",!0,!0,e);let i=n.runWebGLProgram(o,[r],"float32");return[s,i]}var tde={kernelName:yf,backendName:"webgl",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{x:n}=r,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,c=t;C.assert(n.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${n.shape.length}.`);let l=[1,1];C.assert(E.eitherStridesOrDilationsAreOne(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);let u=E.computePool2DInfo(n.shape,o,s,l,i),[p,d]=ede(n,a,u,c);return[p,d]}};function rde(r,e,t,n){let o=C.sizeFromShape(e),i=C.sizeFromShape(r.shape)/o,a=ke({inputs:{x:r},attrs:{shape:[i,o]},backend:n}),c=Gi(a,"float32","mean",n),l=ke({inputs:{x:c},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),l}var nde={kernelName:zu,backendName:"webgl",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{x:n}=r,{keepDims:o,axis:s}=e,i=t,a=n.shape.length,c=C.parseAxisParam(s,n.shape),l=c,u=E.getAxesPermutation(l,a),p=u!=null,d=i.shouldExecuteOnCPU([n]),h=[],f=n;if(p){if(d){let w=i.texData.get(f.dataId).values,_=new Array(a);for(let k=0;k<_.length;k++)_[k]=n.shape[u[k]];let I=Ry(w,n.shape,n.dtype,u,_);f=i.makeTensorInfo(_,n.dtype);let S=i.texData.get(f.dataId);S.values=I}else f=wm(n,u,i);h.push(f),l=E.getInnerMostAxes(l.length,a)}E.assertAxesAreInnerMostDims("sum",l,a);let[m,g]=E.computeOutAndReduceShapes(f.shape,l),y=m;o&&(y=E.expandShapeToKeepDim(m,c));let x=rde(f,g,y,i);for(let b of h)i.disposeIntermediateTensorInfo(b);return x}};function Z6e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,c=C.parseAxisParam(s,o.shape),l=c,u=E.getAxesPermutation(l,a),p=o;u!=null&&(p=an({inputs:{x:o},backend:t,attrs:{perm:u}}),l=E.getInnerMostAxes(l.length,o.shape.length)),E.assertAxesAreInnerMostDims("min",l,a);let[d,h]=E.computeOutAndReduceShapes(p.shape,l),f=C.sizeFromShape(h),m=ke({inputs:{x:p},backend:t,attrs:{shape:[-1,f]}}),g=Gi(m,m.dtype,"min",t),y;if(i){let x=E.expandShapeToKeepDim(d,c);y=ke({inputs:{x:g},backend:t,attrs:{shape:x}})}else y=ke({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),u!=null&&t.disposeIntermediateTensorInfo(p),y}var ode={kernelName:Uu,backendName:"webgl",kernelFunc:Z6e};var Q6e=aw+`
  return min(a, b);
`,J6e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Ui+`
  return result;
`,e5e=br({opSnippet:Q6e,packedOpSnippet:J6e,cpuKernelImpl:ile}),sde={kernelName:Yc,backendName:"webgl",kernelFunc:e5e};var i2=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((u,p)=>u[0]+e[p]+u[1]);let o=e.length,s=bt(o),i=t.map(u=>u[0]).join(","),a=t.map((u,p)=>u[0]+e[p]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),l=n==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}};var a2=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((f,m)=>f[0]+e[m]+f[1]);let o=e.length,s=bt(o),i=t.map(f=>f[0]).join(","),a=t.map((f,m)=>f[0]+e[m]).join(","),c=Pn("rc",o),l=Pn("source",o),u=`${c[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${l.slice(-2).join()})`,d=n==="reflect"?0:1,h="";if(o===1){let f=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${d};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${d};
        }
        source -= start;
      `;h=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${l.join()}), ${p});
        ${c[o-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${l.join()}), ${p});
        }
      `}else{let f=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${d}) +
                gte * ((end - 1) * 2 - source + ${d});
        source -= start;
      `;h=`
        ${s} rc = outputLoc;
        ${f}
        result[0] = getChannel(getX(${l.join()}), ${p});
        ${c[o-1]} += 1;
        if(${u}) {
          ${f}
          result[1] = getChannel(getX(${l.join()}), ${p});
        }
        rc = outputLoc;
        ${c[o-2]} += 1;
        if(${c[o-2]} < ${this.outputShape[o-2]}) {
          ${f}
          result[2] = getChannel(getX(${l.join()}), ${p});
          ${c[o-1]} += 1;
          if(${u}) {
            ${f}
            result[3] = getChannel(getX(${l.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}};var t5e=({inputs:r,backend:e,attrs:t})=>{let{x:n}=r,{paddings:o,mode:s}=t,i=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new a2(n.shape,o,s):new i2(n.shape,o,s);return e.runWebGLProgram(i,[n],n.dtype)},ide={kernelName:Gu,backendName:"webgl",kernelFunc:t5e};var r5e=`if (b == 0.0) return NAN;
  return mod(a, b);`,n5e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Ui+`
  return result;
`,o5e=br({opSnippet:r5e,packedOpSnippet:n5e}),ade={kernelName:Zc,backendName:"webgl",kernelFunc:o5e};var c2=class{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}};var s5e=`
if (a == b) {
  return 1.0;
};
return a / b;`,i5e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Qz=br({opSnippet:s5e,packedOpSnippet:i5e,checkOutOfBounds:!0}),cde={kernelName:Pc,backendName:"webgl",kernelFunc:Qz};var lde="return a - b;",Jz=br({opSnippet:lde,packedOpSnippet:lde,supportsComplex:!0,cpuKernelImpl:kle}),ude={kernelName:hl,backendName:"webgl",kernelFunc:Jz};function eU(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{dim:s}=n,i=C.parseAxisParam([s],o.shape),a=Zz({inputs:{x:o},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),c=E.expandShapeToKeepDim(a.shape,i),l=ke({inputs:{x:a},backend:t,attrs:{shape:c}}),u=Jz({inputs:{a:o,b:l},backend:t}),p=Kz({inputs:{x:u},backend:t}),d=Oy({inputs:{x:p},backend:t,attrs:{axis:i,keepDims:!1}}),h=ke({inputs:{x:d},backend:t,attrs:{shape:c}}),f=Qz({inputs:{a:p,b:h},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(h),f}var pde={kernelName:ip,backendName:"webgl",kernelFunc:eU};function a5e(r){let{inputs:e,backend:t,attrs:n}=r,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n,c=a?o:eU({inputs:{logits:o},backend:t,attrs:{dim:o.shape.length-1}}),l=c.shape[0],u=c.shape[1],p=new c2(l,u,s),d=[[i]],h=t.runWebGLProgram(p,[c],"int32",d);return a||t.disposeIntermediateTensorInfo(c),h}var dde={kernelName:xf,backendName:"webgl",kernelFunc:a5e};var c5e=ro+`
  return -x;
`,l5e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function u5e(r){let{inputs:e,backend:t}=r,{x:n}=e;if(t.shouldExecuteOnCPU([n])){let s=t.texData.get(n.dataId),[i,a]=cle(s.values,n.shape,n.dtype);return t.makeTensorInfo(a,n.dtype,i)}let o;return Z().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new ri(n.shape,l5e):o=new jo(n.shape,c5e),t.runWebGLProgram(o,[n],n.dtype)}var hde={kernelName:Wu,backendName:"webgl",kernelFunc:u5e};var p5e=to.nonMaxSuppressionV3Impl;function d5e(r){E.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c}=n,l=t.readSync(o.dataId),u=t.readSync(s.dataId),{selectedIndices:p}=p5e(l,u,i,a,c);return t.makeTensorInfo([p.length],"int32",new Int32Array(p))}var fde={kernelName:vf,backendName:"webgl",kernelFunc:d5e};var h5e=to.nonMaxSuppressionV4Impl;function f5e(r){E.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,padToMaxOutputSize:l}=n,u=t.readSync(o.dataId),p=t.readSync(s.dataId),{selectedIndices:d,validOutputs:h}=h5e(u,p,i,a,c,l);return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([h]))]}var mde={kernelName:xv,backendName:"webgl",kernelFunc:f5e};var m5e=to.nonMaxSuppressionV5Impl;function g5e(r){E.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:t,attrs:n}=r,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:c,softNmsSigma:l}=n,u=t.readSync(o.dataId),p=t.readSync(s.dataId),d=i,h=a,f=c,m=l,{selectedIndices:g,selectedScores:y}=m5e(u,p,d,h,f,m);return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var gde={kernelName:bf,backendName:"webgl",kernelFunc:g5e};var l2=class{constructor(e,t,n,o){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${n}),
                      float(index == coords.y)));
      }
    `}};var y5e=r=>{let{inputs:e,backend:t,attrs:n}=r,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:c}=n,l=C.sizeFromShape(o.shape),u=new l2(l,i,a,c),p=ke({inputs:{x:o},backend:t,attrs:{shape:[l]}}),d=t.runWebGLProgram(u,[p],s);t.disposeIntermediateTensorInfo(p);let h=[...o.shape,i],f=ke({inputs:{x:d},backend:t,attrs:{shape:h}});return t.disposeIntermediateTensorInfo(d),f},yde={kernelName:Hu,backendName:"webgl",kernelFunc:y5e};function gS(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="complex64"){let o=Yd({inputs:{input:n},backend:t}),s=gS({inputs:{x:o},backend:t}),i=Fy({inputs:{input:n},backend:t}),a=gS({inputs:{x:i},backend:t}),c=oi({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Zd({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var xde={kernelName:lp,backendName:"webgl",kernelFunc:gS};function vde(r){let{inputs:e,backend:t}=r,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){let o=Yd({inputs:{input:n},backend:t}),s=vde({inputs:{x:o},backend:t}),i=Fy({inputs:{input:n},backend:t}),a=gS({inputs:{x:i},backend:t}),c=oi({inputs:{real:s,imag:a},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),c}else return Zd({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var bde={kernelName:ju,backendName:"webgl",kernelFunc:vde};function x5e(r){let{inputs:e,backend:t,attrs:n}=r,{axis:o}=n;if(e.length===1)return qR({inputs:{input:e[0]},backend:t,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(u=>{C.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),C.assert(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],c=e.map(u=>{let p=qR({inputs:{input:u},backend:t,attrs:{dim:o}});return a.push(p),p}),l=qz({inputs:c,backend:t,attrs:{axis:o}});return a.forEach(u=>t.disposeIntermediateTensorInfo(u)),l}var wde={kernelName:qu,backendName:"webgl",kernelFunc:x5e};var u2=class{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((l,u)=>l[0]+e[u]+l[1]);let o=e.length,s=bt(o),i=t.map(l=>l[0]).join(","),a=t.map((l,u)=>l[0]+e[u]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}};var p2=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((m,g)=>m[0]+e[g]+m[1]);let o=e.length,s=bt(o),i=t.map(m=>m[0]).join(","),a=t.map((m,g)=>m[0]+e[g]).join(","),c=Pn("rc",o),l=Pn("source",o),u=`${c[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${l.slice(-2).join()})`,d=[`${s} rc = outputLoc;`,`${c[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${c[o-2]} += 1;
       if(${c[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${c[o-1]} += 1;
         if(${u}) {`],h=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="";for(let m=0,g=o===1?2:4;m<g;m++)f+=`
        ${d[m]}
        if (${h}) {
          result[${m}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${m}] = getChannel(getX(${l.join()}), ${p});
        }
      `;f+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var tU=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{paddings:s,constantValue:i}=n;if(C.sizeFromShape(o.shape)===0){let l=s.map((u,p)=>u[0]+o.shape[p]+u[1]);return Zd({backend:t,attrs:{shape:l,value:i,dtype:o.dtype}})}let a=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p2(o.shape,s,i):new u2(o.shape,s,i),c=[[i]];return t.runWebGLProgram(a,[o],o.dtype,c)},Cde={kernelName:Ku,backendName:"webgl",kernelFunc:tU};var v5e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,b5e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Ui+`
  return result;
`,w5e=br({opSnippet:v5e,packedOpSnippet:b5e}),_de={kernelName:Jc,backendName:"webgl",kernelFunc:w5e};function C5e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,c=[],l=C.parseAxisParam(s,o.shape),u=l,p=E.getAxesPermutation(u,a),d=o;p!=null&&(d=an({inputs:{x:o},backend:t,attrs:{perm:p}}),u=E.getInnerMostAxes(u.length,a),c.push(d)),E.assertAxesAreInnerMostDims("prod",u,a);let h;if(t.shouldExecuteOnCPU([d])){let f=t.texData.get(d.dataId).values,{outVals:m,outShape:g,outDtype:y}=ule(d.shape,d.dtype,f,u);h=t.makeTensorInfo(g,y,m)}else{let[f,m]=E.computeOutAndReduceShapes(d.shape,u),g=C.sizeFromShape(m),y=ke({inputs:{x:d},backend:t,attrs:{shape:[-1,g]}}),x=Td(o.dtype),b=Gi(y,x,"prod",t);h=ke({inputs:{x:b},backend:t,attrs:{shape:f}}),c.push(y),c.push(b)}if(i){c.push(h);let f=E.expandShapeToKeepDim(h.shape,l);h=ke({inputs:{x:h},backend:t,attrs:{shape:f}})}return c.forEach(f=>t.disposeIntermediateTensorInfo(f)),h}var Sde={kernelName:Yu,backendName:"webgl",kernelFunc:C5e};function _5e(r){let{inputs:e,backend:t,attrs:n}=r,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,c=o.map(y=>t.readSync(y.dataId)),l=o.map(y=>y.shape),u=t.readSync(s.dataId),p=t.readSync(i.dataId),[d,h,f]=ple(c,l,u,s.shape,s.dtype,p,i.shape,a),m=d.map(y=>t.makeTensorInfo([y.length],"int32",y)),g=t.makeTensorInfo(f,s.dtype,h);return m.concat([g])}var Ide={kernelName:vv,backendName:"webgl",kernelFunc:_5e};function S5e(r){let{inputs:e,backend:t}=r,{starts:n,limits:o,deltas:s}=e,i=t.readSync(n.dataId),a=t.readSync(o.dataId),c=t.readSync(s.dataId),[l,u]=dle(i,n.shape,n.dtype,a,o.shape,c,s.shape),p=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([u.length],n.dtype,u);return[p,d]}var Tde={kernelName:bv,backendName:"webgl",kernelFunc:S5e};function I5e(r){let{inputs:e,backend:t,attrs:n}=r,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:c}=n,l=t.readSync(o.dataId),u=t.readSync(s.dataId),p=t.readSync(i.dataId),d=a.map(g=>t.readSync(g.dataId)),h=a.map(g=>g.shape),[f,m]=hle(l,o.shape,u,s.shape,s.dtype,p,i.shape,d,h,c);return t.makeTensorInfo(f,s.dtype,m)}var kde={kernelName:wv,backendName:"webgl",kernelFunc:I5e};var rU=r=>{let{backend:e,attrs:t}=r,{start:n,stop:o,step:s,dtype:i}=t,a=fle(n,o,s,i);return e.makeTensorInfo([a.length],i,a)},Ede={kernelName:wf,backendName:"webgl",kernelFunc:rU};var T5e="return 1.0 / x;",k5e=et({opSnippet:T5e}),Nde={kernelName:el,backendName:"webgl",kernelFunc:k5e};var E5e=ro+`
  return (x < 0.0) ? 0.0 : x;
`,N5e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,D5e=et({opSnippet:E5e,packedOpSnippet:N5e}),Dde={kernelName:tl,backendName:"webgl",kernelFunc:D5e};var A5e=ro+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,R5e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,O5e=et({opSnippet:A5e,packedOpSnippet:R5e}),Ade={kernelName:rl,backendName:"webgl",kernelFunc:O5e};var d2=class{constructor(e,t,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,c,l]=e;this.outputShape=[i,t,n,l];let u=[o&&t>1?a-1:a,o&&n>1?c-1:c],p=[o&&t>1?t-1:t,o&&n>1?n-1:n],d;s?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/p[0]},
          ${u[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var h2=class{constructor(e,t,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,c,l]=e;this.outputShape=[i,t,n,l];let u=[o&&t>1?a-1:a,o&&n>1?c-1:c],p=[o&&t>1?t-1:t,o&&n>1?n-1:n],d;s?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/p[0]},
          ${u[1]/p[1]},
          ${u[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function M5e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[c,l]=a,u=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new h2(o.shape,c,l,s,i):new d2(o.shape,c,l,s,i);return t.runWebGLProgram(u,[o],"float32")}var Rde={kernelName:Ju,backendName:"webgl",kernelFunc:M5e};var f2=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,o,s]=t,[,i,a]=e,c=[n&&i>1?o-1:o,n&&a>1?s-1:s],l=[n&&i>1?i-1:i,n&&a>1?a-1:a],u=c[0]/l[0],p=c[1]/l[1],d=1/u,h=1/p,f=Math.ceil(d)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${p});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${h});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function F5e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n,a=new f2(s.shape,o.shape,i);return t.runWebGLProgram(a,[s],s.dtype)}var Ode={kernelName:Sf,backendName:"webgl",kernelFunc:F5e};var m2=class{constructor(e,t,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,c,l]=e;this.outputShape=[i,t,n,l];let u=[o&&t>1?a-1:a,o&&n>1?c-1:c],p=[o&&t>1?t-1:t,o&&n>1?n-1:n],d=o?"0.5":"0.0",h;s?h="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/p[0]},
          ${u[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var g2=class{constructor(e,t,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,c,l]=e;this.outputShape=[i,t,n,l];let u=[o&&t>1?a-1:a,o&&n>1?c-1:c],p=[o&&t>1?t-1:t,o&&n>1?n-1:n],d=o?"0.5":"0.0",h;s?h="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/p[0]},
          ${u[1]/p[1]},
          ${u[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${d})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function P5e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[c,l]=a,u=Z().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new g2(o.shape,c,l,s,i):new m2(o.shape,c,l,s,i);return t.runWebGLProgram(u,[o],o.dtype)}var Mde={kernelName:Qu,backendName:"webgl",kernelFunc:P5e};var y2=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,o,s]=t,[,i,a]=e,c=[n&&i>1?o-1:o,n&&a>1?s-1:s],l=[n&&i>1?i-1:i,n&&a>1?a-1:a],u=c[0]/l[0],p=c[1]/l[1],d=1/u,h=1/p,f=Math.ceil(d)*2+2,m=Math.ceil(h)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${p});

        const float invHeightScale = float(${d});
        const float invWidthScale = float(${h});

        const int winHeight = int(${f});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function $5e(r){let{inputs:e,backend:t,attrs:n}=r,{images:o,dy:s}=e,{alignCorners:i}=n,a=new y2(s.shape,o.shape,i);return t.runWebGLProgram(a,[s],s.dtype)}var Fde={kernelName:_f,backendName:"webgl",kernelFunc:$5e};var x2=class{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let o=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,c)=>o(c)).join(","),i=bt(n);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}};var v2=class{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let o=Pn("rc",n),s=`${o[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${o[n-2]} + 1 < ${this.outputShape[n-2]}`,a=bt(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(o.slice())};
          if(${s}){
            result.g = ${l(o.slice())};
          }
          if(${i}) {
            result.b = ${u(o.slice())};
            if(${s}) {
              result.a = ${p(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(f){return d(f)}function l(f){return f[n-1]="("+f[n-1]+" + 1)",d(f)}function u(f){return f[n-2]="("+f[n-2]+" + 1)",d(f)}function p(f){return f[n-1]="("+f[n-1]+" + 1)",f[n-2]="("+f[n-2]+" + 1)",d(f)}function d(f){let m=e.map((x,b)=>h(b,f)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function h(f,m){return t.indexOf(f)!==-1&&e[f]!==1?`${e[f]} - ${m[f]} - 1`:`${m[f]}`}}};function L5e(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{dims:s}=n,i=o.shape.length,a=C.parseAxisParam(s,o.shape);if(i===0)return $n({inputs:{x:o},backend:t});let c=Z().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new v2(o.shape,a):new x2(o.shape,a);return t.runWebGLProgram(c,[o],o.dtype)}var Pde={kernelName:ep,backendName:"webgl",kernelFunc:L5e};var b2=class{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],o=e[2];this.outputShape=e;let s="";typeof t=="number"?s=`float outputValue = ${t.toFixed(2)};`:s=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var $de={kernelName:Pf,backendName:"webgl",kernelFunc:({inputs:r,attrs:e,backend:t})=>{let{image:n}=r,{radians:o,fillValue:s,center:i}=e,a=t,c=new b2(n.shape,s),[l,u]=E.getImageCenter(i,n.shape[1],n.shape[2]),p=[[l,u,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(c,[n],n.dtype,p)}};var V5e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,B5e=et({opSnippet:V5e}),Lde={kernelName:nl,backendName:"webgl",kernelFunc:B5e};var z5e="return inversesqrt(x);",U5e=et({opSnippet:z5e,cpuKernelImpl:mle}),Vde={kernelName:ol,backendName:"webgl",kernelFunc:U5e};var _m=class{constructor(e,t,n,o,s,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let l=bt(s.length),u=bt(i.length),p="";n===1?p="i":n===2&&(p="i, j");let d=`getIndices(${p})`,h="";o===1?h="i":o===2&&(h="i, coords[1]");let f=`getUpdates(${h})`,m="";c&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=t>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}};var w2=class{constructor(e,t,n,o,s,i,a=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;let l=bt(s.length),u=bt(i.length),p="";n===1?p="i":n===2&&(p="i, j");let d=`getIndices(${p})`,h="";o===1?h="i":o===2&&(h="i, coords[1]");let f=`getUpdates(${h})`,m="";c&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=t>1?"strides[j]":"strides",x=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${d});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${f};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}};function G5e(r){let{inputs:e,backend:t,attrs:n}=r,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:p}=E.calculateShapes(s,o,i),d=[p/l,l];if(p===0)return t.makeTensorInfo(i,o.dtype);let h=ke({inputs:{x:o},backend:t,attrs:{shape:[c,a]}}),f=ke({inputs:{x:s},backend:t,attrs:{shape:[c,l]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0])),g;Z().getBool("WEBGL_PACK")?g=new w2(c,a,h.shape.length,f.shape.length,u,d):g=new _m(c,a,h.shape.length,f.shape.length,u,d);let y=t.runWebGLProgram(g,[f,h,m],f.dtype),x=ke({inputs:{x:y},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(m),x}var Bde={kernelName:If,backendName:"webgl",kernelFunc:G5e};var C2=class{constructor(e,t,n,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let s="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=Z().getNumber("WEBGL_VERSION")===2?s:i,c=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function W5e(r){let{inputs:e,backend:t,attrs:n}=r,{sortedSequence:o,values:s}=e,{side:i}=n,a=new C2(o.shape[0],o.shape[1],s.shape[1],i),c=[[o.shape[1]]];return t.runWebGLProgram(a,[o,s],"int32",c)}var zde={kernelName:kf,backendName:"webgl",kernelFunc:W5e};var _2=class{constructor(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;let o,s;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)s="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],l=[];for(let u=0;u<t.length;u++)l.push(`${a[u]}`),u<e&&c.push(`${a[u]}`);o=c.join(),s=l.join()}let i=bt(n);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}};function j5e(r){let{inputs:e,backend:t}=r,{condition:n,t:o,e:s}=e,i=new _2(n.shape.length,o.shape,o.shape.length);return t.runWebGLProgram(i,[n,o,s],$r(o.dtype,s.dtype))}var Ude={kernelName:tp,backendName:"webgl",kernelFunc:j5e};var H5e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${E.SELU_SCALEALPHA};
  float scale = ${E.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,q5e=et({opSnippet:H5e}),Gde={kernelName:sl,backendName:"webgl",kernelFunc:q5e};var K5e=ec+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,X5e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Y5e=et({opSnippet:K5e,packedOpSnippet:X5e,cpuKernelImpl:yle}),Wde={kernelName:ll,backendName:"webgl",kernelFunc:Y5e};var Z5e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Q5e=et({opSnippet:Z5e}),jde={kernelName:cl,backendName:"webgl",kernelFunc:Q5e};var J5e=ec+`
  return sin(x);
`,eKe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Ui}
  return result;
`,tKe=et({opSnippet:J5e,packedOpSnippet:eKe}),Hde={kernelName:il,backendName:"webgl",kernelFunc:tKe};var rKe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,nKe=et({opSnippet:rKe}),qde={kernelName:al,backendName:"webgl",kernelFunc:nKe};var oKe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,sKe=et({opSnippet:oKe}),Kde={kernelName:ul,backendName:"webgl",kernelFunc:sKe};var iKe=r=>{let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{blockShape:s,paddings:i}=n;C.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((y,x)=>y*x),c=[[0,0]];c.push(...i);for(let y=1+s.length;y<o.shape.length;++y)c.push([0,0]);let l=[],u=tU({inputs:{x:o},backend:t,attrs:{paddings:c,constantValue:0}}),p=E.getReshaped(u.shape,s,a,!1),d=E.getPermuted(p.length,s.length,!1),h=E.getReshapedPermuted(u.shape,s,a,!1),f=ke({inputs:{x:u},backend:t,attrs:{shape:p}}),m=an({inputs:{x:f},backend:t,attrs:{perm:d}}),g=ke({inputs:{x:m},backend:t,attrs:{shape:h}});return l.push(u),l.push(f),l.push(m),l.forEach(y=>t.disposeIntermediateTensorInfo(y)),g},Xde={kernelName:op,backendName:"webgl",kernelFunc:iKe};function aKe(r){let{inputs:e,backend:t}=r,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=t.readSync(n.dataId),c=t.readSync(o.dataId),l=t.readSync(s.dataId),u=t.readSync(i.dataId)[0],[p,d,h,f,m]=vle(a,n.shape,n.dtype,c,o.dtype,l,u);return[t.makeTensorInfo(d,n.dtype,p),t.makeTensorInfo([d[0]],o.dtype,h),t.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(g=>Number(g)))),t.makeTensorInfo([m.length],n.dtype,new Int32Array(m))]}var Yde={kernelName:Cv,backendName:"webgl",kernelFunc:aKe};function cKe(r){let{inputs:e,backend:t}=r,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(t.readSync(o.dataId)),a=t.readSync(n.dataId),c=Array.from(t.readSync(s.dataId)),[l,u,p]=ble(a,n.shape,n.dtype,i,c);return[t.makeTensorInfo(u,n.dtype,l),t.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var Zde={kernelName:_v,backendName:"webgl",kernelFunc:cKe};function lKe(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=t.readSync(n.dataId),a=t.readSync(o.dataId),c=t.readSync(s.dataId),[l,u]=oR(i,n.shape,n.dtype,a,c,!0);return t.makeTensorInfo(u,n.dtype,l)}var Qde={kernelName:Ef,backendName:"webgl",kernelFunc:lKe};function uKe(r){let{inputs:e,backend:t}=r,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=t.readSync(n.dataId),a=t.readSync(o.dataId),c=t.readSync(s.dataId),[l,u]=oR(i,n.shape,n.dtype,a,c);return t.makeTensorInfo(u,n.dtype,l)}var Jde={kernelName:Nf,backendName:"webgl",kernelFunc:uKe};function pKe(r){let{inputs:e,backend:t,attrs:n}=r,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:c,numUpdates:l,sliceSize:u,strides:p,outputSize:d}=E.calculateShapes(s,o,a),h=!1;if(s.dtype==="string"){let y=t.bufferSync(o),x=t.bufferSync(s),b=C.decodeString(t.readSync(i.dataId)[0]),w=gle(y,x,a,d,u,l,c,p,b,h);return t.makeTensorInfo(a,w.dtype,w.values)}let f=new _m(l,c,o.shape.length,s.shape.length,p,[d,1],h),m=t.runWebGLProgram(f,[s,o,i],s.dtype),g=ke({inputs:{x:m},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(m),g}var ehe={kernelName:Df,backendName:"webgl",kernelFunc:pKe};function dKe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=C.parseAxisParam(i,o.shape)[0],c=E.prepareSplitSize(o,s,a),l=o.shape.length,u=new Array(l).fill(0),p=o.shape.slice();return c.map(d=>{let h=[...p];h[a]=d;let f=$l({inputs:{x:o},backend:t,attrs:{begin:u,size:h}});return u[a]+=d,f})}var the={kernelName:sp,backendName:"webgl",kernelFunc:dKe};var rhe="return sqrt(x);",hKe=et({opSnippet:rhe,packedOpSnippet:rhe,cpuKernelImpl:wle}),nhe={kernelName:pl,backendName:"webgl",kernelFunc:hKe};var fKe="return x * x;",mKe=et({opSnippet:fKe}),ohe={kernelName:Af,backendName:"webgl",kernelFunc:mKe};var she="return (a - b) * (a - b);",gKe=br({opSnippet:she,packedOpSnippet:she}),ihe={kernelName:dl,backendName:"webgl",kernelFunc:gKe};function yKe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");let s=t.readSync(o.dataId),i=E.fromUint8ToStringArray(s),a=Cle(i,"string",n);return t.makeTensorInfo(o.shape,"string",a)}var ahe={kernelName:Pg,backendName:"webgl",kernelFunc:yKe};function xKe({inputs:r,attrs:e,backend:t}){let{x:n}=r,o=ro+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new jo(n.shape,o);return t.runWebGLProgram(s,[n],n.dtype)}var che={kernelName:gl,backendName:"webgl",kernelFunc:xKe};var S2=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let o=n.length,s=bt(n.length),i=bt(n.length),a="";if(o===1)a="coords * strides + begin";else{let c=0;a=n.map((l,u)=>(c++,n.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${c-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function vKe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{begin:s,end:i,strides:a,beginMask:c,endMask:l,ellipsisMask:u,newAxisMask:p,shrinkAxisMask:d}=n,{finalShapeSparse:h,finalShape:f,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:b,strides:w}=Tn.sliceInfo(o.shape,s,i,a,c,l,u,p,d),_;if(m)_=ke({inputs:{x:o},backend:t,attrs:{shape:f}});else if(g||y){C.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let S=Tn.computeOutShape(x,b,w),k=$l({inputs:{x:o},backend:t,attrs:{begin:x,size:S}});_=ke({inputs:{x:k},backend:t,attrs:{shape:f}}),t.disposeIntermediateTensorInfo(k)}else if(t.shouldExecuteOnCPU([o])){let k=t.readSync(o.dataId),R=ze(o.shape,o.dtype,k),L=_le(h,R,w,x);_=t.makeTensorInfo(f,o.dtype,L.values)}else{let k=new S2(x,w,h);_=t.runWebGLProgram(k,[o],o.dtype)}let I=ke({inputs:{x:_},backend:t,attrs:{shape:f}});return t.disposeIntermediateTensorInfo(_),I}var lhe={kernelName:Rf,backendName:"webgl",kernelFunc:vKe};function bKe(r){let{inputs:e,backend:t,attrs:n}=r,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:c,preserveShortSequences:l}=n,{data:u,dataSplits:p}=e,d=t.readSync(u.dataId),h=t.readSync(p.dataId),[f,m]=Sle(d,h,o,s,i,a,c,l);return[t.makeTensorInfo([f.length],"string",f),t.makeTensorInfo(p.shape,"int32",m)]}var uhe={kernelName:Of,backendName:"webgl",kernelFunc:bKe};function wKe(r){let{inputs:e,backend:t,attrs:n}=r,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=t.readSync(s.dataId),c=t.readSync(i.dataId)[0],[l,u,p]=Ile(a,c,o),d=u.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",u),t.makeTensorInfo([2],"int32",new Int32Array(p))]}var phe={kernelName:Sv,backendName:"webgl",kernelFunc:wKe};function CKe(r){let{inputs:e,backend:t,attrs:n}=r,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=t.readSync(s.dataId),a=Tle(i,o);return t.makeTensorInfo(s.shape,"int32",a)}var dhe={kernelName:Iv,backendName:"webgl",kernelFunc:CKe};var _Ke="return tan(x);",SKe=et({opSnippet:_Ke}),hhe={kernelName:fl,backendName:"webgl",kernelFunc:SKe};var IKe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,TKe=et({opSnippet:IKe}),fhe={kernelName:ml,backendName:"webgl",kernelFunc:TKe};function kKe(r){let{inputs:e,backend:t,attrs:n}=r,{tensor:o,indices:s,updates:i}=e,{}=n,{sliceRank:a,numUpdates:c,sliceSize:l,strides:u,outputSize:p}=E.calculateShapes(i,s,o.shape),d=[p/l,l];if(p===0)return t.makeTensorInfo(o.shape,s.dtype);let h=ke({inputs:{x:s},backend:t,attrs:{shape:[c,a]}}),f=ke({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),m=ke({inputs:{x:o},backend:t,attrs:{shape:d}}),g=new _m(c,a,h.shape.length,f.shape.length,u,d,!1,!0),y=t.runWebGLProgram(g,[f,h,m],m.dtype),x=ke({inputs:{x:y},backend:t,attrs:{shape:o.shape}});return t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),x}var mhe={kernelName:Tf,backendName:"webgl",kernelFunc:kKe};var I2=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*t[i];this.outputShape=n,this.rank=n.length;let o=bt(this.rank),s=EKe(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}};function EKe(r){let e=r.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${r[0]})`;let t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[];for(let o=0;o<r.length;o++)n.push(`imod(${t[o]}, ${r[o]})`);return n.join()}function nU(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{reps:s}=n;if(o.dtype==="string"||o.shape.length>5){let c=t.readSync(o.dataId),l=o.dtype==="string"?c.map(d=>C.decodeString(d)):c,u=ze(o.shape,o.dtype,l),p=Ele(u,s);return t.makeTensorInfo(p.shape,p.dtype,p.values)}let i=new I2(o.shape,s);return t.runWebGLProgram(i,[o],o.dtype)}var ghe={kernelName:Ra,backendName:"webgl",kernelFunc:nU};var T2=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},k2=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Py(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function yhe(r){let e=1;for(;e<r;)e*=2;return e}function NKe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o}=e,{k:s,sorted:i}=n,a=Z().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Z().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=o.shape,u=l[l.length-1];if(t.shouldExecuteOnCPU([o])||u<a||s>c){let L=t.readSync(o.dataId),[B,z]=Nle(L,l,o.dtype,s,i);return[t.makeTensorInfo(B.shape,B.dtype,B.values),t.makeTensorInfo(z.shape,z.dtype,z.values)]}if(s===0)return l[l.length-1]=0,[t.makeTensorInfo(l,o.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(u===1)return[o,Zd({attrs:{shape:l,dtype:"int32",value:0},backend:t})];let p=t.texData.get(o.dataId),d=p!==null&&p.isPacked,h=d?t.unpackTensor(o):o,m=C.sizeFromShape(l)/u,g=ke({inputs:{x:h},attrs:{shape:[m,u]},backend:t});d&&Py(t,h);let y=yhe(s),x=yhe(u),b=null,w=()=>b===null?[g,g]:[g,b],_=(L,B,z)=>{let q=w(),U=new T2(z),j=[[u],[b===null?1:0],[Number.NEGATIVE_INFINITY],[L],[B]],X=b;b=t.runWebGLProgram(U,q,"int32",j),Py(t,X)};for(let L=1;L<y;L*=2){let B=L*2;for(let z=L;z>=1;z/=2)_(B,z,[m,x])}for(let L=x;L>y;L/=2){let B=w(),z=new k2([m,L/2]),U=[[u],[b===null?1:0],[y]],G=b;b=t.runWebGLProgram(z,B,"int32",U),Py(t,G);let j=y/2,X=j*2;for(let te=j;te>=1;te/=2)_(X,te,b.shape)}let I=b;b=$l({inputs:{x:b},backend:t,attrs:{begin:0,size:[m,s]}}),Py(t,I);let S=Yz({inputs:{x:g,indices:b},backend:t,attrs:{axis:1,batchDims:1}});Py(t,g);let k=l.slice(0,-1);k.push(s),I=b,b=ke({inputs:{x:b},attrs:{shape:k},backend:t}),Py(t,I);let R=S;return S=ke({inputs:{x:S},attrs:{shape:k},backend:t}),Py(t,R),[S,b]}var xhe={kernelName:Mf,backendName:"webgl",kernelFunc:NKe};var E2=class{constructor(e,t,n,o,s,i){this.variableNames=["Image","Transforms"],this.outputShape=i;let a=n==="nearest"?1:2,c;switch(o){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function DKe(r){let{inputs:e,backend:t,attrs:n}=r,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:c,outputShape:l}=n,[u,p,d,h]=o.shape,[f,m]=l??[p,d],g=[u,f,m,h],y=new E2(p,d,i,a,c,g);return t.runWebGLProgram(y,[o,s],"float32")}var vhe={kernelName:Ff,backendName:"webgl",kernelFunc:DKe};function AKe(r){let{inputs:e,attrs:t,backend:n}=r,{axis:o}=t,{x:s}=e;Ap(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=n.readSync(s.dataId),{outputValues:a,outputShape:c,indices:l}=Dle(i,o,s.shape,s.dtype);return[n.makeTensorInfo(c,s.dtype,a),n.makeTensorInfo([l.length],"int32",l)]}var bhe={kernelName:Tv,backendName:"webgl",kernelFunc:AKe};function RKe(r){let{inputs:e,backend:t,attrs:n}=r,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,c=o.shape[s],l=new Array(a-1),u=0;for(let m=0;m<a;m++)m!==s&&(l[u++]=i.shape[m]);let p=[],d=new Array(a).fill(0),h=i.shape.slice();h[s]=1;let f=new Array(c);for(let m=0;m<f.length;m++){d[s]=m;let g=$l({inputs:{x:i},backend:t,attrs:{begin:d,size:h}}),y=ke({inputs:{x:g},backend:t,attrs:{shape:l}});f[m]=y,p.push(g)}return p.forEach(m=>t.disposeIntermediateTensorInfo(m)),f}var whe={kernelName:ap,backendName:"webgl",kernelFunc:RKe};var N2=class{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,o=e.batchSize,s=e.inSize,i=e.numSegments,a=i*Math.ceil(s/n);this.outputShape=[o,a];let c="0.0",l="sumValue",u=Math.floor(n/4)*4,p=n%4,d=`
        sumValue += dot(values, segFilter);
    `,h="";s%n>0&&(h=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let f="";s%n>0&&(f=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${f}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${d}
        }

        int inIdx = inOffset + ${u};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${d}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${d}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${d}
        }
        setOutput(${l});
      }
    `}};function OKe(r){let{inputs:e,backend:t,attrs:n}=r,{x:o,segmentIds:s}=e,{numSegments:i}=n,a=o.shape.length,c=[],l=0,u=E.getAxesPermutation([l],a),p=o;u!=null&&(p=an({inputs:{x:o},backend:t,attrs:{perm:u}}),c.push(p),l=E.getInnerMostAxes(1,a)[0]);let d=E.segment_util.computeOutShape(p.shape,l,i),h=C.sizeFromShape([p.shape[l]]),f=ke({inputs:{x:p},backend:t,attrs:{shape:[-1,h]}});c.push(f);let m=Td(o.dtype),g=(w,_,I,S,k)=>{let R=w.shape[0],L=w.shape[1],B=E.segment_util.segOpComputeOptimalWindowSize(L,k),z={windowSize:B,inSize:L,batchSize:R,numSegments:k},q=new N2(z,_),U=t.compileAndRun(q,[w,I],S);if(c.push(U),U.shape[1]===k)return U;let G=rU({backend:t,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),j=nU({inputs:{x:G},backend:t,attrs:{reps:[L/B]}});return c.push(G),c.push(j),g(U,_,j,S,k)},y=g(f,"unsortedSegmentSum",s,m,i),x=ke({inputs:{x:y},backend:t,attrs:{shape:d}}),b=x;if(u!=null){c.push(x);let w=E.getUndoAxesPermutation(u);b=an({inputs:{x:b},backend:t,attrs:{perm:w}})}return c.forEach(w=>t.disposeIntermediateTensorInfo(w)),b}var Che={kernelName:cp,backendName:"webgl",kernelFunc:OKe};var MKe=[oue,iue,aue,cue,uue,pue,due,hue,gue,yue,xue,vue,bue,wue,Cue,_ue,Sue,Iue,Tue,kue,Eue,Due,Aue,Rue,Oue,$ue,Vue,Bue,Kle,Uue,Wue,jue,Hue,que,Kue,Xue,Yue,Zue,Que,Jue,rpe,npe,ope,spe,ipe,ape,cpe,lpe,upe,ppe,dpe,hpe,fpe,mpe,gpe,ype,vpe,bpe,wpe,Cpe,Spe,Ipe,Tpe,kpe,Epe,Npe,Dpe,Ape,Rpe,qle,Ope,Gue,Mpe,Fpe,Ppe,Xle,$pe,Lpe,Vpe,Bpe,zpe,Upe,Gpe,Wpe,jpe,Hpe,Kpe,Xpe,Ype,Zpe,Qpe,Jpe,tde,nde,ode,sde,ide,ade,dde,Qle,hde,fde,mde,gde,Mue,yde,bde,wde,Cde,_de,Yle,Sde,Ide,Tde,kde,Ede,Fue,cde,Nde,Dde,Ade,eue,Rde,Ode,Mde,Fde,Pde,$de,Lde,Vde,Bde,zde,Ude,Gde,Wde,jde,Hde,qde,Nue,pde,Kde,Xde,Yde,Zde,Qde,Jde,ehe,the,nhe,ohe,ihe,ahe,che,lhe,uhe,phe,dhe,ude,rue,hhe,fhe,mhe,ghe,xhe,vhe,nue,bhe,whe,Che,xde];for(let r of MKe)Ev(r);var oU=class{average=new Yr;events=[];start=0;seconds2Track;milisecs2Track;constructor(e){this.seconds2Track=e,this.milisecs2Track=e*1e3}track(e){if(this.events.push(e),this.start==0&&(this.start=performance.now()),performance.now()-this.start>this.milisecs2Track){let n=this.events.reduce((o,s)=>o+s,0)/this.events.length;this.average.next(n),this.events=[],this.start=performance.now()}}},D2=class r{constructor(e){this.events=e}detector=null;tracker=new oU(30);modelName4Event="MoveNet.MultiPose.Lightning";isReady(){return!!this.detector}buildMoveNetPoseDetector(){return M(this,null,function*(){let e=ds.MoveNet;return yield Yee(e,{modelType:"MultiPose.Lightning"})})}initPoseDetection(){return M(this,null,function*(){return this.events.track("pose.detection.init",{step:0,name:"start"}),yield XK(),this.events.track("pose.detection.init",{step:1,name:"tensorflow.ready",tensorflowBackend:pp()}),this.detector||(this.events.track("pose.detection.init",{step:2,name:"no.detector.found"}),this.detector=yield this.buildMoveNetPoseDetector(),this.events.track("pose.detection.init",{step:3,model:this.modelName4Event,name:"detector.created"})),this.tracker.average.subscribe(e=>{this.events.track("pose.detection.stats",{seconds:this.tracker.seconds2Track,average:e,model:this.modelName4Event,tensorflowBackend:pp()})}),this.detector})}detect(e){return M(this,null,function*(){if(!this.detector)throw this.events.track("error",{name:"no.pose.detector.found"}),new Error("Pose detector is not initialized. Call initPoseDetection() first.");let t=performance.now(),n=yield this.detector.estimatePoses(e,{maxPoses:1,flipHorizontal:!1,scoreThreshold:.5}),o=this.flipPosesHorizontally(e,n),s=performance.now();return this.tracker.track(s-t),o})}flipPosesHorizontally(e,t){let n=e.videoWidth;return t.forEach(o=>{o.keypoints.forEach(s=>{s.x=n-s.x})}),t}static \u0275fac=function(t){return new(t||r)(Lt(Na))};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var Sm=class r{message=new Yr;warning(e){this.message.next(e)}clear(){this.message.next("")}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var gw=class r{constructor(e,t){this.poseDectectorService=e;this.notification=t;this.refresh=Lh.getInstance()}video=null;videoElement=null;output=null;poses=[];refresh;ngOnInit(){return M(this,null,function*(){this.video&&this.video.subscribe(e=>M(this,null,function*(){this.videoElement=e})),yield this.poseDectectorService.initPoseDetection(),this.startPreview()})}startPreview(){this.refresh.setup(20),this.refresh.render.subscribe(()=>{this.previewPose()}),this.refresh.start()}previewPose(){return M(this,null,function*(){this.check4Errors(),this.videoElement&&this.poseDectectorService.isReady()&&(this.poses=yield this.poseDectectorService.detect(this.videoElement))})}check4Errors(){this.notification.clear();let e=[];this.videoElement||e.push("No video found to estimate poses"),this.poseDectectorService.isReady()||e.push("Pose detector is not ready"),e.length>0&&this.notification.warning(e.join("<br>"))}static \u0275fac=function(t){return new(t||r)(We(D2),We(Sm))};static \u0275cmp=Dt({type:r,selectors:[["app-pose-preview"]],inputs:{video:"video"},standalone:!0,features:[At],decls:2,vars:1,consts:[[3,"poses"]],template:function(t,n){t&1&&(Se(0,"div"),mt(1,"app-pose-drawer",0),Ie()),t&2&&(It(),fr("poses",n.poses))},dependencies:[ao,nk]})};var $Ke=["videoPlayer"],yw=class r{constructor(e){this.notification=e}videoRef=null;selectedCameraID=null;videoReady=new tn;ngAfterViewInit(){return M(this,null,function*(){return this.startVideoStream()})}ngOnChanges(e){return M(this,null,function*(){e.selectedCameraID&&!e.selectedCameraID.isFirstChange()&&(yield this.startVideoStream())})}startVideoStream(){return M(this,null,function*(){if(this.notification.clear(),!this.videoRef||!this.videoRef.nativeElement)return this.notification.warning("Not able to initialize video element"),!1;if(!this.selectedCameraID)return this.notification.warning("No camera selected"),!1;try{let e=this.videoRef.nativeElement,t=yield navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:this.selectedCameraID},width:{ideal:640},height:{ideal:480}},audio:!1}),n=new Promise(o=>{e.onloadedmetadata=()=>{this.videoReady.emit(e),o(!0)}});return e.srcObject=t,n}catch(e){let t="Unable to access the selected camera";return this.notification.warning(t),console.warn(t,e),!1}})}static \u0275fac=function(t){return new(t||r)(We(Sm))};static \u0275cmp=Dt({type:r,selectors:[["app-video-preview"]],viewQuery:function(t,n){if(t&1&&Nx($Ke,5),t&2){let o;ig(o=ag())&&(n.videoRef=o.first)}},inputs:{selectedCameraID:"selectedCameraID"},outputs:{videoReady:"videoReady"},standalone:!0,features:[mc,At],decls:2,vars:0,consts:[["videoPlayer",""],["playsinline","","autoplay","true","width","640","height","480"]],template:function(t,n){t&1&&mt(0,"video",1,0)},dependencies:[ao],styles:["video[_ngcontent-%COMP%]{transform:scaleX(-1)}"]})};var LKe=["dropdown"];function VKe(r,e){r&1&&(Se(0,"span"),Ke(1,"\u2714\uFE0F"),Ie())}function BKe(r,e){if(r&1){let t=ed();Se(0,"li")(1,"a",7),mr("click",function(){let o=_a(t).$implicit,s=Dn();return Sa(s.selectCamera(o.deviceId))}),qn(2,VKe,2,0,"span",8),Ke(3),Ie()()}if(r&2){let t=e.$implicit,n=Dn();It(2),fr("ngIf",t.deviceId===n.selectedCameraID),It(),Ia(t.label)}}var xw=class r{constructor(e){this.notification=e}selectedCameraID=null;cameras=[];cameraSelected=new tn;dropdown;ngOnInit(){return M(this,null,function*(){try{let e=yield navigator.mediaDevices.enumerateDevices();this.cameras=e.filter(t=>t.kind==="videoinput"),this.selectedCameraID||(console.log("No camera selected, preselecting first camera from list"),this.selectCamera(this.cameras[0].deviceId))}catch(e){let t="Not able to initialize video element";this.notification.warning(t),console.warn(t,e)}})}selectCamera(e){this.selectedCameraID=e,this.cameraSelected.emit(e),this.dropdown.nativeElement.open=!1}static \u0275fac=function(t){return new(t||r)(We(Sm))};static \u0275cmp=Dt({type:r,selectors:[["app-video-source-selector"]],viewQuery:function(t,n){if(t&1&&Nx(LKe,5),t&2){let o;ig(o=ag())&&(n.dropdown=o.first)}},inputs:{selectedCameraID:"selectedCameraID"},outputs:{cameraSelected:"cameraSelected"},standalone:!0,features:[At],decls:7,vars:1,consts:[["dropdown",""],[1,"dropdown"],[1,"btn","m-1"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor",1,"size-6"],["stroke-linecap","round","stroke-linejoin","round","d","m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"],[1,"menu","dropdown-content","bg-base-100","rounded-box","z-[1]","w-52","p-2","shadow"],[4,"ngFor","ngForOf"],[3,"click"],[4,"ngIf"]],template:function(t,n){t&1&&(Se(0,"details",1,0)(2,"summary",2),su(),Se(3,"svg",3),mt(4,"path",4),Ie()(),Ch(),Se(5,"ul",5),qn(6,BKe,4,2,"li",6),Ie()()),t&2&&(It(6),fr("ngForOf",n.cameras))},dependencies:[ao,cq,Ci]})};var A2=class r{minutes=0;seconds=0;static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-timer"]],inputs:{minutes:"minutes",seconds:"seconds"},standalone:!0,features:[At],decls:9,vars:6,consts:[[1,"grid","auto-cols-max","grid-flow-col","gap-5","text-center"],[1,"bg-neutral","rounded-box","text-neutral-content","flex","flex-col","p-2"],[1,"countdown","font-mono","text-4xl"]],template:function(t,n){t&1&&(Se(0,"div",0)(1,"div",1)(2,"span",2),mt(3,"span"),Ie(),Ke(4," min "),Ie(),Se(5,"div",1)(6,"span",2),mt(7,"span"),Ie(),Ke(8," sec "),Ie()()),t&2&&(It(3),IP("--value:",n.minutes,";"),It(4),IP("--value:",n.seconds,";"))}})};var Im=class r{SELECTED_CAMERA_KEY="selectedCamera";PARTICIPANT_ID_KEY="gameParticipantId";constructor(){}saveSelectedCamera(e){localStorage.setItem(this.SELECTED_CAMERA_KEY,e)}getSelectedCamera(){return localStorage.getItem(this.SELECTED_CAMERA_KEY)}clearSelectedCamera(){localStorage.removeItem(this.SELECTED_CAMERA_KEY)}saveParticipantId(e){localStorage.setItem(this.PARTICIPANT_ID_KEY,e)}getParticipantId(){let e=localStorage.getItem(this.PARTICIPANT_ID_KEY);return e||(e=crypto.randomUUID(),this.saveParticipantId(e)),e}clearParticipantId(){localStorage.removeItem(this.PARTICIPANT_ID_KEY)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var yS="15.0.4";var Wi=Wp(lU());var $he=()=>new DOMException("","AbortError");var Lhe=r=>(e,t,[n,o,s],i)=>{r(e[o],[t,n,s],a=>a[0]===t&&a[1]===n,i)};var Vhe=r=>(e,t,n)=>{let o=[];for(let s=0;s<n.numberOfInputs;s+=1)o.push(new Set);r.set(e,{activeInputs:o,outputs:new Set,passiveInputs:new WeakMap,renderer:t})};var Bhe=r=>(e,t)=>{r.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})};var Op=new WeakSet,O2=new WeakMap,vw=new WeakMap,M2=new WeakMap,ES=new WeakMap,bw=new WeakMap,F2=new WeakMap,NS=new WeakMap,DS=new WeakMap,AS=new WeakMap;var zhe={construct(){return zhe}},Uhe=r=>{try{let e=new Proxy(r,zhe);new e}catch{return!1}return!0};var Ghe=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,uU=(r,e)=>{let t=[],n=r.replace(/^[\s]+/,""),o=n.match(Ghe);for(;o!==null;){let s=o[1].slice(1,-1),i=o[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,e).toString());t.push(i),n=n.slice(o[0].length).replace(/^[\s]+/,""),o=n.match(Ghe)}return[t.join(";"),n]};var Whe=r=>{if(r!==void 0&&!Array.isArray(r))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},jhe=r=>{if(!Uhe(r))throw new TypeError("The given value for processorCtor should be a constructor.");if(r.prototype===null||typeof r.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},Hhe=(r,e,t,n,o,s,i,a,c,l,u,p,d)=>{let h=0;return(f,m,g={credentials:"omit"})=>{let y=u.get(f);if(y!==void 0&&y.has(m))return Promise.resolve();let x=l.get(f);if(x!==void 0){let _=x.get(m);if(_!==void 0)return _}let b=s(f),w=b.audioWorklet===void 0?o(m).then(([_,I])=>{let[S,k]=uU(_,I),R=`${S};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${k}
})})(window,'_AWGS')`;return t(R)}).then(()=>{let _=d._AWGS.pop();if(_===void 0)throw new SyntaxError;n(b.currentTime,b.sampleRate,()=>_(class{},void 0,(I,S)=>{if(I.trim()==="")throw e();let k=DS.get(b);if(k!==void 0){if(k.has(I))throw e();jhe(S),Whe(S.parameterDescriptors),k.set(I,S)}else jhe(S),Whe(S.parameterDescriptors),DS.set(b,new Map([[I,S]]))},b.sampleRate,void 0,void 0))}):Promise.all([o(m),Promise.resolve(r(p,p))]).then(([[_,I],S])=>{let k=h+1;h=k;let[R,L]=uU(_,I),U=`${R};((AudioWorkletProcessor,registerProcessor)=>{${L}
})(${S?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${S?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${S?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${k}',class extends AudioWorkletProcessor{process(){return !1}})`,G=new Blob([U],{type:"application/javascript; charset=utf-8"}),j=URL.createObjectURL(G);return b.audioWorklet.addModule(j,g).then(()=>{if(a(b))return b;let X=i(b);return X.audioWorklet.addModule(j,g).then(()=>X)}).then(X=>{if(c===null)throw new SyntaxError;try{new c(X,`__sac${k}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(j))});return x===void 0?l.set(f,new Map([[m,w]])):x.set(m,w),w.then(()=>{let _=u.get(f);_===void 0?u.set(f,new Set([m])):_.add(m)}).finally(()=>{let _=l.get(f);_!==void 0&&_.delete(m)}),w}};var Ao=(r,e)=>{let t=r.get(e);if(t===void 0)throw new Error("A value with the given key could not be found.");return t};var Tm=(r,e)=>{let t=Array.from(r).filter(e);if(t.length>1)throw Error("More than one element was found.");if(t.length===0)throw Error("No element was found.");let[n]=t;return r.delete(n),n};var P2=(r,e,t,n)=>{let o=Ao(r,e),s=Tm(o,i=>i[0]===t&&i[1]===n);return o.size===0&&r.delete(e),s};var Mp=r=>Ao(F2,r);var Ll=r=>{if(Op.has(r))throw new Error("The AudioNode is already stored.");Op.add(r),Mp(r).forEach(e=>e(!0))};var $2=r=>"port"in r;var Fp=r=>{if(!Op.has(r))throw new Error("The AudioNode is not stored.");Op.delete(r),Mp(r).forEach(e=>e(!1))};var RS=(r,e)=>{!$2(r)&&e.every(t=>t.size===0)&&Fp(r)};var qhe=(r,e,t,n,o,s,i,a,c,l,u,p,d)=>{let h=new WeakMap;return(f,m,g,y,x)=>{let{activeInputs:b,passiveInputs:w}=s(m),{outputs:_}=s(f),I=a(f),S=k=>{let R=c(m),L=c(f);if(k){let B=P2(w,f,g,y);r(b,f,B,!1),!x&&!p(f)&&t(L,R,g,y),d(m)&&Ll(m)}else{let B=n(b,f,g,y);e(w,y,B,!1),!x&&!p(f)&&o(L,R,g,y);let z=i(m);if(z===0)u(m)&&RS(m,b);else{let q=h.get(m);q!==void 0&&clearTimeout(q),h.set(m,setTimeout(()=>{u(m)&&RS(m,b)},z*1e3))}}};return l(_,[m,g,y],k=>k[0]===m&&k[1]===g&&k[2]===y,!0)?(I.add(S),u(f)?r(b,f,[g,y,S],!0):e(w,y,[f,g,S],!0),!0):!1}};var Khe=r=>(e,t,[n,o,s],i)=>{let a=e.get(n);a===void 0?e.set(n,new Set([[o,t,s]])):r(a,[o,t,s],c=>c[0]===o&&c[1]===t,i)};var Xhe=r=>(e,t)=>{let n=r(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);let o=()=>{t.removeEventListener("ended",o),t.disconnect(n),n.disconnect()};t.addEventListener("ended",o)};var Yhe=r=>(e,t)=>{r(e).add(t)};var o8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},Zhe=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=o(a),u=ie(ie({},o8e),c),p=n(l,u),d=s(l)?e():null;super(a,!1,p,d),this._nativeAnalyserNode=p}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){let c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,t()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){let c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,t()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}};var zr=(r,e)=>r.context===e;var Qhe=(r,e,t)=>()=>{let n=new WeakMap,o=(s,i)=>M(void 0,null,function*(){let a=e(s);if(!zr(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=r(i,l)}return n.set(i,a),yield t(s,i,a),a});return{render(s,i){let a=n.get(i);return a!==void 0?Promise.resolve(a):o(s,i)}}};var ww=r=>{try{r.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0};var tc=()=>new DOMException("","IndexSizeError");var Cw=r=>{r.getChannelData=(e=>t=>{try{return e.call(r,t)}catch(n){throw n.code===12?tc():n}})(r.getChannelData)};var s8e={numberOfChannels:1},Jhe=(r,e,t,n,o,s,i,a)=>{let c=null;return class efe{constructor(u){if(o===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length:p,numberOfChannels:d,sampleRate:h}=ie(ie({},s8e),u);c===null&&(c=new o(1,1,44100));let f=n!==null&&e(s,s)?new n({length:p,numberOfChannels:d,sampleRate:h}):c.createBuffer(d,p,h);if(f.numberOfChannels===0)throw t();return typeof f.copyFromChannel!="function"?(i(f),Cw(f)):e(ww,()=>ww(f))||a(f),r.add(f),f}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===efe.prototype||r.has(u)}}};var po=-34028234663852886e22,no=-po;var si=r=>Op.has(r);var i8e={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},tfe=(r,e,t,n,o,s,i,a)=>class extends r{constructor(l,u){let p=s(l),d=ie(ie({},i8e),u),h=o(p,d),f=i(p),m=f?e():null;super(l,!1,h,m),this._audioBufferSourceNodeRenderer=m,this._isBufferNullified=!1,this._isBufferSet=d.buffer!==null,this._nativeAudioBufferSourceNode=h,this._onended=null,this._playbackRate=t(this,f,h.playbackRate,no,po)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){let u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;let p=this._nativeAudioBufferSourceNode.onended;this._onended=p!==null&&p===u?l:p}get playbackRate(){return this._playbackRate}start(l=0,u=0,p){if(this._nativeAudioBufferSourceNode.start(l,u,p),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=p===void 0?[l,u]:[l,u,p]),this.context.state!=="closed"){Ll(this);let d=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",d),si(this)&&Fp(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",d)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}};var rfe=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=null,a=null,c=(l,u)=>M(void 0,null,function*(){let p=t(l),d=zr(p,u);if(!d){let h={buffer:p.buffer,channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,loop:p.loop,loopEnd:p.loopEnd,loopStart:p.loopStart,playbackRate:p.playbackRate.value};p=e(u,h),i!==null&&p.start(...i),a!==null&&p.stop(a)}return s.set(u,p),d?yield r(u,l.playbackRate,p.playbackRate):yield n(u,l.playbackRate,p.playbackRate),yield o(l,u,p),p});return{set start(l){i=l},set stop(l){a=l},render(l,u){let p=s.get(u);return p!==void 0?Promise.resolve(p):c(l,u)}}};var nfe=r=>"playbackRate"in r;var ofe=r=>"frequency"in r&&"gain"in r;var sfe=r=>"offset"in r;var ife=r=>!("frequency"in r)&&"gain"in r;var afe=r=>"detune"in r&&"frequency"in r&&!("gain"in r);var cfe=r=>"pan"in r;var Ho=r=>Ao(O2,r);var km=r=>Ao(M2,r);var L2=(r,e)=>{let{activeInputs:t}=Ho(r);t.forEach(o=>o.forEach(([s])=>{e.includes(r)||L2(s,[...e,r])}));let n=nfe(r)?[r.playbackRate]:$2(r)?Array.from(r.parameters.values()):ofe(r)?[r.Q,r.detune,r.frequency,r.gain]:sfe(r)?[r.offset]:ife(r)?[r.gain]:afe(r)?[r.detune,r.frequency]:cfe(r)?[r.pan]:[];for(let o of n){let s=km(o);s!==void 0&&s.activeInputs.forEach(([i])=>L2(i,e))}si(r)&&Fp(r)};var Em=r=>{L2(r.destination,[])};var V2=r=>r===void 0||typeof r=="number"||typeof r=="string"&&(r==="balanced"||r==="interactive"||r==="playback");var lfe=(r,e,t,n,o,s,i,a,c)=>class extends r{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let p;try{p=new c(u)}catch(f){throw f.code===12&&f.message==="sampleRate is not in range"?t():f}if(p===null)throw n();if(!V2(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&p.sampleRate!==u.sampleRate)throw t();super(p,2);let{latencyHint:d}=u,{sampleRate:h}=p;if(this._baseLatency=typeof p.baseLatency=="number"?p.baseLatency:d==="balanced"?512/h:d==="interactive"||d===void 0?256/h:d==="playback"?1024/h:Math.max(2,Math.min(128,Math.round(d*h/128)))*128/h,this._nativeAudioContext=p,c.name==="webkitAudioContext"?(this._nativeGainNode=p.createGain(),this._nativeOscillatorNode=p.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(p.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,p.state==="running"){this._state="suspended";let f=()=>{this._state==="suspended"&&(this._state=null),p.removeEventListener("statechange",f)};p.addEventListener("statechange",f)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Em(this)}))}createMediaElementSource(u){return new o(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new i(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,p)=>{let d=()=>{this._nativeAudioContext.removeEventListener("statechange",d),this._nativeAudioContext.state==="running"?u():this.resume().then(u,p)};this._nativeAudioContext.addEventListener("statechange",d)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?e():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?e():u})}};var ufe=(r,e,t,n,o,s,i,a)=>class extends r{constructor(l,u){let p=s(l),d=i(p),h=o(p,u,d),f=d?e(a):null;super(l,!1,h,f),this._isNodeOfNativeOfflineAudioContext=d,this._nativeAudioDestinationNode=h}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw t();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}};var pfe=r=>{let e=new WeakMap,t=(n,o)=>M(void 0,null,function*(){let s=o.destination;return e.set(o,s),yield r(n,o,s),s});return{render(n,o){let s=e.get(o);return s!==void 0?Promise.resolve(s):t(n,o)}}};var dfe=(r,e,t,n,o,s,i,a)=>(c,l)=>{let u=l.listener,p=()=>{let _=new Float32Array(1),I=e(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),S=i(l),k=!1,R=[0,0,-1,0,1,0],L=[0,0,0],B=()=>{if(k)return;k=!0;let G=n(l,256,9,0);G.onaudioprocess=({inputBuffer:j})=>{let X=[s(j,_,0),s(j,_,1),s(j,_,2),s(j,_,3),s(j,_,4),s(j,_,5)];X.some((ne,oe)=>ne!==R[oe])&&(u.setOrientation(...X),R=X);let te=[s(j,_,6),s(j,_,7),s(j,_,8)];te.some((ne,oe)=>ne!==L[oe])&&(u.setPosition(...te),L=te)},I.connect(G)},z=G=>j=>{j!==R[G]&&(R[G]=j,u.setOrientation(...R))},q=G=>j=>{j!==L[G]&&(L[G]=j,u.setPosition(...L))},U=(G,j,X)=>{let te=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:j});te.connect(I,0,G),te.start(),Object.defineProperty(te.offset,"defaultValue",{get(){return j}});let ne=r({context:c},S,te.offset,no,po);return a(ne,"value",oe=>()=>oe.call(ne),oe=>le=>{try{oe.call(ne,le)}catch(xe){if(xe.code!==9)throw xe}B(),S&&X(le)}),ne.cancelAndHoldAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.cancelAndHoldAtTime),ne.cancelScheduledValues=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.cancelScheduledValues),ne.exponentialRampToValueAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.exponentialRampToValueAtTime),ne.linearRampToValueAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.linearRampToValueAtTime),ne.setTargetAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.setTargetAtTime),ne.setValueAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.setValueAtTime),ne.setValueCurveAtTime=(oe=>S?()=>{throw o()}:(...le)=>{let xe=oe.apply(ne,le);return B(),xe})(ne.setValueCurveAtTime),ne};return{forwardX:U(0,0,z(0)),forwardY:U(1,0,z(1)),forwardZ:U(2,-1,z(2)),positionX:U(6,0,q(0)),positionY:U(7,0,q(1)),positionZ:U(8,0,q(2)),upX:U(3,0,z(3)),upY:U(4,1,z(4)),upZ:U(5,0,z(5))}},{forwardX:d,forwardY:h,forwardZ:f,positionX:m,positionY:g,positionZ:y,upX:x,upY:b,upZ:w}=u.forwardX===void 0?p():u;return{get forwardX(){return d},get forwardY(){return h},get forwardZ(){return f},get positionX(){return m},get positionY(){return g},get positionZ(){return y},get upX(){return x},get upY(){return b},get upZ(){return w}}};var $y=r=>"context"in r;var Nm=r=>$y(r[0]);var Vl=(r,e,t,n)=>{for(let o of r)if(t(o)){if(n)return!1;throw Error("The set contains at least one similar element.")}return r.add(e),!0};var pU=(r,e,[t,n],o)=>{Vl(r,[e,t,n],s=>s[0]===e&&s[1]===t,o)};var dU=(r,[e,t,n],o)=>{let s=r.get(e);s===void 0?r.set(e,new Set([[t,n]])):Vl(s,[t,n],i=>i[0]===t,o)};var rc=r=>"inputs"in r;var _w=(r,e,t,n)=>{if(rc(e)){let o=e.inputs[n];return r.connect(o,t,0),[o,t,0]}return r.connect(e,t,n),[e,t,n]};var hU=(r,e,t)=>{for(let n of r)if(n[0]===e&&n[1]===t)return r.delete(n),n;return null};var hfe=(r,e,t)=>Tm(r,n=>n[0]===e&&n[1]===t);var fU=(r,e)=>{if(!Mp(r).delete(e))throw new Error("Missing the expected event listener.")};var mU=(r,e,t)=>{let n=Ao(r,e),o=Tm(n,s=>s[0]===t);return n.size===0&&r.delete(e),o};var Sw=(r,e,t,n)=>{rc(e)?r.disconnect(e.inputs[n],t,0):r.disconnect(e,t,n)};var cn=r=>Ao(vw,r);var Ly=r=>Ao(ES,r);var Jd=r=>NS.has(r);var Iw=r=>!Op.has(r);var gU=(r,e)=>new Promise(t=>{if(e!==null)t(!0);else{let n=r.createScriptProcessor(256,1,1),o=r.createGain(),s=r.createBuffer(1,2,44100),i=s.getChannelData(0);i[0]=1,i[1]=1;let a=r.createBufferSource();a.buffer=s,a.loop=!0,a.connect(n).connect(r.destination),a.connect(o),a.disconnect(o),n.onaudioprocess=c=>{let l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?t(!0):t(!1),a.stop(),n.onaudioprocess=null,a.disconnect(n),n.disconnect(r.destination)},a.start()}});var B2=(r,e)=>{let t=new Map;for(let n of r)for(let o of n){let s=t.get(o);t.set(o,s===void 0?1:s+1)}t.forEach((n,o)=>e(o,n))};var Vy=r=>"context"in r;var ffe=r=>{let e=new Map;r.connect=(t=>(n,o=0,s=0)=>{let i=Vy(n)?t(n,o,s):t(n,o),a=e.get(n);return a===void 0?e.set(n,[{input:s,output:o}]):a.every(c=>c.input!==s||c.output!==o)&&a.push({input:s,output:o}),i})(r.connect.bind(r)),r.disconnect=(t=>(n,o,s)=>{if(t.apply(r),n===void 0)e.clear();else if(typeof n=="number")for(let[i,a]of e){let c=a.filter(l=>l.output!==n);c.length===0?e.delete(i):e.set(i,c)}else if(e.has(n))if(o===void 0)e.delete(n);else{let i=e.get(n);if(i!==void 0){let a=i.filter(c=>c.output!==o&&(c.input!==s||s===void 0));a.length===0?e.delete(n):e.set(n,a)}}for(let[i,a]of e)a.forEach(c=>{Vy(i)?r.connect(i,c.output,c.input):r.connect(i,c.output)})})(r.disconnect)};var a8e=(r,e,t,n)=>{let{activeInputs:o,passiveInputs:s}=km(e),{outputs:i}=Ho(r),a=Mp(r),c=l=>{let u=cn(r),p=Ly(e);if(l){let d=mU(s,r,t);pU(o,r,d,!1),!n&&!Jd(r)&&u.connect(p,t)}else{let d=hfe(o,r,t);dU(s,d,!1),!n&&!Jd(r)&&u.disconnect(p,t)}};return Vl(i,[e,t],l=>l[0]===e&&l[1]===t,!0)?(a.add(c),si(r)?pU(o,r,[t,c],!0):dU(s,[r,t,c],!0),!0):!1},c8e=(r,e,t,n)=>{let{activeInputs:o,passiveInputs:s}=Ho(e),i=hU(o[n],r,t);return i===null?[P2(s,r,t,n)[2],!1]:[i[2],!0]},l8e=(r,e,t)=>{let{activeInputs:n,passiveInputs:o}=km(e),s=hU(n,r,t);return s===null?[mU(o,r,t)[1],!1]:[s[2],!0]},yU=(r,e,t,n,o)=>{let[s,i]=c8e(r,t,n,o);if(s!==null&&(fU(r,s),i&&!e&&!Jd(r)&&Sw(cn(r),cn(t),n,o)),si(t)){let{activeInputs:a}=Ho(t);RS(t,a)}},xU=(r,e,t,n)=>{let[o,s]=l8e(r,t,n);o!==null&&(fU(r,o),s&&!e&&!Jd(r)&&cn(r).disconnect(Ly(t),n))},u8e=(r,e)=>{let t=Ho(r),n=[];for(let o of t.outputs)Nm(o)?yU(r,e,...o):xU(r,e,...o),n.push(o[0]);return t.outputs.clear(),n},p8e=(r,e,t)=>{let n=Ho(r),o=[];for(let s of n.outputs)s[1]===t&&(Nm(s)?yU(r,e,...s):xU(r,e,...s),o.push(s[0]),n.outputs.delete(s));return o},d8e=(r,e,t,n,o)=>{let s=Ho(r);return Array.from(s.outputs).filter(i=>i[0]===t&&(n===void 0||i[1]===n)&&(o===void 0||i[2]===o)).map(i=>(Nm(i)?yU(r,e,...i):xU(r,e,...i),s.outputs.delete(i),i[0]))},mfe=(r,e,t,n,o,s,i,a,c,l,u,p,d,h,f,m)=>class extends l{constructor(y,x,b,w){super(b),this._context=y,this._nativeAudioNode=b;let _=u(y);p(_)&&t(gU,()=>gU(_,m))!==!0&&ffe(b),vw.set(this,b),F2.set(this,new Set),y.state!=="closed"&&x&&Ll(this),r(this,w,b)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,x=0,b=0){if(x<0||x>=this._nativeAudioNode.numberOfOutputs)throw o();let w=u(this._context),_=f(w);if(d(y)||h(y))throw s();if($y(y)){let k=cn(y);try{let L=_w(this._nativeAudioNode,k,x,b),B=Iw(this);(_||B)&&this._nativeAudioNode.disconnect(...L),this.context.state!=="closed"&&!B&&Iw(y)&&Ll(y)}catch(L){throw L.code===12?s():L}if(e(this,y,x,b,_)){let L=c([this],y);B2(L,n(_))}return y}let I=Ly(y);if(I.name==="playbackRate"&&I.maxValue===1024)throw i();try{this._nativeAudioNode.connect(I,x),(_||Iw(this))&&this._nativeAudioNode.disconnect(I,x)}catch(k){throw k.code===12?s():k}if(a8e(this,y,x,_)){let k=c([this],y);B2(k,n(_))}}disconnect(y,x,b){let w,_=u(this._context),I=f(_);if(y===void 0)w=u8e(this,I);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw o();w=p8e(this,I,y)}else{if(x!==void 0&&(x<0||x>=this.numberOfOutputs)||$y(y)&&b!==void 0&&(b<0||b>=y.numberOfInputs))throw o();if(w=d8e(this,I,y,x,b),w.length===0)throw s()}for(let S of w){let k=c([this],S);B2(k,a)}}};var gfe=Wp(lU()),yfe=(r,e,t,n,o,s,i,a,c,l,u,p,d)=>(h,f,m,g=null,y=null)=>{let x=m.value,b=new gfe.AutomationEventList(x),w=f?n(b):null,_={get defaultValue(){return x},get maxValue(){return g===null?m.maxValue:g},get minValue(){return y===null?m.minValue:y},get value(){return m.value},set value(I){m.value=I,_.setValueAtTime(I,h.context.currentTime)},cancelAndHoldAtTime(I){if(typeof m.cancelAndHoldAtTime=="function")w===null&&b.flush(h.context.currentTime),b.add(o(I)),m.cancelAndHoldAtTime(I);else{let S=Array.from(b).pop();w===null&&b.flush(h.context.currentTime),b.add(o(I));let k=Array.from(b).pop();m.cancelScheduledValues(I),S!==k&&k!==void 0&&(k.type==="exponentialRampToValue"?m.exponentialRampToValueAtTime(k.value,k.endTime):k.type==="linearRampToValue"?m.linearRampToValueAtTime(k.value,k.endTime):k.type==="setValue"?m.setValueAtTime(k.value,k.startTime):k.type==="setValueCurve"&&m.setValueCurveAtTime(k.values,k.startTime,k.duration))}return _},cancelScheduledValues(I){return w===null&&b.flush(h.context.currentTime),b.add(s(I)),m.cancelScheduledValues(I),_},exponentialRampToValueAtTime(I,S){if(I===0)throw new RangeError;if(!Number.isFinite(S)||S<0)throw new RangeError;let k=h.context.currentTime;return w===null&&b.flush(k),Array.from(b).length===0&&(b.add(l(x,k)),m.setValueAtTime(x,k)),b.add(i(I,S)),m.exponentialRampToValueAtTime(I,S),_},linearRampToValueAtTime(I,S){let k=h.context.currentTime;return w===null&&b.flush(k),Array.from(b).length===0&&(b.add(l(x,k)),m.setValueAtTime(x,k)),b.add(a(I,S)),m.linearRampToValueAtTime(I,S),_},setTargetAtTime(I,S,k){return w===null&&b.flush(h.context.currentTime),b.add(c(I,S,k)),m.setTargetAtTime(I,S,k),_},setValueAtTime(I,S){return w===null&&b.flush(h.context.currentTime),b.add(l(I,S)),m.setValueAtTime(I,S),_},setValueCurveAtTime(I,S,k){let R=I instanceof Float32Array?I:new Float32Array(I);if(p!==null&&p.name==="webkitAudioContext"){let L=S+k,B=h.context.sampleRate,z=Math.ceil(S*B),q=Math.floor(L*B),U=q-z,G=new Float32Array(U);for(let X=0;X<U;X+=1){let te=(R.length-1)/k*((z+X)/B-S),ne=Math.floor(te),oe=Math.ceil(te);G[X]=ne===oe?R[ne]:(1-(te-ne))*R[ne]+(1-(oe-te))*R[oe]}w===null&&b.flush(h.context.currentTime),b.add(u(G,S,k)),m.setValueCurveAtTime(G,S,k);let j=q/B;j<L&&d(_,G[G.length-1],j),d(_,R[R.length-1],L)}else w===null&&b.flush(h.context.currentTime),b.add(u(R,S,k)),m.setValueCurveAtTime(R,S,k);return _}};return t.set(_,m),e.set(_,h),r(_,w),_};var xfe=r=>({replay(e){for(let t of r)if(t.type==="exponentialRampToValue"){let{endTime:n,value:o}=t;e.exponentialRampToValueAtTime(o,n)}else if(t.type==="linearRampToValue"){let{endTime:n,value:o}=t;e.linearRampToValueAtTime(o,n)}else if(t.type==="setTarget"){let{startTime:n,target:o,timeConstant:s}=t;e.setTargetAtTime(o,n,s)}else if(t.type==="setValue"){let{startTime:n,value:o}=t;e.setValueAtTime(o,n)}else if(t.type==="setValueCurve"){let{duration:n,startTime:o,values:s}=t;e.setValueCurveAtTime(s,o,n)}else throw new Error("Can't apply an unknown automation.")}});var Tw=class{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach((n,o)=>e.call(t,n,o,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}};var h8e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},vfe=(r,e,t,n,o,s,i,a,c,l,u,p,d,h)=>class extends e{constructor(m,g,y){var x;let b=a(m),w=c(b),_=u(ie(ie({},h8e),y));d(_);let I=DS.get(b),S=I?.get(g),k=w||b.state!=="closed"?b:(x=i(b))!==null&&x!==void 0?x:b,R=o(k,w?null:m.baseLatency,l,g,S,_),L=w?n(g,_,S):null;super(m,!0,R,L);let B=[];R.parameters.forEach((q,U)=>{let G=t(this,w,q);B.push([U,G])}),this._nativeAudioWorkletNode=R,this._onprocessorerror=null,this._parameters=new Tw(B),w&&r(b,this);let{activeInputs:z}=s(this);p(R,z)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(m){let g=typeof m=="function"?h(this,m):null;this._nativeAudioWorkletNode.onprocessorerror=g;let y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===g?m:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function kw(r,e,t,n,o){if(typeof r.copyFromChannel=="function")e[t].byteLength===0&&(e[t]=new Float32Array(128)),r.copyFromChannel(e[t],n,o);else{let s=r.getChannelData(n);if(e[t].byteLength===0)e[t]=s.slice(o,o+128);else{let i=new Float32Array(s.buffer,o*Float32Array.BYTES_PER_ELEMENT,128);e[t].set(i)}}}var z2=(r,e,t,n,o)=>{typeof r.copyToChannel=="function"?e[t].byteLength!==0&&r.copyToChannel(e[t],n,o):e[t].byteLength!==0&&r.getChannelData(n).set(e[t],o)};var Ew=(r,e)=>{let t=[];for(let n=0;n<r;n+=1){let o=[],s=typeof e=="number"?e:e[n];for(let i=0;i<s;i+=1)o.push(new Float32Array(128));t.push(o)}return t};var bfe=(r,e)=>{let t=Ao(AS,r),n=cn(e);return Ao(t,n)};var f8e=(r,e,t,n,o,s,i)=>M(void 0,null,function*(){let a=e===null?Math.ceil(r.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,l=o.reduce((g,y)=>g+y,0),u=l===0?null:t.createBuffer(l,a,t.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");let p=Ho(r),d=yield bfe(t,r),h=Ew(n.numberOfInputs,n.channelCount),f=Ew(n.numberOfOutputs,o),m=Array.from(r.parameters.keys()).reduce((g,y)=>$e(ie({},g),{[y]:new Float32Array(128)}),{});for(let g=0;g<a;g+=128){if(n.numberOfInputs>0&&e!==null)for(let y=0;y<n.numberOfInputs;y+=1)for(let x=0;x<n.channelCount;x+=1)kw(e,h[y],x,x,g);s.parameterDescriptors!==void 0&&e!==null&&s.parameterDescriptors.forEach(({name:y},x)=>{kw(e,m,y,c+x,g)});for(let y=0;y<n.numberOfInputs;y+=1)for(let x=0;x<o[y];x+=1)f[y][x].byteLength===0&&(f[y][x]=new Float32Array(128));try{let y=h.map((b,w)=>p.activeInputs[w].size===0?[]:b),x=i(g/t.sampleRate,t.sampleRate,()=>d.process(y,f,m));if(u!==null)for(let b=0,w=0;b<n.numberOfOutputs;b+=1){for(let _=0;_<o[b];_+=1)z2(u,f[b],_,w+_,g);w+=o[b]}if(!x)break}catch(y){r.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u}),wfe=(r,e,t,n,o,s,i,a,c,l,u,p,d,h,f,m)=>(g,y,x)=>{let b=new WeakMap,w=null,_=(I,S)=>M(void 0,null,function*(){let k=u(I),R=null,L=zr(k,S),B=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(p===null){let z=B.reduce((j,X)=>j+X,0),q=o(S,{channelCount:Math.max(1,z),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,z)}),U=[];for(let j=0;j<I.numberOfOutputs;j+=1)U.push(n(S,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:B[j]}));let G=i(S,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});G.connect=e.bind(null,U),G.disconnect=c.bind(null,U),R=[q,U,G]}else L||(k=new p(S,g));if(b.set(S,R===null?k:R[2]),R!==null){if(w===null){if(x===void 0)throw new Error("Missing the processor constructor.");if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");let X=I.channelCount*I.numberOfInputs,te=x.parameterDescriptors===void 0?0:x.parameterDescriptors.length,ne=X+te;w=f8e(I,ne===0?null:yield M(void 0,null,function*(){let le=new d(ne,Math.ceil(I.context.length/128)*128,S.sampleRate),xe=[],ge=[];for(let Ne=0;Ne<y.numberOfInputs;Ne+=1)xe.push(i(le,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),ge.push(o(le,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));let Re=yield Promise.all(Array.from(I.parameters.values()).map(Ne=>M(void 0,null,function*(){let we=s(le,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ne.value});return yield h(le,Ne,we.offset),we}))),Ee=n(le,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,X+te)});for(let Ne=0;Ne<y.numberOfInputs;Ne+=1){xe[Ne].connect(ge[Ne]);for(let we=0;we<y.channelCount;we+=1)ge[Ne].connect(Ee,we,Ne*y.channelCount+we)}for(let[Ne,we]of Re.entries())we.connect(Ee,0,X+Ne),we.start(0);return Ee.connect(le.destination),yield Promise.all(xe.map(Ne=>f(I,le,Ne))),m(le)}),S,y,B,x,l)}let z=yield w,q=t(S,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[U,G,j]=R;z!==null&&(q.buffer=z,q.start(0)),q.connect(U);for(let X=0,te=0;X<I.numberOfOutputs;X+=1){let ne=G[X];for(let oe=0;oe<B[X];oe+=1)U.connect(ne,te+oe,oe);te+=B[X]}return j}if(L)for(let[z,q]of I.parameters.entries())yield r(S,q,k.parameters.get(z));else for(let[z,q]of I.parameters.entries())yield h(S,q,k.parameters.get(z));return yield f(I,S,k),k});return{render(I,S){a(S,I);let k=b.get(S);return k!==void 0?Promise.resolve(k):_(I,S)}}};var Cfe=(r,e,t,n,o,s,i,a,c,l,u,p,d,h,f,m,g,y,x,b)=>class extends f{constructor(_,I){super(_,I),this._nativeContext=_,this._audioWorklet=r===void 0?void 0:{addModule:(S,k)=>r(this,S,k)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new o(this)}createBuffer(_,I,S){return new t({length:I,numberOfChannels:_,sampleRate:S})}createBufferSource(){return new n(this)}createChannelMerger(_=6){return new s(this,{numberOfInputs:_})}createChannelSplitter(_=6){return new i(this,{numberOfOutputs:_})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(_=1){return new u(this,{maxDelayTime:_})}createDynamicsCompressor(){return new p(this)}createGain(){return new d(this)}createIIRFilter(_,I){return new h(this,{feedback:I,feedforward:_})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(_,I,S={disableNormalization:!1}){return new y(this,$e(ie({},S),{imag:I,real:_}))}createStereoPanner(){return new x(this)}createWaveShaper(){return new b(this)}decodeAudioData(_,I,S){return l(this._nativeContext,_).then(k=>(typeof I=="function"&&I(k),k),k=>{throw typeof S=="function"&&S(k),k})}};var m8e={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},_fe=(r,e,t,n,o,s,i,a)=>class extends r{constructor(l,u){let p=s(l),d=ie(ie({},m8e),u),h=o(p,d),f=i(p),m=f?t():null;super(l,!1,h,m),this._Q=e(this,f,h.Q,no,po),this._detune=e(this,f,h.detune,1200*Math.log2(no),-1200*Math.log2(no)),this._frequency=e(this,f,h.frequency,l.sampleRate/2,0),this._gain=e(this,f,h.gain,40*Math.log10(no),po),this._nativeBiquadFilterNode=h,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,p){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,p)}catch(d){throw d.code===11?n():d}if(l.length!==u.length||u.length!==p.length)throw n()}};var Sfe=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=(a,c)=>M(void 0,null,function*(){let l=t(a),u=zr(l,c);if(!u){let p={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(c,p)}return s.set(c,l),u?(yield r(c,a.Q,l.Q),yield r(c,a.detune,l.detune),yield r(c,a.frequency,l.frequency),yield r(c,a.gain,l.gain)):(yield n(c,a.Q,l.Q),yield n(c,a.detune,l.detune),yield n(c,a.frequency,l.frequency),yield n(c,a.gain,l.gain)),yield o(a,c,l),l});return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var Ife=(r,e)=>(t,n)=>{let o=e.get(t);if(o!==void 0)return o;let s=r.get(t);if(s!==void 0)return s;try{let i=n();return i instanceof Promise?(r.set(t,i),i.catch(()=>!1).then(a=>(r.delete(t),e.set(t,a),a))):(e.set(t,i),i)}catch{return e.set(t,!1),!1}};var g8e={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Tfe=(r,e,t,n,o)=>class extends r{constructor(i,a){let c=n(i),l=ie(ie({},g8e),a),u=t(c,l),p=o(c)?e():null;super(i,!1,u,p)}};var kfe=(r,e,t)=>()=>{let n=new WeakMap,o=(s,i)=>M(void 0,null,function*(){let a=e(s);if(!zr(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=r(i,l)}return n.set(i,a),yield t(s,i,a),a});return{render(s,i){let a=n.get(i);return a!==void 0?Promise.resolve(a):o(s,i)}}};var y8e={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Efe=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=n(a),u=s(ie(ie({},y8e),c)),p=t(l,u),d=o(l)?e():null;super(a,!1,p,d)}};var Nfe=(r,e,t)=>()=>{let n=new WeakMap,o=(s,i)=>M(void 0,null,function*(){let a=e(s);if(!zr(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=r(i,l)}return n.set(i,a),yield t(s,i,a),a});return{render(s,i){let a=n.get(i);return a!==void 0?Promise.resolve(a):o(s,i)}}};var Dfe=r=>(e,t,n)=>r(t,e,n);var Afe=r=>(e,t,n=0,o=0)=>{let s=e[n];if(s===void 0)throw r();return Vy(t)?s.connect(t,0,o):s.connect(t,0)};var Rfe=r=>(e,t)=>{let n=r(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=e.createBuffer(1,2,44100);return n.buffer=o,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}};var x8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Ofe=(r,e,t,n,o,s,i)=>class extends r{constructor(c,l){let u=o(c),p=ie(ie({},x8e),l),d=n(u,p),h=s(u),f=h?t():null;super(c,!1,d,f),this._constantSourceNodeRenderer=f,this._nativeConstantSourceNode=d,this._offset=e(this,h,d.offset,no,po),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){let l=typeof c=="function"?i(this,c):null;this._nativeConstantSourceNode.onended=l;let u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Ll(this);let l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),si(this)&&Fp(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}};var Mfe=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=null,a=null,c=(l,u)=>M(void 0,null,function*(){let p=t(l),d=zr(p,u);if(!d){let h={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,offset:p.offset.value};p=e(u,h),i!==null&&p.start(i),a!==null&&p.stop(a)}return s.set(u,p),d?yield r(u,l.offset,p.offset):yield n(u,l.offset,p.offset),yield o(l,u,p),p});return{set start(l){i=l},set stop(l){a=l},render(l,u){let p=s.get(u);return p!==void 0?Promise.resolve(p):c(l,u)}}};var Ffe=r=>e=>(r[0]=e,r[0]);var v8e={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Pfe=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=n(a),u=ie(ie({},v8e),c),p=t(l,u),h=o(l)?e():null;super(a,!1,p,h),this._isBufferNullified=!1,this._nativeConvolverNode=p,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){let c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}};var $fe=(r,e,t)=>()=>{let n=new WeakMap,o=(s,i)=>M(void 0,null,function*(){let a=e(s);if(!zr(a,i)){let l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=r(i,l)}return n.set(i,a),rc(a)?yield t(s,i,a.inputs[0]):yield t(s,i,a),a});return{render(s,i){let a=n.get(i);return a!==void 0?Promise.resolve(a):o(s,i)}}};var Lfe=(r,e)=>(t,n,o)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(t,n,o)}catch(s){throw s.name==="SyntaxError"?r():s}};var Vfe=()=>new DOMException("","DataCloneError");var vU=r=>{let{port1:e,port2:t}=new MessageChannel;return new Promise(n=>{let o=()=>{t.onmessage=null,e.close(),t.close(),n()};t.onmessage=()=>o();try{e.postMessage(r,[r])}catch{}finally{o()}})};var Bfe=(r,e,t,n,o,s,i,a,c,l,u)=>(p,d)=>{let h=i(p)?p:s(p);if(o.has(d)){let f=t();return Promise.reject(f)}try{o.add(d)}catch{}return e(c,()=>c(h))?h.decodeAudioData(d).then(f=>(vU(d).catch(()=>{}),e(a,()=>a(f))||u(f),r.add(f),f)):new Promise((f,m)=>{let g=()=>M(void 0,null,function*(){try{yield vU(d)}catch{}}),y=x=>{m(x),g()};try{h.decodeAudioData(d,x=>{typeof x.copyFromChannel!="function"&&(l(x),Cw(x)),r.add(x),g().then(()=>f(x))},x=>{y(x===null?n():x)})}catch(x){y(x)}})};var zfe=(r,e,t,n,o,s,i,a)=>(c,l)=>{let u=e.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");let p=s(c.context),d=a(p);if(u===l){if(e.delete(c),!d&&i(c)){let h=n(c),{outputs:f}=t(c);for(let m of f)if(Nm(m)){let g=n(m[0]);r(h,g,m[1],m[2])}else{let g=o(m[0]);h.connect(g,m[1])}}}else e.set(c,u-l)};var b8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Ufe=(r,e,t,n,o,s,i)=>class extends r{constructor(c,l){let u=o(c),p=ie(ie({},b8e),l),d=n(u,p),h=s(u),f=h?t(p.maxDelayTime):null;super(c,!1,d,f),this._delayTime=e(this,h,d.delayTime),i(this,p.maxDelayTime)}get delayTime(){return this._delayTime}};var Gfe=(r,e,t,n,o)=>s=>{let i=new WeakMap,a=(c,l)=>M(void 0,null,function*(){let u=t(c),p=zr(u,l);if(!p){let d={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=e(l,d)}return i.set(l,u),p?yield r(l,c.delayTime,u.delayTime):yield n(l,c.delayTime,u.delayTime),yield o(c,l,u),u});return{render(c,l){let u=i.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}};var Wfe=r=>(e,t,n,o)=>r(e[o],s=>s[0]===t&&s[1]===n);var jfe=r=>(e,t)=>{r(e).delete(t)};var Hfe=r=>"delayTime"in r;var qfe=(r,e,t)=>function n(o,s){let i=$y(s)?s:t(r,s);if(Hfe(i))return[];if(o[0]===i)return[o];if(o.includes(i))return[];let{outputs:a}=e(i);return Array.from(a).map(c=>n([...o,i],c[0])).reduce((c,l)=>c.concat(l),[])};var U2=(r,e,t)=>{let n=e[t];if(n===void 0)throw r();return n},Kfe=r=>(e,t=void 0,n=void 0,o=0)=>t===void 0?e.forEach(s=>s.disconnect()):typeof t=="number"?U2(r,e,t).disconnect():Vy(t)?n===void 0?e.forEach(s=>s.disconnect(t)):o===void 0?U2(r,e,n).disconnect(t,0):U2(r,e,n).disconnect(t,0,o):n===void 0?e.forEach(s=>s.disconnect(t)):U2(r,e,n).disconnect(t,0);var w8e={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Xfe=(r,e,t,n,o,s,i,a)=>class extends r{constructor(l,u){let p=s(l),d=ie(ie({},w8e),u),h=n(p,d),f=i(p),m=f?t():null;super(l,!1,h,m),this._attack=e(this,f,h.attack),this._knee=e(this,f,h.knee),this._nativeDynamicsCompressorNode=h,this._ratio=e(this,f,h.ratio),this._release=e(this,f,h.release),this._threshold=e(this,f,h.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){let u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,o()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){let u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,o()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}};var Yfe=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=(a,c)=>M(void 0,null,function*(){let l=t(a),u=zr(l,c);if(!u){let p={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(c,p)}return s.set(c,l),u?(yield r(c,a.attack,l.attack),yield r(c,a.knee,l.knee),yield r(c,a.ratio,l.ratio),yield r(c,a.release,l.release),yield r(c,a.threshold,l.threshold)):(yield n(c,a.attack,l.attack),yield n(c,a.knee,l.knee),yield n(c,a.ratio,l.ratio),yield n(c,a.release,l.release),yield n(c,a.threshold,l.threshold)),yield o(a,c,l),l});return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var Zfe=()=>new DOMException("","EncodingError");var Qfe=r=>e=>new Promise((t,n)=>{if(r===null){n(new SyntaxError);return}let o=r.document.head;if(o===null)n(new SyntaxError);else{let s=r.document.createElement("script"),i=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(i),c=r.onerror,l=()=>{r.onerror=c,URL.revokeObjectURL(a)};r.onerror=(u,p,d,h,f)=>{if(p===a||p===r.location.href&&d===1&&h===1)return l(),n(f),!1;if(c!==null)return c(u,p,d,h,f)},s.onerror=()=>{l(),n(new SyntaxError)},s.onload=()=>{l(),t()},s.src=a,s.type="module",o.appendChild(s)}});var Jfe=r=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,n,o){if(n!==null){let s=this._listeners.get(n);s===void 0&&(s=r(this,n),typeof n=="function"&&this._listeners.set(n,s)),this._nativeEventTarget.addEventListener(t,s,o)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,n,o){let s=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(t,s===void 0?null:s,o)}};var eme=r=>(e,t,n)=>{Object.defineProperties(r,{currentFrame:{configurable:!0,get(){return Math.round(e*t)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{r!==null&&(delete r.currentFrame,delete r.currentTime)}};var tme=r=>e=>M(void 0,null,function*(){try{let t=yield fetch(e);if(t.ok)return[yield t.text(),t.url]}catch{}throw r()});var C8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},rme=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=o(a),u=ie(ie({},C8e),c),p=n(l,u),d=s(l),h=d?t():null;super(a,!1,p,h),this._gain=e(this,d,p.gain,no,po)}get gain(){return this._gain}};var nme=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=(a,c)=>M(void 0,null,function*(){let l=t(a),u=zr(l,c);if(!u){let p={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(c,p)}return s.set(c,l),u?yield r(c,a.gain,l.gain):yield n(c,a.gain,l.gain),yield o(a,c,l),l});return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var ome=(r,e)=>t=>e(r,t);var sme=r=>e=>{let t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer};var ime=r=>e=>{var t;return(t=r.get(e))!==null&&t!==void 0?t:0};var ame=r=>e=>{let t=r(e);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer};var cme=r=>e=>r.get(e);var Bn=()=>new DOMException("","InvalidStateError");var lme=r=>e=>{let t=r.get(e);if(t===void 0)throw Bn();return t};var ume=(r,e)=>t=>{let n=r.get(t);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),r.set(t,n),n};var pme=r=>e=>{let t=r.get(e);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t};var Nw=()=>new DOMException("","InvalidAccessError");var dme=r=>{r.getFrequencyResponse=(e=>(t,n,o)=>{if(t.length!==n.length||n.length!==o.length)throw Nw();return e.call(r,t,n,o)})(r.getFrequencyResponse)};var _8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},hme=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=n(a),u=o(l),p=ie(ie({},_8e),c),d=e(l,u?null:a.baseLatency,p),h=u?t(p.feedback,p.feedforward):null;super(a,!1,d,h),dme(d),this._nativeIIRFilterNode=d,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}};var G2=(r,e,t,n,o,s,i,a,c,l,u)=>{let p=l.length,d=a;for(let h=0;h<p;h+=1){let f=t[0]*l[h];for(let m=1;m<o;m+=1){let g=d-m&c-1;f+=t[m]*s[g],f-=r[m]*i[g]}for(let m=o;m<n;m+=1)f+=t[m]*s[d-m&c-1];for(let m=o;m<e;m+=1)f-=r[m]*i[d-m&c-1];s[d]=l[h],i[d]=f,d=d+1&c-1,u[h]=f}return d};var S8e=(r,e,t,n)=>{let o=t instanceof Float64Array?t:new Float64Array(t),s=n instanceof Float64Array?n:new Float64Array(n),i=o.length,a=s.length,c=Math.min(i,a);if(o[0]!==1){for(let f=0;f<i;f+=1)s[f]/=o[0];for(let f=1;f<a;f+=1)o[f]/=o[0]}let l=32,u=new Float32Array(l),p=new Float32Array(l),d=e.createBuffer(r.numberOfChannels,r.length,r.sampleRate),h=r.numberOfChannels;for(let f=0;f<h;f+=1){let m=r.getChannelData(f),g=d.getChannelData(f);u.fill(0),p.fill(0),G2(o,i,s,a,c,u,p,0,l,m,g)}return d},fme=(r,e,t,n,o)=>(s,i)=>{let a=new WeakMap,c=null,l=(u,p)=>M(void 0,null,function*(){let d=null,h=e(u),f=zr(h,p);if(p.createIIRFilter===void 0?d=r(p,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(h=p.createIIRFilter(i,s)),a.set(p,d===null?h:d),d!==null){if(c===null){if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");let g=new t(u.context.destination.channelCount,u.context.length,p.sampleRate);c=M(void 0,null,function*(){yield n(u,g,g.destination);let y=yield o(g);return S8e(y,p,s,i)})}let m=yield c;return d.buffer=m,d.start(0),d}return yield n(u,p,h),h});return{render(u,p){let d=a.get(p);return d!==void 0?Promise.resolve(d):l(u,p)}}};var mme=(r,e,t,n,o,s)=>i=>(a,c)=>{let l=r.get(a);if(l===void 0){if(!i&&s(a)){let u=n(a),{outputs:p}=t(a);for(let d of p)if(Nm(d)){let h=n(d[0]);e(u,h,d[1],d[2])}else{let h=o(d[0]);u.disconnect(h,d[1])}}r.set(a,c)}else r.set(a,l+c)};var gme=(r,e)=>t=>{let n=r.get(t);return e(n)||e(t)};var yme=(r,e)=>t=>r.has(t)||e(t);var xme=(r,e)=>t=>r.has(t)||e(t);var vme=(r,e)=>t=>{let n=r.get(t);return e(n)||e(t)};var bme=r=>e=>r!==null&&e instanceof r;var wme=r=>e=>r!==null&&typeof r.AudioNode=="function"&&e instanceof r.AudioNode;var Cme=r=>e=>r!==null&&typeof r.AudioParam=="function"&&e instanceof r.AudioParam;var _me=(r,e)=>t=>r(t)||e(t);var Sme=r=>e=>r!==null&&e instanceof r;var Ime=r=>r!==null&&r.isSecureContext;var Tme=(r,e,t,n)=>class extends r{constructor(s,i){let a=t(s),c=e(a,i);if(n(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}};var I8e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},kme=(r,e,t,n)=>class extends r{constructor(s,i){let a=t(s);if(n(a))throw new TypeError;let c=ie(ie({},I8e),i),l=e(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}};var Eme=(r,e,t,n)=>class extends r{constructor(s,i){let a=t(s),c=e(a,i);if(n(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}};var Nme=(r,e,t)=>class extends r{constructor(o,s){let i=t(o),a=e(i,s);super(o,!0,a,null)}};var Dme=(r,e,t,n,o)=>class extends n{constructor(i={}){if(o===null)throw new Error("Missing the native AudioContext constructor.");let a;try{a=new o(i)}catch(u){throw u.code===12&&u.message==="sampleRate is not in range"?e():u}if(a===null)throw t();if(!V2(i.latencyHint))throw new TypeError(`The provided value '${i.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(i.sampleRate!==void 0&&a.sampleRate!==i.sampleRate)throw e();super(a,2);let{latencyHint:c}=i,{sampleRate:l}=a;if(this._baseLatency=typeof a.baseLatency=="number"?a.baseLatency:c==="balanced"?512/l:c==="interactive"||c===void 0?256/l:c==="playback"?1024/l:Math.max(2,Math.min(128,Math.round(c*l/128)))*128/l,this._nativeAudioContext=a,o.name==="webkitAudioContext"?(this._nativeGainNode=a.createGain(),this._nativeOscillatorNode=a.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(a.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,a.state==="running"){this._state="suspended";let u=()=>{this._state==="suspended"&&(this._state=null),a.removeEventListener("statechange",u)};a.addEventListener("statechange",u)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw r()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Em(this)}))}resume(){return this._state==="suspended"?new Promise((i,a)=>{let c=()=>{this._nativeAudioContext.removeEventListener("statechange",c),this._nativeAudioContext.state==="running"?i():this.resume().then(i,a)};this._nativeAudioContext.addEventListener("statechange",c)}):this._nativeAudioContext.resume().catch(i=>{throw i===void 0||i.code===15?r():i})}suspend(){return this._nativeAudioContext.suspend().catch(i=>{throw i===void 0?r():i})}};var Ame=(r,e,t,n,o,s)=>class extends t{constructor(a,c){super(a),this._nativeContext=a,bw.set(this,a),n(a)&&o.set(a,new Set),this._destination=new r(this,c),this._listener=e(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){let c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;let l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}};var Bl=r=>{let e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let t=r.decodeAudioData(e.buffer,()=>{});return t===void 0?!1:(t.catch(()=>{}),!0)}catch{}return!1};var T8e={numberOfChannels:1},Rme=(r,e,t,n,o)=>class extends n{constructor(i){let{length:a,numberOfChannels:c,sampleRate:l}=ie(ie({},T8e),i),u=t(c,a,l);r(Bl,()=>Bl(u))||u.addEventListener("statechange",(()=>{let p=0,d=h=>{this._state==="running"&&(p>0?(u.removeEventListener("statechange",d),h.stopImmediatePropagation(),this._waitForThePromiseToSettle(h)):p+=1)};return d})()),super(u,c),this._length=a,this._nativeOfflineAudioContext=u,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(e()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Em(this)}))}_waitForThePromiseToSettle(i){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(i):setTimeout(()=>this._waitForThePromiseToSettle(i))}};var Ome=(r,e)=>(t,n,o)=>{let s=new Set;return t.connect=(i=>(a,c=0,l=0)=>{let u=s.size===0;if(e(a))return i.call(t,a,c,l),r(s,[a,c,l],p=>p[0]===a&&p[1]===c&&p[2]===l,!0),u&&n(),a;i.call(t,a,c),r(s,[a,c],p=>p[0]===a&&p[1]===c,!0),u&&n()})(t.connect),t.disconnect=(i=>(a,c,l)=>{let u=s.size>0;if(a===void 0)i.apply(t),s.clear();else if(typeof a=="number"){i.call(t,a);for(let d of s)d[1]===a&&s.delete(d)}else{e(a)?i.call(t,a,c,l):i.call(t,a,c);for(let d of s)d[0]===a&&(c===void 0||d[1]===c)&&(l===void 0||d[2]===l)&&s.delete(d)}let p=s.size===0;u&&p&&o()})(t.disconnect),t};var Ur=(r,e,t)=>{let n=e[t];n!==void 0&&n!==r[t]&&(r[t]=n)};var pr=(r,e)=>{Ur(r,e,"channelCount"),Ur(r,e,"channelCountMode"),Ur(r,e,"channelInterpretation")};var bU=r=>typeof r.getFloatTimeDomainData=="function";var Mme=r=>{r.getFloatTimeDomainData=e=>{let t=new Uint8Array(e.length);r.getByteTimeDomainData(t);let n=Math.max(t.length,r.fftSize);for(let o=0;o<n;o+=1)e[o]=(t[o]-128)*.0078125;return e}};var Fme=(r,e)=>(t,n)=>{let o=t.createAnalyser();if(pr(o,n),!(n.maxDecibels>n.minDecibels))throw e();return Ur(o,n,"fftSize"),Ur(o,n,"maxDecibels"),Ur(o,n,"minDecibels"),Ur(o,n,"smoothingTimeConstant"),r(bU,()=>bU(o))||Mme(o),o};var Pme=r=>r===null?null:r.hasOwnProperty("AudioBuffer")?r.AudioBuffer:null;var Xr=(r,e,t)=>{let n=e[t];n!==void 0&&n!==r[t].value&&(r[t].value=n)};var $me=r=>{r.start=(e=>{let t=!1;return(n=0,o=0,s)=>{if(t)throw Bn();e.call(r,n,o,s),t=!0}})(r.start)};var Dw=r=>{r.start=(e=>(t=0,n=0,o)=>{if(typeof o=="number"&&o<0||n<0||t<0)throw new RangeError("The parameters can't be negative.");e.call(r,t,n,o)})(r.start)};var Aw=r=>{r.stop=(e=>(t=0)=>{if(t<0)throw new RangeError("The parameter can't be negative.");e.call(r,t)})(r.stop)};var Lme=(r,e,t,n,o,s,i,a,c,l,u)=>(p,d)=>{let h=p.createBufferSource();return pr(h,d),Xr(h,d,"playbackRate"),Ur(h,d,"buffer"),Ur(h,d,"loop"),Ur(h,d,"loopEnd"),Ur(h,d,"loopStart"),e(t,()=>t(p))||$me(h),e(n,()=>n(p))||c(h),e(o,()=>o(p))||l(h,p),e(s,()=>s(p))||Dw(h),e(i,()=>i(p))||u(h,p),e(a,()=>a(p))||Aw(h),r(p,h),h};var Vme=r=>r===null?null:r.hasOwnProperty("AudioContext")?r.AudioContext:r.hasOwnProperty("webkitAudioContext")?r.webkitAudioContext:null;var Bme=(r,e)=>(t,n,o)=>{let s=t.destination;if(s.channelCount!==n)try{s.channelCount=n}catch{}o&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:n});let i=r(t,{channelCount:n,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(i,"channelCount",a=>()=>a.call(i),a=>c=>{a.call(i,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),e(i,"channelCountMode",a=>()=>a.call(i),a=>c=>{a.call(i,c),s.channelCountMode=c}),e(i,"channelInterpretation",a=>()=>a.call(i),a=>c=>{a.call(i,c),s.channelInterpretation=c}),Object.defineProperty(i,"maxChannelCount",{get:()=>s.maxChannelCount}),i.connect(s),i};var zme=r=>r===null?null:r.hasOwnProperty("AudioWorkletNode")?r.AudioWorkletNode:null;var Ume=r=>{let{port1:e}=new MessageChannel;try{e.postMessage(r)}finally{e.close()}};var Gme=(r,e,t,n,o)=>(s,i,a,c,l,u)=>{if(a!==null)try{let p=new a(s,c,u),d=new Map,h=null;if(Object.defineProperties(p,{channelCount:{get:()=>u.channelCount,set:()=>{throw r()}},channelCountMode:{get:()=>"explicit",set:()=>{throw r()}},onprocessorerror:{get:()=>h,set:f=>{typeof h=="function"&&p.removeEventListener("processorerror",h),h=typeof f=="function"?f:null,typeof h=="function"&&p.addEventListener("processorerror",h)}}}),p.addEventListener=(f=>(...m)=>{if(m[0]==="processorerror"){let g=typeof m[1]=="function"?m[1]:typeof m[1]=="object"&&m[1]!==null&&typeof m[1].handleEvent=="function"?m[1].handleEvent:null;if(g!==null){let y=d.get(m[1]);y!==void 0?m[1]=y:(m[1]=x=>{x.type==="error"?(Object.defineProperties(x,{type:{value:"processorerror"}}),g(x)):g(new ErrorEvent(m[0],ie({},x)))},d.set(g,m[1]))}}return f.call(p,"error",m[1],m[2]),f.call(p,...m)})(p.addEventListener),p.removeEventListener=(f=>(...m)=>{if(m[0]==="processorerror"){let g=d.get(m[1]);g!==void 0&&(d.delete(m[1]),m[1]=g)}return f.call(p,"error",m[1],m[2]),f.call(p,m[0],m[1],m[2])})(p.removeEventListener),u.numberOfOutputs!==0){let f=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return p.connect(f).connect(s.destination),o(p,()=>f.disconnect(),()=>f.connect(s.destination))}return p}catch(p){throw p.code===11?n():p}if(l===void 0)throw n();return Ume(u),e(s,i,l,u)};var W2=(r,e)=>r===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(r*e)))));var Wme=r=>new Promise((e,t)=>{let{port1:n,port2:o}=new MessageChannel;n.onmessage=({data:s})=>{n.close(),o.close(),e(s)},n.onmessageerror=({data:s})=>{n.close(),o.close(),t(s)},o.postMessage(r)});var jme=(r,e)=>M(void 0,null,function*(){let t=yield Wme(e);return new r(t)});var Hme=(r,e,t,n)=>{let o=AS.get(r);o===void 0&&(o=new WeakMap,AS.set(r,o));let s=jme(t,n);return o.set(e,s),s};var qme=(r,e,t,n,o,s,i,a,c,l,u,p,d)=>(h,f,m,g)=>{if(g.numberOfInputs===0&&g.numberOfOutputs===0)throw c();let y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some(_e=>_e<1))throw c();if(y.length!==g.numberOfOutputs)throw e();if(g.channelCountMode!=="explicit")throw c();let x=g.channelCount*g.numberOfInputs,b=y.reduce((_e,Ae)=>_e+Ae,0),w=m.parameterDescriptors===void 0?0:m.parameterDescriptors.length;if(x+w>6||b>6)throw c();let _=new MessageChannel,I=[],S=[];for(let _e=0;_e<g.numberOfInputs;_e+=1)I.push(i(h,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),S.push(o(h,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));let k=[];if(m.parameterDescriptors!==void 0)for(let{defaultValue:_e,maxValue:Ae,minValue:wt,name:xt}of m.parameterDescriptors){let zt=s(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:g.parameterData[xt]!==void 0?g.parameterData[xt]:_e===void 0?0:_e});Object.defineProperties(zt.offset,{defaultValue:{get:()=>_e===void 0?0:_e},maxValue:{get:()=>Ae===void 0?no:Ae},minValue:{get:()=>wt===void 0?po:wt}}),k.push(zt)}let R=n(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,x+w)}),L=W2(f,h.sampleRate),B=a(h,L,x+w,Math.max(1,b)),z=o(h,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),q=[];for(let _e=0;_e<g.numberOfOutputs;_e+=1)q.push(n(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[_e]}));for(let _e=0;_e<g.numberOfInputs;_e+=1){I[_e].connect(S[_e]);for(let Ae=0;Ae<g.channelCount;Ae+=1)S[_e].connect(R,Ae,_e*g.channelCount+Ae)}let U=new Tw(m.parameterDescriptors===void 0?[]:m.parameterDescriptors.map(({name:_e},Ae)=>{let wt=k[Ae];return wt.connect(R,0,x+Ae),wt.start(0),[_e,wt.offset]}));R.connect(B);let G=g.channelInterpretation,j=null,X=g.numberOfOutputs===0?[B]:q,te={get bufferSize(){return L},get channelCount(){return g.channelCount},set channelCount(_e){throw t()},get channelCountMode(){return g.channelCountMode},set channelCountMode(_e){throw t()},get channelInterpretation(){return G},set channelInterpretation(_e){for(let Ae of I)Ae.channelInterpretation=_e;G=_e},get context(){return B.context},get inputs(){return I},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return j},set onprocessorerror(_e){typeof j=="function"&&te.removeEventListener("processorerror",j),j=typeof _e=="function"?_e:null,typeof j=="function"&&te.addEventListener("processorerror",j)},get parameters(){return U},get port(){return _.port2},addEventListener(..._e){return B.addEventListener(_e[0],_e[1],_e[2])},connect:r.bind(null,X),disconnect:l.bind(null,X),dispatchEvent(..._e){return B.dispatchEvent(_e[0])},removeEventListener(..._e){return B.removeEventListener(_e[0],_e[1],_e[2])}},ne=new Map;_.port1.addEventListener=(_e=>(...Ae)=>{if(Ae[0]==="message"){let wt=typeof Ae[1]=="function"?Ae[1]:typeof Ae[1]=="object"&&Ae[1]!==null&&typeof Ae[1].handleEvent=="function"?Ae[1].handleEvent:null;if(wt!==null){let xt=ne.get(Ae[1]);xt!==void 0?Ae[1]=xt:(Ae[1]=zt=>{u(h.currentTime,h.sampleRate,()=>wt(zt))},ne.set(wt,Ae[1]))}}return _e.call(_.port1,Ae[0],Ae[1],Ae[2])})(_.port1.addEventListener),_.port1.removeEventListener=(_e=>(...Ae)=>{if(Ae[0]==="message"){let wt=ne.get(Ae[1]);wt!==void 0&&(ne.delete(Ae[1]),Ae[1]=wt)}return _e.call(_.port1,Ae[0],Ae[1],Ae[2])})(_.port1.removeEventListener);let oe=null;Object.defineProperty(_.port1,"onmessage",{get:()=>oe,set:_e=>{typeof oe=="function"&&_.port1.removeEventListener("message",oe),oe=typeof _e=="function"?_e:null,typeof oe=="function"&&(_.port1.addEventListener("message",oe),_.port1.start())}}),m.prototype.port=_.port1;let le=null;Hme(h,te,m,g).then(_e=>le=_e);let ge=Ew(g.numberOfInputs,g.channelCount),Re=Ew(g.numberOfOutputs,y),Ee=m.parameterDescriptors===void 0?[]:m.parameterDescriptors.reduce((_e,{name:Ae})=>$e(ie({},_e),{[Ae]:new Float32Array(128)}),{}),Ne=!0,we=()=>{g.numberOfOutputs>0&&B.disconnect(z);for(let _e=0,Ae=0;_e<g.numberOfOutputs;_e+=1){let wt=q[_e];for(let xt=0;xt<y[_e];xt+=1)z.disconnect(wt,Ae+xt,xt);Ae+=y[_e]}},qe=new Map;B.onaudioprocess=({inputBuffer:_e,outputBuffer:Ae})=>{if(le!==null){let wt=p(te);for(let xt=0;xt<L;xt+=128){for(let zt=0;zt<g.numberOfInputs;zt+=1)for(let Ut=0;Ut<g.channelCount;Ut+=1)kw(_e,ge[zt],Ut,Ut,xt);m.parameterDescriptors!==void 0&&m.parameterDescriptors.forEach(({name:zt},Ut)=>{kw(_e,Ee,zt,x+Ut,xt)});for(let zt=0;zt<g.numberOfInputs;zt+=1)for(let Ut=0;Ut<y[zt];Ut+=1)Re[zt][Ut].byteLength===0&&(Re[zt][Ut]=new Float32Array(128));try{let zt=ge.map((Ln,wn)=>{if(wt[wn].size>0)return qe.set(wn,L/128),Ln;let zn=qe.get(wn);return zn===void 0?[]:(Ln.every(hi=>hi.every(Bs=>Bs===0))&&(zn===1?qe.delete(wn):qe.set(wn,zn-1)),Ln)});Ne=u(h.currentTime+xt/h.sampleRate,h.sampleRate,()=>le.process(zt,Re,Ee));for(let Ln=0,wn=0;Ln<g.numberOfOutputs;Ln+=1){for(let xs=0;xs<y[Ln];xs+=1)z2(Ae,Re[Ln],xs,wn+xs,xt);wn+=y[Ln]}}catch(zt){Ne=!1,te.dispatchEvent(new ErrorEvent("processorerror",{colno:zt.colno,filename:zt.filename,lineno:zt.lineno,message:zt.message}))}if(!Ne){for(let zt=0;zt<g.numberOfInputs;zt+=1){I[zt].disconnect(S[zt]);for(let Ut=0;Ut<g.channelCount;Ut+=1)S[xt].disconnect(R,Ut,zt*g.channelCount+Ut)}if(m.parameterDescriptors!==void 0){let zt=m.parameterDescriptors.length;for(let Ut=0;Ut<zt;Ut+=1){let Ln=k[Ut];Ln.disconnect(R,0,x+Ut),Ln.stop()}}R.disconnect(B),B.onaudioprocess=null,Qe?we():dt();break}}}};let Qe=!1,De=i(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Me=()=>B.connect(De).connect(h.destination),dt=()=>{B.disconnect(De),De.disconnect()},Be=()=>{if(Ne){dt(),g.numberOfOutputs>0&&B.connect(z);for(let _e=0,Ae=0;_e<g.numberOfOutputs;_e+=1){let wt=q[_e];for(let xt=0;xt<y[_e];xt+=1)z.connect(wt,Ae+xt,xt);Ae+=y[_e]}}Qe=!0},at=()=>{Ne&&(Me(),we()),Qe=!1};return Me(),d(te,Be,at)};var wU=(r,e)=>{let t=r.createBiquadFilter();return pr(t,e),Xr(t,e,"Q"),Xr(t,e,"detune"),Xr(t,e,"frequency"),Xr(t,e,"gain"),Ur(t,e,"type"),t};var Kme=(r,e)=>(t,n)=>{let o=t.createChannelMerger(n.numberOfInputs);return r!==null&&r.name==="webkitAudioContext"&&e(t,o),pr(o,n),o};var Xme=r=>{let e=r.numberOfOutputs;Object.defineProperty(r,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw Bn()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:t=>{if(t!=="explicit")throw Bn()}}),Object.defineProperty(r,"channelInterpretation",{get:()=>"discrete",set:t=>{if(t!=="discrete")throw Bn()}})};var Rw=(r,e)=>{let t=r.createChannelSplitter(e.numberOfOutputs);return pr(t,e),Xme(t),t};var Yme=(r,e,t,n,o)=>(s,i)=>{if(s.createConstantSource===void 0)return t(s,i);let a=s.createConstantSource();return pr(a,i),Xr(a,i,"offset"),e(n,()=>n(s))||Dw(a),e(o,()=>o(s))||Aw(a),r(s,a),a};var nc=(r,e)=>(r.connect=e.connect.bind(e),r.disconnect=e.disconnect.bind(e),r);var Zme=(r,e,t,n)=>(o,a)=>{var c=a,{offset:s}=c,i=ah(c,["offset"]);let l=o.createBuffer(1,2,44100),u=e(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),p=t(o,$e(ie({},i),{gain:s})),d=l.getChannelData(0);d[0]=1,d[1]=1,u.buffer=l,u.loop=!0;let h={get bufferSize(){},get channelCount(){return p.channelCount},set channelCount(g){p.channelCount=g},get channelCountMode(){return p.channelCountMode},set channelCountMode(g){p.channelCountMode=g},get channelInterpretation(){return p.channelInterpretation},set channelInterpretation(g){p.channelInterpretation=g},get context(){return p.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return p.numberOfOutputs},get offset(){return p.gain},get onended(){return u.onended},set onended(g){u.onended=g},addEventListener(...g){return u.addEventListener(g[0],g[1],g[2])},dispatchEvent(...g){return u.dispatchEvent(g[0])},removeEventListener(...g){return u.removeEventListener(g[0],g[1],g[2])},start(g=0){u.start.call(u,g)},stop(g=0){u.stop.call(u,g)}},f=()=>u.connect(p),m=()=>u.disconnect(p);return r(o,u),n(nc(h,p),f,m)};var Qme=(r,e)=>(t,n)=>{let o=t.createConvolver();if(pr(o,n),n.disableNormalization===o.normalize&&(o.normalize=!n.disableNormalization),Ur(o,n,"buffer"),n.channelCount>2||(e(o,"channelCount",s=>()=>s.call(o),s=>i=>{if(i>2)throw r();return s.call(o,i)}),n.channelCountMode==="max"))throw r();return e(o,"channelCountMode",s=>()=>s.call(o),s=>i=>{if(i==="max")throw r();return s.call(o,i)}),o};var CU=(r,e)=>{let t=r.createDelay(e.maxDelayTime);return pr(t,e),Xr(t,e,"delayTime"),t};var Jme=r=>(e,t)=>{let n=e.createDynamicsCompressor();if(pr(n,t),t.channelCount>2||t.channelCountMode==="max")throw r();return Xr(n,t,"attack"),Xr(n,t,"knee"),Xr(n,t,"ratio"),Xr(n,t,"release"),Xr(n,t,"threshold"),n};var ii=(r,e)=>{let t=r.createGain();return pr(t,e),Xr(t,e,"gain"),t};var ege=r=>(e,t,n)=>{if(e.createIIRFilter===void 0)return r(e,t,n);let o=e.createIIRFilter(n.feedforward,n.feedback);return pr(o,n),o};function k8e(r,e){let t=e[0]*e[0]+e[1]*e[1];return[(r[0]*e[0]+r[1]*e[1])/t,(r[1]*e[0]-r[0]*e[1])/t]}function E8e(r,e){return[r[0]*e[0]-r[1]*e[1],r[0]*e[1]+r[1]*e[0]]}function tge(r,e){let t=[0,0];for(let n=r.length-1;n>=0;n-=1)t=E8e(t,e),t[0]+=r[n];return t}var rge=(r,e,t,n)=>(o,s,{channelCount:i,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{let p=W2(s,o.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),h=u instanceof Float64Array?u:new Float64Array(u),f=d.length,m=h.length,g=Math.min(f,m);if(f===0||f>20)throw n();if(d[0]===0)throw e();if(m===0||m>20)throw n();if(h[0]===0)throw e();if(d[0]!==1){for(let k=0;k<m;k+=1)h[k]/=d[0];for(let k=1;k<f;k+=1)d[k]/=d[0]}let y=t(o,p,i,i);y.channelCount=i,y.channelCountMode=a,y.channelInterpretation=c;let x=32,b=[],w=[],_=[];for(let k=0;k<i;k+=1){b.push(0);let R=new Float32Array(x),L=new Float32Array(x);R.fill(0),L.fill(0),w.push(R),_.push(L)}y.onaudioprocess=k=>{let R=k.inputBuffer,L=k.outputBuffer,B=R.numberOfChannels;for(let z=0;z<B;z+=1){let q=R.getChannelData(z),U=L.getChannelData(z);b[z]=G2(d,f,h,m,g,w[z],_[z],b[z],x,q,U)}};let I=o.sampleRate/2;return nc({get bufferSize(){return p},get channelCount(){return y.channelCount},set channelCount(k){y.channelCount=k},get channelCountMode(){return y.channelCountMode},set channelCountMode(k){y.channelCountMode=k},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(k){y.channelInterpretation=k},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...k){return y.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return y.dispatchEvent(k[0])},getFrequencyResponse(k,R,L){if(k.length!==R.length||R.length!==L.length)throw r();let B=k.length;for(let z=0;z<B;z+=1){let q=-Math.PI*(k[z]/I),U=[Math.cos(q),Math.sin(q)],G=tge(h,U),j=tge(d,U),X=k8e(G,j);R[z]=Math.sqrt(X[0]*X[0]+X[1]*X[1]),L[z]=Math.atan2(X[1],X[0])}},removeEventListener(...k){return y.removeEventListener(k[0],k[1],k[2])}},y)};var nge=(r,e)=>r.createMediaElementSource(e.mediaElement);var oge=(r,e)=>{let t=r.createMediaStreamDestination();return pr(t,e),t.numberOfOutputs===1&&Object.defineProperty(t,"numberOfOutputs",{get:()=>0}),t};var sge=(r,{mediaStream:e})=>{let t=e.getAudioTracks();t.sort((s,i)=>s.id<i.id?-1:s.id>i.id?1:0);let n=t.slice(0,1),o=r.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(o,"mediaStream",{value:e}),o};var ige=(r,e)=>(t,{mediaStreamTrack:n})=>{if(typeof t.createMediaStreamTrackSource=="function")return t.createMediaStreamTrackSource(n);let o=new MediaStream([n]),s=t.createMediaStreamSource(o);if(n.kind!=="audio")throw r();if(e(t))throw new TypeError;return s};var age=r=>r===null?null:r.hasOwnProperty("OfflineAudioContext")?r.OfflineAudioContext:r.hasOwnProperty("webkitOfflineAudioContext")?r.webkitOfflineAudioContext:null;var cge=(r,e,t,n,o,s)=>(i,a)=>{let c=i.createOscillator();return pr(c,a),Xr(c,a,"detune"),Xr(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):Ur(c,a,"type"),e(t,()=>t(i))||Dw(c),e(n,()=>n(i))||s(c,i),e(o,()=>o(i))||Aw(c),r(i,c),c};var lge=r=>(e,t)=>{let n=e.createPanner();return n.orientationX===void 0?r(e,t):(pr(n,t),Xr(n,t,"orientationX"),Xr(n,t,"orientationY"),Xr(n,t,"orientationZ"),Xr(n,t,"positionX"),Xr(n,t,"positionY"),Xr(n,t,"positionZ"),Ur(n,t,"coneInnerAngle"),Ur(n,t,"coneOuterAngle"),Ur(n,t,"coneOuterGain"),Ur(n,t,"distanceModel"),Ur(n,t,"maxDistance"),Ur(n,t,"panningModel"),Ur(n,t,"refDistance"),Ur(n,t,"rolloffFactor"),n)};var uge=(r,e,t,n,o,s,i,a,c,l)=>(u,L)=>{var B=L,{coneInnerAngle:p,coneOuterAngle:d,coneOuterGain:h,distanceModel:f,maxDistance:m,orientationX:g,orientationY:y,orientationZ:x,panningModel:b,positionX:w,positionY:_,positionZ:I,refDistance:S,rolloffFactor:k}=B,R=ah(B,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);let z=u.createPanner();if(R.channelCount>2||R.channelCountMode==="max")throw i();pr(z,R);let q={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},U=t(u,$e(ie({},q),{channelInterpretation:"speakers",numberOfInputs:6})),G=n(u,$e(ie({},R),{gain:1})),j=n(u,$e(ie({},q),{gain:1})),X=n(u,$e(ie({},q),{gain:0})),te=n(u,$e(ie({},q),{gain:0})),ne=n(u,$e(ie({},q),{gain:0})),oe=n(u,$e(ie({},q),{gain:0})),le=n(u,$e(ie({},q),{gain:0})),xe=o(u,256,6,1),ge=s(u,$e(ie({},q),{curve:new Float32Array([1,1]),oversample:"none"})),Re=[g,y,x],Ee=[w,_,I],Ne=new Float32Array(1);xe.onaudioprocess=({inputBuffer:De})=>{let Me=[c(De,Ne,0),c(De,Ne,1),c(De,Ne,2)];Me.some((Be,at)=>Be!==Re[at])&&(z.setOrientation(...Me),Re=Me);let dt=[c(De,Ne,3),c(De,Ne,4),c(De,Ne,5)];dt.some((Be,at)=>Be!==Ee[at])&&(z.setPosition(...dt),Ee=dt)},Object.defineProperty(X.gain,"defaultValue",{get:()=>0}),Object.defineProperty(te.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ne.gain,"defaultValue",{get:()=>0}),Object.defineProperty(oe.gain,"defaultValue",{get:()=>0}),Object.defineProperty(le.gain,"defaultValue",{get:()=>0});let we={get bufferSize(){},get channelCount(){return z.channelCount},set channelCount(De){if(De>2)throw i();G.channelCount=De,z.channelCount=De},get channelCountMode(){return z.channelCountMode},set channelCountMode(De){if(De==="max")throw i();G.channelCountMode=De,z.channelCountMode=De},get channelInterpretation(){return z.channelInterpretation},set channelInterpretation(De){G.channelInterpretation=De,z.channelInterpretation=De},get coneInnerAngle(){return z.coneInnerAngle},set coneInnerAngle(De){z.coneInnerAngle=De},get coneOuterAngle(){return z.coneOuterAngle},set coneOuterAngle(De){z.coneOuterAngle=De},get coneOuterGain(){return z.coneOuterGain},set coneOuterGain(De){if(De<0||De>1)throw e();z.coneOuterGain=De},get context(){return z.context},get distanceModel(){return z.distanceModel},set distanceModel(De){z.distanceModel=De},get inputs(){return[G]},get maxDistance(){return z.maxDistance},set maxDistance(De){if(De<0)throw new RangeError;z.maxDistance=De},get numberOfInputs(){return z.numberOfInputs},get numberOfOutputs(){return z.numberOfOutputs},get orientationX(){return j.gain},get orientationY(){return X.gain},get orientationZ(){return te.gain},get panningModel(){return z.panningModel},set panningModel(De){z.panningModel=De},get positionX(){return ne.gain},get positionY(){return oe.gain},get positionZ(){return le.gain},get refDistance(){return z.refDistance},set refDistance(De){if(De<0)throw new RangeError;z.refDistance=De},get rolloffFactor(){return z.rolloffFactor},set rolloffFactor(De){if(De<0)throw new RangeError;z.rolloffFactor=De},addEventListener(...De){return G.addEventListener(De[0],De[1],De[2])},dispatchEvent(...De){return G.dispatchEvent(De[0])},removeEventListener(...De){return G.removeEventListener(De[0],De[1],De[2])}};p!==we.coneInnerAngle&&(we.coneInnerAngle=p),d!==we.coneOuterAngle&&(we.coneOuterAngle=d),h!==we.coneOuterGain&&(we.coneOuterGain=h),f!==we.distanceModel&&(we.distanceModel=f),m!==we.maxDistance&&(we.maxDistance=m),g!==we.orientationX.value&&(we.orientationX.value=g),y!==we.orientationY.value&&(we.orientationY.value=y),x!==we.orientationZ.value&&(we.orientationZ.value=x),b!==we.panningModel&&(we.panningModel=b),w!==we.positionX.value&&(we.positionX.value=w),_!==we.positionY.value&&(we.positionY.value=_),I!==we.positionZ.value&&(we.positionZ.value=I),S!==we.refDistance&&(we.refDistance=S),k!==we.rolloffFactor&&(we.rolloffFactor=k),(Re[0]!==1||Re[1]!==0||Re[2]!==0)&&z.setOrientation(...Re),(Ee[0]!==0||Ee[1]!==0||Ee[2]!==0)&&z.setPosition(...Ee);let qe=()=>{G.connect(z),r(G,ge,0,0),ge.connect(j).connect(U,0,0),ge.connect(X).connect(U,0,1),ge.connect(te).connect(U,0,2),ge.connect(ne).connect(U,0,3),ge.connect(oe).connect(U,0,4),ge.connect(le).connect(U,0,5),U.connect(xe).connect(u.destination)},Qe=()=>{G.disconnect(z),a(G,ge,0,0),ge.disconnect(j),j.disconnect(U),ge.disconnect(X),X.disconnect(U),ge.disconnect(te),te.disconnect(U),ge.disconnect(ne),ne.disconnect(U),ge.disconnect(oe),oe.disconnect(U),ge.disconnect(le),le.disconnect(U),U.disconnect(xe),xe.disconnect(u.destination)};return l(nc(we,z),qe,Qe)};var pge=r=>(e,{disableNormalization:t,imag:n,real:o})=>{let s=n instanceof Float32Array?n:new Float32Array(n),i=o instanceof Float32Array?o:new Float32Array(o),a=e.createPeriodicWave(i,s,{disableNormalization:t});if(Array.from(n).length<2)throw r();return a};var Ow=(r,e,t,n)=>r.createScriptProcessor(e,t,n);var dge=(r,e)=>(t,n)=>{let o=n.channelCountMode;if(o==="clamped-max")throw e();if(t.createStereoPanner===void 0)return r(t,n);let s=t.createStereoPanner();return pr(s,n),Xr(s,n,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>o,set:i=>{if(i!==o)throw e()}}),s};var hge=(r,e,t,n,o,s)=>{let a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u=$e(ie({},l),{oversample:"none"}),p=(f,m,g,y)=>{let x=new Float32Array(16385),b=new Float32Array(16385);for(let R=0;R<16385;R+=1){let L=R/16384*c;x[R]=Math.cos(L),b[R]=Math.sin(L)}let w=t(f,$e(ie({},l),{gain:0})),_=n(f,$e(ie({},u),{curve:x})),I=n(f,$e(ie({},u),{curve:a})),S=t(f,$e(ie({},l),{gain:0})),k=n(f,$e(ie({},u),{curve:b}));return{connectGraph(){m.connect(w),m.connect(I.inputs===void 0?I:I.inputs[0]),m.connect(S),I.connect(g),g.connect(_.inputs===void 0?_:_.inputs[0]),g.connect(k.inputs===void 0?k:k.inputs[0]),_.connect(w.gain),k.connect(S.gain),w.connect(y,0,0),S.connect(y,0,1)},disconnectGraph(){m.disconnect(w),m.disconnect(I.inputs===void 0?I:I.inputs[0]),m.disconnect(S),I.disconnect(g),g.disconnect(_.inputs===void 0?_:_.inputs[0]),g.disconnect(k.inputs===void 0?k:k.inputs[0]),_.disconnect(w.gain),k.disconnect(S.gain),w.disconnect(y,0,0),S.disconnect(y,0,1)}}},d=(f,m,g,y)=>{let x=new Float32Array(16385),b=new Float32Array(16385),w=new Float32Array(16385),_=new Float32Array(16385),I=Math.floor(16385/2);for(let X=0;X<16385;X+=1)if(X>I){let te=(X-I)/(16384-I)*c;x[X]=Math.cos(te),b[X]=Math.sin(te),w[X]=0,_[X]=1}else{let te=X/(16384-I)*c;x[X]=1,b[X]=0,w[X]=Math.cos(te),_[X]=Math.sin(te)}let S=e(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),k=t(f,$e(ie({},l),{gain:0})),R=n(f,$e(ie({},u),{curve:x})),L=t(f,$e(ie({},l),{gain:0})),B=n(f,$e(ie({},u),{curve:b})),z=n(f,$e(ie({},u),{curve:a})),q=t(f,$e(ie({},l),{gain:0})),U=n(f,$e(ie({},u),{curve:w})),G=t(f,$e(ie({},l),{gain:0})),j=n(f,$e(ie({},u),{curve:_}));return{connectGraph(){m.connect(S),m.connect(z.inputs===void 0?z:z.inputs[0]),S.connect(k,0),S.connect(L,0),S.connect(q,1),S.connect(G,1),z.connect(g),g.connect(R.inputs===void 0?R:R.inputs[0]),g.connect(B.inputs===void 0?B:B.inputs[0]),g.connect(U.inputs===void 0?U:U.inputs[0]),g.connect(j.inputs===void 0?j:j.inputs[0]),R.connect(k.gain),B.connect(L.gain),U.connect(q.gain),j.connect(G.gain),k.connect(y,0,0),q.connect(y,0,0),L.connect(y,0,1),G.connect(y,0,1)},disconnectGraph(){m.disconnect(S),m.disconnect(z.inputs===void 0?z:z.inputs[0]),S.disconnect(k,0),S.disconnect(L,0),S.disconnect(q,1),S.disconnect(G,1),z.disconnect(g),g.disconnect(R.inputs===void 0?R:R.inputs[0]),g.disconnect(B.inputs===void 0?B:B.inputs[0]),g.disconnect(U.inputs===void 0?U:U.inputs[0]),g.disconnect(j.inputs===void 0?j:j.inputs[0]),R.disconnect(k.gain),B.disconnect(L.gain),U.disconnect(q.gain),j.disconnect(G.gain),k.disconnect(y,0,0),q.disconnect(y,0,0),L.disconnect(y,0,1),G.disconnect(y,0,1)}}},h=(f,m,g,y,x)=>{if(m===1)return p(f,g,y,x);if(m===2)return d(f,g,y,x);throw o()};return(f,b)=>{var w=b,{channelCount:m,channelCountMode:g,pan:y}=w,x=ah(w,["channelCount","channelCountMode","pan"]);if(g==="max")throw o();let _=r(f,$e(ie({},x),{channelCount:1,channelCountMode:g,numberOfInputs:2})),I=t(f,$e(ie({},x),{channelCount:m,channelCountMode:g,gain:1})),S=t(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y}),{connectGraph:k,disconnectGraph:R}=h(f,m,I,S,_);Object.defineProperty(S.gain,"defaultValue",{get:()=>0}),Object.defineProperty(S.gain,"maxValue",{get:()=>1}),Object.defineProperty(S.gain,"minValue",{get:()=>-1});let L={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(U){I.channelCount!==U&&(B&&R(),{connectGraph:k,disconnectGraph:R}=h(f,U,I,S,_),B&&k()),I.channelCount=U},get channelCountMode(){return I.channelCountMode},set channelCountMode(U){if(U==="clamped-max"||U==="max")throw o();I.channelCountMode=U},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(U){I.channelInterpretation=U},get context(){return I.context},get inputs(){return[I]},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get pan(){return S.gain},addEventListener(...U){return I.addEventListener(U[0],U[1],U[2])},dispatchEvent(...U){return I.dispatchEvent(U[0])},removeEventListener(...U){return I.removeEventListener(U[0],U[1],U[2])}},B=!1,z=()=>{k(),B=!0},q=()=>{R(),B=!1};return s(nc(L,_),z,q)}};var fge=(r,e,t,n,o,s,i)=>(a,c)=>{let l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return t(a,c);pr(l,c);let u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw e();Ur(l,{curve:u},"curve"),Ur(l,c,"oversample");let p=null,d=!1;return i(l,"curve",m=>()=>m.call(l),m=>g=>(m.call(l,g),d&&(n(g)&&p===null?p=r(a,l):!n(g)&&p!==null&&(p(),p=null)),g)),o(l,()=>{d=!0,n(l.curve)&&(p=r(a,l))},()=>{d=!1,p!==null&&(p(),p=null)})};var mge=(r,e,t,n,o)=>(s,l)=>{var u=l,{curve:i,oversample:a}=u,c=ah(u,["curve","oversample"]);let p=s.createWaveShaper(),d=s.createWaveShaper();pr(p,c),pr(d,c);let h=t(s,$e(ie({},c),{gain:1})),f=t(s,$e(ie({},c),{gain:-1})),m=t(s,$e(ie({},c),{gain:1})),g=t(s,$e(ie({},c),{gain:-1})),y=null,x=!1,b=null,w={get bufferSize(){},get channelCount(){return p.channelCount},set channelCount(S){h.channelCount=S,f.channelCount=S,p.channelCount=S,m.channelCount=S,d.channelCount=S,g.channelCount=S},get channelCountMode(){return p.channelCountMode},set channelCountMode(S){h.channelCountMode=S,f.channelCountMode=S,p.channelCountMode=S,m.channelCountMode=S,d.channelCountMode=S,g.channelCountMode=S},get channelInterpretation(){return p.channelInterpretation},set channelInterpretation(S){h.channelInterpretation=S,f.channelInterpretation=S,p.channelInterpretation=S,m.channelInterpretation=S,d.channelInterpretation=S,g.channelInterpretation=S},get context(){return p.context},get curve(){return b},set curve(S){if(S!==null&&S.length<2)throw e();if(S===null)p.curve=S,d.curve=S;else{let k=S.length,R=new Float32Array(k+2-k%2),L=new Float32Array(k+2-k%2);R[0]=S[0],L[0]=-S[k-1];let B=Math.ceil((k+1)/2),z=(k+1)/2-1;for(let q=1;q<B;q+=1){let U=q/B*z,G=Math.floor(U),j=Math.ceil(U);R[q]=G===j?S[G]:(1-(U-G))*S[G]+(1-(j-U))*S[j],L[q]=G===j?-S[k-1-G]:-((1-(U-G))*S[k-1-G])-(1-(j-U))*S[k-1-j]}R[B]=k%2===1?S[B-1]:(S[B-2]+S[B-1])/2,p.curve=R,d.curve=L}b=S,x&&(n(b)&&y===null?y=r(s,h):y!==null&&(y(),y=null))},get inputs(){return[h]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return p.numberOfOutputs},get oversample(){return p.oversample},set oversample(S){p.oversample=S,d.oversample=S},addEventListener(...S){return h.addEventListener(S[0],S[1],S[2])},dispatchEvent(...S){return h.dispatchEvent(S[0])},removeEventListener(...S){return h.removeEventListener(S[0],S[1],S[2])}};i!==null&&(w.curve=i instanceof Float32Array?i:new Float32Array(i)),a!==w.oversample&&(w.oversample=a);let _=()=>{h.connect(p).connect(m),h.connect(f).connect(d).connect(g).connect(m),x=!0,n(b)&&(y=r(s,h))},I=()=>{h.disconnect(p),p.disconnect(m),h.disconnect(f),f.disconnect(d),d.disconnect(g),g.disconnect(m),x=!1,y!==null&&(y(),y=null)};return o(nc(w,m),_,I)};var gs=()=>new DOMException("","NotSupportedError");var N8e={numberOfChannels:1},gge=(r,e,t,n,o)=>class extends r{constructor(i,a,c){let l;if(typeof i=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:i,sampleRate:c};else if(typeof i=="object")l=i;else throw new Error("The given parameters are not valid.");let{length:u,numberOfChannels:p,sampleRate:d}=ie(ie({},N8e),l),h=n(p,u,d);e(Bl,()=>Bl(h))||h.addEventListener("statechange",(()=>{let f=0,m=g=>{this._state==="running"&&(f>0?(h.removeEventListener("statechange",m),g.stopImmediatePropagation(),this._waitForThePromiseToSettle(g)):f+=1)};return m})()),super(h,p),this._length=u,this._nativeOfflineAudioContext=h,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Em(this)}))}_waitForThePromiseToSettle(i){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(i):setTimeout(()=>this._waitForThePromiseToSettle(i))}};var D8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},yge=(r,e,t,n,o,s,i)=>class extends r{constructor(c,l){let u=o(c),p=ie(ie({},D8e),l),d=t(u,p),h=s(u),f=h?n():null,m=c.sampleRate/2;super(c,!1,d,f),this._detune=e(this,h,d.detune,153600,-153600),this._frequency=e(this,h,d.frequency,m,-m),this._nativeOscillatorNode=d,this._onended=null,this._oscillatorNodeRenderer=f,this._oscillatorNodeRenderer!==null&&p.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=p.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){let l=typeof c=="function"?i(this,c):null;this._nativeOscillatorNode.onended=l;let u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Ll(this);let l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),si(this)&&Fp(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}};var xge=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=null,a=null,c=null,l=(u,p)=>M(void 0,null,function*(){let d=t(u),h=zr(d,p);if(!h){let f={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:i===null?void 0:i,type:d.type};d=e(p,f),a!==null&&d.start(a),c!==null&&d.stop(c)}return s.set(p,d),h?(yield r(p,u.detune,d.detune),yield r(p,u.frequency,d.frequency)):(yield n(p,u.detune,d.detune),yield n(p,u.frequency,d.frequency)),yield o(u,p,d),d});return{set periodicWave(u){i=u},set start(u){a=u},set stop(u){c=u},render(u,p){let d=s.get(p);return d!==void 0?Promise.resolve(d):l(u,p)}}};var A8e={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},vge=(r,e,t,n,o,s,i)=>class extends r{constructor(c,l){let u=o(c),p=ie(ie({},A8e),l),d=t(u,p),h=s(u),f=h?n():null;super(c,!1,d,f),this._nativePannerNode=d,this._orientationX=e(this,h,d.orientationX,no,po),this._orientationY=e(this,h,d.orientationY,no,po),this._orientationZ=e(this,h,d.orientationZ,no,po),this._positionX=e(this,h,d.positionX,no,po),this._positionY=e(this,h,d.positionY,no,po),this._positionZ=e(this,h,d.positionZ,no,po),i(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}};var bge=(r,e,t,n,o,s,i,a,c,l)=>()=>{let u=new WeakMap,p=null,d=(h,f)=>M(void 0,null,function*(){let m=null,g=s(h),y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},x=$e(ie({},y),{coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor}),b=zr(g,f);if("bufferSize"in g)m=n(f,$e(ie({},y),{gain:1}));else if(!b){let w=$e(ie({},x),{orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value});g=o(f,w)}if(u.set(f,m===null?g:m),m!==null){if(p===null){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");let B=new i(6,h.context.length,f.sampleRate),z=e(B,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});z.connect(B.destination),p=M(void 0,null,function*(){let q=yield Promise.all([h.orientationX,h.orientationY,h.orientationZ,h.positionX,h.positionY,h.positionZ].map((U,G)=>M(void 0,null,function*(){let j=t(B,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:G===0?1:0});return yield a(B,U,j.offset),j})));for(let U=0;U<6;U+=1)q[U].connect(z,0,U),q[U].start(0);return l(B)})}let w=yield p,_=n(f,$e(ie({},y),{gain:1}));yield c(h,f,_);let I=[];for(let B=0;B<w.numberOfChannels;B+=1)I.push(w.getChannelData(B));let S=[I[0][0],I[1][0],I[2][0]],k=[I[3][0],I[4][0],I[5][0]],R=n(f,$e(ie({},y),{gain:1})),L=o(f,$e(ie({},x),{orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:k[0],positionY:k[1],positionZ:k[2]}));_.connect(R).connect(L.inputs[0]),L.connect(m);for(let B=128;B<w.length;B+=128){let z=[I[0][B],I[1][B],I[2][B]],q=[I[3][B],I[4][B],I[5][B]];if(z.some((U,G)=>U!==S[G])||q.some((U,G)=>U!==k[G])){S=z,k=q;let U=B/f.sampleRate;R.gain.setValueAtTime(0,U),R=n(f,$e(ie({},y),{gain:0})),L=o(f,$e(ie({},x),{orientationX:S[0],orientationY:S[1],orientationZ:S[2],positionX:k[0],positionY:k[1],positionZ:k[2]})),R.gain.setValueAtTime(1,U),_.connect(R).connect(L.inputs[0]),L.connect(m)}}return m}return b?(yield r(f,h.orientationX,g.orientationX),yield r(f,h.orientationY,g.orientationY),yield r(f,h.orientationZ,g.orientationZ),yield r(f,h.positionX,g.positionX),yield r(f,h.positionY,g.positionY),yield r(f,h.positionZ,g.positionZ)):(yield a(f,h.orientationX,g.orientationX),yield a(f,h.orientationY,g.orientationY),yield a(f,h.orientationZ,g.orientationZ),yield a(f,h.positionX,g.positionX),yield a(f,h.positionY,g.positionY),yield a(f,h.positionZ,g.positionZ)),rc(g)?yield c(h,f,g.inputs[0]):yield c(h,f,g),g});return{render(h,f){let m=u.get(f);return m!==void 0?Promise.resolve(m):d(h,f)}}};var R8e={disableNormalization:!1},wge=(r,e,t,n)=>class Cge{constructor(s,i){let a=e(s),c=n(ie(ie({},R8e),i)),l=r(a,c);return t.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===Cge.prototype||t.has(s)}};var _ge=(r,e)=>(t,n,o)=>(r(n).replay(o),e(n,t,o));var Sge=(r,e,t)=>(n,o,s)=>M(void 0,null,function*(){let i=r(n);yield Promise.all(i.activeInputs.map((a,c)=>Array.from(a).map(p=>M(void 0,[p],function*([l,u]){let h=yield e(l).render(l,o),f=n.context.destination;!t(l)&&(n!==f||!t(n))&&h.connect(s,u,c)}))).reduce((a,c)=>[...a,...c],[]))});var Ige=(r,e,t)=>(n,o,s)=>M(void 0,null,function*(){let i=e(n);yield Promise.all(Array.from(i.activeInputs).map(l=>M(void 0,[l],function*([a,c]){let p=yield r(a).render(a,o);t(a)||p.connect(s,c)})))});var Tge=(r,e,t,n)=>o=>r(Bl,()=>Bl(o))?Promise.resolve(r(n,n)).then(s=>{if(!s){let i=t(o,512,0,1);o.oncomplete=()=>{i.onaudioprocess=null,i.disconnect()},i.onaudioprocess=()=>o.currentTime,i.connect(o.destination)}return o.startRendering()}):new Promise(s=>{let i=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.oncomplete=a=>{i.disconnect(),s(a.renderedBuffer)},i.connect(o.destination),o.startRendering()});var kge=r=>(e,t)=>{r.set(e,t)};var Ege=r=>(e,t)=>r.set(e,t);var Nge=(r,e,t,n,o,s,i,a)=>(c,l)=>t(c).render(c,l).then(()=>Promise.all(Array.from(n(l)).map(u=>t(u).render(u,l)))).then(()=>o(l)).then(u=>(typeof u.copyFromChannel!="function"?(i(u),Cw(u)):e(s,()=>s(u))||a(u),r.add(u),u));var O8e={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Dge=(r,e,t,n,o,s)=>class extends r{constructor(a,c){let l=o(a),u=ie(ie({},O8e),c),p=t(l,u),d=s(l),h=d?n():null;super(a,!1,p,h),this._pan=e(this,d,p.pan)}get pan(){return this._pan}};var Age=(r,e,t,n,o)=>()=>{let s=new WeakMap,i=(a,c)=>M(void 0,null,function*(){let l=t(a),u=zr(l,c);if(!u){let p={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(c,p)}return s.set(c,l),u?yield r(c,a.pan,l.pan):yield n(c,a.pan,l.pan),rc(l)?yield o(a,c,l.inputs[0]):yield o(a,c,l),l});return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var Rge=r=>()=>{if(r===null)return!1;try{new r({length:1,sampleRate:44100})}catch{return!1}return!0};var Oge=(r,e)=>()=>M(void 0,null,function*(){if(r===null)return!0;if(e===null)return!1;let t=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),o=URL.createObjectURL(t),s=!1,i=!1;try{yield n.audioWorklet.addModule(o);let a=new r(n,"a",{numberOfOutputs:0}),c=n.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>i=!0,c.connect(a),c.start(0),yield n.startRendering(),yield new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(o)}return s&&!i});var Mge=(r,e)=>()=>{if(e===null)return Promise.resolve(!1);let t=new e(1,1,44100),n=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(o=>{t.oncomplete=()=>{n.disconnect(),o(t.currentTime!==0)},t.startRendering()})};var _U=()=>new DOMException("","UnknownError");var M8e={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Fge=(r,e,t,n,o,s,i)=>class extends r{constructor(c,l){let u=o(c),p=ie(ie({},M8e),l),d=t(u,p),f=s(u)?n():null;super(c,!0,d,f),this._isCurveNullified=!1,this._nativeWaveShaperNode=d,i(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}};var Pge=(r,e,t)=>()=>{let n=new WeakMap,o=(s,i)=>M(void 0,null,function*(){let a=e(s);if(!zr(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=r(i,l)}return n.set(i,a),rc(a)?yield t(s,i,a.inputs[0]):yield t(s,i,a),a});return{render(s,i){let a=n.get(i);return a!==void 0?Promise.resolve(a):o(s,i)}}};var $ge=()=>typeof window>"u"?null:window;var Lge=(r,e)=>t=>{t.copyFromChannel=(n,o,s=0)=>{let i=r(s),a=r(o);if(a>=t.numberOfChannels)throw e();let c=t.length,l=t.getChannelData(a),u=n.length;for(let p=i<0?-i:0;p+i<c&&p<u;p+=1)n[p]=l[p+i]},t.copyToChannel=(n,o,s=0)=>{let i=r(s),a=r(o);if(a>=t.numberOfChannels)throw e();let c=t.length,l=t.getChannelData(a),u=n.length;for(let p=i<0?-i:0;p+i<c&&p<u;p+=1)l[p+i]=n[p]}};var Vge=r=>e=>{e.copyFromChannel=(t=>(n,o,s=0)=>{let i=r(s),a=r(o);if(i<e.length)return t.call(e,n,a,i)})(e.copyFromChannel),e.copyToChannel=(t=>(n,o,s=0)=>{let i=r(s),a=r(o);if(i<e.length)return t.call(e,n,a,i)})(e.copyToChannel)};var Bge=r=>(e,t)=>{let n=t.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),r(e,"buffer",o=>()=>{let s=o.call(e);return s===n?null:s},o=>s=>o.call(e,s===null?n:s))};var zge=(r,e)=>(t,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw r()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw r()}});let o=t.createBufferSource();e(n,()=>{let a=n.numberOfInputs;for(let c=0;c<a;c+=1)o.connect(n,0,c)},()=>o.disconnect(n))};var SU=(r,e,t)=>r.copyFromChannel===void 0?r.getChannelData(t)[0]:(r.copyFromChannel(e,t),e[0]);var IU=r=>{if(r===null)return!1;let e=r.length;return e%2!==0?r[Math.floor(e/2)]!==0:r[e/2-1]+r[e/2]!==0};var Mw=(r,e,t,n)=>{let o=r;for(;!o.hasOwnProperty(e);)o=Object.getPrototypeOf(o);let{get:s,set:i}=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(r,e,{get:t(s),set:n(i)})};var Uge=r=>$e(ie({},r),{outputChannelCount:r.outputChannelCount!==void 0?r.outputChannelCount:r.numberOfInputs===1&&r.numberOfOutputs===1?[r.channelCount]:Array.from({length:r.numberOfOutputs},()=>1)});var Gge=r=>$e(ie({},r),{channelCount:r.numberOfOutputs});var Wge=r=>{let{imag:e,real:t}=r;return e===void 0?t===void 0?$e(ie({},r),{imag:[0,0],real:[0,0]}):$e(ie({},r),{imag:Array.from(t,()=>0),real:t}):t===void 0?$e(ie({},r),{imag:e,real:Array.from(e,()=>0)}):$e(ie({},r),{imag:e,real:t})};var TU=(r,e,t)=>{try{r.setValueAtTime(e,t)}catch(n){if(n.code!==9)throw n;TU(r,e,t+1e-7)}};var jge=r=>{let e=r.createBufferSource();e.start();try{e.start()}catch{return!0}return!1};var Hge=r=>{let e=r.createBufferSource(),t=r.createBuffer(1,1,44100);e.buffer=t;try{e.start(0,1)}catch{return!1}return!0};var qge=r=>{let e=r.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0};var j2=r=>{let e=r.createOscillator();try{e.start(-1)}catch(t){return t instanceof RangeError}return!1};var kU=r=>{let e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.start(),t.stop();try{return t.stop(),!0}catch{return!1}};var H2=r=>{let e=r.createOscillator();try{e.stop(-1)}catch(t){return t instanceof RangeError}return!1};var Kge=r=>{let{port1:e,port2:t}=new MessageChannel;try{e.postMessage(r)}finally{e.close(),t.close()}};var Xge=r=>{r.start=(e=>(t=0,n=0,o)=>{let s=r.buffer,i=s===null?n:Math.min(s.duration,n);s!==null&&i>s.duration-.5/r.context.sampleRate?e.call(r,t,0,0):e.call(r,t,i,o)})(r.start)};var EU=(r,e)=>{let t=e.createGain();r.connect(t);let n=(o=>()=>{o.call(r,t),r.removeEventListener("ended",n)})(r.disconnect);r.addEventListener("ended",n),nc(r,t),r.stop=(o=>{let s=!1;return(i=0)=>{if(s)try{o.call(r,i)}catch{t.gain.setValueAtTime(0,i)}else o.call(r,i),s=!0}})(r.stop)};var By=(r,e)=>t=>{let n={value:r};return Object.defineProperties(t,{currentTarget:n,target:n}),typeof e=="function"?e.call(r,t):e.handleEvent.call(r,t)};var F8e=Lhe(Vl),P8e=Khe(Vl),$8e=Wfe(Tm),Zge=new WeakMap,L8e=ime(Zge),oc=Ife(new Map,new WeakMap),Pp=$ge(),Qge=Fme(oc,tc),NU=sme(Ho),ys=Sge(Ho,NU,Jd),V8e=Qhe(Qge,cn,ys),En=lme(bw),eh=age(Pp),ln=Sme(eh),Jge=new WeakMap,eye=Jfe(By),Fw=Vme(Pp),DU=bme(Fw),AU=wme(Pp),tye=Cme(Pp),OS=zme(Pp),ho=mfe(Vhe(O2),qhe(F8e,P8e,_w,$8e,Sw,Ho,L8e,Mp,cn,Vl,si,Jd,Iw),oc,mme(NS,Sw,Ho,cn,Ly,si),tc,Nw,gs,zfe(_w,NS,Ho,cn,Ly,En,si,ln),qfe(Jge,Ho,Ao),eye,En,DU,AU,tye,ln,OS),B8e=Zhe(ho,V8e,tc,Qge,En,ln);var RU=new WeakSet,Yge=Pme(Pp),rye=Ffe(new Uint32Array(1)),OU=Lge(rye,tc),MU=Vge(rye),FU=Jhe(RU,oc,gs,Yge,eh,Rge(Yge),OU,MU);var q2=Xhe(ii),nye=Ige(NU,km,Jd),$p=Dfe(nye),Pw=Lme(q2,oc,jge,Hge,qge,j2,kU,H2,Xge,Bge(Mw),EU),Lp=_ge(ame(km),nye),z8e=rfe($p,Pw,cn,Lp,ys),zl=yfe(Bhe(M2),Jge,ES,xfe,Wi.createCancelAndHoldAutomationEvent,Wi.createCancelScheduledValuesAutomationEvent,Wi.createExponentialRampToValueAutomationEvent,Wi.createLinearRampToValueAutomationEvent,Wi.createSetTargetAutomationEvent,Wi.createSetValueAutomationEvent,Wi.createSetValueCurveAutomationEvent,Fw,TU),U8e=tfe(ho,z8e,zl,Bn,Pw,En,ln,By);var G8e=ufe(ho,pfe,tc,Bn,Bme(ii,Mw),En,ln,ys),W8e=Sfe($p,wU,cn,Lp,ys),zy=Ege(Zge),j8e=_fe(ho,zl,W8e,Nw,wU,En,ln,zy),Dm=Ome(Vl,AU),H8e=zge(Bn,Dm),Am=Kme(Fw,H8e),q8e=kfe(Am,cn,ys),K8e=Tfe(ho,q8e,Am,En,ln),X8e=Nfe(Rw,cn,ys),Y8e=Efe(ho,X8e,Rw,En,ln,Gge),Z8e=Zme(q2,Pw,ii,Dm),$w=Yme(q2,oc,Z8e,j2,H2),Q8e=Mfe($p,$w,cn,Lp,ys),J8e=Ofe(ho,zl,Q8e,$w,En,ln,By),oye=Qme(gs,Mw),eXe=$fe(oye,cn,ys),tXe=Pfe(ho,eXe,oye,En,ln,zy),rXe=Gfe($p,CU,cn,Lp,ys),nXe=Ufe(ho,zl,rXe,CU,En,ln,zy),sye=Jme(gs),oXe=Yfe($p,sye,cn,Lp,ys),sXe=Xfe(ho,zl,oXe,sye,gs,En,ln,zy),iXe=nme($p,ii,cn,Lp,ys),aXe=rme(ho,zl,iXe,ii,En,ln),cXe=rge(Nw,Bn,Ow,gs),K2=Tge(oc,ii,Ow,Mge(ii,eh)),lXe=fme(Pw,cn,eh,ys,K2),uXe=ege(cXe),pXe=hme(ho,uXe,lXe,En,ln,zy),dXe=dfe(zl,Am,$w,Ow,gs,SU,ln,Mw),iye=new WeakMap,PU=Ame(G8e,dXe,eye,ln,iye,By),aye=cge(q2,oc,j2,kU,H2,EU),hXe=xge($p,aye,cn,Lp,ys),fXe=yge(ho,zl,aye,hXe,En,ln,By),cye=Rfe(Pw),mXe=mge(cye,Bn,ii,IU,Dm),X2=fge(cye,Bn,mXe,IU,Dm,Fw,Mw),gXe=uge(_w,Bn,Am,ii,Ow,X2,gs,Sw,SU,Dm),lye=lge(gXe),yXe=bge($p,Am,$w,ii,lye,cn,eh,Lp,ys,K2),xXe=vge(ho,zl,lye,yXe,En,ln,zy),vXe=pge(tc),bXe=wge(vXe,En,new WeakSet,Wge),wXe=hge(Am,Rw,ii,X2,gs,Dm),uye=dge(wXe,gs),CXe=Age($p,uye,cn,Lp,ys),_Xe=Dge(ho,zl,uye,CXe,En,ln),SXe=Pge(X2,cn,ys),IXe=Fge(ho,Bn,X2,SXe,En,ln,zy),pye=Ime(Pp),$U=eme(Pp),dye=new WeakMap,TXe=ume(dye,eh),kXe=pye?Hhe(oc,gs,Qfe(Pp),$U,tme($he),En,TXe,ln,OS,new WeakMap,new WeakMap,Oge(OS,eh),Pp):void 0,EXe=_me(DU,ln),NXe=Bfe(RU,oc,Vfe,Zfe,new WeakSet,En,EXe,ww,Bl,OU,MU),hye=Cfe(kXe,B8e,FU,U8e,j8e,K8e,Y8e,J8e,tXe,NXe,nXe,sXe,aXe,pXe,PU,fXe,xXe,bXe,_Xe,IXe),DXe=Tme(ho,nge,En,ln),AXe=kme(ho,oge,En,ln),RXe=Eme(ho,sge,En,ln),OXe=ige(Bn,ln),MXe=Nme(ho,OXe,En),fye=lfe(hye,Bn,gs,_U,DXe,AXe,RXe,MXe,Fw);var LU=pme(iye),FXe=Yhe(LU),mye=Afe(tc),PXe=jfe(LU),gye=Kfe(tc),yye=new WeakMap,$Xe=ome(yye,Ao),LXe=qme(mye,tc,Bn,Am,Rw,$w,ii,Ow,gs,gye,$U,$Xe,Dm),VXe=Gme(Bn,LXe,ii,gs,Dm),BXe=wfe($p,mye,Pw,Am,Rw,$w,ii,PXe,gye,$U,cn,OS,eh,Lp,ys,K2),zXe=cme(dye),UXe=kge(yye),VU=pye?vfe(FXe,ho,zl,BXe,VXe,Ho,zXe,En,ln,OS,Uge,UXe,Kge,By):void 0;var UEn=Dme(Bn,gs,_U,PU,Fw);var xye=Lfe(gs,eh),vye=Nge(RU,oc,NU,LU,K2,ww,OU,MU),GEn=Rme(oc,Bn,xye,PU,vye);var bye=gge(hye,oc,Bn,xye,vye);var wye=gme(bw,DU),Cye=yme(vw,AU),_ye=xme(ES,tye),Sye=vme(bw,ln);function fo(r){return r===void 0}function St(r){return r!==void 0}function Iye(r){return typeof r=="function"}function ai(r){return typeof r=="number"}function Ul(r){return Object.prototype.toString.call(r)==="[object Object]"&&r.constructor===Object}function BU(r){return typeof r=="boolean"}function mo(r){return Array.isArray(r)}function $s(r){return typeof r=="string"}function MS(r){return $s(r)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(r)}function it(r,e){if(!r)throw new Error(e)}function rs(r,e,t=1/0){if(!(e<=r&&r<=t))throw new RangeError(`Value must be within [${e}, ${t}], got: ${r}`)}function Y2(r){!r.isOffline&&r.state!=="running"&&Lw('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}var kye=!1,Tye=!1;function zU(r){kye=r}function Eye(r){fo(r)&&kye&&!Tye&&(Tye=!0,Lw("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}var Nye=console;function Dye(...r){Nye.log(...r)}function Lw(...r){Nye.warn(...r)}function Aye(r){return new fye(r)}function Rye(r,e,t){return new bye(r,e,t)}var Ls=typeof self=="object"?self:null,Oye=Ls&&(Ls.hasOwnProperty("AudioContext")||Ls.hasOwnProperty("webkitAudioContext"));function Mye(r,e,t){return it(St(VU),"AudioWorkletNode only works in a secure context (https or localhost)"),new(r instanceof Ls?.BaseAudioContext?Ls?.AudioWorkletNode:VU)(r,e,t)}var Z2=class{constructor(e,t,n,o){this._callback=e,this._type=t,this._minimumUpdateInterval=Math.max(128/(o||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){let e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var t;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((t=this._worker)===null||t===void 0||t.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}};function Gl(r){return _ye(r)}function Vp(r){return Cye(r)}function Vw(r){return Sye(r)}function Rm(r){return wye(r)}function Fye(r){return r instanceof FU}function jXe(r,e){return r==="value"||Gl(e)||Vp(e)||Fye(e)}function Wl(r,...e){if(!e.length)return r;let t=e.shift();if(Ul(r)&&Ul(t))for(let n in t)jXe(n,t[n])?r[n]=t[n]:Ul(t[n])?(r[n]||Object.assign(r,{[n]:{}}),Wl(r[n],t[n])):Object.assign(r,{[n]:t[n]});return Wl(r,...e)}function Pye(r,e){return r.length===e.length&&r.every((t,n)=>e[n]===t)}function ce(r,e,t=[],n){let o={},s=Array.from(e);if(Ul(s[0])&&n&&!Reflect.has(s[0],n)&&(Object.keys(s[0]).some(a=>Reflect.has(r,a))||(Wl(o,{[n]:s[0]}),t.splice(t.indexOf(n),1),s.shift())),s.length===1&&Ul(s[0]))Wl(o,s[0]);else for(let i=0;i<t.length;i++)St(s[i])&&(o[t[i]]=s[i]);return Wl(r,o)}function $ye(r){return r.constructor.getDefaults()}function ua(r,e){return fo(r)?e:r}function Bp(r,e){return e.forEach(t=>{Reflect.has(r,t)&&delete r[t]}),r}var Vs=(()=>{class r{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Ls&&this.toString()===Ls.TONE_DEBUG_CLASS)&&Dye(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}return r.version=yS,r})();function th(r,e){return r>e+1e-6}function FS(r,e){return th(r,e)||ci(r,e)}function Uy(r,e){return r+1e-6<e}function ci(r,e){return Math.abs(r-e)<1e-6}function UU(r,e,t){return Math.max(Math.min(r,t),e)}var Ro=class r extends Vs{constructor(){super(),this.name="Timeline",this._timeline=[];let e=ce(r.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(it(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){let t=this._timeline[this.length-1];it(FS(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{let t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){let t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(e){let t=this._timeline.indexOf(e);return t!==-1&&this._timeline.splice(t,1),this}get(e,t="time"){let n=this._search(e,t);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){let n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){let t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];let n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(ci(this._timeline[t].time,e)){for(let n=t;n>=0&&ci(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else this._timeline.length===1&&FS(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){let t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){let t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(this._timeline.length===0)return-1;let n=0,o=this._timeline.length,s=o;if(o>0&&this._timeline[o-1][t]<=e)return o-1;for(;n<s;){let i=Math.floor(n+(s-n)/2),a=this._timeline[i],c=this._timeline[i+1];if(ci(a[t],e)){for(let l=i;l<this._timeline.length;l++){let u=this._timeline[l];if(ci(u[t],e))i=l;else break}return i}else{if(Uy(a[t],e)&&th(c[t],e))return i;th(a[t],e)?s=i:n=i+1}}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){let n=this._search(e);return n!==-1&&this._iterate(t,0,n),this}forEachAfter(e,t){let n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let o=this._search(e),s=this._search(t);return o!==-1&&s!==-1?(this._timeline[o].time!==e&&(o+=1),this._timeline[s].time===t&&(s-=1),this._iterate(n,o,s)):o===-1&&this._iterate(n,0,s),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){let n=this._search(e);if(n!==-1&&ci(this._timeline[n].time,e)){let o=n;for(let s=n;s>=0&&ci(this._timeline[s].time,e);s--)o=s;this._iterate(s=>{t(s)},o,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}};var Lye=[];function Om(r){Lye.push(r)}function Vye(r){Lye.forEach(e=>e(r))}var Bye=[];function Mm(r){Bye.push(r)}function zye(r){Bye.forEach(e=>e(r))}var Fm=class r extends Vs{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach(o=>{fo(this._events)&&(this._events={}),this._events.hasOwnProperty(o)||(this._events[o]=[]),this._events[o].push(t)}),this}once(e,t){let n=(...o)=>{t(...o),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach(o=>{if(fo(this._events)&&(this._events={}),this._events.hasOwnProperty(o))if(fo(t))this._events[o]=[];else{let s=this._events[o];for(let i=s.length-1;i>=0;i--)s[i]===t&&s.splice(i,1)}}),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){let n=this._events[e].slice(0);for(let o=0,s=n.length;o<s;o++)n[o].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach(t=>{let n=Object.getOwnPropertyDescriptor(r.prototype,t);Object.defineProperty(e.prototype,t,n)})}dispose(){return super.dispose(),this._events=void 0,this}};var Bw=class extends Fm{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}};var Gy=class r extends Bw{constructor(){var e,t;super(),this.name="Context",this._constants=new Map,this._timeouts=new Ro,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;let n=ce(r.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=Aye({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new Z2(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((t=arguments[0])===null||t===void 0)&&t.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Vye(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return it(Rm(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return it(Rm(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return it(Rm(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){it(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){it(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){it(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){it(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return Mye(this.rawContext,e,t)}addAudioWorkletModule(e){return hr(this,void 0,void 0,function*(){it(St(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return hr(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Rm(this._context)?this._context.resume():Promise.resolve()}close(){return hr(this,void 0,void 0,function*(){Rm(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&zye(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{let t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let s=0;s<n.length;s++)n[s]=e;let o=this._context.createBufferSource();return o.channelCount=1,o.channelCountMode="explicit",o.buffer=t,o.loop=!0,o.start(0),this._constants.set(e,o),o}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){let e=this.now(),t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;let n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(t=>{t.id===e&&this._timeouts.remove(t)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){let n=++this._timeoutIds,o=()=>{let s=this.now();this._timeouts.add({callback:()=>{e(),o()},id:n,time:s+t})};return o(),n}};var Q2=class extends Bw{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return hr(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};function He(r,e){mo(e)?e.forEach(t=>He(r,t)):Object.defineProperty(r,e,{enumerable:!0,writable:!1})}function zw(r,e){mo(e)?e.forEach(t=>zw(r,t)):Object.defineProperty(r,e,{writable:!0})}var Ot=()=>{};var li=(()=>{class r extends Vs{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ot;let t=ce(r.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,$s(t.url)?this.load(t.url).catch(t.onerror):t.url&&this.set(t.url)}static getDefaults(){return{onerror:Ot,onload:Ot,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:go().sampleRate}set(t){return t instanceof r?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return hr(this,void 0,void 0,function*(){let n=r.load(t).then(o=>{this.set(o),this.onload(this)});r.downloads.push(n);try{yield n}finally{let o=r.downloads.indexOf(n);r.downloads.splice(o,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){let n=mo(t)&&t[0].length>0,o=n?t.length:1,s=n?t[0].length:t.length,i=go(),a=i.createBuffer(o,s,i.sampleRate),c=!n&&o===1?[t]:t;for(let l=0;l<o;l++)a.copyToChannel(c[l],l);return this._buffer=a,this}toMono(t){if(ai(t))this.fromArray(this.toArray(t));else{let n=new Float32Array(this.length),o=this.numberOfChannels;for(let s=0;s<o;s++){let i=this.toArray(s);for(let a=0;a<i.length;a++)n[a]+=i[a]}n=n.map(s=>s/o),this.fromArray(n)}return this}toArray(t){if(ai(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{let n=[];for(let o=0;o<this.numberOfChannels;o++)n[o]=this.getChannelData(o);return n}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,n=this.duration){it(this.loaded,"Buffer is not loaded");let o=Math.floor(t*this.sampleRate),s=Math.floor(n*this.sampleRate);it(o<s,"The start time must be less than the end time");let i=s-o,a=go().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let c=0;c<this.numberOfChannels;c++)a.copyToChannel(this.getChannelData(c).subarray(o,s),c);return new r(a)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new r().fromArray(t)}static fromUrl(t){return hr(this,void 0,void 0,function*(){return yield new r().load(t)})}static load(t){return hr(this,void 0,void 0,function*(){let n=t.match(/\[([^\]\[]+\|.+)\]$/);if(n){let l=n[1].split("|"),u=l[0];for(let p of l)if(r.supportsType(p)){u=p;break}t=t.replace(n[0],u)}let o=r.baseUrl===""||r.baseUrl.endsWith("/")?r.baseUrl:r.baseUrl+"/",s=document.createElement("a");s.href=o+t,s.pathname=(s.pathname+s.hash).split("/").map(encodeURIComponent).join("/");let i=yield fetch(s.href);if(!i.ok)throw new Error(`could not load url: ${t}`);let a=yield i.arrayBuffer();return yield go().decodeAudioData(a)})}static supportsType(t){let n=t.split("."),o=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+o)!==""}static loaded(){return hr(this,void 0,void 0,function*(){for(yield Promise.resolve();r.downloads.length;)yield r.downloads[0]})}}return r.baseUrl="",r.downloads=[],r})();var zp=class extends Gy{constructor(){super({clockSource:"offline",context:Vw(arguments[0])?arguments[0]:Rye(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:Vw(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=Vw(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return hr(this,void 0,void 0,function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;let n=Math.floor(this.sampleRate/128);e&&t%n===0&&(yield new Promise(o=>setTimeout(o,1)))}})}render(){return hr(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);let t=yield this._context.startRendering();return new li(t)})}close(){return Promise.resolve()}};var Uye=new Q2,Wy=Uye;function go(){return Wy===Uye&&Oye&&GU(new Gy),Wy}function GU(r,e=!1){e&&Wy.dispose(),Rm(r)?Wy=new Gy(r):Vw(r)?Wy=new zp(r):Wy=r}function J2(){return Wy.resume()}if(Ls&&!Ls.TONE_SILENCE_LOGGING){let r="v";yS==="dev"&&(r="");let e=` * Tone.js ${r}${yS} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Uw(r){return Math.pow(10,r/20)}function Gw(r){return 20*(Math.log(r)/Math.LN10)}function jy(r){return Math.pow(2,r/12)}var eO=440;function Gye(){return eO}function Wye(r){eO=r}function Hy(r){return Math.round(WU(r))}function WU(r){return 69+12*Math.log2(r/eO)}function tO(r){return eO*Math.pow(2,(r-69)/12)}var rO=class r extends Vs{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{let n=parseInt(e,10),o=t==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*o:this._beatsToUnits(4/n)*o},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{let t=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(t)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let o=0;return e&&e!=="0"&&(o+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(o+=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(o+=this._beatsToUnits(parseFloat(n)/4)),o},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof r&&this.fromType(this._val),fo(this._val))return this._noArg();if($s(this._val)&&fo(this._units)){for(let e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Ul(this._val)){let e=0;for(let t in this._val)if(St(this._val[t])){let n=this._val[t],o=new this.constructor(this.context,t).valueOf()*n;e+=o}return e}if(St(this._units)){let e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}else return $s(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}};var pa=class r extends rO{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{let t=new r(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){let n=new this.constructor(this.context,e).valueOf(),o=this.valueOf(),a=Math.round(o/n)*n-o;return o+a*t}toNotation(){let e=this.toSeconds(),t=["1m"];for(let s=1;s<9;s++){let i=Math.pow(2,s);t.push(i+"n."),t.push(i+"n"),t.push(i+"t")}t.push("0");let n=t[0],o=new r(this.context,t[0]).toSeconds();return t.forEach(s=>{let i=new r(this.context,s).toSeconds();Math.abs(i-e)<Math.abs(o-e)&&(n=s,o=i)}),n}toBarsBeatsSixteenths(){let e=this._beatsToUnits(1),t=this.valueOf()/e;t=parseFloat(t.toFixed(4));let n=Math.floor(t/this._getTimeSignature()),o=t%1*4;t=Math.floor(t)%this._getTimeSignature();let s=o.toString();return s.length>3&&(o=parseFloat(parseFloat(s).toFixed(3))),[n,t,o].join(":")}toTicks(){let e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Hy(this.toFrequency())}_now(){return this.context.now()}};var ji=class r extends pa{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Gye()}static set A4(e){Wye(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:r.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,t){let o=HXe[e.toLowerCase()]+(parseInt(t,10)+1)*12;return this.defaultUnits==="midi"?o:r.mtof(o)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let o=1;return e&&e!=="0"&&(o*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&t!=="0"&&(o*=this._beatsToUnits(parseFloat(t))),n&&n!=="0"&&(o*=this._beatsToUnits(parseFloat(n)/4)),o}}})}transpose(e){return new r(this.context,this.valueOf()*jy(e))}harmonize(e){return e.map(t=>this.transpose(t))}toMidi(){return Hy(this.valueOf())}toNote(){let e=this.toFrequency(),t=Math.log2(e/r.A4),n=Math.round(12*t)+57,o=Math.floor(n/12);return o<0&&(n+=-12*o),qXe[n%12]+o.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return tO(e)}static ftom(e){return Hy(e)}},HXe={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},qXe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var sc=class extends pa{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}};var Oo=class r extends Vs{constructor(){super();let e=ce(r.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:go()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return Eye(e),new pa(this.context,e).toSeconds()}toFrequency(e){return new ji(this.context,e).toFrequency()}toTicks(e){return new sc(this.context,e).toTicks()}_getPartialProperties(e){let t=this.get();return Object.keys(t).forEach(n=>{fo(e[n])&&delete t[n]}),t}get(){let e=$ye(this);return Object.keys(e).forEach(t=>{if(Reflect.has(this,t)){let n=this[t];St(n)&&St(n.value)&&St(n.setValueAtTime)?e[t]=n.value:n instanceof r?e[t]=n._getPartialProperties(e[t]):mo(n)||ai(n)||$s(n)||BU(n)?e[t]=n:delete e[t]}}),e}set(e){return Object.keys(e).forEach(t=>{Reflect.has(this,t)&&St(this[t])&&(this[t]&&St(this[t].value)&&St(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof r?this[t].set(e[t]):this[t]=e[t])}),this}};var Up=class extends Ro{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){let t=this.get(e);return t!==null?t.state:this._initial}setStateAtTime(e,t,n){return rs(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){let n=this._search(t);for(let o=n;o>=0;o--){let s=this._timeline[o];if(s.state===e)return s}}getNextState(e,t){let n=this._search(t);if(n!==-1)for(let o=n;o<this._timeline.length;o++){let s=this._timeline[o];if(s.state===e)return s}}};var ar=class r extends Oo{constructor(){let e=ce(r.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,it(St(e.param)&&(Gl(e.param)||e.param instanceof r),"param must be an AudioParam");!Gl(e.param);)e.param=e.param._param;this._swappable=St(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Ro(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,St(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Oo.getDefaults(),{convert:!0,units:"number"})}get value(){let e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return St(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return St(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return St(this.maxValue)&&St(this.minValue)&&rs(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Uw(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Gw(e):e}setValueAtTime(e,t){let n=this.toSeconds(t),o=this._fromType(e);return it(isFinite(o)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(o),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:o}),this._param.setValueAtTime(o,n),this}getValueAtTime(e){let t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),o=this._events.get(t),s=this._initialValue;if(o===null)s=this._initialValue;else if(o.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){let i=this._events.getBefore(o.time),a;i===null?a=this._initialValue:a=i.value,o.type==="setTargetAtTime"&&(s=this._exponentialApproach(o.time,a,o.value,o.constant,t))}else if(n===null)s=o.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let i=o.value;if(o.type==="setTargetAtTime"){let a=this._events.getBefore(o.time);a===null?i=this._initialValue:i=a.value}n.type==="linearRampToValueAtTime"?s=this._linearInterpolate(o.time,i,n.time,n.value,t):s=this._exponentialInterpolate(o.time,i,n.time,n.value,t)}else s=o.value;return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(t)===0&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){let n=this._fromType(e),o=this.toSeconds(t);return it(isFinite(n)&&isFinite(o),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:o,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,o),this._param.linearRampToValueAtTime(n,o),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=ci(n,0)?this._minOutput:n,this._assertRange(n);let o=this.toSeconds(t);return it(isFinite(n)&&isFinite(o),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:o,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,o),this._param.exponentialRampToValueAtTime(n,o),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);let o=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,o),this.cancelAndHoldAtTime(t+n*.9),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){let o=this._fromType(e);it(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");let s=this.toSeconds(t);return this._assertRange(o),it(isFinite(o)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:s,type:"setTargetAtTime",value:o}),this.log(this.units,"setTargetAtTime",e,s,n),this._param.setTargetAtTime(o,s,n),this}setValueCurveAtTime(e,t,n,o=1){n=this.toSeconds(n),t=this.toSeconds(t);let s=this._fromType(e[0])*o;this.setValueAtTime(this._toType(s),t);let i=n/(e.length-1);for(let a=1;a<e.length;a++){let c=this._fromType(e[a])*o;this.linearRampToValueAtTime(this._toType(c),t+a*i)}return this}cancelScheduledValues(e){let t=this.toSeconds(e);return it(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){let t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));it(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);let o=this._events.get(t),s=this._events.getAfter(t);return o&&ci(o.time,t)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),t):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){let t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);let n=this._events.get(t);if(n&&n.type==="setTargetAtTime"){let o=this._events.getAfter(n.time),s=o?o.time:t+2,i=(s-t)/10;for(let a=t;a<s;a+=i)e.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,o=>{o.type==="cancelScheduledValues"?e.cancelScheduledValues(o.time):o.type==="setTargetAtTime"?e.setTargetAtTime(o.value,o.time,o.constant):e[o.type](o.value,o.time)}),this}setParam(e){it(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,o,s){return n+(t-n)*Math.exp(-(s-e)/o)}_linearInterpolate(e,t,n,o,s){return t+(o-t)*((s-e)/(n-e))}_exponentialInterpolate(e,t,n,o,s){return t*Math.pow(o/t,(s-e)/(n-e))}};var Ve=class r extends Oo{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return St(this.input)?Gl(this.input)||this.input instanceof ar?1:this.input.numberOfInputs:0}get numberOfOutputs(){return St(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return St(e)&&(e instanceof r||Vp(e))}_getInternalNodes(){let e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){let e=this._getInternalNodes();it(e.length>0,"ToneAudioNode does not have any internal nodes");let t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){let t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){let t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){let t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return ui(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Lw("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return jye(this,e,t,n),this}chain(...e){return jl(this,...e),this}fan(...e){return e.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),St(this.input)&&(this.input instanceof r?this.input.dispose():Vp(this.input)&&this.input.disconnect()),St(this.output)&&(this.output instanceof r?this.output.dispose():Vp(this.output)&&this.output.disconnect()),this._internalChannels=[],this}};function jl(...r){let e=r.shift();r.reduce((t,n)=>(t instanceof Ve?t.connect(n):Vp(t)&&ui(t,n),n),e)}function ui(r,e,t=0,n=0){for(it(St(r),"Cannot connect from undefined node"),it(St(e),"Cannot connect to undefined node"),(e instanceof Ve||Vp(e))&&it(e.numberOfInputs>0,"Cannot connect to node with no inputs"),it(r.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Ve||e instanceof ar;)St(e.input)&&(e=e.input);for(;r instanceof Ve;)St(r.output)&&(r=r.output);Gl(e)?r.connect(e,t):r.connect(e,t,n)}function jye(r,e,t=0,n=0){if(St(e))for(;e instanceof Ve;)e=e.input;for(;!Vp(r);)St(r.output)&&(r=r.output);Gl(e)?r.disconnect(e,t):Vp(e)?r.disconnect(e,t,n):r.disconnect()}var ft=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new ar({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),He(this,"gain")}static getDefaults(){return Object.assign(Ve.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}};var Hl=class extends Ve{constructor(e){super(e),this.onended=Ot,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ft({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){let n=this.toSeconds(t);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Ve.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ot})}_startGain(e,t=1){it(this._startTime===-1,"Source cannot be started more than once");let n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){it(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.now()),t>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let n=this._curve==="exponential"?t*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ot&&(this.onended(this),this.onended=Ot,!this.context.isOffline)){let e=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),it(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Ot,this}};var PS=class r extends Hl{constructor(){let e=ce(r.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ui(this._source,this._gainNode),this.offset=new ar({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Hl.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){let t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}};var Ft=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new PS({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Ve.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return Ww(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,o){return this._param.setValueCurveAtTime(e,t,n,o),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}};function Ww(r,e,t,n){(e instanceof ar||Gl(e)||e instanceof Ft&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Ft&&(e.overridden=!0)),ui(r,e,t,n)}var nO=class r extends ar{constructor(){let e=ce(r.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Ro(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ar.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);let o=this._fromType(e),s=this._events.get(t),i=Math.round(Math.max(1/n,1));for(let a=0;a<=i;a++){let c=n*a+t,l=this._exponentialApproach(s.time,s.value,o,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(e,t){let n=this.toSeconds(t);super.setValueAtTime(e,t);let o=this._events.get(n),s=this._events.previousEvent(o),i=this._getTicksUntilEvent(s,n);return o.ticks=Math.max(i,0),this}linearRampToValueAtTime(e,t){let n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);let o=this._events.get(n),s=this._events.previousEvent(o),i=this._getTicksUntilEvent(s,n);return o.ticks=Math.max(i,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);let n=this._fromType(e),o=this._events.get(t),s=Math.round(Math.max((t-o.time)*10,1)),i=(t-o.time)/s;for(let a=0;a<=s;a++){let c=i*a+o.time,l=this._exponentialInterpolate(o.time,o.value,t,n,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(e,t){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(fo(e.ticks)){let i=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(i,e.time)}let n=this._fromType(this.getValueAtTime(e.time)),o=this._fromType(this.getValueAtTime(t)),s=this._events.get(t);return s&&s.time===t&&s.type==="setValueAtTime"&&(o=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+o)+e.ticks}getTicksAtTime(e){let t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){let n=this.toSeconds(t),o=this.getTicksAtTime(t);return this.getTimeOfTick(o+e)-n}getTimeOfTick(e){let t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&n.type==="linearRampToValueAtTime"&&t.value!==n.value){let o=this._fromType(this.getValueAtTime(t.time)),i=(this._fromType(this.getValueAtTime(n.time))-o)/(n.time-t.time),a=Math.sqrt(Math.pow(o,2)-2*i*(t.ticks-e)),c=(-o+a)/i,l=(-o-a)/i;return(c>0?c:l)+t.time}else return t?t.value===0?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){let n=this.toSeconds(t),o=this.toSeconds(e),s=this.getTicksAtTime(n);return this.getTicksAtTime(n+o)-s}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){let t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}};var oO=class r extends Ft{constructor(){let e=ce(r.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new nO({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Ft.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}};var sO=class r extends Oo{constructor(){let e=ce(r.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new Up,this._tickOffset=new Ro,this._ticksAtTime=new Ro,this._secondsAtTime=new Ro,this.frequency=new oO({context:this.context,units:e.units,value:e.frequency}),He(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Oo.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){let n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),St(t)&&this.setTicksAtTime(t,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){let t=this.toSeconds(e);if(this._state.getValueAtTime(t)==="stopped"){let n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}pause(e){let t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){let t=this.toSeconds(e),n=this._state.getLastState("stopped",t),o=this._ticksAtTime.get(t),s={state:"paused",time:t};this._state.add(s);let i=o||n,a=o?o.ticks:0,c=null;return this._state.forEachBetween(i.time,t+this.sampleTime,l=>{let u=i.time,p=this._tickOffset.get(l.time);p&&p.time>=i.time&&(a=p.ticks,u=p.time),i.state==="started"&&l.state!=="started"&&(a+=this.frequency.getTicksAtTime(l.time)-this.frequency.getTicksAtTime(u),l.time!==s.time&&(c={state:l.state,time:l.time,ticks:a})),i=l}),this._state.remove(s),c&&this._ticksAtTime.add(c),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){let t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);let t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let o=this._secondsAtTime.get(e),s=o||t,i=o?o.seconds:0,a=null;return this._state.forEachBetween(s.time,e+this.sampleTime,c=>{let l=s.time,u=this._tickOffset.get(c.time);u&&u.time>=s.time&&(i=u.seconds,l=u.time),s.state==="started"&&c.state!=="started"&&(i+=c.time-l,c.time!==n.time&&(a={state:c.state,time:c.time,seconds:i})),s=c}),this._state.remove(n),a&&this._secondsAtTime.add(a),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this._ticksAtTime.cancel(t),this._secondsAtTime.cancel(t),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){let n=this._tickOffset.get(t),o=this._state.get(t),s=Math.max(n.time,o.time),i=this.frequency.getTicksAtTime(s)+e-n.ticks;return this.frequency.getTimeOfTick(i)}forEachTickBetween(e,t,n){let o=this._state.get(e);this._state.forEachBetween(e,t,i=>{o&&o.state==="started"&&i.state!=="started"&&this.forEachTickBetween(Math.max(o.time,e),i.time-this.sampleTime,n),o=i});let s=null;if(o&&o.state==="started"){let i=Math.max(o.time,e),a=this.frequency.getTicksAtTime(i),c=this.frequency.getTicksAtTime(o.time),l=a-c,u=Math.ceil(l)-l;u=ci(u,1)?0:u;let p=this.frequency.getTimeOfTick(a+u);for(;p<t;){try{n(p,Math.round(this.getTicksAtTime(p)))}catch(d){s=d;break}p+=this.frequency.getDurationOfTicks(1,p)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}};var jw=class r extends Oo{constructor(){let e=ce(r.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Ot,this._lastUpdate=0,this._state=new Up("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new sO({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,He(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Oo.getDefaults(),{callback:Ot,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Y2(this.context);let n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){let t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){let t=this.toSeconds(e);return this._state.getValueAtTime(t)==="started"&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){let n=this.toSeconds(t),o=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(o+e,n)}_loop(){let e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,n=>{switch(n.state){case"started":let o=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,o);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,t,(n,o)=>{this.callback(n,o)}))}getStateAtTime(e){let t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}};Fm.mixin(jw);var ic=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new ft({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,He(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Ve.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}};var jU=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this.name="Destination",this.input=new ic({context:this.context}),this.output=new ft({context:this.context}),this.volume=this.input.volume,jl(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Ve.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),jl(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};Om(r=>{r.destination=new jU({context:r})});Mm(r=>{r.destination.dispose()});var HU=class extends Ve{constructor(){super(...arguments),this.name="Listener",this.positionX=new ar({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ar({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ar({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ar({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ar({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ar({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ar({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ar({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ar({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Ve.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}};Om(r=>{r.listener=new HU({context:r})});Mm(r=>{r.listener.dispose()});var Hw=class r extends Vs{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let e=ce(r.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;let n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Ot,onload:Ot,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return it(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,t])=>t.loaded)}add(e,t,n=Ot,o=Ot){return $s(t)?(this.baseUrl&&t.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new li(this.baseUrl+t,n,o))):this._buffers.set(e.toString(),new li(t,n,o)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}};var da=class extends sc{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}};var qU=class extends Oo{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ro,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){let e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){let t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};Om(r=>{r.draw=new qU({context:r})});Mm(r=>{r.draw.dispose()});var iO=class extends Vs{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){it(St(e.time),"Events must have a time property"),it(St(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new KU(e.time,e.time+e.duration,e);for(this._root===null?this._root=t:this._root.insert(t),this._length++;t!==null;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(this._root!==null){let t=[];this._root.search(e.time,t);for(let n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,t=>this.remove(t)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,t){e.parent!==null?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{let t=e.getBalance(),n,o=null;if(t>0)if(e.left.right===null)n=e.left,n.right=e.right,o=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,o=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,o=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,o=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),o&&this._rebalance(o)}e.dispose()}_rotateLeft(e){let t=e.parent,n=e.isLeftChild(),o=e.right;o&&(e.right=o.left,o.left=e),t!==null?n?t.left=o:t.right=o:this._setRoot(o)}_rotateRight(e){let t=e.parent,n=e.isLeftChild(),o=e.left;o&&(e.left=o.right,o.right=e),t!==null?n?t.left=o:t.right=o:this._setRoot(o)}_rebalance(e){let t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){let t=[];if(this._root.search(e,t),t.length>0){let n=t[0];for(let o=1;o<t.length;o++)t[o].low>n.low&&(n=t[o]);return n.event}}return null}forEach(e){if(this._root!==null){let t=[];this._root.traverse(n=>t.push(n)),t.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,t){if(this._root!==null){let n=[];this._root.search(e,n),n.forEach(o=>{o.event&&t(o.event)})}return this}forEachFrom(e,t){if(this._root!==null){let n=[];this._root.searchAfter(e,n),n.forEach(o=>{o.event&&t(o.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}},KU=class{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(this.left!==null&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),this.left!==null&&this.left.searchAfter(e,t)),this.right!==null&&this.right.searchAfter(e,t)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}};var aO=class extends Vs{constructor(e){super(),this.name="TimelineValue",this._timeline=new Ro({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){let t=this._timeline.get(e);return t?t.value:this._initialValue}};var pi=class r extends Ve{constructor(){super(ce(r.getDefaults(),arguments,["context"]))}connect(e,t=0,n=0){return Ww(this,e,t,n),this}};var ha=class r extends pi{constructor(){let e=ce(r.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,mo(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):Iye(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Ft.getDefaults(),{length:1024})}setMap(e,t=1024){let n=new Float32Array(t);for(let o=0,s=t;o<s;o++){let i=o/(s-1)*2-1;n[o]=e(i,o)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){let t=["none","2x","4x"].some(n=>n.includes(e));it(t,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}};var qw=class r extends pi{constructor(){let e=ce(r.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new ha({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(pi.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}};var Kw=(()=>{class r{constructor(t,n){this.id=r._eventId++,this._remainderTime=0;let o=Object.assign(r.getDefaults(),n);this.transport=t,this.callback=o.callback,this._once=o.once,this.time=Math.floor(o.time),this._remainderTime=o.time-this.time}static getDefaults(){return{callback:Ot,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(t){if(this.callback){let n=this.transport.bpm.getDurationOfTicks(1,t);this.callback(t+this._remainderTime*n),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}return r._eventId=0,r})();var cO=class r extends Kw{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let n=Object.assign(r.getDefaults(),t);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Kw.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Uy(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new da(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Uy(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new da(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;let t=this.transport.getTicksAtTime(e);th(t,this.time)&&(this._nextTick=this.floatTime+Math.ceil((t-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}};var lO=class r extends Oo{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new aO(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ro,this._repeatedEvents=new iO,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new jw({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),He(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Oo.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(this._swingTicks*2)!==0){let n=t%(this._swingTicks*2)/(this._swingTicks*2),o=Math.sin(n*Math.PI)*this._swingAmount;e+=new da(this.context,this._swingTicks*2/3).toSeconds()*o}zU(!0),this._timeline.forEachAtTime(t,n=>n.invoke(e)),zU(!1)}schedule(e,t){let n=new Kw(this,{callback:e,time:new sc(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,o=1/0){let s=new cO(this,{callback:e,duration:new pa(this.context,o).toTicks(),interval:new pa(this.context,t).toTicks(),time:new sc(this.context,n).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,t){let n=new Kw(this,{callback:e,once:!0,time:new sc(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){let t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){let t=this.toTicks(e);return this._timeline.forEachFrom(t,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(t,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,t)=>{t=new da(this.context,t).toSeconds(),this.emit("start",e,t)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){this.context.resume();let n;return St(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){mo(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new pa(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new pa(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new da(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){let e=this.now(),t=this._clock.getTicksAtTime(e);return new da(this.context,t).toBarsBeatsSixteenths()}set position(e){let t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){let t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){let e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){let t=this.now();if(this.state==="started"){let n=this._clock.getTicksAtTime(t),o=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t),s=t+o;this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this.emit("ticks",t),this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{let t=this.now(),n=this.getTicksAtTime(t),o=e-n%e;return this._clock.nextTickTime(o,t)}}syncSignal(e,t){let n=this.now(),o=this.bpm,s=1/(60/o.getValueAtTime(n)/this.PPQ),i=[];if(e.units==="time"){let c=.015625/s,l=new ft(c),u=new qw(-1),p=new ft(c);o.chain(l,u,p),o=p,s=1/s,i=[l,u,p]}t||(e.getValueAtTime(n)!==0?t=e.getValueAtTime(n)/s:t=0);let a=new ft(t);return o.connect(a),a.connect(e._param),i.push(a),this._syncedSignals.push({initial:e.value,nodes:i,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){let n=this._syncedSignals[t];n.signal===e&&(n.nodes.forEach(o=>o.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),zw(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};Fm.mixin(lO);Om(r=>{r.transport=new lO({context:r})});Mm(r=>{r.transport.dispose()});var en=class extends Ve{constructor(e){super(e),this.input=void 0,this._state=new Up("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ot,this._syncedStop=Ot,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ic({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,He(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Ve.getDefaults(),{mute:!1,onstop:Ot,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let o=fo(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(o=this._clampToCurrentTime(o),!this._synced&&this._state.getValueAtTime(o)==="started")it(th(o,this._state.get(o).time),"Start time must be strictly greater than previous start time"),this._state.cancel(o),this._state.setStateAtTime("started",o),this.log("restart",o),this.restart(o,t,n);else if(this.log("start",o),this._state.setStateAtTime("started",o),this._synced){let s=this._state.get(o);s&&(s.offset=this.toSeconds(ua(t,0)),s.duration=n?this.toSeconds(n):void 0);let i=this.context.transport.schedule(a=>{this._start(a,t,n)},o);this._scheduled.push(i),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>o&&this._syncedStart(this.now(),this.context.transport.seconds)}else Y2(this.context),this._start(o,t,n);return this}stop(e){let t=fo(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),this._state.getValueAtTime(t)==="started"||St(this._state.getNextState("started",t))){if(this.log("stop",t),!this._synced)this._stop(t);else{let n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(th(t,0)){let n=this._state.get(t);if(n&&n.state==="started"&&n.time!==t){let o=t-this.toSeconds(n.time),s;n.duration&&(s=this.toSeconds(n.duration)-o),this._start(e,this.toSeconds(n.offset)+o,s)}}},this._syncedStop=e=>{let t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(t)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ot,this.unsync(),this._volume.dispose(),this._state.dispose(),this}};var rh=class r extends Hl{constructor(){let e=ce(r.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ui(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ar({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new li(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Hl.getDefaults(),{url:new li,loop:!1,loopEnd:0,loopStart:0,onload:Ot,onerror:Ot,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,o=1){it(this.buffer.loaded,"buffer is either not set or not loaded");let s=this.toSeconds(e);this._startGain(s,o),this.loop?t=ua(t,this.loopStart):t=ua(t,0);let i=Math.max(this.toSeconds(t),0);if(this.loop){let a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;FS(i,a)&&(i=(i-c)%l+c),ci(i,this.buffer.duration)&&(i=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Uy(i,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,i)),St(n)){let a=this.toSeconds(n);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}};var _On=44100*5;function Hi(r,e){return hr(this,void 0,void 0,function*(){let t=e/r.context.sampleRate,n=new zp(1,t,r.context.sampleRate);return new r.constructor(Object.assign(r.get(),{frequency:2/t,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}var $S=class r extends Hl{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ui(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ar({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ar({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),He(this,["frequency","detune"])}static getDefaults(){return Object.assign(Hl.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){let t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}};var Mo=(()=>{class r extends en{constructor(){let t=ce(r.getDefaults(),arguments,["frequency","type"]);super(t),this.name="Oscillator",this._oscillator=null,this.frequency=new Ft({context:this.context,units:"frequency",value:t.frequency}),He(this,"frequency"),this.detune=new Ft({context:this.context,units:"cents",value:t.detune}),He(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){let n=this.toSeconds(t),o=new $S({context:this.context,onended:()=>this.onstop(this)});this._oscillator=o,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(t){let n=this.toSeconds(t);this._oscillator&&this._oscillator.stop(n)}_restart(t){let n=this.toSeconds(t);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return r._periodicWaveCache.find(n=>n.phase===this._phase&&Pye(n.partials,this._partials));{let t=r._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;let n=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{let o=this._getCachedPeriodicWave();if(St(o)){let{partials:s,wave:i}=o;this._wave=i,this._partials=s,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[s,i]=this._getRealImaginary(t,this._phase),a=this.context.createPeriodicWave(s,i);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),r._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),r._periodicWaveCache.length>100&&r._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){rs(t,0);let n=this._type,o=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(o&&(n=o[1]),this._type!=="custom")t===0?this.type=n:this.type=n+t.toString();else{let s=new Float32Array(t);this._partials.forEach((i,a)=>s[a]=i),this._partials=Array.from(s),this.type=this._type}}_getRealImaginary(t,n){let s=2048,i=new Float32Array(s),a=new Float32Array(s),c=1;if(t==="custom"){if(c=this._partials.length+1,this._partialCount=this._partials.length,s=c,this._partials.length===0)return[i,a]}else{let l=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);l?(c=parseInt(l[2],10)+1,this._partialCount=parseInt(l[2],10),t=l[1],c=Math.max(c,2),s=c):this._partialCount=0,this._partials=[]}for(let l=1;l<s;++l){let u=2/(l*Math.PI),p;switch(t){case"sine":p=l<=c?1:0,this._partials[l-1]=p;break;case"square":p=l&1?2*u:0,this._partials[l-1]=p;break;case"sawtooth":p=u*(l&1?1:-1),this._partials[l-1]=p;break;case"triangle":l&1?p=2*(u*u)*(l-1>>1&1?-1:1):p=0,this._partials[l-1]=p;break;case"custom":p=this._partials[l-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}p!==0?(i[l]=-p*Math.sin(n*l),a[l]=p*Math.cos(n*l)):(i[l]=0,a[l]=0)}return[i,a]}_inverseFFT(t,n,o){let s=0,i=t.length;for(let a=0;a<i;a++)s+=t[a]*Math.cos(a*o)+n[a]*Math.sin(a*o);return s}getInitialValue(){let[t,n]=this._getRealImaginary(this._type,0),o=0,s=Math.PI*2,i=32;for(let a=0;a<i;a++)o=Math.max(this._inverseFFT(t,n,a/i*s),o);return UU(-this._inverseFFT(t,n,this._phase)/o,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(){return hr(this,arguments,void 0,function*(t=1024){return Hi(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}return r._periodicWaveCache=[],r})();var Xw=class extends pi{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new ha({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}};var Fo=class r extends Ft{constructor(){let e=ce(r.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new ft({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Ft.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}};var LS=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new Xw({context:this.context}),this._modulationNode=new ft({context:this.context}),this._carrier=new Mo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Mo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Fo({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),He(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Mo.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}};var Yw=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new ft({context:this.context,gain:0}),this._carrier=new Mo({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Ft({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Mo({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Fo({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Fo({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),He(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Mo.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}};var qy=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new ft({context:this.context,gain:0}),this._thresh=new ha({context:this.context,mapping:t=>t<=0?-1:1}),this.width=new Ft({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Mo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),He(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}};var VS=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new Ft({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Ft({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,He(this,["frequency","detune"])}static getDefaults(){return Object.assign(Mo.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(t=>t.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(t=>t.stop(e))}_restart(e){this._forEach(t=>t.restart(e))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach(t=>t.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){let t=-e/2,n=e/(this._oscillators.length-1);this._forEach((o,s)=>o.detune.value=t+n*s)}}get count(){return this._oscillators.length}set count(e){if(rs(e,1),this._oscillators.length!==e){this._forEach(t=>t.dispose()),this._oscillators=[];for(let t=0;t<e;t++){let n=new Mo({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:t===0?()=>this.onstop(this):Ot});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[t]=n}this.spread=this._spread,this.state==="started"&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((t,n)=>t.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(t=>t.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(t=>t.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(t=>t.partialCount=e),this._type=this._oscillators[0].type}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}};var BS=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Fo({context:this.context,value:2}),this._pulse=new qy({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Mo({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),He(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}};var Hye={am:LS,fat:VS,fm:Yw,oscillator:Mo,pulse:qy,pwm:BS},Ky=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new Ft({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Ft({context:this.context,units:"cents",value:e.detune}),He(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Mo.getDefaults(),Yw.getDefaults(),LS.getDefaults(),VS.getDefaults(),qy.getDefaults(),BS.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;let t=Hye[e],n=this.now();if(this._oscillator){let o=this._oscillator;o.stop(n),this.context.setTimeout(()=>o.dispose(),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(t=this._oscillator.type),e==="fm"?this.type="fm"+t:e==="am"?this.type="am"+t:e==="fat"?this.type="fat"+t:e==="oscillator"?this.type=t:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,t){return e instanceof Hye[t]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&ai(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&ai(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&$s(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return hr(this,arguments,void 0,function*(e=1024){return Hi(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}};function pO(r,e=1/0){let t=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){rs(s,r,e),t.set(this,s)}})}}function qi(r,e=1/0){let t=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return t.get(this)},set:function(s){rs(this.toSeconds(s),r,e),t.set(this,s)}})}}var zS=class r extends en{constructor(){let e=ce(r.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new li({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(en.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ot,onerror:Ot,playbackRate:1,reverse:!1})}load(e){return hr(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Ot){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){this._loop?t=ua(t,this._loopStart):t=ua(t,0);let o=this.toSeconds(t),s=n;n=ua(n,Math.max(this._buffer.duration-o,0));let i=this.toSeconds(n);i=i/this._playbackRate,e=this.toSeconds(e);let a=new rh({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+i),this._state.setStateAtTime("stopped",e+i,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&fo(s)?a.start(e,o):a.start(e,o,i-this.toSeconds(this.fadeOut))}_stop(e){let t=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(t))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){var o;(o=[...this._activeSources].pop())===null||o===void 0||o.stop(e),this._start(e,t,n)}seek(e,t){let n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="started"){let o=this.toSeconds(e);this._stop(n),this._start(n,o)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&rs(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&rs(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(t=>{t.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(t=>{t.loop=e}),e)){let t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;let t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(o=>o.cancelStop())),this._activeSources.forEach(o=>{o.playbackRate.setValueAtTime(e,t)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}};vs([qi(0)],zS.prototype,"fadeIn",void 0);vs([qi(0)],zS.prototype,"fadeOut",void 0);var di=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new Ft({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(Ve.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if($s(e))return e;{let n;for(n in dO)if(dO[n][t]===e)return n;return e}}_setCurve(e,t,n){if($s(n)&&Reflect.has(dO,n)){let o=dO[n];Ul(o)?e!=="_decayCurve"&&(this[e]=o[t]):this[e]=o}else if(mo(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let o=this.toSeconds(this.attack),s=this.toSeconds(this.decay),i=this.getValueAtTime(e);if(i>0){let a=1/o;o=(1-i)/a}if(o<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(t,o,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(t,o,e);else{this._sig.cancelAndHoldAtTime(e);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=i&&i<=a[c]){a=this._attackCurve.slice(c),a[0]=i;break}this._sig.setValueCurveAtTime(a,e,o,t)}if(s&&this.sustain<1){let a=t*this.sustain,c=e+o;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);let t=this.getValueAtTime(e);if(t>0){let n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(it(mo(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return Ww(this,e,t,n),this}asArray(){return hr(this,arguments,void 0,function*(e=1024){let t=e/this.context.sampleRate,n=new zp(1,t,this.context.sampleRate),o=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=o+this.toSeconds(this.release),i=s*.1,a=s+i,c=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/a,decay:t*this.toSeconds(this.decay)/a,release:t*this.toSeconds(this.release)/a,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(t*(o+i)/a,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}};vs([qi(0)],di.prototype,"attack",void 0);vs([qi(0)],di.prototype,"decay",void 0);vs([pO(0,1)],di.prototype,"sustain",void 0);vs([qi(0)],di.prototype,"release",void 0);var dO=(()=>{let e,t,n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));let o=[],s=6.4;for(e=0;e<127;e++){t=e/127;let d=Math.sin(t*(Math.PI*2)*s-Math.PI/2)+1;o[e]=d/10+t*.83}o[127]=1;let i=[],a=5;for(e=0;e<128;e++)i[e]=Math.ceil(e/127*a)/a;let c=[];for(e=0;e<128;e++)t=e/127,c[e]=.5*(1-Math.cos(Math.PI*t));let l=[];for(e=0;e<128;e++){t=e/127;let d=Math.pow(t,3)*4+.2,h=Math.cos(d*Math.PI*2*t);l[e]=Math.abs(h*(1-t))}function u(d){let h=new Array(d.length);for(let f=0;f<d.length;f++)h[f]=1-d[f];return h}function p(d){return d.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:n,Out:p(n)},exponential:"exponential",linear:"linear",ripple:{In:o,Out:u(o)},sine:{In:c,Out:u(c)},step:{In:i,Out:u(i)}}})();var ql=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=t=>this._original_triggerRelease(t),this._volume=this.output=new ic({context:this.context,volume:e.volume}),this.volume=this._volume.volume,He(this,"volume")}static getDefaults(){return Object.assign(Ve.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){let n=this["_original_"+e]=this[e];this[e]=(...o)=>{let s=o[t],i=this.context.transport.schedule(a=>{o[t]=a,n.apply(this,o)},s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,t,n,o){let s=this.toSeconds(n),i=this.toSeconds(t);return this.triggerAttack(e,s,o),this.triggerRelease(s+i),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}};var fa=class r extends ql{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(ql.getDefaults(),{detune:0,onsilence:Ot,portamento:0})}triggerAttack(e,t,n=1){this.log("triggerAttack",e,t,n);let o=this.toSeconds(t);return this._triggerEnvelopeAttack(o,n),this.setNote(e,o),this}triggerRelease(e){this.log("triggerRelease",e);let t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){let n=this.toSeconds(t),o=e instanceof ji?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){let s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(o,s,n)}else this.frequency.setValueAtTime(o,n);return this}};vs([qi(0)],fa.prototype,"portamento",void 0);var Zw=class r extends di{constructor(){super(ce(r.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ft({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}};var nh=class r extends fa{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new Ky(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Zw(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),He(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(fa.getDefaults(),{envelope:Object.assign(Bp(di.getDefaults(),Object.keys(Ve.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Bp(Ky.getDefaults(),[...Object.keys(en.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),this.envelope.sustain===0){let n=this.toSeconds(this.envelope.attack),o=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+o)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}};var fO=class r extends nh{constructor(){let e=ce(r.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,He(this,["oscillator","envelope"])}static getDefaults(){return Wl(fa.getDefaults(),nh.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){let n=this.toSeconds(t),o=this.toFrequency(e instanceof ji?e.toFrequency():e),s=o*this.octaves;return this.oscillator.frequency.setValueAtTime(s,n),this.oscillator.frequency.exponentialRampToValueAtTime(o,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}};vs([pO(0)],fO.prototype,"octaves",void 0);vs([qi(0)],fO.prototype,"pitchDecay",void 0);var Kye=new Set;function Jw(r){Kye.add(r)}function mO(r,e){let t=`registerProcessor("${r}", ${e})`;Kye.add(t)}var YXe=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;Jw(YXe);var ZXe=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;Jw(ZXe);var QXe=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;Jw(QXe);var Xye="feedback-comb-filter",JXe=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;mO(Xye,JXe);var gO=class r extends ql{constructor(){let e=ce(r.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;let t={};Object.keys(e.urls).forEach(n=>{let o=parseInt(n,10);if(it(MS(n)||ai(o)&&isFinite(o),`url key is neither a note or midi pitch: ${n}`),MS(n)){let s=new ji(this.context,n).toMidi();t[s]=e.urls[n]}else ai(o)&&isFinite(o)&&(t[o]=e.urls[o])}),this._buffers=new Hw({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(ql.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ot,onerror:Ot,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach(o=>{let s=WU(new ji(this.context,o).toFrequency()),i=Math.round(s),a=s-i,c=this._findClosest(i),l=i-c,u=this._buffers.get(l),p=jy(c+a),d=new rh({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:p}).connect(this.output);d.start(t,0,u.duration/p,n),mo(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){let h=this._activeSources.get(i),f=h.indexOf(d);f!==-1&&h.splice(f,1)}}}),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach(n=>{let o=new ji(this.context,n).toMidi();if(this._activeSources.has(o)&&this._activeSources.get(o).length){let s=this._activeSources.get(o);t=this.toSeconds(t),s.forEach(i=>{i.stop(t)}),this._activeSources.set(o,[])}}),this}releaseAll(e){let t=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(t)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,o=1){let s=this.toSeconds(n);return this.triggerAttack(e,s,o),mo(t)?(it(mo(e),"notes must be an array when duration is array"),e.forEach((i,a)=>{let c=t[Math.min(a,t.length-1)];this.triggerRelease(i,s+this.toSeconds(c))})):this.triggerRelease(e,s+this.toSeconds(t)),this}add(e,t,n){if(it(MS(e)||isFinite(e),`note must be a pitch or midi: ${e}`),MS(e)){let o=new ji(this.context,e).toMidi();this._buffers.add(o,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(t=>t.dispose())}),this._activeSources.clear(),this}};vs([qi(0)],gO.prototype,"attack",void 0);vs([qi(0)],gO.prototype,"release",void 0);var US=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new ar({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",He(this,"pan")}static getDefaults(){return Object.assign(Ve.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}};var Qye="bit-crusher",iYe=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;mO(Qye,iYe);var fGn=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100];var CGn=[1687/25e3,1601/25e3,2053/25e3,2251/25e3];var e0=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new ft({context:this.context}),r._allSolos.has(this.context)||r._allSolos.set(this.context,new Set),r._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Ve.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),r._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){r._soloed.has(this.context)||r._soloed.set(this.context,new Set),r._soloed.get(this.context).add(this)}_removeSolo(){r._soloed.has(this.context)&&r._soloed.get(this.context).delete(this)}_isSoloed(){return r._soloed.has(this.context)&&r._soloed.get(this.context).has(this)}_noSolos(){return!r._soloed.has(this.context)||r._soloed.has(this.context)&&r._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),r._allSolos.get(this.context).delete(this),this._removeSolo(),this}};e0._allSolos=new Map;e0._soloed=new Map;var bO=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new US({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ic({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,He(this,["pan","volume"])}static getDefaults(){return Object.assign(Ve.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}};var JU=class r extends Ve{constructor(){let e=ce(r.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new e0({solo:e.solo,context:this.context}),this._panVol=this.output=new bO({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),He(this,["pan","volume"])}static getDefaults(){return Object.assign(Ve.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return r.buses.has(e)||r.buses.set(e,new ft({context:this.context})),r.buses.get(e)}send(e,t=0){let n=this._getBus(e),o=new ft({context:this.context,units:"decibels",gain:t});return this.connect(o),o.connect(n),o}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}};JU.buses=new Map;var iqn=go().transport;var aqn=go().destination,cqn=go().destination;var lqn=go().listener;var uqn=go().draw;var pqn=go();var wO=class r{synth;constructor(){this.synth=new nh().toDestination()}playPositiveFeedback(){return M(this,null,function*(){yield J2(),this.synth.triggerAttackRelease("C5","8n"),ax(150).subscribe(()=>{this.synth.triggerAttackRelease("E5","8n")})})}playNegativeFeedback(){return M(this,null,function*(){yield J2(),this.synth.triggerAttackRelease("E4","8n"),ax(150).subscribe(()=>{this.synth.triggerAttackRelease("C4","8n")})})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};function mYe(r,e){if(r&1){let t=ed();Se(0,"app-green-balloon-game",15),mr("red",function(){_a(t);let o=Dn();return Sa(o.onRedBalloon())})("green",function(){_a(t);let o=Dn();return Sa(o.onGreenBalloon())})("time",function(o){_a(t);let s=Dn();return Sa(s.onTimeUpdate(o))}),Ie()}if(r&2){let t=Dn();fr("totalGameTime",t.gameDuration)}}function gYe(r,e){if(r&1&&(Se(0,"div",10),mt(1,"app-timer",16),Ie()),r&2){let t=Dn();It(),fr("minutes",t.remainingMinutes)("seconds",t.remainingSeconds)}}var GS=class r{constructor(e,t,n,o,s){this.appStateService=e;this.cdr=t;this.sound=n;this.route=o;this.router=s}selectedCameraID=null;video=new Yr;redCounter=0;greenCounter=0;minutes=0;remainingMinutes=0;remainingSeconds=0;gameDuration=0;ready=!1;ngOnInit(){return M(this,null,function*(){})}ngAfterViewInit(){return M(this,null,function*(){let t=(yield x0(this.route.paramMap)).get("minutes");this.minutes=t?+t:0,console.log(`Received minutes: ${this.minutes}`),this.gameDuration=this.minutes*6e4,this.selectedCameraID=this.appStateService.getSelectedCamera(),this.cdr.detectChanges(),this.ready=!0,console.log("ready",this.gameDuration)})}onRedBalloon(){this.redCounter++,this.sound.playNegativeFeedback(),this.cdr.detectChanges()}onGreenBalloon(){this.greenCounter++,this.sound.playPositiveFeedback(),this.cdr.detectChanges()}onTimeUpdate(e){let t=this.minutes*60,n=Math.floor(e/1e3),o=t-n;if(o<=0)this.remainingMinutes=0,this.remainingSeconds=0;else{let s=Math.floor(o/60),i=o%60;this.remainingMinutes=s,this.remainingSeconds=i}this.cdr.detectChanges()}class="green-balloon";onCameraSelected(e){this.selectedCameraID=e,this.appStateService.saveSelectedCamera(e)}onVideoReady(e){console.log("video updated",e),this.video.next(e)}back(){this.router.navigate(["/user/play"])}static \u0275fac=function(t){return new(t||r)(We(Im),We(yc),We(wO),We(Cs),We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-balloons-game-page"]],standalone:!0,features:[At],decls:26,vars:7,consts:[[1,"text-center","py-8","flex","flex-col"],[1,"text-xl","font-bold"],[1,"camera-selector"],[3,"cameraSelected","selectedCameraID"],[1,"parent-video-container","mt-4"],[1,"video-preview",3,"videoReady","selectedCameraID"],[1,"pose-preview",3,"video"],["class","green-balloon",3,"totalGameTime","red","green","time",4,"ngIf"],[1,"score-container","flex","flex-col"],[1,"stats","shadow"],[1,"stat"],[1,"stat-title"],[1,"stat-value","text-primary","text-4xl"],["class","stat",4,"ngIf"],[1,"btn","btn-lg","btn-accent","m-4",3,"click"],[1,"green-balloon",3,"red","green","time","totalGameTime"],[3,"minutes","seconds"]],template:function(t,n){t&1&&(Se(0,"app-common-page")(1,"div",0)(2,"h1",1),Ke(3,"Catch the \u26BD and stay away from the \u{1F3C0}!"),Ie(),Se(4,"div",2)(5,"app-video-source-selector",3),mr("cameraSelected",function(s){return n.onCameraSelected(s)}),Ie()(),Se(6,"div",4)(7,"app-video-preview",5),mr("videoReady",function(s){return n.onVideoReady(s)}),Ie(),mt(8,"app-pose-preview",6),qn(9,mYe,1,1,"app-green-balloon-game",7),Ie(),Se(10,"div",8)(11,"div",9)(12,"div",10)(13,"div",11),Ke(14,"\u26BD catches"),Ie(),Se(15,"div",12),Ke(16),Ie()(),Se(17,"div",10)(18,"div",11),Ke(19,"\u{1F3C0} mistakes"),Ie(),Se(20,"div",12),Ke(21),Ie()(),qn(22,gYe,2,2,"div",13),Ie(),Se(23,"div")(24,"button",14),mr("click",function(){return n.back()}),Ke(25," BACK TO THE LIST OF GAMES "),Ie()()()()()),t&2&&(It(5),fr("selectedCameraID",n.selectedCameraID),It(2),fr("selectedCameraID",n.selectedCameraID),It(),fr("video",n.video),It(),fr("ngIf",n.ready),It(7),Ia(n.greenCounter),It(5),Ia(n.redCounter),It(),fr("ngIf",n.minutes))},dependencies:[yw,xw,gw,rk,mu,ao,Ci,A2],styles:[".parent-video-container[_ngcontent-%COMP%]{position:relative;height:480px}.video-preview[_ngcontent-%COMP%], .pose-preview[_ngcontent-%COMP%], .green-balloon[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.camera-selector[_ngcontent-%COMP%]{position:fixed;top:80px;left:20px;z-index:1000;background-color:#fff;padding:10px;box-shadow:0 4px 8px #0000001a}.score-container[_ngcontent-%COMP%]{position:relative;margin-top:16px;font-size:1.25rem;font-weight:700}"]})};var CO=class r{constructor(e){this.router=e}home(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||r)(We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-not-found-page"]],standalone:!0,features:[At],decls:11,vars:0,consts:[[1,"section"],[1,"container"],[1,"title"],[3,"click"]],template:function(t,n){t&1&&(Se(0,"section",0)(1,"div",1)(2,"h1",2),Ke(3,"MOVE PLAYGROUND"),Ie(),Se(4,"h1"),Ke(5,"404 - Page Not Found"),Ie(),Se(6,"p"),Ke(7," The page you are looking for does not exist. Please check the URL or return to the homepage. "),Ie(),Se(8,"a",3),mr("click",function(){return n.home()}),Ke(9,"Go to Homepage"),Ie()()(),mt(10,"app-footer"))},dependencies:[_i]})};function yYe(r,e){r&1&&(Se(0,"span"),Ke(1,"\u2714\uFE0F"),Ie())}function xYe(r,e){r&1&&(Se(0,"span"),Ke(1,"\u2714\uFE0F"),Ie())}function vYe(r,e){if(r&1&&(Se(0,"div",11)(1,"p"),Ke(2," Step 2: Setting up your game session. Almost there... "),qn(3,xYe,2,0,"span",4),Ie()()),r&2){let t=Dn();It(3),fr("ngIf",t.gameSession)}}function bYe(r,e){r&1&&(Se(0,"div",12)(1,"p"),Ke(2," Step 3: Your game session is ready! Click the PLAY button below to start playing, and be sure to share the link with the other player. "),Se(3,"span"),Ke(4,"\u2714\uFE0F"),Ie()()())}var _O=class r{constructor(e,t,n,o){this.data=e;this.route=t;this.router=n;this.events=o}sessions=[];gameType;gameSession;gameURL="";title="Assembling the game parts...";ngOnInit(){this.route.paramMap.subscribe(e=>M(this,null,function*(){let t=e.get("gameName");t&&(this.events.track("game.lobby",{gameName:t,step:0,name:"start"}),yield this.loadGameTypeDetails(t),yield this.createSession(),this.generateGameURL(),this.events.track("game.lobby",{gameName:t,step:2,name:"end",gameURL:this.gameURL}))}))}generateGameURL(){if(!this.gameSession){console.error("No game session created");return}let e=_g.applicationLinkURLPreffix,t=this.gameType.name,n=this.gameSession.external_id;this.events.track("game.lobby",{gameName:t,step:1,name:"generate-url",preffix:e,id:n}),this.gameURL=`${e}/play/${t}/${n}`}loadGameTypeDetails(e){return M(this,null,function*(){let n=(yield this.data.findAll("game_type")).filter(o=>o.name===e);n.length>0?(this.gameType=n[0],console.log(`${e} found`,this.gameType)):console.error(`${e} not found`)})}createSession(){return M(this,null,function*(){if(!this.gameType){console.error("No game type selected");return}this.gameSession=yield this.data.addOne("game_session",{game_type:this.gameType.id})})}play(){this.router.navigate(["/play/tic-tac-toe",this.gameSession.external_id])}static \u0275fac=function(t){return new(t||r)(We(pu),We(Cs),We(xo),We(Na))};static \u0275cmp=Dt({type:r,selectors:[["app-game-lobby"]],standalone:!0,features:[At],decls:20,vars:4,consts:[[1,"section"],[1,"container"],[1,"content","is-large"],["id","step1"],[4,"ngIf"],["id","step2",4,"ngIf"],["id","step3",4,"ngIf"],[1,"box","content","is-large"],[1,"button","is-large","is-primary","big-buttons",3,"click"],[1,"mt-4"],[1,"is-link",3,"click"],["id","step2"],["id","step3"]],template:function(t,n){t&1&&(Se(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1"),Ke(4,"Get in the Game: As Easy as 1-2-3!"),Ie(),Se(5,"div",3)(6,"p"),Ke(7," Step 1: Let's find your game. Loading details now... "),qn(8,yYe,2,0,"span",4),Ie()(),qn(9,vYe,4,1,"div",5)(10,bYe,5,0,"div",6),Ie(),Se(11,"div",7)(12,"button",8),mr("click",function(){return n.play()}),Ke(13," PLAY "),Ie(),Se(14,"p",9),Ke(15," Link to the game "),mt(16,"br"),Se(17,"a",10),mr("click",function(){return n.play()}),Ke(18),Ie()()()()(),mt(19,"app-footer")),t&2&&(It(8),fr("ngIf",n.gameType),It(),fr("ngIf",n.gameType),It(),fr("ngIf",n.gameSession),It(8),Ia(n.gameURL))},dependencies:[ao,Ci,_i]})};var SO=class r{constructor(e){this.poseState=e;this.refresh=Lh.getInstance()}canvas;ctx;board=[["cross","circle","cross"],["cross","circle","circle"],["cross","cross","circle"]];handTimestamps=[[null,null,null],[null,null,null],[null,null,null]];refresh;ngOnInit(){this.setup(),this.start(),this.poseState.handDetected.subscribe(e=>{this.detectHandPosition(e)})}detectHandPosition(e){let t=this.canvas.width/3,n=this.canvas.height/3,o=Math.floor(e.x/t),s=Math.floor(e.y/n);o>=0&&o<3&&s>=0&&s<3&&this.handTimestamps[s][o]===null&&(this.resetHandTimestamps(),this.handTimestamps[s][o]=Date.now())}resetHandTimestamps(){for(let e=0;e<3;e++)for(let t=0;t<3;t++)this.handTimestamps[e][t]=null}setup(){this.canvas=document.getElementById("gameCanvas");let e=this.canvas.getContext("2d");if(!e)throw new Error("Not able to get canvas context");this.ctx=e}start(){this.refresh.setup(20),this.refresh.render.subscribe(e=>{this.update()}),this.refresh.start()}update(){this.clearScreen(),this.drawBoard(),this.highlightQuadrant(),this.drawElements()}clearScreen(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}highlightQuadrant(){let e=this.canvas.width/3,t=this.canvas.height/3;this.ctx.fillStyle="rgba(128, 128, 128, 0.5)";for(let n=0;n<3;n++)for(let o=0;o<3;o++)if(this.handTimestamps[n][o]!==null){let s=o*e,i=n*t;this.ctx.fillRect(s,i,e,t)}}drawElements(){let e=this.canvas.width/3,t=this.canvas.height/3;for(let n=0;n<3;n++)for(let o=0;o<3;o++){let s=o*e,i=n*t;this.board[n][o]==="circle"?this.drawCircle(s+e/2,i+t/2,e/4):this.board[n][o]==="cross"&&this.drawCross(s+e/2,i+t/2,e/4)}}drawBoard(){let e=this.canvas.width,t=this.canvas.height,n=e/3,o=t/3;this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,t),this.ctx.moveTo(2*n,0),this.ctx.lineTo(2*n,t),this.ctx.moveTo(0,o),this.ctx.lineTo(e,o),this.ctx.moveTo(0,2*o),this.ctx.lineTo(e,2*o),this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=4,this.ctx.stroke()}drawCircle(e,t,n){this.ctx.beginPath(),this.ctx.arc(e,t,n,0,Math.PI*2),this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=4,this.ctx.stroke()}drawCross(e,t,n){this.ctx.beginPath(),this.ctx.moveTo(e-n,t-n),this.ctx.lineTo(e+n,t+n),this.ctx.moveTo(e+n,t-n),this.ctx.lineTo(e-n,t+n),this.ctx.strokeStyle="#00FFFF",this.ctx.lineWidth=4,this.ctx.stroke()}static \u0275fac=function(t){return new(t||r)(We(Vh))};static \u0275cmp=Dt({type:r,selectors:[["app-tic-tac-toe-game-render"]],standalone:!0,features:[At],decls:2,vars:0,consts:[[1,"canvas-container"],["id","gameCanvas","width","640","height","480"]],template:function(t,n){t&1&&(Se(0,"div",0),mt(1,"canvas",1),Ie())},styles:[".canvas-container[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}canvas[_ngcontent-%COMP%]{width:100%;height:100%;display:block}"]})};var IO=class r{constructor(e,t){this.dataStorage=e;this.appState=t}findGameSession(e){return M(this,null,function*(){return yield this.dataStorage.findOne("game_session",e,"external_id")})}createGameParticipation(e){return M(this,null,function*(){let t=this.appState.getParticipantId(),n={game_session:e,participant:t};console.log("participationRecord",n);let o=yield this.dataStorage.addOne("game_session_participation",n);return o?(console.log("Participation record created successfully:",o),o):this.findGameParticipation(e,t)})}findGameParticipation(e,t){return M(this,null,function*(){let n=yield this.dataStorage.client().from("game_session_participation").select("*").eq("game_session",e).eq("participant",t).single();return n.data?(console.log("Found existing participation record:",n.data),n.data):(console.error("No existing participation record found."),null)})}determineSymbol(e){return M(this,null,function*(){let{data:t,error:n}=yield this.dataStorage.client().from("game_session_participation").select("*").eq("game_session",e.game_session).order("created_at",{ascending:!0});if(n)return console.error("Error fetching participation records:",n),"observer";let o=t.findIndex(s=>s.id===e.id);return o===0?"circle":o===1?"cross":"observer"})}static \u0275fac=function(t){return new(t||r)(Lt(pu),Lt(Im))};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};function CYe(r,e){if(r&1&&(Se(0,"div",1)(1,"p"),Ke(2),Ie()()),r&2){let t=Dn();It(2),Th("You are playing with ",t.symbol,"")}}var TO=class r{constructor(e,t,n,o,s){this.route=e;this.router=t;this.appStateService=n;this.cdr=o;this.service=s}externalID=null;gameSessionParticipation;selectedCameraID=null;video=new Yr;symbol=null;ngAfterViewInit(){this.selectedCameraID=this.appStateService.getSelectedCamera(),this.cdr.detectChanges()}onVideoReady(e){console.log("video updated",e),this.video.next(e)}onCameraSelected(e){this.selectedCameraID=e,this.appStateService.saveSelectedCamera(e)}ngOnInit(){return M(this,null,function*(){if(this.externalID=this.route.snapshot.paramMap.get("externalID"),!this.externalID){this.router.navigate(["/play/error"]);return}let e=yield this.service.findGameSession(this.externalID);if(!e){this.router.navigate(["/play/error/invalid-session-id",this.externalID]);return}this.gameSessionParticipation=yield this.service.createGameParticipation(e.id),this.symbol=yield this.service.determineSymbol(this.gameSessionParticipation)})}static \u0275fac=function(t){return new(t||r)(We(Cs),We(xo),We(Im),We(yc),We(IO))};static \u0275cmp=Dt({type:r,selectors:[["app-tic-tac-toe-game"]],standalone:!0,features:[At],decls:13,vars:4,consts:[[1,"section"],[1,"container"],[1,"title"],[3,"cameraSelected","selectedCameraID"],["class","container",4,"ngIf"],[1,"video-preview",3,"videoReady","selectedCameraID"],[1,"pose-preview",3,"video"],[1,"game"]],template:function(t,n){t&1&&(Se(0,"section",0)(1,"div",1)(2,"h1",2),Ke(3,"Move your hand to play tic-tac-toe"),Ie(),Se(4,"app-video-source-selector",3),mr("cameraSelected",function(s){return n.onCameraSelected(s)}),Ie()()(),Se(5,"section",0),qn(6,CYe,3,1,"div",4),Se(7,"div",1)(8,"app-video-preview",5),mr("videoReady",function(s){return n.onVideoReady(s)}),Ie(),mt(9,"app-pose-preview",6),Se(10,"div",7),mt(11,"app-tic-tac-toe-game-render"),Ie()()(),mt(12,"app-footer")),t&2&&(It(4),fr("selectedCameraID",n.selectedCameraID),It(2),fr("ngIf",n.symbol),It(2),fr("selectedCameraID",n.selectedCameraID),It(),fr("video",n.video))},dependencies:[ao,Ci,_i,xw,gw,yw,SO],styles:[".video-preview[_ngcontent-%COMP%], .pose-preview[_ngcontent-%COMP%], .game[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]})};var kO=class r{constructor(e,t){this.route=e;this.router=t}sessionID=null;ngOnInit(){return M(this,null,function*(){this.sessionID=this.route.snapshot.paramMap.get("externalID")})}home(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||r)(We(Cs),We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-invalid-game-session-page"]],standalone:!0,features:[At],decls:16,vars:1,consts:[[1,"section"],[1,"container"],[1,"content","is-large"],[1,"title"],[3,"click"]],template:function(t,n){t&1&&(Se(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),Ke(4,"MOVE PLAYGROUND"),Ie(),Se(5,"h1"),Ke(6,"Invalid game session"),Ie(),Se(7,"p"),Ke(8," There was and error trying to join the game session with the identifier:"),mt(9,"br"),Ke(10),Ie(),Se(11,"p"),Ke(12,"Please check the URL or return to the homepage."),Ie(),Se(13,"a",4),mr("click",function(){return n.home()}),Ke(14,"Go to Homepage"),Ie()()()(),mt(15,"app-footer")),t&2&&(It(10),Th(" [",n.sessionID,"]. "))},dependencies:[_i]})};var EO=class r{constructor(e){this.router=e}home(){this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||r)(We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-empty-game-session-idpage"]],standalone:!0,features:[At],decls:12,vars:0,consts:[[1,"section"],[1,"container"],[1,"content","is-large"],[1,"title"],[3,"click"]],template:function(t,n){t&1&&(Se(0,"section",0)(1,"div",1)(2,"div",2)(3,"h1",3),Ke(4,"MOVE PLAYGROUND"),Ie(),Se(5,"h1"),Ke(6,"Invalid game session"),Ie(),Se(7,"p"),Ke(8," The link you used to join the game is invalid, please check it again, or return to the homepage. "),Ie(),Se(9,"a",4),mr("click",function(){return n.home()}),Ke(10,"Go to Homepage"),Ie()()()(),mt(11,"app-footer"))},dependencies:[_i]})};var NO=class r{constructor(e,t){this.currentUser=e;this.router=t}user=void 0;ngOnInit(){return M(this,null,function*(){this.user=yield this.currentUser.get()})}play(){this.router.navigate(["/user/play"])}seeScores(){this.router.navigate(["/user/scores"])}static \u0275fac=function(t){return new(t||r)(We(Yx),We(xo))};static \u0275cmp=Dt({type:r,selectors:[["app-main-page"]],standalone:!0,features:[At],decls:11,vars:0,consts:[[1,"text-center","py-32","sm:py-48","lg:py-56"],[1,"text-4xl","font-bold","tracking-tight","text-gray-900","sm:text-6xl"],[1,"mt-6","text-lg","leading-8","text-gray-600"],[1,"mt-10","flex","items-center","justify-center","gap-x-6"],[1,"flex"],[1,"btn","btn-accent","m-4","btn-xs","sm:btn-sm","md:btn-md","lg:btn-lg",3,"click"]],template:function(t,n){t&1&&(Se(0,"app-common-page")(1,"div",0)(2,"h1",1),Ke(3," Move, Play, Control "),Ie(),Se(4,"p",2),Ke(5," In Move Playground, your body is the controller. Your movements shape the game in real-time. Ready to jump in? "),Ie(),Se(6,"div",3)(7,"div")(8,"div",4)(9,"button",5),mr("click",function(){return n.play()}),Ke(10," PLAY "),Ie()()()()()())},dependencies:[mu,ao]})};var cxe=(()=>{let e=class e{constructor(n,o){this._renderer=n,this._elementRef=o,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,o){this._renderer.setProperty(this._elementRef.nativeElement,n,o)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};e.\u0275fac=function(o){return new(o||e)(We(Ex),We(iu))},e.\u0275dir=ws({type:e});let r=e;return r})(),_Ye=(()=>{let e=class e extends cxe{};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=Sx(e)))(s||e)}})(),e.\u0275dir=ws({type:e,features:[Jp]});let r=e;return r})(),lxe=new $t("");var SYe={provide:lxe,useExisting:ng(()=>$O),multi:!0};function IYe(){let r=rd()?rd().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var TYe=new $t(""),$O=(()=>{let e=class e extends cxe{constructor(n,o,s){super(n,o),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!IYe())}writeValue(n){let o=n??"";this.setProperty("value",o)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};e.\u0275fac=function(o){return new(o||e)(We(Ex),We(iu),We(TYe,8))},e.\u0275dir=ws({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(o,s){o&1&&mr("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[z0([SYe]),Jp]});let r=e;return r})();function kYe(r){return r==null||(typeof r=="string"||Array.isArray(r))&&r.length===0}var tG=new $t(""),uxe=new $t("");function EYe(r){return kYe(r.value)?{required:!0}:null}function exe(r){return null}function pxe(r){return r!=null}function dxe(r){return cg(r)?so(r):r}function hxe(r){let e={};return r.forEach(t=>{e=t!=null?ie(ie({},e),t):e}),Object.keys(e).length===0?null:e}function fxe(r,e){return e.map(t=>t(r))}function NYe(r){return!r.validate}function mxe(r){return r.map(e=>NYe(e)?e:t=>e.validate(t))}function DYe(r){if(!r)return null;let e=r.filter(pxe);return e.length==0?null:function(t){return hxe(fxe(t,e))}}function rG(r){return r!=null?DYe(mxe(r)):null}function AYe(r){if(!r)return null;let e=r.filter(pxe);return e.length==0?null:function(t){let n=fxe(t,e).map(dxe);return v0(n).pipe(cr(hxe))}}function nG(r){return r!=null?AYe(mxe(r)):null}function txe(r,e){return r===null?[e]:Array.isArray(r)?[...r,e]:[r,e]}function RYe(r){return r._rawValidators}function OYe(r){return r._rawAsyncValidators}function eG(r){return r?Array.isArray(r)?r:[r]:[]}function AO(r,e){return Array.isArray(r)?r.includes(e):r===e}function rxe(r,e){let t=eG(e);return eG(r).forEach(o=>{AO(t,o)||t.push(o)}),t}function nxe(r,e){return eG(e).filter(t=>!AO(r,t))}var RO=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=rG(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=nG(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},n0=class extends RO{get formDirective(){return null}get path(){return null}},XS=class extends RO{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},OO=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},MYe={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},b6n=$e(ie({},MYe),{"[class.ng-submitted]":"isSubmitted"}),gxe=(()=>{let e=class e extends OO{constructor(n){super(n)}};e.\u0275fac=function(o){return new(o||e)(We(XS,2))},e.\u0275dir=ws({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(o,s){o&2&&MT("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Jp]});let r=e;return r})(),yxe=(()=>{let e=class e extends OO{constructor(n){super(n)}};e.\u0275fac=function(o){return new(o||e)(We(n0,10))},e.\u0275dir=ws({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(o,s){o&2&&MT("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Jp]});let r=e;return r})();var WS="VALID",DO="INVALID",t0="PENDING",jS="DISABLED",o0=class{},MO=class extends o0{constructor(e,t){super(),this.value=e,this.source=t}},qS=class extends o0{constructor(e,t){super(),this.pristine=e,this.source=t}},KS=class extends o0{constructor(e,t){super(),this.touched=e,this.source=t}},r0=class extends o0{constructor(e,t){super(),this.status=e,this.source=t}};function xxe(r){return(LO(r)?r.validators:r)||null}function FYe(r){return Array.isArray(r)?rG(r):r||null}function vxe(r,e){return(LO(e)?e.asyncValidators:r)||null}function PYe(r){return Array.isArray(r)?nG(r):r||null}function LO(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function $Ye(r,e,t){let n=r.controls;if(!(e?Object.keys(n):n).length)throw new gt(1e3,"");if(!n[t])throw new gt(1001,"")}function LYe(r,e,t){r._forEachChild((n,o)=>{if(t[o]===void 0)throw new gt(1002,"")})}var FO=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=G0(()=>this.statusReactive()),this.statusReactive=B0(void 0),this._pristine=G0(()=>this.pristineReactive()),this.pristineReactive=B0(!0),this._touched=G0(()=>this.touchedReactive()),this.touchedReactive=B0(!1),this._events=new Yr,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return td(this.statusReactive)}set status(e){td(()=>this.statusReactive.set(e))}get valid(){return this.status===WS}get invalid(){return this.status===DO}get pending(){return this.status==t0}get disabled(){return this.status===jS}get enabled(){return this.status!==jS}get pristine(){return td(this.pristineReactive)}set pristine(e){td(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return td(this.touchedReactive)}set touched(e){td(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(rxe(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(rxe(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(nxe(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(nxe(e,this._rawAsyncValidators))}hasValidator(e){return AO(this._rawValidators,e)}hasAsyncValidator(e){return AO(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched($e(ie({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new KS(!0,n))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:n})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,n),t&&e.emitEvent!==!1&&this._events.next(new KS(!1,n))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let n=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty($e(ie({},e),{sourceControl:n})),t&&e.emitEvent!==!1&&this._events.next(new qS(!1,n))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=e.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,n),t&&e.emitEvent!==!1&&this._events.next(new qS(!0,n))}markAsPending(e={}){this.status=t0;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new r0(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending($e(ie({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=jS,this.errors=null,this._forEachChild(o=>{o.disable($e(ie({},e),{onlySelf:!0}))}),this._updateValue();let n=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new MO(this.value,n)),this._events.next(new r0(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors($e(ie({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=WS,this._forEachChild(n=>{n.enable($e(ie({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors($e(ie({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===WS||this.status===t0)&&this._runAsyncValidator(n,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new MO(this.value,t)),this._events.next(new r0(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity($e(ie({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?jS:WS}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=t0,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let n=dxe(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((n,o)=>n&&n._find(o),this)}getError(e,t){let n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,n){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||n)&&this._events.next(new r0(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,n)}_initObservables(){this.valueChanges=new tn,this.statusChanges=new tn}_calculateStatus(){return this._allControlsDisabled()?jS:this.errors?DO:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(t0)?t0:this._anyControlsHaveStatus(DO)?DO:WS}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let n=!this._anyControlsDirty(),o=this.pristine!==n;this.pristine=n,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),o&&this._events.next(new qS(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new KS(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){LO(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=FYe(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=PYe(this._rawAsyncValidators)}},PO=class extends FO{constructor(e,t,n){super(xxe(t),vxe(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){LYe(this,!0,e),Object.keys(e).forEach(n=>{$Ye(this,!0,n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(n=>{let o=this.controls[n];o&&o.patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,o)=>{n.reset(e?e[o]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,n)=>n._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,n]of Object.entries(this.controls))if(this.contains(t)&&e(n))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,n,o)=>((n.enabled||this.disabled)&&(t[o]=n.value),t))}_reduceChildren(e,t){let n=e;return this._forEachChild((o,s)=>{n=t(n,o,s)}),n}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var oG=new $t("CallSetDisabledState",{providedIn:"root",factory:()=>sG}),sG="always";function VYe(r,e){return[...e.path,r]}function bxe(r,e,t=sG){wxe(r,e),e.valueAccessor.writeValue(r.value),(r.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(r.disabled),zYe(r,e),GYe(r,e),UYe(r,e),BYe(r,e)}function oxe(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function BYe(r,e){if(e.valueAccessor.setDisabledState){let t=n=>{e.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}function wxe(r,e){let t=RYe(r);e.validator!==null?r.setValidators(txe(t,e.validator)):typeof t=="function"&&r.setValidators([t]);let n=OYe(r);e.asyncValidator!==null?r.setAsyncValidators(txe(n,e.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let o=()=>r.updateValueAndValidity();oxe(e._rawValidators,o),oxe(e._rawAsyncValidators,o)}function zYe(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&Cxe(r,e)})}function UYe(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&Cxe(r,e),r.updateOn!=="submit"&&r.markAsTouched()})}function Cxe(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function GYe(r,e){let t=(n,o)=>{e.valueAccessor.writeValue(n),o&&e.viewToModelUpdate(n)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}function WYe(r,e){r==null,wxe(r,e)}function jYe(r,e){if(!r.hasOwnProperty("model"))return!1;let t=r.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function HYe(r){return Object.getPrototypeOf(r.constructor)===_Ye}function qYe(r,e){r._syncPendingControls(),e.forEach(t=>{let n=t.control;n.updateOn==="submit"&&n._pendingChange&&(t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function KYe(r,e){if(!e)return null;Array.isArray(e);let t,n,o;return e.forEach(s=>{s.constructor===$O?t=s:HYe(s)?n=s:o=s}),o||n||t||null}var XYe={provide:n0,useExisting:ng(()=>iG)},HS=Promise.resolve(),iG=(()=>{let e=class e extends n0{get submitted(){return td(this.submittedReactive)}constructor(n,o,s){super(),this.callSetDisabledState=s,this._submitted=G0(()=>this.submittedReactive()),this.submittedReactive=B0(!1),this._directives=new Set,this.ngSubmit=new tn,this.form=new PO({},rG(n),nG(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){HS.then(()=>{let o=this._findContainer(n.path);n.control=o.registerControl(n.name,n.control),bxe(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){HS.then(()=>{let o=this._findContainer(n.path);o&&o.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){HS.then(()=>{let o=this._findContainer(n.path),s=new PO({});WYe(s,n),o.registerControl(n.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){HS.then(()=>{let o=this._findContainer(n.path);o&&o.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,o){HS.then(()=>{this.form.get(n.path).setValue(o)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submittedReactive.set(!0),qYe(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};e.\u0275fac=function(o){return new(o||e)(We(tG,10),We(uxe,10),We(oG,8))},e.\u0275dir=ws({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(o,s){o&1&&mr("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[z0([XYe]),Jp]});let r=e;return r})();function sxe(r,e){let t=r.indexOf(e);t>-1&&r.splice(t,1)}function ixe(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var YYe=class extends FO{constructor(e=null,t,n){super(xxe(t),vxe(n,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),LO(t)&&(t.nonNullable||t.initialValueIsDefault)&&(ixe(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){sxe(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){sxe(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){ixe(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var ZYe={provide:XS,useExisting:ng(()=>aG)},axe=Promise.resolve(),aG=(()=>{let e=class e extends XS{constructor(n,o,s,i,a,c){super(),this._changeDetectorRef=a,this.callSetDisabledState=c,this.control=new YYe,this._registered=!1,this.name="",this.update=new tn,this._parent=n,this._setValidators(o),this._setAsyncValidators(s),this.valueAccessor=KYe(this,i)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let o=n.name.previousValue;this.formDirective.removeControl({name:o,path:this._getPath(o)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),jYe(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){bxe(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){axe.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let o=n.isDisabled.currentValue,s=o!==0&&U0(o);axe.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?VYe(n,this._parent):[n]}};e.\u0275fac=function(o){return new(o||e)(We(n0,9),We(tG,10),We(uxe,10),We(lxe,10),We(yc,8),We(oG,8))},e.\u0275dir=ws({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[z0([ZYe]),Jp,mc]});let r=e;return r})(),_xe=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=ws({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let r=e;return r})();var QYe=(()=>{let e=class e{constructor(){this._validator=exe}ngOnChanges(n){if(this.inputName in n){let o=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(o),this._validator=this._enabled?this.createValidator(o):exe,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return n!=null}};e.\u0275fac=function(o){return new(o||e)},e.\u0275dir=ws({type:e,features:[mc]});let r=e;return r})();var JYe={provide:tG,useExisting:ng(()=>cG),multi:!0};var cG=(()=>{let e=class e extends QYe{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=U0,this.createValidator=n=>EYe}enabled(n){return n}};e.\u0275fac=(()=>{let n;return function(s){return(n||(n=Sx(e)))(s||e)}})(),e.\u0275dir=ws({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(o,s){o&2&&OT("required",s._enabled?"":null)},inputs:{required:"required"},features:[z0([JYe]),Jp]});let r=e;return r})();var e7e=(()=>{let e=class e{};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=sg({type:e}),e.\u0275inj=og({});let r=e;return r})();var Sxe=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:oG,useValue:n.callSetDisabledState??sG}]}}};e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=sg({type:e}),e.\u0275inj=og({imports:[e7e]});let r=e;return r})();function r7e(r,e){r&1&&(Se(0,"app-alert-info"),Ke(1,"Please check your email to find a login link"),Ie())}function n7e(r,e){if(r&1&&(Se(0,"app-alert-error")(1,"p"),Ke(2,"An error happened when trying to send the login link"),Ie(),Se(3,"p"),Ke(4),BH(5,"json"),Ie()()),r&2){let t=Dn();It(4),Ia(zH(5,1,t.error))}}var VO=class r{constructor(e){this.supabaseService=e}email="";emailSent=!1;error;login(){return M(this,null,function*(){this.emailSent=!1,this.error=void 0;try{let e=yield this.supabaseService.signInWithEmail(this.email);e.error?this.error=e.error:this.emailSent=!0}catch(e){this.error=e}})}static \u0275fac=function(t){return new(t||r)(We(pu))};static \u0275cmp=Dt({type:r,selectors:[["app-email-input"]],standalone:!0,features:[At],decls:13,vars:3,consts:[[1,"bg-white","shadow-md","rounded-lg","p-6","w-full"],[1,"text-xl","font-semibold","mb-4","text-center"],[1,"mb-4"],["for","email",1,"block","text-sm","font-medium","text-gray-700"],["name","email","required","","id","email","placeholder","Enter your email",1,"mt-1","block","w-full","p-2","border","border-gray-300","rounded-md","shadow-sm","focus:ring-indigo-500","focus:border-indigo-500","sm:text-sm",3,"ngModelChange","ngModel"],["type","submit",1,"w-full","py-2","px-4","bg-indigo-600","text-white","font-semibold","rounded-md","shadow","hover:bg-indigo-700","focus:outline-none","focus:ring-2","focus:ring-indigo-500","focus:ring-opacity-50",3,"click"],[1,"pt-4"],[4,"ngIf"]],template:function(t,n){t&1&&(Se(0,"div",0)(1,"h2",1),Ke(2," To start, you'll need to enter your email and we will send you a link for you to login. "),Ie(),Se(3,"form")(4,"div",2)(5,"label",3),Ke(6,"Email"),Ie(),Se(7,"input",4),EP("ngModelChange",function(s){return LH(n.email,s)||(n.email=s),s}),Ie()(),Se(8,"button",5),mr("click",function(){return n.login()}),Ke(9," START "),Ie()(),Se(10,"div",6),qn(11,r7e,2,0,"app-alert-info",7)(12,n7e,6,3,"app-alert-error",7),Ie()()),t&2&&(It(7),kP("ngModel",n.email),It(4),fr("ngIf",n.emailSent),It(),fr("ngIf",n.error))},dependencies:[Sxe,_xe,$O,gxe,yxe,cG,aG,iG,pv,uv,ao,Ci,lq]})};var BO=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=Dt({type:r,selectors:[["app-login-page"]],standalone:!0,features:[At],decls:6,vars:0,consts:[[1,"text-center"],[1,"text-2xl","font-bold","tracking-tight","text-gray-900","sm:text-3xl"],[1,"mt-10","flex","items-center","justify-center","gap-x-6"],[1,"flex-grow"]],template:function(t,n){t&1&&(Se(0,"app-common-page")(1,"div",0)(2,"h3",1),Ke(3," Move, Play, Control "),Ie(),Se(4,"div",2),mt(5,"app-email-input",3),Ie()()())},dependencies:[mu,VO]})};var Ixe=[{path:"",component:NO},{path:"login",component:BO},{path:"user",children:[{path:"play",component:tk},{path:"balloons",component:GS},{path:"balloons/:minutes",component:GS},{path:"lobby/:gameName",component:_O},{path:"play/tic-tac-toe/:externalID",component:TO},{path:"play/error/invalid-session-id/:externalID",component:kO},{path:"play/error/empty-session-id",component:EO}]},{path:"**",component:CO}];var Txe={providers:[qH({eventCoalescing:!0}),e6(Ixe)]};var zO=class r{constructor(e,t){this.router=e;this.events=t}allRoutePaths=[];initAutoTracking(){this.router.events.pipe(yi(e=>e instanceof sd)).subscribe(e=>M(this,null,function*(){let t=this.removeParamFromUrl(e.urlAfterRedirects);this.events.track("page.viewed",{page:t})})),this.allRoutePaths=this.getAllRoutePaths(),console.log("allRoutePaths",this.allRoutePaths)}getAllRoutePaths(){let e=[],t=this.router.config;return this.extractPaths(t,"",e),e}extractPaths(e,t,n){e.forEach(o=>{let s=t+(o.path?`/${o.path}`:"");n.push(s),o.children&&this.extractPaths(o.children,s,n)})}removeParamFromUrl(e){for(let t of this.allRoutePaths){if(t.includes("*"))continue;let n=t.replace(/:\w+/g,"[^/]+");if(new RegExp(`^${n}$`).test(e))return e.replace(/\/[^/]+$/,"")}return e}static \u0275fac=function(t){return new(t||r)(Lt(xo),Lt(Na))};static \u0275prov=st({token:r,factory:r.\u0275fac,providedIn:"root"})};var UO=class r{constructor(e,t,n){this.events=e;this.activatedRoute=t;this.pageNavigationTracking=n}currentUserId=null;ngOnInit(){this.pageNavigationTracking.initAutoTracking(),this.activatedRoute.queryParams.pipe(ya(1)).subscribe(e=>{let t=e.name;this.identifyUser(t)})}identifyUser(e){this.currentUserId=localStorage.getItem("userId"),this.currentUserId||(e?(this.currentUserId=e,localStorage.setItem("userId",this.currentUserId)):(this.currentUserId=crypto.randomUUID(),localStorage.setItem("userId",this.currentUserId))),this.events.identify(this.currentUserId)}static \u0275fac=function(t){return new(t||r)(We(Na),We(Cs),We(zO))};static \u0275cmp=Dt({type:r,selectors:[["app-root"]],standalone:!0,features:[At],decls:1,vars:0,template:function(t,n){t&1&&mt(0,"router-outlet")},dependencies:[_$]})};xq(UO,Txe).catch(r=>console.error(r));
